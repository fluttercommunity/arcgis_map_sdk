"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[2242],{2242:(e,t,n)=>{n.r(t),n.d(t,{TextureCompressionWorkerOutput:()=>d,compress:()=>f,compressRGBADataToKTX2:()=>p,createTextureDataKTX2:()=>C,initializeBasisEncoder:()=>w,initializeDXTEncoder:()=>T});var a=n(36567);let r;var s=n(26503);let i;var l=n(91907);let c,o,u=null,h=null;class d{constructor(e,t){this.internalFormat=e,this.compressedTexture=t}}async function f(e){const t=function(e,t=!1){const n=new OffscreenCanvas(e.width,e.height),a=n.getContext("2d");return t&&a.scale(1,-1),a.drawImage(e,0,t?-e.height:0),a.getImageData(0,0,n.width,n.height).data}(e.data,e.flipped);if(e.hasS3TC){h||await T();const n=new Uint8Array(t.length);h?.encode(new Uint8Array(t),e.width,e.height,n);const a=function(e,t){const n=new Int32Array(e.buffer,e.byteOffset,31);let a,r;switch(n[21]){case E:a=8,r=l.q_.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case y:a=16,r=l.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case A:a=16,r=l.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}let s=1,i=n[4],c=n[3];(3&i||3&c)&&(i=i+3&-4,c=c+3&-4);const o=i,u=c;let h,d;n[2]&m&&!1!==t&&(s=Math.max(1,n[7]));let f=e.byteOffset+n[1]+4;const w=[];for(let t=0;t<s;++t)d=(i+3>>2)*(c+3>>2)*a,h=new Uint8Array(e.buffer,f,d),w.push(h),f+=d,i=Math.max(1,i>>1),c=Math.max(1,c>>1);return{textureData:{type:"compressed",levels:w},internalFormat:r,width:o,height:u}}(n,!0),r=[n.buffer];return{result:new d(a?.internalFormat??null,a?.textureData??null),transferList:r}}if(e.hasETC){u||await w();const n=await p(t,e.width,e.height,e.hasMipmap),a=n?await C(n):null,r=a?.compressedTexture?.levels.map((e=>e.buffer))||[];return{result:new d(a?.internalFormat??null,a?.compressedTexture??null),transferList:r}}return{result:new d(null,null)}}async function w(){u||(u=await(c??=(r??=(async()=>{const e=await n.e(43312).then(n.bind(n,43312)),t=await e.default({locateFile:e=>(0,a.V)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})(),r)))}async function T(){h||(h=await(o??=(i??=(async()=>{const e=await n.e(5340).then(n.bind(n,5340));return await e.default({locateFile:e=>(0,a.V)(`esri/libs/dxtEncoder/${e}`)})})(),i)))}async function p(e,t,n,a,r=255,s=0,i=!1,l=!1){if(!u)return null;const c=new u.BasisEncoder;c.setPerceptual(!l),c.setCheckForAlpha(!0),c.setForceAlpha(!1),c.setRenormalize(l),c.setMipGen(a),c.setMipSRGB(!l),c.setCreateKTX2File(!0),c.setKTX2SRGBTransferFunc(!l),c.setQualityLevel(r),c.setCompressionLevel(s);const o=new Uint8Array(e.byteLength);c.setSliceSourceImage(0,new Uint8Array(e),t,n,i);const h=c.encode(o),d=new Uint8Array(o.buffer,0,h),f=new u.KTX2File(new Uint8Array(d));return f.isValid()?(c.delete(),d):(f.close(),f.delete(),c.delete(),null)}async function C(e){if(!u)return new d(null,null);const t=new u.KTX2File(new Uint8Array(e));t.startTranscoding();const[n,a]=t.getHasAlpha()?[s.E.ETC2_RGBA,l.q_.COMPRESSED_RGBA8_ETC2_EAC]:[s.E.ETC1_RGB,l.q_.COMPRESSED_RGB8_ETC2],r=t.getLevels(),i=[];for(let e=0;e<r;e++)i.push(new Uint8Array(t.getImageTranscodedSizeInBytes(e,0,0,n))),t.transcodeImage(i[e],e,0,0,n,0,-1,-1);return t.close(),t.delete(),{internalFormat:a,compressedTexture:{type:"compressed",levels:i}}}const m=131072;function _(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const E=_("DXT1"),y=_("DXT3"),A=_("DXT5")}}]);