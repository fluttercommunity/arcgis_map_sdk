"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[96888,58971],{44415:(e,t,i)=>{i.d(t,{$8:()=>w,Vo:()=>v,YZ:()=>l,a8:()=>p,aV:()=>d,ln:()=>m,wP:()=>b});var r=i(72057),n=i(14845),s=i(30879),a=(i(64573),i(97718)),o=i(72559);const l=",",c={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},h=new Set(["integer","small-integer"]);let u=null;function p(e){return(0,n.y2)(e)||(0,n.UQ)(e)||(0,n.ig)(e)}async function d(e){const{field:t,field2:i,field3:r,normalizationField:n,valueExpression:a}=e;let o=[];if(a){if(!u){const{arcadeUtils:e}=await(0,s.LC)();u=e}o=u.extractFieldNames(a)}return t&&o.push(t),i&&o.push(i),r&&o.push(r),n&&o.push(n),o}function f(e){return String(e).padStart(2,"0")}function y(e,t,i){let r;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),r=`TIMESTAMP'${i?e.getFullYear():e.getUTCFullYear()}-${f((i?e.getMonth():e.getUTCMonth())+1)}-${f(i?e.getDate():e.getUTCDate())} ${f(i?e.getHours():e.getUTCHours())}:${f(i?e.getMinutes():e.getUTCMinutes())}:${f(i?e.getSeconds():e.getUTCSeconds())}'`):r=e,r}function m(e,t,i,r){const{hasQueryEngine:n}=e,s=`(${y(i,g(e,i),n)} - ${y(t,g(e,t),n)})`;let a=c[r],o="/";return a<1&&(a=1/a,o="*"),{sqlExpression:1===a?s:`(${s} ${o} ${a})`,sqlWhere:null}}function g(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const i=e.getField(t);if("<now>"===t.toLowerCase())return;if((0,n.y2)(i))return"field"}}function v(e,t){const i=t&&e.getField(t);return!!i&&h.has(i.type)}function b(e){return`cast(${e} as float)`}function w(e,t){const{format:i,timeZoneOptions:n,fieldType:s}=t??{};let l,c;if(n&&({timeZone:l,timeZoneName:c}=(0,o.Np)(n.layerTimeZone,n.datesInUnknownTimezone,n.viewTimeZone,(0,r.Ze)(i||"short-date-short-time"),s)),"string"==typeof e&&isNaN(Date.parse("time-only"===s?`1970-01-01T${e}Z`:e)))return e;switch(s){case"date-only":{const t=(0,r.Ze)(i||"short-date");return"string"==typeof e?(0,r.o8)(e,{...t}):(0,r.p6)(e,{...t,timeZone:a.pt})}case"time-only":{const t=(0,r.Ze)(i||"short-time");return"string"==typeof e?(0,r.LJ)(e,t):(0,r.p6)(e,{...t,timeZone:a.pt})}case"timestamp-offset":{if(!l&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=i||n?(0,r.Ze)(i||"short-date-short-time"):void 0,s=t?{...t,timeZone:l,timeZoneName:c}:void 0;return"string"==typeof e?(0,r.i$)(e,s):(0,r.p6)(e,s)}default:{const t=i||n?(0,r.Ze)(i||"short-date-short-time"):void 0;return(0,r.p6)("string"==typeof e?new Date(e):e,t?{...t,timeZone:l,timeZoneName:c}:void 0)}}}},96888:(e,t,i)=>{i.r(t),i.d(t,{default:()=>C});var r=i(36663),n=i(31355),s=i(67134),a=i(76868),o=i(81977),l=(i(39994),i(13802),i(40266)),c=i(45857),h=i(43411),u=i(15498),p=i(1759),d=i(50749),f=i(79523),y=i(8365);class m{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-click"}}class g{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-double-click"}}class v{constructor(e,t,i,r,n,s,a,o,l,c){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=s,this.dy=a,this.totalDx=o,this.totalDy=l,this.viewEvent=c,this.defaultPrevented=!1,this.type="graphic-move-start"}preventDefault(){this.defaultPrevented=!0}}class b{constructor(e,t,i,r,n,s,a,o,l,c){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=s,this.dy=a,this.totalDx=o,this.totalDy=l,this.viewEvent=c,this.defaultPrevented=!1,this.type="graphic-move"}preventDefault(){this.defaultPrevented=!0}}class w{constructor(e,t,i,r,n,s,a,o,l,c){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=s,this.dy=a,this.totalDx=o,this.totalDy=l,this.viewEvent=c,this.defaultPrevented=!1,this.type="graphic-move-stop"}preventDefault(){this.defaultPrevented=!0}}class x{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-over"}}class _{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-out"}}class I{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-down"}}class G{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-up"}}var T=i(97737),k=i(4641),F=i(38114);const E="indicator-symbols";let M=class extends n.Z.EventedAccessor{constructor(e){super(e),this._activeGraphic=null,this._dragEvent=null,this._hoverGraphic=null,this._indicators=[],this._initialDragGeometry=null,this._manipulators=[],this._layerViews=null,this.type="graphic-mover",this.callbacks={onGraphicClick(){},onGraphicDoubleClick(){},onGraphicMoveStart(){},onGraphicMove(){},onGraphicMoveStop(){},onGraphicPointerOver(){},onGraphicPointerOut(){},onGraphicPointerDown(){},onGraphicPointerUp(){}},this.enableMoveAllGraphics=!1,this.graphics=[],this.indicatorsEnabled=!1,this.layer=new c.Z({listMode:"hide",internal:!0,title:"GraphicMover highlight layer"}),this.view=null}initialize(){(0,y.p)(this.view,this.layer),this._highlightHelper=new f.Z({view:this.view}),this.refresh(),this.addHandles([(0,a.watch)((()=>this.graphics.length),(()=>this.refresh())),(0,a.when)((()=>this.view?.ready),(()=>{this.addHandles([this.view.on("immediate-click",(e=>this._clickHandler(e)),T.f.TOOL),this.view.on("double-click",(e=>this._doubleClickHandler(e)),T.f.TOOL),this.view.on("pointer-down",(e=>this._pointerDownHandler(e)),T.f.TOOL),this.view.on("pointer-move",(e=>this._pointerMoveHandler(e)),T.f.TOOL),this.view.on("pointer-up",(e=>this._pointerUpHandler(e)),T.f.TOOL),this.view.on("drag",(e=>this._dragHandler(e)),T.f.TOOL),this.view.on("key-down",(e=>this._keyDownHandler(e)),T.f.TOOL)])}),{once:!0,initial:!0}),(0,a.watch)((()=>this.view),(e=>{this._highlightHelper.removeAll(),this._highlightHelper.view=e}))])}destroy(){this._removeIndicators(),this.view.map?.remove(this.layer),this.layer.destroy(),this.reset(),this._manipulators.forEach((e=>e.destroy())),this._manipulators=null}set highlightsEnabled(e){this._highlightHelper?.removeAll(),this._set("highlightsEnabled",e),e&&this._highlightHelper?.add(this.graphics)}get state(){const e=this.view.ready,t=this.graphics.length>0,i=this._activeGraphic;return e&&t?i?"moving":"active":e?"ready":"disabled"}refresh(){this.reset(),this._setup()}reset(){this._activeGraphic=null,this._hoverGraphic=null,this._dragEvent=null,this._highlightHelper.removeAll()}updateGeometry(e,t){const i=this.graphics[e];i&&(i.set("geometry",t),this._setUpIndicators())}_setup(){this._setUpHighlights(),this._setUpIndicators(),this._setUpManipulators(),this._syncLayerViews()}_clickHandler(e){const t=this._findTargetGraphic((0,F.vT)(e));if(t){const i=new m(t,this.graphics.indexOf(t),e.x,e.y,e);this.emit("graphic-click",i),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(i)}}_doubleClickHandler(e){const t=this._findTargetGraphic((0,F.vT)(e));if(t){const i=new g(t,this.graphics.indexOf(t),e.x,e.y,e);this.emit("graphic-double-click",i),this.callbacks.onGraphicDoubleClick&&this.callbacks.onGraphicDoubleClick(i)}}_pointerDownHandler(e){const t=this._findTargetGraphic((0,F.vT)(e));if(t){this._activeGraphic=t;const{x:i,y:r}=e,n=new I(t,this.graphics.indexOf(t),i,r,e);this.emit("graphic-pointer-down",n),this.callbacks.onGraphicPointerDown&&this.callbacks.onGraphicPointerDown(n)}else this._activeGraphic=null}_pointerUpHandler(e){if(this._activeGraphic){const{x:t,y:i}=e,r=this.graphics.indexOf(this._activeGraphic),n=new G(this._activeGraphic,r,t,i,e);this.emit("graphic-pointer-up",n),this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(n)}}_pointerMoveHandler(e){if(this._dragEvent)return;const t=this._findTargetGraphic((0,F.vT)(e));if(t){const{x:i,y:r}=e;if(this._hoverGraphic){if(this._hoverGraphic===t)return;const n=this.graphics.indexOf(this._hoverGraphic),s=new _(this.graphics[n],n,i,r,e);this._hoverGraphic=null,this.emit("graphic-pointer-out",s),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(s)}const n=this.graphics.indexOf(t),s=new x(t,n,i,r,e);return this._hoverGraphic=t,this.emit("graphic-pointer-over",s),void(this.callbacks.onGraphicPointerOver&&this.callbacks.onGraphicPointerOver(s))}if(this._hoverGraphic){const{x:t,y:i}=e,r=this.graphics.indexOf(this._hoverGraphic),n=new _(this.graphics[r],r,t,i,e);this._hoverGraphic=null,this.emit("graphic-pointer-out",n),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(n)}}_dragHandler(e){if("start"!==e.action&&!this._dragEvent||!this._activeGraphic?.geometry)return;"start"===e.action&&this._removeIndicators(),e.stopPropagation();const{action:t,x:i,y:r}=e,n=this.graphics.indexOf(this._activeGraphic),a=this._dragEvent?i-this._dragEvent.x:0,o=this._dragEvent?r-this._dragEvent.y:0,l=i-e.origin.x,c=r-e.origin.y,h="start"===t?this._activeGraphic.geometry:this._initialDragGeometry,u=(0,d.e7)(h,l,c,this.view);if(this._activeGraphic.geometry=u,this.enableMoveAllGraphics&&this.graphics.forEach((e=>{e!==this._activeGraphic&&(e.geometry=(0,d.e7)(e.geometry,a,o,this.view))})),this._dragEvent=e,"start"===t){this._initialDragGeometry=(0,s.d9)(h);const t=new v(this._activeGraphic,this.graphics,n,i,r,a,o,l,c,e);this.emit("graphic-move-start",t),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(t),t.defaultPrevented&&this._activeGraphic.set("geometry",h)}else if("update"===t){const t=new b(this._activeGraphic,this.graphics,n,i,r,a,o,l,c,e);this.emit("graphic-move",t),this.callbacks.onGraphicMove&&this.callbacks.onGraphicMove(t),t.defaultPrevented&&(this._activeGraphic.geometry=h)}else{const t=new w(this._activeGraphic,this.graphics,n,i,r,a,o,l,c,e);this._dragEvent=null,this._activeGraphic=null,this._setUpIndicators(),this.emit("graphic-move-stop",t),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(t),t.defaultPrevented&&(this.graphics[n].set("geometry",this._initialDragGeometry),this._setUpIndicators()),this._initialDragGeometry=null}}_keyDownHandler(e){"a"!==e.key&&"d"!==e.key&&"n"!==e.key||"moving"!==this.state||e.stopPropagation()}_findTargetGraphic(e){const t=this.view.toMap(e),i=this.graphics;let r=null,n=Number.MAX_VALUE;this._syncLayerViews();const s=this._layerViews.flatMap((e=>"graphicsViews"in e?Array.from(e.graphicsViews(),(e=>e.hitTest(t))).flat():e.graphicsView.hitTest(t))).filter((e=>i.includes(e))).sort(((e,t)=>i.indexOf(e)-i.indexOf(t)));return s.length?s[0]:(this._manipulators.forEach((t=>{const i=t.intersectionDistance(e);null!=i&&i<n&&(n=i,r=t.graphic)})),r)}_syncLayerViews(){this._layerViews=[];const e=new Set;for(const t of this.graphics){const i=(0,y.j)(this.view,t.layer);i&&e.add(i)}this._layerViews=[...e]}_setUpManipulators(){const{graphics:e,view:t}=this;this._manipulators.forEach((e=>e.destroy())),this._manipulators=e.length?e.map((e=>new k.L({graphic:e,view:t}))):[]}_setUpHighlights(){this.highlightsEnabled&&this._highlightHelper.add(this.graphics)}_setUpIndicators(){if(this._removeIndicators(),this.indicatorsEnabled){for(const e of this.graphics){const t=e.clone();t.symbol=Z(e),this._indicators.push(t),this.addHandles((0,a.watch)((()=>e.symbol),(()=>this._setUpIndicators())),E)}this.layer.addMany(this._indicators)}}_removeIndicators(){this.removeHandles(E),this._indicators.length&&(this.layer.removeMany(this._indicators),this._indicators.forEach((e=>e.destroy())),this._indicators=[])}};function Z(e){if(null==e.symbol)return null;switch(e.symbol.type){case"cim":return new p.Z({style:"circle",size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});case"picture-marker":{const{xoffset:t,yoffset:i,height:r,width:n}=e.symbol,s=r===n?n:Math.max(r,n);return new p.Z({xoffset:t,yoffset:i,size:s,style:"square",color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-marker":{const{xoffset:t,yoffset:i,size:r,style:n}=e.symbol;return new p.Z({xoffset:t,yoffset:i,style:"circle"===n?"circle":"square",size:r+2,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-fill":return new h.Z({color:[0,0,0,0],outline:{style:"dash",color:[255,127,0,1],width:1}});case"simple-line":return new u.Z({color:[255,127,0,1],style:"dash",width:1});case"text":{const{xoffset:t,yoffset:i}=e.symbol;return new p.Z({xoffset:t,yoffset:i,size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}default:return null}}(0,r._)([(0,o.Cb)()],M.prototype,"_activeGraphic",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],M.prototype,"type",void 0),(0,r._)([(0,o.Cb)()],M.prototype,"callbacks",void 0),(0,r._)([(0,o.Cb)()],M.prototype,"enableMoveAllGraphics",void 0),(0,r._)([(0,o.Cb)()],M.prototype,"graphics",void 0),(0,r._)([(0,o.Cb)({value:!1})],M.prototype,"highlightsEnabled",null),(0,r._)([(0,o.Cb)()],M.prototype,"indicatorsEnabled",void 0),(0,r._)([(0,o.Cb)()],M.prototype,"layer",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],M.prototype,"state",null),(0,r._)([(0,o.Cb)()],M.prototype,"view",void 0),M=(0,r._)([(0,l.j)("esri.views.draw.support.GraphicMover")],M);const C=M},79523:(e,t,i)=>{i.d(t,{Z:()=>p});var r=i(36663),n=i(74396),s=i(81977),a=(i(39994),i(13802),i(4157),i(40266)),o=i(8365),l=i(67235),c=i(42780),h=i(58971);let u=class extends n.Z{constructor(e){super(e),this.view=null,this.highlightName=l.b}add(e){const t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach((e=>this._highlight(e)))}remove(e){const t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach((e=>this._removeHighlight(e)))}removeAll(){this.removeAllHandles()}_highlight(e){const t=(0,o.j)(this.view,e.layer);(0,c.tl)(t)&&this.addHandles(t.highlight(e,{name:this.highlightName}),(0,h.getHighlightKeyForFeature)(e))}_removeHighlight(e){e&&this.removeHandles((0,h.getHighlightKeyForFeature)(e))}};(0,r._)([(0,s.Cb)()],u.prototype,"view",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],u.prototype,"highlightName",void 0),u=(0,r._)([(0,a.j)("esri.views.draw.support.HighlightHelper")],u);const p=u},50749:(e,t,i)=>{i.d(t,{Ru:()=>h,bA:()=>c,cM:()=>u,e7:()=>l});var r=i(19431),n=i(24568),s=i(79880),a=i(38028);function o(e,t,i,r){if(null==r||e.hasZ||(r=void 0),"point"===e.type)return e.x+=t,e.y+=i,e.hasZ&&null!=r&&(e.z+=r),e;if("multipoint"===e.type){const n=e.points;for(let e=0;e<n.length;e++)n[e]=p(n[e],t,i,r);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=i,e.ymax+=i,null!=r&&(e.zmin??=0,e.zmin+=r,e.zmax??=0,e.zmax+=r),e;const n=(0,a.nA)(e),s="polyline"===e.type?e.paths:e.rings;for(let e=0;e<n.length;e++){const s=n[e];for(let e=0;e<s.length;e++)s[e]=p(s[e],t,i,r)}return"paths"in e?e.paths=s:e.rings=s,e}function l(e,t,i,r,n){const s=e.clone(),l=r.resolution;if("point"===s.type){if(n)o(s,t*l,-i*l);else{const e=r.state.transform,n=r.state.inverseTransform,a=e[0]*s.x+e[2]*s.y+e[4],o=e[1]*s.x+e[3]*s.y+e[5];s.x=n[0]*(a+t)+n[2]*(o+i)+n[4],s.y=n[1]*(a+t)+n[3]*(o+i)+n[5]}return s}if("multipoint"===s.type){if(n)o(s,t*l,-i*l);else{const e=s.points,n=r.state.transform,a=r.state.inverseTransform;for(let r=0;r<e.length;r++){const s=e[r],o=n[0]*s[0]+n[2]*s[1]+n[4],l=n[1]*s[0]+n[3]*s[1]+n[5],c=a[0]*(o+t)+a[2]*(l+i)+a[4],h=a[1]*(o+t)+a[3]*(l+i)+a[5];e[r]=d(s,c,h,void 0)}}return s}if("extent"===s.type){if(n)o(s,t*l,-i*l);else{const e=r.state.transform,n=r.state.inverseTransform,a=e[0]*s.xmin+e[2]*s.ymin+e[4],o=e[1]*s.xmin+e[3]*s.ymin+e[5],l=e[0]*s.xmax+e[2]*s.ymax+e[4],c=e[1]*s.xmax+e[3]*s.ymax+e[5];s.xmin=n[0]*(a+t)+n[2]*(o+i)+n[4],s.ymin=n[1]*(a+t)+n[3]*(o+i)+n[5],s.xmax=n[0]*(l+t)+n[2]*(c+i)+n[4],s.ymax=n[1]*(l+t)+n[3]*(c+i)+n[5]}return s}if(n)o(s,t*l,-i*l);else{const e=(0,a.nA)(s),n="polyline"===s.type?s.paths:s.rings,o=r.state.transform,l=r.state.inverseTransform;for(let r=0;r<e.length;r++){const n=e[r];for(let e=0;e<n.length;e++){const r=n[e],s=o[0]*r[0]+o[2]*r[1]+o[4],a=o[1]*r[0]+o[3]*r[1]+o[5],c=l[0]*(s+t)+l[2]*(a+i)+l[4],h=l[1]*(s+t)+l[3]*(a+i)+l[5];n[e]=d(r,c,h,void 0)}}"paths"in s?s.paths=n:s.rings=n}return s}function c(e,t,i,r){if("point"===e.type){const{x:n,y:s}=e,a=r?r[0]:n,o=r?r[1]:s,l=e.clone(),c=(n-a)*t+a,h=(s-o)*i+o;return l.x=c,l.y=h,l}if("multipoint"===e.type){const o=(0,a.nA)(e),l=(0,n.Ue)(),[c,h,u,p]=(0,s.C6)(l,[o]),f=r?r[0]:(c+u)/2,y=r?r[1]:(p+h)/2,m=e.clone(),g=m.points;for(let e=0;e<g.length;e++){const r=g[e],[n,s]=r,a=(n-f)*t+f,o=(s-y)*i+y;g[e]=d(r,a,o,void 0)}return m}if("extent"===e.type){const{xmin:n,xmax:s,ymin:a,ymax:o}=e,l=r?r[0]:(n+s)/2,c=r?r[1]:(o+a)/2,h=e.clone();if(h.xmin=(n-l)*t+l,h.ymax=(o-c)*i+c,h.xmax=(s-l)*t+l,h.ymin=(a-c)*i+c,h.xmin>h.xmax){const e=h.xmin,t=h.xmax;h.xmin=t,h.xmax=e}if(h.ymin>h.ymax){const e=h.ymin,t=h.ymax;h.ymin=t,h.ymax=e}return h}const o=(0,a.nA)(e),l=(0,n.Ue)(),[c,h,u,p]=(0,s.C6)(l,o),f=r?r[0]:(c+u)/2,y=r?r[1]:(p+h)/2,m=e.clone(),g="polyline"===m.type?m.paths:m.rings;for(let e=0;e<o.length;e++){const r=o[e];for(let n=0;n<r.length;n++){const s=r[n],[a,o]=s,l=(a-f)*t+f,c=(o-y)*i+y;g[e][n]=d(s,l,c,void 0)}}return"paths"in m?m.paths=g:m.rings=g,m}function h(e,t,i,r,n,s){const a=Math.sqrt((i-e)*(i-e)+(r-t)*(r-t));return Math.sqrt((n-e)*(n-e)+(s-t)*(s-t))/a}function u(e,t,i,n=!1){const s=Math.atan2(t.y-i.y,t.x-i.x)-Math.atan2(e.y-i.y,e.x-i.x),a=Math.atan2(Math.sin(s),Math.cos(s));return n?a:(0,r.BV)(a)}function p(e,t,i,r){return d(e,e[0]+t,e[1]+i,null!=e[2]&&null!=r?e[2]+r:void 0)}function d(e,t,i,r){const n=[t,i];return e.length>2&&n.push(null!=r?r:e[2]),e.length>3&&n.push(e[3]),n}},58971:(e,t,i)=>{i.r(t),i.d(t,{applyTextFormattingHTML:()=>X,createFieldInfoMap:()=>Q,findRelatedLayer:()=>oe,findUtilityNetwork:()=>le,fixTokens:()=>U,formatAttributes:()=>J,formatEditInfo:()=>V,formatValueToFieldInfo:()=>j,getAllFieldInfos:()=>K,getFieldInfo:()=>z,getFieldInfoLabel:()=>E,getFixedFieldName:()=>M,getFixedFieldNames:()=>Z,getHighlightKeyForFeature:()=>ue,getSourceLayer:()=>G,graphicCallback:()=>T,htmlEntities:()=>Y,isAssociatedFeatureSupportedLayer:()=>q,isExpressionField:()=>F,isFeatureSupportedLayer:()=>H,isGraphicForRelatableFeatureSupportedLayer:()=>S,isRelatableFeatureSupportedLayer:()=>P,isRelatableLayer:()=>$,isRelatedField:()=>te,preLayerQueryCallback:()=>se,preRequestCallback:()=>ae,querySourceLayer:()=>W,queryUpdatedFeature:()=>ee,shouldOpenInNewTab:()=>k,substituteAttributes:()=>O,substituteFieldsInLinksAndAttributes:()=>A});var r=i(39994),n=i(13802),s=i(21130),a=i(72057),o=i(25741),l=i(14845),c=i(54957),h=i(44415),u=i(30879),p=i(72559);const d=()=>n.Z.getLogger("esri.widgets.Feature.support.featureUtils"),f=/href=(""|'')/gi,y=/(\{([^{\r\n]+)\})/g,m=/'/g,g=/^\s*expression\//i,v=/(\n)/gi,b=/[\u00A0-\u9999<>&]/gim,w=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,x=/^(?:mailto:|tel:)/,_="relationships/",I=(0,a.Ze)("short-date-short-time");function G(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function T({type:e,value:t,event:i}){try{return"function"==typeof t?t(i):await t}catch(r){return void d().error("error",`An error occurred when calling the "${e}" function`,{error:r,graphic:i.graphic,value:t})}}function k(e=""){if(e)return!x.test(e.trim().toLowerCase())}function F(e){return!!e&&g.test(e)}function E(e,t){const i=function(e,t){if(!t||!F(t)||!e)return;const i=t.replace(g,"").toLowerCase();return e.find((({name:e})=>e.toLowerCase()===i))}(t,e?.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function M(e,t){const i=C(t,e);return i?i.name:e}function Z(e,t){return e&&e.map((e=>M(e,t)))}function C(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function L(e){return`${e}`.trim()}function A({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:n,fieldInfoMap:s}){return r?O({formattedAttributes:t,template:D(r,{...t,...n,...e},i),fieldInfoMap:s}):""}function O({formattedAttributes:e,template:t,fieldInfoMap:i}){return L(function(e){return e.replaceAll(f,"")}((0,s.gx)((0,s.gx)(t,(e=>function(e,t){return`{${t.get(e.toLowerCase())?.fieldName||e}}`}(e,i))),e)))}function N(e,t=!1){const i={...e};return Object.keys(i).forEach((e=>function(e,t,i=!1){const r=t[e];if("string"==typeof r){const n="%27",s=(i?encodeURIComponent(r):r).replaceAll(m,n);t[e]=s}}(e,i,t))),i}function U(e,t){return e.replaceAll(y,((e,i,r)=>{const n=C(t,r);return n?`{${n.name}}`:i}))}function D(e,t,i){const r=U(e,i);return r?r.replaceAll(w,((e,i,r)=>function(e,t,i){const r=(t=L(t))&&"{"!==t[0];return(0,s.gx)(e,N(i,r||!1))}(e,i||r,t))):r}function H(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function $(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function P(e){return H(e)&&$(e)}function q(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function S(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&P(e.sourceLayer)}function j(e,t){const{fieldInfos:i,fieldName:r,preventPlacesFormatting:n,layer:s,timeZone:a}=t,c=z(i,r),u=C(s,r);if(c&&!(0,l.Ec)(r)){const t=u?.type,i=c.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||i)return(0,h.$8)(e,{format:i,fieldType:t,timeZoneOptions:{layerTimeZone:s&&"preferredTimeZone"in s?s.preferredTimeZone:null,viewTimeZone:a,datesInUnknownTimezone:!(!s||!("datesInUnknownTimezone"in s)||!s.datesInUnknownTimezone)}})}const p=c?.format;return"string"==typeof e&&(0,l.Ec)(r)&&p?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?R(e,",",", ",t):e.includes(";")?R(e,";","; ",t):e.includes(" ")?R(e," "," ",t):(0,o.uf)(Number(e),(0,o.sh)(t))}(e,p):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,p))||null==e||null==p?X(e):(0,o.uf)(e,n?{...(0,o.sh)(p),minimumFractionDigits:0,maximumFractionDigits:20}:(0,o.sh)(p))}function R(e,t,i,r){return e.trim().split(t).map((e=>(0,o.uf)(Number(e),(0,o.sh)(r)))).join(i)}function z(e,t){if(e?.length&&t)return e.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))}function V(e,t,i,r){const{creatorField:n,creationDateField:s,editorField:o,editDateField:l}=e;if(!t)return;const c=(0,p.Np)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r)||!r.datesInUnknownTimezone),i,I,"date"),h={...I,...c},u=t[l];if("number"==typeof u){const e=t[o];return{type:"edit",date:(0,a.p6)(u,h),user:e}}const d=t[s];if("number"==typeof d){const e=t[n];return{type:"create",date:(0,a.p6)(d,h),user:e}}return null}function Q(e,t){const i=new Map;if(!e)return i;for(const r of e){if(!r.fieldName)continue;const e=M(r.fieldName,t);r.fieldName=e,i.set(e.toLowerCase(),r)}return i}function K(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)?(r.forEach((e=>{if("fields"===e.type){const i=e?.fieldInfos;i&&t.push(...i)}})),t):t}function Y(e){return e.replaceAll(b,(e=>`&#${e.charCodeAt(0)};`))}function X(e){return"string"==typeof e?e.replaceAll(v,'<br class="esri-text-new-line" />'):e}function B(e){const{value:t,fieldName:i,fieldInfos:n,fieldInfoMap:s,layer:a,graphic:o,timeZone:c}=e;if(null==t)return"";const u=function({fieldName:e,value:t,graphic:i,layer:n}){if(te(e))return null;if(!n||"function"!=typeof n.getFieldDomain)return null;const s=i&&n.getFieldDomain(e,{feature:i,excludeImpliedDomains:(0,r.Z)("esri-widget-legacy-field-domain-calculation")});return s&&"coded-value"===s.type?s.getName(t):null}({fieldName:i,value:t,graphic:o,layer:a});if(u)return u;const p=function({fieldName:e,graphic:t,layer:i}){if(te(e))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const n=i.getFeatureType(t);return n?n.name:null}({fieldName:i,graphic:o,layer:a});if(p)return p;if(s.get(i.toLowerCase()))return j(t,{fieldInfos:n||Array.from(s.values()),fieldName:i,layer:a,timeZone:c});const d=a?.fieldsIndex?.get(i);return d&&((0,h.a8)(d)||(0,l.sX)(d))?(0,h.$8)(t,{fieldType:d.type,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:c,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a)||!a.datesInUnknownTimezone)}}):X(t)}function J({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:n,relatedInfos:s,timeZone:a}){const o={};return s?.forEach((t=>function({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:n,timeZone:s}){e&&t&&(t.relatedFeatures?.forEach((a=>ie({attributes:e,graphic:a,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:n,timeZone:s}))),t.relatedStatsFeatures?.forEach((a=>ie({attributes:e,graphic:a,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:n,timeZone:s}))))}({attributes:o,relatedInfo:t,fieldInfoMap:n,fieldInfos:e,layer:i,timeZone:a}))),t&&Object.keys(t).forEach((s=>{const l=t[s];o[s]=B({fieldName:s,fieldInfos:e,fieldInfoMap:n,layer:i,value:l,graphic:r,timeZone:a})})),o}async function W(e,t){const{layer:i,graphic:r,outFields:n,objectIds:s,returnGeometry:a,spatialReference:o}=e,l=s[0];if("number"!=typeof l&&"string"!=typeof l){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:i,graphic:r,objectId:l,requiredFields:n};return d().warn(e,t),null}if(!(0,c.S1)(i)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:i,graphic:r,requiredFields:n,returnGeometry:a};return d().warn(e,t),null}const h=i.createQuery();return h.objectIds=s,h.outFields=n?.length?n:[i.objectIdField],h.returnGeometry=!!a,h.returnZ=!!a,h.returnM=!!a,h.outSpatialReference=o,(await i.queryFeatures(h,t)).features[0]}async function ee({graphic:e,popupTemplate:t,layer:i,spatialReference:r},n){if(!i||!t)return;if("function"==typeof i.load&&await i.load(n),!e.attributes)return;const s=i.objectIdField,a=e.attributes[s];if(null==a)return;const o=[a],c=await t.getRequiredFields(i.fieldsIndex),h=(0,l.R9)(c,e),p=h?[]:c.includes(s)?c:[...c,s],d=t.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,u.LC)(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)}(t);if(h&&!d)return;const f=await W({layer:i,graphic:e,outFields:p,objectIds:o,returnGeometry:d,spatialReference:r},n);f&&(f.geometry&&(e.geometry=f.geometry),f.attributes&&(e.attributes={...e.attributes,...f.attributes}))}function te(e=""){return!!e&&e.includes(_)}function ie({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:n,layer:s,timeZone:a}){e&&t&&i&&Object.keys(t.attributes).forEach((o=>{const l=function(e){return`${_}${e.layerId}/${e.fieldName}`}({layerId:i.relation.id.toString(),fieldName:o}),c=t.attributes[o];e[l]=B({fieldName:l,fieldInfos:r,fieldInfoMap:n,layer:s,value:c,graphic:t,timeZone:a})}))}const re=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ne=({layer:e,method:t,query:i,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||"attachments"===t)return;const n=null!=i.where?i.where:null,s=null!=i.geometry?i.geometry:null;re(r)||re(n)||"extent"===s?.type||"tile"===i.resultType||(i.cacheHint=!0)},se=({query:e,layer:t,method:i})=>{ne({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},ae=({queryPayload:e,layer:t,method:i})=>{ne({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})};function oe(e,t,i){return e&&t&&i?"sublayer"===t.type?he({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:i})||he({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:i}):he({layers:e.allLayers,map:e,relatedLayer:t,relationship:i})||he({layers:e.allTables,map:e,relatedLayer:t,relationship:i}):null}function le(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find((e=>e.isUtilityLayer(t))):null}function ce(e,t){return e?.allTables.find((e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url))}function he({map:e,relationship:t,relationship:{relatedTableId:i},relatedLayer:r,layers:n}){if(!n)return null;for(const s of n){if("map-image"===s.type){const i=he({layers:s.sublayers,map:e,relatedLayer:r,relationship:t})||he({layers:s.subtables,map:e,relatedLayer:r,relationship:t});if(i)return i;continue}if(!P(s))continue;if("sublayer"===r.type){if(s!==r&&s.id===i)return s.isTable?ce(e,s):s;continue}const n="scene"===r.type&&r.associatedLayer?r.associatedLayer.url:r.url;if(!n)return null;if("sublayer"!==s.type){if(s!==r&&s.url===n&&s.layerId===i)return s}else if(s!==r&&s.layer?.url===n&&s.id===i)return s.isTable?ce(e,s):s}return null}function ue(e){const t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}}}]);