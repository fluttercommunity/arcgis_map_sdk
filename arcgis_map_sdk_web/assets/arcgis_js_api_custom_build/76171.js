"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[76171,29258],{29258:(e,t,i)=>{i.r(t),i.d(t,{QueueProcessor:()=>c});var o=i(61681),s=i(78668),r=i(58713),a=i(20230),n=i(17262),l=i(18809);class u{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class c{constructor(e){this._schedule=null,this._deferreds=new a.Z,this._controllers=new a.Z,this._processingItems=new a.Z,this._pausedSignal=(0,l.t)(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new r.Z(e.peeker),this.process=e.process}destroy(){this.clear(),this._schedule=(0,o.hw)(this._schedule)}get updating(){return this.running}get length(){return this._processingItems.size+this._queue.length}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach((t=>e.push(t))),this._controllers.clear(),e.forEach((e=>e.abort())),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach(((t,i)=>e(i)))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const i=this.get(e);if(i)return i;const o=new AbortController;let r=null;t&&(r=(0,s.fu)(t,(()=>o.abort())));const a=()=>{n.remove(),null!=r&&r.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},n=(0,s.$F)(o.signal,(()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),a(),l.reject((0,s.zE)())})),l=(0,s.hh)();return this._deferreds.set(e,l),this._controllers.set(e,o),l.promise.then(a,a),this._queue.push(e),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject((0,s.zE)()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._pausedSignal.value||this._schedule||(this._schedule=(0,n.Os)((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const i=new AbortController,o=new u(e,i);this._processingItems.set(e,o);try{t=this.process(e,i.signal)}catch(e){this._processError(o,e)}(0,s.y8)(t)?(o.promise=t,t.then((e=>this._processResult(o,e)),(e=>this._processError(o,e)))):this._processResult(o,t)}}},39943:(e,t,i)=>{i.d(t,{Y6:()=>a,ZO:()=>l,Zs:()=>n,gb:()=>s,m6:()=>r,r1:()=>o});const o="__esri_stream_id__",s="__esri_timestamp__",r="__esri_track_part__",a="__esri_time_received__",n="__esri_track_line__";var l;!function(e){e[e.TrackLine=0]="TrackLine",e[e.LatestObservation=1]="LatestObservation",e[e.PreviousObservation=2]="PreviousObservation"}(l||(l={}))},31756:(e,t,i)=>{i.d(t,{P:()=>s});var o=i(39994);const s=new class{get forceStaticPath(){return"disabled"===(0,o.Z)("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===(0,o.Z)("esri-cim-animations-enable-status")}get freezeGlobalTime(){return(0,o.Z)("esri-cim-animations-freeze-time")??!1}get spotlightAnimatedSymbols(){return!!(0,o.Z)("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==(0,o.Z)("esri-cim-animations-freeze-time")}}},88013:(e,t,i)=>{i.d(t,{Ht:()=>o,QS:()=>a,jL:()=>r});const o=8388607,s=8388608,r=e=>e&o;function a(e,t){return((t?s:0)|e)>>>0}},98708:(e,t,i)=>{var o;i.d(t,{E5:()=>h,NE:()=>p,l_:()=>o}),function(e){e.Local="Local",e.Global="Global"}(o||(o={}));class s{generateSource(e){const t=[];for(let i=1;i<this.length;i++)t.push(`vec4 atom${i} = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;");for(let e=0;e<this.ins;e++)t.push("top--;"),t.push(`vec4 in${this.ins-e-1} = stack[top];`);for(let e=0;e<this.outs;e++)t.push(`vec4 out${e};`);const{microcode:i}=this;for(const e of i)t.push(e);for(let e=0;e<this.outs;e++)t.push(`stack[top] = out${e};`),t.push("top++;"),t.push(`if (top >= ${d}) { top = ${d-1}; }`);return t}}let r=128;function a(e){return[`float duration = clamp(${e.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${e.startTimeOffset};`,`float repeatDelay = ${e.repeatDelay};`,`float timeOriginSelector = ${e.timeOriginSelector};`,`float repeatType = ${e.repeatType};`,`float easing = ${e.easing};`,`float playAnimation = ${e.playAnimation} * (1.0 - step(0.0, -${e.duration}));`,`float reverseAnimation = ${e.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${e.out} = oscillate ? 1.0 - of : of;`]}const n={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},l={Loop:1,None:2,Oscillate:3},u={Local:1,Global:2};function c(e){const t=n[e.easing],i=l[e.repeatType],o=u[e.timeOriginSelector];return[[e.duration,e.startTimeOffset,e.repeatDelay,o],[i,t,e.playAnimation,e.reverseAnimation]]}const p={scalar:new class extends s{constructor(){super(...arguments),this.opcode=++r,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(e){return[[this.opcode,e,0,0]]}},vector3:new class extends s{constructor(){super(...arguments),this.opcode=++r,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(e){return[[this.opcode,e[0]||0,e[1]||0,e[2]||0]]}},vector4:new class extends s{constructor(){super(...arguments),this.opcode=++r,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(e){return[[this.opcode,0,0,0],e]}},animatedTransform:new class extends s{constructor(){super(...arguments),this.opcode=++r,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...a({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...a({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...a({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;","\n    vec2 translation = vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 = vec4(translation, rotation, scale);"]}encode(e){return[[this.opcode,0,0,0],[e.translation.from[0],e.translation.from[1],e.translation.to[0],e.translation.to[1]],[e.rotation.from,e.rotation.to,e.scale.from,e.scale.to],...c(e.translation.timing),...c(e.rotation.timing),...c(e.scale.timing),[e.relativeTranslation?1:0,e.absoluteScale?1:0,0,0]]}},animatedColor:new class extends s{constructor(){super(...arguments),this.opcode=++r,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...a({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...a({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(e){return[[this.opcode,e.opacity.from,e.opacity.to,0],[e.color.from[0],e.color.from[1],e.color.from[2],e.color.from[3]],[e.color.to[0],e.color.to[1],e.color.to[2],e.color.to[3]],...c(e.color.timing),...c(e.opacity.timing)]}},ret:new class extends s{constructor(){super(...arguments),this.opcode=++r,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}},d=4;function h(e){const t=[];t.push(`float globalTime = ${e.globalTime};`),t.push(`float localTimeOrigin = ${e.localTimeOrigin};`),t.push(`vec2 pointer = ${e.animationPointer};`),t.push(`vec2 size = ${e.animationTextureSize};`),t.push("int top = 0;"),t.push(`vec4 stack[${d}];`),t.push("for (int counter = 0; counter < 40; counter++) {"),t.push(`vec4 atom0 = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;"),t.push(`vec2 pixelDimensions = ${e.pixelDimensions};`),t.push("if (false) {");for(const i in p){const o=p[i];t.push(`} else if (int(atom0.x) == ${o.opcode}) {`);for(const i of o.generateSource(e))t.push(i)}return t.push("} // End if-else."),t.push("} // End for."),t.push(`${e.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),t.join("\n")}},79349:(e,t,i)=>{i.d(t,{K:()=>n});var o=i(78951),s=(i(18567),i(39994),i(6174),i(91907)),r=(i(43106),i(43487),i(29620)),a=i(27555);class n{constructor(e,t){this._boundPart=null,this.vertexBuffers=new Map,this.indexBuffers=new Map,this.groups=[];for(const i in t.vertex){const{data:r,attributes:a}=t.vertex[i],n=o.f.createVertex(e,s.l1.STATIC_DRAW,r);this.vertexBuffers.set(i,{buffer:n,attributes:a})}for(const i in t.index){const{data:r}=t.index[i],a=o.f.createIndex(e,s.l1.STATIC_DRAW,r);this.indexBuffers.set(i,{buffer:a})}for(const e of t.groups)this.groups.push({...e,vertexArrays:new Map});this.parts=t.parts}bind(e,t,i){this._boundPart=i;const{group:o}=this.parts[this._boundPart],s=this.groups[o];if(!s)throw new Error(`Missing group ${o}.`);let a=s.vertexArrays.get(t.stringHash);if(!a){const i=new Set(t.locations.keys()),o=s.index?this.indexBuffers.get(s.index)?.buffer:null,n=new Map,l=new Map;for(const[e,{buffer:t,attributes:o}]of this.vertexBuffers){const s=o.filter((e=>i.has(e.name)));s.length>0&&(n.set(e,s),l.set(e,t))}a=new r.U(e,t.locations,n,l,o),s.vertexArrays.set(t.stringHash,a)}e.bindVAO(a)}draw(e){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:t,count:i}=this.parts[this._boundPart],{group:o}=this.parts[this._boundPart],{primitive:s,index:r}=this.groups[o];if(r){const o=this.indexBuffers.get(r);if(!o)throw new Error(`Missing index buffer "${r}".`);const{indexType:n}=o.buffer;if(!n)throw new Error("Buffer type error.");e.drawElements(s,i,n,t*a.f[n])}else e.drawArrays(s,t,i)}unbind(e){this._boundPart=null,e.bindVAO(null)}destroy(){for(const{vertexArrays:e}of this.groups)for(const[t,i]of e)i.disposeVAOOnly();for(const{buffer:e}of this.vertexBuffers.values())e.dispose();for(const{buffer:e}of this.indexBuffers.values())e.dispose()}}},88144:(e,t,i)=>{i.d(t,{A:()=>l});var o=i(27555),s=i(79349),r=i(91907),a=i(41163);const n={position:{type:r.g.SHORT,count:2}};class l extends s.K{static create(e,t){const i=[];let{stride:s}=t;if(null==s){s=0;for(const[e,{count:i,type:r,offset:a}]of Object.entries(t.layout)){if(null!=a)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");s+=i*o.f[r]}}let r=0;for(const[e,{count:n,offset:l,type:u,normalized:c}]of Object.entries(t.layout)){null!=l&&(r=l);const t=new a.G(e,n,u,r,s,null!=c&&c,0);i.push(t),r+=n*o.f[u]}const n={primitive:t.primitive};null!=t.index&&(n.index="indexData");let{count:u}=t;if(null==u&&(u=t.index?t.index.length:t.vertex.byteLength/s,Math.floor(u)!==u))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${s}.`);const c={start:0,count:u,group:0,primitive:t.primitive},p={vertex:{vertexData:{data:t.vertex,attributes:i}},parts:[c],groups:[n]};return null!=t.index&&(p.index={indexData:{data:t.index}}),new l(e,p,t.layout)}static fromVertexStream(e,t){return l.create(e,{primitive:r.MX.TRIANGLE_STRIP,vertex:new Uint16Array(t),layout:n})}constructor(e,t,i){super(e,t),this._spec=i}bind(e,t,i=0){super.bind(e,t,i)}}},27555:(e,t,i)=>{i.d(t,{f:()=>s});var o=i(91907);const s={[o.g.BYTE]:1,[o.g.UNSIGNED_BYTE]:1,[o.g.SHORT]:2,[o.g.UNSIGNED_SHORT]:2,[o.g.HALF_FLOAT]:2,[o.g.INT]:4,[o.g.UNSIGNED_INT]:4,[o.g.FLOAT]:4}},39893:(e,t,i)=>{i.d(t,{k2:()=>Wt,IG:()=>jt,W4:()=>Jt});var o=i(38716),s=i(36118),r=i(36663),a=i(31756),n=i(89461),l=i(77524),u=i(98708);class c extends n.oo{}(0,r._)([(0,n.e5)(l.bv)],c.prototype,"globalTime",void 0),(0,r._)([(0,n.e5)(l.Sg)],c.prototype,"animationTextureSize",void 0),(0,r._)([(0,n.e5)(l.Eg)],c.prototype,"animationTexture",void 0),(0,r._)([(0,n.e5)(l.Tu)],c.prototype,"toScreen",void 0),(0,r._)([(0,n.e5)(l.Tu)],c.prototype,"toNdc",void 0),(0,r._)([(0,n.e5)(l.bv)],c.prototype,"mapRotation",void 0),(0,r._)([(0,n.e5)(l.bv)],c.prototype,"pixelRatio",void 0);var p=i(14266),d=i(39994),h=i(22070);class m extends n.oo{getVisualVariableData(e){if(!this._vvData){const t=this.getAttributeDataCoords(e);this._vvData=(0,l.ig)(this.visualVariableData,t).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(e){if(!this._uv){const t=(0,h.Wv)(e),i=this.size,o=(0,l.e$)(t.x),s=(0,l.e$)(t.y).multiply((0,l.e$)(256)),r=(0,l.e$)(t.z).multiply((0,l.e$)(256)).multiply((0,l.e$)(256)),a=(0,l.fz)(o.add(s).add(r)),n=(0,l.wQ)(a,i),u=a.subtract(n).divide(i);this._uv=new l.Sg(n,u).add(.5).divide(i)}return this._uv}getFilterData(e){const t=this.getAttributeDataCoords(e);return(0,l.ig)(this.filterFlags,t).setDebugName("storage0")}getAnimationData(e){const t=this.getAttributeDataCoords(e);return(0,l.ig)(this.animation,t).setDebugName("storage1")}getVVData(e){return this.getVisualVariableData(e)}getDataDrivenData0(e){const t=this.getAttributeDataCoords(e);return(0,l.ig)(this.dataDriven0,t).setDebugName("storage30")}getDataDrivenData1(e){const t=this.getAttributeDataCoords(e);return(0,l.ig)(this.dataDriven1,t).setDebugName("storage31")}getDataDrivenData2(e){const t=this.getAttributeDataCoords(e);return(0,l.ig)(this.dataDriven2,t).setDebugName("storage32")}getGPGPUData(e){const t=this.getAttributeDataCoords(e);return(0,l.ig)(this.gpgpu,t).setDebugName("storage4")}getLocalTimeOrigin(e){const t=this.getAttributeDataCoords(e);return(0,l.ig)(this.localTimeOrigin,t).x.setDebugName("storage5")}getFilterFlags(e){return(0,d.Z)("webgl-ignores-sampler-precision")?(0,l.mD)(this.getFilterData(e).x.multiply((0,l.fz)(255))):this.getFilterData(e).x.multiply((0,l.fz)(255))}getLabelVisibility(e){const t=this.getFilterData(e).y.multiply(255);return new l.bv(1).subtract(t)}getAnimationValue(e){return this.getAnimationData(e).x}getSizeValue(e){return this.getVisualVariableData(e).x}getColorValue(e){return this.getVisualVariableData(e).y}getOpacityValue(e){return this.getVisualVariableData(e).z}getRotationValue(e){return this.getVisualVariableData(e).w}}(0,r._)([(0,n.e5)(l.Eg)],m.prototype,"filterFlags",void 0),(0,r._)([(0,n.e5)(l.Eg)],m.prototype,"animation",void 0),(0,r._)([(0,n.e5)(l.Eg)],m.prototype,"gpgpu",void 0),(0,r._)([(0,n.e5)(l.Eg)],m.prototype,"localTimeOrigin",void 0),(0,r._)([(0,n.e5)(l.Eg)],m.prototype,"visualVariableData",void 0),(0,r._)([(0,n.e5)(l.Eg)],m.prototype,"dataDriven0",void 0),(0,r._)([(0,n.e5)(l.Eg)],m.prototype,"dataDriven1",void 0),(0,r._)([(0,n.e5)(l.Eg)],m.prototype,"dataDriven2",void 0),(0,r._)([(0,n.e5)(l.bv)],m.prototype,"size",void 0);class f extends n.oo{}(0,r._)([(0,n.e5)(l.bv)],f.prototype,"activeReasons",void 0),(0,r._)([(0,n.e5)(l.bv)],f.prototype,"highlightAll",void 0);class v extends n.oo{}(0,r._)([(0,n.e5)(l.Sg)],v.prototype,"position",void 0),(0,r._)([(0,n.e5)(l.bv)],v.prototype,"distance",void 0),(0,r._)([(0,n.e5)(l.bv)],v.prototype,"smallSymbolDistance",void 0),(0,r._)([(0,n.e5)(l.bv)],v.prototype,"smallSymbolSizeThreshold",void 0);class y extends n.oo{}(0,r._)([(0,n.e5)(l.Tu)],y.prototype,"displayViewScreenMat3",void 0),(0,r._)([(0,n.e5)(l.Tu)],y.prototype,"displayViewMat3",void 0),(0,r._)([(0,n.e5)(l.Tu)],y.prototype,"displayMat3",void 0),(0,r._)([(0,n.e5)(l.Tu)],y.prototype,"viewMat3",void 0),(0,r._)([(0,n.e5)(l.Tu)],y.prototype,"tileMat3",void 0),(0,r._)([(0,n.e5)(l.bv)],y.prototype,"displayZoomFactor",void 0),(0,r._)([(0,n.e5)(l.bv)],y.prototype,"requiredZoomFactor",void 0),(0,r._)([(0,n.e5)(l.Sg)],y.prototype,"tileOffset",void 0),(0,r._)([(0,n.e5)(l.bv)],y.prototype,"currentScale",void 0),(0,r._)([(0,n.e5)(l.bv)],y.prototype,"currentZoom",void 0),(0,r._)([(0,n.e5)(l.bv)],y.prototype,"metersPerSRUnit",void 0),(0,r._)([(0,n.e5)(l.bv)],y.prototype,"rotation",void 0),(0,r._)([(0,n.e5)(l.bv)],y.prototype,"pixelRatio",void 0);class b extends n.Pz{}(0,r._)([(0,n.xh)(0,l.AO)],b.prototype,"id",void 0),(0,r._)([(0,n.xh)(1,l.bv)],b.prototype,"bitset",void 0),(0,r._)([(0,n.xh)(2,l.Sg)],b.prototype,"pos",void 0);class g extends n.yu{}(0,r._)([(0,n.xh)(14,l.Sg)],g.prototype,"nextPos1",void 0),(0,r._)([(0,n.xh)(15,l.Sg)],g.prototype,"nextPos2",void 0);class x extends n.XB{}class w extends n.ri{clip(e,t){let i=new l.bv(0);const o=this.storage.getFilterFlags(e);if(i=i.add((0,l.fz)(2).multiply((0,l.fz)(1).subtract((0,h.bG)(o,0)))),this.inside?i=i.add((0,l.fz)(2).multiply((0,l.fz)(1).subtract((0,h.bG)(o,1)))):this.outside?i=i.add((0,l.fz)(2).multiply((0,h.bG)(o,1))):this.highlight&&(i=i.add((0,l.fz)(2).multiply((0,l.fz)(1).subtract(this._checkHighlight(o))))),null!=t){const e=new l.bv(1).subtract((0,l.Nb)(t.x,this.view.currentZoom)),o=(0,l.Nb)(t.y,this.view.currentZoom);i=i.add(new l.bv(2).multiply(e.add(o)))}return i}getFragmentOutput(e,t,i=new l.bv(1/255)){const o=new n.Qt;return o.fragColor=this._maybeWriteHittest(t)??this._maybeHighlight(e,i)??e,o}_maybeHighlight(e,t){return this.highlight?new l.T8(e.rgb,(0,l.Nb)(t,e.a)):null}_checkHighlight(e){let t=this._checkHighlightBit(e,0);for(let i=1;i<p.IZ;i++)t=t.add(this._checkHighlightBit(e,i));return(0,l.Nb)(new l.bv(.1),t.add(this.highlight.highlightAll))}_checkHighlightBit(e,t){return(0,h.hG)(e,t).multiply((0,h.qD)(this.highlight.activeReasons,t))}maybeRunHittest(e,t,i){if(null==this.hittestRequest)return null;const o=this.hittest(e,t,i);let s=(0,l.KJ)((0,l.tS)(o,this.hittestRequest.distance),new l.bv(2),new l.bv(0));const r=this.storage.getAttributeDataCoords(e.id),a=(0,h.pK)(r);s=s.add(this.clip(e.id,e.zoomRange));const n=new l.T8(new l.bv(1/255),0,0,0);return{glPointSize:new l.bv(1),glPosition:new l.T8(a,s,1),color:n}}_maybeWriteHittest(e){return null!=this.hittestRequest?e.color:null}}(0,r._)([n.Ou],w.prototype,"inside",void 0),(0,r._)([n.Ou],w.prototype,"outside",void 0),(0,r._)([(0,n.Kw)(f)],w.prototype,"highlight",void 0),(0,r._)([(0,n.e5)(m)],w.prototype,"storage",void 0),(0,r._)([(0,n.e5)(y)],w.prototype,"view",void 0),(0,r._)([(0,n.Kw)(v)],w.prototype,"hittestRequest",void 0);var S,_=i(44255);class V extends n.oo{}(0,r._)([(0,n.e5)(l.Sg)],V.prototype,"size",void 0),(0,r._)([(0,n.e5)(l.Eg)],V.prototype,"texture",void 0);class z extends n.oo{getColor(e,t,i){return(0,l.wV)([(0,l.or)((0,h.In)(e),i),t],[(0,l.Iz)(e,this.values.first()),this.colors.first()],[(0,l.r7)(e,this.values.last()),this.colors.last()],[!0,()=>{const t=this.values.findIndex((t=>(0,l.tS)(t,e))),i=this.values.get(t),o=t.subtract(1),s=this.values.get(o),r=e.subtract(s).divide(i.subtract(s));return(0,l.CD)(this.colors.get(o),this.colors.get(t),r)}])}}(0,r._)([(0,n.e5)(l.v8.ofType(l.T8,8))],z.prototype,"colors",void 0),(0,r._)([(0,n.e5)(l.v8.ofType(l.bv,8))],z.prototype,"values",void 0);class T extends n.oo{getOpacity(e){return(0,l.wV)([(0,h.In)(e),new l.bv(1)],[(0,l.Iz)(e,this.opacityValues.first()),this.opacities.first()],[(0,l.r7)(e,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const t=this.opacityValues.findIndex((t=>(0,l.tS)(t,e))),i=this.opacityValues.get(t),o=t.subtract(1),s=this.opacityValues.get(o),r=e.subtract(s).divide(i.subtract(s));return(0,l.CD)(this.opacities.get(o),this.opacities.get(t),r)}])}}(0,r._)([(0,n.e5)(l.v8.ofType(l.bv,8))],T.prototype,"opacities",void 0),(0,r._)([(0,n.e5)(l.v8.ofType(l.bv,8))],T.prototype,"opacityValues",void 0);class O extends n.oo{getVVRotationMat4(e){return(0,l.KJ)((0,h.In)(e),l.yb.identity(),(()=>{const t=this.getNormalizedAngle(e).multiply(_.nF),i=(0,l.O$)(t),o=(0,l.mC)(t);return new l.yb(o,i,0,0,i.multiply(new l.bv(-1)),o,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(e){return(0,l.KJ)((0,h.In)(e),l.Tu.identity(),(()=>{const t=this.getNormalizedAngle(e).multiply(_.nF),i=(0,l.O$)(t),o=(0,l.mC)(t);return new l.Tu(o,i,0,i.multiply(new l.bv(-1)),o,0,0,0,1)}))}getNormalizedAngle(e){const t=(0,l.ln)(this.rotationType,new l.bv(_.MO.Arithmatic));return(0,l.KJ)(t,new l.bv(90).subtract(e),e)}}(0,r._)([(0,n.e5)(l.bv)],O.prototype,"rotationType",void 0);class A extends n.oo{getSize(e,t){const i=this.minMaxValueAndSize.xy,o=this.minMaxValueAndSize.zw;return(0,l.KJ)((0,h.In)(e),t,(()=>{const t=e.subtract(i.x).divide(i.y.subtract(i.x)),s=(0,l.uZ)(t,new l.bv(0),new l.bv(1));return o.x.add(s.multiply(o.y.subtract(o.x)))}))}}(0,r._)([(0,n.e5)(l.T8)],A.prototype,"minMaxValueAndSize",void 0);class P extends n.oo{getSizeForViewScale(e){return(0,l.wV)([(0,l.Iz)(e,this.values.first()),this.sizes.first()],[(0,l.r7)(e,this.values.last()),this.sizes.last()],[!0,()=>{const t=this.values.findIndex((t=>(0,l.tS)(t,e))),i=this.values.get(t),o=t.subtract(1),s=this.values.get(o),r=e.subtract(s).divide(i.subtract(s));return(0,l.CD)(this.sizes.get(o),this.sizes.get(t),r)}])}}(0,r._)([(0,n.e5)(l.v8.ofType(l.bv,8))],P.prototype,"sizes",void 0),(0,r._)([(0,n.e5)(l.v8.ofType(l.bv,8))],P.prototype,"values",void 0);class C extends n.oo{getSize(e,t){const i=(0,l.wV)([(0,h.In)(e),t],[(0,l.Iz)(e,this.values.first()),this.sizes.first()],[(0,l.r7)(e,this.values.last()),this.sizes.last()],[!0,()=>{const t=this.values.findIndex((t=>(0,l.tS)(t,e))),i=this.values.get(t),o=t.subtract(1),s=this.values.get(o),r=e.subtract(s).divide(i.subtract(s));return(0,l.CD)(this.sizes.get(o),this.sizes.get(t),r)}]);return(0,l.KJ)((0,h.In)(i),t,i)}}(0,r._)([(0,n.e5)(l.v8.ofType(l.bv,8))],C.prototype,"sizes",void 0),(0,r._)([(0,n.e5)(l.v8.ofType(l.bv,8))],C.prototype,"values",void 0);class D extends n.oo{getSize(e,t){return(0,l.KJ)((0,h.In)(e),t,e.multiply(this.unitValueToPixelsRatio))}}function R(e){return null!=e.visualVariableSizeMinMaxValue||null!=e.visualVariableSizeScaleStops||null!=e.visualVariableSizeStops||null!=e.visualVariableSizeUnitValue}function M(e,t,i){if(R(e)){const o=e.storage.getSizeValue(t);return e.visualVariableSizeMinMaxValue?.getSize(o,i)??e.visualVariableSizeScaleStops?.getSizeForViewScale(e.view.currentScale)??e.visualVariableSizeStops?.getSize(o,i)??e.visualVariableSizeUnitValue?.getSize(o,i)}return i}function I(e,t,i,o=new l.tW(!1)){if(null==e.visualVariableColor)return i;const s=e.storage.getColorValue(t);return e.visualVariableColor.getColor(s,i,o)}function F(e,t){if(null==e.visualVariableOpacity)return new l.bv(1);const i=e.storage.getOpacityValue(t);return e.visualVariableOpacity.getOpacity(i)}function E(e,t){if(null==e.visualVariableRotation)return l.Tu.identity();const i=e.storage.getRotationValue(t);return e.visualVariableRotation.getVVRotationMat3(i)}(0,r._)([(0,n.e5)(l.bv)],D.prototype,"unitValueToPixelsRatio",void 0);class H extends b{}(0,r._)([(0,n.xh)(3,l.T8)],H.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0),(0,r._)([(0,n.xh)(4,l.Sg)],H.prototype,"zoomRange",void 0);class k extends x{}class L extends w{_getScreenPosition(e){const{pos:t,translation:i,rotation:o,scale:s,offset:r,id:a,vvScale:n}=e,u=function(e,t){if(null==e.visualVariableRotation)return new l.bv(0);const i=e.storage.getRotationValue(t);return e.visualVariableRotation.getNormalizedAngle(i)}(this,a).multiply(Math.PI/180),c=i.x.multiply(4/3),p=i.y.multiply(-1).multiply(4/3),d=(0,l.O$)(u),h=(0,l.mC)(u),m=h.multiply(c).add((0,l.tk)(d).multiply(p)),f=d.multiply(c).add(h.multiply(p)),v=(0,l.O$)(o.subtract(u)),y=(0,l.mC)(o.subtract(u)),b=new l.bv(0),g=new l.bv(1),{pixelRatio:x}=this.animationInfo,w=new l.Tu(g,b,b,b,g,b,m.multiply(x),f.multiply(x),g),S=new l.Tu(y,v.multiply(-1),b,v,y,b,0,0,g),_=s.multiply(n).multiply(x).multiply(4/3),V=S.multiply(_),z=this.animationInfo.toScreen.multiply(new l.AO(t,1)),T=w.multiply(z).xy,O=V.multiply(new l.AO(r,0)).xy;return T.add(O)}_clip(e,t){let i=super.clip(e,t);const o=(0,l.Iz)(this._getLocalTimeOrigin(e),new l.bv(0));return a.P.forceGlobalTimeOrigin||(i=i.add((0,l.wV)([o,()=>new l.bv(2)],[!0,()=>new l.bv(0)]))),i}_getLocalTimeOrigin(e){return this.storage.getLocalTimeOrigin(e)}_toNdc(e){return this.animationInfo.toNdc.multiply(new l.AO(e,1)).xy}_getEvalParams(e,t){const{globalTime:i,animationTextureSize:o,animationTexture:s}=this.animationInfo;return{globalTime:i,localTimeOrigin:this._getLocalTimeOrigin(e.id),animationTextureSize:o,animationTexture:s,pixelDimensions:t}}_getColor(e,t){return(0,l.KJ)((0,l.ln)(t.isSDF,new l.bv(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return(0,l.ig)(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){const i=(0,l.ig)(this.mosaicInfo.texture,e),o=new l.bv(.5).subtract((0,h.JH)(i)).multiply(t.distanceToPx).multiply(_.nU),s=(0,l.uZ)(new l.bv(.5).subtract(o),new l.bv(0),new l.bv(1)),r=t.color.multiply(s),a=t.outlineSize.multiply(.5),n=(0,l.Wn)(o).subtract(a),u=(0,l.uZ)(new l.bv(.5).subtract(n),new l.bv(0),new l.bv(1)),c=t.outlineColor.multiply(u);return new l.bv(1).subtract(c.a).multiply(r).add(c)}}function q(e,t,i){const o=e.add(new l.Sg(t,0)),s=(0,l.ig)(i.animationTexture,o.add(.5).divide(i.animationTextureSize)).xy;return e=e.add(s),(0,l.Ge)({animationPointer:e,...i},l.T8,null,(e=>{const{out:t}=e;if(!t)throw new Error("out is null");return(0,u.E5)({...e,out:t})}))}(0,r._)([(0,n.e5)(V)],L.prototype,"mosaicInfo",void 0),(0,r._)([(0,n.e5)(c)],L.prototype,"animationInfo",void 0),(0,r._)([(0,n.Kw)(z)],L.prototype,"visualVariableColor",void 0),(0,r._)([(0,n.Kw)(T)],L.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,n.Kw)(A)],L.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,n.Kw)(P)],L.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,n.Kw)(C)],L.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,n.Kw)(D)],L.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,n.Kw)(O)],L.prototype,"visualVariableRotation",void 0),function(e){e[e.transform=0]="transform",e[e.fromColor=1]="fromColor",e[e.toColor=2]="toColor",e[e.colorMix=3]="colorMix",e[e.toOpacity=4]="toOpacity",e[e.opacityMix=5]="opacityMix"}(S||(S={}));var N=i(70080);function K(e,t,i){const o=i.subtract(t),s=function(e,t){return(0,l.AK)(e,(0,l.Fv)(t))}(e.subtract(t),o),r=(0,l.uZ)(s.divide((0,l.kE)(o)),new l.bv(0),new l.bv(1));return(0,l.TE)(e,t.add(r.multiply(i.subtract(t))))}function B(e){const t=(0,l.Wn)(e);return(0,l.Nb)(t.x.add(t.y).add(t.z),new l.bv(1.05))}function U(e,t,i,o){const s=new l.Tu(i.x.multiply(o.y).subtract(o.x.multiply(i.y)),o.x.multiply(t.y).subtract(t.x.multiply(o.y)),t.x.multiply(i.y).subtract(i.x.multiply(t.y)),i.y.subtract(o.y),o.y.subtract(t.y),t.y.subtract(i.y),o.x.subtract(i.x),t.x.subtract(o.x),i.x.subtract(t.x)),r=t.x.multiply(i.y.subtract(o.y)),a=i.x.multiply(o.y.subtract(t.y)),n=o.x.multiply(t.y.subtract(i.y)),u=r.add(a).add(n);return new l.bv(1).divide(u).multiply(s.multiply(new l.AO(1,e)))}function Z(e,t,i,o){return(0,l.ln)(B(U(e,t,i,o)),new l.bv(1))}function $(e,t,i,o){const s=i.subtract(t),r=o.subtract(t),a=(0,h.xQ)(s,r),n=(0,l.xD)((0,l.Qj)(a,new l.bv(_.T5)),(0,l.tS)(a,new l.bv(-.05)));return(0,l.wV)([(0,l.xD)((0,l.ff)(n),Z(e.xy,t,i,o)),new l.bv(-1)],[!0,()=>{const s=K(e,t,i),r=K(e,i,o),a=K(e,o,t);return(0,l.VV)((0,l.VV)(s,r),a)}])}function G(e){return e.distance.add(1)}function W(e,t,i){const{viewMat3:o,tileMat3:s}=e.view,r=o.multiply(s),a=r.multiply(new l.AO(t.pos,1)),n=r.multiply(new l.AO(i.nextPos1,1)),u=r.multiply(new l.AO(i.nextPos2,1));return $(e.hittestRequest.position,a.xy,n.xy,u.xy)}class J extends H{}(0,r._)([(0,n.xh)(5,l.Sg)],J.prototype,"offset",void 0),(0,r._)([(0,n.xh)(6,l.Sg)],J.prototype,"uv",void 0),(0,r._)([(0,n.xh)(7,l.T8)],J.prototype,"sizing",void 0),(0,r._)([(0,n.xh)(8,l.bv)],J.prototype,"angle",void 0);class j extends n.yu{}(0,r._)([(0,n.xh)(12,l.Sg)],j.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,n.xh)(13,l.Sg)],j.prototype,"offsetNextVertex2",void 0),(0,r._)([(0,n.xh)(14,l.Sg)],j.prototype,"textureUVNextVertex1",void 0),(0,r._)([(0,n.xh)(15,l.Sg)],j.prototype,"textureUVNextVertex2",void 0);function X(e,t,i,o){return t.multiply(e.x).add(i.multiply(e.y)).add(o.multiply(e.z))}class Q extends L{constructor(){super(...arguments),this.type="AnimatedMarkerShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}_vertexPreamble(e){const{id:t,pos:i,offset:o,animationPointerAndBaseSizeAndReferenceSize:s,uv:r,sizing:a,angle:n}=e,u=s.xy,c=s.z,p=s.w,d=a.xy,m=a.z,f=(0,h.qD)(e.bitset,N.m.bitset.isStroke),v=a.w,y=(0,h.qD)(e.bitset,N.m.bitset.scaleSymbolsProportionally),b=this._getEvalParams(e,d),g=q(u,S.transform,b),x=(0,l.wV)([(0,l.ln)((0,h.qD)(e.bitset,N.m.bitset.isMapAligned),new l.bv(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new l.bv(0)]),w=new l.hk((0,l.mC)(x),(0,l.O$)(x.multiply(-1)),(0,l.O$)(x),(0,l.mC)(x)).multiply(g.xy),V=g.z.subtract(x).subtract(n.multiply(_.e4)),z=g.w,T=(0,h.qD)(e.bitset,N.m.bitset.isSDF),O=M(this,t,new l.bv(p)).divide(new l.bv(p));return{baseSize:c,animationPointer:u,strokeWidth:m,isOutline:f,unscaledDistanceToPx:v,scaleSymbolsProportionally:y,isSDF:T,position:this._getScreenPosition({id:t,pos:i,offset:o,referenceSize:p,translation:w,rotation:V,scale:z,vvScale:O}),uv:r,evalParams:b,vvScale:O,scale:z}}vertex(e,t){const{position:i,animationPointer:o,evalParams:s,isOutline:r,unscaledDistanceToPx:a,vvScale:n,uv:u,strokeWidth:c,scaleSymbolsProportionally:p,scale:d,isSDF:m,baseSize:f}=this._vertexPreamble(e),v=this._toNdc(i);let y=q(o,S.fromColor,s);y=new l.T8(y.rgb.multiply(y.a),y.a);let b=q(o,S.toColor,s);b=new l.T8(b.rgb.multiply(b.a),b.a);let g=q(o,S.colorMix,s);g=new l.T8(g.rgb.multiply(g.a),g.a);const x=q(o,S.toOpacity,s).a,w=q(o,S.opacityMix,s).a,_=I(this,e.id,y,(0,l.or)((0,h.h7)(e.bitset,N.m.bitset.colorLocked),new l.tW(r))),V=(0,l.CD)(_,b,g),z=F(this,e.id),T=(0,l.CD)(z,x,w),O=V.multiply(T),A=this.clip(e.id,e.zoomRange),P=a.multiply(n);return{glPosition:new l.T8(v,A,1),uv:u.divide(this.mosaicInfo.size),color:O.multiply(new l.bv(1).subtract(r)),outlineColor:O.multiply(r),distanceToPx:P,strokeWidth:c.multiply((0,l.CD)(new l.bv(1),d,p)),isOutline:r,isSDF:m,...this.maybeRunHittest(e,t,{pos:e.pos,size:f,sizeCorrection:new l.bv(1),isMapAligned:new l.bv(1),vvRotationMat3:new l.Tu(1,0,0,0,1,0,0,0,1),placementMat3:new l.Tu(1,0,0,0,1,0,0,0,1),outlineSize:new l.bv(1),distanceToPx:P,isSDF:m})}}fragment(e){let t=this._getColor(e.uv,{color:e.color,distanceToPx:e.distanceToPx,isSDF:e.isSDF,outlineColor:e.outlineColor,outlineSize:e.strokeWidth});return a.P.spotlightAnimatedSymbols&&(t=t.add(new l.T8(0,.3,0,.3))),this.getFragmentOutput(t,e)}hittest(e,t,i){return(0,l.KJ)((0,l.Qj)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(e,t,i),this._hittestMarker(e,t,i))}_hittestSmallMarker(e,t,i){const{position:o,distance:s,smallSymbolDistance:r}=this.hittestRequest,a=s.subtract(r),{viewMat3:n,tileMat3:u}=this.view,c=n.multiply(u).multiply(new l.AO(i.pos,1)).xy,p=i.size.multiply(.5);return(0,l.TE)(c,o).subtract(p).add(a)}_hittestMarker(e,t,i){const o=this._vertexPreamble({...e}).position,s=this._vertexPreamble({...e,offset:t.offsetNextVertex1,uv:t.textureUVNextVertex1}).position,r=this._vertexPreamble({...e,offset:t.offsetNextVertex2,uv:t.textureUVNextVertex2}).position,a=this.hittestRequest.position,n=this.hittestRequest.distance,u=$(a,o,s,r);return(0,l.KJ)((0,l.tS)(u,n),u,this._hittestSamples(o,s,r,e,t,i))}_hittestSamples(e,t,i,o,s,r){const{outlineSize:a,isSDF:n,distanceToPx:u}=r,c=this.hittestRequest.position,p=this.hittestRequest.distance,d=U(c.add(new l.Sg((0,l.tk)(p),(0,l.tk)(p))),e,t,i),h=U(c.add(new l.Sg(0,(0,l.tk)(p))),e,t,i),m=U(c.add(new l.Sg(p,(0,l.tk)(p))),e,t,i),f=U(c.add(new l.Sg((0,l.tk)(p),0)),e,t,i),v=U(c,e,t,i),y=U(c.add(new l.Sg(p,0)),e,t,i),b=U(c.add(new l.Sg((0,l.tk)(p),p)),e,t,i),g=U(c.add(new l.Sg(0,p)),e,t,i),x=U(c.add(new l.Sg(p,p)),e,t,i),w=o.uv.divide(this.mosaicInfo.size),S=s.textureUVNextVertex1.divide(this.mosaicInfo.size),_=s.textureUVNextVertex2.divide(this.mosaicInfo.size),V={color:new l.T8(1,1,1,1),outlineSize:a,outlineColor:new l.T8(1,1,1,1),isSDF:n,distanceToPx:u};let z=new l.bv(0);return z=z.add(B(d).multiply(this._getColor(X(d,w,S,_),V).a)),z=z.add(B(h).multiply(this._getColor(X(h,w,S,_),V).a)),z=z.add(B(m).multiply(this._getColor(X(m,w,S,_),V).a)),z=z.add(B(f).multiply(this._getColor(X(f,w,S,_),V).a)),z=z.add(B(v).multiply(this._getColor(X(v,w,S,_),V).a)),z=z.add(B(y).multiply(this._getColor(X(y,w,S,_),V).a)),z=z.add(B(b).multiply(this._getColor(X(b,w,S,_),V).a)),z=z.add(B(g).multiply(this._getColor(X(g,w,S,_),V).a)),z=z.add(B(x).multiply(this._getColor(X(x,w,S,_),V).a)),(0,l.Nb)(z,new l.bv(.05)).multiply(G(this.hittestRequest))}}(0,r._)([(0,r.a)(0,(0,n.qH)(J)),(0,r.a)(1,(0,n.qH)(j))],Q.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(class extends k{}))],Q.prototype,"fragment",null);var Y=i(46332),ee=i(38642),te=i(75944);class ie extends te.v{constructor(){super(...arguments),this.symbologyPlane=o.mH.FILL,this._input=null}}var oe=i(32676);class se extends ie{render(e,t){const{context:i,painter:o}=e,{target:s}=t,{freezeGlobalTime:r}=a.P,n=o.textureManager.animationStore.getTexture(i,0),l=[2/e.state.size[0],0,0,0,-2/e.state.size[1],0,-1,1,1],u=Array.from((0,Y.U_)((0,ee.Ue)(),l)),c=Array.from((0,Y.Jp)((0,ee.Ue)(),u,s.transforms.displayViewScreenMat3)),p=t.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,p.uniforms),...(0,oe.l5)(e,t.target),mosaicInfo:o.textureManager.getMosaicInfo(i,t.textureKey,!0),animationInfo:{globalTime:!1===r?e.time/1e3:r,animationTextureSize:[n.descriptor.width,n.descriptor.height],animationTexture:{unit:6,texture:n},toScreen:c,toNdc:l,mapRotation:e.state.rotation,pixelRatio:e.state.pixelRatio}},defines:{...(0,oe.rO)(e)},optionalAttributes:{zoomRange:!0},useComputeBuffer:!0}),o.setPipelineState({...(0,oe.H6)(e)}),o.submitDraw(e,t),!1===r&&s.requestRender()}}class re extends n.Pz{}(0,r._)([(0,n.xh)(0,l.Sg)],re.prototype,"pos",void 0);class ae extends n.oo{}(0,r._)([(0,n.e5)(l.bv)],ae.prototype,"dotSize",void 0);class ne extends n.oo{}(0,r._)([(0,n.e5)(l.Eg)],ne.prototype,"locations",void 0),(0,r._)([(0,n.e5)(l.bv)],ne.prototype,"pixelRatio",void 0),(0,r._)([(0,n.e5)(l.bv)],ne.prototype,"tileZoomFactor",void 0);class le extends n.ri{constructor(){super(...arguments),this.type="DotDensityPointShader"}vertex(e){const t=new l.Tu(1,0,0,0,-1,0,0,1,1).multiply(new l.AO(e.pos.xy.divide(p.i9),1)),i=(0,l.ig)(this.draw.locations,t.xy),o=(0,l.Fp)(this.instance.dotSize.divide(2),new l.bv(1));let s=new l.bv(0);s=s.add((0,l.Nb)(i.a,new l.bv(1e-6)).multiply(2));let r=o.add(this.instance.dotSize);const a=this.view.displayViewScreenMat3.multiply(new l.AO(e.pos.add(.5),1)),n=new l.T8(a.xy,s,1),u=this.instance.dotSize.divide(r),c=new l.bv(-1).divide(o.divide(r));return r=r.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:n,glPointSize:r,color:i,ratio:u,invEdgeRatio:c}}fragment(e){const t=(0,l.kE)(e.glPointCoord.subtract(.5)).multiply(2),i=(0,l.CW)(new l.bv(0),new l.bv(1),e.invEdgeRatio.multiply(t.subtract(e.ratio)).add(1)),o=new n.Qt;return o.fragColor=e.color.multiply(i),o}}(0,r._)([(0,n.e5)(ae)],le.prototype,"instance",void 0),(0,r._)([(0,n.e5)(ne)],le.prototype,"draw",void 0),(0,r._)([(0,n.e5)(y)],le.prototype,"view",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(re))],le.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(class extends x{}))],le.prototype,"fragment",null);class ue extends b{}(0,r._)([(0,n.xh)(3,l.bv)],ue.prototype,"inverseArea",void 0);class ce extends n.oo{}(0,r._)([(0,n.e5)(l.v8.ofType(l.T8,2))],ce.prototype,"isActive",void 0),(0,r._)([(0,n.e5)(l.v8.ofType(l.T8,8))],ce.prototype,"colors",void 0),(0,r._)([(0,n.e5)(l.bv)],ce.prototype,"dotValue",void 0);class pe extends n.oo{}(0,r._)([(0,n.e5)(l.Eg)],pe.prototype,"dotTexture0",void 0),(0,r._)([(0,n.e5)(l.Eg)],pe.prototype,"dotTexture1",void 0),(0,r._)([(0,n.e5)(l.bv)],pe.prototype,"tileZoomFactor",void 0),(0,r._)([(0,n.e5)(l.bv)],pe.prototype,"pixelRatio",void 0),(0,r._)([(0,n.e5)(l.bv)],pe.prototype,"tileDotsOverArea",void 0);class de extends w{constructor(){super(...arguments),this.type="DotDensityPolygonShader"}_dotThreshold(e,t,i){return e.divide(t).divide(i)}vertex(e){const t=new l.Tu(2/p.i9,0,0,0,-2/p.i9,0,-1,1,1).multiply(new l.AO(e.pos,1)),i=this.clip(e.id),o=new l.T8(t.xy,i,1),s=this.storage.getVVData(e.id).multiply(this.instance.isActive.get(0)).multiply(e.inverseArea),r=this.storage.getDataDrivenData0(e.id).multiply(this.instance.isActive.get(1)).multiply(e.inverseArea),a=this.draw.tileZoomFactor.multiply(p.i9).divide(this.draw.pixelRatio),n=this._dotThreshold(s,this.instance.dotValue,this.draw.tileDotsOverArea),u=this._dotThreshold(r,this.instance.dotValue,this.draw.tileDotsOverArea),c=e.pos.add(.5).divide(a);return{glPosition:o,color:new l.T8(0,0,0,0),textureCoords:c,thresholds0:n,thresholds1:u}}fragment(e){const t=new n.Qt,i=(0,l.ig)(this.draw.dotTexture0,e.textureCoords),o=(0,l.ig)(this.draw.dotTexture1,e.textureCoords),s=e.thresholds0.subtract(i),r=e.thresholds1.subtract(o);let a;const u=l.yb.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),c=l.yb.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const e=(0,l.Nb)(new l.bv(0),s),t=(0,l.Nb)(new l.bv(0),r),i=(0,l.AK)(e,s).add((0,l.AK)(t,r)),o=(0,l.Nb)(i,new l.bv(0)),n=new l.bv(1).subtract(o),p=i.add(o),d=s.multiply(e).divide(p),h=r.multiply(t).divide(p),m=u.multiply(d).add(c.multiply(h));a=n.multiply(m)}else{const e=(0,l.Fp)((0,h.X3)(s),(0,h.X3)(r)),t=(0,l.Nb)(e,new l.bv(0)),i=new l.bv(1).subtract(t),o=(0,l.Nb)(e,s),n=(0,l.Nb)(e,r),p=u.multiply(o).add(c.multiply(n));a=i.multiply(p)}return t.fragColor=a,t}hittest(e){return G(this.hittestRequest)}}(0,r._)([n.Ou],de.prototype,"blending",void 0),(0,r._)([(0,n.e5)(ce)],de.prototype,"instance",void 0),(0,r._)([(0,n.e5)(pe)],de.prototype,"draw",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(ue))],de.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(x))],de.prototype,"fragment",null);var he=i(4157),me=i(88144),fe=i(91907),ve=i(18567),ye=i(37165),be=i(56109),ge=i(43487),xe=i(80479);const we={pos:{count:2,type:fe.g.UNSIGNED_SHORT}};class Se{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(e){if(null==this._dotFBO){const t=p.i9,i=p.i9,o=new xe.X(t,i);o.samplingMode=fe.cw.NEAREST,o.wrapMode=fe.e8.CLAMP_TO_EDGE;const s=new ye.r(e,new be.Y(fe.Tg.DEPTH_STENCIL,t,i));this._dotFBO=new ve.X(e,o,s)}return this._dotFBO}getDotDensityMesh(e){if(null==this._dotMesh){const t=p.i9,i=t*t,o=2,s=new Int16Array(i*o);for(let e=0;e<t;e++)for(let i=0;i<t;i++)s[o*(i+e*t)]=i,s[o*(i+e*t)+1]=e;this._dotMesh=me.A.create(e,{primitive:fe.MX.POINTS,vertex:s,count:i,layout:we})}return this._dotMesh}getDotDensityTextures(e,t,i){if(this._dotTextureSize===t&&this._seed===i||(this._disposeTextures(),this._dotTextureSize=t,this._seed=i),null===this._dotTextures){const o=new he.Z(i);this._dotTextures=[this._allocDotDensityTexture(e,t,o),this._allocDotDensityTexture(e,t,o)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let e=0;e<this._dotTextures.length;e++)this._dotTextures[e].dispose();this._dotTextures=null}}_allocDotDensityTexture(e,t,i){const o=new Float32Array(t*t*4);for(let e=0;e<o.length;e++)o[e]=i.getFloat();const s=new xe.X;return s.dataType=fe.Br.FLOAT,s.samplingMode=fe.cw.NEAREST,s.width=t,s.height=t,new ge.x(e,s,o)}}class _e extends b{}(0,r._)([(0,n.xh)(3,l.T8)],_e.prototype,"color",void 0),(0,r._)([(0,n.xh)(4,l.Sg)],_e.prototype,"zoomRange",void 0);class Ve extends w{constructor(){super(...arguments),this.type="FillShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){const i=F(this,e.id),o=I(this,e.id,e.color).multiply(i),s=this.view.displayViewScreenMat3.multiply(new l.AO(e.pos.xy,1)),r=this.clip(e.id,e.zoomRange);return{glPosition:new l.T8(s.xy,r,1),color:o,...this.maybeRunHittest(e,t,null)}}fragment(e){return this.getFragmentOutput(e.color,e,new l.bv(0))}hittest(e,t){return W(this,e,t)}}(0,r._)([(0,n.Kw)(z)],Ve.prototype,"visualVariableColor",void 0),(0,r._)([(0,n.Kw)(T)],Ve.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(_e)),(0,r.a)(1,(0,n.qH)(g))],Ve.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(x))],Ve.prototype,"fragment",null);class ze extends n.oo{getPatternOffsetAtTileOrigin(e,t=new l.bv(0),i=new l.bv(1)){const o=new l.Sg(_.ad).divide(e);let s=e.multiply((0,l.ZI)(this.maxIntsToLocalOrigin.multiply(o))).add(this.tileOffsetFromLocalOrigin).subtract(new l.bv(.5).multiply(e));return s=new l.Sg(s.x.multiply(i).subtract(s.y.multiply(t)),s.x.multiply(t).add(s.y.multiply(i))),(0,l.wQ)(s,e)}}(0,r._)([(0,n.e5)(l.Sg)],ze.prototype,"tileOffsetFromLocalOrigin",void 0),(0,r._)([(0,n.e5)(l.Sg)],ze.prototype,"maxIntsToLocalOrigin",void 0);class Te extends _e{}(0,r._)([(0,n.xh)(5,l.T8)],Te.prototype,"tlbr",void 0),(0,r._)([(0,n.xh)(6,l.bv)],Te.prototype,"width",void 0),(0,r._)([(0,n.xh)(7,l.bv)],Te.prototype,"height",void 0),(0,r._)([(0,n.xh)(8,l.Sg)],Te.prototype,"offset",void 0),(0,r._)([(0,n.xh)(9,l.Sg)],Te.prototype,"scale",void 0),(0,r._)([(0,n.xh)(10,l.bv)],Te.prototype,"angle",void 0);function Oe(e,t){const i=e.view.requiredZoomFactor,o=new l.Sg(t.width,t.height),s=o.multiply(t.scale).multiply(i),r=t.angle.multiply(_.e4),a=(0,l.O$)(r),n=(0,l.mC)(r),u=function(e,t,i,o,s){const r=(0,l.ln)((0,h.qD)(s,_.Ux),(0,l.fz)(1)),a=(0,h.JH)(new l.T8(e,0));return(0,l.KJ)(r,(0,l.wO)(o.divide(t.x),i.divide(t.y),0,(0,l.tk)(i.divide(t.x)),o.divide(t.y),0,(0,h.TN)((0,l.K4)(a,0)),(0,h.TN)((0,l.K4)(0,a)),1),(0,l.wO)(o.divide(t.x),i.divide(t.y),0,(0,l.tk)(i.divide(t.x)),o.divide(t.y),0,0,0,1))}(t.id,s,a,n,t.bitset),c=e.localTileOffset.getPatternOffsetAtTileOrigin(o,a,n),p=i.multiply(t.scale).multiply(t.offset.subtract(c)).divide(s),d=new l.AO(t.pos,1),m=u.multiply(d).xy.subtract(p),f=t.tlbr.divide(e.mosaicInfo.size.xyxy);let v=(0,h.qD)(t.bitset,_.GS);return null!=e.visualVariableColor&&(v=(0,l.KJ)((0,h.In)(e.storage.getColorValue(t.id)),new l.bv(0),v)),{tileTextureCoord:m,tlbr:f,sampleAlphaOnly:v}}function Ae(e,t){const i=(0,l.wQ)(t.tileTextureCoord,new l.bv(1)),o=(0,l.CD)(t.tlbr.xy,t.tlbr.zw,i);let s=(0,l.ig)(e.mosaicInfo.texture,o);return s=(0,l.KJ)((0,l.tS)(t.sampleAlphaOnly,new l.bv(.5)),s.aaaa,s),t.color.multiply(s)}class Pe extends Ve{constructor(){super(...arguments),this.type="ComplexFillShader"}vertex(e,t){return{...super.vertex(e,t),...Oe(this,e)}}fragment(e){const t=Ae(this,e);return this.getFragmentOutput(t,e,new l.bv(0))}}(0,r._)([(0,n.e5)(V)],Pe.prototype,"mosaicInfo",void 0),(0,r._)([(0,n.e5)(ze)],Pe.prototype,"localTileOffset",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(Te)),(0,r.a)(1,(0,n.qH)(g))],Pe.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(class extends x{}))],Pe.prototype,"fragment",null);function Ce(e){const t=1/e;return{antialiasing:t,blur:0+t}}class De extends b{}(0,r._)([(0,n.xh)(3,l.T8)],De.prototype,"color",void 0),(0,r._)([(0,n.xh)(4,l.Sg)],De.prototype,"offset",void 0),(0,r._)([(0,n.xh)(5,l.Sg)],De.prototype,"normal",void 0),(0,r._)([(0,n.xh)(6,l.bv)],De.prototype,"halfWidth",void 0),(0,r._)([(0,n.xh)(7,l.bv)],De.prototype,"referenceHalfWidth",void 0),(0,r._)([(0,n.xh)(8,l.Sg)],De.prototype,"zoomRange",void 0);class Re extends x{}class Me extends n.oo{}function Ie(e){return(0,l.Fp)(new l.bv(_.Ay).multiply((0,l.Nb)(e,new l.bv(_.xp))),new l.bv(1))}function Fe(e,t){const{halfWidth:i,normal:o}=e,s=Ie(i),r=(0,l.kE)(o).multiply(i);return(0,l.uZ)(s.multiply(i.subtract(r)).divide(t.add(s).subtract(new l.bv(1))),new l.bv(0),new l.bv(1))}function Ee(e,t){const{id:i,offset:o,pos:s,normal:r,zoomRange:a}=t,{displayViewScreenMat3:n,displayViewMat3:u}=e.view,c=I(e,i,t.color),p=F(e,i),d=function(e,t){const{id:i,halfWidth:o,referenceHalfWidth:s}=t;if(R(e)){const t=M(e,i,new l.bv(2).multiply(s));return new l.bv(.5).multiply(o.divide((0,l.Fp)(s,new l.bv(_.Ho)))).multiply(t)}return o}(e,t),h=new l.bv(.5).multiply(e.antialiasingControls.antialiasing),m=(0,l.Fp)(d.add(h),new l.bv(.45)).add(new l.bv(.1).multiply(h)),f=Ie(m).multiply(m).multiply(o),v=u.multiply(new l.AO(f,new l.bv(0))),y=n.multiply(new l.AO(s,new l.bv(1))).add(v),b=new l.bv(2).multiply((0,l.Nb)(d,new l.bv(0))).add(e.clip(i,a)),g=new l.T8(y.xy,b,1);return{color:c,opacity:p,halfWidth:m,normal:r,scaledOffset:f,scaledHalfWidth:d,glPosition:new l.T8(g.xy,b,1)}}function He(e,t){const{opacity:i,color:o}=e,s=Fe(e,t);return i.multiply(o).multiply(s)}(0,r._)([(0,n.e5)(l.bv)],Me.prototype,"antialiasing",void 0),(0,r._)([(0,n.e5)(l.bv)],Me.prototype,"blur",void 0);class ke extends w{constructor(){super(...arguments),this.type="LineShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){const i=Ee(this,e);return{...i,...this.maybeRunHittest(e,t,i.halfWidth)}}fragment(e){const t=He(e,this.antialiasingControls.blur);return this.getFragmentOutput(t,e)}hittest(e,t,i){const{viewMat3:o,tileMat3:s}=this.view,r=o.multiply(s),a=r.multiply(new l.AO(e.pos,1)),n=r.multiply(new l.AO(t.nextPos1,1)),u=r.multiply(new l.AO(t.nextPos2,1)),{distance:c,smallSymbolDistance:p,smallSymbolSizeThreshold:d}=this.hittestRequest,h=(0,l.Nb)(i,d.multiply(.5)).multiply(c.subtract(p)),m=this.hittestRequest.position;return(0,l.VV)(K(m,a.xy,n.xy),K(m,a.xy,u.xy)).subtract(i).add(h)}}(0,r._)([(0,n.e5)(Me)],ke.prototype,"antialiasingControls",void 0),(0,r._)([(0,n.Kw)(z)],ke.prototype,"visualVariableColor",void 0),(0,r._)([(0,n.Kw)(T)],ke.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,n.Kw)(A)],ke.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,n.Kw)(P)],ke.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,n.Kw)(C)],ke.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,n.Kw)(D)],ke.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(De)),(0,r.a)(1,(0,n.qH)(g))],ke.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(Re))],ke.prototype,"fragment",null);class Le extends b{}(0,r._)([(0,n.xh)(3,l.Sg)],Le.prototype,"offset",void 0),(0,r._)([(0,n.xh)(4,l.T8)],Le.prototype,"color",void 0),(0,r._)([(0,n.xh)(5,l.Sg)],Le.prototype,"normal",void 0),(0,r._)([(0,n.xh)(6,l.bv)],Le.prototype,"halfWidth",void 0),(0,r._)([(0,n.xh)(7,l.bv)],Le.prototype,"referenceHalfWidth",void 0),(0,r._)([(0,n.xh)(8,l.Sg)],Le.prototype,"zoomRange",void 0);class qe extends Re{}function Ne(e,t,i){const{id:o,bitset:s}=t,r=(0,h.qD)(s,_.WD),a=(0,l.tS)(r,new l.bv(.5)),n=Ee(e,t),u=(0,l.KJ)(a,n.halfWidth,new l.bv(0)),c=F(e,o),p=I(e,o,t.color),d=(0,l.KJ)(a,t.color,p.multiply(c)),m=e.view.displayViewScreenMat3.multiply(new l.AO(t.pos.xy,1)),f=e.clip(t.id),v=new l.T8(m.xy,f,1),y=(0,l.KJ)(a,n.glPosition,v),b=i&&e.maybeRunHittest(t,i,a);return{isOutline:r,color:d,opacity:new l.bv(1),halfWidth:u,normal:n.normal,glPosition:y,...b}}class Ke extends w{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,r._)([(0,n.e5)(Me)],Ke.prototype,"antialiasingControls",void 0),(0,r._)([(0,n.Kw)(z)],Ke.prototype,"visualVariableColor",void 0),(0,r._)([(0,n.Kw)(T)],Ke.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,n.Kw)(A)],Ke.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,n.Kw)(P)],Ke.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,n.Kw)(C)],Ke.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,n.Kw)(D)],Ke.prototype,"visualVariableSizeUnitValue",void 0);class Be extends Ke{constructor(){super(...arguments),this.type="OutlineFillShader"}vertex(e,t){return Ne(this,e,t)}fragment(e){const{color:t,isOutline:i}=e,o=(0,l.tS)(i,new l.bv(.5)),s=He(e,this.antialiasingControls.blur),r=(0,l.KJ)(o,s,t),a=(0,l.KJ)(o,new l.bv(1/255),new l.bv(0));return this.getFragmentOutput(r,e,a)}hittest(e,t,i){return(0,l.KJ)(i,G(this.hittestRequest),W(this,e,t))}}(0,r._)([(0,r.a)(0,(0,n.qH)(Le)),(0,r.a)(1,(0,n.qH)(g))],Be.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(qe))],Be.prototype,"fragment",null);class Ue extends _e{}(0,r._)([(0,n.xh)(5,l.T8)],Ue.prototype,"tlbr",void 0),(0,r._)([(0,n.xh)(6,l.bv)],Ue.prototype,"inverseRasterizationScale",void 0);function Ze(e,t){const i=t.tlbr.xy,o=t.tlbr.zw,s=o.x.subtract(i.x),r=i.y.subtract(o.y),a=new l.Sg(s,r).multiply(t.inverseRasterizationScale),n=a.multiply(e.view.requiredZoomFactor),u=function(e){const t=new l.bv(1),i=new l.bv(0);return new l.Tu(t.divide(e.x),i.divide(e.y),0,(0,l.tk)(i.divide(e.x)),t.divide(e.y),0,0,0,1)}(n),c=e.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(n),p=new l.AO(t.pos,1);return{tileTextureCoord:u.multiply(p).xy.subtract(c),tlbr:t.tlbr.divide(e.mosaicInfo.size.xyxy)}}function $e(e,t){const i=(0,l.wQ)(e.tileTextureCoord,new l.bv(1)),o=(0,l.CD)(e.tlbr.xy,e.tlbr.zw,i),s=(0,l.ig)(t.texture,o);return e.color.multiply(s)}class Ge extends Ve{constructor(){super(...arguments),this.type="PatternFillShader"}vertex(e,t){return{...super.vertex(e,t),...Ze(this,e)}}fragment(e){const t=$e(e,this.mosaicInfo);return this.getFragmentOutput(t,e,new l.bv(0))}}(0,r._)([(0,n.e5)(V)],Ge.prototype,"mosaicInfo",void 0),(0,r._)([(0,n.e5)(ze)],Ge.prototype,"localTileOffset",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(Ue)),(0,r.a)(1,(0,n.qH)(g))],Ge.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(class extends x{}))],Ge.prototype,"fragment",null);class We extends Le{}(0,r._)([(0,n.xh)(9,l.T8)],We.prototype,"tlbr",void 0),(0,r._)([(0,n.xh)(10,l.bv)],We.prototype,"inverseRasterizationScale",void 0);class Je extends qe{}class je extends Be{constructor(){super(...arguments),this.type="PatternOutlineFillShader"}vertex(e,t){return{...Ne(this,e,t),...Ze(this,e)}}fragment(e){const{isOutline:t}=e,i=(0,l.tS)(t,new l.bv(.5)),o=He(e,this.antialiasingControls.blur),s=$e(e,this.mosaicInfo),r=(0,l.KJ)(i,o,s),a=(0,l.KJ)(i,new l.bv(1/255),new l.bv(0));return this.getFragmentOutput(r,e,a)}}(0,r._)([(0,n.e5)(V)],je.prototype,"mosaicInfo",void 0),(0,r._)([(0,n.e5)(ze)],je.prototype,"localTileOffset",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(We)),(0,r.a)(1,(0,n.qH)(g))],je.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(Je))],je.prototype,"fragment",null);const Xe=1/_.$1;class Qe extends b{}(0,r._)([(0,n.xh)(3,l.T8)],Qe.prototype,"color",void 0),(0,r._)([(0,n.xh)(4,l.T8)],Qe.prototype,"tlbr",void 0),(0,r._)([(0,n.xh)(5,l.bv)],Qe.prototype,"angle",void 0),(0,r._)([(0,n.xh)(6,l.bv)],Qe.prototype,"aux1",void 0),(0,r._)([(0,n.xh)(7,l.bv)],Qe.prototype,"aux2",void 0),(0,r._)([(0,n.xh)(8,l.Sg)],Qe.prototype,"aux3",void 0),(0,r._)([(0,n.xh)(9,l.Sg)],Qe.prototype,"aux4",void 0),(0,r._)([(0,n.xh)(10,l.Sg)],Qe.prototype,"zoomRange",void 0);class Ye extends Ke{constructor(){super(...arguments),this.type="ComplexOutlineFillShader"}vertex(e,t){const{aux1:i,aux2:o,aux3:s,aux4:r}=e,a={...e,width:i,height:o,offset:s,scale:r.multiply(Xe)},n=Ne(this,{...e,halfWidth:i,referenceHalfWidth:o,offset:s,normal:r.subtract(_.NS).multiply(Xe)}),u=Oe(this,a),c=(0,l.tS)(n.isOutline,new l.bv(.5));return{...n,...u,...this.maybeRunHittest(e,t,c)}}fragment(e){const{isOutline:t}=e,i=(0,l.tS)(t,new l.bv(.5)),o=He(e,this.antialiasingControls.blur),s=Ae(this,e),r=(0,l.KJ)(i,o,s),a=(0,l.KJ)(i,new l.bv(1/255),new l.bv(0));return this.getFragmentOutput(r,e,a)}hittest(e,t,i){return(0,l.KJ)(i,G(this.hittestRequest),W(this,e,t))}}(0,r._)([(0,n.e5)(V)],Ye.prototype,"mosaicInfo",void 0),(0,r._)([(0,n.e5)(ze)],Ye.prototype,"localTileOffset",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(Qe)),(0,r.a)(1,(0,n.qH)(g))],Ye.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(class extends Je{}))],Ye.prototype,"fragment",null);var et=i(33988);class tt extends _e{}(0,r._)([(0,n.xh)(5,l.T8)],tt.prototype,"tlbr",void 0),(0,r._)([(0,n.xh)(6,l.Sg)],tt.prototype,"relativePosition",void 0),(0,r._)([(0,n.xh)(7,l.bv)],tt.prototype,"gradientMethod",void 0),(0,r._)([(0,n.xh)(8,l.Sg)],tt.prototype,"relativeGradientSize",void 0);class it extends Ve{constructor(){super(...arguments),this.type="GradientFillShader"}vertex(e,t){const{tlbr:i,relativePosition:o,gradientMethod:s,relativeGradientSize:r}=e,a=(0,l.KJ)((0,h.h7)(e.bitset,et.s.isAbsolute),this.view.displayZoomFactor,new l.bv(1));return{...super.vertex(e,t),tlbr:i,relativePosition:o,gradientMethod:s,gradientSize:r.multiply(a),isDiscrete:(0,h.qD)(e.bitset,et.s.isDiscrete)}}fragment(e){const{tlbr:t,relativePosition:i,gradientMethod:o,gradientSize:s,isDiscrete:r}=e,a=(0,l.KJ)((0,l.tS)(r,new l.bv(.5)),s.subtract(1),new l.Sg(0)),n=(0,l.wV)([(0,l.ln)(o,new l.bv(et.T.rectangular)),()=>{const e=(0,l.Wn)(i).add(a).divide(s);return(0,h.RZ)((0,l.Fp)(e.x,e.y))}],[(0,l.ln)(o,new l.bv(et.T.circular)),(0,h.RZ)((0,l._b)((0,l.AK)(i,i)).add(a.x).divide(s.x))],[!0,(0,h.RZ)(i.x.add(a.x).divide(s.x))]),u=new l.Sg((0,l.uZ)(n,new l.bv(0),new l.bv(1)),.5),c=(0,l.CD)(t.xy,t.zw,u).divide(this.mosaicInfo.size),p=(0,l.ig)(this.mosaicInfo.texture,c),d=e.color.a;return this.getFragmentOutput(p.multiply(d),e,new l.bv(0))}}(0,r._)([(0,n.e5)(V)],it.prototype,"mosaicInfo",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(tt)),(0,r.a)(1,(0,n.qH)(g))],it.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(class extends x{}))],it.prototype,"fragment",null);var ot=i(13802),st=i(61681),rt=i(61794);class at{destroy(){this._accumulateFramebuffer=(0,st.M2)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,st.M2)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(e){if(null==this._qualityProfile){const t=(0,rt.vj)(e,ot.Z.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...t,defines:{usesHalfFloatPrecision:t.dataType!==fe.Br.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(e,t,i){if(null==this._accumulateFramebuffer){const{dataType:o,samplingMode:s,pixelFormat:r,internalFormat:a}=this.loadQualityProfile(e),n=new xe.X(t,i);n.pixelFormat=r,n.internalFormat=a,n.dataType=o,n.samplingMode=s,n.wrapMode=fe.e8.CLAMP_TO_EDGE;const l=new be.Y(fe.Tg.DEPTH_STENCIL,t,i);this._accumulateFramebuffer=new ve.X(e,n,l)}else{const{width:e,height:o}=this._accumulateFramebuffer;e===t&&o===i||this._accumulateFramebuffer.resize(t,i)}return this._accumulateFramebuffer}ensureResolveGradientTexture(e,t,i){if(null==this._resolveGradientTexture){const t=new xe.X;t.wrapMode=fe.e8.CLAMP_TO_EDGE,this._resolveGradientTexture=new ge.x(e,t),this._prevGradientHash=null}return this._prevGradientHash!==t&&(this._resolveGradientTexture.resize(i.length/4,1),this._resolveGradientTexture.setData(i),this._prevGradientHash=t),this._resolveGradientTexture}}function nt(e){return e?.25:1}class lt extends b{}(0,r._)([(0,n.xh)(5,l.Sg)],lt.prototype,"offset",void 0);class ut extends n.oo{}(0,r._)([(0,n.e5)(l.bv)],ut.prototype,"radius",void 0),(0,r._)([(0,n.e5)(l.bv)],ut.prototype,"isFieldActive",void 0);class ct extends w{constructor(){super(...arguments),this.type="HeatmapAccumulateShader",this.usesHalfFloatPrecision=!1}vertex(e){const{radius:t,isFieldActive:i}=this.kernelControls,o=e.offset,s=i.multiply(this.storage.getVVData(e.id).x).add(new l.bv(1).subtract(i)),r=this.view.displayViewScreenMat3.multiply(new l.AO(e.pos,1)).add(this.view.displayViewMat3.multiply(new l.AO(o,0)).multiply(t)),a=this.clip(e.id);return{glPosition:new l.T8(r.xy,a,1),offset:o,fieldValue:s,color:new l.T8(0),...this.maybeRunHittest(e,{},null)}}fragment(e){const{offset:t,fieldValue:i}=e,o=(0,l.kE)(t),s=(0,l.Nb)(o,new l.bv(1)),r=new l.bv(1).subtract(o.multiply(o)),a=r.multiply(r),n=s.multiply(a).multiply(i).multiply(new l.bv(nt(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new l.T8(n),e)}hittest(e){const{viewMat3:t,tileMat3:i}=this.view;return function(e,t,i){return(0,l.TE)(e,i).subtract(t)}(t.multiply(i).multiply(new l.AO(e.pos,1)).xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,r._)([n.Ou],ct.prototype,"usesHalfFloatPrecision",void 0),(0,r._)([(0,n.e5)(ut)],ct.prototype,"kernelControls",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(lt))],ct.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(class extends x{}))],ct.prototype,"fragment",null);class pt extends n.Pz{}(0,r._)([(0,n.xh)(0,l.Sg)],pt.prototype,"position",void 0);class dt extends n.XB{}class ht extends n.oo{}(0,r._)([(0,n.e5)(l.Eg)],ht.prototype,"texture",void 0),(0,r._)([(0,n.e5)(l.Sg)],ht.prototype,"minAndInvRange",void 0),(0,r._)([(0,n.e5)(l.bv)],ht.prototype,"normalization",void 0);class mt extends n.oo{}(0,r._)([(0,n.e5)(l.Eg)],mt.prototype,"texture",void 0);class ft extends n.ri{constructor(){super(...arguments),this.type="HeatmapResolveShader",this.usesHalfFloatPrecision=!1}vertex(e){return{glPosition:new l.T8(e.position.multiply(2).subtract(1),1,1),uv:e.position}}fragment(e){const{accumulatedDensity:t,gradient:i}=this;let o=(0,l.ig)(t.texture,e.uv).r.divide(new l.bv(nt(this.usesHalfFloatPrecision)));o=o.multiply(t.normalization),o=o.subtract(t.minAndInvRange.x).multiply(t.minAndInvRange.y);const s=(0,l.ig)(i.texture,new l.Sg(o,.5)),r=new n.Qt;return r.fragColor=new l.T8(s.rgb.multiply(s.a),s.a),r}}(0,r._)([n.Ou],ft.prototype,"usesHalfFloatPrecision",void 0),(0,r._)([(0,n.e5)(ht)],ft.prototype,"accumulatedDensity",void 0),(0,r._)([(0,n.e5)(mt)],ft.prototype,"gradient",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(pt))],ft.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(dt))],ft.prototype,"fragment",null);function vt(e){return e.key.level+1}const yt={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:vt,compare:fe.wb.GEQUAL,mask:255,op:{fail:fe.xS.KEEP,zFail:fe.xS.KEEP,zPass:fe.xS.REPLACE}}}},bt={...yt,stencil:!1},gt={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function xt(e,t){const{referenceScale:i,radius:o}=e.uniforms;return o*(0!==i?i/t.scale:1)}var wt;!function(e){e[e.Color=0]="Color",e[e.Outline=1]="Outline",e[e.Halo=2]="Halo"}(wt||(wt={}));class St extends b{}(0,r._)([(0,n.xh)(3,l.T8)],St.prototype,"color",void 0),(0,r._)([(0,n.xh)(4,l.Sg)],St.prototype,"offset",void 0),(0,r._)([(0,n.xh)(5,l.Sg)],St.prototype,"textureUV",void 0),(0,r._)([(0,n.xh)(6,l.bv)],St.prototype,"fontSize",void 0),(0,r._)([(0,n.xh)(7,l.bv)],St.prototype,"referenceSize",void 0),(0,r._)([(0,n.xh)(8,l.T8)],St.prototype,"outlineColor",void 0),(0,r._)([(0,n.xh)(9,l.T8)],St.prototype,"haloColor",void 0),(0,r._)([(0,n.xh)(10,l.Sg)],St.prototype,"outlineAndHaloSize",void 0),(0,r._)([(0,n.xh)(11,l.Sg)],St.prototype,"zoomRange",void 0),(0,r._)([(0,n.xh)(12,l.bv)],St.prototype,"clipAngle",void 0),(0,r._)([(0,n.xh)(13,l.T8)],St.prototype,"referenceSymbol",void 0);class _t extends n.yu{}(0,r._)([(0,n.xh)(14,l.Sg)],_t.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,n.xh)(15,l.Sg)],_t.prototype,"offsetNextVertex2",void 0);class Vt extends w{constructor(){super(...arguments),this.type="TextShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.textRenderPassType=wt.Color,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(e,t,i){const o=t.multiply(1.4173228346456692),s=(0,l.Wn)(this.view.rotation.subtract(o)),r=(0,l.VV)(new l.bv(360).subtract(s),s);let a=new l.bv(0);const n=(0,l.GW)(this.view.currentZoom.multiply(p.JS)).divide(p.JS),u=e.x,c=e.y,d=new l.bv(1).subtract((0,l.Nb)(u,n)).multiply(2),h=(0,l.Nb)(new l.bv(90),r).multiply(2),m=new l.bv(2).multiply(new l.bv(1).subtract((0,l.Nb)(n,c)));return a=a.add(i.multiply(d)),a=a.add(i.multiply(h)),a=a.add(m),a}vertex(e,t){const i=(0,h.qD)(e.bitset,_.mL),o=new l.bv(1).subtract(i);let s=e.fontSize,r=s.divide(_.V_);const a=this.textRenderPassType===wt.Outline?e.outlineColor:this.textRenderPassType===wt.Halo?e.haloColor:this._getVertexColor(e),n=this.isLabel?this.storage.getLabelVisibility(e.id):new l.bv(1),u=this.isLabel?a.multiply(n):a,c=this.view.displayViewScreenMat3.multiply(new l.AO(e.pos,1));let d=e.offset,m=new l.bv(1),f=l.Tu.identity(),v=new l.Sg(0);if(this.isLabel){if(!e.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const t=e.referenceSymbol,i=t.xy,o=t.z,s=this._unpackDirection(t.w),r=M(this,e.id,o).divide(2),a=s.multiply(r.add(p.gj));v=i.add(a),d=d.add(v)}else m=M(this,e.id,e.referenceSize).divide(e.referenceSize),s=s.multiply(m),r=r.multiply(m),d=d.multiply(m),f=E(this,e.id),d=f.multiply(new l.AO(d,0)).xy;const y=(0,h.qD)(e.bitset,_.$r),b=this._getViewRotationMatrix(y).multiply(new l.AO(d,0));let g=this.isLabel?this.clipLabel(e.zoomRange,e.clipAngle,y):this.clip(e.id,e.zoomRange);g=this.isBackgroundPass?g.add(o.multiply(2)):g.add(i.multiply(2));let x=new l.bv(0);if(this.textRenderPassType===wt.Outline&&(g=g.add((0,l.KJ)((0,l.ln)(e.outlineAndHaloSize.x,new l.bv(0)),new l.bv(2),new l.bv(0))),x=new l.bv(e.outlineAndHaloSize.x).divide(r).divide(_.Ke)),this.textRenderPassType===wt.Halo){const t=e.outlineAndHaloSize.x,i=new l.bv(e.outlineAndHaloSize.y);g=g.add((0,l.KJ)((0,l.ln)(i,new l.bv(0)),new l.bv(2),new l.bv(0))),x=i.add(t).divide(r).divide(_.Ke)}const w=this.isLabel?(0,l.or)((0,l.tS)(g,new l.bv(1)),(0,l.Iz)(n,new l.bv(0))):new l.tW(!1);return{glPosition:new l.T8(c.xy.add(b.xy),g,1),color:u,size:r,textureUV:e.textureUV.divide(this.mosaicInfo.size),antialiasingWidth:new l.bv(.105*_.V_).divide(s).divide(this.view.pixelRatio),outlineDistanceOffset:x,...this.maybeRunHittest(e,t,{vvSizeAdjustment:m,vvRotation:f,labelOffset:v,labelClipped:w})}}_getViewRotationMatrix(e){const t=this.view.displayViewMat3,i=this.view.displayMat3,o=new l.bv(1).subtract(e);return t.multiply(e).add(i.multiply(o))}fragment(e){const t=new l.bv(2/8),i=new l.bv(1).subtract(t),o=(0,l.ig)(this.mosaicInfo.texture,e.textureUV).a;let s=i.subtract(e.outlineDistanceOffset);this.highlight&&(s=s.divide(2));const r=e.antialiasingWidth,a=(0,l.CW)(s.subtract(r),s.add(r),o);return this.getFragmentOutput(e.color.multiply(a),e)}hittest(e,t,{vvSizeAdjustment:i,vvRotation:o,labelOffset:s,labelClipped:r}){let a,n,u;this.isLabel?(a=new l.AO(e.offset.add(s),0),n=new l.AO(t.offsetNextVertex1.add(s),0),u=new l.AO(t.offsetNextVertex2.add(s),0)):(a=o.multiply(new l.AO(e.offset.multiply(i),0)),n=o.multiply(new l.AO(t.offsetNextVertex1.multiply(i),0)),u=o.multiply(new l.AO(t.offsetNextVertex2.multiply(i),0)));const{viewMat3:c,tileMat3:p}=this.view,d=c.multiply(p).multiply(new l.AO(e.pos,1)),h=d.add(p.multiply(a)).xy,m=d.add(p.multiply(n)).xy,f=d.add(p.multiply(u)).xy,v=$(this.hittestRequest.position,h.xy,m.xy,f.xy);return this.isLabel?(0,l.KJ)(r,G(this.hittestRequest),v):v}_unpackDirection(e){const t=new l.J7(e),i=(0,l.Dg)(t,new l.J7(2)),o=(0,l.hx)(t,new l.J7(3));return new l.Sg(new l.bv(i).subtract(1),new l.bv(o).subtract(1))}_getVertexColor(e){let t=e.color;if(this.visualVariableColor){const i=this.storage.getColorValue(e.id);t=this.visualVariableColor.getColor(i,e.color,new l.tW(!1))}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(e.id),o=this.visualVariableOpacity.getOpacity(i);t=t.multiply(o)}return t}}(0,r._)([(0,n.Kw)(z)],Vt.prototype,"visualVariableColor",void 0),(0,r._)([(0,n.Kw)(T)],Vt.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,n.Kw)(O)],Vt.prototype,"visualVariableRotation",void 0),(0,r._)([(0,n.Kw)(A)],Vt.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,n.Kw)(P)],Vt.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,n.Kw)(C)],Vt.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,n.Kw)(D)],Vt.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,n.e5)(V)],Vt.prototype,"mosaicInfo",void 0),(0,r._)([n.Ou],Vt.prototype,"textRenderPassType",void 0),(0,r._)([n.Ou],Vt.prototype,"isBackgroundPass",void 0),(0,r._)([n.Ou],Vt.prototype,"isLabel",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(St)),(0,r.a)(1,(0,n.qH)(_t))],Vt.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(class extends x{}))],Vt.prototype,"fragment",null);var zt=i(18235);class Tt extends De{}(0,r._)([(0,n.xh)(9,l.bv)],Tt.prototype,"accumulatedDistance",void 0),(0,r._)([(0,n.xh)(10,l.bv)],Tt.prototype,"totalLength",void 0),(0,r._)([(0,n.xh)(11,l.bv)],Tt.prototype,"gradientSize",void 0),(0,r._)([(0,n.xh)(12,l.Sg)],Tt.prototype,"segmentDirection",void 0),(0,r._)([(0,n.xh)(13,l.T8)],Tt.prototype,"tlbr",void 0);class Ot extends n.oo{}(0,r._)([(0,n.e5)(l.bv)],Ot.prototype,"isColorPass",void 0);class At extends ke{constructor(){super(...arguments),this.type="GradientStrokeShader"}vertex(e,t){const{totalLength:i,gradientSize:o,segmentDirection:s,tlbr:r}=e,a=Ee(this,e),n=(0,h.qD)(e.bitset,zt.s.isAlongLine),u=i.divide(this.view.displayZoomFactor),c=(0,l.KJ)((0,h.h7)(e.bitset,zt.s.isAbsoluteSize),(()=>{const e=(0,l.KJ)((0,l.tS)(n,new l.bv(.5)),u,a.halfWidth);return o.divide(e)}),o),p=e.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,l.AK)(s,a.scaledOffset)).divide(u),d=r.divide(this.mosaicInfo.size.xyxy);return{...a,tlbr:d,relativePositionAlongLine:p,relativeGradientSize:c,isAlongLine:(0,h.qD)(e.bitset,zt.s.isAlongLine),isDiscrete:(0,h.qD)(e.bitset,zt.s.isDiscrete),...this.maybeRunHittest(e,t,a.halfWidth)}}fragment(e){const{isAlongLine:t,isDiscrete:i,relativePositionAlongLine:o,relativeGradientSize:s,normal:r,tlbr:a}=e,n=Fe(e,this.antialiasingControls.blur),u=new l.bv(.5).multiply(r.y).add(new l.bv(.5)),c=(0,l.KJ)((0,l.tS)(t,new l.bv(.5)),o,u),p=(0,l.KJ)((0,l.tS)(i,new l.bv(.5)),s.subtract(1),new l.bv(0)),m=(0,h.RZ)(c.add(p).divide(s)),f=(0,l.CD)(a.xy,a.zw,new l.Sg((0,l.uZ)(m,new l.bv(0),new l.bv(1)),.5)),v=(0,l.ig)(this.mosaicInfo.texture,f),y=e.opacity.multiply(n),b=this.getFragmentOutput(v.multiply(y),e),g=(0,l.Nb)(new l.bv(.5),this.technique.isColorPass).multiply((0,d.Z)("gradient-depth-epsilon")),x=(0,l.Nb)(new l.bv(0),r.y).multiply(new l.bv((0,d.Z)("gradient-depth-bias")).subtract(g));return b.glFragDepth=(0,l.uZ)((0,l.kE)(r).add(x),new l.bv(0),new l.bv(1)),b}}(0,r._)([(0,n.e5)(V)],At.prototype,"mosaicInfo",void 0),(0,r._)([(0,n.e5)(Ot)],At.prototype,"technique",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(Tt)),(0,r.a)(1,(0,n.qH)(g))],At.prototype,"vertex",null);var Pt=i(95550),Ct=i(13952);class Dt extends De{}(0,r._)([(0,n.xh)(9,l.bv)],Dt.prototype,"accumulatedDistance",void 0),(0,r._)([(0,n.xh)(10,l.Sg)],Dt.prototype,"segmentDirection",void 0),(0,r._)([(0,n.xh)(11,l.bv)],Dt.prototype,"offsetAlongLine",void 0),(0,r._)([(0,n.xh)(12,l.bv)],Dt.prototype,"capType",void 0),(0,r._)([(0,n.xh)(13,l.T8)],Dt.prototype,"tlbr",void 0);class Rt extends ke{constructor(){super(...arguments),this.type="TexturedLineShader"}_getDistanceRatio(e,t){const i=(0,h.qD)(e.bitset,_.Wq);return i.multiply((0,l.Fp)(t,new l.bv(.25)).multiply(new l.bv(2))).add(new l.bv(1).subtract(i).multiply((0,Pt.F2)(1)))}_getSDFAlpha(e){const{halfWidth:t,normal:i,tlbr:o,patternSize:s,accumulatedDistance:r,offsetAlongLine:a,dashToPx:n,capType:u}=e,c=s.x.divide(Ct.$d).multiply(n),p=(0,l.ZI)(r.add(a).divide(c)),d=(0,l.CD)(o.xy,o.zw,new l.Sg(p,.5)),m=(0,h.JH)((0,l.ig)(this.mosaicInfo.texture,d)).multiply(2).subtract(1).multiply(Ct.v8).multiply(n),f=i.y.multiply(t),v=(0,l.wV)([(0,l.ln)(u,new l.bv(1)),m.subtract(t)],[(0,l.ln)(u,new l.bv(2)),(0,l._b)((0,l.sQ)((0,l.Fp)(m,new l.bv(0)),new l.bv(2)).add(f.multiply(f))).subtract(t)],[!0,m]),y=(0,l.uZ)(new l.bv(.25).subtract(v),new l.bv(0),new l.bv(1));return new l.T8(y)}_getPatternColor(e){const{halfWidth:t,normal:i,color:o,accumulatedDistance:s,patternSize:r,sampleAlphaOnly:a,tlbr:n}=e,u=r.y.multiply(new l.bv(2).multiply(t).divide(r.x)),c=(0,l.ZI)(s.divide(u)),p=new l.bv(.5).multiply(i.y).add(new l.bv(.5)),d=(0,l.CD)(n.xy,n.zw,new l.Sg(p,c));let h=(0,l.ig)(this.mosaicInfo.texture,d);return null!=this.visualVariableColor&&(h=(0,l.KJ)((0,l.tS)(a,new l.bv(.5)),new l.T8(o.a),o)),h}vertex(e,t){const{segmentDirection:i,tlbr:o,bitset:s}=e,r=Ee(this,e),a=e.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,l.AK)(i,r.scaledOffset)),n=new l.Sg(o.z.subtract(o.x),o.w.subtract(o.y)),u=o.divide(this.mosaicInfo.size.xyxy),c=(0,h.qD)(s,_.B7),p=(0,h.qD)(s,_.GS),d=(0,l.KJ)((0,l.tS)(c,new l.bv(.5)),this._getDistanceRatio(e,r.scaledHalfWidth),new l.bv(1));return{...r,tlbr:u,patternSize:n,accumulatedDistance:a,isSDF:c,sampleAlphaOnly:p,dashToPx:d,offsetAlongLine:e.offsetAlongLine,capType:e.capType,...this.maybeRunHittest(e,t,r.halfWidth)}}fragment(e){const{color:t,opacity:i,isSDF:o}=e,s=Fe(e,this.antialiasingControls.blur),r=(0,l.KJ)((0,l.tS)(o,new l.bv(.5)),this._getSDFAlpha(e),this._getPatternColor(e)),a=t.multiply(i).multiply(s).multiply(r);return this.getFragmentOutput(a,e)}}(0,r._)([(0,n.e5)(V)],Rt.prototype,"mosaicInfo",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(Dt)),(0,r.a)(1,(0,n.qH)(g))],Rt.prototype,"vertex",null);class Mt extends b{}(0,r._)([(0,n.xh)(3,l.T8)],Mt.prototype,"color",void 0),(0,r._)([(0,n.xh)(4,l.T8)],Mt.prototype,"outlineColor",void 0),(0,r._)([(0,n.xh)(5,l.Sg)],Mt.prototype,"offset",void 0),(0,r._)([(0,n.xh)(6,l.Sg)],Mt.prototype,"textureUV",void 0),(0,r._)([(0,n.xh)(7,l.T8)],Mt.prototype,"sizing",void 0),(0,r._)([(0,n.xh)(8,l.bv)],Mt.prototype,"placementAngle",void 0),(0,r._)([(0,n.xh)(9,l.bv)],Mt.prototype,"sdfDecodeCoeff",void 0),(0,r._)([(0,n.xh)(10,l.Sg)],Mt.prototype,"zoomRange",void 0);class It extends n.yu{}(0,r._)([(0,n.xh)(12,l.Sg)],It.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,n.xh)(13,l.Sg)],It.prototype,"offsetNextVertex2",void 0),(0,r._)([(0,n.xh)(14,l.Sg)],It.prototype,"textureUVNextVertex1",void 0),(0,r._)([(0,n.xh)(15,l.Sg)],It.prototype,"textureUVNextVertex2",void 0);function Ft(e,t,i,o){return t.multiply(e.x).add(i.multiply(e.y)).add(o.multiply(e.z))}function Et(e){return e.multiply(e).divide(128)}class Ht extends w{constructor(){super(...arguments),this.type="MarkerShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(e,t){const i=Et(e.sizing.x),o=Et(e.sizing.y),s=Et(e.sizing.z),r=e.placementAngle,a=(0,h.qD)(e.bitset,N.m.bitset.isSDF),n=(0,h.qD)(e.bitset,N.m.bitset.isMapAligned),u=(0,h.qD)(e.bitset,N.m.bitset.scaleSymbolsProportionally),c=(0,h.h7)(e.bitset,N.m.bitset.colorLocked),p=F(this,e.id),d=I(this,e.id,e.color,c).multiply(p),m=this.view.displayViewScreenMat3.multiply(new l.AO(e.pos.xy,1)),f=M(this,e.id,s).divide(s),v=i.multiply(f),y=e.offset.xy.multiply(f);let b=o.multiply(u.multiply(f.subtract(1)).add(1));b=(0,l.VV)(b,(0,l.Fp)(v.subtract(.99),new l.bv(0)));const g=(0,l.Fp)(b,new l.bv(1)),x=(0,l.VV)(b,new l.bv(1)),w=l.Tu.fromRotation(r.multiply(_.e4)),S=E(this,e.id),V=this._getViewRotationMatrix(n).multiply(S).multiply(w).multiply(new l.AO(y.xy,0)),z=this.clip(e.id,e.zoomRange),T=new l.T8(m.xy.add(V.xy),z,1),O=e.textureUV.divide(this.mosaicInfo.size),A=e.outlineColor.multiply(x),P=(0,h.qD)(e.bitset,N.m.bitset.overrideOutlineColor),C=e.sdfDecodeCoeff.multiply(v);return{glPosition:T,color:d,textureUV:O,outlineColor:A,outlineSize:g,distanceToPx:C,isSDF:a,overrideOutlineColor:P,...this.maybeRunHittest(e,t,{pos:e.pos,size:v,sizeCorrection:f,isMapAligned:n,vvRotationMat3:S,placementMat3:w,outlineSize:g,distanceToPx:C,isSDF:a})}}fragment(e){const t=this._getColor(e.textureUV,e);return this.getFragmentOutput(t,e)}hittest(e,t,i){return(0,l.KJ)((0,l.Qj)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(e,t,i),this._hittestMarker(e,t,i))}_getViewRotationMatrix(e){const t=this.view.displayViewMat3,i=this.view.displayMat3,o=new l.bv(1).subtract(e);return t.multiply(e).add(i.multiply(o))}_getViewScreenMatrix(e){const t=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,o=new l.bv(1).subtract(e);return t.multiply(e).add(i.multiply(o))}_getColor(e,t){return(0,l.KJ)((0,l.ln)(t.isSDF,new l.bv(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return(0,l.ig)(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){const i=(0,l.ig)(this.mosaicInfo.texture,e),o=new l.bv(.5).subtract((0,h.JH)(i)).multiply(t.distanceToPx).multiply(_.nU),s=(0,l.uZ)(new l.bv(.5).subtract(o),new l.bv(0),new l.bv(1)),r=t.color.multiply(s);let a=t.outlineSize;this.highlight&&(a=(0,l.Fp)(a,t.overrideOutlineColor.multiply(4)));const n=a.multiply(.5),u=(0,l.Wn)(o).subtract(n),c=(0,l.uZ)(new l.bv(.5).subtract(u),new l.bv(0),new l.bv(1)),p=(0,l.CD)(t.outlineColor,t.color,t.overrideOutlineColor).multiply(c);return new l.bv(1).subtract(p.a).multiply(r).add(p)}_hittestSmallMarker(e,t,i){const{position:o,distance:s,smallSymbolDistance:r}=this.hittestRequest,a=s.subtract(r),{viewMat3:n,tileMat3:u}=this.view,c=n.multiply(u).multiply(new l.AO(i.pos,1)).xy,p=i.size.multiply(.5);return(0,l.TE)(c,o).subtract(p).add(a)}_hittestMarker(e,t,i){const{pos:o,sizeCorrection:s,isMapAligned:r}=i,a=new l.AO(e.offset.multiply(s),0),n=new l.AO(t.offsetNextVertex1.multiply(s),0),u=new l.AO(t.offsetNextVertex2.multiply(s),0),{viewMat3:c,tileMat3:p}=this.view,d=c.multiply(p).multiply(new l.AO(o,1)),h=this._getViewScreenMatrix(r).multiply(i.vvRotationMat3).multiply(i.placementMat3),m=d.add(h.multiply(a)).xy,f=d.add(h.multiply(n)).xy,v=d.add(h.multiply(u)).xy,y=this.hittestRequest.position,b=this.hittestRequest.distance,g=$(y,m,f,v);return(0,l.KJ)((0,l.tS)(g,b),g,this._hittestSamples(m,f,v,e,t,i))}_hittestSamples(e,t,i,o,s,r){const{outlineSize:a,isSDF:n,distanceToPx:u}=r,c=this.hittestRequest.position,p=this.hittestRequest.distance,d=U(c.add(new l.Sg((0,l.tk)(p),(0,l.tk)(p))),e,t,i),h=U(c.add(new l.Sg(0,(0,l.tk)(p))),e,t,i),m=U(c.add(new l.Sg(p,(0,l.tk)(p))),e,t,i),f=U(c.add(new l.Sg((0,l.tk)(p),0)),e,t,i),v=U(c,e,t,i),y=U(c.add(new l.Sg(p,0)),e,t,i),b=U(c.add(new l.Sg((0,l.tk)(p),p)),e,t,i),g=U(c.add(new l.Sg(0,p)),e,t,i),x=U(c.add(new l.Sg(p,p)),e,t,i),w=o.textureUV.divide(this.mosaicInfo.size),S=s.textureUVNextVertex1.divide(this.mosaicInfo.size),_=s.textureUVNextVertex2.divide(this.mosaicInfo.size),V={color:new l.T8(1),outlineColor:new l.T8(1),overrideOutlineColor:new l.bv(1),outlineSize:a,distanceToPx:u,isSDF:n};let z=new l.bv(0);return z=z.add(B(d).multiply(this._getColor(Ft(d,w,S,_),V).a)),z=z.add(B(h).multiply(this._getColor(Ft(h,w,S,_),V).a)),z=z.add(B(m).multiply(this._getColor(Ft(m,w,S,_),V).a)),z=z.add(B(f).multiply(this._getColor(Ft(f,w,S,_),V).a)),z=z.add(B(v).multiply(this._getColor(Ft(v,w,S,_),V).a)),z=z.add(B(y).multiply(this._getColor(Ft(y,w,S,_),V).a)),z=z.add(B(b).multiply(this._getColor(Ft(b,w,S,_),V).a)),z=z.add(B(g).multiply(this._getColor(Ft(g,w,S,_),V).a)),z=z.add(B(x).multiply(this._getColor(Ft(x,w,S,_),V).a)),(0,l.Nb)(z,new l.bv(.05)).multiply(G(this.hittestRequest))}}(0,r._)([(0,n.Kw)(z)],Ht.prototype,"visualVariableColor",void 0),(0,r._)([(0,n.Kw)(T)],Ht.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,n.Kw)(O)],Ht.prototype,"visualVariableRotation",void 0),(0,r._)([(0,n.Kw)(A)],Ht.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,n.Kw)(P)],Ht.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,n.Kw)(C)],Ht.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,n.Kw)(D)],Ht.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,n.e5)(V)],Ht.prototype,"mosaicInfo",void 0),(0,r._)([(0,r.a)(0,(0,n.qH)(Mt)),(0,r.a)(1,(0,n.qH)(It))],Ht.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,n.qH)(class extends x{}))],Ht.prototype,"fragment",null);var kt=i(21130),Lt=i(82125);class qt{constructor(){this.computeAttributes={}}get locationsMap(){const e=new Map;for(const t in this.locations)e.set(t,this.locations[t].index);return e}get optionPropertyKeys(){if(!this._optionPropertyKeys){const e=new Set(Object.keys(this.options));this._optionPropertyKeys=e}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const e=this.locationsMap,t=Array.from(e.entries()).map((([e,t])=>`${e}.${t}`)).join("."),i=(0,kt.hP)(t);this._locationInfo={hash:i,stringHash:t,locations:e,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const e=new Map;for(const[t,i]of this.locationsMap.entries())e.set("a_"+t,i);return e}getShaderKey(e,t,i){return`${Object.keys(e).map((t=>`${t}.${e[t]}`)).join(".")}.${Object.keys(i).filter((e=>i[e])).map((e=>`${e}_${i[e].toString()}`)).join(".")}.${Object.keys(t).filter((e=>this.optionPropertyKeys.has(e))).join(".")}`}getProgram(e,t,i,o){let s="",r="";for(const e in i)if(i[e]){const t="boolean"==typeof i[e]?`#define ${e}\n`:`#define ${e} ${i[e]}\n`;s+=t,r+=t}return s+=this.vertexShader,r+=this.fragmentShader,new Lt.X(s,r,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(t),this._transformFeedbackBindings)}_getUniformBindings(e){const t=[];for(const e in this.required){const i=this.required[e];t.push({uniformHydrated:null,shaderModulePath:e,uniformName:e,uniformType:i.type,uniformArrayElementType:Nt(i),uniformArrayLength:Kt(i)})}for(const i in e){const o=this.options[i];if(e[i])for(const e in o){const s=o[e];t.push({uniformHydrated:null,shaderModulePath:`${i}.${e}`,uniformName:e,uniformType:s.type,uniformArrayElementType:Nt(s),uniformArrayLength:Kt(s)})}}return t}}const Nt=e=>"array"===e.type?e.elementType?.type:void 0,Kt=e=>"array"===e.type?e.size:void 0;var Bt=i(74580);const Ut={hittestDist:l.bv,hittestPos:l.Sg},Zt={filterFlags:l.Eg,animation:l.Eg,visualVariableData:l.Eg,dataDriven0:l.Eg,dataDriven1:l.Eg,dataDriven2:l.Eg,gpgpu:l.Eg,size:l.bv},$t={displayViewScreenMat3:l.Tu,displayViewMat3:l.Tu,displayMat3:l.Tu,viewMat3:l.Tu,tileMat3:l.Tu,displayZoomFactor:l.bv,requiredZoomFactor:l.bv,tileOffset:l.Sg,currentScale:l.bv,currentZoom:l.bv,metersPerSRUnit:l.bv};class Gt extends qt{constructor(){super(...arguments),this.vertexShader=(0,Bt.w)("materials/pie/pie.vert"),this.fragmentShader=(0,Bt.w)("materials/pie/pie.frag"),this.required={...Zt,...$t,outlineWidth:l.bv,colors:l.v8,defaultColor:l.T8,othersColor:l.T8,outlineColor:l.T8,donutRatio:l.bv,sectorThreshold:l.bv},this.options={hittestUniforms:Ut,visualVariableSizeMinMaxValue:{minMaxValueAndSize:l.T8},visualVariableSizeScaleStops:{sizes:{...l.v8.ofType(l.bv,8),type:"array",elementType:l.bv,size:8},values:{...l.v8.ofType(l.bv,8),type:"array",elementType:l.bv,size:8}},visualVariableSizeStops:{sizes:{...l.v8.ofType(l.bv,8),type:"array",elementType:l.bv,size:8},values:{...l.v8.ofType(l.bv,8),type:"array",elementType:l.bv,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:l.bv},visualVariableOpacity:{opacities:{...l.v8.ofType(l.bv,8),type:"array",elementType:l.bv,size:8},opacityValues:{...l.v8.ofType(l.bv,8),type:"array",elementType:l.bv,size:8}}},this.locations={pos:{index:0,type:l.Sg},id:{index:1,type:l.AO},bitset:{index:2,type:l.bv},offset:{index:3,type:l.Sg},texCoords:{index:4,type:l.Sg},size:{index:5,type:l.Sg},referenceSize:{index:6,type:l.bv},zoomRange:{index:7,type:l.Sg}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(e){this.required.colors={...l.v8.ofType(l.T8,e),type:"array",elementType:l.T8,size:e}}}const Wt={fill:new class extends ie{constructor(){super(...arguments),this.type=s.t.Fill,this.shaders={geometry:new Ve}}render(e,t){const{painter:i}=e,o=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,o.uniforms),...(0,oe.l5)(e,t.target)},defines:(0,oe.rO)(e),optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}),i.setPipelineState((0,oe.H6)(e)),i.submitDraw(e,t)}},patternFill:new class extends ie{constructor(){super(...arguments),this.type=s.t.PatternFill,this.shaders={geometry:new Ge}}render(e,t){const{context:i,painter:o}=e,s=t.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,s.uniforms),...(0,oe.l5)(e,t.target),mosaicInfo:o.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,oe.wb)(t.target)},defines:{...(0,oe.rO)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}),o.setPipelineState((0,oe.H6)(e)),o.submitDraw(e,t)}},complexFill:new class extends ie{constructor(){super(...arguments),this.type=s.t.ComplexFill,this.shaders={geometry:new Pe}}render(e,t){const{context:i,painter:o}=e,s=t.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,s.uniforms),...(0,oe.l5)(e,t.target),mosaicInfo:o.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,oe.wb)(t.target)},defines:{...(0,oe.rO)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}),o.setPipelineState((0,oe.H6)(e)),o.submitDraw(e,t)}},gradientFill:new class extends ie{constructor(){super(...arguments),this.type=s.t.GradientFill,this.shaders={geometry:new it},this.symbologyPlane=o.mH.FILL}render(e,t){const{context:i,painter:o}=e,s=t.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,s.uniforms),...(0,oe.l5)(e,t.target),mosaicInfo:o.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...(0,oe.rO)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}),o.setPipelineState((0,oe.H6)(e)),o.submitDraw(e,t)}},outlineFill:new class extends ie{constructor(){super(...arguments),this.type=s.t.OutlineFill,this.shaders={geometry:new Be}}render(e,t){const{painter:i,pixelRatio:o}=e,s=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,s.uniforms),...(0,oe.l5)(e,t.target),antialiasingControls:Ce(o)},defines:{...(0,oe.rO)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}),i.setPipelineState((0,oe.H6)(e)),i.submitDraw(e,t)}},patternOutlineFill:new class extends ie{constructor(){super(...arguments),this.type=s.t.PatternOutlineFill,this.shaders={geometry:new je}}render(e,t){const{context:i,painter:o,pixelRatio:s}=e,r=t.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,r.uniforms),...(0,oe.l5)(e,t.target),antialiasingControls:Ce(s),mosaicInfo:o.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,oe.wb)(t.target)},defines:{...(0,oe.rO)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}),o.setPipelineState((0,oe.H6)(e)),o.submitDraw(e,t)}},complexOutlineFill:new class extends ie{constructor(){super(...arguments),this.type=s.t.ComplexOutlineFill,this.shaders={geometry:new Ye}}render(e,t){const{context:i,painter:o,pixelRatio:s}=e,r=t.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,r.uniforms),...(0,oe.l5)(e,t.target),antialiasingControls:Ce(s),mosaicInfo:o.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,oe.wb)(t.target)},defines:{...(0,oe.rO)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}),o.setPipelineState((0,oe.H6)(e)),o.submitDraw(e,t)}},marker:new class extends ie{constructor(){super(...arguments),this.type=s.t.Marker,this.shaders={geometry:new Ht},this.symbologyPlane=o.mH.MARKER}render(e,t){const{context:i,painter:o}=e,s=t.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,s.uniforms),...(0,oe.l5)(e,t.target),mosaicInfo:o.textureManager.getMosaicInfo(i,t.textureKey,!0)},defines:{...(0,oe.rO)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}),o.setPipelineState((0,oe.H6)(e)),o.submitDraw(e,t)}},pieChart:new class extends ie{constructor(){super(...arguments),this.type=s.t.PieChart,this.shaders={geometry:new Gt},this.symbologyPlane=o.mH.MARKER}render(e,t){const{painter:i}=e,{instance:o,target:s}=t,r=this.shaders.geometry,a=o.getInput(),n=a.uniforms.numberOfFields,l=(0,oe.VF)(e),u=(0,oe.l5)(e,s),c=(0,oe.rO)(e);r.setNumberOfFields(n),i.setShader({shader:r,uniforms:{...(0,oe.vY)(e,t.target,a.uniforms.shader),...u.storage,...u.view,hittestUniforms:u.hittestRequest?{hittestDist:u.hittestRequest?.distance,hittestPos:u.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!a.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!a.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!a.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!a.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!a.uniforms.shader.visualVariableOpacity,HITTEST:l,highlight:u.highlight?1:0,...c,numberOfFields:n},optionalAttributes:{},useComputeBuffer:l}),i.setPipelineState((0,oe.H6)(e)),i.submitDraw(e,t)}},line:new class extends ie{constructor(){super(...arguments),this.type=s.t.Line,this.shaders={geometry:new ke},this.symbologyPlane=o.mH.LINE}render(e,t){const{painter:i,pixelRatio:o}=e,s=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,s.uniforms),...(0,oe.l5)(e,t.target),antialiasingControls:Ce(o)},defines:{...(0,oe.rO)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}),i.setPipelineState((0,oe.H6)(e)),i.submitDraw(e,t)}},texturedLine:new class extends ie{constructor(){super(...arguments),this.type=s.t.TexturedLine,this.shaders={geometry:new Rt},this.symbologyPlane=o.mH.LINE}render(e,t){const{context:i,painter:o,pixelRatio:s}=e,r=t.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,r.uniforms),...(0,oe.l5)(e,t.target),antialiasingControls:Ce(s),mosaicInfo:o.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...(0,oe.rO)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}),o.setPipelineState((0,oe.H6)(e)),o.submitDraw(e,t)}},gradientStroke:new class extends ie{constructor(){super(...arguments),this.type=s.t.GradientStroke,this.shaders={geometry:new At},this.symbologyPlane=o.mH.LINE}_getShaderOptions(e,t,i){const{context:o,painter:s,pixelRatio:r}=e,a=t.instance.getInput();return{shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,a.uniforms),...(0,oe.l5)(e,t.target),antialiasingControls:Ce(r),mosaicInfo:s.textureManager.getMosaicInfo(o,t.textureKey),technique:{isColorPass:i}},defines:{...(0,oe.rO)(e)},optionalAttributes:a.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)}}render(e,t){const{painter:i}=e;if((0,oe.VF)(e)||(0,oe.il)(e)){const o=(0,oe.H6)(e);return i.setPipelineState(o),i.setShader(this._getShaderOptions(e,t,1)),void i.submitDraw(e,t)}e.context.setClearDepth(1),e.context.clear(fe.Hf.DEPTH);const o={color:!1,depth:{write:{zNear:0,zFar:1},test:fe.wb.LESS},stencil:{write:!1,test:{ref:e=>e.stencilRef,compare:fe.wb.EQUAL,mask:255,op:{fail:fe.xS.KEEP,zFail:fe.xS.KEEP,zPass:fe.xS.KEEP}}}};i.setShader(this._getShaderOptions(e,t,0)),i.setPipelineState(o),i.submitDraw(e,t);const s={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:{write:!1,test:fe.wb.LEQUAL},stencil:{write:!1,test:{ref:e=>e.stencilRef,compare:fe.wb.EQUAL,mask:255,op:{fail:fe.xS.KEEP,zFail:fe.xS.KEEP,zPass:fe.xS.KEEP}}}};i.setShader(this._getShaderOptions(e,t,1)),i.setPipelineState(s),i.submitDraw(e,t)}},text:new class extends ie{constructor(){super(...arguments),this.type=s.t.Text,this.shaders={geometry:new Vt},this.symbologyPlane=o.mH.TEXT}render(e,t){const{context:i,painter:o}=e,s=(0,oe.rO)(e),r=t.instance.getInput(),a={shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,r.uniforms),...(0,oe.l5)(e,t.target),mosaicInfo:o.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...s,isBackgroundPass:!0,isLabel:!1,textRenderPassType:wt.Color},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)};o.setShader(a),o.setPipelineState((0,oe.H6)(e)),o.submitDraw(e,t),o.setShader({...a,defines:{...s,isBackgroundPass:!1,isLabel:!1,textRenderPassType:wt.Halo}}),o.submitDraw(e,t),o.setShader({...a,defines:{...s,isBackgroundPass:!1,isLabel:!1,textRenderPassType:wt.Outline}}),o.submitDraw(e,t),o.setShader({...a,defines:{...s,isBackgroundPass:!1,isLabel:!1,textRenderPassType:wt.Color}}),o.submitDraw(e,t)}},label:new class extends ie{constructor(){super(...arguments),this.type=s.t.Label,this.shaders={geometry:new Vt},this.drawPhase=o.jx.LABEL|o.jx.LABEL_ALPHA|o.jx.HITTEST,this.symbologyPlane=o.mH.TEXT}render(e,t){const{context:i,painter:o}=e,s=(0,oe.rO)(e),r={...(0,oe.H6)(e)},a=t.instance.getInput(),n={shader:this.shaders.geometry,uniforms:{...(0,oe.vY)(e,t.target,a.uniforms),...(0,oe.l5)(e,t.target),mosaicInfo:o.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...s,textRenderPassType:wt.Color,isBackgroundPass:!0,isLabel:!0},optionalAttributes:a.optionalAttributes,useComputeBuffer:(0,oe.VF)(e)};o.setPipelineState(r),o.setShader(n),o.submitDraw(e,t),o.setShader({...n,defines:{...s,textRenderPassType:wt.Halo,isBackgroundPass:!1,isLabel:!0}}),o.submitDraw(e,t),o.setShader({...n,defines:{...s,textRenderPassType:wt.Color,isBackgroundPass:!1,isLabel:!0}}),o.submitDraw(e,t)}},heatmap:new class extends ie{constructor(){super(...arguments),this.type=s.t.Heatmap,this.drawPhase=o.jx.MAP|o.jx.HITTEST|o.jx.DEBUG,this.shaders={accumulate:new ct,resolve:new ft},this._isBound=!1,this._resources=new Map}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e),this._prevFBO=null,this._unbind()}render(e,t){const{context:i,painter:o,state:s}=e,r=t.instance.getInput(),{isFieldActive:a}=r.uniforms,n=this._getOrCreateResourcesRecord(i),l=n.loadQualityProfile(i);(0,oe.VF)(e)||this._bind(e,n,r),o.setShader({shader:this.shaders.accumulate,uniforms:{...(0,oe.l5)(e,t.target),kernelControls:{radius:xt(r,s),isFieldActive:a?1:0}},defines:{...(0,oe.rO)(e),...l.defines},optionalAttributes:{},useComputeBuffer:(0,oe.VF)(e)});const u=(0,oe.VF)(e)?bt:yt;o.setPipelineState(u),o.submitDraw(e,t)}getStencilReference(e){return vt(e)}renderResolvePass(e,t){if((0,oe.VF)(e))return;const{context:i,painter:o}=e,s=this._resources.get(i);if(null==this._prevFBO||null==this._prevViewport||!s?.initialized)return;const{defines:r}=s.loadQualityProfile(i),{minDensity:a,maxDensity:n,radius:l}=t.getInput().uniforms,u=s.accumulateFramebuffer,c=s.resolveGradientTexture,p={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:u.colorTexture},minAndInvRange:[a,1/(n-a)],normalization:3/(l*l*Math.PI)},gradient:{texture:{unit:9,texture:c}}},defines:r,optionalAttributes:{},useComputeBuffer:!1};i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(u.colorTexture,8),i.bindTexture(c,9),o.setPipelineState(gt),o.submitDrawMesh(i,p,o.quadMesh),this._unbind()}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new at,this._resources.set(e,t)),t}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(e,t,i){if(this._isBound)return;const{context:o,state:s,pixelRatio:r}=e,a=o.getBoundFramebufferObject(),n=o.getViewport();this._prevFBO=a,this._prevViewport=n;const{gradient:l,gradientHash:u}=i.uniforms;t.ensureResolveGradientTexture(o,u,l);const{width:c,height:p}=n,d=function(e,t){const i=t>1.5?.25:.5;return e<1/(2*i)?1:i}(xt(i,s),r),h=c*d,m=p*d,f=t.ensureAccumulateFBO(o,h,m);o.blitFramebuffer(a,f,0,0,a.width,a.height,0,0,f.width,f.height,fe.Hf.STENCIL,fe.cw.NEAREST),o.bindFramebuffer(f),o.setViewport(0,0,f.width,f.height),o.setColorMask(!0,!0,!0,!0),o.setClearColor(0,0,0,0),o.clear(fe.Hf.COLOR),this._isBound=!0}},dotDensity:new class extends ie{constructor(){super(...arguments),this.type=s.t.DotDensity,this.shaders={polygon:new de,point:new le,fill:new Ve},this._resources=new Map}render(e,t){(0,oe.il)(e)||(0,oe.VF)(e)?this._renderPolygons(e,t):this._renderDotDensity(e,t)}_renderPolygons(e,t){const{painter:i}=e;i.setShader({shader:this.shaders.fill,uniforms:{...(0,oe.l5)(e,t.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,oe.rO)(e)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,oe.VF)(e)}),i.setPipelineState((0,oe.H6)(e)),i.submitDraw(e,t)}_renderDotDensity(e,t){const{context:i,painter:o,requiredLevel:s}=e,r=t.instance.getInput().uniforms,a=this._getOrCreateResourcesRecord(i),n=a.getDotDensityTextures(i,p.i9,r.seed),l=1/2**(s-t.target.key.level),u=p.i9,c=u*window.devicePixelRatio*u*window.devicePixelRatio,d=1/l*(1/l),h=r.dotScale?e.state.scale/r.dotScale:1,m=r.dotValue*h*d;o.setShader({shader:this.shaders.polygon,uniforms:{...(0,oe.l5)(e,t.target),instance:{isActive:r.isActive,colors:r.colors,dotValue:Math.max(1,m)},draw:{dotTexture0:{unit:p.Of,texture:n[0]},dotTexture1:{unit:p.vk,texture:n[1]},tileZoomFactor:l,pixelRatio:window.devicePixelRatio,tileDotsOverArea:c/(p.i9*window.devicePixelRatio*p.i9*window.devicePixelRatio)}},defines:{...(0,oe.rO)(e),blending:r.blending},optionalAttributes:{},useComputeBuffer:!1});const f=i.getViewport();i.setViewport(0,0,p.i9,p.i9);const v=i.getBoundFramebufferObject(),y=a.getFBO(i);i.bindFramebuffer(y),i.setClearColor(0,0,0,0),i.clear(fe.Hf.COLOR),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.updatePipelineState(i),o.submitDraw(e,t),i.bindFramebuffer(v),i.setViewport(f.x,f.y,f.width,f.height);const b=a.getFBO(i).colorTexture,g={shader:this.shaders.point,uniforms:{view:(0,oe.yF)(e,t.target),instance:{dotSize:r.dotSize},draw:{locations:{unit:p.Of,texture:b},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,oe.rO)(e)},optionalAttributes:{},useComputeBuffer:!1};o.setPipelineState((0,oe.H6)(e)),o.submitDrawMesh(i,g,a.getDotDensityMesh(i))}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e)}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new Se,this._resources.set(e,t)),t}},animatedMarker:new class extends se{constructor(){super(...arguments),this.type=s.t.AnimatedMarker,this.symbologyPlane=o.mH.MARKER,this.shaders={geometry:new Q}}}};function Jt(){for(const e in Wt)Wt[e].startup()}function jt(e){for(const t in Wt)Wt[t].shutdown(e)}},33988:(e,t,i)=>{i.d(t,{T:()=>o,s:()=>s});const o={linear:0,rectangular:1,circular:2},s={isAbsolute:0,isDiscrete:1}},18235:(e,t,i)=>{i.d(t,{s:()=>o});const o={isAlongLine:0,isAbsoluteSize:1,isDiscrete:2}},70080:(e,t,i)=>{i.d(t,{m:()=>o});const o={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}}},44255:(e,t,i)=>{var o;i.d(t,{$1:()=>_,$r:()=>x,Ay:()=>n,B7:()=>b,GS:()=>m,Ho:()=>p,Ke:()=>c,MO:()=>o,NS:()=>V,T5:()=>d,Ux:()=>v,V_:()=>u,WD:()=>f,Wq:()=>y,ad:()=>w,e4:()=>r,h:()=>S,k9:()=>h,mL:()=>g,nF:()=>s,nU:()=>a,xp:()=>l}),function(e){e[e.Geographic=0]="Geographic",e[e.Arithmatic=1]="Arithmatic"}(o||(o={}));const s=3.14159265359/180,r=3.14159265359/128,a=1,n=1.1,l=1,u=24,c=8,p=1e-5,d=.05,h=1e-30,m=4,f=0,v=2,y=2,b=3,g=0,x=3,w=16777216,S=1.1,_=16,V=128},22070:(e,t,i)=>{i.d(t,{Fn:()=>g,In:()=>n,JH:()=>f,RZ:()=>y,TN:()=>a,Wv:()=>m,X3:()=>v,bG:()=>d,eO:()=>b,h7:()=>p,hG:()=>h,pK:()=>u,qD:()=>c,xQ:()=>l});var o=i(14266),s=i(77524),r=i(44255);function a(e){const t=(0,s.fz)(12.9898),i=(0,s.fz)(78.233),o=(0,s.fz)(43758.5453),r=(0,s.AK)(e,(0,s.K4)(t,i)),a=(0,s.wQ)(r,(0,s.fz)(3.14));return(0,s.ZI)((0,s.O$)(a).multiply(o))}function n(e){return(0,s.ln)(e,(0,s.fz)(r.k9))}function l(e,t){return e.x.multiply(t.y).subtract(t.x.multiply(e.y))}function u(e){return e.multiply(2).subtract(1)}function c(e,t){const i=(0,s.fz)(2**t);return(0,s.wQ)((0,s.GW)(e.divide(i)),(0,s.fz)(2))}function p(e,t){return(0,s.tS)(c(e,t),(0,s.fz)(.5))}function d(e,t){return c(e,t+o.IZ)}function h(e,t){return c(e,t)}function m(e){const t=c(e.z,7),i=(0,s.fz)(1).subtract(t),o=e.xyz.subtract((0,s.R3)(0,0,(0,s.fz)(128)));return i.multiply(e).add(t.multiply(o))}function f(e){const t=(0,s.vh)(255/256,255/65536,255/16777216,255/4294967296);return(0,s.AK)(e,t)}function v(e){return(0,s.Fp)((0,s.Fp)((0,s.Fp)(e.x,e.y),e.z),e.w)}function y(e){return new s.bv(1).subtract(e)}function b(e){return e.subtract(new s.bv(1))}function g(e,t){return e.subtract(new s.bv(t))}},54746:(e,t,i)=>{i.d(t,{$F:()=>l,IQ:()=>u,vZ:()=>d});var o=i(7753),s=i(39943),r=i(38716),a=i(54680),n=i(35119);function l(e,t){return{type:"simple",filters:t,capabilities:{maxTextureSize:(0,n.h)().maxTextureSize},bindings:p(e)}}function u(e,t){const i=(0,n.h)();return{type:"multi",target:"feature",keyField:s.m6,filters:t,capabilities:{maxTextureSize:i.maxTextureSize},bindings:{[s.ZO.TrackLine]:p(e.trackLines.renderer),[s.ZO.LatestObservation]:p(e.latestObservations.renderer),[s.ZO.PreviousObservation]:p(e.previousObservations.renderer)}}}function c(e){switch(e){case"opacity":return r.CU.OPACITY;case"color":return r.CU.COLOR;case"rotation":return r.CU.ROTATION;case"size":return r.CU.SIZE;default:return null}}function p(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return d(e);case"dot-density":return function(e){const t=[];for(const i of e.attributes)t.push({binding:t.length,expression:i.valueExpression,field:i.field});return t}(e);case"pie-chart":return function(e){const t=d(e);let i=4;for(const o of e.attributes)t.push({binding:i++,expression:o.valueExpression,field:o.field});return t}(e);case"heatmap":return function({valueExpression:e,field:t}){return e||t?[{binding:0,expression:e,field:t}]:[]}(e)}}function d(e){return"visualVariables"in e&&e.visualVariables?.length?(0,a.t)(e.visualVariables).map((e=>function(e){switch(e.type){case"size":return function(e){return"$view.scale"===e.valueExpression?null:{binding:c(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}(e);case"color":case"opacity":return function(e){return{binding:c(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}(e);case"rotation":return function(e){return{binding:c(e.type),expression:e.valueExpression,field:e.field}}(e)}}(e))).filter(o.pC):[]}},47684:(e,t,i)=>{i.d(t,{Jh:()=>b,Sc:()=>x,XS:()=>g});i(39994);var o=i(95550),s=i(17321),r=i(6923),a=i(14266),n=i(44255),l=i(10402),u=i(54680);const c=128;function p(e){if(!e.stops?.length)return null;const t=e.stops.sort(((e,t)=>e.value-t.value)),i=(0,l.Q)(t,8),o=i.map((({value:e})=>e)),s=i.map((({color:e})=>(0,l.n)(e)));return{values:o,colors:s}}function d(e){if(!e.stops?.length)return null;const t=e.stops.sort(((e,t)=>e.value-t.value)),i=(0,l.Q)(t,8);return{opacityValues:i.map((({value:e})=>e)),opacities:i.map((({opacity:e})=>e))}}function h(e){return{rotationType:"geographic"===e.rotationType?n.MO.Geographic:n.MO.Arithmatic}}function m(e){if(!e.stops?.length)return null;if(e.stops.some((e=>e.useMaxValue||e.useMinValue)))return(t,i)=>{const s=t.statisticsByLevel.get(i.key.level),r=e.stops.map((t=>({value:t.useMaxValue?s?.get(e.field)?.maxValue??0:t.useMinValue?s?.get(e.field)?.minValue??0:t.value,size:t.size?(0,o.F2)(t.size):a.k9}))).sort(((e,t)=>e.value-t.value)),n=(0,l.Q)(r,8);return{values:n.map((({value:e})=>e)),sizes:n.map((({size:e})=>e))}};const t=e.stops.sort(((e,t)=>e.value-t.value)),i=(0,l.Q)(t,8);return{values:i.map((({value:e})=>e)),sizes:i.map((({size:e})=>(0,o.F2)(e)))}}function f(e){return t=>{const{state:i}=t;return{unitValueToPixelsRatio:(0,s.c9)(i.spatialReference)/r.a[e.valueUnit??"meters"]/i.resolution}}}function v(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let o=1;o<i;o++)if(e<t[o].value){const i=(e-t[o-1].value)/(t[o].value-t[o-1].value);return t[o-1].size+i*(t[o].size-t[o-1].size)}return t[i-1].size}function y(e){const{minDataValue:t,maxDataValue:i,minSize:s,maxSize:r}=e;if("object"==typeof s&&"object"==typeof r)return(e,a)=>{const n=e.state.scale,l=(0,o.F2)(v(n,s.stops)),u=(0,o.F2)(v(n,r.stops));return{minMaxValueAndSize:[t,i,l,u]}};if("object"==typeof s||"object"==typeof r)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[t,i,(0,o.F2)(s),(0,o.F2)(r)]}}const b={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function g(e,t=128,i=1.25){if(e.visualVariableSizeMinMaxValue)return e.visualVariableSizeMinMaxValue instanceof Function?c:Math.max(e.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,t);if(e.visualVariableSizeScaleStops){if(e.visualVariableSizeScaleStops instanceof Function)return c;const o=e.visualVariableSizeScaleStops.sizes;return Math.max(o[o.length-1]*i,t)}if(e.visualVariableSizeStops){if(e.visualVariableSizeStops instanceof Function)return c;const o=e.visualVariableSizeStops.sizes;return Math.max(o[o.length-1]*i,t)}return e.visualVariableSizeUnitValue?256:0}function x(e){const t={...b};if(!e||!("visualVariables"in e)||!e.visualVariables)return t;for(const i of(0,u.t)(e.visualVariables))switch(i.type){case"color":t.visualVariableColor=p(i);break;case"opacity":t.visualVariableOpacity=d(i);break;case"rotation":t.visualVariableRotation=h(i);break;case"size":switch(w(i)){case"field-stops":t.visualVariableSizeStops=m(i);break;case"scale-stops":"outline"===i.target?t.visualVariableSizeOutlineScaleStops=m(i):t.visualVariableSizeScaleStops=m(i);break;case"min-max":t.visualVariableSizeMinMaxValue=y(i);break;case"unit-value":t.visualVariableSizeUnitValue=f(i)}}return t}function w(e){return"number"==typeof e.minDataValue&&"number"==typeof e.maxDataValue&&null!=e.minSize&&null!=e.maxSize?"min-max":"$view.scale"===e?.valueExpression&&Array.isArray(e.stops)?"scale-stops":null==e.field&&"$view.scale"===e?.valueExpression||!(Array.isArray(e.stops)||"levels"in e&&e.levels)?null!=e.field||"$view.scale"!==e?.valueExpression?"unit-value":null:"field-stops"}},10402:(e,t,i)=>{function o(e,t){const i=e.slice(0,t),o=t-i.length;for(let e=0;e<o;e++){const e=i[i.length-1];i.push(e)}return i}function s(e){if(!e)return[0,0,0,0];const{r:t,g:i,b:o,a:s}=e;return[t*(s/255),i*(s/255),o*(s/255),s]}i.d(t,{Q:()=>o,n:()=>s})},89978:(e,t,i)=>{i.d(t,{$L:()=>p,Ge:()=>g,KR:()=>S,QA:()=>O,T4:()=>z,U9:()=>f,UX:()=>u,Xs:()=>h,cs:()=>_,ep:()=>y,zw:()=>m});var o=i(95215),s=i(42512),r=i(25609),a=i(39893),n=i(47684),l=i(79456);function u(e){return e.minScale||e.maxScale?{minScale:e.minScale??0,maxScale:e.maxScale??0}:null}function c(e){if(null==e)return null;if(Array.isArray(e)){const[t,i,o,s]=e;return[t,i,o,255*s]}return"string"==typeof e?e:{...e,defaultValue:c(e?.defaultValue)}}async function p(e,t){const{cimResourceManager:i,cimAnalyzer:s,scaleExpression:r}=t.schemaOptions;await Promise.all(o.B$.fetchResources(e.symbol,i,[]));const a=s.analyzeSymbolReference(e,!1),n={scaleInfo:u(e),scaleExpression:r},l=[];for(const e of a)switch(e.type){case"marker":l.push(...d(e,t,n));break;case"fill":l.push(...v(e,t,n));break;case"gradientFill":l.push(...b(e,t,n));break;case"line":l.push(...x(e,t,n));break;case"gradientStroke":l.push(...V(e,t,n));break;case"text":l.push(...T(e,t,n))}return l}function d(e,t,i){const{uniforms:o,schemaOptions:s}=t,{store:r}=s,l=e.isOutline?{...n.Jh,visualVariableSizeScaleStops:o.visualVariableSizeOutlineScaleStops}:{visualVariableColor:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity,visualVariableSizeMinMaxValue:o.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:o.visualVariableSizeScaleStops,visualVariableSizeStops:o.visualVariableSizeStops,visualVariableSizeUnitValue:o.visualVariableSizeUnitValue,visualVariableRotation:o.visualVariableRotation};return e.animationParams?h(r.ensureInstance(a.k2.animatedMarker,{uniforms:l,optionalAttributes:{zoomRange:!0}}),e,n.Jh,i):m(r.ensureInstance(a.k2.marker,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,o,i)}function h(e,t,i,o){return t.animationParams?[e.createMeshInfo({pixelDimensions:t.pixelDimensions,texelDimensions:t.texelDimensions,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,sprite:t.spriteRasterizationParam,animations:t.animationParams,scaleInfo:o.scaleInfo,scaleSymbolsProportionally:t.scaleSymbolsProportionally,strokeWidth:t.outlineWidth,isMapAligned:t.alignment===r.v2.MAP,colorLocked:t.colorLocked,isStroke:t.isStroke,baseSize:t.baseSize,referenceSize:t.referenceSize,angleToLine:!!t.markerPlacement&&t.markerPlacement.placement&&"angleToLine"in t.markerPlacement.placement&&t.markerPlacement.placement.angleToLine,sizeRatio:t.sizeRatio})]:[]}function m(e,t,i,{scaleInfo:o,scaleExpression:r}){const a=(0,l.h)(i);return[e.createMeshInfo({size:t.size,scaleX:t.scaleX,anchorX:t.anchorPoint.x,anchorY:t.anchorPoint.y,angle:t.rotation,color:c(t.color)??[0,0,0,0],colorLocked:t.colorLocked,frameHeight:t.frameHeight,widthRatio:t.widthRatio,scaleInfo:o,offsetX:t.offsetX,offsetY:t.offsetY,outlineColor:c(t.outlineColor)??[0,0,0,0],outlineSize:t.outlineWidth,referenceSize:t.referenceSize||s.E.CIMVectorMarker.size,rotateClockwise:t.rotateClockwise,scaleFactor:r??1,sizeRatio:t.sizeRatio,alignment:t.alignment,isAbsoluteAnchorPoint:t.isAbsoluteAnchorPoint,scaleSymbolsProportionally:t.scaleSymbolsProportionally,sprite:t.spriteRasterizationParam,hasSizeVV:a,placement:t.markerPlacement,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,transforms:t.transform,minPixelBuffer:(0,n.XS)(i)})]}function f(e,t,{scaleInfo:i}){return[e.createMeshInfo({color:c(t.color)??[0,0,0,0],scaleInfo:i,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function v(e,t,i){if(!e.spriteRasterizationParam)return function(e,t,i){const{uniforms:o,schemaOptions:s}=t,{store:r}=s;return f(r.ensureInstance(a.k2.fill,{uniforms:{visualVariableColor:e.colorLocked?null:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}(e,t,i);const{uniforms:o,schemaOptions:s}=t,{store:r}=s;return y(r.ensureInstance(a.k2.complexFill,{uniforms:{visualVariableColor:e.colorLocked?null:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,null!=o.visualVariableColor,i)}function y(e,t,i,{scaleInfo:o}){if(!t.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const s=!!t.hasUnresolvedReplacementColor&&(!i||t.colorLocked),r=t.sampleAlphaOnly&&!s,a=t.spriteRasterizationParam;return[e.createMeshInfo({color:c(t.color)??[0,0,0,0],height:t.height,aspectRatio:t.scaleX,offsetX:t.offsetX,offsetY:t.offsetY,scaleX:1,scaleY:1,angle:t.angle,applyRandomOffset:t.applyRandomOffset,sampleAlphaOnly:r,scaleProportionally:"CIMHatchFill"===a.resource.type,sprite:a,scaleInfo:o,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function b(e,t,i){const{uniforms:o,schemaOptions:s}=t,{store:r}=s;return g(r.ensureInstance(a.k2.gradientFill,{uniforms:{visualVariableColor:null,visualVariableOpacity:o.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}function g(e,t,{scaleInfo:i}){if(!t.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const o=t.spriteRasterizationParam;return[e.createMeshInfo({color:c(t.color)??[0,0,0,0],angle:t.angle,gradientMethod:t.gradientMethod,gradientSize:t.gradientSize,gradientSizeUnits:t.gradientSizeUnits,gradientType:t.gradientType,sprite:o,scaleInfo:i,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function x(e,t,i){const{uniforms:o,schemaOptions:s}=t,{store:r}=s,l=e.isOutline?{...n.Jh,visualVariableSizeScaleStops:o.visualVariableSizeOutlineScaleStops}:{visualVariableColor:e.colorLocked?null:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity,visualVariableSizeMinMaxValue:o.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:o.visualVariableSizeScaleStops,visualVariableSizeStops:o.visualVariableSizeStops,visualVariableSizeUnitValue:o.visualVariableSizeUnitValue},u={uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}},c=!!(l.visualVariableSizeMinMaxValue||l.visualVariableSizeScaleStops||l.visualVariableSizeStops||l.visualVariableSizeUnitValue);return e.spriteRasterizationParam?_(r.ensureInstance(a.k2.texturedLine,u),e,c,i):S(r.ensureInstance(a.k2.line,u),e,c,i)}function w(e,t,{scaleInfo:i}){return{color:c(e.color)??[0,0,0,0],width:e.width,referenceWidth:e.referenceWidth,capType:e.cap,joinType:e.join,miterLimit:e.miterLimit,scaleInfo:i,hasSizeVV:t,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null}}function S(e,t,i,o){if(t.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const s=w(t,i,o);return[e.createMeshInfo(s)]}function _(e,t,i,o){const{spriteRasterizationParam:s,scaleDash:r,sampleAlphaOnly:a}=t;if(!s)throw new Error("InternalError: Sprite should be defined");return[e.createMeshInfo({...w(t,i,o),offsetAlongLine:t.offsetAlongLine??0,shouldScaleDash:r??!1,shouldSampleAlphaOnly:a,isSDF:"CIMPictureStroke"!==s.resource.type&&"CIMGradientStroke"!==s.resource.type,sprite:s})]}function V(e,t,i){const{uniforms:o,schemaOptions:s}=t,{store:r}=s;return z(r.ensureInstance(a.k2.gradientStroke,{uniforms:e.isOutline?{...n.Jh,visualVariableSizeScaleStops:o.visualVariableSizeOutlineScaleStops}:{visualVariableColor:null,visualVariableOpacity:o.visualVariableOpacity,visualVariableSizeMinMaxValue:o.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:o.visualVariableSizeScaleStops,visualVariableSizeStops:o.visualVariableSizeStops,visualVariableSizeUnitValue:o.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}function z(e,t,i){if(!t.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const o=t.spriteRasterizationParam;return[e.createMeshInfo({...w(t,!1,i),gradientMethod:t.gradientMethod,gradientSize:t.gradientSize,gradientSizeUnits:t.gradientSizeUnits,gradientType:t.gradientType,sprite:o,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function T(e,t,i){const{uniforms:o,schemaOptions:s}=t,{store:r}=s;return O(r.ensureInstance(a.k2.text,{uniforms:{visualVariableColor:e.colorLocked?null:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity,visualVariableRotation:o.visualVariableRotation,visualVariableSizeMinMaxValue:o.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:o.visualVariableSizeScaleStops,visualVariableSizeStops:o.visualVariableSizeStops,visualVariableSizeUnitValue:o.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),e,o,i)}function O(e,t,i,{scaleInfo:o,scaleExpression:s}){return[e.createMeshInfo({boxBackgroundColor:c(t.backgroundColor),boxBorderLineColor:c(t.borderLineColor),boxBorderLineSize:t.borderLineWidth??0,color:c(t.color)??[0,0,0,0],offsetX:t.offsetX,offsetY:t.offsetY,postAngle:t.angle,fontSize:t.size,referenceSize:t.referenceSize,decoration:t.decoration,haloColor:c(t.haloColor)??[0,0,0,0],haloSize:t.haloSize??0,outlineColor:c(t.outlineColor)??[0,0,0,0],outlineSize:t.outlineSize,lineWidth:t.lineWidth||512,lineHeightRatio:1,horizontalAlignment:t.horizontalAlignment??"center",verticalAlignment:t.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:t.textRasterizationParam,scaleInfo:o,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,placement:t.markerPlacement,transforms:t.transform,scaleFactor:s??1,minPixelBuffer:(0,n.XS)(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}},79456:(e,t,i)=>{function o(e){return!!(e.visualVariableSizeMinMaxValue||e.visualVariableSizeScaleStops||e.visualVariableSizeStops||e.visualVariableSizeUnitValue||e.visualVariableSizeOutlineScaleStops)}function s(e){return!!e.visualVariableRotation}i.d(t,{A:()=>s,h:()=>o})},54680:(e,t,i)=>{i.d(t,{T:()=>c,t:()=>l});var o=i(70375),s=i(13802),r=i(95550),a=i(35119);const n=()=>s.Z.getLogger("esri.views.2d.layers.features.support.rendererUtils");function l(e){return e.map((e=>function(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}(e)?function(e){return e.stops=function(e,t){return t.length<=8?t:(n().warn(`Found ${t.length} Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified.`),t.length>16?function(e,t){const[i,...o]=t,s=o.pop(),a=o[0].value,n=o[o.length-1].value,l=(n-a)/6,c=[];for(let i=a;i<n;i+=l){let s=0;for(;i>=o[s].value;)s++;const a=o[s],n=t[s-1],l=i-n.value,p=a.value===n.value?1:l/(a.value-n.value);if("color"===e){const e=o[s],r=t[s-1],a=e.color.clone();a.r=u(r.color.r,a.r,p),a.g=u(r.color.g,a.g,p),a.b=u(r.color.b,a.b,p),a.a=u(r.color.a,a.a,p),c.push({value:i,color:a,label:e.label})}else if("size"===e){const e=o[s],a=t[s-1],n=(0,r.t_)(e.size),l=u((0,r.t_)(a.size),n,p);c.push({value:i,size:l,label:e.label})}else{const e=o[s],r=u(t[s-1].opacity,e.opacity,p);c.push({value:i,opacity:r,label:e.label})}}return[i,...c,s]}(e,t):function(e){const[t,...i]=e,o=i.pop();for(;i.length>6;){let e=0,t=0;for(let o=1;o<i.length;o++){const s=i[o-1],r=i[o],a=Math.abs(r.value-s.value);a>t&&(t=a,e=o)}i.splice(e,1)}return[t,...i,o]}(t))}(e.type,e.stops??[]),e}(e.clone()):e))}function u(e,t,i){return(1-i)*e+i*t}function c(e){if(!e)return!0;switch(e.type){case"dot-density":break;case"heatmap":if(!function(){const{supportsColorBufferFloat:e,supportsColorBufferFloatBlend:t,supportsColorBufferHalfFloat:i}=(0,a.h)();return e&&t||i}()){const e=(0,a.h)(),t=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((t=>!e[t])).join(", ");return n().errorOnce(new o.Z("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${t}`)),!1}}return!0}},43610:(e,t,i)=>{i.d(t,{a:()=>n});var o=i(78668),s=i(29258),r=i(89370);class a{constructor(){this.type="override-batch",this.messages=[],this._resovler=(0,o.hh)()}get promise(){return this._resovler.promise}resolve(){this._resovler.resolve()}add(e){this.messages.push(e)}}class n{constructor(e){this.updateTracking=new r.x({debugName:"FeatureCommandQueue"}),this.process=e.process,this._queueProcessor=new s.QueueProcessor({concurrency:1,process:async e=>{if("override-batch"===e.type){const e=this._nextOverrideBatch;if(null==e)throw new Error("InternalError: Override should be defined");return this._nextOverrideBatch=null,await this.process(e),void e.resolve()}return this.process(e)}})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(e){return(0,o.R8)(this.updateTracking.addPromise(this._doPush(e)))}async _doPush(e){const t=this._queueProcessor,i=t.last();switch(e.type){case"update":case"highlight":if(i?.type===e.type)return;return t.push(e);case"override":case"edit":return this._pushOverride(e)}}_pushOverride(e){return null==this._nextOverrideBatch&&(this._nextOverrideBatch=new a,this._queueProcessor.push(this._nextOverrideBatch)),this._nextOverrideBatch.add(e),this._nextOverrideBatch.promise}}},89370:(e,t,i)=>{i.d(t,{x:()=>p});var o=i(36663),s=i(74396),r=i(39994),a=i(20230),n=i(76868),l=i(81977),u=(i(13802),i(4157),i(40266)),c=i(98940);let p=class extends s.Z{constructor(e){super(e),this.debugName="",this._updatingHandles=new c.R,this._idToUpdatingState=new a.Z}get updating(){const e=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some((e=>e));if((0,r.Z)("esri-2d-log-updating")){const t=Array.from(this._idToUpdatingState.entries()).map((([e,t])=>`-> ${e}: ${t}`)).join("\n");console.log(`${this.debugName}: Updating: ${e}\n-> Handles: ${this._updatingHandles.updating}\n${t}`)}return e}addUpdateTracking(e,t){const i=(0,n.watch)((()=>t.updating),(t=>this._idToUpdatingState.set(e,t)),{sync:!0});this.addHandles(i)}addPromise(e){return this._updatingHandles.addPromise(e)}};(0,o._)([(0,l.Cb)({constructOnly:!0})],p.prototype,"debugName",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],p.prototype,"updating",null),p=(0,o._)([(0,u.j)("esri.views.2d.layers.support.UpdateTracking2D")],p)},61794:(e,t,i)=>{i.d(t,{P_:()=>n,vj:()=>a});var o=i(70375),s=i(91907);class r{constructor(e,t,i,o){this.dataType=e,this.samplingMode=t,this.pixelFormat=i,this.internalFormat=o}}function a(e,t){const{textureFloatLinear:i,colorBufferFloat:a}=e.capabilities,n=a?.textureFloat,l=a?.textureHalfFloat,u=a?.floatBlend,c=e.driverTest.floatBufferBlend.result;if(!n&&!l)throw new o.Z("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(u&&c||l))throw new o.Z("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(c?"":" This device claims support for EXT_float_blend, but does not actually support it."));const p=n&&u&&c,d=l,h=i,m=!!a?.R32F,f=!!a?.R16F;if(p&&h)return h||t.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new r(s.Br.FLOAT,h?s.cw.LINEAR:s.cw.NEAREST,m?s.VI.RED:s.VI.RGBA,m?s.lP.R32F:s.VI.RGBA);if(d)return new r(s.Br.HALF_FLOAT,s.cw.LINEAR,f?s.VI.RED:s.VI.RGBA,f?s.lP.R16F:s.VI.RGBA);throw new o.Z("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}const n=new r(s.Br.HALF_FLOAT,s.cw.NEAREST,s.VI.RGBA,s.VI.RGBA)}}]);