"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[58482],{72542:(e,t,i)=>{i.d(t,{TY:()=>n,_P:()=>o,_k:()=>a,l6:()=>l,mR:()=>r,xD:()=>s});const r="ESRI__ID",n="ESRI__OriginID",l="ESRI__DestID",s="ESRI__LayoutGeometry",o="ESRI__AggregationCount",a="LC.ESRI__IsSpatial"},92150:(e,t,i)=>{i.d(t,{Z:()=>m});var r,n=i(36663),l=i(70375),s=i(82064),o=i(86745),a=i(81977),u=(i(39994),i(13802),i(4157),i(40266)),d=i(50913),f=i(15553);const p={read:{reader:d.ij},write:{writer:d.cW,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},c={read:{reader:d.ij},write:{writer:d.cW,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},y={name:"showExcludedLabels",default:!0};let h=r=class extends s.Z{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){const i=super.write(e,t);if(t?.origin){if(i.filter){const e=Object.keys(i.filter);if(e.length>1||"where"!==e[0])return t.messages?.push(new l.Z("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in i)return t.messages?.push(new l.Z("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new r({filter:null!=this.filter?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,n._)([(0,a.Cb)({type:f.Z,json:{write:{allowNull:!0,writer(e,t,i,r){const n=e?.write({},r);n&&0!==Object.keys(n).length?(0,o.RB)(i,n,t):(0,o.RB)(i,null,t)}}}})],h.prototype,"filter",void 0),(0,n._)([(0,a.Cb)({json:{read:d.ij,write:{writer:d.cW,allowNull:!0},origins:{"web-map":p,"portal-item":p}}})],h.prototype,"includedEffect",void 0),(0,n._)([(0,a.Cb)({json:{read:d.ij,write:{writer:d.cW,allowNull:!0},origins:{"web-map":c,"portal-item":c}}})],h.prototype,"excludedEffect",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":y,"portal-item":y}}})],h.prototype,"excludedLabelsVisible",void 0),h=r=(0,n._)([(0,u.j)("esri.layers.support.FeatureEffect")],h);const m=h},15553:(e,t,i)=>{i.d(t,{Z:()=>m});var r,n=i(36663),l=i(25709),s=i(82064),o=i(67134),a=i(81977),u=(i(39994),i(13802),i(40266)),d=i(59659),f=i(14626),p=i(49684);const c=new l.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),y=new l.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let h=r=class extends s.Z{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:n,objectIds:l,units:s,distance:a}=this;return new f.Z({geometry:(0,o.d9)(i),objectIds:(0,o.d9)(l),spatialRelationship:r,timeExtent:(0,o.d9)(n),where:t,units:s,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:n,objectIds:l,units:s,distance:a}=this;return new r({geometry:(0,o.d9)(t),objectIds:(0,o.d9)(l),spatialRelationship:i,timeExtent:(0,o.d9)(n),where:e,units:s,distance:a})}};(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],h.prototype,"where",void 0),(0,n._)([(0,a.Cb)({types:d.qM,json:{write:!0}})],h.prototype,"geometry",void 0),(0,n._)([(0,a.Cb)({type:c.apiValues,json:{name:"spatialRel",read:{reader:c.read},write:{allowNull:!1,writer:c.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],h.prototype,"spatialRelationship",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{write:{overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],h.prototype,"distance",void 0),(0,n._)([(0,a.Cb)({type:[Number],json:{write:!0}})],h.prototype,"objectIds",void 0),(0,n._)([(0,a.Cb)({type:y.apiValues,json:{read:y.read,write:{writer:y.write,overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],h.prototype,"units",void 0),(0,n._)([(0,a.Cb)({type:p.Z,json:{write:!0}})],h.prototype,"timeExtent",void 0),h=r=(0,n._)([(0,u.j)("esri.layers.support.FeatureFilter")],h);const m=h},19654:(e,t,i)=>{i.d(t,{Ee:()=>l,Gr:()=>o,UO:()=>s});var r=i(19431),n=i(84684);function l(e,t){return{...t,filterMode:e.mode}}function s(e,t){return a(e,t).next().value??null}function o(e,t,i){const l=function(e){if("manual"===d(e))return null;const t=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:i,maxScale:r}of e.filters)t[0]=Math.max(t[0],f(i)),t[1]=Math.min(t[1],p(r));return t}(e);if(l&&((0,r.nB)(t,l[0])||(0,r.pt)(i,l[1])))return"";const s=Array.from(a(e,t,i)),o=function(e,t,i){if(0===e.length)return!0;const n=f(e.at(0)?.minScale),l=p(e.at(-1)?.maxScale);if((0,r.pt)(n,t)||(0,r.nB)(l,i))return!0;for(let t=0;t<e.length-1;t++){const i=e[t],n=e[t+1];if((0,r.pt)(f(n.minScale),p(i.maxScale)))return!0}return!1}(s,t,i)?"1=1":s.map((e=>e.where||"1=1")).reduce(((e,t)=>(0,n.D3)(e,t)),"");return o&&"1=1"!==o?o:""}function*a(e,t,i){if("manual"===d(e)){const t=e.filters.find((t=>t.id===e.activeFilterId));t&&(yield t)}else{"object"==typeof t&&(t=t.scale);for(const r of e.filters)u(r.minScale,r.maxScale,t,i)&&(yield r)}}function u(e,t,i,n){return e=f(e),i=f(i),t=p(t),!(!(0,r.W8)(i,e)&&(n??i)>e||(0,r.aR)(t,i)||void 0!==n&&(0,r.W8)(n,e))}function d(e){return"mode"in e?e.mode:e.filterMode}function f(e){return e||Number.POSITIVE_INFINITY}function p(e){return e||0}},21586:(e,t,i)=>{function r(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?l(e.view.floors,t.floorInfo.floorField):null}function n(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?l(e,t.floorInfo.floorField):null}function l(e,t){if(!e?.length)return null;const i=e.filter((e=>""!==e)).map((e=>`'${e}'`));return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}i.d(t,{c:()=>r,f:()=>n})},55431:(e,t,i)=>{i.d(t,{h:()=>l});i(7753),i(67134);var r=i(807),n=i(49684);i(96726),i(25242);function l(e,t,i){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:l=!1,timeOffset:s,useViewTime:o}=e;let a=e.timeExtent;l&&(a=function(e){if(!e)return e;const{start:t,end:i}=e;return new n.Z({start:null!=t?(0,r.Nm)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,r.Nm)(i,i.getTimezoneOffset(),"minutes"):i})}(a));let u=o?t&&a?t.intersection(a):t||a:a;return!u||u.isEmpty||u.isAllTime?u:(s&&(u=u.offset(-s.value,s.unit)),l&&(u=function(e){if(!e)return e;const{start:t,end:i}=e;return new n.Z({start:null!=t?(0,r.Nm)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,r.Nm)(i,-i.getTimezoneOffset(),"minutes"):i})}(u)),u.equals(i)?i:u)}},51211:(e,t,i)=>{i.d(t,{Z:()=>w});var r,n=i(36663),l=i(80085),s=i(25709),o=i(82064),a=i(67134),u=i(81977),d=(i(39994),i(13802),i(34248)),f=i(40266),p=i(39835),c=i(14685),y=i(53736),h=i(59659),m=i(12512);const g=new s.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let b=r=class extends o.Z{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){return this.readFeaturesWithClass(e,t,l.Z)}writeGeometryType(e,t,i,r){if(e)return void g.write(e,t,i,r);const{features:n}=this;if(n)for(const e of n)if(null!=e?.geometry)return void g.write(e.geometry.type,t,i,r)}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=(0,y.im)(e);return r&&!i&&t.spatialReference&&(r.spatialReference=c.Z.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i)for(const e of i)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new r(this.cloneProperties())}cloneProperties(){return(0,a.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const t=e?.[i];r.geometry=t?.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,n]}=e,l=this.features,s=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-r)/t)),(e=>Math.round((n-e)/i)));for(let e=0,t=l.length;e<t;e++)s?.(l[e].geometry)||(l.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,n],scale:[l,s]}=i;let o=null,a=null;if(this.hasZ&&null!=i?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=i;o=i=>i*t+e}if(this.hasM&&null!=i?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=i;a=i=>null==i?i:i*t+e}const u=this._getHydrationFunction(e,(e=>e*l+r),(e=>n-e*s),o,a);for(const{geometry:e}of t)null!=e&&u&&u(e);return this.transform=null,this}readFeaturesWithClass(e,t,i){const r=c.Z.fromJSON(t.spatialReference),n=[];for(let t=0;t<e.length;t++){const l=e[t],s=i.fromJSON(l),o=l.geometry?.spatialReference;null==s.geometry||o||(s.geometry.spatialReference=r);const a=l.aggregateGeometries,u=s.aggregateGeometries;if(a&&null!=u)for(const e in u){const t=u[e],i=a[e]?.spatialReference;null==t||i||(t.spatialReference=r)}n.push(s)}return n}_quantizePoints(e,t,i){let r,n;const l=[];for(let s=0,o=e.length;s<o;s++){const o=e[s];if(s>0){const e=t(o[0]),s=i(o[1]);e===r&&s===n||(l.push([e-r,s-n]),r=e,n=s)}else r=t(o[0]),n=i(o[1]),l.push([r,n])}return l.length>0?l:null}_getQuantizationFunction(e,t,i){return"point"===e?e=>(e.x=t(e.x),e.y=i(e.y),e):"polyline"===e||"polygon"===e?e=>{const r=(0,y.oU)(e)?e.rings:e.paths,n=[];for(let e=0,l=r.length;e<l;e++){const l=r[e],s=this._quantizePoints(l,t,i);s&&n.push(s)}return n.length>0?((0,y.oU)(e)?e.rings=n:e.paths=n,e):null}:"multipoint"===e?e=>{const r=this._quantizePoints(e.points,t,i);return r&&r.length>0?(e.points=r,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,i,r,n){return"point"===e?e=>{e.x=t(e.x),e.y=i(e.y),r&&(e.z=r(e.z))}:"polyline"===e||"polygon"===e?e=>{const l=(0,y.oU)(e)?e.rings:e.paths;let s,o;for(let e=0,r=l.length;e<r;e++){const r=l[e];for(let e=0,n=r.length;e<n;e++){const n=r[e];e>0?(s+=n[0],o+=n[1]):(s=n[0],o=n[1]),n[0]=t(s),n[1]=i(o)}}if(r&&n)for(let e=0,t=l.length;e<t;e++){const t=l[e];for(let e=0,i=t.length;e<i;e++){const i=t[e];i[2]=r(i[2]),i[3]=n(i[3])}}else if(r)for(let e=0,t=l.length;e<t;e++){const t=l[e];for(let e=0,i=t.length;e<i;e++){const i=t[e];i[2]=r(i[2])}}else if(n)for(let e=0,t=l.length;e<t;e++){const t=l[e];for(let e=0,i=t.length;e<i;e++){const i=t[e];i[2]=n(i[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=i(e.ymin),e.xmax=t(e.xmax),e.ymax=i(e.ymax),r&&null!=e.zmax&&null!=e.zmin&&(e.zmax=r(e.zmax),e.zmin=r(e.zmin)),n&&null!=e.mmax&&null!=e.mmin&&(e.mmax=n(e.mmax),e.mmin=n(e.mmin))}:"multipoint"===e?e=>{const l=e.points;let s,o;for(let e=0,r=l.length;e<r;e++){const r=l[e];e>0?(s+=r[0],o+=r[1]):(s=r[0],o=r[1]),r[0]=t(s),r[1]=i(o)}if(r&&n)for(let e=0,t=l.length;e<t;e++){const t=l[e];t[2]=r(t[2]),t[3]=n(t[3])}else if(r)for(let e=0,t=l.length;e<t;e++){const t=l[e];t[2]=r(t[2])}else if(n)for(let e=0,t=l.length;e<t;e++){const t=l[e];t[2]=n(t[2])}}:null}};(0,n._)([(0,u.Cb)({type:String,json:{write:!0}})],b.prototype,"displayFieldName",void 0),(0,n._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"exceededTransferLimit",void 0),(0,n._)([(0,u.Cb)({type:[l.Z],json:{write:!0}})],b.prototype,"features",void 0),(0,n._)([(0,d.r)("features")],b.prototype,"readFeatures",null),(0,n._)([(0,u.Cb)({type:[m.Z],json:{write:!0}})],b.prototype,"fields",void 0),(0,n._)([(0,u.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:g.read}}})],b.prototype,"geometryType",void 0),(0,n._)([(0,p.c)("geometryType")],b.prototype,"writeGeometryType",null),(0,n._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasM",void 0),(0,n._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasZ",void 0),(0,n._)([(0,u.Cb)({types:h.qM,json:{write:!0}})],b.prototype,"queryGeometry",void 0),(0,n._)([(0,d.r)("queryGeometry")],b.prototype,"readQueryGeometry",null),(0,n._)([(0,u.Cb)({type:c.Z,json:{write:!0}})],b.prototype,"spatialReference",void 0),(0,n._)([(0,p.c)("spatialReference")],b.prototype,"writeSpatialReference",null),(0,n._)([(0,u.Cb)({json:{write:!0}})],b.prototype,"transform",void 0),b=r=(0,n._)([(0,f.j)("esri.rest.support.FeatureSet")],b),b.prototype.toJSON.isDefaultToJSON=!0;const w=b},25242:(e,t,i)=>{i.d(t,{x:()=>r});const r=Symbol("WebScene")},79591:(e,t,i)=>{i.d(t,{Z:()=>_});var r=i(36663),n=i(70375),l=(i(39994),i(13802)),s=i(78668),o=i(76868),a=i(84684),u=i(81977),d=(i(4157),i(40266)),f=i(72542),p=i(19654),c=i(92150),y=i(15553),h=i(23556),m=i(14845),g=i(21586);function b(e,t){if("feature"!==t.type&&"subtype-group"!==t.type)return[];if(!t.url)return[];const i="utilityNetworks"in e.map?e.map.utilityNetworks??[]:[];for(const e of i)if(e.isUtilityLayer(t)){const e=t.fieldsIndex.get("assetgroup"),i=t.fieldsIndex.get("assettype");return[e?.name,i?.name].filter((e=>null!=e))}return[]}var w=i(14626),F=i(30879),I=i(59439);class v{constructor(e){this._fieldsIndex=e,this._clauses=[]}async finish(){return{requiresCurrentUser:(await Promise.all(this._clauses)).some((e=>e.currentUserRequired))}}visitClientWhereClause(e){e&&this._clauses.push((0,a.EP)(e,this._fieldsIndex))}visitFeatureReduction(e){if(e)switch(e.type){case"binning":case"cluster":this.visitLabelingInfo(e.labelsVisible,e.labelingInfo)}}visitLabelingInfo(e,t){if(e&&null!=t)for(const e of t)this.visitClientWhereClause(e.where)}visitDisplayFilter(e,t){if(e)for(const e of t?.filters??[])this.visitClientWhereClause(e.where)}visitFilter(e){this.visitClientWhereClause(e?.where)}visitTrackInfo(e){null!=e&&(this.visitLabelingInfo(e?.latestObservations.labelsVisible,e?.latestObservations.labelingInfo),this.visitLabelingInfo(e?.previousObservations.labelsVisible,e?.previousObservations.labelingInfo),this.visitLabelingInfo(e?.trackLines.labelsVisible,e?.trackLines.labelingInfo))}}const _=e=>{let t=class extends e{constructor(...e){super(...e),this._updatingRequiredPromise=null,this.filter=null,this.layer=null,this.requiresCurrentUser=!1,this.requiredFields=[],this.view=null}initialize(){this.addHandles([(0,o.watch)((()=>{const e=this.layer,t=this.view;return[e&&"elevationInfo"in e?e.elevationInfo?.featureExpressionInfo:null,e&&"displayField"in e?e.displayField:null,e&&"timeInfo"in e&&e.timeInfo,e&&"renderer"in e&&e.renderer,e&&"labelingInfo"in e&&e.labelingInfo,e&&"floorInfo"in e&&e.floorInfo,t?.requiredFieldsOptions?.featureTitleFields&&e&&"featureTitleFields"in e&&e.featureTitleFields,t?.requiredFieldsOptions?.utilityNetworkFields&&b(t,e),e.displayFilterInfo,this.displayFilterEnabled,this.filter,this.featureEffect,this.timeExtent,"knowledge-graph-sublayer"===e?.type&&"link-chart"===e.parentCompositeLayer.type&&e.parentCompositeLayer.linkChart?.linkChartProperties.nonspatialDataDisplay?.mode,"parquet"===e?.type&&e.popupTemplate]}),(()=>this._handleChange()),o.syncAndInitial),(0,o.on)((()=>this.view?.floors),"change",(()=>this._handleChange())),(0,o.on)((()=>this.layer.displayFilterInfo?.filters),"change",(()=>this._handleChange())),(0,o.on)((()=>this.layer&&"sublayers"in this.layer?this.layer.sublayers:null),"change",(()=>this._handleChange()))])}get availableFields(){if(!this.layer)return[];const{layer:e,layer:{fieldsIndex:t},requiredFields:i}=this;return"outFields"in e&&e.outFields?(0,m.Q0)(t,[...(0,m.Lk)(t,e.outFields),...i]):(0,m.Q0)(t,i)}get displayFilterEnabled(){return(this.view?.displayFilterEnabled??!0)&&(!("displayFilterEnabled"in this.layer)||(this.layer?.displayFilterEnabled??!0))}get effectiveDisplayFilter(){const e=this.layer;return this.displayFilterEnabled&&e.displayFilterInfo?(0,p.UO)(e.displayFilterInfo,this.view):null}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(e){this._override("featureEffect",e)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){l.Z.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}get signedInUser(){return this.layer?.url?(0,h.Wd)(this.layer.url):Promise.resolve(null)}highlight(e,t){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=null!=this.filter?this.filter.createQuery(e):new w.Z(e);return"floorInfo"in this.layer&&this.layer.floorInfo&&(t.where=(0,a._$)(t.where,(0,g.c)(this))),this.displayFilterEnabled&&(t.where=(0,a._$)(t.where,this.effectiveDisplayFilter?.where)),null!=this.timeExtent&&(t.timeExtent=null!=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}createAggregateQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return new w.Z(e)}queryFeatures(e,t){throw new Error("missing implementation")}queryObjectIds(e,t){throw new Error("missing implementation")}queryFeatureCount(e,t){throw new Error("missing implementation")}queryExtent(e,t){throw new Error("missing implementation")}async fetchPopupFeaturesFromGraphics(e,t){return this._validateFetchPopupFeatures(e,t),this._fetchPopupFeatures(e,t)}_loadArcadeModules(e){return e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type))?(0,F.LC)():Promise.resolve()}_handleChange(){const e=Promise.all([this._updateRequiredFields(),this._updateClientWhereClauseRequirements()]).then((()=>{}));return this._set("_updatingRequiredPromise",e),e.then((()=>{this._updatingRequiredPromise===e&&this._set("_updatingRequiredPromise",null)})),e}async _updateClientWhereClauseRequirements(){if(!this.layer||!this.view)return;const{layer:e}=this,t=new v(e.fieldsIndex);if(t.visitFilter(this.filter),"featureReduction"in e&&t.visitFeatureReduction(e.featureReduction),"labelingInfo"in e&&t.visitLabelingInfo(e.labelsVisible,e.labelingInfo),"trackInfo"in e&&t.visitTrackInfo(e.trackInfo),"2d"===this.view.type&&(t.visitFilter(this.featureEffect?.filter),t.visitDisplayFilter(this.displayFilterEnabled,e.displayFilterInfo),"featureReduction"in e&&t.visitFeatureReduction(e.featureReduction)),"subtype-group"===e.type)for(const i of e.sublayers)t.visitLabelingInfo(i.labelsVisible,i.labelingInfo);try{const e=await t.finish();this._set("requiresCurrentUser",e.requiresCurrentUser)}catch(e){l.Z.getLogger(this).error(e)}}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:t,layer:{fieldsIndex:i,objectIdField:r}}=this,n="renderer"in t&&t.renderer,s="orderBy"in t&&t.orderBy,o="featureReduction"in t?t.featureReduction:null,a=new Set,u=[n?n.collectRequiredFields(a,i):null,(0,m.Mu)(a,t),e&&"elevationInfo"in t?(0,m.vl)(a,t):null,null!=this.filter?(0,m.Ll)(a,t,this.filter):null,e||null==this.featureEffect?null:(0,m.Ll)(a,t,this.featureEffect.filter),!e&&o?(0,m.ZV)(a,t,o):null,!e&&s?(0,m.Qj)(a,t,s):null];if("timeInfo"in t&&t.timeInfo&&this.timeExtent&&(0,m.gd)(a,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),"timeInfo"in t&&t.timeInfo&&"trackInfo"in t&&t.trackInfo){const{trackInfo:e}=t;(0,m.gd)(a,t.fieldsIndex,[t.timeInfo.trackIdField]),"feature"!==t.type&&"startTimeField"!==e.timeField||(0,m.gd)(a,t.fieldsIndex,[t.timeInfo.startField]),"endTimeField"===e.timeField&&(0,m.gd)(a,t.fieldsIndex,[t.timeInfo.endField]),await(0,m.E2)(a,t)}if("floorInfo"in t&&t.floorInfo&&(0,m.gd)(a,t.fieldsIndex,[t.floorInfo.floorField]),"featureTitleFields"in t&&this.view?.requiredFieldsOptions?.featureTitleFields&&t.featureTitleFields&&(0,m.gd)(a,t.fieldsIndex,t.featureTitleFields),"feature"===t.type&&t.globalIdField&&this.view?.requiredFieldsOptions?.globalIdField&&(0,m.gd)(a,t.fieldsIndex,[t.globalIdField]),this.displayFilterEnabled&&u.push((0,m.WH)(a,t,t.displayFilterInfo)),"feature"===t.type&&e&&null!=t.infoFor3D&&(null==t.globalIdField&&l.Z.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),(0,m.gd)(a,t.fieldsIndex,[t.globalIdField])),"subtype-group"===t.type){(0,m.AB)(a,i,t.subtypeField);const e=t.sublayers.map((e=>Promise.all([e.renderer?.collectRequiredFields(a,i),(0,m.Mu)(a,e)])));u.push(Promise.all(e))}if("catalog-footprint"===t.type&&t.parent){const e=t.parent;(0,m.gd)(a,i,[e.itemNameField,e.itemSourceField,e.itemTypeField,e.maxScaleField,e.minScaleField])}"knowledge-graph-sublayer"===t.type&&"link-chart"===t.parentCompositeLayer.type&&(0,m.AB)(a,i,f._k),"parquet"===t.type&&u.push((0,I.e7)(t,t.popupTemplate).then((e=>{for(const t of e)a.add(t)})));const d=await Promise.allSettled(u);(0,m.AB)(a,i,r),e&&"displayField"in t&&t.displayField&&(0,m.AB)(a,i,t.displayField);for(const e of d)"rejected"===e.status&&l.Z.getLogger(this).error(e.reason);const p=Array.from(a).sort();this._set("requiredFields",p)}_validateFetchPopupFeatures(e,t){if(null!=t)for(const i of e){const e=i.origin&&"layer"in i.origin?i.origin.layer:i.layer;if("popupEnabled"in e&&!e.popupEnabled)throw new n.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:e});if(i.isAggregate){const t="featureReduction"in e?e.featureReduction:null,i="trackInfo"in e?e.trackInfo:null;if(null==t&&null==i||null!=t&&(!("popupTemplate"in t)||!t.popupEnabled||!t.popupTemplate)||i?.enabled&&(!("popupTemplate"in i)||!i.popupEnabled||!i.popupTemplate))throw new n.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:e})}else if("popupTemplate"in e&&!(0,I.V5)(e,t))throw new n.Z("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:e})}}_popupFeatureHasRequiredFields(e,t){return(0,m.R9)(t,e)}async _fetchPopupFeatures(e,t){const i=new Array(e.length),r=new Map,n=await this._createPopupQuery(e.map((e=>e.origin?.layer??e.layer)),t);for(let l=0;l<e.length;l++){const o=e[l];if(o.isAggregate){i[l]=o;continue}const a=o.origin?.layer??o.layer;if(!a||!("popupEnabled"in a))continue;const u=(0,m.Lk)(this.layer.fieldsIndex,n.outFields),d=(0,I.V5)(a,t);if(null==d)continue;const f=await this._loadArcadeModules(d);(0,s.k_)(t),f&&f.arcadeUtils.hasGeometryOperations(d)||!this._popupFeatureHasRequiredFields(o,u)?r.set(o.getObjectId(),{graphic:o,index:l}):i[l]=o}if("stream"===this.layer.type||"parquet"===this.layer.type||0===r.size)return i.filter(Boolean);n.objectIds=Array.from(r.keys());try{const e=await this.layer.queryFeatures(n,t);for(const t of e.features){const{graphic:{geometry:e,origin:n},index:l}=r.get(t.getObjectId());t.geometry||=e,t.origin=n,i[l]=t}}catch{}return i.filter(Boolean)}async _createPopupQuery(e,t){const i=this.layer.createQuery(),r=new Set;let n=!1;const l=e??[this.layer];for(const e of l){if(!("popupEnabled"in e))continue;const i=(0,I.V5)(e,t);if(null==i)continue;const l=await this._loadArcadeModules(i);(0,s.k_)(t);const o=l&&l.arcadeUtils.hasGeometryOperations(i);n=!("point"!==this.layer.geometryType&&!o);const a=await(0,I.e7)(this.layer,i);(0,s.k_)(t);for(const e of a)r.add(e)}if(i.returnGeometry=n,i.returnZ=n,i.returnM=n,i.outFields=Array.from(r),i.outSpatialReference=this.view.spatialReference,"floorInfo"in this.layer&&this.layer.floorInfo){const e=(0,g.c)(this);null!=e&&(i.where=i.where?`(${i.where}) AND (${e})`:e)}return i}canResume(){return!(!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty)}getTest(){}get test(){}};return(0,r._)([(0,u.Cb)()],t.prototype,"_updatingRequiredPromise",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],t.prototype,"availableFields",null),(0,r._)([(0,u.Cb)({readOnly:!0})],t.prototype,"displayFilterEnabled",null),(0,r._)([(0,u.Cb)({readOnly:!0})],t.prototype,"effectiveDisplayFilter",null),(0,r._)([(0,u.Cb)({type:c.Z})],t.prototype,"featureEffect",null),(0,r._)([(0,u.Cb)({type:y.Z})],t.prototype,"filter",void 0),(0,r._)([(0,u.Cb)()],t.prototype,"layer",void 0),(0,r._)([(0,u.Cb)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),(0,r._)([(0,u.Cb)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),(0,r._)([(0,u.Cb)()],t.prototype,"requiresCurrentUser",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],t.prototype,"requiredFields",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],t.prototype,"signedInUser",null),(0,r._)([(0,u.Cb)()],t.prototype,"suspended",void 0),(0,r._)([(0,u.Cb)()],t.prototype,"view",void 0),t=(0,r._)([(0,d.j)("esri.views.layers.FeatureLayerView")],t),t}},55068:(e,t,i)=>{i.d(t,{Z:()=>a});var r=i(36663),n=i(13802),l=i(78668),s=i(76868),o=(i(39994),i(4157),i(70375),i(40266));const a=e=>{let t=class extends e{initialize(){this.addHandles((0,s.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,l.D_)(e)||n.Z.getLogger(this).error(e)}))})),"RefreshableLayerView")}};return t=(0,r._)([(0,o.j)("esri.views.layers.RefreshableLayerView")],t),t}}}]);