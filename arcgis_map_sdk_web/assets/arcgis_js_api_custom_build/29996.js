"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[29996,57970,2059,28432],{19849:(e,t,i)=>{i.d(t,{Z:()=>a});var r=i(69079),s=i(8955);class a{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let r=this._inFlightResourceMap.get(e);return r?r.then((e=>({width:e.width,height:e.height}))):(r=(0,s.n$)(e,t),this._inFlightResourceMap.set(e,r),r.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,r.mx)(e)}}},2059:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>h});var r=i(19849),s=i(70271),a=i(95215),n=i(57970),o=i(7937),l=i(60789);class h{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new r.Z}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,r,s,h,m,f,y,u){if(!e)return null;const{data:p}=e;if(!p||"CIMSymbolReference"!==p.type||!p.symbol)return null;const{symbol:d}=p;h||(h=(0,l.JW)(d));const g=await n.OverrideHelper.resolveSymbolOverrides(p,t,this._spatialReference,s,h,m,f),w=this._cimResourceManager,v=[];a.B$.fetchResources(g,w,v),a.B$.fetchFonts(g,w,v),v.length>0&&await Promise.all(v);const{width:M,height:b}=i;let x=c(h,M,b,r,u);const C=a.B$.getEnvelope(g,x,w);if(!C)return null;C.x===1/0&&(C.x=M+2),C.y===1/0&&(C.y=-b/2),C.width===-1/0&&(C.width=M),C.height===-1/0&&(C.height=b);let I=1,S=0,O=0;switch(d.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;C.width>M&&(e=M/C.width);let t=1;C.height>b&&(t=b/C.height),"preview"===r&&(C.width<M&&(e=M/C.width),C.height<b&&(t=b/C.height)),I=Math.min(e,t),S=C.x+C.width/2,O=C.y+C.height/2}break;case"CIMLineSymbol":if(u){O=C.y+C.height/2,S=C.x+C.width/2;const e=C.width-M,t=C.height-b;x={paths:(0,o.bA)(x.paths,{xmin:-1*C.width/2+e,xmax:C.width/2-e,ymin:-1*C.height/2+t,ymax:C.height/2-t,width:C.width-2*e,height:C.height-2*t})}}else{(y||C.height>b)&&(I=b/C.height),O=C.y+C.height/2;const e=C.x*I+M/2,t=(C.x+C.width)*I+M/2,{paths:i}=x;i[0][0][0]-=e/I,i[0][2][0]-=(t-M)/I}break;case"CIMPolygonSymbol":if(u){O=C.y+C.height/2,S=C.x+C.width/2;const e=C.width-M,t=C.height-b;x={paths:(0,o.bA)(x.rings,{xmin:-1*C.width/2+e,xmax:C.width/2-e,ymin:-1*C.height/2+t,ymax:C.height/2-t,width:C.width-2*e,height:C.height-2*t})}}else{S=C.x+C.width/2,O=C.y+C.height/2;const e=C.x*I+M/2,t=(C.x+C.width)*I+M/2,i=C.y*I+b/2,r=(C.y+C.height)*I+b/2,{rings:s}=x;e<0&&(s[0][0][0]-=e,s[0][3][0]-=e,s[0][4][0]-=e),i<0&&(s[0][0][1]+=i,s[0][1][1]+=i,s[0][4][1]+=i),t>M&&(s[0][1][0]-=t-M,s[0][2][0]-=t-M),r>b&&(s[0][2][1]+=r-b,s[0][3][1]+=r-b)}}const P={type:"cim",data:{type:"CIMSymbolReference",symbol:g}};return this.rasterize(P,M,b,S,O,I,h,1,x)}rasterize(e,t,i,r,a,n,o,h=0,m=null,f=window.devicePixelRatio||1){const{data:y}=e;if(!y||"CIMSymbolReference"!==y.type||!y.symbol)return null;const{symbol:u}=y,p=this._canvas,d=1.3333333333333333*f;p.width=t*d,p.height=i*d,o||(o=(0,l.JW)(u)),m||(m=c(o,t,i,"legend")),p.width+=2*h,p.height+=2*h;const g=p.getContext("2d",{willReadFrequently:!0}),w=s.zA.createIdentity();return w.translate(-r,-a),w.scale(n*d,-n*d),w.translate(t*d/2+h,i*d/2+h),g.clearRect(0,0,p.width,p.height),new s.cD(g,this._cimResourceManager,w,!0).drawSymbol(u,m),g.getImageData(0,0,p.width,p.height)}}function c(e,t,i,r,s){const a=-t/2+1,n=t/2-1,l=i/2-1,h=-i/2+1;if(s&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const r=function(e,t,i,r){return"esriGeometryPolygon"===t?{rings:(0,o.Iu)((0,o.bA)(e.rings,{xmin:0,ymin:0,xmax:i,ymax:r,width:i,height:r}),-1*i/2,-1*r/2)}:"esriGeometryPolyline"===t?{paths:(0,o.Iu)((0,o.bA)(e.paths,{xmin:0,ymin:0,xmax:i,ymax:r,width:i,height:r}),-1*i/2,-1*r/2)}:null}(s,e,t,i);if(r)return r}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[a,0],[0,0],[n,0]]]};default:return"legend"===r?{rings:[[[a,l],[n,0],[n,h],[a,h],[a,l]]]}:{rings:[[[a,l],[n,l],[n,h],[a,h],[a,l]]]}}}},57970:(e,t,i)=>{i.r(t),i.d(t,{OverrideHelper:()=>c});var r=i(30936),s=i(39043),a=i(67134),n=i(30879),o=i(60789),l=i(28432);const h=e=>{if(!e)return[0,0,0,0];const{r:t,g:i,b:r,a:s}=e;return[t,i,r,255*s]};class c{static findApplicableOverrides(e,t,i){if(e&&t){if(e.primitiveName){let r=!1;for(const t of i)if(t.primitiveName===e.primitiveName){r=!0;break}if(!r)for(const r of t)r.primitiveName===e.primitiveName&&i.push(r)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const r of e.effects)c.findApplicableOverrides(r,t,i);if(e.symbolLayers)for(const r of e.symbolLayers)c.findApplicableOverrides(r,t,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const r of e.effects)c.findApplicableOverrides(r,t,i);if(e.markerPlacement&&c.findApplicableOverrides(e.markerPlacement,t,i),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const r of e.markerGraphics)c.findApplicableOverrides(r,t,i),c.findApplicableOverrides(r.symbol,t,i)}else"CIMCharacterMarker"===e.type?c.findApplicableOverrides(e.symbol,t,i):"CIMHatchFill"===e.type?c.findApplicableOverrides(e.lineSymbol,t,i):"CIMPictureMarker"===e.type&&c.findApplicableOverrides(e.animatedSymbolProperties,t,i)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,o.hU)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const i=(0,o.Ml)(e),r=e.primitiveName,s=[];for(const e of t)e.primitiveName===r&&s.push((0,o.Ml)(e));return{type:"cim-effect-param",effect:i,overrides:(0,o.Ul)(s)}}static async resolveSymbolOverrides(e,t,i,r,s,n,l){if(!e?.symbol)return null;let{symbol:h,primitiveOverrides:m}=e;const f=!!m;if(!f&&!r)return h;h=(0,a.d9)(h),m=(0,a.d9)(m);let y=!0;if(t||(t={attributes:{}},y=!1),f){if(y||(m=m.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),l||(m=m.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),m.length>0){const e={spatialReference:i,fields:(0,o.Qf)(t.attributes),geometryType:s};await c.createRenderExpressions(m,e),c.evaluateOverrides(m,t,s??"esriGeometryPoint",n,l)}c.applyOverrides(h,m)}return r&&c.applyDictionaryTextOverrides(h,t,r,null),h}static async createRenderExpressions(e,t){const i=[];for(const r of e){const e=r.valueExpressionInfo;if(!e||c._expressionToRenderExpression.has(e.expression))continue;const s=(0,n.Yi)(e.expression,t.spatialReference,t.fields);i.push(s),s.then((t=>c._expressionToRenderExpression.set(e.expression,t)))}i.length>0&&await Promise.all(i)}static evaluateOverrides(e,t,i,r,a){const n={$view:{scale:a?.scale}};for(const a of e){a.value&&"object"==typeof a.value&&(0,s.jQ)(a.value)&&("Color"===a.propertyName||"StrokeColor"===a.propertyName)&&(a.value=h(a.value));const e=a.valueExpressionInfo;if(!e)continue;const o=c._expressionToRenderExpression.get(e.expression);o&&(a.value=(0,l.default)(o,t,n,i,r))}}static applyDictionaryTextOverrides(e,t,i,r,s="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const a=e.symbolLayers;if(!a)return;for(const n of a)n&&"CIMVectorMarker"===n.type&&c.applyDictionaryTextOverrides(n,t,i,r,"CIMTextSymbol"===e.type?e.textCase:s)}break;case"CIMVectorMarker":{const s=e.markerGraphics;if(!s)return;for(const e of s)e&&c.applyDictionaryTextOverrides(e,t,i,r)}break;case"CIMMarkerGraphic":{const a=e.textString;if(a&&a.includes("[")){const n=(0,o.H1)(a,i);e.textString=(0,o.E_)(t,n,r,s)}}}}static applyOverrides(e,t,i,r){if(e.primitiveName)for(const s of t)if(s.primitiveName===e.primitiveName){const t=(0,o.Le)(s.propertyName);if(r&&r.push({cim:e,nocapPropertyName:t,value:e[t]}),i){let t=!1;for(const r of i)r.primitiveName===e.primitiveName&&(t=!0);t||i.push(s)}null!=s.value&&(e[t]=s.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)c.applyOverrides(s,t,i,r);if(e.symbolLayers)for(const s of e.symbolLayers)c.applyOverrides(s,t,i,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const s of e.effects)c.applyOverrides(s,t,i,r);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const s of e.markerGraphics)c.applyOverrides(s,t,i,r),c.applyOverrides(s.symbol,t,i,r)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const i of e)void 0!==i.value&&(t+=`${i.primitiveName}${i.propertyName}${JSON.stringify(i.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new r.Z(t).toRgba();return e[3]*=255,e}return t}}c._expressionToRenderExpression=new Map},90810:(e,t,i)=>{i.r(t),i.d(t,{previewCIMSymbol:()=>p});var r=i(95550),s=i(95215),a=i(2059),n=i(57970),o=i(60789),l=i(83773),h=i(5840);const c=new a.CIMSymbolRasterizer(null),m=(0,r.Wz)(l.b_.size),f=(0,r.Wz)(l.b_.maxSize),y=(0,r.Wz)(l.b_.lineWidth);async function u(e,t,i){const r=t?.size;let a=null!=r&&"object"==typeof r&&"width"in r?r.width:r,o=null!=r&&"object"==typeof r&&"height"in r?r.height:r;if(null==a||null==o)if("esriGeometryPolygon"===i)a=o=t.maxSize?Math.min(t.maxSize,m):m;else{const r=await async function(e,t,i){const{feature:r,fieldMap:a,viewParams:o}=t.cimOptions||t,l=await n.OverrideHelper.resolveSymbolOverrides(e.data,r,null,a,i,null,o);if(!l)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:l},e.data.primitiveOverrides=void 0;const h=[];return s.B$.fetchResources(l,c.resourceManager,h),s.B$.fetchFonts(l,c.resourceManager,h),h.length>0&&await Promise.all(h),s.B$.getEnvelope(l,null,c.resourceManager)}(e,t,i);r&&(a=r.width,o=r.height),"esriGeometryPolyline"===i&&(a=t.maxSize?Math.min(t.maxSize,y):y),a=null!=a&&isFinite(a)?Math.min(a,f):m,o=null!=o&&isFinite(o)?Math.max(Math.min(o,f),1):m}return"legend"===t.style&&"esriGeometryPolyline"===i&&(a=y),{width:a,height:o}}async function p(e,t={}){const{node:i,opacity:s,symbolConfig:a}=t,n=null!=a&&"object"==typeof a&&"isSquareFill"in a&&a.isSquareFill,l=t.cimOptions||t,m=l.geometryType||(0,o.JW)(e?.data?.symbol),f=await u(e,t,m),{feature:y,fieldMap:p}=l,d=t?.geometry||n||"esriGeometryPolygon"!==m?"preview":"legend";let g=f;const w=f;if(t?.geometry&&("esriGeometryPolygon"===m||"esriGeometryPolyline"===m)){const e=200;if((0,r.F2)(f.width)<e||(0,r.F2)(f.height)<e){const t=f.width>f.height?(0,r.Wz)(e)*f.height/f.width:(0,r.Wz)(e);g={width:f.width>f.height?(0,r.Wz)(e):(0,r.Wz)(e)*f.width/f.height,height:t}}}const v=await c.rasterizeCIMSymbolAsync(e,y,g,d,p,m,null,l.viewParams,l.allowScalingUp,t?.geometry?.toJSON());if(!v)return null;const{width:M,height:b}=v,x=document.createElement("canvas");x.width=M,x.height=b,x.getContext("2d").putImageData(v,0,0);const C=(0,r.F2)(w.width),I=(0,r.F2)(w.height),S=new Image(C,I);S.src=x.toDataURL(),S.ariaLabel=t.ariaLabel??null,S.alt=t.ariaLabel??"",null!=s&&(S.style.opacity=`${s}`);let O=S;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:C,height:I,src:S.src},fill:null,stroke:null,offset:[0,0]};O=(0,h.wh)([[e]],[C,I],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return i&&O&&i.appendChild(O),O}},28432:(e,t,i)=>{i.r(t),i.d(t,{default:()=>n});var r=i(70375),s=i(13802),a=i(7505);function n(e,t,i,r,a){if(null==e)return null;const n=e.references("geometry")&&a?l(t,r,a):t,o=e.repurposeFeature(n);try{return e.evaluate({...i,$feature:o},e.services)}catch(e){return s.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}const o=new Map;function l(e,t,i){const{transform:n,hasZ:l,hasM:h}=i;o.has(t)||o.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,i,r,s)=>(0,a.U1)(i,t,e,r,s);case"esriGeometryPolygon":return(e,i,r,s)=>(0,a.Ie)(i,t,e,r,s);case"esriGeometryPolyline":return(e,i,r,s)=>(0,a.G6)(i,t,e,r,s);case"esriGeometryMultipoint":return(e,i,r,s)=>(0,a.J9)(i,t,e,r,s);default:return s.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new r.Z("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const c=o.get(t)(e.geometry,n,l,h);return{...e,geometry:c}}},31067:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(45867);class s{constructor(e,t,i,s){this.transformedX=0,this.transformedY=0,this.center=(0,r.al)(e,t),this.centerT=(0,r.Ue)(),this.halfWidth=i/2,this.halfHeight=s/2,this.width=i,this.height=s}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new s(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e,t=4){const i=Math.abs(e.centerT[0]-this.centerT[0]),r=Math.abs(e.centerT[1]-this.centerT[1]),s=(e.halfWidth+this.halfWidth+t)/i,a=(e.halfHeight+this.halfHeight+t)/r,n=Math.min(s,a);return Math.log2(n)}extend(e){const t=Math.min(this.xmin,e.xmin),i=Math.min(this.ymin,e.ymin),r=Math.max(this.xmax,e.xmax)-t,s=Math.max(this.ymax,e.ymax)-i,a=t+r/2,n=i+s/2;this.width=r,this.height=s,this.halfWidth=r/2,this.halfHeight=s/2,this.x=a,this.y=n}static deserialize(e){const t=e.readF32(),i=e.readF32(),r=e.readInt32(),a=e.readInt32();return new s(t,i,r,a)}}}}]);