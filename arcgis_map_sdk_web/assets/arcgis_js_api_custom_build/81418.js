"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[81418],{9489:(e,t,r)=>{r.d(t,{cn:()=>n,j:()=>s,lK:()=>i});const n="updating";function i(e){return"updating"===e?null:e}function s(e){return"updating"===e}},15553:(e,t,r)=>{r.d(t,{Z:()=>g});var n,i=r(36663),s=r(25709),o=r(82064),l=r(67134),a=r(81977),u=(r(39994),r(13802),r(40266)),d=r(59659),c=r(14626),p=r(49684);const f=new s.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),y=new s.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let h=n=class extends o.Z{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:n,timeExtent:i,objectIds:s,units:o,distance:a}=this;return new c.Z({geometry:(0,l.d9)(r),objectIds:(0,l.d9)(s),spatialRelationship:n,timeExtent:(0,l.d9)(i),where:t,units:o,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,timeExtent:i,objectIds:s,units:o,distance:a}=this;return new n({geometry:(0,l.d9)(t),objectIds:(0,l.d9)(s),spatialRelationship:r,timeExtent:(0,l.d9)(i),where:e,units:o,distance:a})}};(0,i._)([(0,a.Cb)({type:String,json:{write:!0}})],h.prototype,"where",void 0),(0,i._)([(0,a.Cb)({types:d.qM,json:{write:!0}})],h.prototype,"geometry",void 0),(0,i._)([(0,a.Cb)({type:f.apiValues,json:{name:"spatialRel",read:{reader:f.read},write:{allowNull:!1,writer:f.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],h.prototype,"spatialRelationship",void 0),(0,i._)([(0,a.Cb)({type:Number,json:{write:{overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],h.prototype,"distance",void 0),(0,i._)([(0,a.Cb)({type:[Number],json:{write:!0}})],h.prototype,"objectIds",void 0),(0,i._)([(0,a.Cb)({type:y.apiValues,json:{read:y.read,write:{writer:y.write,overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],h.prototype,"units",void 0),(0,i._)([(0,a.Cb)({type:p.Z,json:{write:!0}})],h.prototype,"timeExtent",void 0),h=n=(0,i._)([(0,u.j)("esri.layers.support.FeatureFilter")],h);const g=h},21586:(e,t,r)=>{function n(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?s(e.view.floors,t.floorInfo.floorField):null}function i(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(!e?.length)return null;const r=e.filter((e=>""!==e)).map((e=>`'${e}'`));return r.push("''"),`${t} IN (${r.join(",")}) OR ${t} IS NULL`}r.d(t,{c:()=>n,f:()=>i})},55431:(e,t,r)=>{r.d(t,{h:()=>s});r(7753),r(67134);var n=r(807),i=r(49684);r(96726),r(25242);function s(e,t,r){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:s=!1,timeOffset:o,useViewTime:l}=e;let a=e.timeExtent;s&&(a=function(e){if(!e)return e;const{start:t,end:r}=e;return new i.Z({start:null!=t?(0,n.Nm)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=r?(0,n.Nm)(r,r.getTimezoneOffset(),"minutes"):r})}(a));let u=l?t&&a?t.intersection(a):t||a:a;return!u||u.isEmpty||u.isAllTime?u:(o&&(u=u.offset(-o.value,o.unit)),s&&(u=function(e){if(!e)return e;const{start:t,end:r}=e;return new i.Z({start:null!=t?(0,n.Nm)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=r?(0,n.Nm)(r,-r.getTimezoneOffset(),"minutes"):r})}(u)),u.equals(r)?r:u)}},51211:(e,t,r)=>{r.d(t,{Z:()=>w});var n,i=r(36663),s=r(80085),o=r(25709),l=r(82064),a=r(67134),u=r(81977),d=(r(39994),r(13802),r(34248)),c=r(40266),p=r(39835),f=r(14685),y=r(53736),h=r(59659),g=r(12512);const m=new o.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let b=n=class extends l.Z{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){return this.readFeaturesWithClass(e,t,s.Z)}writeGeometryType(e,t,r,n){if(e)return void m.write(e,t,r,n);const{features:i}=this;if(i)for(const e of i)if(null!=e?.geometry)return void m.write(e.geometry.type,t,r,n)}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,n=(0,y.im)(e);return n&&!r&&t.spatialReference&&(n.spatialReference=f.Z.fromJSON(t.spatialReference)),n}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r)for(const e of r)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new n(this.cloneProperties())}cloneProperties(){return(0,a.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const n=t.features[r];if(n.geometry){const t=e?.[r];n.geometry=t?.toJSON()||n.geometry}}return t}quantize(e){const{scale:[t,r],translate:[n,i]}=e,s=this.features,o=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-n)/t)),(e=>Math.round((i-e)/r)));for(let e=0,t=s.length;e<t;e++)o?.(s[e].geometry)||(s.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[n,i],scale:[s,o]}=r;let l=null,a=null;if(this.hasZ&&null!=r?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=r;l=r=>r*t+e}if(this.hasM&&null!=r?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=r;a=r=>null==r?r:r*t+e}const u=this._getHydrationFunction(e,(e=>e*s+n),(e=>i-e*o),l,a);for(const{geometry:e}of t)null!=e&&u&&u(e);return this.transform=null,this}readFeaturesWithClass(e,t,r){const n=f.Z.fromJSON(t.spatialReference),i=[];for(let t=0;t<e.length;t++){const s=e[t],o=r.fromJSON(s),l=s.geometry?.spatialReference;null==o.geometry||l||(o.geometry.spatialReference=n);const a=s.aggregateGeometries,u=o.aggregateGeometries;if(a&&null!=u)for(const e in u){const t=u[e],r=a[e]?.spatialReference;null==t||r||(t.spatialReference=n)}i.push(o)}return i}_quantizePoints(e,t,r){let n,i;const s=[];for(let o=0,l=e.length;o<l;o++){const l=e[o];if(o>0){const e=t(l[0]),o=r(l[1]);e===n&&o===i||(s.push([e-n,o-i]),n=e,i=o)}else n=t(l[0]),i=r(l[1]),s.push([n,i])}return s.length>0?s:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{const n=(0,y.oU)(e)?e.rings:e.paths,i=[];for(let e=0,s=n.length;e<s;e++){const s=n[e],o=this._quantizePoints(s,t,r);o&&i.push(o)}return i.length>0?((0,y.oU)(e)?e.rings=i:e.paths=i,e):null}:"multipoint"===e?e=>{const n=this._quantizePoints(e.points,t,r);return n&&n.length>0?(e.points=n,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r,n,i){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y),n&&(e.z=n(e.z))}:"polyline"===e||"polygon"===e?e=>{const s=(0,y.oU)(e)?e.rings:e.paths;let o,l;for(let e=0,n=s.length;e<n;e++){const n=s[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];e>0?(o+=i[0],l+=i[1]):(o=i[0],l=i[1]),i[0]=t(o),i[1]=r(l)}}if(n&&i)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=n(r[2]),r[3]=i(r[3])}}else if(n)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=n(r[2])}}else if(i)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=i(r[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax),n&&null!=e.zmax&&null!=e.zmin&&(e.zmax=n(e.zmax),e.zmin=n(e.zmin)),i&&null!=e.mmax&&null!=e.mmin&&(e.mmax=i(e.mmax),e.mmin=i(e.mmin))}:"multipoint"===e?e=>{const s=e.points;let o,l;for(let e=0,n=s.length;e<n;e++){const n=s[e];e>0?(o+=n[0],l+=n[1]):(o=n[0],l=n[1]),n[0]=t(o),n[1]=r(l)}if(n&&i)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=n(t[2]),t[3]=i(t[3])}else if(n)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=n(t[2])}else if(i)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=i(t[2])}}:null}};(0,i._)([(0,u.Cb)({type:String,json:{write:!0}})],b.prototype,"displayFieldName",void 0),(0,i._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"exceededTransferLimit",void 0),(0,i._)([(0,u.Cb)({type:[s.Z],json:{write:!0}})],b.prototype,"features",void 0),(0,i._)([(0,d.r)("features")],b.prototype,"readFeatures",null),(0,i._)([(0,u.Cb)({type:[g.Z],json:{write:!0}})],b.prototype,"fields",void 0),(0,i._)([(0,u.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:m.read}}})],b.prototype,"geometryType",void 0),(0,i._)([(0,p.c)("geometryType")],b.prototype,"writeGeometryType",null),(0,i._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasM",void 0),(0,i._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasZ",void 0),(0,i._)([(0,u.Cb)({types:h.qM,json:{write:!0}})],b.prototype,"queryGeometry",void 0),(0,i._)([(0,d.r)("queryGeometry")],b.prototype,"readQueryGeometry",null),(0,i._)([(0,u.Cb)({type:f.Z,json:{write:!0}})],b.prototype,"spatialReference",void 0),(0,i._)([(0,p.c)("spatialReference")],b.prototype,"writeSpatialReference",null),(0,i._)([(0,u.Cb)({json:{write:!0}})],b.prototype,"transform",void 0),b=n=(0,i._)([(0,c.j)("esri.rest.support.FeatureSet")],b),b.prototype.toJSON.isDefaultToJSON=!0;const w=b},25242:(e,t,r)=>{r.d(t,{x:()=>n});const n=Symbol("WebScene")},57533:(e,t,r)=>{r.d(t,{Qw:()=>p,Z6:()=>y,ZS:()=>f,sw:()=>u});var n=r(67979),i=r(67134),s=r(12173),o=r(39406);const l={setAttribute(){},rollback(){},commit(){}};var a;function u(e,t){const r=t.attributes[e.objectIdField];if(null==r)return l;const n=e.sessions.get(r);if(n)return n;const s=(0,i.d9)(t.attributes),o=new Set,u=e.i3sOverrides.createInteractiveEditSession(r),d=new Map,c=(e,t)=>{const n=d.get(e);if(null==n){const n=t.indexOf(r);return d.set(e,n),n}return n};let p=a.EDITING;const f={setAttribute(r,n){if(p!==a.EDITING)return;const i=e.fieldsIndex.get(r);if(!i)return;const l=e.attributeStorageInfo.findIndex((e=>e.name===i.name));if(l<0)return;if(!(r in s))throw new Error(`Attribute "${r}" is not an attribute of the edited feature.`);u.setAttribute(l,n);const d=e.attributeStorageInfo[l];let f=!1;o.add(r),e.forEachNode(((r,i)=>{const s=c(r,i);if(-1===s)return;const o=e.getAttributeData(r.index);if(o){const i=o[d.name];i&&(i[s]=n,e.setAttributeData(r.index,o,t),f=!0)}})),f&&e.clearMemCache()},rollback(){if(p===a.EDITING){for(const e of o)this.setAttribute(e,s[e]);u.remove(),p=a.ROLLED_BACK,e.sessions.delete(r)}},commit(){p===a.EDITING&&(u.remove(),p=a.COMMITTED,e.sessions.delete(r))}};return e.sessions.set(r,f),f}function d(e,t,r){const{gidToFeatureInfo:n,oidToFeatureInfo:i,fieldsIndex:s,objectIdField:o,globalIdField:l,featureOrIdentifierList:a}=r;if(!r.featuresResolved&&null!=a){for(const e of a){const t={feature:null,oid:-1,gid:null};if("attributes"in e){t.feature=e;const r=e.attributes;if(null!=r)for(const e in r){if(-1!==t.oid&&null!=t.gid)break;const n=s.normalizeFieldName(e);n===o&&(t.oid=r[e]??-1),n===l&&(t.gid=r[e])}}else t.oid=e.objectId??-1,t.gid=e.globalId;null!=t.gid&&n.set(t.gid,t),-1!==t.oid&&i.set(t.oid,t)}r.featuresResolved=!0}return(-1!==e?i.get(e):null)??(null!=t?n.get(t):null)}function c(e,t,r,n,i=null,o=!0){const l=[],a={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:null==r,fieldsIndex:e.fieldsIndex,objectIdField:e.objectIdField,globalIdField:e.globalIdField,featureOrIdentifierList:r};for(const e of t){if(null!=e.error)continue;const t=e.objectId??-1,r=e.globalId,u=(-1===t||o?d(t,r,a):null)??{feature:null,oid:t,gid:r},c={oid:-1===t?u.oid:t,gid:r??u.gid,feature:u.feature,result:e};l.push(c);const p=c.gid?(0,s.L3)(c.gid):null;if(-1===c.oid&&null!=p&&null!=i&&(c.oid=i.get(p)??-1),-1===c.oid&&null!=p){let e=n.get(p);null==e&&(e={gid:c.gid,edits:[]},n.set(p,e)),e.edits.push(c)}}return l}async function p(e,t){const r=new Map,i=c(e,t.addedFeatures,t.edits?.addFeatures,r),l=c(e,t.updatedFeatures,t.edits?.updateFeatures,r),a=c(e,t.deletedFeatures,t.edits?.deleteFeatures,r,t.globalIdToObjectId,!1);return r.size>0&&await async function(e,t){const r=e.i3sOverrides.layer.associatedLayer;if(null==r?.globalIdField)return;const i=r.createQuery(),{objectIdField:l,globalIdField:a}=r;i.where=Array.from(t.values()).map((({gid:e})=>`${a}='${e}'`)).join(" OR "),i.returnGeometry=!1,i.outFields=[l,a],i.cacheHint=!1;const u=await(0,n.mt)((0,o.UK)(r,i));if(!u.ok)return;const d=u.value.features;for(const e of d){const r=e.attributes[a],n=e.attributes[l];if(null==r||null==n||-1===n)continue;const i=t.get((0,s.L3)(r));if(null!=i)for(const e of i.edits)e.oid=n}}(e,r),{adds:i.filter((e=>-1!==e.oid)),updates:l.filter((e=>-1!==e.oid)),deletes:a.filter((e=>-1!==e.oid))}}function f(e,t){const r=new Map,n=e=>{for(const{oid:t,feature:n}of e){const e=n?.geometry;"mesh"===e?.type&&r.set(t,e)}};n(t.adds),n(t.updates);for(const e of t.deletes)r.set(e.oid,null);for(const[t,n]of r)e.i3sOverrides.updateGeometry(t,n)}function y(e,t){const r=function(e,t){const r=t.updates;if(!r||0===r.length)return new m;const n=new m,i=new Map;for(let t=0;t<e.attributeStorageInfo.length;t++)i.set(e.attributeStorageInfo[t].name,t);return e.forEachNode(((t,i)=>{for(const s of r){if(null==s.feature)continue;const r=s.feature,o=s.oid,l=i.indexOf(o);for(const i in r.attributes){const s=e.fieldsIndex.normalizeFieldName(i),a=h(n,t.index,s),u=r.attributes[i];a.push({featureIndex:l,featureId:o,value:u})}}})),n}(e,t),n=function(e,t){const r=new Map,n=t.adds;if(!n||0===n.length||null==e.globalIdField)return r;for(const e of n){const t=e.oid,n=e.feature;"mesh"===n?.geometry?.type&&r.set(t,n)}return r}(e,t);if(0===r.size&&0===n.size)return;const i=new Map;for(let t=0;t<e.attributeStorageInfo.length;t++)i.set(e.attributeStorageInfo[t].name,t);let s=!1;r.forEach(((t,r)=>{const n=e.getAttributeData(r);let o=!1;t.forEach(((t,r)=>{const l=null!=n?n[r]:null,a=i.get(r);for(const{featureIndex:r,value:n,featureId:i}of t)l&&(l[r]=n,o=!0,s=!0),e.i3sOverrides.updateAttributeValue(i,a,n)})),o&&e.setAttributeData(r,n,null)})),s&&e.clearMemCache();const{fieldsIndex:o,i3sOverrides:l,objectIdField:a,globalIdField:u}=e,d=l.layer.associatedLayer?.infoFor3D,c=new Set(d?[...Object.values(d.assetMapFieldRoles),...Object.values(d.transformFieldRoles)]:[]);for(const[e,t]of n){l.featureAdded(e);const{attributes:r}=t;for(const t in r){if(t!==a&&t!==u&&c.has(t))continue;const n=o.normalizeFieldName(t),s=null!=n?i.get(n):null;if(null==s)continue;const d=r[t];l.updateAttributeValue(e,s,d)}}}function h(e,t,r){const n=function(e,t){const r=e.get(t);if(r)return r;const n=new g;return e.set(t,n),n}(e,t),i=null!=r&&n.get(r);if(i)return i;const s=new Array;return n.set(r,s),s}!function(e){e[e.EDITING=0]="EDITING",e[e.ROLLED_BACK=1]="ROLLED_BACK",e[e.COMMITTED=2]="COMMITTED"}(a||(a={}));const g=Map,m=Map},7933:(e,t,r)=>{r.d(t,{l:()=>u});var n=r(36663),i=r(13802),s=r(81977),o=(r(39994),r(4157),r(40266)),l=r(85491),a=r(78565);const u=e=>{let t=class extends e{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=e=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&i.Z.getLogger(this).error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&i.Z.getLogger(this).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer?.definitionExpression)return null;try{const e=l.default.create(this.i3slayer.definitionExpression,{fieldsIndex:this.i3slayer.fieldsIndex});if(!e.isStandardized)return i.Z.getLogger(this).error("definitionExpression is using non standard function"),null;const t=[],r=e.fieldNames;return(0,a.e8)(r,this.i3slayer.fields,{missingFields:t}),t.length>0?(i.Z.getLogger(this).error(`definitionExpression references unknown fields: ${t.join(", ")}`),null):(this._definitionExpressionErrors=0,e)}catch(e){return i.Z.getLogger(this).error("Failed to parse definitionExpression: "+e),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}_evaluateClause(e,t){try{return e.testFeature(t)}catch(e){return this.logError(e),!1}}_addDefinitionExpressionToQuery(e){if(!this.parsedDefinitionExpression)return e;const t=this.i3slayer.definitionExpression,r=e.clone();return r.where?r.where=`(${t}) AND (${r.where})`:r.where=t,r}};return(0,n._)([(0,s.Cb)({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),(0,n._)([(0,s.Cb)({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=(0,n._)([(0,o.j)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t),t}},44613:(e,t,r)=>{r.d(t,{i:()=>a});var n=r(36663),i=r(70375),s=(r(13802),r(39994),r(4157),r(40266)),o=r(14845),l=r(59439);const a=e=>{let t=class extends e{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:r}=t;if(!r)throw new i.Z("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t});if(!(0,l.V5)(t,e))throw new i.Z("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeaturesFromGraphics(e,t){if(this._validateFetchPopupFeatures(t),0===e.length)return[];const r="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;let n=[];"fieldsIndex"in this.layer&&(n=(0,o.Lk)(this.layer.fieldsIndex,await(0,l.e7)(r,(0,l.V5)(this.layer,t)))),await this.prepareFetchPopupFeatures(n);const i=new Set,s=[],a=[];for(const t of e)(0,o.Gm)(n,t,i)?a.push(t):s.push(t);if(0===a.length)return s;const u=new Map;for(let t=0;t<e.length;t++)u.set(e[t].getObjectId()??0,t);const d=await this.whenGraphicAttributes(a,[...i]).catch((()=>a)).then((e=>s.concat(e)));return d.sort(((e,t)=>{const r=e.getObjectId()??0,n=u.get(r)??0,i=t.getObjectId()??0;return n-(u.get(i)??0)})),d}};return t=(0,n._)([(0,s.j)("esri.views.3d.layers.support.PopupSceneLayerView")],t),t}},37495:(e,t,r)=>{r.d(t,{K:()=>f});var n=r(36663),i=r(74396),s=r(13802),o=r(78668),l=r(76868),a=r(81977),u=r(40266);const d=e=>{let t=class extends e{constructor(){super(...arguments),this._numUpdating=0}get updating(){return this._numUpdating>0}autoUpdateAsync(e,t){const r=(0,o.Ds)((async t=>{++this._numUpdating;try{const r=await t;this.destroyed||this._set(e,r)}catch(t){s.Z.getLogger(this).warn(`Async update of "${String(e)}" failed. Async update functions should not throw exceptions.`)}--this._numUpdating}));return(0,l.watch)(t,r,l.initial)}};return(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"updating",null),(0,n._)([(0,a.Cb)()],t.prototype,"_numUpdating",void 0),t=(0,n._)([(0,u.j)("esri.core.AsyncUpdate")],t),t};let c=class extends(d(i.Z)){};c=(0,n._)([(0,u.j)("esri.core.AsyncUpdate")],c);r(39994),r(4157);var p=r(14845);let f=class extends(d(i.Z)){get layer(){return this.layerView.layer}get requiredFields(){const{layerView:{layer:{fieldsIndex:e},definitionExpressionFields:t},rendererFields:r,labelingFields:n,viewFilterFields:i}=this;return(0,p.Q0)(e,[...t??[],...r??[],...n??[],...i??[]])}constructor(e){super(e)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",(async()=>{const{fieldsIndex:e,renderer:t}=this.layer;return t?this._getFieldsAsync((r=>t.collectRequiredFields(r,e))):null})),this.autoUpdateAsync("labelingFields",(async()=>{const{layer:e}=this;return e.labelsVisible?this._getFieldsAsync((t=>(0,p.Mu)(t,e))):null})),this.autoUpdateAsync("viewFilterFields",(()=>{const{layer:e,mergedFilter:t}=this.layerView;return this._getFieldsAsync((r=>(0,p.Ll)(r,e,t)))}))])}async _getFieldsAsync(e){const t=new Set;try{return await e(t),Array.from(t).sort()}catch(e){return s.Z.getLogger(this).error(e),null}}};(0,n._)([(0,a.Cb)()],f.prototype,"layerView",void 0),(0,n._)([(0,a.Cb)()],f.prototype,"layer",null),(0,n._)([(0,a.Cb)()],f.prototype,"requiredFields",null),(0,n._)([(0,a.Cb)()],f.prototype,"rendererFields",void 0),(0,n._)([(0,a.Cb)()],f.prototype,"labelingFields",void 0),(0,n._)([(0,a.Cb)()],f.prototype,"viewFilterFields",void 0),f=(0,n._)([(0,u.j)("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],f)},35990:(e,t,r)=>{r.d(t,{q:()=>d});var n=r(36663),i=r(81977),s=(r(39994),r(13802),r(4157),r(40266)),o=r(53316),l=r(15553),a=r(55431),u=r(78565);const d=e=>{let t=class extends e{get timeExtent(){return(0,a.h)(this.i3slayer,this.view?.timeExtent,this._get("timeExtent"))}get mergedFilter(){const{filter:e,timeExtent:t}=this;if(null==t)return e;const r=e?.clone()??new l.Z;return null!=t&&(r.timeExtent=r.timeExtent?.intersection(t)??t),r}getTimeFilterDependencies(){const{timeInfo:e}=this.i3slayer;if(null==e)return[];const{startField:t,endField:r}=e;return[t,r]}addTimeFilter(e,t){if(null==t)return;const{timeInfo:r}=this.i3slayer;if(null==r)return;const{startField:n,endField:i,useTime:s}=r;if(!s||null==n&&null==i)return;const l=r.toJSON(),a=t.toJSON();e.push(((e,t)=>function(e,t,r,n){const i=t.attributeInfo?.attributeData;if(null==i)return;const{startTimeField:s,endTimeField:l}=r;if(null!=s&&null==i[s]||null!=l&&null==i[l])return;const a=(0,o.y)(r,n,new c(i));if(null==a)return;const{featureIds:d}=t;(0,u.hv)(e,d,a)}(e,t,l,a)))}};return(0,n._)([(0,i.Cb)({readOnly:!0})],t.prototype,"timeExtent",null),(0,n._)([(0,i.Cb)()],t.prototype,"mergedFilter",null),t=(0,n._)([(0,s.j)("esri.views.3d.layers.support.TemporalSceneLayerView")],t),t};class c{constructor(e){this.attributeData=e}getAttribute(e,t){return(0,u.Jx)(this.attributeData[t],e)}getAttributeAsTimestamp(e,t){const r=this.getAttribute(e,t);return"string"==typeof r?new Date(r).getTime():"number"==typeof r||null==r?r:null}}},3917:(e,t,r)=>{r.d(t,{v:()=>i});var n=r(14845);function i(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const{layer:e,layer:{fieldsIndex:t},requiredFields:r}=this;return e.outFields?(0,n.Q0)(t,[...(0,n.Lk)(t,e.outFields),...r]):(0,n.Q0)(t,r)}}}}},21808:(e,t,r)=>{r.d(t,{Z:()=>h});var n=r(36663),i=r(7753),s=r(13802),o=r(61681),l=r(9489),a=r(78668),u=r(76868),d=r(81977),c=(r(39994),r(40266)),p=r(90472),f=r(26216);let y=class extends f.Z{constructor(){super(...arguments),this.layer=null,this.filter=null,this._geometryEngine=null,this._projectionEngineLoaded=!1,this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){throw new Error("Not implemented")}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return(0,l.lK)(this._layerFilter)}get _layerFilter(){const e=this.layer?.filter;if(null==e||e.geometries.length<1)return null;const t=this._geometryEngine;if(null==t||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return l.cn;const r=e.geometries.at(0).spatialReference,n=e.geometries.toArray().map((e=>{try{e=t.simplify(e)}catch(e){return s.Z.getLogger(this).warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==e)return null;if(e.spatialReference.equals(r))return e;try{return(0,p.project)(e,r)}catch(e){return s.Z.getLogger(this).warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}})).filter(i.pC).sort(((e,t)=>e.extent.xmin-t.extent.xmin)),o=new Set,a=new Array,u=new Array;for(let e of n){const r=e.extent.xmin;if(a.length=0,o.forEach((n=>{if(r>=n.extent.xmax)return u.push(n),void o.delete(n);e.extent.ymin<=n.extent.ymax&&e.extent.ymax>=n.extent.ymin&&t.intersects(e,n)&&a.push(n)})),a.length>0){a.push(e);try{e=t.union(a)}catch(e){s.Z.getLogger(this).warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}a.pop(),a.forEach((e=>o.delete(e)))}o.add(e)}return o.forEach((e=>u.push(e))),u.length>0?{spatialRelationship:e.spatialRelationship,geometries:u}:null}get _filterNeedsProjectionEngine(){const e=this.layer.filter;if(null==e||e.geometries.length<=1)return!1;const t=e.geometries.at(0).spatialReference;return e.geometries.some((({spatialReference:e})=>!e.equals(t)&&!(0,p.canProjectWithoutEngine)(e,t)))}get layerFilterUpdating(){return(0,l.j)(this._layerFilter)}initialize(){const{signal:e}=this._abortController;(0,u.whenOnce)((()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length),e).then((async()=>{(0,a.r9)(e),this._geometryEngine=await Promise.all([r.e(89067),r.e(16233)]).then(r.bind(r,17700))})).catch(a.H9),this._projectionEngineLoaded=(0,p.isLoaded)(),(0,u.whenOnce)((()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine),e).then((async()=>{(0,a.r9)(e),await(0,p.load)(),this._projectionEngineLoaded=!0})).catch(a.H9)}destroy(){this._abortController=(0,o.IM)(this._abortController)}highlight(e){throw new Error("Not implemented")}queryFeatures(e,t){throw new Error("Not implemented")}queryObjectIds(e,t){throw new Error("Not implemented")}queryFeatureCount(e,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(e,t){throw new Error("Not implemented")}};(0,n._)([(0,d.Cb)()],y.prototype,"layer",void 0),(0,n._)([(0,d.Cb)()],y.prototype,"availableFields",null),(0,n._)([(0,d.Cb)()],y.prototype,"maximumNumberOfFeatures",null),(0,n._)([(0,d.Cb)({readOnly:!0})],y.prototype,"maximumNumberOfFeaturesExceeded",null),(0,n._)([(0,d.Cb)()],y.prototype,"filter",void 0),(0,n._)([(0,d.Cb)({readOnly:!0})],y.prototype,"layerFilter",null),(0,n._)([(0,d.Cb)({readOnly:!0})],y.prototype,"_layerFilter",null),(0,n._)([(0,d.Cb)()],y.prototype,"_geometryEngine",void 0),(0,n._)([(0,d.Cb)()],y.prototype,"_projectionEngineLoaded",void 0),(0,n._)([(0,d.Cb)()],y.prototype,"_filterNeedsProjectionEngine",null),(0,n._)([(0,d.Cb)()],y.prototype,"layerFilterUpdating",null),y=(0,n._)([(0,c.j)("esri.views.layers.SceneLayerView")],y);const h=y}}]);