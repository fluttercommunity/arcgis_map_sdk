(()=>{"use strict";var e,t,i={91637:(e,t,i)=>{i.d(t,{A:()=>C,YI:()=>Z,qK:()=>Y,Yz:()=>a,Bp:()=>O,a3:()=>P,g0:()=>W});var r=i(39462);var n,s=Symbol.for("controller");function o(e){n!==e&&(n=e,queueMicrotask((()=>{n===e&&(n=void 0)})))}function a(e){return n}var l,c=[];function u(e){if(void 0===e)return void(c=[]);const t=c.indexOf(e);c=-1===t?[...c,e]:c.slice(0,t+1),queueMicrotask((()=>{c=[]}))}function h(){return c}var d,p=async(e,t)=>{const i=m(e);if(void 0===i)return e;if(await i.ready,"function"==typeof t){0;const e=i.watchExports((i=>t(i,e)))}return i.exports},f=async e=>{const t=m(e);return await t.ready,t},m=e=>{const t=a().manager.internals.resolveExports(e);if(void 0!==t)return t;if((e=>"object"==typeof e&&null!==e&&(s in e||"hostConnected"in e||"hostDisconnected"in e||"hostUpdate"in e||"hostUpdated"in e))(e))return e;const i=function(){const e=l;return l=void 0,e}();return void 0!==i?i:void 0},g={setter:!1,getter:!1,readOnly:!1},y=new WeakMap;d=s;var _=class{constructor(e){this._callbacks={hostConnected:[],hostDisconnected:[],hostLoad:[],hostLoaded:[],hostUpdate:[],hostUpdated:[],hostDestroy:[],hostLifecycle:[]},this._ready=new r.BH,this._lifecycleCleanups=[],this.connectedCalled=!1,this._loadCalled=!1,this.loadedCalled=!1,this[d]=!0,this.ready=this._ready.promise,this._exports=w(this),this._exportWatchers=new Set;const t=e??a(new.target.name);this.component=t,this.component.addController(this);void 0===this.component.manager||(u(this),queueMicrotask((()=>this.catchUpLifecycle())))}catchUpLifecycle(){const{manager:e}=this.component;!e.connectedCalled||this.connectedCalled||this.triggerConnected();!e._loadCalled||this.triggerLoad().then((()=>{!e.loadedCalled||this.triggerLoaded()})).catch(console.error)}get exports(){return this._exports}set exports(e){const t=this._exports;t!==e&&(this._exports=e,this._exportWatchers.forEach(r.Dx),this.connectedCalled&&!1!==this.assignedProperty&&this.component.requestUpdate(this.assignedProperty,t)),this._ready.resolve(e)}setProvisionalExports(e,t=!0){this._exports=t?w(e):e,this._exportWatchers.forEach(r.Dx)}watchExports(e){const t=()=>e(this._exports);return this._exportWatchers.add(t),()=>{this._exportWatchers.delete(t)}}get use(){return o(this.component),p}get useRef(){return o(this.component),f}get useRefSync(){return o(this.component),m}controllerRemoved(){this.component.el.isConnected&&this.triggerDisconnected(),this.triggerDestroy()}onConnected(e){this._callbacks.hostConnected.push(e)}onDisconnected(e){this._callbacks.hostDisconnected.push(e)}onLoad(e){this._callbacks.hostLoad.push(e)}onLoaded(e){this._callbacks.hostLoaded.push(e)}onUpdate(e){this._callbacks.hostUpdate.push(e)}onUpdated(e){this._callbacks.hostUpdated.push(e)}onDestroy(e){this._callbacks.hostDestroy.push(e)}onLifecycle(e){this._callbacks.hostLifecycle.push(e),this.connectedCalled&&this.component.el.isConnected&&this._callLifecycle(e)}triggerConnected(){const e=this;e.hostConnected&&(0,r.Dx)(e.hostConnected,e),this._callbacks.hostConnected.forEach(r.Dx),this.triggerLifecycle(),this.connectedCalled=!0}triggerDisconnected(){const e=this;e.hostDisconnected&&(0,r.Dx)(e.hostDisconnected,e),this._callbacks.hostDisconnected.forEach(r.Dx),this._lifecycleCleanups.forEach(r.Dx),this._lifecycleCleanups=[]}async triggerLoad(){if(this._loadCalled)return;this._loadCalled=!0;const e=this;e.hostLoad&&await(0,r.BB)(e.hostLoad,e),this._callbacks.hostLoad.length>0&&await Promise.allSettled(this._callbacks.hostLoad.map(r.BB)),this._ready.resolve(this._exports)}triggerLoaded(){if(this.loadedCalled)return;const e=this;e.hostLoaded&&(0,r.Dx)(e.hostLoaded,e),this._callbacks.hostLoaded.forEach(r.Dx),this.loadedCalled=!0}triggerUpdate(e){const t=this;t.hostUpdate&&(0,r.Dx)(t.hostUpdate,t,e),this._callbacks.hostUpdate.forEach(v,e)}triggerUpdated(e){const t=this;t.hostUpdated&&(0,r.Dx)(t.hostUpdated,t,e),this._callbacks.hostUpdated.forEach(v,e)}triggerDestroy(){const e=this;e.hostDestroy&&(0,r.Dx)(e.hostDestroy,e),this._callbacks.hostDestroy.forEach(r.Dx)}triggerLifecycle(){const e=this;e.hostLifecycle&&this._callLifecycle((()=>e.hostLifecycle())),this._callbacks.hostLifecycle.forEach(this._callLifecycle,this)}_callLifecycle(e){o(this.component);const t=(0,r.Dx)(e);(Array.isArray(t)?t:[t]).forEach((e=>{"function"==typeof e?this._lifecycleCleanups.push(e):"object"==typeof e&&"function"==typeof e.remove&&this._lifecycleCleanups.push(e.remove)}))}};function v(e){(0,r.Dx)(e,void 0,this)}var b=_;function w(e){if("object"!=typeof e&&"function"!=typeof e||null===e)return e;const t=new Proxy(e,{get(e,i,r){if(!x.has(i)||!(i in e)||e[i]!==t)return i in e||i in Promise.prototype||"symbol"==typeof i?"function"==typeof e?e[i]:Reflect.get(e,i,r):void 0},set:(e,t,i,r)=>Reflect.set(e,t,i,r)});return t}var x=new Set(["exports","_exports"]);var T=void 0;function C(){Array.from(T?.entries()??[]).forEach((([e,{callbacks:t}])=>{const i=Object.keys(e);t.forEach((e=>e(i)))})),T=void 0}function S(e,t,i){var n;const s=t;const o=e.manager.internals;(n=o.allWatchers)[s]??(n[s]=[]);const a=o.allWatchers[s],l=i,c=(e,t,i)=>(0,r.Dx)(l,null,e,t,i);return a.push(c),()=>{const e=a.indexOf(c);-1!==e&&a.splice(e,1)}}var E=[],M=Symbol(),A=Symbol();function R(e,t,i){const n=e.manager.internals;return n.trackedValue!==A&&n.trackedValue!==i&&n.firePropTrackers(void 0,void 0),0===n.keyTrackers.length&&queueMicrotask((()=>n.firePropTrackers(void 0,void 0))),n.trackedValue=i,n.keyTrackers.push(((e,n)=>(0,r.Dx)(t,void 0,i===n?e:void 0))),i}function O(e=[a(),...h()],t,i){const n=Array.isArray(e)?e:[e];let s=n.length+1;const o=e=>{s-=1,void 0!==e&&(s=Math.min(s,0)),0===s&&t(e)};n.forEach((e=>function(e,t,i){const n=Object.keys(e),s=n.length;void 0===T&&queueMicrotask(C),T??(T=new Map);let o=T.get(e);return void 0===o&&(o={callbacks:[],keyCount:s},T.set(e,o)),o.keyCount!==s&&(o.callbacks.forEach((e=>e(n))),o.callbacks=[],o.keyCount=s),o.callbacks.push((n=>{const o=e=>(0,r.Dx)(t,null,e),a=n[s];void 0===a?o(void 0):e[a]===i?o(a):o(void 0)})),i}(e,(t=>o(void 0===t?void 0:{key:t,host:e,isReactive:!1})),i)));const l=n.find((e=>"manager"in e&&"object"==typeof e.manager&&e.manager.component===e));return l&&R(l,(e=>o(void 0===e?void 0:{key:e,host:l,isReactive:!0})),i),i}var P=(e,t)=>new I(e,t),I=class extends b{constructor(e,t){const i="addController"in e;const n=new Set;const a=e;if(a.addController=function(t){n.add(t),!(s in t)&&e.renderRoot&&e.el.isConnected&&t.hostConnected?.()},a.removeController=function(e){n.delete(e),e.controllerRemoved?.()},!i){const i=t??e.constructor.__forceUpdate;a.requestUpdate=()=>i(e)}super(e),this.internals=new class{constructor(e){this.enabledWatchers={},this.allWatchers={},this.enableReadonly=()=>{if(this.enableReadonly=void 0,!this.component.manager.isLit)return;const e=this.component.manager.internals;Object.entries(e.members).forEach((([t,[i]])=>{var r;2048&i&&((r=e.setters)[t]??(r[t]=[]),e.setters[t].push(e.readonlySetter))}))},this.trackedValue=A,this.keyTrackers=[],this.getters={},this.setters={},this.accessorGetter={},this.accessorSetter={},this._exports=new WeakMap,this.readonlySetter=(e,t,i)=>{if(g.readOnly)return e;throw new Error(`Cannot assign to read-only property "${i}" of ${this.component.el.tagName.toLowerCase()}. Trying to assign "${String(e)}"`)},this.component=e}firePropTrackers(e,t){const i=this.keyTrackers;this.trackedValue=A,this.keyTrackers=[],i.forEach((i=>i(e,t)))}getSetProxy(e){const t=this.component,i=t.constructor.prototype;if(this._getSetProxy(i,e,"class"),t.manager.isLit)return;const r=t.el.constructor.prototype;i!==r&&this._getSetProxy(r,e,"html")}_getSetProxy(e,t,i){const r=((e,t)=>e.manager.internals.members?.[t]?.[0])(this.component,t);let n;do{n=Object.getOwnPropertyDescriptor(e,t)}while(!n&&(e=Object.getPrototypeOf(e)));if(!n)return;const s=n.get,o=n.set,a=M in s,l=M in o;if(a&&l)return;const c=!a,u=!l,h=c?function(){let e=s.call(this);const i=y.get(this);if(g.getter||void 0===i)return e;const r=i.manager.internals;e=r.accessorGetter[t](e,t);const n=r.getters[t]??E;for(let i=0;i<n.length;i++)e=n[i](e,t);return e}:s,d=u?function(e){const i=s.call(this),n=y.get(this);if(void 0===n)return void o.call(this,e);let a=n.manager.isLit?e??void 0:function(e,t=8){return null==e||"object"==typeof e||"function"==typeof e?e:0!=(4&t)?"false"!==e&&(""===e||!!e):0!=(2&t)?Number.parseFloat(e):0!=(1&t)?String(e):e}(e,r);const l=n.manager.internals;if(a===i)o.call(this,a);else{const e=g.setter?E:l.setters[t]??E;for(let r=0;r<e.length&&(a=e[r](a,i,t),a!==i);r++);a=l.accessorSetter[t](a,i,t),o.call(this,a),a!==i&&l.enabledWatchers[t]?.forEach((e=>e(a,i,t)))}l.keyTrackers.length>0&&l?.firePropTrackers(t,e)}:o;c&&(h[M]=!0),u&&(d[M]=!0),Object.defineProperty(e,t,{...n,get:h,set:d})}markExports(e,t){("object"==typeof t&&null!==t||"function"==typeof t)&&this._exports.set(t,e)}resolveExports(e){return"object"==typeof e&&null!==e||"function"==typeof e?this._exports.get(e):void 0}}(this.component),this.destroyed=!1,this._updatePromise=new r.BH,this._originalLifecycles={},this.isLit=i,this.component.manager=this,function(e,t){if(t){const t=e.constructor.elementProperties;e.manager.internals.members=Object.fromEntries(Array.from(t,(([e,t])=>t.noAccessor?void 0:[e,[(t.readOnly?2048:0)|(t.state?32:16)]])).filter(r.pT))}else{const t=e.constructor,i=t.__registerControllers?.(e)??void 0;if(t.__registerControllers=void 0,"object"!=typeof i)throw new Error("Failed to retrieve component meta");e.manager.internals.members=Object.fromEntries(Object.entries(i).filter((([e,[t]])=>0!=(63&t))))}}(e,i),this._controllers=n,this.exports=void 0,this.hasDestroy=L in this.component&&"function"==typeof this.component.destroy,this._bindLifecycleMethods();const l=this.internals;Object.keys(l.members).forEach((e=>{l.accessorGetter[e]=N,l.accessorSetter[e]=N,l.getSetProxy(e)})),i?this.internals.enabledWatchers=this.internals.allWatchers:Object.defineProperty(e,"updateComplete",{get:async()=>await this._updatePromise.promise}),queueMicrotask(l.enableReadonly),o(e),y.set(e.el,e),y.set(e,e)}_bindLifecycleMethods(){const e=this.component,t=this.isLit,i=e.el===e;this._originalLifecycles={_connectedCallback:t||i?void 0:e.connectedCallback,_disconnectedCallback:t||i?void 0:e.disconnectedCallback,_load:t?e.load:e.componentWillLoad,_loaded:t?e.loaded:e.componentDidLoad,_willUpdate:t?void 0:e.componentWillUpdate,_updated:t?void 0:e.componentDidUpdate,_destroy:e.destroy};const r=this._connectedCallback.bind(this),n=this._disconnectedCallback.bind(this),s=this._update.bind(this),o=this._updated.bind(this);t?e.constructor.prototype.addController.call(e,{hostConnected:r,hostDisconnected:n,hostUpdate:s,hostUpdated:o}):(e.connectedCallback=r,e.disconnectedCallback=n,e.componentWillLoad=this._load.bind(this),e.componentDidLoad=this._loaded.bind(this),e.componentWillUpdate=s,e.componentDidUpdate=o),this.hasDestroy&&(e.destroy=this.destroy.bind(this))}_connectedCallback(){if(this.destroyed){const e=this.component.el.tagName.toLowerCase();throw this.component.el.remove(),new Error(`The ${e} component has already been destroyed. It cannot be used again. If you meant to disconnect and reconnect a component without automatic destroy, set the ${L} prop.`)}void 0!==this._autoDestroyTimeout&&clearTimeout(this._autoDestroyTimeout);const e=this.internals;e.enabledWatchers=e.allWatchers,C(),e.enableReadonly?.(),this._controllers.forEach(F),this._originalLifecycles._connectedCallback?.call(this.component)}_disconnectedCallback(){this.destroyed||(this._controllers.forEach(U),this._originalLifecycles._disconnectedCallback?.call(this.component),this.hasDestroy&&this._setAutoDestroyTimeout())}async _load(){await Promise.allSettled(Array.from(this._controllers,k)),await(this._originalLifecycles._load?.call(this.component)),this.hasDestroy&&S(this.component,L,(()=>this._setAutoDestroyTimeout()))}_loaded(){this._controllers.forEach(z),this._originalLifecycles._loaded?.call(this.component)}_update(){const e=this.component;return this._controllers.forEach(B,e.$changes),this._originalLifecycles._willUpdate?.call(this.component)}_updated(){const e=this.component;if(this._controllers.forEach(V,e.$changes),this._originalLifecycles._updated?.call(this.component),this.isLit)e.$changes=new Map;else{const e=this._updatePromise;this._updatePromise=new r.BH,e.resolve(!0)}}async destroy(){if(!this.destroyed){if(this.component.el.isConnected){this.hasDestroy=!1;try{this.component.el.remove()}finally{this.hasDestroy=!0}}this._autoDestroyTimeout=void 0,this.destroyed=!0,this._controllers.forEach(H),this._controllers.clear(),await(this._originalLifecycles._destroy?.call(this.component))}}_setAutoDestroyTimeout(){if(void 0!==this._autoDestroyTimeout&&clearTimeout(this._autoDestroyTimeout),!this.component.el.isConnected&&!this.component.autoDestroyDisabled){const e=()=>{this.destroy().catch(console.error)};this._autoDestroyTimeout=(0,r.lG)(e,D)}}};var L="autoDestroyDisabled",D=1e3,N=e=>e;function F(e){"triggerConnected"in e?e.triggerConnected():(0,r.Dx)(e.hostConnected,e)}function U(e){"triggerDisconnected"in e?e.triggerDisconnected():(0,r.Dx)(e.hostDisconnected,e)}async function k(e){"triggerLoad"in e?await e.triggerLoad():await(0,r.BB)(e.hostLoad,e)}function z(e){"triggerLoaded"in e?e.triggerLoaded():(0,r.Dx)(e.hostLoaded,e)}function B(e){"triggerUpdate"in e?e.triggerUpdate(this):(0,r.Dx)(e.hostUpdate,e,this)}function V(e){"triggerUpdated"in e?e.triggerUpdated(this):(0,r.Dx)(e.hostUpdated,e,this)}function H(e){"triggerDestroy"in e?e.triggerDestroy():(0,r.Dx)(e.hostDestroy,e)}var G,j=e=>q(void 0,e),Z=e=>t=>q(t,e),q=(G=class extends _{constructor(e,t){super(e);const i=this.exports;try{o(this.component);const e=t(this.component,this),r=this.exports!==i;if(e instanceof Promise){r||this.setProvisionalExports(e);const t=e.then((e=>{this.exports=e,super.catchUpLifecycle()})).catch((e=>{this._ready.reject(e),console.error(e)}));this.onLoad((async()=>await t))}else r&&void 0===e||(this.exports=e),queueMicrotask((()=>super.catchUpLifecycle()))}catch(e){this._ready.reject(e),console.error(e)}}catchUpLifecycle(){}},(...e)=>{const t=h(),i=new G(...e),r=i.exports;u(t.at(-1));const n=i.component.manager.internals;var s;return n.markExports(i,r),i.watchExports((e=>n.markExports(i,e))),l!==(s=i)&&(l=s,queueMicrotask((()=>{l===s&&(l=void 0)}))),O([i.component,...t].reverse(),(e=>void 0===e?void 0:function(e,{host:t,key:i,isReactive:r},n){const s=t,o=s[i]!==e.exports,a=s[i]!==n,l=n!==e.exports;o&&!a&&l&&(s[i]=e.exports);const c=t===e.component;if(c){if(r){const t=e.component.manager.internals;a&&t.markExports(e,s[i]),S(e.component,i,(i=>{i!==e.exports&&t.markExports(e,i)}))}e.assignedProperty=r?void 0:i}e.watchExports((()=>{if(s[i]===e.exports)return;const t=e.component.manager,r=t.internals.setters[i]?.includes(t.internals.readonlySetter);r?function(e){g.readOnly=!0;try{e()}finally{g.readOnly=!1}}((()=>{s[i]=e.exports})):s[i]=e.exports}))}(i,e,r)),r)}),W=(e,t)=>new $(e,t),$=class extends _{constructor(e,t){super(),this._attributes=e,this._callback=t,this._observer=new MutationObserver((i=>{i.forEach((i=>{e.includes(i.attributeName)&&t.call(this.component,this.component.el.getAttribute(i.attributeName),i.oldValue,i.attributeName)}))}))}hostConnected(){this._attributes.forEach((e=>{this.component.el.hasAttribute(e)&&this._callback.call(this.component,null,this.component.el.getAttribute(e),e)})),this._observer.observe(this.component.el,{attributes:!0,attributeOldValue:!0,attributeFilter:this._attributes})}hostDisconnected(){this._observer.disconnect()}},Y=e=>(t={})=>j(((i,n)=>{const s=(0,r.aS)(i.el),o={_lang:s.lang,_t9nLocale:s.t9nLocale,_loading:!0},a=i;function l(e){const t=n.exports,i=t._original??t,r=J(i,e);e&&(r._original=i),n.exports=r}return n.onLifecycle((()=>(0,r.Kn)(i.el,(()=>e("./assets")),(({t9nLocale:e,t9nStrings:t,lang:r})=>{const s={...t,_lang:r,_t9nLocale:e,_loading:!1};n.exports=s;const o=t.componentLabel;"string"==typeof o&&"label"in i&&null==i.label&&(i.label??(i.label=o)),l(a.messageOverrides)}),t.name))),"messageOverrides"in a&&n.onLifecycle((()=>S(a,"messageOverrides",l))),t.blocking?(n.setProvisionalExports(o,!1),n.ready):o}));function J(e,t){if(!t)return e;const i={...e};return Object.entries(t).forEach((([t,r])=>{i[t]="object"==typeof r?J(e[t],r):r??e[t]})),i}},39462:(e,t,i)=>{i.d(t,{BB:()=>c,BH:()=>r,Dx:()=>l,Kn:()=>_,aS:()=>g,lG:()=>w,mB:()=>v,pT:()=>S});var r=class{resolve(e){}reject(e){}constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}};function n(e,t,i){const{subscribe:r}=function(e){const t=e.join(","),i=s[t];if(void 0!==i)return i;const r=new Set,n=new MutationObserver((e=>r.forEach((t=>t(e)))));globalThis.document&&n.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const o={subscribe:e=>(r.add(e),()=>{r.delete(e),0===r.size&&(n.disconnect(),s[t]=void 0)})};return s[t]=o,o}(t);return r((t=>{const r=t.some((t=>function(e,t){let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1}(e,t.target)));r&&i()}))}var s={};function o(e,t){let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const r=i.getRootNode?.();if(r===globalThis.document)return null;i=r.host}return null}function a(e,t,i){return o(e,`[${t}]`)?.getAttribute(t)??i}function l(e,t,...i){try{return e?.call(t,...i)}catch(t){console.error(t,e)}}async function c(e,t,...i){try{const r=e?.call(t,...i);return r instanceof Promise?await r:r}catch(t){console.error(t,e)}}var u=new Set(["ar","bg","bs","ca","cs","da","de","el","en","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nl","nb","no","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"]),h="en",d={pt:"pt-PT",nb:"no",zh:"zh-CN"};async function p(e,t,i=""){const r=`${t}/${i}`,n=`${r}${e}.json`;return f[n]??(f[n]=m(e,r)),await f[n]}var f={};async function m(e,t){const i=`${t}${e}.json`;try{const e=await fetch(i);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===h?{}:await m(h,t)}function g(e){const t=a(e,"lang",globalThis.navigator?.language||h);return{lang:t,t9nLocale:y(t)}}function y(e){const[t,i]=e.split("-"),r=t.toLowerCase();let n=r;return i&&(n=`${r}-${i.toUpperCase()}`),n=d[n]??n,u.has(n)?n:i?y(r):h}function _(e,t,i,r){let s;const o=()=>{(async function(e,t,i=e.tagName.toLowerCase().split("-").slice(1).join("-")){const{lang:r,t9nLocale:n}=g(e),s=`${t}/${i}/t9n`,o="messages.",a=null===i?{}:await p(n,s,o);return{lang:r,t9nLocale:n,t9nStrings:a}})(e,t(),r).then((e=>{s?.lang===e.lang&&s.t9nLocale===e.t9nLocale&&s.t9nStrings===e.t9nStrings||i(e),s=e})).catch(console.error)};return queueMicrotask(o),n(e,["lang"],o)}var v=e=>e.replace(b,((e,t)=>`${0===t?"":"-"}${e.toLowerCase()}`)),b=/[A-Z]+(?![a-z])|[A-Z]/gu;function w(e,t){const i=t>x?T:t/C;let r=0;const n=setInterval((()=>{r+=i,r>=t&&(clearInterval(n),e())}),i);return n}var x=4e3,T=2e3,C=4;function S(e){return void 0!==e}},10017:(e,t,i)=>{i.r(t),i.d(t,{default:()=>L});var r=i(36663),n=i(66341),s=i(41831),o=i(58811),a=i(82064),l=i(67134),c=i(68309),u=i(63592),h=i(13802),d=i(61681),p=i(78668),f=i(3466),m=i(81977),g=(i(39994),i(40266)),y=i(39835),_=i(14685),v=i(93968),b=i(53110),w=i(2725),x=(i(87090),i(74396)),T=(i(4157),i(8108)),C=i(60720);let S=class extends x.Z{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2",this.worldview=null}get languageParameter(){const e=this.language;let t="local"===e||"global"===e?e:(0,C.Su)(e??(0,T.Kd)())??"global";return t="no"===t?"nb":t,t}};(0,r._)([(0,m.Cb)()],S.prototype,"apiKey",void 0),(0,r._)([(0,m.Cb)()],S.prototype,"id",void 0),(0,r._)([(0,m.Cb)()],S.prototype,"language",void 0),(0,r._)([(0,m.Cb)()],S.prototype,"places",void 0),(0,r._)([(0,m.Cb)()],S.prototype,"serviceUrl",void 0),(0,r._)([(0,m.Cb)()],S.prototype,"worldview",void 0),S=(0,r._)([(0,g.j)("esri.support.BasemapStyle")],S);const E=S;var M,A=i(4e4);let R=0,O=M=class extends(a.Z.JSONSupportMixin(c.Z)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+R++,this.baseLayers=new s.Z,this.referenceLayers=new s.Z;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&h.Z.getLogger(this).error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=e=>{e.parent=null};this.addHandles([this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>i(e.item))),this.referenceLayers.on("after-remove",(e=>i(e.item)))])}initialize(){this.when().catch((e=>{h.Z.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const t of e)t.destroy();const t=this.referenceLayers.toArray();for(const e of t)e.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=(0,d.SC)(this.portalItem)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",(0,o.Z)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e?(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=(0,A.Nw)(e,i.webmap?i.webmap.getLayerJSONFromResourceInfo(e):null,i);null!=t&&r.push(t)})),this.referenceLayers.forEach((e=>{const t=(0,A.Nw)(e,i.webmap?i.webmap.getLayerJSONFromResourceInfo(e):null,i);null!=t&&("scene"!==e.type&&(t.isReference=!0),r.push(t))})),t.baseMapLayers=r):t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",(0,o.Z)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,u.G)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map((e=>(0,l.tZ)(e)?e.clone():e)),referenceLayers:this.referenceLayers.map((e=>(0,l.tZ)(e)?e.clone():e))};return this.loaded&&(e.loadStatus="loaded"),new M({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t?.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=(0,l.d9)(e);return t.url&&(0,f.oC)(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&(0,f.oC)(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i,style:r}=this;(0,p.k_)(e);const n=[];if(t){const i=t.context?t.context.url:null;if(n.push(this._loadLayersFromJSON(t.data,i,e)),t.data.id&&!t.data.title){const e=t.data.id;n.push((0,w.g)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else i?n.push(this._loadFromItem(i,e)):r&&n.push(this._loadFromStylesService(r,e));await Promise.all(n)}async _loadLayersFromJSON(e,t,r){const n=this.resourceInfo?.context,s=this.portalItem?.portal||n?.portal||null,o=I[n?.origin||""]??"web-map",{populateOperationalLayers:a}=await i.e(45423).then(i.bind(i,45423)),l=[];if((0,p.k_)(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const i={context:{...n,origin:o,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},r=e=>"web-scene"===o&&"ArcGISSceneServiceLayer"===e.layerType||e.isReference,c=a(this.baseLayers,e.baseMapLayers.filter((e=>!r(e))),i);l.push(c);const u=a(this.referenceLayers,e.baseMapLayers.filter(r),i);l.push(u)}await Promise.allSettled(l)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),n=(0,f.mN)(e.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:P[e.type||""]??"web-map",portal:e.portal||v.Z.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||v.Z.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,t)}async _loadFromStylesService(e,t){const i=e.serviceUrl.endsWith("/webmaps")?e.serviceUrl.slice(0,-8):e.serviceUrl,r=`${i}/styles/${e.id}/self`,s=`${i}/webmaps/${e.id}`,[o,a]=await Promise.all([(await(0,n.Z)(r,{query:{token:e.apiKey},signal:t?.signal})).data,(await(0,n.Z)(s,{query:{language:e.languageParameter,places:e.places,worldview:e.worldview,token:e.apiKey},signal:t?.signal})).data]);this.thumbnailUrl??=o.thumbnailUrl;const l=(0,f.mN)(s);if(this._set("resourceInfo",{data:a.baseMap??{},context:{origin:"web-map",url:l}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:a.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,l,t),e.apiKey)for(const t of[...this.baseLayers,...this.referenceLayers])"apiKey"in t&&(t.apiKey=e.apiKey)}static fromId(e){const t=w.s[e];return t?t.itemId?new M({portalItem:{id:t.itemId,portal:{url:"https://www.arcgis.com"}}}):M.fromJSON(t,{origin:t.is3d?"web-scene":"web-map"}):null}};(0,r._)([(0,m.Cb)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:s.Z}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],O.prototype,"baseLayers",null),(0,r._)([(0,m.Cb)({type:String,json:{origins:{"web-scene":{write:!0}}}})],O.prototype,"id",void 0),(0,r._)([(0,m.Cb)({type:b.default})],O.prototype,"portalItem",void 0),(0,r._)([(0,m.Cb)()],O.prototype,"referenceLayers",null),(0,r._)([(0,m.Cb)({readOnly:!0})],O.prototype,"resourceInfo",void 0),(0,r._)([(0,m.Cb)({type:_.Z})],O.prototype,"spatialReference",void 0),(0,r._)([(0,m.Cb)({type:E})],O.prototype,"style",void 0),(0,r._)([(0,m.Cb)()],O.prototype,"thumbnailUrl",void 0),(0,r._)([(0,m.Cb)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],O.prototype,"title",void 0),(0,r._)([(0,y.c)("title")],O.prototype,"writeTitle",null),O=M=(0,r._)([(0,g.j)("esri.Basemap")],O);const P={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},I={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},L=O},33098:(e,t,i)=>{i.d(t,{Z:()=>_});var r=i(36663),n=i(41151),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return null!=e&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"row",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"column",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"rows",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"columns",void 0),a=(0,r._)([(0,o.j)("esri.CameraLayout")],a);const l=a;var c=i(16068),u=i(82064),h=i(19431),d=i(69236),p=i(34248),f=i(39835),m=i(7283),g=i(10186);let y=class extends(n.Z.ClonableMixin(u.Z)){constructor(...e){super(...e),this.position=new g.Z([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new l}normalizeCtorArgs(e,t,i,r){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){const n={position:e};return null!=t&&(n.heading=t),null!=i&&(n.tilt=i),null!=r&&(n.fov=r),n}return e}writePosition(e,t,i,r){const n=e.clone();n.x=(0,m.q9)(e.x||0),n.y=(0,m.q9)(e.y||0),n.z=e.hasZ?(0,m.q9)(e.z||0):e.z,t[i]=n.write({},r)}readPosition(e,t){const i=new g.Z;return i.read(e,t),i.x=(0,m.q9)(i.x||0),i.y=(0,m.q9)(i.y||0),i.z=i.hasZ?(0,m.q9)(i.z||0):i.z,i}equals(e){return null!=e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};(0,r._)([(0,s.Cb)({type:g.Z,json:{write:{isRequired:!0}}})],y.prototype,"position",void 0),(0,r._)([(0,f.c)("position")],y.prototype,"writePosition",null),(0,r._)([(0,p.r)("position")],y.prototype,"readPosition",null),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,d.p)((e=>c.BV.normalize((0,m.q9)(e))))],y.prototype,"heading",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,d.p)((e=>(0,h.uZ)((0,m.q9)(e),-180,180)))],y.prototype,"tilt",void 0),(0,r._)([(0,s.Cb)({type:Number,nonNullable:!0,json:{default:55,write:!0}}),(0,d.p)((e=>(0,h.uZ)((0,m.q9)(e,55),1,170)))],y.prototype,"fov",void 0),(0,r._)([(0,s.Cb)({type:l,nonNullable:!0,json:{read:!1,write:!1}})],y.prototype,"layout",void 0),y=(0,r._)([(0,o.j)("esri.Camera")],y);const _=y},30936:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(86875),n=i(19431),s=i(7283);function o(e){return(0,n.uZ)((0,s.vU)(e),0,255)}function a(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}function l(e,t){const i=e.toString(16).padStart(2,"0");return t?i.slice(0,1):i}class c{static blendColors(e,t,i,r=new c){return r.r=Math.round(e.r+(t.r-e.r)*i),r.g=Math.round(e.g+(t.g-e.g)*i),r.b=Math.round(e.b+(t.b-e.b)*i),r.a=e.a+(t.a-e.a)*i,r._sanitize()}static fromRgb(e,t){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(i){const e=i[2].split(/\s*,\s*/),n=i[1];if("rgb"===n&&3===e.length||"rgba"===n&&4===e.length){const i=e[0];if("%"===i.charAt(i.length-1)){const i=e.map((e=>2.56*parseFloat(e)));return 4===e.length&&(i[3]=parseFloat(e[3])),c.fromArray(i,t)}return c.fromArray(e.map((e=>parseFloat(e))),t)}if("hsl"===n&&3===e.length||"hsla"===n&&4===e.length)return c.fromArray((0,r.B7)(parseFloat(e[0]),parseFloat(e[1])/100,parseFloat(e[2])/100,parseFloat(e[3])),t)}return null}static fromHex(e,t=new c){if("#"!==e[0]||isNaN(Number(`0x${e.slice(1)}`)))return null;switch(e.length){case 4:case 5:{const i=parseInt(e.slice(1,2),16),r=parseInt(e.slice(2,3),16),n=parseInt(e.slice(3,4),16),s=5===e.length?15:parseInt(e.slice(4),16);return c.fromArray([i+16*i,r+16*r,n+16*n,(s+16*s)/255],t)}case 7:case 9:{const i=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16),s=7===e.length?255:parseInt(e.slice(7),16);return c.fromArray([i,r,n,s/255],t)}default:return null}}static fromArray(e,t=new c){return t._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(t.a)&&(t.a=1),t._sanitize()}static fromString(e,t){const i=(0,r.St)(e)?(0,r.h$)(e):null;return i&&c.fromArray(i,t)||c.fromRgb(e,t)||c.fromHex(e,t)}static fromJSON(e){return null!=e?new c([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return null!=e?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return null!=e?[e.r/255,e.g/255,e.b/255,null!=e.a?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return.299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return"string"==typeof e?c.fromString(e,this):Array.isArray(e)?c.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof c||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const t=e?.capitalize??!1,i=e?.digits??6,r=3===i||4===i,n=4===i||8===i,s=`#${l(this.r,r)}${l(this.g,r)}${l(this.b,r)}${n?l(Math.round(255*this.a),r):""}`;return t?s.toUpperCase():s}toCss(e=!1){const t=this.r+", "+this.g+", "+this.b;return e?`rgba(${t}, ${this.a})`:`rgb(${t})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=c.AlphaMode.ALWAYS){const t=o(this.r),i=o(this.g),r=o(this.b);return e===c.AlphaMode.ALWAYS||1!==this.a?[t,i,r,o(255*this.a)]:[t,i,r]}clone(){return new c(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return null!=e&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(a(this.r,0,255)),this.g=Math.round(a(this.g,0,255)),this.b=Math.round(a(this.b,0,255)),this.a=a(this.a,0,1),this}_set(e,t,i,r){this.r=e,this.g=t,this.b=i,this.a=r}}c.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(c)},80085:(e,t,i)=>{i.d(t,{Z:()=>v});var r,n=i(36663),s=i(80020),o=i(41151),a=i(59801),l=i(82064),c=i(13802),u=i(76868),h=i(7958),d=i(81977),p=(i(39994),i(4157),i(40266)),f=i(53736),m=i(59659),g=i(9539);function y(e){if(null==e)return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return 0!==Object.keys(t).length?t:null}let _=r=class extends(o.Z.ClonableMixin(l.Z)){constructor(e){super(e),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,this._version=0,Object.defineProperty(this,"uid",{value:(0,h.D)(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&(0,a.bP)(c.Z.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),"mesh"!==e?.type&&this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}get version(){return this._version}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}cloneShallow(){return new r({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const i of[t,this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(e&&"defaultPopupTemplate"in i&&null!=i.defaultPopupTemplate)return i.defaultPopupTemplate}return null}getAttribute(e){return this.attributes?.[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:y(this.aggregateGeometries),geometry:null!=this.geometry?this.geometry.toJSON():null,symbol:null!=this.symbol?this.symbol.toJSON():null,attributes:l.Z.isSerializable(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyMeshTransformChanged(e={}){const{geometry:t}=this;if("mesh"===t?.type){const i={origin:t.origin,transform:t.transform};this._notifyLayer("origin-transform",i,i,e.action)}}_notifyLayer(e,t,i,r){if(this._version++,!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:e,oldValue:t,newValue:i};"origin-transform"===e&&(n.action=r),"attributes"===e&&(n.attributeName=r),this.layer.graphicChanged(n)}_watchMeshGeometryChanges(){this.addHandles([(0,u.when)((()=>"mesh"===this.geometry?.type&&this.geometry.vertexSpace.origin?{localMatrix:this.geometry.transform?.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0),(({localMatrix:e,origin:t})=>{this._lastMeshTransform.localMatrix===e&&this._lastMeshTransform.origin===t||(this._lastMeshTransform.localMatrix=e,this._lastMeshTransform.origin=t,this.notifyMeshTransformChanged())})),(0,u.when)((()=>"mesh"===this.geometry?.type?{vertexAttributes:this.geometry.vertexAttributes}:void 0),(()=>{const e=this.geometry;"mesh"===e?.type&&e.vertexSpace.origin?(this._lastMeshTransform.localMatrix=e.transform?.localMatrix,this._lastMeshTransform.origin=e.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)}),{equals:(e,t)=>e===t,sync:!0})])}};(0,n._)([(0,d.Cb)({value:null,json:{read:function(e){if(!e)return null;const t={};for(const i in e){const r=(0,f.im)(e[i]);r&&(t[i]=r)}return 0!==Object.keys(t).length?t:null}}})],_.prototype,"aggregateGeometries",null),(0,n._)([(0,d.Cb)({value:null})],_.prototype,"attributes",null),(0,n._)([(0,d.Cb)({value:null,types:m.qM,json:{read:f.im}})],_.prototype,"geometry",null),(0,n._)([(0,d.Cb)({type:Boolean})],_.prototype,"isAggregate",void 0),(0,n._)([(0,d.Cb)({clonable:"reference"})],_.prototype,"layer",void 0),(0,n._)([(0,d.Cb)({clonable:"reference"})],_.prototype,"origin",void 0),(0,n._)([(0,d.Cb)({type:s.Z})],_.prototype,"popupTemplate",void 0),(0,n._)([(0,d.Cb)({clonable:"reference"})],_.prototype,"sourceLayer",void 0),(0,n._)([(0,d.Cb)({value:null,types:g.LB})],_.prototype,"symbol",null),(0,n._)([(0,d.Cb)({clonable:!1,json:{read:!1,write:!1}})],_.prototype,"_version",void 0),(0,n._)([(0,d.Cb)({type:Boolean,value:!0})],_.prototype,"visible",null),_=r=(0,n._)([(0,p.j)("esri.Graphic")],_);const v=_},80020:(e,t,i)=>{i.d(t,{Z:()=>$});var r=i(36663),n=i(41151),s=i(41831),o=i(82064),a=i(67134),l=i(13802),c=i(78668),u=i(81977),h=i(69236),d=i(34248),p=i(40266),f=i(39835),m=i(7283),g=i(14845),y=i(24834),_=i(17814),v=i(15902),b=i(32776),w=i(29893),x=i(21363),T=i(83373),C=i(58106),S=i(82699);const E={base:null,key:"type",typeMap:{attachment:y.Z,media:x.Z,text:C.Z,expression:b.Z,field:w.Z,relationship:T.Z,utilityNetworkAssociations:S.Z}},M={base:null,key:"type",typeMap:{attachment:y.Z,media:x.Z,text:C.Z,expression:b.Z,field:w.Z,relationship:T.Z}};var A,R=i(18228),O=i(78213);i(39994),i(4157);let P=A=class extends o.Z{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new A({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};(0,r._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],P.prototype,"returnTopmostRaster",void 0),(0,r._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],P.prototype,"showNoDataRecords",void 0),P=A=(0,r._)([(0,p.j)("esri.popup.LayerOptions")],P);const I=P;var L,D=i(79163);let N=L=class extends o.Z{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new L({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?(0,a.d9)(this.orderByFields):null})}};(0,r._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],N.prototype,"showRelatedRecords",void 0),(0,r._)([(0,u.Cb)({type:[D.Z],json:{write:!0}})],N.prototype,"orderByFields",void 0),N=L=(0,r._)([(0,p.j)("esri.popup.RelatedRecordsInfo")],N);const F=N;var U=i(36598),k=i(83258),z=i(97837),B=i(15600);const V="relationships/",H="expression/",G=s.Z.ofType({key:"type",defaultKeyValue:"button",base:k.Z,typeMap:{button:z.Z,toggle:B.Z}}),j={base:_.Z,key:"type",typeMap:{media:x.Z,custom:v.Z,text:C.Z,attachments:y.Z,fields:w.Z,expression:b.Z,relationship:T.Z,utilityNetworkAssociations:S.Z}},Z=new Set(["attachments","fields","media","text","expression","relationship"]),q=new Set([...Z,"utility-network-associations"]);let W=class extends(n.Z.ClonableMixin(o.Z)){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map((e=>(0,m.N7)(j,e))):"string"==typeof e||"function"==typeof e||e instanceof HTMLElement||(0,c.y8)(e)?e:(l.Z.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t.description,t.mediaInfos,i):this._readPopupInfo(t)}writeWebSceneContent(e,t,i,r){this._writePopupTemplateContent(e,t,r)}writeWebMapContent(e,t,i,r){this._writePopupTemplateContent(e,t,r)}writeFieldInfos(e,t,i,r){const{content:n}=this,s=Array.isArray(n)?n:null;if(e){const i=s?s.filter((e=>"fields"===e.type)):[],n=i.length&&i.every((e=>e.fieldInfos?.length));t.fieldInfos=e.filter(Boolean).map((e=>{const t=e.toJSON(r);return n&&(t.visible=!1),t}))}if(s)for(const e of s)"fields"===e.type&&this._writeFieldsContent(e,t)}writeLayerOptions(e,t,i,r){t[i]=!e||null===e.showNoDataRecords&&null===e.returnTopmostRaster?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),(0,g.gd)(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writePopupTemplateContent(e,t,i){"string"!=typeof e?Array.isArray(e)&&(t.popupElements=e.filter((e=>"web-scene"===i?.origin?Z.has(e.type):q.has(e.type))).map((e=>e?.toJSON(i))),t.popupElements.forEach((e=>{"attachments"===e.type?this._writeAttachmentContent(t):"media"===e.type?this._writeMediaContent(e,t):"text"===e.type?this._writeTextContent(e,t):"relationship"===e.type&&this._writeRelationshipContent(e,t)}))):t.description=e}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=(0,a.d9)(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach((e=>{const i=t.fieldInfos.find((t=>t.fieldName?.toLowerCase()===e.fieldName?.toLowerCase()));i?i.visible=!0:t.fieldInfos.push(e)})):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,t){const i=e.orderByFields?.map((t=>this._toFieldOrderJSON(t,e.relationshipId)))||[],r=[...t.relatedRecordsInfo?.orderByFields||[],...i];t.relatedRecordsInfo={showRelatedRecords:!0,...r?.length&&{orderByFields:r}}}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=(0,a.d9)(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements(e,t,i){const r={description:!1,mediaInfos:!1};return i.map((i=>"media"===i.type?(i.mediaInfos||!t||r.mediaInfos||(i.mediaInfos=t,r.mediaInfos=!0),x.Z.fromJSON(i)):"text"===i.type?(i.text||!e||r.description||(i.text=e,r.description=!0),C.Z.fromJSON(i)):"attachments"===i.type?y.Z.fromJSON(i):"fields"===i.type?w.Z.fromJSON(i):"expression"===i.type?b.Z.fromJSON(i):"relationship"===i.type?T.Z.fromJSON(i):"utilityNetworkAssociations"===i.type?S.Z.fromJSON(i):void 0)).filter(Boolean)}_toRelationshipContent(e){const{field:t,order:i}=e;if(!t?.startsWith(V))return null;const r=t.replace(V,"").split("/");if(2!==r.length)return null;const n=parseInt(r[0],10),s=r[1];return!Number.isNaN(n)&&s?T.Z.fromJSON({relationshipId:n,orderByFields:[{field:s,order:i}]}):null}_toFieldOrderJSON(e,t){const{order:i,field:r}=e;return{field:`${V}${t}/${r}`,order:i}}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i,relatedRecordsInfo:r={showRelatedRecords:!1}}){const n=[];e?n.push(new C.Z({text:e})):n.push(new w.Z),Array.isArray(t)&&t.length&&n.push(x.Z.fromJSON({mediaInfos:t})),i&&n.push(y.Z.fromJSON({displayType:"auto"}));const{showRelatedRecords:s,orderByFields:o}=r;return s&&o?.length&&o.forEach((e=>{const t=this._toRelationshipContent(e);t&&n.push(t)})),n.length?n:e}_getContentElementFields(e){const t=e?.type;if("attachments"===t)return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if("custom"===t)return e.outFields||[];if("fields"===t)return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if("media"===t){const t=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...t.reduce(((e,t)=>[...e,...this._getMediaInfoFields(t)]),[])]}return"text"===t?this._extractFieldNames(e.text):"relationship"===t||"utility-network-associations"===t?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,n=r||{},{fields:s,normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=n,u=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...s??[]];return o&&u.push(o),a&&u.push(a),u}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce(((e,t)=>[...e,..."expression"===t.type&&t.expressionInfo?[t.expressionInfo]:[]]),t):[]}_getContentFields(e){return"string"==typeof e?this._extractFieldNames(e):Array.isArray(e)?e.reduce(((e,t)=>[...e,...this._getContentElementFields(t)]),[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map((i=>(0,g.io)(e,t,i.expression))))}_getFieldInfoFields(e){return e?e.filter((({fieldName:e,visible:t})=>!(void 0!==t&&!t||!e||e.startsWith(V)||e.startsWith(H)))).map((e=>e.fieldName)):[]}_getActionsFields(e){return e?e.toArray().reduce(((e,t)=>[...e,...this._getActionFields(t)]),[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,n="button"===r||"toggle"===r?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(n)]}_getTitleFields(e){return"string"==typeof e?this._extractFieldNames(e):[]}_extractFieldNames(e){return(0,g.ld)(e).filter((e=>!(0===e.indexOf(V)||0===e.indexOf(H))))}};(0,r._)([(0,u.Cb)({type:G})],W.prototype,"actions",void 0),(0,r._)([(0,u.Cb)()],W.prototype,"content",void 0),(0,r._)([(0,h.p)("content")],W.prototype,"castContent",null),(0,r._)([(0,d.r)("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],W.prototype,"readContent",null),(0,r._)([(0,f.c)("web-scene","content",{popupElements:{type:s.Z.ofType(M)},showAttachments:{type:Boolean},mediaInfos:{type:s.Z.ofType(U.V)},description:{type:String},relatedRecordsInfo:{type:F}})],W.prototype,"writeWebSceneContent",null),(0,r._)([(0,f.c)("content",{popupElements:{type:s.Z.ofType(E)},showAttachments:{type:Boolean},mediaInfos:{type:s.Z.ofType(U.V)},description:{type:String},relatedRecordsInfo:{type:F}})],W.prototype,"writeWebMapContent",null),(0,r._)([(0,u.Cb)({type:[R.Z],json:{write:!0}})],W.prototype,"expressionInfos",void 0),(0,r._)([(0,u.Cb)({type:[O.Z]})],W.prototype,"fieldInfos",void 0),(0,r._)([(0,f.c)("fieldInfos")],W.prototype,"writeFieldInfos",null),(0,r._)([(0,u.Cb)({type:I})],W.prototype,"layerOptions",void 0),(0,r._)([(0,f.c)("layerOptions")],W.prototype,"writeLayerOptions",null),(0,r._)([(0,u.Cb)({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],W.prototype,"lastEditInfoEnabled",void 0),(0,r._)([(0,u.Cb)()],W.prototype,"outFields",void 0),(0,r._)([(0,u.Cb)()],W.prototype,"overwriteActions",void 0),(0,r._)([(0,u.Cb)()],W.prototype,"returnGeometry",void 0),(0,r._)([(0,u.Cb)({json:{type:String}})],W.prototype,"title",void 0),(0,r._)([(0,f.c)("title")],W.prototype,"writeTitle",null),W=(0,r._)([(0,p.j)("esri.PopupTemplate")],W);const $=W},19812:(e,t,i)=>{i.d(t,{Z:()=>p});var r,n=i(36663),s=i(33098),o=i(82064),a=i(81977),l=i(69236),c=(i(39994),i(4157),i(40266)),u=i(53736),h=i(59659);let d=r=class extends o.Z{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new r({rotation:this.rotation,scale:this.scale,targetGeometry:null!=this.targetGeometry?this.targetGeometry.clone():null,camera:null!=this.camera?this.camera.clone():null})}};(0,n._)([(0,a.Cb)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:f}}}}})],d.prototype,"rotation",void 0),(0,n._)([(0,l.p)("rotation")],d.prototype,"castRotation",null),(0,n._)([(0,a.Cb)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:f}}}}})],d.prototype,"scale",void 0),(0,n._)([(0,a.Cb)({types:h.qM,json:{read:u.im,write:!0,origins:{"web-scene":{read:u.im,write:{overridePolicy:f}}}}})],d.prototype,"targetGeometry",void 0),(0,n._)([(0,a.Cb)({type:s.Z,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],d.prototype,"camera",void 0),d=r=(0,n._)([(0,c.j)("esri.Viewpoint")],d);const p=d;function f(){return{enabled:!this.camera}}},78053:(e,t,i)=>{i.d(t,{Qn:()=>d,iG:()=>h});var r,n=i(21130),s=i(46576),o=i(17126);!function(e){e.TimeZoneNotRecognized="TimeZoneNotRecognized"}(r||(r={}));const a={[r.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class l extends Error{constructor(e,t){super((0,n.gx)(a[e],t)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,l)}}function c(e,t,i){return e<t?e-t:e>i?e-i:0}function u(e,t,i){return e<t?t:e>i?i:e}class h{constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,t=1,i=1,r=0,n=0,s=0,a=0,l){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(r)||isNaN(n)||isNaN(s)||isNaN(a))return null;const p=o.ou.local(e,t).daysInMonth;let f=o.ou.fromObject({day:u(i,1,p),year:e,month:u(t,1,12),hour:u(r,0,23),minute:u(n,0,59),second:u(s,0,59),millisecond:u(a,0,999)},{zone:d(l)});return f=f.plus({months:c(t,1,12),days:c(i,1,p),hours:c(r,0,23),minutes:c(n,0,59),seconds:c(s,0,59),milliseconds:c(a,0,999)}),new h(f)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,t){const i=d(t);return e.isUnknownTimeZone||i===s.yV.instance?h.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,i):new h(e._date.setZone(i))}static dateJSToArcadeDate(e){return new h(o.ou.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,t="system"){const i=d(t);return new h(o.ou.fromJSDate(e,{zone:i}))}static unknownEpochToArcadeDate(e){return new h(o.ou.fromMillis(e,{zone:s.yV.instance}))}static unknownDateJSToArcadeDate(e){return new h(o.ou.fromMillis(e.getTime(),{zone:s.yV.instance}))}static epochToArcadeDate(e,t="system"){const i=d(t);return new h(o.ou.fromMillis(e,{zone:i}))}static dateTimeToArcadeDate(e){return new h(e)}clone(){return new h(this._date)}changeTimeZone(e){const t=d(e);return h.dateTimeToArcadeDate(this._date.setZone(t))}static dateTimeAndZoneToArcadeDate(e,t){const i=d(t);return e.zone===s.yV.instance||i===s.yV.instance?h.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,i):new h(e.setZone(i))}static nowToArcadeDate(e){const t=d(e);return new h(o.ou.fromJSDate(new Date,{zone:t}))}static nowUTCToArcadeDate(){return new h(o.ou.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===h.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===s.yV.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const e=this.zone;return"fixed"===e.type?0===e.fixed?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new h(this._date.plus(e))}diff(e,t="milliseconds"){return this._date.diff(e._date,t)[t]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,t){return this._date.toISOTime({suppressMilliseconds:e,includeOffset:t&&!this.isUnknownTimeZone})}toFormat(e,t){return this.isUnknownTimeZone&&(e=e.replaceAll("Z","")),this._date.toFormat(e,t)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new h(this._date.toUTC())}toLocal(){return new h(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;const t=o.ou.fromISO(e,{setZone:!0});return new h(t)}}function d(e,t=!0){if(e instanceof o.ld)return e;if("system"===e.toLowerCase())return"system";if("utc"===e.toLowerCase())return"UTC";if("unknown"===e.toLowerCase())return s.yV.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(e)){const t=o.Qf.parseSpecifier("UTC"+(e.startsWith("+")||e.startsWith("-")?"":"+")+e);if(t)return t}const i=o.vF.create(e);if(!i.isValid){if(t)throw new l(r.TimeZoneNotRecognized);return null}return i}},36567:(e,t,i)=>{i.d(t,{V:()=>c,b:()=>l});var r=i(51366),n=i(66341),s=i(70375),o=i(13802),a=i(3466);function l(e,t){return(0,n.Z)(c(e),t)}function c(e){if(!r.Z.assetsPath)throw o.Z.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new s.Z("assets:path-not-set","config.assetsPath is not set");return(0,a.v_)(r.Z.assetsPath,e)}},83232:(e,t,i)=>{i.d(t,{A:()=>c,a:()=>h,b:()=>u});var r=i(55208),n=i(20200),s=i(99126),o=i(15176),a=i(86765),l=i(9229);class c extends a.K{}function u(){const e=new l.kG;return e.include(r.k),e.fragment.uniforms.add(new o.A("colorTexture",(e=>e.color)),new s.e("depthTexture",(e=>e.mainDepth))),e.fragment.main.add(n.H`float depthSample = texture(depthTexture, uv).r;
if (depthSample != 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},33803:(e,t,i)=>{i.d(t,{B:()=>f,a:()=>r,b:()=>p});var r,n=i(61296),s=i(91238),o=i(76763),a=i(73721),l=i(43036),c=i(24603),u=i(20200),h=i(15176),d=i(9229);function p(e){const t=new d.kG,i=t.fragment;if(t.include(a.T),e.background===r.Only){const r=e.output===s.l.ColorComposite;return r?i.uniforms.add(new l.J("backgroundColor",(e=>e.backgroundColor))):i.include(n.H),i.main.add(u.H`fragColor = vec4(${r?u.H`backgroundColor`:u.H`gridColor(uv)`}, 1.0);`),t}return t.include(o.J,e),i.uniforms.add(new h.A("tex",(e=>e.texture)),new c.p("opacity",(e=>e.opacity))),i.main.add(u.H`fragColor = blendLayers(uv, texture(tex, uv), opacity);`),t}!function(e){e[e.BelowLayer=0]="BelowLayer",e[e.Only=1]="Only",e[e.COUNT=2]="COUNT"}(r||(r={}));const f=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return r},build:p},Symbol.toStringTag,{value:"Module"}))},4257:(e,t,i)=>{i.d(t,{B:()=>l,b:()=>a});var r=i(55208),n=i(20200),s=i(15176),o=i(9229);function a(){const e=new o.kG;e.include(r.k),e.fragment.uniforms.add(new s.A("edgesTexture",(e=>e.inputTexture)),new s.A("areaTexture",(e=>e.areaTexture)),new s.A("searchTexture",(e=>e.searchTexture))),e.fragment.constants.add("smaaAreaTexPixelSize","vec2",[1/160,1/560]);return e.fragment.code.add(n.H`
    vec4 sampleLevelZeroOffset(vec2 coord, vec2 offset, vec2 resolution) {
      return texture(edgesTexture, coord + offset.x * resolution);
    }

    float searchLength(vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture(searchTexture, e).r;
    }

    float searchLeft(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${n.H.int(8)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${n.H.int(8)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength(e, 0.5, 0.5);
      return texcoord.x;
    }

    float searchUp(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${n.H.int(8)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength(e.gr, 0.0, 0.5);
      return texcoord.y;
    }

    float searchDown(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${n.H.int(8)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength(e.gr, 0.5, 0.5);
      return texcoord.y;
    }

    vec2 getArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
      vec2 texcoord = float(${n.H.int(16)}) * round(4.0 * vec2(e1, e2)) + dist;
      texcoord = smaaAreaTexPixelSize * texcoord + (0.5 * smaaAreaTexPixelSize);
      texcoord.y += ${n.H.float(1/7)} * offset;
      return texture(areaTex, texcoord).rg;
    }`),e.fragment.main.add(n.H`
    vec2 size = vec2(textureSize(edgesTexture, 0));
    vec2 resolution = 1.0 / size;
    vec2 pixelCoord = uv * size;
    vec4 offsets[2];
    offsets[0] = uv.xyxy + resolution.xyxy * vec4(-0.25, 0.125, 1.25, 0.125);
    offsets[1] = uv.xyxy + resolution.xyxy * vec4(-0.125, 0.25, -0.125, -1.25);
    vec4 maxOffset = vec4(offsets[0].xz, offsets[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * resolution.xxyy * float(${n.H.int(8)});
    ivec4 subsampleIndices = ivec4(0.0);
    vec4 weights = vec4(0.0);
    vec2 e = texture(edgesTexture, uv).rg;
    if (e.r > 0.0) {
      vec2 d;
      vec2 coords;
      coords.y = searchUp(offsets[1].xy, maxOffset.z, resolution);
      coords.x = offsets[0].x;
      d.x = coords.y;
      float e1 = texture(edgesTexture, coords).g;
      coords.y = searchDown(offsets[1].zw, maxOffset.w, resolution);
      d.y = coords.y;
      d = d * size.y - pixelCoord.y;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(0.0, 1.0), resolution).g;
      weights.ba = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.x));
      // for some reason the following lines are necessary to prevent
      // texture lookup precision issues on some Intel integrated graphics chips
      vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
      weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
    }
    if (e.g > 0.0) {
      vec2 d;
      vec2 coords;
      coords.x = searchLeft(offsets[0].xy, maxOffset.x, resolution);
      coords.y = offsets[1].y;
      d.x = coords.x;
      float e1 = texture(edgesTexture, coords).r;
      coords.x = searchRight(offsets[0].zw, maxOffset.y, resolution);
      d.y = coords.x;
      d = d * size.x - pixelCoord.x;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(1.0, 0.0), resolution).r;
      weights.rg = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.y));
    }
    fragColor = weights;
  `),e}const l=Object.freeze(Object.defineProperty({__proto__:null,build:a},Symbol.toStringTag,{value:"Module"}))},24532:(e,t,i)=>{i.d(t,{B:()=>l,b:()=>a});var r=i(55208),n=i(20200),s=i(15176),o=i(9229);function a(){const e=new o.kG;return e.include(r.k),e.fragment.uniforms.add(new s.A("blendWeightsTexture",(e=>e.inputTexture)),new s.A("colorTexture",(e=>e.color))),e.fragment.main.add(n.H`vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}`),e}const l=Object.freeze(Object.defineProperty({__proto__:null,build:a},Symbol.toStringTag,{value:"Module"}))},53737:(e,t,i)=>{i.d(t,{C:()=>m,b:()=>f});var r=i(6600),n=i(76203),s=i(58749),o=i(43036),a=i(24603),l=i(20200),c=i(99126),u=i(16009),h=i(21388),d=i(81809),p=i(9229);function f(e){const t=new p.kG;t.include(u.X);const{reduced:i}=e,{fragment:f}=t;return(0,s.Pe)(f),t.include(n.D),f.include(h.l),f.include(d.l),f.include(r.t,!1),f.uniforms.add(new o.J("backgroundColor",(e=>e.backgroundColor)),new a.p("innerFadeDistance",(e=>e.innerFadeDistance)),new a.p("altitudeFade",(e=>e.altitudeFade)),new c.e("depthTexture",(e=>e.mainDepth))).code.add(l.H`vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
float rayPlanetDistance = heightParameters[1] - radii[0] * radii[0];
vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, rayPlanetDistance);
if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
return fragColor;
}
float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
if (relDist > 1.0) {
return surfaceColor;
}
return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
}
float getGlow(float dist, float radius, float intensity) {
return pow(radius / max(dist, 1e-6), intensity);
}
vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){
float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));
vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));
float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));
return normalize(sunTransmittance) * sunDisc;
}`).main.add(l.H`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${(0,l.If)(!i,l.H`float depthSample = texture(depthTexture, uv).r;
             if (depthSample != 1.0) {
                fragColor = vec4(0);
                return;
             }`)}

      vec3 col = linearizeGamma(backgroundColor);
      col += raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      col += getSun(cameraPosition, rayDir, mainLightDirection);
      float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);
  `),t}const m=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}))},11547:(e,t,i)=>{i.d(t,{C:()=>v,a:()=>T,b:()=>w,c:()=>b});var r=i(39994),n=i(19431),s=i(3965),o=i(36531),a=i(84164),l=i(25853),c=i(43175),u=i(55208),h=i(93072),d=i(24603),p=i(20200),f=i(11125),m=i(15176),g=i(21388),y=i(86765),_=i(9229);class v extends y.K{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.viewMatrix=(0,s.Ue)()}}const b=(0,r.Z)("esri-mobile")?1024:2048;function w(e){const t=new _.kG;t.include(u.k,!1);const i=t.fragment;return i.include(g.l),i.uniforms.add(new d.p("cloudRadius",(e=>e.cloudRadius)),new d.p("power",(e=>(0,n.t7)(35,120,e.absorption))),new d.p("sigmaE",(e=>1+e.absorption)),new d.p("density",(e=>(0,n.t7)(0,.3,e.density))),new d.p("cloudSize",(e=>(0,n.t7)(0,.02,Math.max(.01,1-e.cloudSize)))),new d.p("detailSize",(e=>(0,n.t7)(0,.2,Math.max(.01,1-e.detailSize)))),new d.p("smoothness",(e=>(0,n.t7)(0,.5,1-e.smoothness))),new d.p("cloudHeight",(e=>(0,n.t7)(0,1500,e.cloudHeight))),new d.p("coverage",(e=>e.coverage)),new f.c("view",(e=>e.viewMatrix)),new m.A("cloudShapeTexture",(e=>null!=e.noiseTexture?e.noiseTexture.textureAtlas:null)),new h.A("cloudVariables",(e=>(0,o.t8)(x,e.coverage,e.absorption)))),i.constants.add("halfCubeMapSize","float",.5*b),i.code.add(p.H`
    const int STEPS = ${e.steps===l.p.SIXTEEN?p.H`16`:e.steps===l.p.HUNDRED?p.H`100`:p.H`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(p.H`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${p.H.float(c.a5)};
      const float dataWidth = ${p.H.float(c.a5)};
      const float tileRows = ${p.H.float(c.CB)};
      const vec3 atlasDimensions = vec3(${p.H.float(c.i9)}, ${p.H.float(c.i9)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${p.H.float(c.Mw)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${p.H.float(c.H6)} * p) / ${p.H.float(c.a5)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(p.H`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(p.H`float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}
float multipleOctaves(float extinction, float mu, float stepL) {
float attenuation = 1.0;
float contribution = 1.0;
float phaseAttenuation = 1.0;
float luminance = 0.0;
for (int i = 0; i < 4; i++) {
float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
attenuation *= 0.2;
contribution *= 0.6;
phaseAttenuation *= 0.5;
}
return luminance;
}`),i.code.add(p.H`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(p.H`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.main.add(p.H`if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
float cloudDistance = cloudRadius + cloudStart;
float rayStartDistance = dot(viewPos, viewPos) - (cloudDistance * cloudDistance);
vec2 rayStartIntersect = sphereIntersect(viewPos, rayDir, rayStartDistance);
float rayEndDistance = dot(viewPos, viewPos) - ((cloudDistance + cloudHeight) * (cloudDistance + cloudHeight));
vec2 rayEndIntersect = sphereIntersect(viewPos, rayDir, rayEndDistance);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);`),t}const x=(0,a.Ue)(),T=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:v,build:w,cubeMapSize:b},Symbol.toStringTag,{value:"Module"}))},35127:(e,t,i)=>{i.d(t,{C:()=>g,b:()=>m});var r=i(77787),n=i(76203),s=i(3864),o=i(95509),a=i(57758),l=i(32394),c=i(9794),u=i(20998),h=i(49016),d=i(20200),p=i(16009),f=i(9229);function m(){const e=new f.kG,{fragment:t}=e;return e.include(p.X,{needUVs:!1,needEyeDirection:!1}),t.include(l.Y),t.include(c.n),e.include(r._,{pbrMode:s.f7.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(o.e),e.include(n.D),e.include(a.j),t.uniforms.add(new u.d("cameraPosition",(e=>e.camera.eye)),new h.z("cloudsOpacity",(e=>e.clouds.opacity))).main.add(d.H`vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4(cloudsOpacity * cloudsColor.rgb, cloudsColor.a);`),e}const g=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},9004:(e,t,i)=>{i.d(t,{C:()=>F,b:()=>N});var r=i(14260),n=i(33401),s=i(68848),o=i(22919),a=i(39590),l=i(95650),c=i(35031),u=i(5885),h=i(82082),d=i(6502),p=i(78549),f=i(62295),m=i(59004),g=i(32560),y=i(94118),_=i(16220),v=i(3417),b=i(24623),w=i(58749),x=i(3864),T=i(14351),C=i(60532),S=i(94880),E=i(97582),M=i(44866),A=i(94283),R=i(20200),O=i(99126),P=i(15176),I=i(82050),L=i(9229),D=i(5226);function N(e){const t=new L.kG,{vertex:i,fragment:N}=t;t.include(f.up,e),t.include(p.Bb,e),t.include(d.c,e),t.include(h.D,e),t.include(l.qj,e),t.include(o.AD,e),t.include(M.o,e),N.include(u.P_,e),t.include(T.s,e),t.include(S.H,e);const{output:F,pbrMode:U,hasNormalTexture:k,snowCover:z,receiveShadows:B,spherical:V,ellipsoidMode:H}=e,G=U===x.f7.Normal||U===x.f7.Schematic;G&&(t.include(x.jV,e),k&&t.include(v.Q,e));const j=F===c.H_.Shadow||F===c.H_.ShadowHighlight||F===c.H_.ShadowExcludeHighlight,Z=j&&e.componentData===o._N.Varying,q=e.integratedMeshMode===s.O.ColorOverlay||e.integratedMeshMode===s.O.ColorOverlayWithWater;if(q){t.include(b.XP,e),t.include(E.WB,e);const n=H===A.U.Earth,s=H===A.U.Earth,o=n?r.sv.radius:s?r.yr.radius:r.Z1.radius;i.code.add(`\n      ${(0,R.If)(V,`const float invRadius = ${R.H.float(1/o)};`)}\n      vec2 projectOverlay(vec3 pos) { return pos.xy ${(0,R.If)(V,"/ (1.0 + invRadius * pos.z);")}; }`)}const W=q&&(0,c.c1)(F)&&U===x.f7.WaterOnIntegratedMesh;W&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3"));const $=e.vertexDiscardMode===a.a.None,Y=e.vertexDiscardMode===a.a.Opaque;if(i.main.add(R.H`
    bool castShadows;
    vec4 externalColor = forwardExternalColor(castShadows);
    ${(0,R.If)(Z,"if(!castShadows) { gl_Position = vec4(vec3(1e38), 1.0); return; }")}

    ${(0,R.If)(!$,`{ if (externalColor.a ${Y?">":"<="} ${R.H.float(1-1/255)}) { gl_Position = vec4(vec3(1e38), 1.0); return; } }`)}

    ${(0,R.If)(F===c.H_.ObjectAndLayerIdColor,"externalColor.a = 1.0;")}

    forwardPosition(readElevationOffset());
    forwardViewPosDepth(vPosition_view);
    forwardNormal();
    forwardTextureCoordinates();
    forwardVertexColor();
    forwardLinearDepth();
    forwardObjectAndLayerIdColor();
    ${(0,R.If)(W,V?R.H`
              groundNormal = normalize(positionWorld());
              tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
              tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:R.H`
              groundNormal = vec3(0.0, 0.0, 1.0);
              tbnTangent = vec3(1.0, 0.0, 0.0);
              tbnBiTangent = vec3(0.0, 1.0, 0.0);`)}
    ${(0,R.If)(q,"setOverlayVTC(projectOverlay(position));")}

    if (externalColor.a < ${R.H.float(D.e)}) {
      // Discard this vertex
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
  `),(0,c.c1)(F))return t.include(_.P,e),t.include(y.K,e),t.include(b.XP,e),t.include(I.j,e),B&&t.include(C.hb,e),N.code.add(R.H`
      float evaluateShadow() {
        return ${B?"readShadowMap(vPositionWorldCameraRelative, linearDepth)":"0.0"};
      }`),q&&N.uniforms.add(new P.A("ovColorTex",((e,t)=>(0,E.WE)(e,t)))),N.main.add(R.H`
      discardBySlice(vPositionWorldCameraRelative);
      discardByTerrainDepth();

      vec4 textureColor = readBaseColorTexture();
      discardOrAdjustAlpha(textureColor);

      vec4 externalColor;
      int externalColorMixMode;
      readExternalColor(externalColor, externalColorMixMode);

      vec4 materialColor = computeMaterialColor(textureColor, externalColor, externalColorMixMode);
      ${(0,R.If)(q,R.H`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`)}
    `),G?((0,w.F1)(N),V&&(0,b.sC)(N),N.main.add(R.H`
        applyPBRFactors();
        ${(0,R.If)(U===x.f7.Normal,R.H`if (externalColorMixMode == 3) {
              mrr = vec3(0.0, 0.6, 0.2);
            }`)}
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
        ${(0,R.If)(k,"mat3 tangentSpace = computeTangentSpace(fragmentShadingNormal, vPositionWorldCameraRelative, vuv0);")}
        vec3 shadingNormal = ${k?"computeTextureNormal(tangentSpace, vuv0)":"fragmentShadingNormal"};
        vec3 normalGround = ${V?R.H`normalize(positionWorld())`:R.H`vec3(0.0, 0.0, 1.0)`};

        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${(0,R.If)(z,R.H`float snow = smoothstep(0.5, 0.55, dot(fragmentFaceNormal, normalize(positionWorld())));
                 materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                 ssao = mix(ssao, 0.5 * ssao, snow);
                 shadingNormal = mix(shadingNormal, fragmentFaceNormal, snow);`)}
        ${(0,R.If)(q,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 emission = getEmissions();
        ${(0,R.If)(V,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        ${V?R.H`float shadow = max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow());`:"float shadow = evaluateShadow();"}
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, shadow, ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(V&&(0,b.sC)(N),W&&N.uniforms.add(new O.e("ovNormalTex",(e=>e.overlay?.getTexture(n.D.WaterNormal)))),N.main.add(R.H`
        ${(0,R.If)(V,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        float shadow = ${B?V?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow())":"evaluateShadow()":V?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        ${(0,R.If)(z,R.H`float snow = smoothstep(0.5, 0.55, dot(fragmentFaceNormal, normalize(positionWorld())));
               materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)}

        // At global scale we create some additional ambient light based on the main light to simulate global illumination
        float ssao = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());

        ${(0,R.If)(q,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec4 shadedColor = vec4(evaluateSceneLighting(fragmentShadingNormal, materialColor.rgb, shadow, ssao, additionalLight), materialColor.a);
        ${(0,R.If)(W,R.H`vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
                 float waterNormalLength = length(overlayWaterMask);
                 if (waterNormalLength > 0.95) {
                   mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                   vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                   vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                   // un-gamma the ground color to mix in linear space
                   shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
                 }`)}
      `)),N.main.add("outputColorHighlightOID(shadedColor, vPositionWorldCameraRelative);"),t;const J=F===c.H_.Normal,X=F===c.H_.ObjectAndLayerIdColor,K=F===c.H_.Highlight,Q=j||F===c.H_.ViewshedShadow;return Q&&t.include(m.F,e),J&&t.include(y.K,e),t.include(g.b,e),N.main.add(R.H`
    discardBySlice(vPositionWorldCameraRelative);

    vec4 textureColor = readBaseColorTexture();
    discardOrAdjustAlpha(textureColor);

    ${(0,R.If)(Q,"outputDepth(linearDepth);")}
    ${(0,R.If)(J,R.H`fragColor = vec4(vec3(0.5) + 0.5 * fragmentFaceNormalView, 1.0);`)}
    ${(0,R.If)(X,q?"fragColor = getOverlayColorTexel();":"outputObjectAndLayerIdColor();")}
    ${(0,R.If)(K,R.H`${(0,R.If)(q,R.H`
           vec2 overlayHighlightTexel = getAllOverlayHighlightValuesEncoded();
           calculateOcclusionAndOutputHighlightOverlay(overlayHighlightTexel);`,R.H`calculateOcclusionAndOutputHighlight();`)}`)}`),t}const F=Object.freeze(Object.defineProperty({__proto__:null,build:N},Symbol.toStringTag,{value:"Module"}))},73487:(e,t,i)=>{i.d(t,{C:()=>p,a:()=>m,b:()=>f});var r=i(55208),n=i(31227),s=i(9794),o=i(80670),a=i(24603),l=i(20200),c=i(15176),u=i(42199),h=i(86765),d=i(9229);class p extends h.K{constructor(){super(...arguments),this.opacity=1}}function f(e){const t=new d.kG;t.include(r.k),t.fragment.uniforms.add(new c.A("tex",(e=>e.texture))),e.hasOpacityFactor&&t.fragment.uniforms.add(new a.p("opacity",(e=>e.opacity)));const i=e.blitMode===u.J.Depth;return i&&(t.fragment.uniforms.add(new o.$("nearFar",(e=>e.camera.nearFar))),t.fragment.include(n.K),t.fragment.include(s.n)),t.fragment.main.add(l.H`
    ${i?l.H`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:l.H`
          fragColor = texture(tex, uv) ${e.hasOpacityFactor?"* opacity":""};`}`),t}const m=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:p,build:f},Symbol.toStringTag,{value:"Module"}))},45584:(e,t,i)=>{i.d(t,{D:()=>V,b:()=>B});var r=i(95650),n=i(57218),s=i(35031),o=i(5885),a=i(4731),l=i(99163),c=i(7792),u=i(91636),h=i(92835),d=i(82082),p=i(6502),f=i(78549),m=i(77700),g=i(77546),y=i(3417),_=i(30786),v=i(24623),b=i(58749),w=i(2833),x=i(89585),T=i(3864),C=i(60532),S=i(94880),E=i(30228),M=i(12664),A=i(44866),R=i(27452),O=i(84614),P=i(43036),I=i(63371),L=i(24603),D=i(20200),N=i(15176),F=i(21414),U=i(82050),k=i(9229),z=i(5226);function B(e){const t=new k.kG,{vertex:i,fragment:B,varyings:V}=t,{output:H,normalType:G,offsetBackfaces:j,instancedColor:Z,spherical:q,receiveShadows:W,snowCover:$,pbrMode:Y,textureAlphaPremultiplied:J,instancedDoublePrecision:X,hasVertexColors:K,hasVertexTangents:Q,hasColorTexture:ee,hasNormalTexture:te,hasNormalTextureTransform:ie,hasColorTextureTransform:re}=e;if((0,O.Sv)(i,e),t.include(u.f),V.add("vpos","vec3"),t.include(M.k,e),t.include(l.f,e),t.include(m.L,e),t.include(E.av,e),!(0,s.c1)(H))return t.include(g.s,e),t;t.include(E.NI,e),t.include(E.R5,e),t.include(E.jF,e),t.include(E.DT,e),(0,O.hY)(i,e),t.include(c.O,e),t.include(a.w,e);const ne=G===c.r.Attribute||G===c.r.Compressed;return ne&&j&&t.include(n.w),t.include(y.Q,e),t.include(f.Bb,e),Z&&t.attributes.add(F.T.INSTANCECOLOR,"vec4"),V.add("vPositionLocal","vec3"),t.include(d.D,e),t.include(r.qj,e),t.include(h.R,e),t.include(p.c,e),i.uniforms.add(new I.N("externalColor",(e=>e.externalColor))),V.add("vcolorExt","vec4"),t.include(S.H,e),i.main.add(D.H`
    forwardNormalizedVertexColor();
    vcolorExt = externalColor;
    ${(0,D.If)(Z,"vcolorExt *= instanceColor * 0.003921568627451;")}
    vcolorExt *= vvColor();
    vcolorExt *= getSymbolColor();
    forwardColorMixMode();

    vpos = getVertexInLocalOriginSpace();
    vPositionLocal = vpos - view[3].xyz;
    vpos = subtractOrigin(vpos);
    ${(0,D.If)(ne,"vNormalWorld = dpNormal(vvLocalNormal(normalModel()));")}
    vpos = addVerticalOffset(vpos, localOrigin);
    ${(0,D.If)(Q,"vTangent = dpTransformVertexTangent(tangent);")}
    gl_Position = transformPosition(proj, view, vpos);
    ${(0,D.If)(ne&&j,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}

    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    forwardLinearDepth();
    forwardTextureCoordinates();
    forwardColorUV();
    forwardNormalUV();
    forwardEmissiveUV();
    forwardOcclusionUV();
    forwardMetallicRoughnessUV();

    if (vcolorExt.a < ${D.H.float(z.e)}) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
    }
  `),t.include(v.XP,e),t.include(_.K,e),t.include(A.z,e),t.include(X?C.hb:C.XE,e),t.fragment.include(o.f5,e),t.include(U.j,e),(0,O.hY)(B,e),B.uniforms.add(i.uniforms.get("localOrigin"),new P.J("ambient",(e=>e.ambient)),new P.J("diffuse",(e=>e.diffuse)),new L.p("opacity",(e=>e.opacity)),new L.p("layerOpacity",(e=>e.layerOpacity))),ee&&B.uniforms.add(new N.A("tex",(e=>e.texture))),t.include(T.jV,e),t.include(x.T,e),B.include(R.y),t.include(w.k,e),(0,v.PN)(B),(0,v.sC)(B),(0,b.F1)(B),B.main.add(D.H`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${ee?D.H`
            vec4 texColor = texture(tex, ${re?"colorUV":"vuv0"});
            ${(0,D.If)(J,"texColor.rgb /= texColor.a;")}
            discardOrAdjustAlpha(texColor);`:D.H`vec4 texColor = vec4(1.0);`}
    shadingParams.viewDirection = normalize(vpos - cameraPosition);
    ${G===c.r.ScreenDerivative?D.H`vec3 normal = screenDerivativeNormal(vPositionLocal);`:D.H`shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
    applyPBRFactors();
    float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

    vec3 posWorld = vpos + localOrigin;

      float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
      float shadow = ${W?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":(0,D.If)(q,"lightingGlobalFactor * (1.0 - additionalAmbientScale)","0.0")};

    vec3 matColor = max(ambient, diffuse);
    vec3 albedo = mixExternalColor(${(0,D.If)(K,"vColor.rgb *")} matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
    float opacity_ = layerOpacity * mixExternalOpacity(${(0,D.If)(K,"vColor.a * ")} opacity, texColor.a, vcolorExt.a, int(colorMixMode));
    ${te?`mat3 tangentSpace = computeTangentSpace(${Q?"normal":"normal, vpos, vuv0"});\n            vec3 shadingNormal = computeTextureNormal(tangentSpace, ${ie?"normalUV":"vuv0"});`:"vec3 shadingNormal = normal;"}
    vec3 normalGround = ${q?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

    ${(0,D.If)($,D.H`
          float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
          albedo = mix(albedo, vec3(1), snow);
          shadingNormal = mix(shadingNormal, normal, snow);
          ssao = mix(ssao, 1.0, snow);`)}

    vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

    ${Y===T.f7.Normal||Y===T.f7.Schematic?D.H`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
            ${(0,D.If)($,D.H`mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);`)}
            vec4 emission = ${$?"mix(getEmissions(), vec4(0.0), snow)":"getEmissions()"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:D.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
    vec4 finalColor = vec4(shadedColor, opacity_);
    outputColorHighlightOID(finalColor, vpos);
  `),t}const V=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}))},96109:(e,t,i)=>{i.d(t,{E:()=>l,b:()=>a});var r=i(55208),n=i(20200),s=i(15176),o=i(9229);function a(){const e=new o.kG;return e.include(r.k),e.outputs.add("fragEdges","vec2"),e.fragment.code.add(n.H`float absMax3(vec3 v) {
vec3 t = abs(v);
return max(max(t.r, t.g), t.b);
}`),e.fragment.uniforms.add(new s.A("colorTexture",(e=>e.color))).main.add(n.H`
    vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
    vec4 offsets[3];
    offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
    offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
    offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

    // Calculate color deltas:
    vec3 C = texture(colorTexture, uv).rgb;
    vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
    vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
    vec2 delta = vec2(absMax3(C - Cleft), absMax3(C - Ctop));
    vec2 edges = step(vec2(${n.H.float(.05)}), delta);

    // discard if there is no edge:
    if (dot(edges, vec2(1.0)) == 0.0) {
      fragEdges = vec2(0.0);
    }
    else {
      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      float horizontal = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      float vertical = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), horizontal), vertical);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      horizontal = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      vertical = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, horizontal), vertical);

      // Local contrast adaptation in action:
      fragEdges = edges * step(maxDelta, float(${n.H.float(2)}) * delta);
    }
  `),e}const l=Object.freeze(Object.defineProperty({__proto__:null,build:a},Symbol.toStringTag,{value:"Module"}))},21635:(e,t,i)=>{i.d(t,{F:()=>c,a:()=>h,b:()=>u});var r=i(55208),n=i(20200),s=i(59842),o=i(15176),a=i(86765),l=i(9229);class c extends a.K{}function u(){const e=new l.kG;return e.include(r.k),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new o.A("colorTexture",(e=>e.color)),new o.A("focusArea",(e=>e.focusArea)),new s._("focusAreaEffectMode",(e=>e.effect??1))).main.add(n.H`float mask = texture( focusArea, uv, 0.0 ).r;
vec4 color = texture( colorTexture, uv, 0.0 );
vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);
if (focusAreaEffectMode == 1) {
fragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;
} else {
fragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);
}`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},10221:(e,t,i)=>{i.d(t,{F:()=>d,a:()=>m,b:()=>p});var r=i(32114),n=i(3308),s=i(81095),o=i(20200),a=i(61002),l=i(3875),c=i(21414),u=i(86765),h=i(9229);class d extends u.K{constructor(){super(...arguments),this.origin=s.AG}}function p(){const e=new h.kG;return e.attributes.add(c.T.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new a.C("proj",(e=>e.camera.projectionMatrix)),new l.K("view",((e,t)=>(0,r.Iu)(f,t.camera.viewMatrix,e.origin)))).main.add(o.H`gl_Position = proj * view * vec4(position, 1.0);`),e.fragment.main.add(o.H`fragColor = vec4(1., 0., 0., 1.);`),e}const f=(0,n.Ue)(),m=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:d,build:p},Symbol.toStringTag,{value:"Module"}))},28539:(e,t,i)=>{i.d(t,{F:()=>g,a:()=>_,b:()=>y});var r=i(81095),n=i(31227),s=i(76203),o=i(20998),a=i(43036),l=i(24603),c=i(20200),u=i(99126),h=i(16009),d=i(21388),p=i(81809),f=i(86765),m=i(9229);class g extends f.K{constructor(){super(...arguments),this.color=(0,r.Ue)(),this.strength=4e-6,this.atmosphereC=1,this.amount=0}}function y(){const e=new m.kG;e.include(h.X,{needUVs:!0,needEyeDirection:!0});const t=e.fragment;return t.uniforms.add(new l.p("atmosphereC",(e=>e.atmosphereC)),new o.d("cameraPosition",(e=>e.camera.eye)),new u.e("depthTexture",(e=>e.mainDepth)),new l.p("fogStrength",(e=>e.strength)),new l.p("fogAmount",(e=>e.amount)),new a.J("fogColor",(e=>e.color))),e.include(s.D),t.include(d.l),t.include(p.l),t.include(n.K),t.code.add(c.H`float getFogAmount(float dist, vec3 rayDir) {
if(dist == -1.0){
dist = 0.055 * sphereIntersect(cameraPosition, rayDir, atmosphereC).y;
}
return fogAmount * (1.0 - exp(-dist * fogStrength));
}`),t.main.add(c.H`vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = depthFromTexture(depthTexture, uv);
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linearizeDepth(depthSample);;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
float fogAmount = getFogAmount(terrainDepth, rayDir);
vec4 fog = vec4(fogColor, 1.0) * fogAmount;
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));`),e}const _=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:g,build:y},Symbol.toStringTag,{value:"Module"}))},54831:(e,t,i)=>{i.d(t,{H:()=>l,a:()=>u,b:()=>c});var r=i(55208),n=i(20200),s=i(15176),o=i(86765),a=i(9229);class l extends o.K{}function c(){const e=new a.kG;return e.include(r.k),e.fragment.uniforms.add(new s.A("tex",(e=>e.texture))),e.fragment.main.add(n.H`fragColor = vec4(1.0 - texture(tex, uv).a);`),e}const u=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:l,build:c},Symbol.toStringTag,{value:"Module"}))},56444:(e,t,i)=>{i.d(t,{H:()=>U,b:()=>L,c:()=>N});var r=i(36531),n=i(84164),s=i(52721),o=i(14260),a=i(35031),l=i(5885),c=i(78950),u=i(94728),h=i(21737),d=i(74319),p=i(95067),f=i(32560),m=i(12664),g=i(32394),y=i(9794),_=i(76774),v=i(84614),b=i(93072),w=i(80967),x=i(40622),T=i(63371),C=i(49016),S=i(24603),E=i(20200),M=i(99126),A=i(15176),R=i(97994),O=i(21414),P=i(9229),I=i(5226);function L(e){const t=new P.kG,i=e.signedDistanceFieldEnabled;t.include(h.R,e),t.vertex.include(l.$S,e);const{occlusionPass:n,output:L,oitPass:U}=e;if(n)return t.include(d.R,e),t;const{vertex:k,fragment:z}=t;t.include(_.cK),t.include(m.k,e),t.include(c.R,e),t.include(p.P),z.include(y.n),z.include(g.Y),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2");const B=L===a.H_.Highlight,V=B&&e.occlusionTestEnabled;V&&t.varyings.add("voccluded","float"),k.uniforms.add(new w.$("viewport",(e=>e.camera.fullViewport)),new b.A("screenOffset",((e,t)=>(0,r.t8)(F,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new b.A("anchorPosition",(e=>N(e))),new T.N("materialColor",(e=>e.color)),new S.p("materialRotation",(e=>e.rotation))),(0,v.ZI)(k),i&&(k.uniforms.add(new T.N("outlineColor",(e=>e.outlineColor))),z.uniforms.add(new T.N("outlineColor",(e=>D(e)?e.outlineColor:s.AG)),new S.p("outlineSize",(e=>D(e)?e.outlineSize:0)))),e.horizonCullingEnabled&&k.uniforms.add(new x.$("pointDistanceSphere",((e,t)=>{const i=t.camera.eye,r=e.origin;return(0,s.al)(r[0]-i[0],r[1]-i[1],r[2]-i[2],o.sv.radius)}))),e.pixelSnappingEnabled&&k.include(u.H),e.hasScreenSizePerspective&&((0,_.ww)(k),(0,_.m8)(k)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(O.T.UV0,"vec2"),t.attributes.add(O.T.COLOR,"vec4"),t.attributes.add(O.T.SIZE,"vec2"),t.attributes.add(O.T.ROTATION,"float"),t.attributes.add(O.T.FEATUREATTRIBUTE,"vec4"),k.code.add(e.horizonCullingEnabled?E.H`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:E.H`bool behindHorizon(vec3 posModel) { return false; }`),k.main.add(E.H`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${(0,E.If)(e.hasScreenSizePerspective,E.H`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,E.H`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${(0,E.If)(e.vvSize,E.H`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${(0,E.If)(e.occlusionTestEnabled,E.H`
      bool visible = testHUDVisibility(posProj);
      if (!visible) {
        vtc = vec2(0.0);
        ${(0,E.If)(e.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
      ${(0,E.If)(V,E.H`voccluded = visible ? 0.0 : 1.0;`)}
    `);const H=E.H`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${(0,E.If)(e.hasRotation,E.H`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,G=e.pixelSnappingEnabled?i?E.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:E.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:E.H`posProj += quadOffset;`;k.main.add(E.H`
    ${H}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${(0,E.If)(L===a.H_.ObjectAndLayerIdColor,E.H`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${E.H.float(I.e)};
    ${(0,E.If)(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${E.H.float(I.e)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${G}
      gl_Position = posProj;
    }

    vtc = uv;

    ${(0,E.If)(e.debugDrawLabelBorder,E.H`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),z.uniforms.add(new A.A("tex",(e=>e.texture))),e.occludedFragmentFade&&(z.uniforms.add(new M.e("depthMap",(e=>e.mainDepth))),z.uniforms.add(new C.z("occludedOpacity",(e=>e.hudOccludedFragmentOpacity))));const j=e.debugDrawLabelBorder?E.H`(isBorder > 0.0 ? 0.0 : ${E.H.float(I.e)})`:E.H.float(I.e),Z=E.H`
    ${(0,E.If)(e.debugDrawLabelBorder,E.H`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${(0,E.If)(e.sampleSignedDistanceFieldTexelCenter,E.H`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,E.H`vec2 samplePos = vtc;`)}

    ${i?E.H`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgbaTofloat(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${j} ||
          fillPixelColor.a + outlinePixelColor.a < ${E.H.float(I.e)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${(0,E.If)(!B,E.H`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${j}) {
          discard;
        }

        ${(0,E.If)(!B,E.H`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:E.H`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${j}) {
            discard;
          }
          ${(0,E.If)(!B,E.H`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${(0,E.If)(e.occludedFragmentFade&&!B,E.H`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= occludedOpacity;
        }
        `)}

    ${(0,E.If)(!B&&e.debugDrawLabelBorder,E.H`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(L){case a.H_.Color:case a.H_.ColorEmission:t.outputs.add("fragColor","vec4",0),L===a.H_.ColorEmission&&t.outputs.add("fragEmission","vec4",1),U===R.M.ColorAlpha&&t.outputs.add("fragAlpha","float",L===a.H_.ColorEmission?2:1),z.main.add(E.H`
        ${Z}
        ${(0,E.If)(U===R.M.FrontFace,E.H`fragColor.rgb /= fragColor.a;`)}
        ${(0,E.If)(L===a.H_.ColorEmission,E.H`fragEmission = vec4(0.0);`)}
        ${(0,E.If)(U===R.M.ColorAlpha,E.H`fragAlpha = fragColor.a;`)}`);break;case a.H_.ObjectAndLayerIdColor:z.main.add(E.H`
        ${Z}
        outputObjectAndLayerIdColor();`);break;case a.H_.Highlight:t.include(f.b,e),z.main.add(E.H`
        ${Z}
        outputHighlight(${(0,E.If)(V,E.H`voccluded == 1.0`,E.H`false`)});`)}return t}function D(e){return e.outlineColor[3]>0&&e.outlineSize>0}function N(e){return e.textureIsSignedDistanceField?function(e,t,i){(0,r.t8)(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1])}(e.anchorPosition,e.distanceFieldBoundingBox,F):(0,r.JG)(F,e.anchorPosition),F}const F=(0,n.Ue)(),U=Object.freeze(Object.defineProperty({__proto__:null,build:L,calculateAnchorPosition:N},Symbol.toStringTag,{value:"Module"}))},446:(e,t,i)=>{i.d(t,{H:()=>m,b:()=>f});var r=i(6600),n=i(31227),s=i(76203),o=i(58749),a=i(24603),l=i(20200),c=i(99126),u=i(16009),h=i(21388),d=i(81809),p=i(9229);function f(e){const t=new p.kG,{fragment:i}=t;t.include(u.X),(0,o.Pe)(i),t.include(s.D),i.include(n.K),i.include(h.l),i.include(d.l),i.include(r.t,!0),i.uniforms.add(new c.e("depthTexture",(e=>e.mainDepth)),new a.p("hazeStrength",(e=>e.hazeStrength)));const{reduced:f}=e;return f&&i.code.add(l.H`float getDepth(vec2 uv){
return linearDepthFromTexture(depthTexture, uv);
}
float textureBilinear(vec2 uv) {
vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
vec2 texelSize = 1.0 / depthTextureSize;
vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);
vec2 f = fract(depthUV);
vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;
float d0 = getDepth(snapUV);
float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
float d3 = getDepth(snapUV + texelSize);
return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
}`),i.main.add(l.H`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture(depthTexture, uv).r;
      if (depthSample != 1.0) {
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;

        cameraSpaceRay *= ${(0,l.If)(f,"-textureBilinear(uv)","-linearDepthFromTexture(depthTexture, uv)")};
        terrainDepth = max(0.0, length(cameraSpaceRay));
      } else {
        discard;
      }

      // Alpha is ignored for haze blending
      vec3 col = vec3(0);
      float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
      if(depthSample != 1.0){
        col = (1.0 - fadeOut) * hazeStrength * raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      }
      float alpha = 1.0;

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
  `),t}const m=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}))},30345:(e,t,i)=>{i.d(t,{H:()=>c,a:()=>h,b:()=>u});var r=i(55208),n=i(20200),s=i(99126),o=i(15176),a=i(86765),l=i(9229);class c extends a.K{}function u(){const e=new l.kG;return e.include(r.k),e.fragment.uniforms.add(new o.A("colorTexture",(e=>e.color)),new s.e("depthTexture",(e=>e.mainDepth))),e.fragment.main.add(n.H`float depthSample = texture(depthTexture, uv).r;
if (depthSample == 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},64183:(e,t,i)=>{i.d(t,{H:()=>h,b:()=>u});var r=i(91567),n=i(46368),s=i(24603),o=i(20200),a=i(97704),l=i(15176),c=i(9229);function u(){const e=new c.kG;e.include(r.y);const{fragment:t}=e;return t.uniforms.add(new l.A("highlightTexture",(e=>e.highlightTexture)),new l.A("highlightOptionsTexture",(e=>e.highlightOptionsTexture)),new s.p("pixelRatio",(e=>e.pixelRatio)),new s.p("occludedIntensityFactor",(e=>e.occludedFactor)),new a.Y("maxHighlightLevel",(e=>e.highlights.length-1))),t.constants.add("pixelSampleScale","float",1),e.include(n.D),t.code.add(o.H`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`),t.main.add(o.H`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}))},37738:(e,t,i)=>{i.d(t,{H:()=>l,a:()=>p,b:()=>d,c:()=>c,g:()=>u,o:()=>h});var r=i(55208),n=i(20200),s=i(37649),o=i(86765),a=i(9229);class l extends o.K{}function c(){const e=new a.kG,{outputs:t,fragment:i}=e;return e.include(r.k),i.uniforms.add(new s.R("textureInput",(e=>e.input))),i.constants.add("outlineWidth","int",Math.ceil(h)),i.constants.add("cellSize","int",u),t.add("fragGrid","vec2"),i.main.add(n.H`ivec2 inputTextureSize = textureSize(textureInput, 0);
ivec2 cellBottomLeftCornerInput = ivec2(floor(gl_FragCoord.xy) * vec2(cellSize));
ivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);
uvec2 centreTexel = uvec2( texelFetch(textureInput, coordMid, 0).rg * 255.0) & uvec2(0x55u);
float marginSquare = float(outlineWidth*outlineWidth);
uvec2 outputValue = centreTexel & uvec2(0x55u);
for(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
ivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);
uvec2[4] texels = uvec2[4] (
uvec2(texelFetch(textureInput,coord+ivec2(0,0),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(1,0),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(0,1),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(1,1),0).rg * 255.0) & uvec2(0x55u)
);
if (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {
continue;
}
for (int i=0; i<4; ++i){
outputValue |= ((texels[i] ^ centreTexel) << 1);
outputValue |= texels[i];
}
}
}
fragGrid = vec2(outputValue) / 255.0;`),e}const u=32,h=9,d=.4,p=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:l,blurSize:d,build:c,gridCellPixelSize:u,outlineSize:h},Symbol.toStringTag,{value:"Module"}))},48658:(e,t,i)=>{i.d(t,{H:()=>u,b:()=>c});var r=i(91567),n=i(46368),s=i(20200),o=i(59842),a=i(15176),l=i(9229);function c(){const e=new l.kG;e.include(r.y),e.include(n.D);const{fragment:t}=e;return e.outputs.add("fragSingleHighlight","vec2",0),t.uniforms.add(new a.A("highlightTexture",(e=>e.highlightTexture)),new o._("highlightLevel",(e=>e.highlightLevel))),t.main.add(s.H`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),e}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},1485:(e,t,i)=>{i.d(t,{L:()=>x,b:()=>b});var r=i(36531),n=i(84164),s=i(52721),o=i(5885),a=i(94728),l=i(21737),c=i(95067),u=i(32078),h=i(76774),d=i(80670),p=i(93072),f=i(80967),m=i(63371),g=i(24603),y=i(20200),_=i(21414),v=i(9229);function b(e){const t=new v.kG,{vertex:i,fragment:n}=t,{terrainDepthTest:b}=e;return i.include(a.H),t.include(l.R,e),t.vertex.include(o.$S,e),t.attributes.add(_.T.UV0,"vec2"),i.uniforms.add(new f.$("viewport",(e=>e.camera.fullViewport)),new g.p("lineSize",((e,t)=>e.size>0?Math.max(1,e.size)*t.camera.pixelRatio:0)),new d.$("pixelToNDC",(e=>(0,r.t8)(w,2/e.camera.fullViewport[2],2/e.camera.fullViewport[3]))),new g.p("borderSize",((e,t)=>e.borderColor?t.camera.pixelRatio:0)),new p.A("screenOffset",((e,t)=>(0,r.t8)(w,e.horizontalScreenOffset*t.camera.pixelRatio,0)))),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),b&&t.varyings.add("depth","float"),e.occlusionTestEnabled&&t.include(c.P),e.hasScreenSizePerspective&&(0,h.m8)(i),i.main.add(y.H`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${(0,y.If)(e.occlusionTestEnabled,y.H`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${e.hasScreenSizePerspective?y.H`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${(0,y.If)(b,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${(0,y.If)(e.hudDepth,e.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?y.H`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:y.H`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),n.uniforms.add(new m.N("uColor",(e=>e.color??s.AG)),new m.N("borderColor",(e=>e.borderColor??s.AG))),b&&(n.include(u.S,e),n.uniforms.add(new d.$("inverseViewport",(e=>e.inverseViewport)))),n.main.add(y.H`
    ${(0,y.If)(b,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${(0,y.If)(!e.hudDepth,y.H`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),t}const w=(0,n.Ue)(),x=Object.freeze(Object.defineProperty({__proto__:null,build:b},Symbol.toStringTag,{value:"Module"}))},5869:(e,t,i)=>{i.d(t,{M:()=>p,a:()=>_,b:()=>f});var r=i(95550),n=i(56999),s=i(52721),o=i(71278),a=i(63371),l=i(20200),c=i(15176),u=i(21414),h=i(86765),d=i(9229);class p extends h.K{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}}function f(){const e=new d.kG;return e.attributes.add(u.T.POSITION,"vec2"),e.vertex.uniforms.add(new a.N("drawPosition",((e,t)=>function(e,t){const i=t.camera.pixelRatio,s=e.magnifier.offset.x*i,o=e.magnifier.offset.y*i;(0,r.md)(e.magnifier.position,m);const a=t.camera.screenToRender(m,g),l=Math.ceil(i*e.magnifier.size),{fullWidth:c,fullHeight:u}=t.camera;return(0,n.s)(y,(a[0]+s)/c*2-1,(a[1]-o)/u*2-1,l/c*2,l/u*2)}(e,t)))),e.varyings.add("vUV","vec2"),e.vertex.main.add(l.H`vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);`),e.fragment.uniforms.add(new c.A("textureInput",(e=>e.input))),e.fragment.uniforms.add(new c.A("textureMask",(e=>e.mask))),e.fragment.uniforms.add(new c.A("textureOverlay",(e=>e.overlay))),e.fragment.uniforms.add(new o.U("maskEnabled",(e=>e.magnifier.maskEnabled))),e.fragment.uniforms.add(new o.U("overlayEnabled",(e=>e.magnifier.overlayEnabled))),e.fragment.code.add(l.H`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}`),e.fragment.main.add(l.H`float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;`),e}const m=(0,r.s1)(),g=(0,r.gX)(),y=(0,s.Ue)(),_=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:p,build:f},Symbol.toStringTag,{value:"Module"}))},3720:(e,t,i)=>{i.d(t,{N:()=>h,a:()=>p,b:()=>d});var r=i(84164),n=i(13696),s=i(43175),o=i(55208),a=i(93072),l=i(20200),c=i(86765),u=i(9229);class h extends c.K{constructor(){super(...arguments),this.weatherTile=(0,r.al)(0,0)}}function d(e){const t=new u.kG;if(t.include(o.k,!1),t.fragment.code.add(l.H`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),e.mode===n.u.Full){const e=2,i=8;t.fragment.code.add(l.H`float saturate(float x) {
return clamp(x, 0.0, 1.0);
}`),t.fragment.code.add(l.H`vec3 modulo(vec3 m, float n) {
return mod(mod(m, n) + n, n);
}
vec3 hash(vec3 p3, float frequency) {
p3 = modulo(p3, frequency);
p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yxz + 33.33);
return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
}`),t.fragment.code.add(l.H`vec3 fade(vec3 t) {
return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
}`),t.fragment.code.add(l.H`
    float gradientNoise(vec3 p, float frequency) {
      vec3 i = floor(p);
      vec3 f = fract(p);
      vec3 u = fade(f);
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequency = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequency;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${l.H.float(s.CB)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${l.H.float(i)});

      float worley0 = worley(p, ${l.H.float(e)} * 2.0);
      float worley1 = worley(p, ${l.H.float(e)} * 8.0);
      float worley2 = worley(p, ${l.H.float(e)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${l.H.float(e)});
      float worley1 = worley(p, ${l.H.float(e)} * 2.0);
      float worley2 = worley(p, ${l.H.float(e)} * 4.0);
      float worley3 = worley(p, ${l.H.float(e)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `)}return t.fragment.uniforms.add(new a.A("weatherTile",(e=>e.weatherTile))).code.add(l.H`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${l.H.float(s.JK)});

      // Get global coordinates of p
      p += weatherTile * ${l.H.float(s.JK)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${l.H.float(s.r7)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.mode===n.u.Full?t.fragment.main.add(l.H`
      float padWidth = 1.0;
      float paddedSize = ${l.H.float(s.i9)} + 2.0 * padWidth;
      float tileCount = ${l.H.float(s.CB)} * ${l.H.float(s.CB)};
      vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

      bool padCell = false;
      if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      bool startPadX = false;
      bool startPadY = false;
      bool endPadX = false;
      bool endPadY = false;

      if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
        startPadX = true;
      }

      if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
        startPadY = true;
      }

      if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
        endPadX = true;
      }

      if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
        endPadY = true;
      }

      vec2 padding = vec2(2.0 * padWidth) * tile;
      vec2 uv;

      if (padCell) {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;

        if (startPadX) {
          pixel.x += ${l.H.float(s.i9)};
        }

        if (startPadY) {
          pixel.y += ${l.H.float(s.i9)};
        }

        if (endPadX) {
          pixel.x -= ${l.H.float(s.i9)};
        }

        if (endPadY) {
          pixel.y -= ${l.H.float(s.i9)};
        }

        uv = vec2(pixel.xy / ${l.H.float(s.i9)});
      } else {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;
        uv = vec2(pixel.xy / ${l.H.float(s.i9)});
      }

      vec3 p_ = get3Dfrom2D(uv);
      vec3 p = p_;
      p.z /= (${l.H.float(s.CB)} * ${l.H.float(s.CB)});

      float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      float worleyNoise = getTextureForPointWorley(p);

      fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      p_ = mod(p_ + 1.0, ${l.H.float(s.CB)} * ${l.H.float(s.CB)});
      p = p_;
      p.z /= (${l.H.float(s.CB)} * ${l.H.float(s.CB)});

      worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      worleyNoise = getTextureForPointWorley(p);

      fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      vec2 mapUV = ${l.H.float(s.JK)} * (gl_FragCoord.xy / ${l.H.float(s.a5)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor.ba = vec2(0.0, map);
      `):t.fragment.main.add(l.H`
      vec2 mapUV = ${l.H.float(s.JK)} * (gl_FragCoord.xy / ${l.H.float(s.a5)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor = vec4(map);
    `),t}const p=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:h,build:d},Symbol.toStringTag,{value:"Module"}))},76818:(e,t,i)=>{i.d(t,{O:()=>l,a:()=>u,b:()=>c});var r=i(55208),n=i(20200),s=i(15176),o=i(86765),a=i(9229);class l extends o.K{}function c(e){const t=new a.kG;t.include(r.k);const i=e.hasEmission,o=t.fragment;return o.uniforms.add(new s.A("colorTexture",(e=>e.colorTexture)),new s.A("alphaTexture",(e=>e.alphaTexture)),new s.A("frontFaceTexture",(e=>e.frontFaceTexture))),t.outputs.add("fragColor","vec4",0),i&&(t.outputs.add("fragEmission","vec4",1),o.uniforms.add(new s.A("emissionTexture",(e=>e.emissionTexture))),o.uniforms.add(new s.A("emissionFrontFaceTexture",(e=>e.emissionFrontFaceTexture)))),o.main.add(n.H`
      float srcAlpha = texture(alphaTexture, uv).r;
      if(srcAlpha == 0.0){
        fragColor = vec4(0.0);
        return;
      }

      vec4 srcColor = texture(colorTexture, uv);
      vec4 frontFace = texture(frontFaceTexture, uv);

      vec4 transparentColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);
      fragColor = transparentColor;

      ${(0,n.If)(i,"vec4 emission = texture(emissionTexture, uv);\n         vec4 emissionFrontFace = texture(emissionFrontFaceTexture, uv);\n        fragEmission = vec4(mix(emission.rgb / srcAlpha, emissionFrontFace.rgb, emissionFrontFace.a), emissionFrontFace.a);")}
    `),t}const u=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:l,build:c},Symbol.toStringTag,{value:"Module"}))},30915:(e,t,i)=>{i.d(t,{O:()=>h,a:()=>p,b:()=>d});var r=i(9812),n=i(55208),s=i(24603),o=i(20200),a=i(59842),l=i(15176),c=i(86765),u=i(9229);class h extends c.K{constructor(){super(...arguments),this.overlayIndex=r.fu.INNER,this.opacity=1}}function d(){const e=new u.kG;return e.include(n.k),e.fragment.uniforms.add(new l.A("tex",(e=>e.texture))),e.fragment.uniforms.add(new a._("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new s.p("opacity",(e=>e.opacity))),e.fragment.main.add(o.H`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),e}const p=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:h,build:d},Symbol.toStringTag,{value:"Module"}))},74630:(e,t,i)=>{i.d(t,{P:()=>v,b:()=>p});var r=i(86717),n=i(81095),s=i(15396),o=i(20998),a=i(43036),l=i(24603),c=i(20200),u=i(61002),h=i(21414),d=i(9229);function p(e){const t=new d.kG;return t.attributes.add(h.T.POSITION,"vec3"),t.attributes.add(h.T.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new o.d("cameraPosition",(e=>e.camera.eye)),new a.J("offset",((e,t)=>function(e,t){const i=t.camera.eye,n=.5*e.width,s=1/e.width,o=(0,r.K)(f,(0,r.i)(f,(i[0]+n)*s,(i[1]+n)*s,(i[2]+n)*s));return(0,r.a)(o,i,(0,r.h)(o,o,e.width))}(e,t))),new l.p("width",(e=>e.width)),new l.p("time",(e=>e.time)),new u.C("proj",(e=>e.camera.projectionMatrix)),new u.C("view",(e=>e.camera.viewMatrix))),t.varyings.add("vUv","vec2"),t.vertex.code.add(c.H`vec3 hash31(float p){
vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yzx + 33.33);
return fract((p3.xxy + p3.yzz) * p3.zyx);
}
float hash11(float p){
p = fract(p * 0.1031);
p *= p + 33.33;
p *= p + p;
return fract(p);
}
vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
}`),t.vertex.main.add(c.H`
      vUv = position.xz;
      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundredths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===s.H.Rain?c.H`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:c.H`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
  `),t.fragment.uniforms.add(new l.p("opacity",(e=>e.opacity)),new o.d("particleColor",(t=>function(e,t){const i=t.type===s.H.Rain?y:g,n=(0,r.h)(f,i,_),o=e.camera.eye;(0,r.n)(m,o);const a=Math.max(0,(0,r.f)(m,e.lighting.mainLight.direction));return(0,r.m)(n,n,i,a)}(t,e)))),t.fragment.main.add(c.H`
    float d = length(vUv - vec2(0.5));

    ${e.type===s.H.Rain?c.H`d = 0.35 * smoothstep(0.5, 0.0, d);`:c.H`d = smoothstep(0.5, 0.1, d);`}
    fragColor = opacity * vec4(particleColor * d, d);
  `),t}const f=(0,n.Ue)(),m=(0,n.Ue)(),g=(0,n.al)(1,1,1),y=(0,n.al)(.85,.85,.85),_=.7,v=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}))},28624:(e,t,i)=>{i.d(t,{C:()=>_,R:()=>x,a:()=>v,b:()=>b,c:()=>w});var r=i(81095),n=i(84342),s=i(35434),o=i(45979),a=i(76763),l=i(73721),c=i(32394),u=i(71278),h=i(93072),d=i(24603),p=i(40335),f=i(20200),m=i(59842),g=i(15176),y=i(9229);class _ extends o.J{constructor(e,t,i,n,s,o){super(e,n,s),this.colormap=t,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=r.AG,this.fboTexture=null,this.baseOpacity=1}}class v extends _{}class b extends _{}function w(e){const t=new y.kG;return t.include(l.T),t.include(o.G,e),t.include(s.i,e),t.include(a.J,e),t.fragment.code.add(f.H`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),e.colorizerType===n.U.Stretch?function(e,t){e.fragment.uniforms.add(new m._("u_bandCount",(e=>e.symbolizer.u_bandCount)),new p.O("u_minCutOff",(e=>e.symbolizer.u_minCutOff),3),new p.O("u_maxCutOff",(e=>e.symbolizer.u_maxCutOff),3),new p.O("u_factor",(e=>e.symbolizer.u_factor),3),new d.p("u_minOutput",(e=>e.symbolizer.u_minOutput)),new d.p("u_maxOutput",(e=>e.symbolizer.u_maxOutput)),new u.U("u_useGamma",(e=>e.symbolizer.u_useGamma)),new p.O("u_gamma",(e=>e.symbolizer.u_gamma),3),new p.O("u_gammaCorrection",(e=>e.symbolizer.u_gammaCorrection),3),new d.p("u_opacity",(e=>e.common.u_opacity))),e.fragment.code.add(f.H`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?f.H`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:f.H`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.main.add(f.H`
    vec2 pixelLocation = getPixelLocation(uv);
    if (isOutside(pixelLocation)) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }

    vec4 currentPixel = getPixel(pixelLocation);
    ${t.stretchType===n.H.Noop?f.H`fragColor = applyBackgroundBlend(currentPixel);`:f.H`
    if (currentPixel.a == 0.0) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }
    if (u_bandCount == 1) {
      float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      ${i}
    } else {
      float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
      float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
      fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
    }`}`)}(t,e):e.colorizerType===n.U.Lut?function(e){e.fragment.main.add(f.H`vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));`)}(t):e.colorizerType===n.U.Hillshade&&function(e,t){const i=e.fragment;i.uniforms.add(new g.A("u_image",(e=>e.u_image)),new m._("u_hillshadeType",(e=>e.symbolizer.u_hillshadeType)),new p.O("u_sinZcosAs",(e=>e.symbolizer.u_sinZcosAs),6),new p.O("u_sinZsinAs",(e=>e.symbolizer.u_sinZsinAs),6),new p.O("u_cosZs",(e=>e.symbolizer.u_cosZs),6),new p.O("u_weights",(e=>e.symbolizer.u_weights),6),new h.A("u_factor",(e=>e.symbolizer.u_factor)),new d.p("u_minValue",(e=>e.symbolizer.u_minValue)),new d.p("u_maxValue",(e=>e.symbolizer.u_maxValue)),new h.A("u_srcImageSize",(e=>e.common.u_srcImageSize))),i.include(c.Y),i.code.add(f.H`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(f.H`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t.applyColormap?f.H`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:f.H`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.main.add(f.H`
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}`)}(t,e),t}const x=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:b,ColorizerStretchUniforms:v,ColorizerUniforms:_,build:w},Symbol.toStringTag,{value:"Module"}))},60926:(e,t,i)=>{i.d(t,{R:()=>U,b:()=>F});var r=i(95650),n=i(57218),s=i(35031),o=i(5885),a=i(4731),l=i(99163),c=i(7792),u=i(91636),h=i(92835),d=i(82082),p=i(6502),f=i(77700),m=i(77546),g=i(30786),y=i(24623),_=i(58749),v=i(89585),b=i(3864),w=i(60532),x=i(94880),T=i(12664),C=i(44866),S=i(27452),E=i(84614),M=i(43036),A=i(63371),R=i(24603),O=i(20200),P=i(15176),I=i(21414),L=i(82050),D=i(9229),N=i(5226);function F(e){const t=new D.kG,{vertex:i,fragment:F,varyings:U}=t,{output:k,offsetBackfaces:z,instancedColor:B,pbrMode:V,snowCover:H,spherical:G}=e,j=V===b.f7.Normal||V===b.f7.Schematic;if((0,E.Sv)(i,e),t.include(u.f),U.add("vpos","vec3"),t.include(T.k,e),t.include(l.f,e),t.include(f.L,e),t.include(x.H,e),(0,s.c1)(k)&&((0,E.hY)(t.vertex,e),t.include(c.O,e),t.include(a.w,e),z&&t.include(n.w),B&&t.attributes.add(I.T.INSTANCECOLOR,"vec4"),U.add("vNormalWorld","vec3"),U.add("localvpos","vec3"),t.include(d.D,e),t.include(r.qj,e),t.include(h.R,e),t.include(p.c,e),i.uniforms.add(new A.N("externalColor",(e=>e.externalColor))),U.add("vcolorExt","vec4"),i.main.add(O.H`
      forwardNormalizedVertexColor();
      vcolorExt = externalColor;
      ${(0,O.If)(B,"vcolorExt *= instanceColor * 0.003921568627451;")}
      vcolorExt *= vvColor();
      vcolorExt *= getSymbolColor();
      forwardColorMixMode();

      bool alphaCut = vcolorExt.a < ${O.H.float(N.e)};
      vpos = getVertexInLocalOriginSpace();
      localvpos = vpos - view[3].xyz;
      vpos = subtractOrigin(vpos);
      vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
      vpos = addVerticalOffset(vpos, localOrigin);
      vec4 basePosition = transformPosition(proj, view, vpos);

      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      forwardLinearDepth();
      forwardTextureCoordinates();

      gl_Position = alphaCut ? vec4(1e38, 1e38, 1e38, 1.0) :
      ${(0,O.If)(z,"offsetBackfacingClipPosition(basePosition, vpos, vNormalWorld, cameraPosition);","basePosition;")}
    `)),(0,s.c1)(k)){const{hasColorTexture:r,hasColorTextureTransform:n,receiveShadows:s}=e;t.include(y.XP,e),t.include(g.K,e),t.include(C.z,e),t.include(e.instancedDoublePrecision?w.hb:w.XE,e),t.fragment.include(o.f5,e),t.include(L.j,e),(0,E.hY)(t.fragment,e),(0,_.Pe)(F),(0,y.PN)(F),(0,y.sC)(F),F.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new M.J("ambient",(e=>e.ambient)),new M.J("diffuse",(e=>e.diffuse)),new R.p("opacity",(e=>e.opacity)),new R.p("layerOpacity",(e=>e.layerOpacity))),r&&F.uniforms.add(new P.A("tex",(e=>e.texture))),t.include(b.jV,e),t.include(v.T,e),F.include(S.y),(0,_.F1)(F),F.main.add(O.H`
      discardBySlice(vpos);
      discardByTerrainDepth();
      vec4 texColor = ${r?`texture(tex, ${n?"colorUV":"vuv0"})`:" vec4(1.0)"};
      ${(0,O.If)(r,`${(0,O.If)(e.textureAlphaPremultiplied,"texColor.rgb /= texColor.a;")}\n        discardOrAdjustAlpha(texColor);`)}
      vec3 viewDirection = normalize(vpos - cameraPosition);
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse();
      ssao *= getBakedOcclusion();

      float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
      float shadow = ${s?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":G?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};
      vec3 matColor = max(ambient, diffuse);
      ${e.hasVertexColors?O.H`vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:O.H`vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
      ${(0,O.If)(H,"albedo = mix(albedo, vec3(1), 0.9);")}
      ${O.H`vec3 shadingNormal = normalize(vNormalWorld);
             albedo *= 1.2;
             vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
             float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
             float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
             float treeRadialFalloff = vColor.r;
             float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
             additionalLight += backLightFactor * mainLightIntensity;`}
      ${(0,O.If)(j,`vec3 normalGround = ${G?"normalize(vpos + localOrigin)":"vec3(0.0, 0.0, 1.0)"};`)}
      ${j?O.H`float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                 ${(0,O.If)(H,O.H`mrr = vec3(0.0, 1.0, 0.04);`)}
            vec4 emission = ${H?"vec4(0.0)":"getEmissions()"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:O.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos);`)}return t.include(m.s,e),t}const U=Object.freeze(Object.defineProperty({__proto__:null,build:F},Symbol.toStringTag,{value:"Module"}))},2013:(e,t,i)=>{i.d(t,{R:()=>A,b:()=>M,r:()=>E});var r=i(35031),n=i(5885),s=i(78950),o=i(65915),a=i(37009),l=i(27988),c=i(95509),u=i(94880),h=i(32394),d=i(84614),p=i(80670),f=i(80967),m=i(63371),g=i(49016),y=i(24603),_=i(20200),v=i(61002),b=i(21414),w=i(60997),x=i(82050),T=i(26531),C=i(9229),S=i(5226);const E=1;function M(e){const t=new C.kG,{attributes:i,varyings:M,vertex:A,fragment:R}=t,{applyMarkerOffset:O,draped:P,output:I,capType:L,stippleEnabled:D,falloffEnabled:N,roundJoins:F,wireframe:U,innerColorEnabled:k}=e;t.include(c.e),t.include(o.U,e),t.include(a.q,e),t.include(s.R,e),t.include(u.H,e);const z=O&&!P;z&&(A.uniforms.add(new y.p("markerScale",(e=>e.markerScale))),t.include(l.Q,{space:w.I9.World})),(0,d.Sv)(A,e),A.uniforms.add(new v.C("inverseProjectionMatrix",(e=>e.camera.inverseProjectionMatrix)),new p.$("nearFar",(e=>e.camera.nearFar)),new y.p("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new f.$("viewport",(e=>e.camera.fullViewport))),A.constants.add("LARGE_HALF_FLOAT","float",65500),i.add(b.T.POSITION,"vec3"),i.add(b.T.PREVPOSITION,"vec3"),i.add(b.T.NEXTPOSITION,"vec3"),i.add(b.T.SUBDIVISIONFACTOR,"float"),i.add(b.T.UV0,"vec2"),M.add("vColor","vec4"),M.add("vpos","vec3"),M.add("vLineDistance","float"),M.add("vLineWidth","float");const B=D;B&&M.add("vLineSizeInv","float");const V=L===T.R.ROUND,H=D&&V,G=N||H;G&&M.add("vLineDistanceNorm","float"),V&&(M.add("vSegmentSDF","float"),M.add("vReverseSegmentSDF","float")),A.code.add(_.H`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),A.code.add(_.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),A.code.add(_.H`void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
float vnp = nearFar[0] * 0.99;
if(pos.z > -nearFar[0]) {
if (!isStartVertex) {
if(prev.z < -nearFar[0]) {
pos = mix(prev, pos, interp(vnp, prev, pos));
next = pos;
} else {
pos = vec4(0.0, 0.0, 0.0, 1.0);
}
} else {
if(next.z < -nearFar[0]) {
pos = mix(pos, next, interp(vnp, pos, next));
prev = pos;
} else {
pos = vec4(0.0, 0.0, 0.0, 1.0);
}
}
} else {
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
if (next.z > -nearFar[0]) {
next = mix(next, pos, interp(vnp, next, pos));
}
}
forwardViewPosDepth(pos.xyz);
pos = projectAndScale(pos);
next = projectAndScale(next);
prev = projectAndScale(prev);
}`),(0,d.ZI)(A),A.constants.add("aaWidth","float",D?0:1).main.add(_.H`
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${B?_.H`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),z&&A.main.add(_.H`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),A.main.add(_.H`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(D||V)&&A.main.add(_.H`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${V?_.H`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),A.main.add(_.H`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = perpendicular(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),F?A.main.add(_.H`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = perpendicular(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = perpendicular(endDir);

        float factor = ${D?_.H`min(1.0, subdivisionFactor * ${_.H.float((E+2)/(E+1))})`:_.H`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):A.main.add(_.H`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = perpendicular(joinDisplacementDir);`);const j=L!==T.R.BUTT;return A.main.add(_.H`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = perpendicular(joinDisplacementDir);

      ${j?_.H`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),A.main.add(_.H`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${G?_.H`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),V&&A.main.add(_.H`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),D&&(P?A.uniforms.add(new g.z("worldToScreenRatio",(e=>1/e.screenToPCSRatio))):A.main.add(_.H`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),A.main.add(_.H`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),P?A.main.add(_.H`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):A.main.add(_.H`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),A.uniforms.add(new y.p("stipplePatternPixelSize",(e=>(0,a.C)(e)))),A.main.add(_.H`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),A.main.add(_.H`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${U&&!P?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }`),t.fragment.include(n.f5,e),t.include(x.j,e),R.include(h.Y),R.main.add(_.H`discardBySlice(vpos);
discardByTerrainDepth();`),U?R.main.add(_.H`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(V&&R.main.add(_.H`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${_.H.float(S.e)}) {
          discard;
        }
      `),H?R.main.add(_.H`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${_.H.float(S.e)}, stippleCoverage);
      `):R.main.add(_.H`float stippleAlpha = getStippleAlpha();`),I!==r.H_.ObjectAndLayerIdColor&&R.main.add(_.H`discardByStippleAlpha(stippleAlpha, ${_.H.float(S.e)});`),R.uniforms.add(new m.N("intrinsicColor",(e=>e.color))),R.main.add(_.H`vec4 color = intrinsicColor * vColor;`),k&&(R.uniforms.add(new m.N("innerColor",(e=>e.innerColor??e.color)),new y.p("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),R.main.add(_.H`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),R.main.add(_.H`vec4 finalColor = blendStipple(color, stippleAlpha);`),N&&(R.uniforms.add(new y.p("falloff",(e=>e.falloff))),R.main.add(_.H`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),D||R.main.add(_.H`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),R.main.add(_.H`outputColorHighlightOID(finalColor, vpos);`),t}const A=Object.freeze(Object.defineProperty({__proto__:null,build:M,ribbonlineNumRoundJoinSubdivisions:E},Symbol.toStringTag,{value:"Module"}))},91800:(e,t,i)=>{i.d(t,{S:()=>_,b:()=>m,g:()=>g});var r=i(36531),n=i(84164),s=i(55208),o=i(31227),a=i(77334),l=i(80670),c=i(93072),u=i(49016),h=i(24603),d=i(20200),p=i(15176),f=i(9229);function m(){const e=new f.kG,t=e.fragment;return e.include(s.k),e.include(a.GZ),t.include(o.K),t.uniforms.add(new u.z("radius",(e=>g(e.camera)))).code.add(d.H`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),t.code.add(d.H`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.uniforms.add(new p.A("normalMap",(e=>e.normalTexture)),new p.A("depthMap",(e=>e.depthTexture)),new h.p("projScale",(e=>e.projScale)),new p.A("rnm",(e=>e.noiseTexture)),new c.A("rnmScale",((e,t)=>(0,r.t8)(y,t.camera.fullWidth/e.noiseTexture.descriptor.width,t.camera.fullHeight/e.noiseTexture.descriptor.height))),new h.p("intensity",(e=>e.intensity)),new l.$("screenSize",(e=>(0,r.t8)(y,e.camera.fullWidth,e.camera.fullHeight)))),e.outputs.add("fragOcclusion","float"),t.main.add(d.H`
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${d.H.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${d.H.int(16)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A * A * A * A) / 2.2;

      fragOcclusion = A;`),e}function g(e){return Math.max(10,20*e.computeScreenPixelSizeAtDist(Math.abs(4*e.relativeElevation)))}const y=(0,n.Ue)(),_=Object.freeze(Object.defineProperty({__proto__:null,build:m,getRadius:g},Symbol.toStringTag,{value:"Module"}))},24756:(e,t,i)=>{i.d(t,{S:()=>d,b:()=>h});var r=i(55208),n=i(31227),s=i(26482),o=i(24603),a=i(20200),l=i(37649),c=i(15176),u=i(9229);function h(){const e=new u.kG,t=e.fragment;e.include(r.k);return t.include(n.K),t.uniforms.add(new c.A("depthMap",(e=>e.depthTexture)),new l.R("tex",(e=>e.colorTexture)),new s.q("blurSize",(e=>e.blurSize)),new o.p("projScale",((e,t)=>{const i=t.camera.distance;return i>5e4?Math.max(0,e.projScale-(i-5e4)):e.projScale}))),t.code.add(a.H`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${a.H.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.outputs.add("fragBlur","float"),t.main.add(a.H`
    float b = 0.0;
    float w_total = 0.0;

    float center_d = linearDepthFromTexture(depthMap, uv);

    float sharpness = -0.05 * projScale / center_d;
    for (int r = -${a.H.int(4)}; r <= ${a.H.int(4)}; ++r) {
      float rf = float(r);
      vec2 uvOffset = uv + rf * blurSize;
      blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
    }
    fragBlur = b / w_total;`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},89417:(e,t,i)=>{i.d(t,{S:()=>m,a:()=>b,b:()=>y});var r=i(32114),n=i(3308),s=i(55208),o=i(31227),a=i(60532),l=i(77334),c=i(9794),u=i(20200),h=i(61002),d=i(99126),p=i(75862),f=i(9229);const m=255,g=1/m;function y(){const e=new f.kG,t=e.fragment;return t.include(c.n),t.include(o.K),e.include(l.GZ),e.include(s.k),e.include(a.hb,v),t.uniforms.add(new d.e("shadowMap",(e=>e.shadowMap.depthTexture)),new d.e("depthMap",(e=>e.depth?.attachment)),new h.C("inverseViewMatrix",(e=>(0,r.U_)(_,(0,r.Iu)(_,e.camera.viewMatrix,e.camera.center))))),t.constants.add("sampleValue","float",g),e.outputs.add("sampleCount","float"),t.main.add(u.H`sampleCount = 0.0;
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
return;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
return;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
return;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (shadow) {
sampleCount = sampleValue;
}`),e}const _=(0,n.Ue)(),v=new p.T,b=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:m,build:y},Symbol.toStringTag,{value:"Module"}))},52436:(e,t,i)=>{i.d(t,{S:()=>f,a:()=>y,b:()=>g});var r=i(52721),n=i(55208),s=i(77334),o=i(63371),a=i(24603),l=i(20200),c=i(15176),u=i(89417),h=i(50740),d=i(86765),p=i(9229);class f extends d.K{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=(0,r.d9)(m),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}}const m=(0,r.al)(.01,0,.25,1);function g(e){const t=new p.kG,i=t.fragment;t.include(s.GZ),t.include(n.k);const{visualization:r,bandsEnabled:d}=e;i.constants.add("inverseSampleValue","float",u.S),i.uniforms.add(new c.A("shadowCastMap",(e=>e.shadowCastMap)),new a.p("sampleScale",(e=>e.sampleScale)),new a.p("opacityFromElevation",(e=>e.opacityFromElevation)),new o.N("uColor",(e=>e.color)));const f=r===h.w.Gradient,m=r===h.w.Threshold;return f&&d?i.uniforms.add(new a.p("bandSize",(e=>e.bandSize))):m&&i.uniforms.add(new a.p("threshold",(e=>e.threshold))),i.main.add(l.H`
    float record = texture(shadowCastMap, uv).r;
    float pixelSamples = record * inverseSampleValue;

    fragColor = vec4(0.0);
    if (pixelSamples < 1.0) {
      return;
    }

    float strength = pixelSamples * sampleScale;
    ${m?l.H`if (strength <= threshold) return;`:""}
    ${f&&d?l.H`strength = ceil(strength / bandSize) * bandSize;`:""}
    fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${f?"* strength":""});
  `),t}const y=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:f,build:g},Symbol.toStringTag,{value:"Module"}))},23839:(e,t,i)=>{i.d(t,{S:()=>S,b:()=>w});var r=i(32114),n=i(3308),s=i(86717),o=i(81095),a=i(67783),l=i(55208),c=i(60532),u=i(9794),h=i(20998),d=i(63371),p=i(24603),f=i(20200),m=i(61002),g=i(99126),y=i(15176),_=i(95524),v=i(75862),b=i(9229);function w(){const e=new b.kG;e.include(c.hb,C),e.include(l.k),e.include(a.R);const t=e.fragment;return t.include(u.n),t.uniforms.add(new g.e("defaultDepthTex",(e=>e.shadowMap.getSnapshot(_.i.ExcludeHighlight))),new g.e("highlightDepthTex",(e=>e.shadowMap.getSnapshot(_.i.Highlight))),new g.e("depthMap",(e=>e.depth?.attachment)),new y.A("highlightTexture",(e=>e.highlight)),new d.N("uColor",(e=>e.shadowColor)),new p.p("opacity",(e=>e.shadowOpacity)),new p.p("occludedOpacity",(e=>e.occludedShadowOpacity)),new p.p("terminationFactor",(e=>e.opacityElevation*e.dayNightTerminator)),new h.d("lightingMainDirectionView",(({lighting:e,camera:t})=>(0,s.n)(T,(0,s.t)(T,e.mainLight.direction,t.viewInverseTransposeMatrix)))),new m.C("inverseViewMatrix",(({camera:e})=>(0,r.U_)(x,(0,r.Iu)(x,e.viewMatrix,e.center))))).main.add(f.H`
    ivec2 highlightTextureSize = textureSize(highlightTexture, 0);
    ivec2 highlightIUV = ivec2(uv * vec2(highlightTextureSize));
    vec4 highlightInfo = texelFetch(highlightTexture, highlightIUV, 0);

    fragColor = vec4(0.0);

    // Calculate bit mask to check if pixel is highlit unoccluded at any level
    int ored =
         (int(highlightInfo.r*255.0) << 0)
       | (int(highlightInfo.g*255.0) << 8);
    bool visiblyHighlighted = ((ored & ~(ored >> 1)) & (1+4+16+64)) != 0;
    if (visiblyHighlighted) {
      return;
    }

    // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
    float depth = depthFromTexture(depthMap, uv);
    if (depth >= 1.0 || depth <= 0.0) {
      return;
    }

    float currentPixelDepth = linearizeDepth(depth);
    vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
    vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

    mat4 shadowMatrix;
    float linearDepth = -currentPixelDepth;
    int i = chooseCascade(linearDepth, shadowMatrix);
    if (i >= numCascades) {
      return;
    }

    // vertex completely outside? -> no shadow
    vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
    if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
      return;
    }

    ivec2 texSize = textureSize(highlightDepthTex, 0);
    ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

    float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
    bool shadowHighlight = depthHighlight < lvpos.z;
    if (!shadowHighlight) {
      return;
    }

    float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
    bool shadowDefault = depthDefault < lvpos.z;

    vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
    bool shaded = dot(normal, lightingMainDirectionView) < ${f.H.float(.025)};

    float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
    fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
  `),e}const x=(0,n.Ue)(),T=(0,o.Ue)(),C=new v.T,S=Object.freeze(Object.defineProperty({__proto__:null,build:w},Symbol.toStringTag,{value:"Module"}))},41938:(e,t,i)=>{i.d(t,{S:()=>_,a:()=>w,b:()=>v,c:()=>b});var r=i(84164),n=i(81095),s=i(28876),o=i(4731),a=i(58749),l=i(93072),c=i(20998),u=i(43036),h=i(24603),d=i(20200),p=i(61002),f=i(15176),m=i(21414),g=i(86765),y=i(9229);class _ extends g.K{constructor(){super(...arguments),this.texV=(0,r.Ue)(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new v}}class v{constructor(){this.center=(0,n.Ue)(),this.v1=(0,n.Ue)(),this.v2=(0,n.Ue)()}}function b(e){const t=new y.kG,{vertex:i,fragment:r}=t;if((0,a.Pe)(i),e.geometry===s.n.Underground)t.attributes.add(m.T.POSITION,"vec2"),t.varyings.add("color","vec4"),i.uniforms.add(new c.d("cameraPosition",(e=>e.camera.eye)),new h.p("undergroundFadeAlpha",(e=>e.undergroundFadeAlpha))),i.main.add(d.H`float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);`),r.main.add(d.H`fragColor = color;`);else{t.include(o.w,e),t.attributes.add(m.T.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const n=e.geometry===s.n.Cylinder;i.uniforms.add(new p.C("proj",(e=>e.camera.projectionMatrix)),new p.C("view",(e=>e.camera.viewMatrix))),n||(t.varyings.add("innerFactor","float"),i.uniforms.add(new u.J("silCircleCenter",(e=>e.silhouette.center))),i.uniforms.add(new u.J("silCircleV1",(e=>e.silhouette.v1))),i.uniforms.add(new u.J("silCircleV2",(e=>e.silhouette.v2))),i.uniforms.add(new l.A("texV",(e=>e.texV))),i.uniforms.add(new h.p("innerScale",(e=>e.innerScale))));const a=6.2831853,c=1/128;i.main.add(d.H`
      ${n?d.H`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:d.H`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${d.H.float(a*c)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${d.H.float(c)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
	  `),r.uniforms.add(new f.A("tex",(e=>e.texture))),n||r.uniforms.add(new h.p("altitudeFade",(e=>e.altitudeFade))),r.main.add(d.H`
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?d.H`fragColor = atmosphereColor;`:d.H`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));`}`)}return t}const w=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:v,SimpleAtmospherePassParameters:_,build:b},Symbol.toStringTag,{value:"Module"}))},61008:(e,t,i)=>{i.d(t,{S:()=>p,b:()=>d});var r=i(91567),n=i(46368),s=i(26482),o=i(24603),a=i(20200),l=i(59842),c=i(15176),u=i(37738),h=i(9229);function d(){const e=new h.kG;e.include(r.y);const{fragment:t}=e;return t.uniforms.add(new c.A("blurInput",(e=>e.singleHighlightBlurTexture)),new s.q("blurSize",(e=>e.blurSize)),new c.A("highlightTexture",(e=>e.highlightTexture)),new c.A("highlightOptionsTexture",(e=>e.highlightOptionsTexture)),new l._("highlightLevel",(e=>e.highlightLevel)),new o.p("occludedIntensityFactor",(e=>e.occludedFactor))),t.constants.add("inner","float",1-(u.o-u.b)/u.o),e.include(n.D),t.main.add(a.H`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),e}const p=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}))},95466:(e,t,i)=>{i.d(t,{S:()=>u,a:()=>d,b:()=>h});var r=i(84164),n=i(91567),s=i(26482),o=i(20200),a=i(37649),l=i(86765),c=i(9229);class u extends l.K{constructor(){super(...arguments),this.blurSize=(0,r.Ue)()}}function h(){const e=new c.kG;return e.include(n.y),e.outputs.add("fragSingleHighlight","vec2",0),e.fragment.uniforms.add(new s.q("blurSize",(e=>e.blurSize)),new a.R("blurInput",(e=>e.blurInput))).main.add(o.H`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 center = texture(blurInput, sUV).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:u,build:h},Symbol.toStringTag,{value:"Module"}))},26761:(e,t,i)=>{i.d(t,{S:()=>p,b:()=>h});var r=i(32114),n=i(3308),s=i(80967),o=i(49016),a=i(20200),l=i(87621),c=i(21414),u=i(9229);function h(){const e=new u.kG;return e.attributes.add(c.T.POSITION,"vec3"),e.attributes.add(c.T.COLOR,"vec4"),e.attributes.add(c.T.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add(new l.g("transform",((e,t)=>function(e,t){const i=24e-8;return(0,r.JG)(d,t.camera.projectionMatrix),d[10]=i-1,d[11]=-1,d[14]=(i-2)*t.camera.near,(0,r.Jp)(d,d,t.camera.viewMatrix),(0,r.Jp)(d,d,e.modelMatrix)}(e,t))),new s.$("viewport",(e=>e.camera.fullViewport)),new o.z("pixelRatio",(e=>e.camera.pixelRatio))),e.vertex.main.add(a.H`gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;`),e.fragment.main.add(a.H`float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);`),e}const d=(0,n.Ue)(),p=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},8106:(e,t,i)=>{i.d(t,{T:()=>D,a:()=>k,b:()=>N});var r=i(32114),n=i(3308),s=i(86717),o=i(81095),a=i(33401),l=i(51428),c=i(95650),u=i(35031),h=i(5885),d=i(4731),p=i(7792),f=i(91636),m=i(82082),g=i(14140),y=i(59004),_=i(32560),v=i(30786),b=i(24623),w=i(58749),x=i(37451),T=i(3864),C=i(60532),S=i(97582),E=i(47096),M=i(84614),A=i(20998),R=i(20200),O=i(3875),P=i(15176),I=i(9229),L=i(5226);class D extends E.uS{}function N(e){const t=new I.kG,{vertex:i,fragment:n,varyings:o}=t,{output:D,pbrMode:N,overlayMode:k,tileBorders:z,spherical:B,transparencyMode:V,screenSizePerspective:H}=e;t.include(f.f),t.include(p.O,e),t.include(m.D,e);const G=()=>{t.include(x.n,e),i.code.add(R.H`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};(0,M.Sv)(i,e),t.include(d.w,e);const j=V===l.w.InvisibleWithDraped||V===l.w.Invisible,Z=k!==S.gT.Disabled,q=Z&&j;switch(D){case u.H_.ColorEmission:case u.H_.Color:{t.include(E.EK,e),t.include(b.XP,e),Z&&(e.pbrMode=N===T.f7.Simplified?T.f7.TerrainWithWater:T.f7.Water,t.include(S.yl,e),e.pbrMode=N);const l=k===S.gT.EnabledWithWater;l&&t.include(g.M,e),o.add("vnormal","vec3"),o.add("vpos","vec3"),o.add("vup","vec3"),G(),H&&(0,M._8)(i);const u=e.receiveShadows&&!e.renderOccluded;u&&t.include(c.qj,e),H&&(o.add("screenSizeDistanceToCamera","float"),o.add("screenSizeCosAngle","float")),i.main.add(R.H`
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);
          vnormal = getNormal();
          vup = getLocalUp(position, localOrigin);
          ${(0,R.If)(l,R.H`forwardVertexTangent(vnormal);`)}

          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${(0,R.If)(Z,"setOverlayVTC(uv);")}
          ${(0,R.If)(z,"forwardTextureCoordinates();")}
          ${(0,R.If)(H,R.H`vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
                 screenSizeDistanceToCamera = length(viewPos);
                 vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
                 screenSizeCosAngle = abs(viewSpaceNormal.z);`)}
          ${(0,R.If)(u,"forwardLinearDepth();")}`),t.fragment.include(h.f5,e),t.include(b.XP,e),t.include(v.K,e),t.include(C.XE,e),(0,M.hY)(n,e),(0,b.PN)(n),(0,b.sC)(n),n.uniforms.add(i.uniforms.get("localOrigin"),new A.d("viewDirection",(({camera:e})=>(0,s.n)(U,(0,s.i)(U,e.viewMatrix[12],e.viewMatrix[13],e.viewMatrix[14]))))),l&&n.uniforms.add(new P.A("ovWaterTex",((e,t)=>t.overlay?.getTexture(a.D.WaterNormal))),new O.K("view",(({origin:e},{camera:t})=>(0,r.Iu)(F,t.viewMatrix,e))));const d=.2;n.code.add(R.H`float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),(0,w.Pe)(n),(0,w.F1)(n),n.main.add(R.H`
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${u?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":B?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${(0,R.If)(Z,R.H`vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
                   vec4 overlayColor = overlayOpacity * overlayColorOpaque;
                   ${(0,R.If)(j,`if (overlayColor.a < ${R.H.float(L.e)}) { discard; }`)}
                   vec4 groundColor = tileColor;
                   tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`)}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a < ${R.H.float(L.e)}) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= ${R.H.float(d)};
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${N===T.f7.Simplified||N===T.f7.TerrainWithWater?R.H`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:R.H`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${(0,R.If)(l,R.H`vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
                   float waterNormalLength = length(overlayWaterMask);
                   if (waterNormalLength > 0.95) {
                     mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                     vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                     vec4 viewPosition = view*vec4(vpos, 1.0);
                     vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                     vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                     float opacity = sliced ? ${R.H.float(d)} : 1.0;
                     // un-gamma the ground color to mix in linear space
                     fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
                   }`)}
          ${(0,R.If)(H,R.H`float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0));
                   if (perspectiveScale <= 0.25) {
                     fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
                   } else if (perspectiveScale <= 0.5) {
                     fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
                   } else if (perspectiveScale >= 0.99) {
                     fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
                   } else {
                     fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
                   }`)}
          ${(0,R.If)(e.visualizeNormals,B?R.H`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`:R.H`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`)}
          ${(0,R.If)(z,R.H`vec2 dVuv = fwidth(vuv0);
                 vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
                 float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
                 fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`)}
          fragColor = applySlice(fragColor, vpos);`)}break;case u.H_.Depth:q&&t.include(S.yl,e),i.main.add(R.H`
        ${(0,R.If)(q,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);`),n.main.add(`${(0,R.If)(q,`if (getCombinedOverlayColor().a < ${R.H.float(L.e)}) discard;`)}`);break;case u.H_.Shadow:case u.H_.ShadowHighlight:case u.H_.ShadowExcludeHighlight:case u.H_.ViewshedShadow:t.include(y.F,e),(0,c.Lm)(t),(0,c.Zu)(t),i.main.add(R.H`gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);`),n.main.add(R.H`outputDepth(linearDepth);`);break;case u.H_.Normal:q&&t.include(S.yl,e),o.add("vnormal","vec3"),(0,M._8)(i),G(),i.main.add(R.H`
        ${(0,R.If)(q,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);
        vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);`),n.main.add(R.H`
        ${(0,R.If)(q,`if (getCombinedOverlayColor().a < ${R.H.float(L.e)}) discard;`)}
        vec3 normal = normalize(vnormal);
        if (gl_FrontFacing == false) {
          normal = -normal;
        }
        fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);`);break;case u.H_.Highlight:Z&&t.include(S.yl,e),i.main.add(R.H`
        ${(0,R.If)(Z,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);`),t.include(_.b,e),n.main.add(R.H`
        ${(0,R.If)(Z,R.H`
           vec2 overlayHighlightTexel = getAllOverlayHighlightValuesEncoded();
           calculateOcclusionAndOutputHighlightOverlay(overlayHighlightTexel);`,"calculateOcclusionAndOutputHighlight();")}
      `)}if(D===u.H_.ObjectAndLayerIdColor)if(Z)e.pbrMode=T.f7.Disabled,t.include(S.yl,e),e.pbrMode=N,i.main.add(R.H`gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());`),n.main.add(R.H`fragColor = getOverlayColorTexel();`);else{const e=V===l.w.Opaque;i.main.add(R.H`${(0,R.If)(e,"gl_Position = transformPosition(proj, view, position);")}`),n.main.add(R.H`fragColor = vec4(0.0);`)}return t}const F=(0,n.Ue)(),U=(0,o.Ue)(),k=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:D,build:N},Symbol.toStringTag,{value:"Module"}))},86243:(e,t,i)=>{i.d(t,{T:()=>u,a:()=>d,b:()=>h});var r=i(81095),n=i(55208),s=i(43036),o=i(20200),a=i(15176),l=i(86765),c=i(9229);class u extends l.K{constructor(){super(...arguments),this.color=(0,r.al)(1,1,1)}}function h(){const e=new c.kG;return e.include(n.k),e.fragment.uniforms.add(new a.A("tex",(e=>e.texture)),new s.J("uColor",(e=>e.color))),e.fragment.main.add(o.H`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:u,build:h},Symbol.toStringTag,{value:"Module"}))},96739:(e,t,i)=>{i.d(t,{B:()=>_,a:()=>b,b:()=>J,c:()=>M,d:()=>v,e:()=>L,f:()=>w,g:()=>C,h:()=>I,i:()=>S,n:()=>U,r:()=>F,t:()=>N,u:()=>x});i(39994);var r=i(13802),n=i(19431),s=i(19480),o=i(32114),a=i(3308),l=i(86717),c=i(81095),u=i(24568),h=i(19546),d=i(56215),p=i(69430),f=i(97537),m=i(5700),g=i(68817);const y=()=>r.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");const _=class{constructor(){this.plane=(0,p.Ue)(),this.origin=(0,c.Ue)(),this.basis1=(0,c.Ue)(),this.basis2=(0,c.Ue)()}};function v(e=H){return{plane:(0,p.Ue)(e.plane),origin:(0,c.d9)(e.origin),basis1:(0,c.d9)(e.basis1),basis2:(0,c.d9)(e.basis2)}}function b(e,t=v()){return w(e.origin,e.basis1,e.basis2,t)}function w(e,t,i,r=v()){return(0,l.c)(r.origin,e),(0,l.c)(r.basis1,t),(0,l.c)(r.basis2,i),x(r),function(e,t){Math.abs((0,l.f)(e.basis1,e.basis2)/((0,l.l)(e.basis1)*(0,l.l)(e.basis2)))>1e-6&&y().warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,l.f)(e.basis1,U(e)))>1e-6&&y().warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.f)(U(e),e.origin)-e.plane[3])>1e-6&&y().warn(t,"Plane offset is not consistent with plane origin")}(r,"fromValues()"),r}function x(e){(0,p.my)(e.basis2,e.basis1,e.origin,e.plane)}function T(e,t,i){e!==i&&b(e,i);const r=(0,l.h)(g.WM.get(),U(e),t);return(0,l.g)(i.origin,i.origin,r),i.plane[3]-=t,i}function C(e,t=v()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return(0,l.i)(t.origin,e[0]+i,e[1]+r,0),(0,l.i)(t.basis1,i,0,0),(0,l.i)(t.basis2,0,r,0),(0,p.al)(0,0,1,0,t.plane),t}function S(e,t,i){return!!(0,p.BR)(e.plane,t,i)&&k(e,i)}function E(e,t,i){const r=G.get();V(e,t,r,G.get());let s=Number.POSITIVE_INFINITY;for(const o of W){const a=B(e,o,j.get()),c=g.WM.get();if((0,p.rx)(r,a,c)){const e=(0,l.o)(g.WM.get(),t.origin,c),r=Math.abs((0,n.ZF)((0,l.f)(t.direction,e)));r<s&&(s=r,(0,l.c)(i,c))}}return s===Number.POSITIVE_INFINITY?A(e,t,i):i}function M(e,t){return(t-e)/t}function A(e,t,i){if(S(e,t,i))return i;const r=G.get(),n=G.get();V(e,t,r,n);let s=Number.POSITIVE_INFINITY;for(const o of W){const a=B(e,o,j.get()),c=g.WM.get();if((0,p.dZ)(r,a,c)){const e=(0,f.Jk)(t,c);if(!(0,p.Ac)(n,c))continue;e<s&&(s=e,(0,l.c)(i,c))}}return P(e,t.origin)<s&&R(e,t.origin,i),i}function R(e,t,i){const r=(0,p.nF)(e.plane,t,g.WM.get()),n=(0,d.ct)(z(e,e.basis1),r,-1,1,g.WM.get()),s=(0,d.ct)(z(e,e.basis2),r,-1,1,g.WM.get());return(0,l.d)(i,(0,l.g)(g.WM.get(),n,s),e.origin),i}function O(e,t,i){const{origin:r,basis1:n,basis2:s}=e,o=(0,l.d)(g.WM.get(),t,r),a=(0,m.SR)(n,o),c=(0,m.SR)(s,o),u=(0,m.SR)(U(e),o);return(0,l.i)(i,a,c,u)}function P(e,t){const i=O(e,t,g.WM.get()),{basis1:r,basis2:n}=e,s=(0,l.l)(r),o=(0,l.l)(n),a=Math.max(Math.abs(i[0])-s,0),c=Math.max(Math.abs(i[1])-o,0),u=i[2];return a*a+c*c+u*u}function I(e,t){return Math.sqrt(P(e,t))}function L(e,t){return(0,p.Ac)(e.plane,t)&&k(e,t)}function D(e,t){const i=-e.plane[3];return(0,m.SR)(U(e),t)-i}function N(e,t,i){return e!==i&&b(e,i),(0,o.U_)($,t),(0,o.p4)($,$),(0,l.t)(i.basis1,e.basis1,$),(0,l.t)(i.basis2,e.basis2,$),(0,l.t)((0,p.st)(i.plane),(0,p.st)(e.plane),$),(0,l.t)(i.origin,e.origin,t),(0,p.T5)(i.plane,i.plane,i.origin),i}function F(e,t,i,r){return e!==r&&b(e,r),(0,o.Us)(Y,t,i),(0,l.t)(r.basis1,e.basis1,Y),(0,l.t)(r.basis2,e.basis2,Y),x(r),r}function U(e){return(0,p.st)(e.plane)}function k(e,t){const i=(0,l.d)(g.WM.get(),t,e.origin),r=(0,l.k)(e.basis1),n=(0,l.k)(e.basis2),s=(0,l.f)(e.basis1,i),o=(0,l.f)(e.basis2,i);return-s-r<0&&s-r<0&&-o-n<0&&o-n<0}function z(e,t){const i=j.get();return(0,l.c)(i.origin,e.origin),(0,l.c)(i.vector,t),i}function B(e,t,i){const{basis1:r,basis2:n,origin:s}=e,o=(0,l.h)(g.WM.get(),r,t.origin[0]),a=(0,l.h)(g.WM.get(),n,t.origin[1]);(0,l.g)(i.origin,o,a),(0,l.g)(i.origin,i.origin,s);const c=(0,l.h)(g.WM.get(),r,t.direction[0]),u=(0,l.h)(g.WM.get(),n,t.direction[1]);return(0,l.h)(i.vector,(0,l.g)(c,c,u),2),i}function V(e,t,i,r){const n=U(e);(0,p.my)(n,t.direction,t.origin,i),(0,p.my)((0,p.st)(i),n,t.origin,r)}const H={plane:(0,p.Ue)(),origin:(0,c.al)(0,0,0),basis1:(0,c.al)(1,0,0),basis2:(0,c.al)(0,1,0)},G=new s.x(p.Ue),j=new s.x(d.Ue),Z=(0,c.Ue)(),q=new s.x((()=>v())),W=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],$=(0,a.Ue)(),Y=(0,a.Ue)(),J=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:_,altitudeAt:D,axisAt:function(e,t,i,r){return function(e,t,i){switch(t){case h.R.X:(0,l.c)(i,e.basis1),(0,l.n)(i,i);break;case h.R.Y:(0,l.c)(i,e.basis2),(0,l.n)(i,i);break;case h.R.Z:(0,l.c)(i,U(e))}return i}(e,i,r)},cameraFrustumCoverage:M,closestPoint:A,closestPointOnSilhouette:E,copy:b,copyWithoutVerify:function(e,t){(0,l.c)(t.origin,e.origin),(0,l.c)(t.basis1,e.basis1),(0,l.c)(t.basis2,e.basis2),(0,p.JG)(t.plane,e.plane)},create:v,distance:I,distance2:P,distanceToSilhouette:function(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of W){const n=B(e,r,j.get()),s=(0,d.Jk)(n,t);s>i&&(i=s)}return Math.sqrt(i)},elevate:T,equals:function(e,t){return(0,l.p)(e.basis1,t.basis1)&&(0,l.p)(e.basis2,t.basis2)&&(0,l.p)(e.origin,t.origin)},extrusionContainsPoint:L,fromAABoundingRect:C,fromValues:w,getExtent:function(e,t){const i=e.basis1[0],r=e.basis2[1],[n,s]=e.origin;return(0,u.al)(n-i,s-r,n+i,s+r,t)},intersectRay:S,intersectRayClosestSilhouette:function(e,t,i){if(S(e,t,i))return i;const r=E(e,t,g.WM.get());return(0,l.g)(i,t.origin,(0,l.h)(g.WM.get(),t.direction,(0,l.j)(t.origin,r)/(0,l.l)(t.direction))),i},normal:U,projectPoint:R,projectPointLocal:O,rotate:F,setAltitudeAt:function(e,t,i,r){const n=D(e,t),s=(0,l.h)(Z,U(e),i-n);return(0,l.g)(r,t,s),r},setExtent:function(e,t,i){return C(t,i),T(i,D(e,e.origin),i),i},transform:N,up:H,updateUnboundedPlane:x,wrap:function(e,t,i){const r=q.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=(0,p.re)(0,0,0,0),x(r),r}},Symbol.toStringTag,{value:"Module"}))},5992:(e,t,i)=>{function r(e,t,i){i=i||2;var r,s,a,l,c,u,d,p=t&&t.length,f=p?t[0]*i:e.length,m=n(e,0,f,i,!0),g=[];if(!m||m.next===m.prev)return g;if(p&&(m=h(e,t,m,i)),e.length>80*i){r=a=e[0],s=l=e[1];for(var y=i;y<f;y+=i)(c=e[y])<r&&(r=c),(u=e[y+1])<s&&(s=u),c>a&&(a=c),u>l&&(l=u);d=0!==(d=Math.max(a-r,l-s))?1/d:0}return o(m,g,i,r,s,d),g}function n(e,t,i,r,n){var s,o;if(n===P(e,t,i,r)>0)for(s=t;s<i;s+=r)o=A(s,e[s],e[s+1],o);else for(s=i-r;s>=t;s-=r)o=A(s,e[s],e[s+1],o);if(o&&x(o,o.next)){var a=o.next;R(o),o=a}return o}function s(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!x(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{var n=r.prev;if(R(r),(r=t=n)===r.next)break;i=!0}}while(i||r!==t);return t}function o(e,t,i,r,n,h,d){if(e){!d&&h&&g(e,r,n,h);for(var p,f,m=e;e.prev!==e.next;)if(p=e.prev,f=e.next,h?l(e,r,n,h):a(e))t.push(p.i/i),t.push(e.i/i),t.push(f.i/i),R(e),e=f.next,m=f.next;else if((e=f)===m){d?1===d?o(e=c(s(e),t,i),t,i,r,n,h,2):2===d&&u(e,t,i,r,n,h):o(s(e),t,i,r,n,h,1);break}}}function a(e){var t=e.prev,i=e,r=e.next;if(w(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(v(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&w(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function l(e,t,i,r){var n=e.prev,s=e,o=e.next;if(w(n,s,o)>=0)return!1;for(var a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,l=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,c=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,u=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,h=y(a,l,t,i,r),d=y(c,u,t,i,r),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&v(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&v(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&v(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&v(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function c(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!x(n,o)&&T(n,r,r.next,o)&&E(n,o)&&E(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),R(r),R(r.next),r=e=o),r=r.next}while(r!==e);return s(r)}function u(e,t,i,r,n,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&b(l,c)){var u=M(l,c);return l=s(l,l.next),u=s(u,u.next),o(l,t,i,r,n,a),void o(u,t,i,r,n,a)}c=c.next}l=l.next}while(l!==e)}function h(e,t,i,r){var o,a,l,c=[];for(o=0,a=t.length;o<a;o++)(l=n(e,t[o]*r,o<a-1?t[o+1]*r:e.length,r,!1))===l.next&&(l.steiner=!0),c.push(_(l));for(c.sort(d),o=0;o<c.length;o++)i=s(i=f(c[o],i),i.next);return i}function d(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function f(e,t){var i=function(e,t){var i,r=t,n=e.x,s=e.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>o){if(o=a,a===n){if(s===r.y)return r;if(s===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===o)return i;var l,c=i,u=i.x,h=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&v(s<h?n:o,s,u,h,s<h?o:n,s,r.x,r.y)&&(l=Math.abs(s-r.y)/(n-r.x),E(r,e)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&m(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(e,t);if(!i)return t;var r=M(i,e),n=s(i,i.next);let o=p(r);return s(o,o.next),n=p(n),p(t===i?n:t)}function m(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function g(e,t,i,r){var n=e;do{null===n.z&&(n.z=y(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,r=i,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(o>1)}(n)}function y(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function v(e,t,i,r,n,s,o,a){return(n-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(r-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(n-o)*(r-a)>=0}function b(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&T(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(E(e,t)&&E(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||x(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function T(e,t,i,r){var n=S(w(e,t,i)),s=S(w(e,t,r)),o=S(w(i,r,e)),a=S(w(i,r,t));return n!==s&&o!==a||!(0!==n||!C(e,i,t))||!(0!==s||!C(e,r,t))||!(0!==o||!C(i,e,r))||!(0!==a||!C(i,t,r))}function C(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function S(e){return e>0?1:e<0?-1:0}function E(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function M(e,t){var i=new O(e.i,e.x,e.y),r=new O(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function A(e,t,i,r){var n=new O(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function R(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function O(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function P(e,t,i,r){for(var n=0,s=t,o=i-r;s<i;s+=r)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}i.d(t,{e:()=>r}),r.deviation=function(e,t,i,r){var n=t&&t.length,s=n?t[0]*i:e.length,o=Math.abs(P(e,0,s,i));if(n)for(var a=0,l=t.length;a<l;a++){var c=t[a]*i,u=a<l-1?t[a+1]*i:e.length;o-=Math.abs(P(e,c,u,i))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,p=r[a+1]*i,f=r[a+2]*i;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},r.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var o=0;o<t;o++)i.vertices.push(e[n][s][o]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i}},96926:(e,t,i)=>{i.d(t,{P:()=>d,a:()=>u,c:()=>v,g:()=>c,h:()=>g,i:()=>a,j:()=>T,l:()=>l,p:()=>O});var r=i(36567),n=i(39994);let s,o=null;function a(){return!!o}function l(){return s||(s=i.e(28506).then(i.bind(i,28506)).then((e=>e.p)).then((({default:e})=>e({locateFile:e=>(0,r.V)(`esri/geometry/support/${e}`)}))).then((e=>{S(e)})),s)}var c,u;!function(e){function t(e,t,i){o.ensureCache.prepare();const r=A(i),n=i===r,s=o.ensureFloat64(r),a=o._pe_geog_to_proj(o.getPointer(e),t,s);return a&&R(i,t,s,n),a}function i(e,t,i){return r(e,t,i,0)}function r(e,t,i,r){o.ensureCache.prepare();const n=A(i),s=i===n,a=o.ensureFloat64(n),l=o._pe_proj_to_geog_center(o.getPointer(e),t,a,r);return l&&R(i,t,a,s),l}e.geogToProj=t,e.projGeog=function(e,r,n,s){switch(s){case u.PE_TRANSFORM_P_TO_G:return i(e,r,n);case u.PE_TRANSFORM_G_TO_P:return t(e,r,n)}return 0},e.projToGeog=i,e.projToGeogCenter=r}(c||(c={})),function(e){e.init=function(){e.PE_BUFFER_MAX=o.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=o.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=o.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=o.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=o.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=o.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=o.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=o.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=o.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=o.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=o.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=o.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=o.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=o.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=o.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=o.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=o.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=o.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=o.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=o.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_STR_FMT_WKT=o.PeDefs.prototype.PE_STR_FMT_WKT,e.PE_STR_FMT_WKT2=o.PeDefs.prototype.PE_STR_FMT_WKT2,e.PE_PARM_X0=o.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=o.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=o.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=o.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=o.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=o.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=o.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=o.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=o.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=o.PeDefs.prototype.PE_HORIZON_DELTA}}(u||(u={}));let h=null;var d;!function(e){const t={},i={},r=e=>{const t=e.getType();switch(t){case u.PE_TYPE_GEOGCS:e=o.castObject(e,o.PeGeogcs);break;case u.PE_TYPE_PROJCS:e=o.castObject(e,o.PeProjcs);break;case u.PE_TYPE_GEOGTRAN:e=o.castObject(e,o.PeGeogtran);break;default:t&u.PE_TYPE_UNIT&&(e=o.castObject(e,o.PeUnit))}return e};function n(e,i){let n=null,s=t[e];if(s||(s={},t[e]=s),s.hasOwnProperty(String(i))&&(n=s[i],o.compare(n,o.NULL)&&(n=null)),!n){const t=o.PeFactory.prototype.factoryByType(e,i);o.compare(t,o.NULL)||(n=r(t),s[i]=n)}return n}e.initialize=function(){o.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return n(u.PE_TYPE_COORDSYS,e)},e.factoryByType=n,e.fromString=function(e,t){let n=null,s=i[e];if(s||(s={},i[e]=s),s.hasOwnProperty(t)&&(n=s[t],o.compare(n,o.NULL)&&(n=null)),!n){const i=o.PeFactory.prototype.fromString(e,t);o.compare(i,o.NULL)||(n=r(i),s[t]=n)}return n},e.geogcs=function(e){return n(u.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return n(u.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return o.PeFactory.prototype.getCode(e)},e.projcs=function(e){return n(u.PE_TYPE_PROJCS,e)},e.unit=function(e){return n(u.PE_TYPE_UNIT,e)}}(d||(d={}));let p=null;var f,m,g,y,_,v,b,w,x,T,C;function S(e){function t(e,t,i){e[t]=i(e[t])}o=e,u.init(),f.init(),b.init(),x.init(),T.init(),h=class extends o.PeDouble{constructor(e=NaN){super(e)}destroy(){o.destroy(this)}[Symbol.dispose](){this.destroy()}},p=class extends o.PeGCSExtent{destroy(){o.destroy(this)}[Symbol.dispose](){this.destroy()}};const i=[o.PeAngunit,o.PeDatum,o.PeGeogcs,o.PeGeogtran,o.PeObject,o.PeParameter,o.PePrimem,o.PeProjcs,o.PeSpheroid,o.PeUnit];for(const e of i)t(e.prototype,"getName",(e=>function(){return e.call(this,new Array(u.PE_NAME_MAX))}));for(const e of[o.PeGeogtran,o.PeProjcs])t(e.prototype,"getParameters",(e=>function(){const t=new Array(u.PE_PARM_MAX);let i=e.call(this);for(let e=0;e<t.length;e++){const r=o.getValue(i,"*");t[e]=r?o.wrapPointer(r,o.PeParameter):null,i+=Int32Array.BYTES_PER_ELEMENT}return t}));t(o.PeHorizon.prototype,"getCoord",(e=>function(t=!1){const i=this.getSize();if(!i)return null;const r=[];return R(r,i,e.call(this),t),r})),t(o.PeGTlistExtendedEntry.prototype,"getEntries",(e=>{const t=o._pe_getPeGTlistExtendedGTsSize();return function(){let i=null;const r=e.call(this);if(!o.compare(r,o.NULL)){i=[r];const e=this.getSteps();if(e>1){const n=o.getPointer(r);for(let r=1;r<e;r++)i.push(o.wrapPointer(n+t*r,o.PeGTlistExtendedGTs))}}return i}}));const r=o._pe_getPeHorizonSize(),n=e=>function(){let t=this._cache;if(t||(t=new Map,this._cache=t),t.has(e))return t.get(e);let i=null;const n=e.call(this);if(!o.compare(n,o.NULL)){i=[n];const e=n.getNump();if(e>1){const t=o.getPointer(n);for(let n=1;n<e;n++)i.push(o.wrapPointer(t+r*n,o.PeHorizon))}}return t.set(e,i),i};t(o.PeProjcs.prototype,"horizonGcsGenerate",n),t(o.PeProjcs.prototype,"horizonPcsGenerate",n),o.PeObject.prototype.toString=function(e=u.PE_STR_OPTS_NONE){o.ensureCache.prepare();const t=o.getPointer(this),i=o.ensureInt8(new Array(u.PE_BUFFER_MAX));return o.UTF8ToString(o._pe_object_to_string_ext(t,e,i))},o.PeGeogcs.prototype.destroy=function(){this.Delete(),E(this),this.ptr=0},o.PeGeogcs.prototype[Symbol.dispose]=function(){this.destroy()},o.PeProjcs.prototype.destroy=function(){this.Delete(),E(this),this.ptr=0},o.PeProjcs.prototype[Symbol.dispose]=function(){this.destroy()}}function E(e){if(!e)return;const t=o.getClass(e);if(!t)return;const i=o.getCache(t);if(!i)return;const r=o.getPointer(e);r&&delete i[r]}function M(e,t){const i=[],r=new Array(t);for(let t=0;t<e;t++)i.push(o.ensureInt8(r));return i}function A(e){return ArrayBuffer.isView(e)?e:Array.isArray(e[0])?e.flat():e}function R(e,t,i,r=!1){if(r)for(let r=0;r<2*t;r++)e[r]=o.getValue(i+r*Float64Array.BYTES_PER_ELEMENT,"double");else{const r=0===e.length;for(let n=0;n<t;n++)r&&(e[n]=new Array(2)),e[n][0]=o.getValue(i,"double"),e[n][1]=o.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}!function(e){let t;e.init=function(){e.PE_GTLIST_OPTS_COMMON=o.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=o._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,i,r,n,s,a){let l=null;const c=new o.PeInteger(a);try{const u=o.PeGTlistExtended.prototype.getGTlist(e,i,r,n,s,c);if((a=c.val)&&(l=[u],a>1)){const e=o.getPointer(u);for(let i=1;i<a;i++)l.push(o.wrapPointer(e+t*i,o.PeGTlistExtendedEntry))}}finally{o.destroy(c)}return l}}(f||(f={})),function(e){e.destroy=function(e){if(e?.length){for(const t of e)E(t),t.getEntries().forEach((e=>{E(e);const t=e.getGeogtran();E(t),t.getParameters().forEach(E),[t.getGeogcs1(),t.getGeogcs2()].forEach((e=>{E(e);const t=e.getDatum();E(t),E(t.getSpheroid()),E(e.getPrimem()),E(e.getUnit())}))}));o.PeGTlistExtendedEntry.prototype.Delete(e[0])}}}(m||(m={})),function(e){e.geogToGeog=function(e,t,i,r,n){o.ensureCache.prepare();const s=A(i),a=i===s,l=o.ensureFloat64(s);let c=0;r&&(c=o.ensureFloat64(r));const u=o._pe_geog_to_geog(o.getPointer(e),t,l,c,n);return u&&R(i,t,l,a),u}}(g||(g={})),function(e){e.geodesicCoordinate=function(e,t,i,r,n,s,a,l){o.PeLineType.prototype.geodesic_coordinate(e,t,i,r,n,s,a,l)},e.geodeticCoordinate=function(e,t,i,r,n,s,a,l,c){o.PeLineType.prototype.geodetic_coordinate(e,t,i,r,n,s,a,l,c)},e.geodeticDistance=function(e,t,i,r,n,s,a,l,c,u){o.PeLineType.prototype.geodetic_distance(e,t,i,r,n,s,a,l,c,u)},e.greatEllipticDistance=function(e,t,i,r,n,s,a,l,c){o.PeLineType.prototype.great_elliptic_distance(e,t,i,r,n,s,a,l,c)}}(y||(y={})),function(e){e.phiToEta=function(e,t){return o.PeMath.prototype.phi_to_eta(e,t)},e.etaToPhi=function(e,t){return o.PeMath.prototype.eta_to_phi(e,t)},e.phiToPhig=function(e,t){return o.PeMath.prototype.phi_to_phig(e,t)},e.q=function(e,t,i){return o.PeMath.prototype.q(e,t,i)},e.q90=function(e,t){return o.PeMath.prototype.q90(e,t)}}(_||(_={})),function(e){const t=(e,t,i,r,n,s)=>{let a,l;switch(o.ensureCache.prepare(),e){case"dd":a=o._pe_geog_to_dd,l=u.PE_DD_MAX;break;case"ddm":a=o._pe_geog_to_ddm,l=u.PE_DDM_MAX;break;case"dms":a=o._pe_geog_to_dms,l=u.PE_DMS_MAX}let c=0;t&&(c=o.getPointer(t));const h=A(r),d=o.ensureFloat64(h),p=M(i,l),f=a(c,i,d,n,o.ensureInt32(p));if(f)for(let e=0;e<i;e++)s[e]=o.UTF8ToString(p[e]);return f},i=(e,t,i,r,n)=>{let s;switch(o.ensureCache.prepare(),e){case"dd":s=o._pe_dd_to_geog;break;case"ddm":s=o._pe_ddm_to_geog;break;case"dms":s=o._pe_dms_to_geog}let a=0;t&&(a=o.getPointer(t));const l=r.map((e=>o.ensureString(e))),c=o.ensureInt32(l),u=o.ensureFloat64(new Array(2*i)),h=s(a,i,c,u);return h&&R(n,i,u),h};e.geogToDms=function(e,i,r,n,s){return t("dms",e,i,r,n,s)},e.dmsToGeog=function(e,t,r,n){return i("dms",e,t,r,n)},e.geogToDdm=function(e,i,r,n,s){return t("ddm",e,i,r,n,s)},e.ddmToGeog=function(e,t,r,n){return i("ddm",e,t,r,n)},e.geogToDd=function(e,i,r,n,s){return t("dd",e,i,r,n,s)},e.ddToGeog=function(e,t,r,n){return i("dd",e,t,r,n)}}(v||(v={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=o.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=o.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=o.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=o.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=o.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geogToMgrsExtended=function(e,t,i,r,n,s,a){o.ensureCache.prepare();let l=0;e&&(l=o.getPointer(e));const c=A(i),h=o.ensureFloat64(c),d=M(t,u.PE_MGRS_MAX),p=o.ensureInt32(d),f=o._pe_geog_to_mgrs_extended(l,t,h,r,n,s,p);if(f)for(let e=0;e<t;e++)a[e]=o.UTF8ToString(d[e]);return f},e.mgrsToGeogExtended=function(e,t,i,r,n){o.ensureCache.prepare();let s=0;e&&(s=o.getPointer(e));const a=i.map((e=>o.ensureString(e))),l=o.ensureInt32(a),c=o.ensureFloat64(new Array(2*t)),u=o._pe_mgrs_to_geog_extended(s,t,l,r,c);return u&&R(n,t,c),u}}(b||(b={})),function(e){e.geogToUsng=function(e,t,i,r,n,s,a){o.ensureCache.prepare();let l=0;e&&(l=o.getPointer(e));const c=A(i),h=o.ensureFloat64(c),d=M(t,u.PE_MGRS_MAX),p=o.ensureInt32(d),f=o._pe_geog_to_usng(l,t,h,r,n,s,p);if(f)for(let e=0;e<t;e++)a[e]=o.UTF8ToString(d[e]);return f},e.usngToGeog=function(e,t,i,r){o.ensureCache.prepare();let n=0;e&&(n=o.getPointer(e));const s=i.map((e=>o.ensureString(e))),a=o.ensureInt32(s),l=o.ensureFloat64(new Array(2*t)),c=o._pe_usng_to_geog(n,t,a,l);return c&&R(r,t,l),c}}(w||(w={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=o.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=o.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=o.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geogToUtm=function(e,t,i,r,n){o.ensureCache.prepare();let s=0;e&&(s=o.getPointer(e));const a=A(i),l=o.ensureFloat64(a),c=M(t,u.PE_UTM_MAX),h=o.ensureInt32(c),d=o._pe_geog_to_utm(s,t,l,r,h);if(d)for(let e=0;e<t;e++)n[e]=o.UTF8ToString(c[e]);return d},e.utmToGeog=function(e,t,i,r,n){o.ensureCache.prepare();let s=0;e&&(s=o.getPointer(e));const a=i.map((e=>o.ensureString(e))),l=o.ensureInt32(a),c=o.ensureFloat64(new Array(2*t)),u=o._pe_utm_to_geog(s,t,l,r,c);return u&&R(n,t,c),u}}(x||(x={})),function(e){const t=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=o.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=o.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=o.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=o.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(i,r=e.PE_PCSINFO_OPTION_DOMAIN){let n=null,s=null;return t.has(i)&&(s=t.get(i),s[r]&&(n=s[r])),n||(n=o.PePCSInfo.prototype.generate(i,r),s||(s=[],t.set(i,s)),s[r]=n),n}}(T||(T={})),function(e){e.versionString=function(){return o.PeVersion.prototype.version_string()}}(C||(C={}));const O=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return c},get PeDefs(){return u},get PeDouble(){return h},get PeFactory(){return d},get PeGCSExtent(){return p},get PeGTTransformations(){return g},get PeGTlistExtended(){return f},get PeGTlistExtendedEntry(){return m},get PeLineType(){return y},get PeMath(){return _},get PeNotationDms(){return v},get PeNotationMgrs(){return b},get PeNotationUsng(){return w},get PeNotationUtm(){return x},get PePCSInfo(){return T},get PeVersion(){return C},_init:S,get _pe(){return o},isLoaded:a,isSupported:function(){return!!(0,n.Z)("esri-wasm")},load:l},Symbol.toStringTag,{value:"Module"}))},16641:(e,t,i)=>{i.d(t,{M:()=>_,a:()=>g,b:()=>v,e:()=>f,f:()=>o,i:()=>d,p:()=>p,r:()=>l,t:()=>a,w:()=>c});var r=i(88256),n=i(3466),s=i(71924);function o(e,t){const i=t?.url?.path;if(e&&i&&(e=(0,n.hF)(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const i=(0,n.PF)(e,t.portalItem.itemUrl);null!=i&&h.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return(e=m(e,t?.portal))&&u.test(e)?g(e):e}function a(e,t,i=_.YES){if(null==(e=e&&u.test(e)?y(e):e))return e;!(0,n.YP)(e)&&t?.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=(0,n.hF)(e);if(t){const i=t.verifyItemRelativeUrls?.rootPath||t.url?.path;if(i){const s=m(i,t.portal),o=m(r,t.portal);r=(0,n.PF)(o,s,s),null!=r&&r!==o&&r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=f(r,t?.portal),(0,n.YP)(r)&&(r=(0,n.Fv)(r)),t?.resources&&t?.portalItem&&!(0,n.YP)(r)&&!(0,n.HK)(r)&&i===_.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),r}function l(e,t,i){return o(e,i)}function c(e,t,i,r){const n=a(e,r);void 0!==n&&(t[i]=n)}const u=/\/items\/([^/]+)\/resources\/(.*)/,h=/^\.\/resources\//;function d(e){return(e?.match(u)??null)?.[1]??null}function p(e){const t=e?.match(u)??null;if(null==t)return null;const i=t[2],r=i.lastIndexOf("/");if(-1===r){const{path:e,extension:t}=(0,n.fZ)(i);return{prefix:null,filename:e,extension:t}}const{path:s,extension:o}=(0,n.fZ)(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:o}}function f(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?(0,n.Ie)(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function m(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=(0,n.TI)();return(0,n.D6)(r,`${r.scheme}://${i}`)?(0,n.Ie)(e,t.portalHostname,i):(0,n.Ie)(e,i,t.portalHostname)}function g(e){if(!e)return e||null;let t=e;return t&&r.id&&!r.id.findCredential(t)&&(t=(0,s.c_)(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}function y(e){if(!e)return e||null;let t=e;return t=t.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),t=t.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),t=t.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),t&&r.id&&!r.id.findCredential(t)&&(t=(0,s.c_)(t)),t}var _;!function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"}(_||(_={}));const v=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return _},ensureMainOnlineDomain:f,fromCDNUrl:y,fromJSON:o,itemIdFromResourceUrl:d,prefixAndFilenameFromResourceUrl:p,read:l,toCDNUrl:g,toJSON:a,write:c},Symbol.toStringTag,{value:"Module"}))},80657:(e,t,i)=>{function r(e,t,i,r,s){n(e,t,i||0,r||e.length-1,s||o)}function n(e,t,i,r,o){for(;r>i;){if(r-i>600){var a=r-i+1,l=t-i+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);n(e,t,Math.max(i,Math.floor(t-l*u/a+h)),Math.min(r,Math.floor(t+(a-l)*u/a+h)),o)}var d=e[t],p=i,f=r;for(s(e,i,t),o(e[r],d)>0&&s(e,i,r);p<f;){for(s(e,p,f),p++,f--;o(e[p],d)<0;)p++;for(;o(e[f],d)>0;)f--}0===o(e[i],d)?s(e,i,f):s(e,++f,r),f<=t&&(i=f+1),t<=f&&(r=f-1)}}function s(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function o(e,t){return e<t?-1:e>t?1:0}i.d(t,{q:()=>r})},39947:(e,t,i)=>{i.d(t,{r:()=>n});var r=i(80657);function n(e,t){if(!(this instanceof n))return new n(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}function s(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}function o(e,t){a(e,0,e.children.length,t,e)}function a(e,t,i,r,n){n||(n=y(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var s,o=t;o<i;o++)s=e.children[o],l(n,e.leaf?r(s):s);return n}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function f(e,t){var i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,n-i)*Math.max(0,s-r)}function m(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function y(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(e,t,i,n,s){for(var o,a=[t,i];a.length;)(i=a.pop())-(t=a.pop())<=n||(o=t+Math.ceil((i-t)/n/2)*n,(0,r.q)(e,o,t,i,s),a.push(t,o,o,i))}n.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,i=[],r=this.toBBox;if(!g(e,t))return i;for(var n,s,o,a,l=[];t;){for(n=0,s=t.children.length;n<s;n++)o=t.children[n],g(e,a=t.leaf?r(o):o)&&(t.leaf?i.push(o):m(e,a)?this._all(o,i):l.push(o));t=l.pop()}return i},collides:function(e){var t=this.data,i=this.toBBox;if(!g(e,t))return!1;for(var r,n,s,o,a=[];t;){for(r=0,n=t.children.length;r<n;r++)if(s=t.children[r],g(e,o=t.leaf?i(s):s)){if(t.leaf||m(e,o))return!0;a.push(s)}t=a.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(e){return null!=e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=y([]),this},remove:function(e,t){if(null==e)return this;for(var i,r,n,o,a=this.data,l=this.toBBox(e),c=[],u=[];a||c.length;){if(a||(a=c.pop(),r=c[c.length-1],i=u.pop(),o=!0),a.leaf&&-1!==(n=s(e,a.children,t)))return a.children.splice(n,1),c.push(a),this._condense(c),this;o||a.leaf||!m(a,l)?r?(i++,a=r.children[i],o=!1):a=null:(c.push(a),u.push(i),i=0,r=a,a=a.children[0])}return this},toBBox:function(e){return e},compareMinX:c,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},_build:function(e,t,i,r){var n,s=i-t+1,a=this._maxEntries;if(s<=a)return o(n=y(e.slice(t,i+1)),this.toBBox),n;r||(r=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,r-1))),(n=y([])).leaf=!1,n.height=r;var l,c,u,h,d=Math.ceil(s/a),p=d*Math.ceil(Math.sqrt(a));for(_(e,t,i,p,this.compareMinX),l=t;l<=i;l+=p)for(_(e,l,u=Math.min(l+p-1,i),d,this.compareMinY),c=l;c<=u;c+=d)h=Math.min(c+d-1,u),n.children.push(this._build(e,c,h,r-1));return o(n,this.toBBox),n},_chooseSubtree:function(e,t,i,r){for(var n,s,o,a,l,c,u,d;r.push(t),!t.leaf&&r.length-1!==i;){for(u=d=1/0,n=0,s=t.children.length;n<s;n++)l=h(o=t.children[n]),(c=p(e,o)-l)<d?(d=c,u=l<u?l:u,a=o):c===d&&l<u&&(u=l,a=o);t=a||t.children[0]}return t},_insert:function(e,t,i){var r=this.toBBox,n=i?e:r(e),s=[],o=this._chooseSubtree(n,this.data,t,s);for(o.children.push(e),l(o,n);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(n,s,t)},_split:function(e,t){var i=e[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var s=this._chooseSplitIndex(i,n,r),a=y(i.children.splice(s,i.children.length-s));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},_splitRoot:function(e,t){this.data=y([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,i){var r,n,s,o,l,c,u,d;for(c=u=1/0,r=t;r<=i-t;r++)o=f(n=a(e,0,r,this.toBBox),s=a(e,r,i,this.toBBox)),l=h(n)+h(s),o<c?(c=o,d=r,u=l<u?l:u):o===c&&l<u&&(u=l,d=r);return d},_chooseSplitAxis:function(e,t,i){var r=e.leaf?this.compareMinX:c,n=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)},_allDistMargin:function(e,t,i,r){e.children.sort(r);var n,s,o=this.toBBox,c=a(e,0,t,o),u=a(e,i-t,i,o),h=d(c)+d(u);for(n=t;n<i-t;n++)s=e.children[n],l(c,e.leaf?o(s):s),h+=d(c);for(n=i-t-1;n>=t;n--)s=e.children[n],l(u,e.leaf?o(s):s),h+=d(u);return h},_adjustParentBBoxes:function(e,t,i){for(var r=i;r>=0;r--)l(t[r],e)},_condense:function(e){for(var t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():o(e[i],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},73687:(e,t,i)=>{i.d(t,{N:()=>m,a:()=>C,b:()=>x,c:()=>g,d:()=>L,e:()=>v,f:()=>S,g:()=>T,h:()=>N,i:()=>P,j:()=>E,k:()=>I,l:()=>b,m:()=>y,n:()=>M,o:()=>B,p:()=>D,s:()=>j,t:()=>G,u:()=>V,w:()=>w});i(39994),i(13802);var r=i(19431),n=i(32114),s=i(86717),o=i(81095),a=i(56999),l=i(52721),c=i(40201),u=i(19546),h=i(97537);function d(e,t){const i=(0,s.l)(e),n=(0,r.Kt)(e[2]/i),o=Math.atan2(e[1]/i,e[0]/i);return(0,s.i)(t,i,n,o),t}var p=i(5700),f=i(68817);const m=g();function g(){return(0,l.Ue)()}const y=a.e,_=a.e;function v(e,t){return(0,a.c)(t,e)}function b(e,t){return(0,l.al)(e[0],e[1],e[2],t)}function w(e){return e}function x(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function T(e){return e[3]}function C(e){return e}function S(e,t,i,r){return(0,l.al)(e,t,i,r)}function E(e,t,i){if(null==t)return!1;if(!R(e,t,A))return!1;let{t0:r,t1:n}=A;if((r<0||n<r&&n>0)&&(r=n),r<0)return!1;if(i){const{origin:e,direction:n}=t;i[0]=e[0]+n[0]*r,i[1]=e[1]+n[1]*r,i[2]=e[2]+n[2]*r}return!0}function M(e,t,i){const r=(0,h.zk)(t,i);if(!R(e,r,A))return[];const{origin:n,direction:a}=r,{t0:l,t1:u}=A,d=t=>{const i=(0,o.Ue)();return(0,s.b)(i,n,a,t),D(e,i,i)};return Math.abs(l-u)<(0,c.bn)()?[d(l)]:[d(l),d(u)]}const A={t0:0,t1:0};function R(e,t,i){const{origin:r,direction:n}=t,s=O;s[0]=r[0]-e[0],s[1]=r[1]-e[1],s[2]=r[2]-e[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(0===o)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const O=(0,o.Ue)();function P(e,t){return E(e,t,null)}function I(e,t,i){const r=f.WM.get(),o=f.MP.get();(0,s.e)(r,t.origin,t.direction);const a=T(e);(0,s.e)(i,r,t.origin),(0,s.h)(i,i,1/(0,s.l)(i)*a);const l=F(e,t.origin),c=(0,p.EU)(t.origin,i);return(0,n.Us)(o,c+l,r),(0,s.t)(i,i,o),i}function L(e,t,i,r){const n=T(e),s=n*n,o=t+.5*Math.PI,a=i*i+s-2*Math.cos(o)*i*n,l=Math.sqrt(a),c=a-s;if(c<=0)return.5;const u=Math.sqrt(c),h=Math.acos(u/l)-Math.asin(n/(l/Math.sin(o)));return Math.min(1,(h+.5*r)/r)}function D(e,t,i){const r=(0,s.d)(f.WM.get(),t,e),n=(0,s.h)(f.WM.get(),r,e[3]/(0,s.l)(r));return(0,s.g)(i,n,e)}function N(e,t){const i=(0,s.d)(f.WM.get(),t,e),r=(0,s.k)(i),n=e[3]*e[3];return Math.sqrt(Math.abs(r-n))}function F(e,t){const i=(0,s.d)(f.WM.get(),t,e),n=(0,s.l)(i),o=T(e),a=o+Math.abs(o-n);return(0,r.ZF)(o/a)}const U=(0,o.Ue)();function k(e,t,i,r){const n=(0,s.d)(U,t,e);switch(i){case u.R.X:{const e=d(n,U)[2];return(0,s.i)(r,-Math.sin(e),Math.cos(e),0)}case u.R.Y:{const e=d(n,U),t=e[1],i=e[2],o=Math.sin(t);return(0,s.i)(r,-o*Math.cos(i),-o*Math.sin(i),Math.cos(t))}case u.R.Z:return(0,s.n)(r,n);default:return}}function z(e,t){const i=(0,s.d)(H,t,e);return(0,s.l)(i)-e[3]}function B(e,t){const i=(0,s.s)(e,t),r=T(e);return i<=r*r}function V(e,t,i=(0,l.Ue)()){const r=(0,s.j)(e,t),n=e[3],o=t[3];return r+o<n?((0,a.c)(i,e),i):r+n<o?((0,a.c)(i,t),i):((0,s.m)(i,e,t,(r+o-n)/(2*r)),i[3]=(r+n+o)/2,i)}const H=(0,o.Ue)(),G=g(),j=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:m,altitudeAt:z,angleToSilhouette:F,axisAt:k,cameraFrustumCoverage:L,clear:function(e){e[0]=e[1]=e[2]=e[3]=0},closestPoint:function(e,t,i){return E(e,t,i)?i:((0,h.JI)(t,e,i),D(e,i,i))},closestPointOnSilhouette:I,containsPoint:B,copy:v,create:g,distanceToSilhouette:N,elevate:function(e,t,i){return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),i[3]=e[3]+t,i},equals:_,exactEquals:y,fromCenterAndRadius:b,fromRadius:x,fromValues:S,getCenter:C,getExtent:function(e,t){return t},getRadius:T,intersectLine:M,intersectRay:E,intersectRayClosestSilhouette:function(e,t,i){if(E(e,t,i))return i;const r=I(e,t,f.WM.get());return(0,s.g)(i,t.origin,(0,s.h)(f.WM.get(),t.direction,(0,s.j)(t.origin,r)/(0,s.l)(t.direction))),i},intersectsRay:P,projectPoint:D,setAltitudeAt:function(e,t,i,r){const n=z(e,t),o=k(e,t,u.R.Z,H),a=(0,s.h)(H,o,i-n);return(0,s.g)(r,t,a)},setExtent:function(e,t,i){return e!==i&&v(e,i),i},tmpSphere:G,union:V,wrap:w},Symbol.toStringTag,{value:"Module"}))},36663:(e,t,i)=>{function r(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}function n(e,t){return function(i,r){t(i,r,e)}}function s(e,t,i,r){function n(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):n(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())}))}function o(e,t,i){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var r,n;if(i){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],i&&(n=r)}if("function"!=typeof r)throw new TypeError("Object not disposable.");n&&(r=function(){try{n.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:i})}else i&&e.stack.push({async:!0});return t}i.d(t,{_:()=>r,a:()=>n,b:()=>o,c:()=>l,d:()=>s});var a="function"==typeof SuppressedError?SuppressedError:function(e,t,i){var r=new Error(i);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function l(e){function t(t){e.error=e.hasError?new a(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var i,r=0;return function n(){for(;i=e.stack.pop();)try{if(!i.async&&1===r)return r=0,e.stack.push(i),Promise.resolve().then(n);if(i.dispose){var s=i.dispose.call(i.value);if(i.async)return r|=2,Promise.resolve(s).then(n,(function(e){return t(e),n()}))}else r|=1}catch(e){t(e)}if(1===r)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}},6766:(e,t,i)=>{i.d(t,{a:()=>h,b:()=>a,c:()=>o,d:()=>n,e:()=>d,f:()=>u,l:()=>c,n:()=>p,t:()=>s});var r=i(86875);i(39994),i(13802);function n(e,t,i){s(e.typedBuffer,t.typedBuffer,i,e.typedBufferStride,t.typedBufferStride)}function s(e,t,i,r=3,n=r){if(e.length/r!==Math.ceil(t.length/n))return e;const s=e.length/r,o=i[0],a=i[1],l=i[2],c=i[4],u=i[5],h=i[6],d=i[8],p=i[9],f=i[10],m=i[12],g=i[13],y=i[14];let _=0,v=0;for(let i=0;i<s;i++){const i=t[_],s=t[_+1],b=t[_+2];e[v]=o*i+c*s+d*b+m,e[v+1]=a*i+u*s+p*b+g,e[v+2]=l*i+h*s+f*b+y,_+=n,v+=r}return e}function o(e,t,i){a(e.typedBuffer,t.typedBuffer,i,e.typedBufferStride,t.typedBufferStride)}function a(e,t,i,r=3,n=r){if(e.length/r!==Math.ceil(t.length/n))return;const s=e.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],h=i[5],d=i[6],p=i[7],f=i[8];let m=0,g=0;for(let i=0;i<s;i++){const i=t[m],s=t[m+1],y=t[m+2];e[g]=o*i+c*s+d*y,e[g+1]=a*i+u*s+p*y,e[g+2]=l*i+h*s+f*y,m+=n,g+=r}}function l(e,t,i,r=3,n=r){const s=Math.min(e.length/r,t.length/n);let o=0,a=0;for(let l=0;l<s;l++)e[a]=i*t[o],e[a+1]=i*t[o+1],e[a+2]=i*t[o+2],o+=n,a+=r;return e}function c(e,t,i,r){u(e.typedBuffer,t.typedBuffer,i,r,e.typedBufferStride,t.typedBufferStride)}function u(e,t,i,n,s=3,o=s){const a=Math.min(e.length/s,t.length/o);let l=0,c=0;const u=1/r.jm;for(let r=0;r<a;r++)e[c]=n*(i*t[l])**u,e[c+1]=n*(i*t[l+1])**u,e[c+2]=n*(i*t[l+2])**u,l+=o,c+=s}function h(e,t,i,r=3,n=r){const s=e.length/r;if(s!==Math.ceil(t.length/n))return e;let o=0,a=0;for(let l=0;l<s;l++)e[a]=t[o]+i[0],e[a+1]=t[o+1]+i[1],e[a+2]=t[o+2]+i[2],o+=n,a+=r;return e}function d(e,t){p(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function p(e,t,i=3,r=i){const n=Math.min(e.length/i,t.length/r);let s=0,o=0;for(let a=0;a<n;a++){const n=t[s],a=t[s+1],l=t[s+2],c=n*n+a*a+l*l;if(c>0){const t=1/Math.sqrt(c);e[o]=t*n,e[o+1]=t*a,e[o+2]=t*l}s+=r,o+=i}}Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:u,linearToSRGBView:c,normalize:p,normalizeView:d,scale:l,scaleView:function(e,t,i){l(e.typedBuffer,t.typedBuffer,i,e.typedBufferStride,t.typedBufferStride)},shiftRight:function(e,t,i){const r=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;let l=0,c=0;for(let e=0;e<r;e++)n[c]=o[l]>>i,n[c+1]=o[l+1]>>i,n[c+2]=o[l+2]>>i,l+=a,c+=s},transformMat3:a,transformMat3View:o,transformMat4:s,transformMat4View:n,translate:h},Symbol.toStringTag,{value:"Module"}))},86717:(e,t,i)=>{i.d(t,{A:()=>m,B:()=>f,C:()=>u,D:()=>g,E:()=>h,F:()=>y,G:()=>H,H:()=>j,I:()=>U,J:()=>q,K:()=>d,L:()=>I,a:()=>z,b:()=>v,c:()=>o,d:()=>c,e:()=>M,f:()=>E,g:()=>l,h:()=>_,i:()=>a,j:()=>b,k:()=>x,l:()=>s,m:()=>A,n:()=>S,o:()=>k,p:()=>F,q:()=>O,r:()=>L,s:()=>w,t:()=>R,u:()=>C,v:()=>T,w:()=>P,x:()=>p,y:()=>G,z:()=>Z});var r=i(81095),n=i(40201);function s(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function l(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function c(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function u(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function h(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function d(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function p(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function f(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function m(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function g(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function y(e,t=0,i=1){return e[0]=Math.min(Math.max(e[0],t),i),e[1]=Math.min(Math.max(e[1],t),i),e[2]=Math.min(Math.max(e[2],t),i),e}function _(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function v(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function b(e,t){const i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)}function w(e,t){const i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n}function x(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function T(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function C(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function S(e,t){const i=t[0],r=t[1],n=t[2];let s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function E(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function M(e,t,i){const r=t[0],n=t[1],s=t[2],o=i[0],a=i[1],l=i[2];return e[0]=n*l-s*a,e[1]=s*o-r*l,e[2]=r*a-n*o,e}function A(e,t,i,r){const n=t[0],s=t[1],o=t[2];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e[2]=o+r*(i[2]-o),e}function R(e,t,i){const r=t[0],n=t[1],s=t[2];return e[0]=i[0]*r+i[4]*n+i[8]*s+i[12],e[1]=i[1]*r+i[5]*n+i[9]*s+i[13],e[2]=i[2]*r+i[6]*n+i[10]*s+i[14],e}function O(e,t,i){const r=t[0],n=t[1],s=t[2];return e[0]=r*i[0]+n*i[3]+s*i[6],e[1]=r*i[1]+n*i[4]+s*i[7],e[2]=r*i[2]+n*i[5]+s*i[8],e}function P(e,t,i){const r=i[0],n=i[1],s=i[2],o=i[3],a=t[0],l=t[1],c=t[2],u=n*c-s*l,h=s*a-r*c,d=r*l-n*a,p=n*d-s*h,f=s*u-r*d,m=r*h-n*u,g=2*o;return e[0]=a+u*g+2*p,e[1]=l+h*g+2*f,e[2]=c+d*g+2*m,e}function I(e,t,i,r){const n=[],s=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function L(e,t){S(D,e),S(N,t);const i=E(D,N);return i>1?0:i<-1?Math.PI:Math.acos(i)}const D=(0,r.Ue)(),N=(0,r.Ue)();function F(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function U(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],o=t[0],a=t[1],l=t[2],c=(0,n.bn)();return Math.abs(i-o)<=c*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=c*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=c*Math.max(1,Math.abs(s),Math.abs(l))}function k(e,t,i){const r=i[0]-t[0],n=i[1]-t[1],s=i[2]-t[2];let o=r*r+n*n+s*s;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=n*o,e[2]=s*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const z=c,B=u,V=h,H=b,G=w,j=s,Z=x,q=Object.freeze(Object.defineProperty({__proto__:null,abs:p,add:l,angle:L,bezier:function(e,t,i,r,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,h=3*l*o,d=l*s;return e[0]=t[0]*c+i[0]*u+r[0]*h+n[0]*d,e[1]=t[1]*c+i[1]*u+r[1]*h+n[1]*d,e[2]=t[2]*c+i[2]*u+r[2]*h+n[2]*d,e},ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},clamp:y,copy:o,cross:M,crossAndNormalize:function(e,t,i){const r=t[0],n=t[1],s=t[2],o=i[0],a=i[1],l=i[2],c=n*l-s*a,u=s*o-r*l,h=r*a-n*o,d=Math.sqrt(c*c+u*u+h*h);return e[0]=c/d,e[1]=u/d,e[2]=h/d,e},direction:k,dist:H,distance:b,div:V,divide:h,dot:E,equals:U,exactEquals:F,floor:d,hermite:function(e,t,i,r,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return e[0]=t[0]*a+i[0]*l+r[0]*c+n[0]*u,e[1]=t[1]*a+i[1]*l+r[1]*c+n[1]*u,e[2]=t[2]*a+i[2]*l+r[2]*c+n[2]*u,e},inverse:C,len:j,length:s,lerp:A,max:g,min:m,mul:B,multiply:u,negate:T,normalize:S,random:function(e,t=1){const i=n.FD,r=2*i()*Math.PI,s=2*i()-1,o=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(r)*o,e[1]=Math.sin(r)*o,e[2]=s*t,e},rotateX:function(e,t,i,r){const n=[],s=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e},rotateY:function(e,t,i,r){const n=[],s=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e},rotateZ:I,round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:_,scaleAndAdd:v,set:a,sign:f,sqrDist:G,sqrLen:Z,squaredDistance:w,squaredLength:x,str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},sub:z,subtract:c,transformMat3:O,transformMat4:R,transformQuat:P},Symbol.toStringTag,{value:"Module"}))},14789:(e,t,i)=>{function r(e,t,i=3,r=i){const n=t.length/r;let s=0,o=0;for(let a=0;a<n;++a)e[s]=t[o],e[s+1]=t[o+1],e[s+2]=t[o+2],s+=i,o+=r}function n(e,t,i,r,n){const s=e.typedBuffer,o=e.typedBufferStride,a=n?.count??e.count;let l=(n?.dstIndex??0)*o;for(let e=0;e<a;++e)s[l]=t,s[l+1]=i,s[l+2]=r,l+=o}i.d(t,{c:()=>r,f:()=>n});Object.freeze(Object.defineProperty({__proto__:null,copy:r,copyView:function(e,t){r(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)},fill:n},Symbol.toStringTag,{value:"Module"}))},56999:(e,t,i)=>{i.d(t,{a:()=>b,b:()=>h,c:()=>n,d:()=>p,e:()=>w,f:()=>m,g:()=>a,h:()=>y,i:()=>s,j:()=>f,l:()=>_,n:()=>g,s:()=>o,t:()=>v,v:()=>R});var r=i(40201);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function o(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e}function a(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function l(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function c(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function u(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function h(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function d(e,t){const i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(i*i+r*r+n*n+s*s)}function p(e,t){const i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return i*i+r*r+n*n+s*s}function f(e){const t=e[0],i=e[1],r=e[2],n=e[3];return Math.sqrt(t*t+i*i+r*r+n*n)}function m(e){const t=e[0],i=e[1],r=e[2],n=e[3];return t*t+i*i+r*r+n*n}function g(e,t){const i=t[0],r=t[1],n=t[2],s=t[3];let o=i*i+r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=s*o),e}function y(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function _(e,t,i,r){const n=t[0],s=t[1],o=t[2],a=t[3];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function v(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*o,e[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*o,e[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*o,e[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*o,e}function b(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function w(e,t){const i=e[0],n=e[1],s=e[2],o=e[3],a=t[0],l=t[1],c=t[2],u=t[3],h=(0,r.bn)();return Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=h*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=h*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(o-u)<=h*Math.max(1,Math.abs(o),Math.abs(u))}const x=l,T=c,C=u,S=d,E=p,M=f,A=m,R=Object.freeze(Object.defineProperty({__proto__:null,add:a,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},copy:n,copyVec3:s,dist:S,distance:d,div:C,divide:u,dot:y,equals:w,exactEquals:b,floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},len:M,length:f,lerp:_,max:function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},min:function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},mul:T,multiply:c,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},normalize:g,random:function(e,t=1){const i=r.FD;let n,s,o,a,l,c;do{n=2*i()-1,s=2*i()-1,l=n*n+s*s}while(l>=1);do{o=2*i()-1,a=2*i()-1,c=o*o+a*a}while(c>=1);const u=Math.sqrt((1-l)/c);return e[0]=t*n,e[1]=t*s,e[2]=t*o*u,e[3]=t*a*u,e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:h,scaleAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},set:o,sqrDist:E,sqrLen:A,squaredDistance:p,squaredLength:m,str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},sub:x,subtract:l,transformMat4:v,transformQuat:function(e,t,i){const r=t[0],n=t[1],s=t[2],o=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*s-l*n,h=c*n+l*r-o*s,d=c*s+o*n-a*r,p=-o*r-a*n-l*s;return e[0]=u*c+p*-o+h*-l-d*-a,e[1]=h*c+p*-a+d*-o-u*-l,e[2]=d*c+p*-l+u*-a-h*-o,e[3]=t[3],e}},Symbol.toStringTag,{value:"Module"}))},86875:(e,t,i)=>{i.d(t,{B7:()=>l,St:()=>n,VL:()=>o,h$:()=>s,jm:()=>u,rW:()=>c});const r={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function n(e){return!!r[e]||!!r[e.toLowerCase()]}function s(e){return r[e]??r[e.toLowerCase()]}function o(e){return[...s(e)]}function a(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function l(e,t,i,r=1){const n=(e%360+360)%360/360,s=i<=.5?i*(t+1):i+t-i*t,o=2*i-s;return[Math.round(255*a(o,s,n+1/3)),Math.round(255*a(o,s,n)),Math.round(255*a(o,s,n-1/3)),r]}function c(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,n=t?1:17,s=t?9===e.length:5===e.length;let o=Number("0x"+e.slice(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&r,o>>=i,a[3]=n*l/255),l=o&r,o>>=i,a[2]=n*l,l=o&r,o>>=i,a[1]=n*l,l=o&r,o>>=i,a[0]=n*l,a}const u=2.2},51366:(e,t,i)=>{i.d(t,{Z:()=>n});i(39994);var r=i(86745);const n={apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:62e3,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&((0,r.RH)(n,globalThis.esriConfig,!0),delete n.has),!n.assetsPath){{const e="4.32";n.assetsPath=`https://js.arcgis.com/${e}/@arcgis/core/assets`}n.defaultAssetsPath=n.assetsPath}},74396:(e,t,i)=>{i.d(t,{Z:()=>F});var r=i(59801),n=i(44584),s=i(13802),o=i(61681),a=i(91421),l=i(51777),c=i(66175),u=i(41610),h=(i(39994),i(67134)),d=i(34596),p=i(49210),f=i(65943),m=i(55860),g=i(38488),y=i(63541);class _ extends p.s{constructor(e,t){super(),this.propertyName=e,this.metadata=t,this.trackingTarget=new y.P(this),this.flags=0,this.flags=g.v.Dirty|(t.nonNullable?g.v.NonNullable:0)|(t.hasOwnProperty("value")?g.v.HasDefaultValue:0)|(void 0===t.get?g.v.DepTrackingInitialized:0)|(void 0===t.dependsOn?g.v.AutoTracked:0)}destroy(){this.flags&g.v.Dirty&&this.onCommitted(),super.destroy(),this.trackingTarget.destroy()}getComputed(e){e.mutable&&(0,m.it)(this);const t=e.store,i=this.propertyName,r=this.flags,n=t.get(i);if(r&g.v.Computing)return n;if(~r&g.v.Dirty&&t.has(i))return n;this.flags|=g.v.Computing;const s=e.host;let o;r&g.v.AutoTracked?o=(0,m.LJ)(this.trackingTarget,this.metadata.get,s):((0,m.GF)(s,this),o=this.metadata.get.call(s)),this.flags|=g.v.DepTrackingInitialized,t.set(i,o,f.s3.COMPUTED);const a=t.get(i);return a===n?this.flags&=~g.v.Dirty:(0,m.gb)(this.commit,this),this.flags&=~g.v.Computing,a}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~g.v.Dirty,this.onCommitted()}onInvalidated(){~this.flags&g.v.Overridden&&(this.flags|=g.v.Dirty);const e=this._observers;if(e&&e.length>0)for(const t of e)t.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const t=e.slice();for(const e of t)e.onCommitted()}}}class v{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const t=new v;return this._values.forEach(((i,r)=>{e&&e.has(r)||t.set(r,(0,h.d9)(i))})),t}get(e){return this._values.get(e)}originOf(){return f.s3.USER}keys(){return[...this._values.keys()]}set(e,t){this._values.set(e,t)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}}function b(e,t,i){return void 0!==e}function w(e,t,i,r){return!(void 0===e||null==i&&e.flags&g.v.NonNullable&&(r.lifecycle,c.F.INITIALIZING,1))}class x{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=c.F.INITIALIZING,this.store=new v,this.mutable=!0,this._origin=f.s3.USER;const t=this.host.constructor.__accessorMetadata__;for(const e in t){const i=new _(e,t[e]);this.propertiesByName.set(e,i)}this.metadata=t}initialize(){this.lifecycle=c.F.CONSTRUCTING}constructed(){this.lifecycle=c.F.CONSTRUCTED}destroy(){this.lifecycle=c.F.DESTROYED,this.propertiesByName.forEach((e=>e.destroy()))}get initialized(){return this.lifecycle!==c.F.INITIALIZING}get(e){const t=this.propertiesByName.get(e);if(t.metadata.get)return t.getComputed(this);this.mutable&&(0,m.it)(t);const i=this.store;return i.has(e)?i.get(e):t.metadata.value}originOf(e){const t=this.store.originOf(e);if(void 0===t){const t=this.propertiesByName.get(e);if(void 0!==t&&t.flags&g.v.HasDefaultValue)return"defaults"}return(0,f.x3)(t)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const t=this.propertiesByName.get(e);if(b(t))return this.store.has(e)?this.store.get(e):t.metadata.value}internalSet(e,t){const i=this.propertiesByName.get(e);b(i)&&this._internalSet(i,t)}getDependsInfo(e,t,i){const r=this.propertiesByName.get(t);if(!b(r))return"";const n=new y.P,s=(0,m.LJ)(n,(()=>r.metadata.get?.call(e)));let o=`${i}${e.declaredClass.split(".").pop()}.${t}: ${s}\n`;const a=n.accessed??new Set;if(0===a.size)return o;i+="  ";for(const e of a)e instanceof _&&(o+=`${i}${e.propertyName}: undefined\n`);return o}setAtOrigin(e,t,i){const r=this.propertiesByName.get(e);if(b(r))return this._setAtOrigin(r,t,i)}isOverridden(e){const t=this.propertiesByName.get(e);return void 0!==t&&!!(t.flags&g.v.Overridden)}clearOverride(e){const t=this.propertiesByName.get(e);t&&t.flags&g.v.Overridden&&(t.flags&=~g.v.Overridden,t.notifyChange())}override(e,t){const i=this.propertiesByName.get(e);if(!w(i,0,t,this))return;const r=i.metadata.cast;if(r){const e=this._cast(r,t),{valid:i,value:n}=e;if(T.release(e),!i)return;t=n}i.flags|=g.v.Overridden,this._internalSet(i,t)}set(e,t){const i=this.propertiesByName.get(e);if(!w(i,0,t,this))return;const r=i.metadata.cast;if(r){const e=this._cast(r,t),{valid:i,value:n}=e;if(T.release(e),!i)return;t=n}const n=i.metadata.set;n?n.call(this.host,t):this._internalSet(i,t)}setDefaultOrigin(e){this._origin=(0,f.M9)(e)}getDefaultOrigin(){return(0,f.x3)(this._origin)}notifyChange(e){const t=this.propertiesByName.get(e);void 0!==t&&t.notifyChange()}invalidate(e){const t=this.propertiesByName.get(e);void 0!==t&&t.invalidate()}commit(e){const t=this.propertiesByName.get(e);void 0!==t&&t.commit()}_internalSet(e,t){const i=this.lifecycle!==c.F.INITIALIZING?this._origin:f.s3.DEFAULTS;this._setAtOrigin(e,t,i)}_setAtOrigin(e,t,i){const r=this.store,n=e.propertyName;r.has(n,i)&&(0,h.fS)(t,r.get(n))&&~e.flags&g.v.Overridden&&i===r.originOf(n)||(e.invalidate(),r.set(n,t,i),e.commit(),(0,m.mS)(this.host,e))}_cast(e,t){const i=T.acquire();return i.valid=!0,i.value=t,e&&(i.value=e.call(this.host,t,i)),i}}const T=new d.Z(class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}});var C=i(33156);let S;function E(){return S}var M;!function(e){e[e.Ignore=0]="Ignore",e[e.Destroy=1]="Destroy",e[e.ThrowError=2]="ThrowError"}(M||(M={}));var A,R,O=i(81509),P=i(81977),I=i(40266);function L(e){if(null==e)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return e.constructor?.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const D=Symbol("Accessor-Handles"),N=Symbol("Accessor-Initialized");class F{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:t,declaredClass:i,constructor:r}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class s extends n{constructor(...e){super(...e),this.inherited=null,r&&r.apply(this,e)}}(0,u.fp)(s.prototype);for(const t in e){const i=e[t];s.prototype[t]="function"==typeof i?function(...e){const r=this.inherited;let s;this.inherited=function(...e){if(n.prototype[t])return n.prototype[t].apply(this,e)};try{s=i.apply(this,e)}catch(e){throw this.inherited=r,e}return this.inherited=r,s}:e[t]}for(const e in t){const i=L(t[e]);(0,P.Cb)(i)(s.prototype,e)}return(0,I.j)(i)(s)}static freeze(e){return e instanceof F?e.__accessor__.mutable=!1:Object.freeze(e),e}static isFrozen(e){return e instanceof F?!e.__accessor__.mutable:Object.isFrozen(e)}constructor(...e){if(this[A]=null,this[R]=!1,this.constructor===F)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const t=new x(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:t}),e.length>0&&(t.ctorArgs=this.normalizeCtorArgs?.apply(this,e)??e[0]),E()?.onInstanceConstruct(this)}postscript(){const e=this.__accessor__,t=e.ctorArgs;e.initialize(),t&&(this.set(t),e.ctorArgs=null),e.constructed(),this.initialize(),this[N]=!0}initialize(){}[a.l](){this[D]=(0,o.SC)(this[D])}destroy(){this.destroyed||((0,O.BT)(this),this.__accessor__.destroy(),E()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[N]}get destroyed(){return this.__accessor__?.lifecycle===c.F.DESTROYED||!1}commitProperty(e){(0,l.U2)(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,t){return(0,C.t)(this,e,t),this}watch(e,t,i){return(0,r.XV)(s.Z.getLogger(this),"`watch` is deprecated in favor of reactiveUtils.watch",{replacement:"reactiveUtils.watch",version:"4.32",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-core-reactiveUtils.html#watch",warnOnce:!0}),(0,O.YP)(this,e,t,i)}addHandles(e,t){if(this.destroyed){const t=Array.isArray(e)?e:[e];for(const e of t)e.remove()}else(this[D]??=new n.Z).add(e,t)}removeHandles(e){this[D]?.remove(e)}removeAllHandles(){this[D]?.removeAll()}removeHandlesReference(e){this[D]?.removeReference(e)}hasHandles(e){return!0===this[D]?.has(e)}_override(e,t){void 0===t?this.__accessor__.clearOverride(e):this.__accessor__.override(e,t)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,t){null==t?this.__accessor__.clearOverride(e):this.__accessor__.override(e,t)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,t){return this.__accessor__.internalSet(e,t),this}}A=D,R=N},50904:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(34596);function n(e){e.length=0}class s{constructor(e=50,t=50){this._pool=new r.Z(Array,void 0,n,t,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return o.acquire()}static release(e){return o.release(e)}static prune(){o.prune()}}const o=new s(100)},25015:(e,t,i)=>{var r;i.d(t,{Y:()=>r}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(r||(r={}))},41151:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(36663),n=i(74396),s=(i(39994),i(67134)),o=(i(13802),i(61681)),a=i(65943),l=i(95620),c=i(40266);const u=e=>{let t=class extends e{clone(){const e=(0,l.vw)(this);(0,o.O3)(e,"unable to clone instance of non-accessor class");const t=e.metadata,i=e.store,r={},n=new Map;for(const e in t){const o=t[e],l=i?.originOf(e),c=o.clonable;if(o.readOnly||!1===c||l!==a.s3.USER&&l!==a.s3.DEFAULTS&&l!==a.s3.WEB_MAP&&l!==a.s3.WEB_SCENE)continue;const u=this[e];let h=null;h="function"==typeof c?c(u):"reference"===c?u:(0,s.Vo)(u),null!=u&&null==h||(l===a.s3.DEFAULTS?n.set(e,h):r[e]=h)}const c=new(0,Object.getPrototypeOf(this).constructor)(r);if(n.size){const e=(0,l.vw)(c)?.store;if(e)for(const[t,i]of n)e.set(t,i,a.s3.DEFAULTS)}return c}};return t=(0,r._)([(0,c.j)("esri.core.Clonable")],t),t};let h=class extends(u(n.Z)){};h=(0,r._)([(0,c.j)("esri.core.Clonable")],h),function(e){e.ClonableMixin=u}(h||(h={}));const d=h},41831:(e,t,i)=>{i.d(t,{Z:()=>P});var r,n=i(36663),s=i(50904),o=i(31355),a=i(23148),l=i(67134),c=i(34596),u=i(98722),h=i(17262),d=i(7283),p=i(55860),f=i(81977),m=i(2107),g=i(40266),y=i(26096);class _{constructor(e,t,i,r,n){this.target=e,this.added=t,this.removed=i,this.start=r,this.deleteCount=n}}const v=new c.Z(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},void 0,(e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}));function b(e){e&&"object"==typeof e&&"destroy"in e&&"function"==typeof e.destroy&&e.destroy()}function w(e){return e?e instanceof O?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function x(e){if(e?.length)return e[0]}function T(e,t,i,r){const n=Math.min(e.length-i,t.length-r);let s=0;for(;s<n&&e[i+s]===t[r+s];)s++;return s}function C(e,t,i,r){t&&t.forEach(((t,n,s)=>{e.push(t),C(e,i.call(r,t,n,s),i,r)}))}const S=new Set,E=new Set,M=new Set,A=new Map;let R=0,O=r=class extends o.Z.EventedAccessor{static isCollection(e){return null!=e&&e instanceof r}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new y.s,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:R++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof r?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return(0,p.it)(this._observable),this._items}set items(e){this._emitBeforeChanges(u.y.ADD)||(this._splice(0,this.length,w(e)),this._emitAfterChanges(u.y.ADD))}hasEventListener(e){return!this.destroyed&&("change"===e?this._chgListeners.length>0:this._emitter.hasEventListener(e))}on(e,t){if(this.destroyed)return(0,a.kB)();if("change"===e){const e=this._chgListeners,i={removed:!1,callback:t};return e.push(i),this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]}),(0,a.kB)((()=>{i.removed=!0,e.splice(e.indexOf(i),1)}))}return this._emitter.on(e,t)}once(e,t){const i="deref"in t?()=>t.deref():()=>t,r=this.on(e,(e=>{i()?.call(null,e),r.remove()}));return r}add(e,t){if((0,p.it)(this._observable),this._emitBeforeChanges(u.y.ADD))return this;const i=this.getNextIndex(t??null);return this._splice(i,0,[e]),this._emitAfterChanges(u.y.ADD),this}addMany(e,t=this._items.length){if((0,p.it)(this._observable),!e?.length)return this;if(this._emitBeforeChanges(u.y.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,w(e)),this._emitAfterChanges(u.y.ADD),this}at(e){if((0,p.it)(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if((0,p.it)(this._observable),!this.length||this._emitBeforeChanges(u.y.REMOVE))return[];const e=this._removeAllRaw();return this._emitAfterChanges(u.y.REMOVE),e}_removeAllRaw(){return 0===this.length?[]:this._splice(0,this.length)||[]}clone(){return(0,p.it)(this._observable),this._createNewInstance({items:this._items.map(l.d9)})}concat(...e){(0,p.it)(this._observable);const t=e.map(w);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if((0,p.it)(this._observable),!this.length||this._emitBeforeChanges(u.y.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let n=0;n<r;n++)e.call(t,i[n],n,i);this._emitAfterChanges(u.y.REMOVE)}destroyAll(){this.drain(b)}destroyMany(e){const t=this.removeMany(e);return t.forEach(b),t}every(e,t){return(0,p.it)(this._observable),this._items.every(e,t)}filter(e,t){(0,p.it)(this._observable);const i=2===arguments.length?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:i})}find(e,t){return(0,p.it)(this._observable),this._items.find(e,t)}findIndex(e,t){return(0,p.it)(this._observable),this._items.findIndex(e,t)}flatten(e,t){(0,p.it)(this._observable);const i=[];return C(i,this,e,t),new r(i)}forEach(e,t){return(0,p.it)(this._observable),this._items.forEach(e,t)}getItemAt(e){return(0,p.it)(this._observable),this._items[e]}getNextIndex(e){(0,p.it)(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return(0,p.it)(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return(0,p.it)(this._observable),this._items.indexOf(e,t)}join(e=","){return(0,p.it)(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return(0,p.it)(this._observable),this._items.lastIndexOf(e,t)}map(e,t){(0,p.it)(this._observable);const i=this._items.map(e,t);return new r({items:i})}reorder(e,t=this.length-1){(0,p.it)(this._observable);const i=this.indexOf(e);if(-1!==i){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(u.y.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(u.y.MOVE)}return e}}pop(){if((0,p.it)(this._observable),!this.length||this._emitBeforeChanges(u.y.REMOVE))return;const e=x(this._splice(this.length-1,1));return this._emitAfterChanges(u.y.REMOVE),e}push(...e){return(0,p.it)(this._observable),this._emitBeforeChanges(u.y.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(u.y.ADD)),this.length}reduce(e,t){(0,p.it)(this._observable);const i=this._items;return 2===arguments.length?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){(0,p.it)(this._observable);const i=this._items;return 2===arguments.length?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return(0,p.it)(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if((0,p.it)(this._observable),e<0||e>=this.length||this._emitBeforeChanges(u.y.REMOVE))return;const t=x(this._splice(e,1));return this._emitAfterChanges(u.y.REMOVE),t}removeMany(e){if((0,p.it)(this._observable),!e?.length||this._emitBeforeChanges(u.y.REMOVE))return[];const t=e instanceof r?e.toArray():e,i=this._items,n=[],s=t.length;for(let e=0;e<s;e++){const r=t[e],s=i.indexOf(r);if(s>-1){const r=1+T(t,i,e+1,s+1),o=this._splice(s,r);o&&o.length>0&&n.push.apply(n,o),e+=r-1}}return this._emitAfterChanges(u.y.REMOVE),n}reverse(){if((0,p.it)(this._observable),this._emitBeforeChanges(u.y.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(u.y.MOVE),this}shift(){if((0,p.it)(this._observable),!this.length||this._emitBeforeChanges(u.y.REMOVE))return;const e=x(this._splice(0,1));return this._emitAfterChanges(u.y.REMOVE),e}slice(e=0,t=this.length){return(0,p.it)(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return(0,p.it)(this._observable),this._items.some(e,t)}sort(e){if((0,p.it)(this._observable),!this.length||this._emitBeforeChanges(u.y.MOVE)||!this._requiresSort(e))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(u.y.MOVE),this}_requiresSort(e=((e,t)=>e===t?0:e<t?-1:1)){const t=this.length-1;for(let i=0;i<t;i++)if(e(this.items[i],this.items[i+1])>0)return!0;return!1}splice(e,t,...i){(0,p.it)(this._observable);const r=(t?u.y.REMOVE:0)|(i.length?u.y.ADD:0);if(this._emitBeforeChanges(r))return[];const n=this._splice(e,t,i)||[];return this._emitAfterChanges(r),n}toArray(){return(0,p.it)(this._observable),this._items.slice()}toJSON(){return(0,p.it)(this._observable),this.toArray()}toLocaleString(){return(0,p.it)(this._observable),this._items.toLocaleString()}toString(){return(0,p.it)(this._observable),this._items.toString()}unshift(...e){return(0,p.it)(this._observable),!e.length||this._emitBeforeChanges(u.y.ADD)||(this._splice(0,0,e),this._emitAfterChanges(u.y.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=(0,h.Os)((()=>this._dispatchChange()))),e<0&&(e+=this.length),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const t=v.acquire();t.target=this,t.cancellable=!0;for(let i=0,n=o.length;i<n;i++)s=o[i],t.reset(s),this.emit("before-remove",t),t.defaultPrevented&&(o.splice(i,1),r.splice(e,0,s),e+=1,i-=1,n-=1);v.release(t)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const e=v.acquire();e.target=this,e.cancellable=!1;const t=o.length;for(let i=0;i<t;i++)e.reset(o[i]),this.emit("after-remove",e);v.release(e)}}if(i?.length){if(n){const e=[];for(const t of i){const i=n.ensureType(t);null==i&&null!=t||e.push(i)}i=e}const t=this.hasEventListener("before-add"),s=this.hasEventListener("after-add"),o=e===this.length;if(t||s){const n=v.acquire();n.target=this,n.cancellable=!0;const a=v.acquire();a.target=this,a.cancellable=!1;for(const l of i)t?(n.reset(l),this.emit("before-add",n),n.defaultPrevented||(o?r.push(l):r.splice(e++,0,l),this._set("length",r.length),s&&(a.reset(l),this.emit("after-add",a)))):(o?r.push(l):r.splice(e++,0,l),this._set("length",r.length),a.reset(l),this.emit("after-add",a));v.release(a),v.release(n)}else{if(o)for(const e of i)r.push(e);else r.splice(e,0,...i);this._set("length",r.length)}}if((i?.length||o?.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const r=new _(this,i,o,e,t);this.emit("after-splice",r)}return o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=v.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,v.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=v.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),v.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const e=t.changes;S.clear(),E.clear(),M.clear();for(const{added:t,removed:i}of e){if(t)if(0===M.size&&0===E.size)for(const e of t)S.add(e);else for(const e of t)E.has(e)?(M.add(e),E.delete(e)):M.has(e)||S.add(e);if(i)if(0===M.size&&0===S.size)for(const e of i)E.add(e);else for(const e of i)S.has(e)?S.delete(e):(M.delete(e),E.add(e))}const i=s.Z.acquire();S.forEach((e=>{i.push(e)}));const r=s.Z.acquire();E.forEach((e=>{r.push(e)}));const n=this._items,o=t.items,a=s.Z.acquire();if(M.forEach((e=>{o.indexOf(e)!==n.indexOf(e)&&a.push(e)})),t.listeners&&(i.length||r.length||a.length)){const e={target:this,added:i,removed:r,moved:a},n=t.listeners.length;for(let i=0;i<n;i++){const r=t.listeners[i];r.removed||r.callback.call(this,e)}}s.Z.release(i),s.Z.release(r),s.Z.release(a)}S.clear(),E.clear(),M.clear()}};O.ofType=e=>{if(!e)return r;if(A.has(e))return A.get(e);let t=null;if("function"==typeof e)t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const r=e.typeMap[i].prototype.declaredClass;t?t+=` | ${r}`:t=r}let i=class extends r{};return(0,n._)([(0,m.c)({Type:e,ensureType:"function"==typeof e?(0,d.se)(e):(0,d.N7)(e)})],i.prototype,"itemType",void 0),i=(0,n._)([(0,g.j)(`esri.core.Collection<${t}>`)],i),A.set(e,i),i},(0,n._)([(0,f.Cb)()],O.prototype,"_updating",void 0),(0,n._)([(0,f.Cb)()],O.prototype,"length",void 0),(0,n._)([(0,f.Cb)()],O.prototype,"items",null),(0,n._)([(0,f.Cb)({readOnly:!0})],O.prototype,"updating",null),O=r=(0,n._)([(0,g.j)("esri.core.Collection")],O);const P=O},81739:(e,t,i)=>{i.d(t,{Z:()=>u});var r=i(36663),n=i(41831),s=i(76868),o=i(81977),a=i(40266),l=i(63235);let c=class extends n.Z{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles((0,l.EH)((()=>this._refresh()),s.sync))}destroy(){this.getCollections=null}_refresh(){const e=null!=this.getCollections?this.getCollections():null;if(null==e)return void this.removeAll();let t=0;for(const i of e)null!=i&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new n.Z(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction??(e=>!!e);for(const r of t)if(r){if(i(r)){const t=this.indexOf(r,e);t>=0?t!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const t=this.getChildrenFunction(r);if(Array.isArray(t))for(const i of t)e=this._processCollection(e,i);else e=this._processCollection(e,t)}}return e}};(0,r._)([(0,o.Cb)()],c.prototype,"getCollections",void 0),(0,r._)([(0,o.Cb)()],c.prototype,"getChildrenFunction",void 0),(0,r._)([(0,o.Cb)()],c.prototype,"itemFilterFunction",void 0),c=(0,r._)([(0,a.j)("esri.core.CollectionFlattener")],c);const u=c},16068:(e,t,i)=>{i.d(t,{BV:()=>c,Q4:()=>l,c5:()=>a,pE:()=>n});var r=i(19431);class n{constructor(e,t){this.min=e,this.max=t,this.range=t-e}normalize(e,t=0,i=!1){return s(this.range,this.min,this.max,e,t,i)}clamp(e,t=0){return(0,r.uZ)(e-t,this.min,this.max)+t}monotonic(e,t,i){return e<t?t:t+o(this.range,e-t,i)}minimalMonotonic(e,t,i){return s(this.range,e,e+this.range,t,i)}center(e,t,i){return t=this.monotonic(e,t,i),this.normalize((e+t)/2,i)}diff(e,t,i){return this.monotonic(e,t,i)-e}shortestSignedDiff(e,t){e=this.normalize(e);const i=(t=this.normalize(t))-e,r=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(i)<Math.abs(r)?i:r}contains(e,t,i){return t=this.minimalMonotonic(e,t),(i=this.minimalMonotonic(e,i))>e&&i<t}}function s(e,t,i,r,n=0,s=!1){return(r-=n)<t?r+=o(e,t-r):r>i&&(r-=o(e,r-i)),s&&r===i&&(r=t),r+n}function o(e,t,i=0){return Math.ceil((t-i)/e)*e+i}const a=new n(0,2*Math.PI),l=new n(-Math.PI,Math.PI),c=new n(0,360)},70375:(e,t,i)=>{i.d(t,{Z:()=>o});var r=i(67134),n=i(13802),s=i(49290);class o extends s.Z{constructor(e,t,i){super(e,t,i)}toJSON(){if(null!=this.details)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,((e,t)=>{if(t&&"object"==typeof t&&"function"==typeof t.toJSON)return t;try{return(0,r.d9)(t)}catch(e){return"[object]"}})))}}catch(e){throw n.Z.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new o(e.name,e.message,e.details)}}o.prototype.type="error"},31355:(e,t,i)=>{i.d(t,{Z:()=>a});var r=i(36663),n=i(74396),s=i(23148),o=i(40266);class a{constructor(){this._emitter=new a.EventEmitter(this)}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}}!function(e){class t{constructor(e=null){this._target=e,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(e,t){let i=this._listenersMap?.get(e);if(!i)return!1;const r=this._target||this;let n=!1;for(const e of i.slice()){const i="deref"in e?e.deref():e;i?i?.call(r,t):n=!0}return n&&(i=i.filter((e=>!("deref"in e)||null!=e.deref())),this._listenersMap.set(e,i)),i.length>0}on(e,t){if(Array.isArray(e)){const i=e.map((e=>this.on(e,t)));return(0,s.AL)(i)}if(e.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const i=this._listenersMap.get(e)||[];return i.push(t),this._listenersMap.set(e,i),(0,s.kB)((()=>{const i=this._listenersMap?.get(e),r=i?.indexOf(t)??-1;r>=0&&i.splice(r,1)}))}once(e,t){const i=this.on(e,(e=>{i.remove();("deref"in t?t.deref():t)?.call(null,e)}));return i}hasEventListener(e){const t=this._listenersMap?.get(e);return null!=t&&t.length>0}}e.EventEmitter=t,e.EventedMixin=e=>{let i=class extends e{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};return i=(0,r._)([(0,o.j)("esri.core.Evented")],i),i};let i=class extends n.Z{constructor(){super(...arguments),this._emitter=new a.EventEmitter(this)}destroy(){this._emitter.clear()}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};i=(0,r._)([(0,o.j)("esri.core.Evented.EventedAccessor")],i),e.EventedAccessor=i}(a)},44584:(e,t,i)=>{i.d(t,{Z:()=>n});var r=i(99118);class n{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach((t=>{e+=t.length})),e}add(e,t){if((0,r.TW)(e)){const i=this._getOrCreateGroup(t);for(const t of e)a(t)&&i.push(t)}else a(e)&&this._getOrCreateGroup(t).push(e);return this}forEach(e,t){if("function"==typeof e)this._groups.forEach((t=>t.forEach(e)));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(s(e))}remove(e){if("string"!=typeof e&&(0,r.TW)(e)){for(const t of e)this.remove(t);return this}return this.has(e)?(o(this._getGroup(e)),this._groups.delete(s(e)),this):this}removeAll(){return this._groups.forEach(o),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(s(e),t),t}_getGroup(e){return this._groups.get(s(e))}}function s(e){return e||"_default_"}function o(e){for(const t of e)t instanceof n?t.removeAll():t.remove()}function a(e){return null!=e&&(!!e.remove||e instanceof n)}},86618:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(36663),n=i(40266);let s=0;const o=e=>{let t=class extends e{constructor(...e){super(...e),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+s++})}};return t=(0,r._)([(0,n.j)("esri.core.Identifiable")],t),t},a=e=>{let t=class extends e{constructor(...e){super(...e),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:s++})}};return t=(0,r._)([(0,n.j)("esri.core.Identifiable.NumericIdentifiable")],t),t};let l=class extends(o(class{})){};l=(0,r._)([(0,n.j)("esri.core.Identifiable")],l),function(e){e.IdentifiableMixin=o,e.NumericIdentifiableMixin=a}(l||(l={}));const c=l},82064:(e,t,i)=>{i.d(t,{Z:()=>y});var r=i(36663),n=i(74396),s=i(67134),o=i(65943);class a{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const t=new a;return this._values.forEach(((i,r)=>{e&&e.has(r)||t.set(r,(0,s.d9)(i.value),i.origin)})),t}get(e,t){t=this._normalizeOrigin(t);const i=this._values.get(e);return null==t||i?.origin===t?i?.value:void 0}originOf(e){return this._values.get(e)?.origin??o.s3.USER}keys(e){e=this._normalizeOrigin(e);const t=[...this._values.keys()];return null==e?t:t.filter((t=>this._values.get(t)?.origin===e))}set(e,t,i){if((i=this._normalizeOrigin(i))===o.s3.DEFAULTS){const t=this._values.get(e);if(null!=t?.origin&&t.origin>i)return}this._values.set(e,new l(t,i))}delete(e,t){null!=(t=this._normalizeOrigin(t))&&this._values.get(e)?.origin!==t||this._values.delete(e)}has(e,t){return null!=(t=this._normalizeOrigin(t))?this._values.get(e)?.origin===t:this._values.has(e)}forEach(e){this._values.forEach((({value:t},i)=>e(t,i)))}_normalizeOrigin(e){if(null!=e)return e===o.s3.DEFAULTS?e:o.s3.USER}}class l{constructor(e,t){this.value=e,this.origin=t}}var c=i(20701),u=i(70148),h=i(95620),d=i(86561),p=i(40266);const f=e=>{let t=class extends e{constructor(...e){super(...e);const t=(0,h.vw)(this),i=t.store,r=new a;t.store=r,(0,c.M)(t,i,r)}read(e,t){(0,u.i)(this,e,t)}write(e,t){return(0,d.c)(this,e??{},t)}toJSON(e){return this.write({},e)}static fromJSON(e,t){return m.call(this,e,t)}};return t=(0,r._)([(0,p.j)("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function m(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let g=class extends(f(n.Z)){};g=(0,r._)([(0,p.j)("esri.core.JSONSupport")],g),function(e){e.JSONSupportMixin=f,e.isSerializable=function(e){return e&&"object"==typeof e&&"toJSON"in e&&"function"==typeof e.toJSON}}(g||(g={}));const y=g},55854:(e,t,i)=>{i.d(t,{z:()=>n});var r=i(40366);class n{constructor(e,t){this._storage=new r.WJ,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,i=1){this._storage.put(this,e,t,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},68309:(e,t,i)=>{i.d(t,{Z:()=>f});var r=i(36663),n=i(70375),s=i(61681),o=i(64189),a=i(78668),l=i(96863),c=i(81977),u=i(40266);const h="loaded",d=e=>{let t=class extends e{constructor(...e){super(...e),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise((e=>{const t=this.load.bind(this);this.load=i=>{const r=new Promise(((e,t)=>{const r=(0,a.$F)(i,t);this.destroyed&&t(new n.Z("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(e,t).finally((()=>{r&&r.remove()}))}));if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const e=this._loadController=new AbortController;t({signal:e.signal})}return e(),r}}))),this.when((()=>{this._set("loadStatus",h),this._loadController=null}),(e=>{this._set("loadStatus","failed"),this._set("loadError",e),this._loadController=null}))}destroy(){this._loadController&&(this._loadController=(0,s.IM)(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===h}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new n.Z("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return(0,r._)([(0,c.Cb)({readOnly:!0})],t.prototype,"loaded",null),(0,r._)([(0,c.Cb)({readOnly:!0})],t.prototype,"loadError",void 0),(0,r._)([(0,c.Cb)({clonable:!1})],t.prototype,"loadStatus",void 0),(0,r._)([(0,c.Cb)({type:[l.Z],readOnly:!0})],t.prototype,"loadWarnings",null),t=(0,r._)([(0,u.j)("esri.core.Loadable")],t),t};let p=class extends(d(o.Z)){};p=(0,r._)([(0,u.j)("esri.core.Loadable")],p),function(e){e.LoadableMixin=d,e.isLoadable=function(e){return!(!e||!e.load)}}(p||(p={}));const f=p},13802:(e,t,i)=>{i.d(t,{Z:()=>o});var r=i(51366),n=(i(39994),i(21130));const s={info:0,warn:1,error:2,none:3};class o{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},null!=e.level&&(this.level=e.level),null!=e.writer&&(this.writer=e.writer),this._module=e.module,o._loggers.set(this.module,this);const t=this.module.lastIndexOf(".");-1!==t&&(this._parent=o.getLogger(this.module.slice(0,t)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e="string"!=typeof e?e.declaredClass:e,o._loggers.get(e)||new o({module:e})}_log(e,t,...i){if(this._matchLevel(e)){if("always"!==t&&!o._throttlingDisabled){const r=function(...e){const t=(e,t)=>"object"!=typeof t||Array.isArray(t)?t:"[Object]";return(0,n.hP)(JSON.stringify(e,t))}(i),s=this._loggedMessages[e].get(r);if("once"===t&&null!=s||"oncePerTick"===t&&s&&s>=o._tickCounter)return;this._loggedMessages[e].set(r,o._tickCounter),o._scheduleTickCounterIncrement()}for(const t of r.Z.log.interceptors)if(t(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,t){let i=this;for(;null!=i;){const t=i[e];if(null!=t)return t;i=i.parent}return t}_inheritedWriter(){return this._parentWithMember("writer",a)}_matchLevel(e){const t=r.Z.log.level||"warn";return s[this._parentWithMember("level",t)]<=s[e]}static _scheduleTickCounterIncrement(){o._tickCounterScheduled||(o._tickCounterScheduled=!0,Promise.resolve().then((()=>{o._tickCounter++,o._tickCounterScheduled=!1})))}}function a(e,t,...i){console[e](`[${t}]`,...i)}o._loggers=new Map,o._tickCounter=0,o._tickCounterScheduled=!1,o._throttlingDisabled=!1},86630:(e,t,i)=>{i.d(t,{F:()=>p,M:()=>r});const r={Base64:0,Hex:1,String:2,Raw:3};function n(e,t){const i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function s(e){const t=[];for(let i=0,r=8*e.length;i<r;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}function o(e){const t=[];for(let i=0,r=32*e.length;i<r;i+=8)t.push(String.fromCharCode(e[i>>5]>>>i%32&255));return t.join("")}function a(e,t,i,r,s,o){return n(function(e,t){return e<<t|e>>>32-t}(n(n(t,e),n(r,o)),s),i)}function l(e,t,i,r,n,s,o){return a(t&i|~t&r,e,t,n,s,o)}function c(e,t,i,r,n,s,o){return a(t&r|i&~r,e,t,n,s,o)}function u(e,t,i,r,n,s,o){return a(t^i^r,e,t,n,s,o)}function h(e,t,i,r,n,s,o){return a(i^(t|~r),e,t,n,s,o)}function d(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let i=1732584193,r=-271733879,s=-1732584194,o=271733878;for(let t=0;t<e.length;t+=16){const a=i,d=r,p=s,f=o;i=l(i,r,s,o,e[t],7,-680876936),o=l(o,i,r,s,e[t+1],12,-389564586),s=l(s,o,i,r,e[t+2],17,606105819),r=l(r,s,o,i,e[t+3],22,-1044525330),i=l(i,r,s,o,e[t+4],7,-176418897),o=l(o,i,r,s,e[t+5],12,1200080426),s=l(s,o,i,r,e[t+6],17,-1473231341),r=l(r,s,o,i,e[t+7],22,-45705983),i=l(i,r,s,o,e[t+8],7,1770035416),o=l(o,i,r,s,e[t+9],12,-1958414417),s=l(s,o,i,r,e[t+10],17,-42063),r=l(r,s,o,i,e[t+11],22,-1990404162),i=l(i,r,s,o,e[t+12],7,1804603682),o=l(o,i,r,s,e[t+13],12,-40341101),s=l(s,o,i,r,e[t+14],17,-1502002290),r=l(r,s,o,i,e[t+15],22,1236535329),i=c(i,r,s,o,e[t+1],5,-165796510),o=c(o,i,r,s,e[t+6],9,-1069501632),s=c(s,o,i,r,e[t+11],14,643717713),r=c(r,s,o,i,e[t],20,-373897302),i=c(i,r,s,o,e[t+5],5,-701558691),o=c(o,i,r,s,e[t+10],9,38016083),s=c(s,o,i,r,e[t+15],14,-660478335),r=c(r,s,o,i,e[t+4],20,-405537848),i=c(i,r,s,o,e[t+9],5,568446438),o=c(o,i,r,s,e[t+14],9,-1019803690),s=c(s,o,i,r,e[t+3],14,-187363961),r=c(r,s,o,i,e[t+8],20,1163531501),i=c(i,r,s,o,e[t+13],5,-1444681467),o=c(o,i,r,s,e[t+2],9,-51403784),s=c(s,o,i,r,e[t+7],14,1735328473),r=c(r,s,o,i,e[t+12],20,-1926607734),i=u(i,r,s,o,e[t+5],4,-378558),o=u(o,i,r,s,e[t+8],11,-2022574463),s=u(s,o,i,r,e[t+11],16,1839030562),r=u(r,s,o,i,e[t+14],23,-35309556),i=u(i,r,s,o,e[t+1],4,-1530992060),o=u(o,i,r,s,e[t+4],11,1272893353),s=u(s,o,i,r,e[t+7],16,-155497632),r=u(r,s,o,i,e[t+10],23,-1094730640),i=u(i,r,s,o,e[t+13],4,681279174),o=u(o,i,r,s,e[t],11,-358537222),s=u(s,o,i,r,e[t+3],16,-722521979),r=u(r,s,o,i,e[t+6],23,76029189),i=u(i,r,s,o,e[t+9],4,-640364487),o=u(o,i,r,s,e[t+12],11,-421815835),s=u(s,o,i,r,e[t+15],16,530742520),r=u(r,s,o,i,e[t+2],23,-995338651),i=h(i,r,s,o,e[t],6,-198630844),o=h(o,i,r,s,e[t+7],10,1126891415),s=h(s,o,i,r,e[t+14],15,-1416354905),r=h(r,s,o,i,e[t+5],21,-57434055),i=h(i,r,s,o,e[t+12],6,1700485571),o=h(o,i,r,s,e[t+3],10,-1894986606),s=h(s,o,i,r,e[t+10],15,-1051523),r=h(r,s,o,i,e[t+1],21,-2054922799),i=h(i,r,s,o,e[t+8],6,1873313359),o=h(o,i,r,s,e[t+15],10,-30611744),s=h(s,o,i,r,e[t+6],15,-1560198380),r=h(r,s,o,i,e[t+13],21,1309151649),i=h(i,r,s,o,e[t+4],6,-145523070),o=h(o,i,r,s,e[t+11],10,-1120210379),s=h(s,o,i,r,e[t+2],15,718787259),r=h(r,s,o,i,e[t+9],21,-343485551),i=n(i,a),r=n(r,d),s=n(s,p),o=n(o,f)}return[i,r,s,o]}function p(e,t=r.Hex){const i=t||r.Base64,n=d(s(e),8*e.length);switch(i){case r.Raw:return n;case r.Hex:return function(e){const t="0123456789abcdef",i=[];for(let r=0,n=4*e.length;r<n;r++)i.push(t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15));return i.join("")}(n);case r.String:return o(n);case r.Base64:return function(e){const t=[];for(let i=0,r=4*e.length;i<r;i+=3){const r=(e[i>>2]>>i%4*8&255)<<16|(e[i+1>>2]>>(i+1)%4*8&255)<<8|e[i+2>>2]>>(i+2)%4*8&255;for(let n=0;n<4;n++)8*i+6*n>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>6*(3-n)&63))}return t.join("")}(n)}}},86114:(e,t,i)=>{function r(e,t){for(const i of e.values())if(t(i))return!0;return!1}function n(e,t){for(const i of e.values())if(t(i))return i;return null}function s(e,t,i){const r=e.get(t);if(void 0!==r)return r;const n=i();return e.set(t,n),n}function o(e){const t=new Map;return i=>(t.has(i)||t.set(i,e(i)),t.get(i))}i.d(t,{HP:()=>o,fQ:()=>n,oE:()=>r,s1:()=>s})},40366:(e,t,i)=>{i.d(t,{Jv:()=>s,M4:()=>n,WJ:()=>l,Xq:()=>a,lN:()=>o});var r=i(17135);const n=-3,s=n-1;var o;!function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"}(o||(o={}));class a{constructor(e,t,i,r=0){this.name=e,this._storage=t,this._defaultPriority=r,this.id=c+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,i=this._defaultPriority){this._storage.put(this,e,t,t.cachedMemory,i)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t){this._storage.updateSize(this,e,t,t.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class l{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new r.Z,this._users=new r.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear()}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){return this._db.get(e.id+t)?.size??0}put(e,t,i,r,a){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==i&&this._notifyRemove(t,l.entry,l.size,o.ALL)),r>this._maxSize)return void this._notifyRemove(t,i,r,o.ALL);if(void 0===i)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return console.warn(`Refusing to cache entry with size ${r} for key ${t}`),void this._notifyRemove(t,i,0,o.ALL);const c=1+Math.max(a,s)-n;this._db.set(t,new u(i,r,c)),this._size+=r,e.size+=r,this._checkSize()}updateSize(e,t,i,r){t=e.id+t;const n=this._db.get(t);if(n&&n.entry===i){for(this._size-=n.size,e.size-=n.size;r>this._maxSize;){const e=this._notifyRemove(t,i,r,o.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);r=e}n.size=r,this._size+=r,e.size+=r,this._checkSize()}}pop(e,t){t=e.id+t;const i=this._db.get(t);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(e,t){t=e.id+t;const i=this._db.get(t);if(void 0!==i)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}peek(e,t){const i=this._db.get(e.id+t);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},i=new Array;this._db.forEach(((e,r)=>{const n=e.lifetime;i[n]=(i[n]||0)+e.size,this._users.forAll((i=>{const{id:n,name:s}=i;if(r.startsWith(n)){const i=t[s]||0;t[s]=i+e.size}}))}));const r={};this._users.forAll((e=>{const i=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const n=t[i]||0;t[i]=n,r[i]=Math.round(100*e.hitRate)+"%"}else r[i]="0%"}));const s=Object.keys(t);s.sort(((e,i)=>t[i]-t[e])),s.forEach((i=>e[i]=Math.round(t[i]/2**20)+"MB / "+r[i]));for(let t=i.length-1;t>=0;--t){const r=i[t];r&&(e["Priority "+(t+n-1)]=Math.round(r/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,i)=>{i.startsWith(t)&&(this._size-=e.size,this._db.delete(i),this._notifyRemove(i,e.entry,e.size,o.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,o.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,i,r){let n;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,r,i);return"number"==typeof e&&(n=e),!0}return!1})),n}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const i=e?.id;let r=!0;for(;r;){r=!1;for(const[n,s]of this._db)if(0===s.lifetime&&(!i||n.startsWith(i))){if(this._purgeItem(n,s,e),t.size<=.9*t.maxSize)return;r||=this._db.has(n)}}for(const[r,n]of this._db)if((!i||r.startsWith(i))&&(this._purgeItem(r,n,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,i=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,i&&(i.size-=t.size);const r=this._notifyRemove(e,t.entry,t.size,o.SOME);null!=r&&r>0&&(this._size+=r,i&&(i.size+=r),t.lives=t.lifetime,t.size=r,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}let c=0;class u{constructor(e,t,i){this.entry=e,this.size=t,this.lifetime=i,this.lives=i}}},49290:(e,t,i)=>{i.d(t,{Z:()=>n});var r=i(86745);class n{constructor(e,t,i){this.name=e,this.details=i,this.message=(t&&function(e,t){return e.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,((e,i)=>""===i?"$":((0,r.hS)(i,t)??"").toString()))}(t,i))??""}toString(){return"["+this.name+"]: "+this.message}}},15842:(e,t,i)=>{i.d(t,{R:()=>v,w:()=>b});var r=i(36663),n=i(74396),s=i(20701),o=i(67134),a=i(65943);class l{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(a.v8),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const t=new l,i=this._originStores[a.s3.DEFAULTS];i&&i.forEach(((e,i)=>{t.set(i,(0,o.d9)(e),a.s3.DEFAULTS)}));for(let i=a.s3.SERVICE;i<a.v8;i++){const r=this._originStores[i];r&&r.forEach(((r,n)=>{e&&e.has(n)||t.set(n,(0,o.d9)(r),i)}))}return t}get(e,t){const i=void 0===t?this._values:this._originStores[t];return i?i.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?[...t.keys()]:[]}set(e,t,i=a.s3.USER){let r=this._originStores[i];if(r||(r=new Map,this._originStores[i]=r),r.set(e,t),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const r=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,i),r!==t}return!1}delete(e,t=a.s3.USER){const i=this._originStores[t];if(!i)return;const r=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let i=t-1;i>=0;i--){const t=this._originStores[i];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,i);break}}}return r}has(e,t){const i=void 0===t?this._values:this._originStores[t];return!!i&&i.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const i=this._originStores[t]?.get(e),r=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,t),r!==i}originOf(e){return this._propertyOriginMap.get(e)||a.s3.DEFAULTS}forEach(e){this._values.forEach(e)}}var c=i(70148),u=i(95620),h=i(40266);const d=e=>{let t=class extends e{constructor(...e){super(...e);const t=(0,u.vw)(this),i=t.store,r=new l;t.store=r,(0,s.M)(t,i,r)}read(e,t){(0,c.i)(this,e,t)}getAtOrigin(e,t){const i=p(this),r=(0,a.M9)(t);if("string"==typeof e)return i.get(e,r);const n={};return e.forEach((e=>{n[e]=i.get(e,r)})),n}originOf(e){return(0,a.x3)(this.originIdOf(e))}originIdOf(e){return p(this).originOf(e)}revert(e,t){const i=p(this),r=(0,a.M9)(t),n=(0,u.vw)(this);let s;s="string"==typeof e?"*"===e?i.keys(r):[e]:e,s.forEach((e=>{n.invalidate(e),i.revert(e,r),n.commit(e)}))}};return t=(0,r._)([(0,h.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function p(e){return(0,u.vw)(e).store}let f=class extends(d(n.Z)){};f=(0,r._)([(0,h.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],f);var m=i(51777),g=i(86561);const y=e=>{let t=class extends e{constructor(...e){super(...e)}clear(e,t="user"){return _(this).delete(e,(0,a.M9)(t))}write(e,t){return(0,g.c)(this,e=e||{},t),e}setAtOrigin(e,t,i){(0,u.vw)(this).setAtOrigin(e,t,(0,a.M9)(i))}removeOrigin(e){const t=_(this),i=(0,a.M9)(e),r=t.keys(i);for(const e of r)t.originOf(e)===i&&t.set(e,t.get(e,i),a.s3.USER)}updateOrigin(e,t){const i=_(this),r=(0,a.M9)(t),n=(0,m.U2)(this,e);for(let t=r+1;t<a.v8;++t)i.delete(e,t);i.set(e,n,r)}toJSON(e){return this.write({},e)}};return t=(0,r._)([(0,h.j)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function _(e){return(0,u.vw)(e).store}const v=e=>{let t=class extends(y(d(e))){constructor(...e){super(...e)}};return t=(0,r._)([(0,h.j)("esri.core.MultiOriginJSONSupport")],t),t};let b=class extends(v(n.Z)){};b=(0,r._)([(0,h.j)("esri.core.MultiOriginJSONSupport")],b)},22445:(e,t,i)=>{i.d(t,{r:()=>r});class r{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}getInner(e){return this._outer.get(e)}set(e,t,i){const r=this._outer.get(e);r?r.set(t,i):this._outer.set(e,new Map([[t,i]]))}delete(e,t){const i=this._outer.get(e);i&&(i.delete(t),0===i.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,i)=>e(t,i)))}forAll(e){for(const t of this._outer.values())for(const i of t.values())e(i)}}},34596:(e,t,i)=>{i.d(t,{Z:()=>r});class r{constructor(e,t,i,r=1,n=0){this._ctor=e,this._acquireFunction=t,this._releaseFunction=i,this.allocationSize=r,this._pool=new Array(n),this._initialSize=n;for(let e=0;e<n;e++)this._pool[e]=new this._ctor;this.allocationSize=Math.max(r,1)}destroy(){this.prune(0)}acquire(...e){let t;if(r.test.disabled)t=new this._ctor;else{if(0===this._pool.length){const e=this.allocationSize;for(let t=0;t<e;t++)this._pool[t]=new this._ctor}t=this._pool.pop()}return this._acquireFunction?this._acquireFunction(t,...e):function(e){return e?.acquire&&"function"==typeof e.acquire}(t)&&t.acquire(...e),t}release(e){e&&!r.test.disabled&&(this._releaseFunction?this._releaseFunction(e):function(e){return e?.release&&"function"==typeof e.release}(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let t=e;t<this._pool.length;++t){const e=this._pool[t];this._dispose(e)}this._pool.length=e}}_dispose(e){e.dispose&&"function"==typeof e.dispose&&e.dispose()}}r.test={disabled:!1}},19480:(e,t,i)=>{i.d(t,{x:()=>n});var r=i(66581);class n{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&(0,r.Y)((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*s);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,s));e++)this._items.push(this._allocator())}}const s=1024},98722:(e,t,i)=>{var r;i.d(t,{y:()=>r}),function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"}(r||(r={}))},31168:(e,t,i)=>{i.d(t,{Z:()=>r});class r{constructor(e,t=30){this.name=e,this._counter=0,this._samples=new Array(t)}push(e){null!=e&&(this._samples[++this._counter%this._samples.length]=e)}set(e){null!=e&&(this._samples[this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort(((e,t)=>e-t))[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce(((e,t)=>e+t),0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}}},17135:(e,t,i)=>{i.d(t,{Z:()=>a});var r,n=i(7753),s=i(27755);!function(e){const t=(e,t,i,r)=>{let n=t,s=t;const o=i>>>1,a=e[n-1];for(;s<=o;){s=n<<1,s<i&&r(e[s-1],e[s])<0&&++s;const t=e[s-1];if(r(t,a)<=0)break;e[n-1]=t,n=s}e[n-1]=a},i=(e,t)=>e<t?-1:e>t?1:0;e.sort=function(e,r,n,s){void 0===r&&(r=0),void 0===n&&(n=e.length),void 0===s&&(s=i);for(let i=n>>>1;i>r;i--)t(e,i,n,s);const o=r+1;for(let i=n-1;i>r;i--){const n=e[r];e[r]=e[i],e[i]=n,t(e,o,i,s)}},e.iterableSort=function*(e,r,n,s){void 0===r&&(r=0),void 0===n&&(n=e.length),void 0===s&&(s=i);for(let i=n>>>1;i>r;i--)t(e,i,n,s),yield;const o=r+1;for(let i=n-1;i>r;i--){const n=e[r];e[r]=e[i],e[i]=n,t(e,o,i,s),yield}}}(r||(r={}));const o=r;class a{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new n.SO,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),void 0!==e.deallocator&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>l(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const t=new Array;for(let i=0;i<this._length;i++){const r=this.data[i];e(r)&&t.push(r)}return t}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,t){const i=this.data.indexOf(e,t);return-1!==i&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let t=e;t<this._length;++t)this.data[t]=this._deallocator(this.data[t]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,t=e.length){for(let i=0;i<t;i++)this.data[this._length++]=e[i]}fill(e,t){for(let i=0;i<t;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,l(this)}pop(){if(0===this.length)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const t=(0,n.cq)(this.data,(0,s.CY)(e),this.length,this._hint);if(-1!==t)return this.data.splice(t,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex((0,n.cq)(this.data,(0,s.CY)(e),this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,t=e.length,i){this.length=(0,n.FY)(this.data,e,this.length,t,this._hint,i),this._shrink()}front(){if(0!==this.length)return this.data[0]}back(){if(0!==this.length)return this.data[this.length-1]}swapElements(e,t){if(e>=this.length||t>=this.length||e===t)return;const i=this.data[e];this.data[e]=this.data[t],this.data[t]=i}sort(e){o.sort(this.data,0,this.length,e)}iterableSort(e){return o.iterableSort(this.data,0,this.length,e)}some(e,t){for(let i=0;i<this.length;++i)if(e.call(t,this.data[i],i,this.data))return!0;return!1}find(e,t){const{data:i,length:r}=this;for(let n=0;n<r;++n)if(e.call(t,i[n]))return i[n]}filterInPlace(e,t){let i=0;for(let r=0;r<this._length;++r){const n=this.data[r];e.call(t,n,r,this.data)&&(this.data[r]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let e=i;e<this._length;e++)this.data[e]=this._deallocator(this.data[e]);return this._length=i,this._shrink(),this}forAll(e,t){const{data:i,length:r}=this;for(let n=0;n<r;++n)e.call(t,i[n],n,i)}forEach(e,t){this.data.slice(0,this.length).forEach(e,t)}map(e,t){const i=new Array(this.length);for(let r=0;r<this.length;++r)i[r]=e.call(t,this.data[r],r,this.data);return i}reduce(e,t){let i=t;for(let t=0;t<this.length;++t)i=e(i,this.data[t],t,this.data);return i}has(e){const t=this.length,i=this.data;for(let r=0;r<t;++r)if(i[r]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}}function l(e){e.data.length>1.5*e.length&&(e.data.length=Math.floor(1.1*e.length))}},64189:(e,t,i)=>{i.d(t,{Z:()=>h});var r,n=i(36663),s=i(74396),o=i(78668),a=i(40266);!function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"}(r||(r={}));class l{constructor(){this._resolver=(0,o.hh)(),this._status=r.PENDING,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=r.RESOLVED,this._cleanUp()}),(()=>{this._status=r.REJECTED,this._cleanUp()})),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===r.RESOLVED}isRejected(){return this._status===r.REJECTED}isFulfilled(){return this._status!==r.PENDING}abort(){this._resolver.reject((0,o.zE)())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=(0,o.hh)(),t=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(t);i.then((()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()}),(e=>{this.isFulfilled()||this._allPromise!==i||(0,o.D_)(e)||this._resolver.reject(e)})),e.resolve()}}const c=e=>{let t=class extends e{constructor(...e){super(...e),this._promiseProps=new l,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(e,t){return this._promiseProps.promise.then((()=>this)).then(e,t)}catch(e){return this.when(null,e)}addResolvingPromise(e){e&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in e?e.when():e)}};return t=(0,n._)([(0,a.j)("esri.core.Promise")],t),t};let u=class extends(c(s.Z)){};u=(0,n._)([(0,a.j)("esri.core.Promise")],u),function(e){e.EsriPromiseMixin=c}(u||(u={}));const h=u},58713:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(55860),n=i(26096);class s{constructor(e=(e=>e.values().next().value)){this._peeker=e,this._observable=new n.s,this._items=new Set}get length(){return(0,r.it)(this._observable),this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0===this.length)return;let e;for(e of this._items);return e}peek(){if(0!==this.length)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return(0,r.it)(this._observable),this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(0===this.length)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const t=this.length;return this._items.forEach((t=>{e(t)||this._items.delete(t)})),t!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){(0,r.it)(this._observable),yield*this._items}}},4157:(e,t,i)=>{i.d(t,{Z:()=>r});class r{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*r._m}getInt(){return this._seed=(r._a*this._seed+r._c)%r._m,this._seed}getFloat(){return this.getInt()/(r._m-1)}getIntRange(e,t){return Math.round(this.getFloatRange(e,t))}getFloatRange(e,t){const i=t-e;return e+this.getInt()/r._m*i}}r._m=2147483647,r._a=48271,r._c=0},20230:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(55860),n=i(26096);class s{constructor(e){this._observable=new n.s,this._map=new Map(e)}get size(){return(0,r.it)(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const t=this._map.delete(e);return t&&this._observable.notify(),t}entries(){return(0,r.it)(this._observable),this._map.entries()}forEach(e,t){(0,r.it)(this._observable),this._map.forEach(((i,r)=>e.call(t,i,r,this)),t)}get(e){return(0,r.it)(this._observable),this._map.get(e)}has(e){return(0,r.it)(this._observable),this._map.has(e)}keys(){return(0,r.it)(this._observable),this._map.keys()}set(e,t){return this._map.set(e,t),this._observable.notify(),this}values(){return(0,r.it)(this._observable),this._map.values()}[Symbol.iterator](){return(0,r.it)(this._observable),this._map[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}},2497:(e,t,i)=>{i.d(t,{e:()=>n});var r=i(34596);class n extends r.Z{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const t=super.acquire(...e);return this._set.delete(t),t}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}}},19784:(e,t,i)=>{function r(e,t){for(const i of e.values())if(t(i))return!0;return!1}function n(e,t){if(!t)return e;for(const i of t)null!=i&&e.add(i);return e}function s(e,t){return null!=t&&e.add(t),e}function o(e,t){const i=new Set;return n(i,e),n(i,t),i}function a(e,t){const i=new Set;for(const r of t)e.has(r)&&i.add(r);return i}function l(e,t){if(!e||!t)return!1;if(e===t)return!0;for(const i of e)if(!t.has(i))return!1;return!0}function c(e,t){if(null==e&&null==t)return!0;if(null==e||null==t||e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function u(e,t){const i=new Set(e);for(const e of t)i.delete(e);return i}function h(e,t){return u(o(e,t),a(e,t))}i.d(t,{G0:()=>o,Sp:()=>h,cm:()=>s,e5:()=>u,fS:()=>c,fn:()=>r,ik:()=>l,jV:()=>a,w6:()=>n})},26139:(e,t,i)=>{i.d(t,{G:()=>n});var r=i(70375);let n=class e{constructor(e,t,i=""){this.major=e,this.minor=t,this._context=i}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}greaterEqual(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",i=this._context&&this._context+" ";throw new r.Z(t+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new e(this.major,this.minor,this._context)}static parse(t,i=""){const[n,s]=t.split("."),o=/^\s*\d+\s*$/;if(!n?.match||!o.test(n))throw new r.Z((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s?.match||!o.test(s))throw new r.Z((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const a=parseInt(n,10),l=parseInt(s,10);return new e(a,l,i)}}},96863:(e,t,i)=>{i.d(t,{Z:()=>n});var r=i(49290);class n extends r.Z{constructor(e,t,i){super(e,t,i)}}n.prototype.type="warning"},759:(e,t,i)=>{i.d(t,{n:()=>n});var r=i(51366);const n=()=>r.Z.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches},49210:(e,t,i)=>{i.d(t,{s:()=>o});var r=i(23148),n=i(7753);class s{constructor(e,t){this._observers=e,this._observer=t}remove(){(0,n.Od)(this._observers,this._observer)}}class o{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return a;null==this._observers&&(this._observers=[]);const t=this._observers;let i=!1,r=!1;const n=t.length;for(let s=0;s<n;++s){const n=t[s];if(n.destroyed)r=!0;else if(n===e){i=!0;break}}return i||(t.push(e),r&&this._removeDestroyedObservers()),new s(t,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||0===e.length)return;const t=e.length;let i=0;for(let r=0;r<t;++r){for(;r+i<t&&e[r+i].destroyed;)++i;if(i>0){if(!(r+i<t))break;e[r]=e[r+i]}}e.length=t-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(null!=e){for(const t of e)t.onCommitted();this._observers=null}}}const a=(0,r.kB)()},65943:(e,t,i)=>{var r;i.d(t,{M9:()=>s,Wm:()=>a,s3:()=>r,v8:()=>n,x3:()=>o}),function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.LINK_CHART=6]="LINK_CHART",e[e.USER=7]="USER"}(r||(r={}));const n=r.USER+1;function s(e){switch(e){case"defaults":return r.DEFAULTS;case"service":return r.SERVICE;case"portal-item":return r.PORTAL_ITEM;case"web-scene":return r.WEB_SCENE;case"web-map":return r.WEB_MAP;case"link-chart":return r.LINK_CHART;case"user":return r.USER;default:return null}}function o(e){switch(e){case r.DEFAULTS:return"defaults";case r.SERVICE:return"service";case r.PORTAL_ITEM:return"portal-item";case r.WEB_SCENE:return"web-scene";case r.WEB_MAP:return"web-map";case r.LINK_CHART:return"link-chart";case r.USER:return"user"}}function a(e){return o(e)}},91421:(e,t,i)=>{i.d(t,{l:()=>r});const r=Symbol("Accessor-beforeDestroy")},69236:(e,t,i)=>{i.d(t,{p:()=>l});var r=i(7283),n=i(41610);const s=Object.prototype.toString;function o(e){const t="__accessorMetadata__"in e?(0,r.se)(e):e;return function(...e){if(e.push(t),"number"==typeof e[2])throw new Error("Using @cast has parameter decorator is not supported since 4.16");return a.apply(this,e)}}function a(e,t,i,r){(0,n.Oe)(e,t).cast=r}function l(...e){if(3!==e.length||"string"!=typeof e[1])return 1===e.length&&"[object Function]"===s.call(e[0])?o(e[0]):1===e.length&&"string"==typeof e[0]?function(e){return(t,i)=>{(0,n.Oe)(t,e).cast=t[i]}}(e[0]):void 0}},79438:(e,t,i)=>{i.d(t,{J:()=>s});var r=i(25709),n=i(81977);function s(e,t={}){const i=e instanceof r.X?e:new r.X(e,t),{alwaysWriteDefaults:s,default:o,ignoreUnknown:a=!0,name:l,nonNullable:c,readOnly:u=!1}=t;return(0,n.Cb)({type:a?i.apiValues:String,json:{type:i.jsonValues,default:o,name:l,read:!u&&{reader:i.read},write:{writer:i.write,alwaysWriteDefaults:s}},nonNullable:c,readOnly:u})}},98786:(e,t,i)=>{i.d(t,{B:()=>p});var r=i(70375),n=i(86630),s=i(71760),o=i(3466),a=i(12173),l=i(41610),c=i(65943),u=i(81977),h=i(51876),d=i(16641);function p(e){const t=e?.origins??[void 0];return(i,r)=>{const n=function(e,t,i){if("resource"===e?.type)return function(e,t,i){const r=(0,l.Oe)(t,i);return{type:String,read:(e,t,i)=>{const n=(0,d.r)(e,t,i);return r.type===String?n:"function"==typeof r.type?new r.type({url:n}):void 0},write:{isRequired:r.json?.write?.isRequired,writer(t,n,a,l){if(!l?.resources)return"string"==typeof t?void(n[a]=(0,d.t)(t,l)):void(n[a]=t.write({},l));const u=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),p=(0,d.t)(u,{...l,verifyItemRelativeUrls:l?.verifyItemRelativeUrls?{writtenUrls:l.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},d.M.NO),y=r.type!==String&&(!(0,s.l)(this)||l?.origin&&this.originIdOf(i)>(0,c.M9)(l.origin)),_={object:this,propertyName:i,value:t,targetUrl:p,dest:n,targetPropertyName:a,context:l,params:e};l?.portalItem&&p&&!(0,o.YP)(p)?y&&e?.contentAddressed?f(_):y?function(e){const{context:t,targetUrl:i,params:r,value:n,dest:s,targetPropertyName:a}=e;if(!t.portalItem)return;const l=t.portalItem.resourceFromPath(i),c=g(n,i,t),u=(0,h.B)(c),d=(0,o.Ml)(l.path),p=r?.compress??!1;u===d?(t.resources&&m({...e,resource:l,content:c,compress:p,updates:t.resources.toUpdate}),s[a]=i):f(e)}(_):function({context:e,targetUrl:t,dest:i,targetPropertyName:r}){e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(t),compress:!1}),i[r]=t)}(_):l?.portalItem&&(null==p||null!=(0,d.i)(p)||(0,o.jc)(p)||y)?f(_):n[a]=p}}}}(e,t,i);switch(e?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=d.b;return{read:e,write:t}}}}(e,i,r);for(const e of t){const t=(0,u.CJ)(i,e,r);for(const e in n)t[e]=n[e]}}}function f(e){const{targetUrl:t,params:i,value:s,context:l,dest:c,targetPropertyName:u}=e;if(!l.portalItem)return;const p=(0,d.p)(t),f=g(s,t,l);if(i?.contentAddressed&&"json"!==f.type)return void l.messages?.push(new r.Z("persistable:contentAddressingUnsupported",`Property "${u}" is trying to serializing a resource with content of type ${f.type} with content addressing. Content addressing is only supported for json resources.`,{content:f}));const y=i?.contentAddressed&&"json"===f.type?(0,n.F)(f.jsonString):p?.filename??(0,a.DO)(),_=(0,o.v_)(i?.prefix??p?.prefix,y),v=`${_}.${(0,h.B)(f)}`;if(i?.contentAddressed&&l.resources&&"json"===f.type){const e=l.resources.toKeep.find((({resource:e})=>e.path===v))??l.resources.toAdd.find((({resource:e})=>e.path===v));if(e)return void(c[u]=e.resource.itemRelativeUrl)}const b=l.portalItem.resourceFromPath(v);(0,o.jc)(t)&&l.resources&&l.resources.pendingOperations.push((0,o.gi)(t).then((e=>{b.path=`${_}.${(0,h.B)({type:"blob",blob:e})}`,c[u]=b.itemRelativeUrl})).catch((()=>{})));const w=i?.compress??!1;l.resources&&m({...e,resource:b,content:f,compress:w,updates:l.resources.toAdd}),c[u]=b.itemRelativeUrl}function m({object:e,propertyName:t,updates:i,resource:r,content:n,compress:s}){i.push({resource:r,content:n,compress:s,finish:i=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function g(e,t,i){return"string"==typeof e?{type:"url",url:t}:{type:"json",jsonString:JSON.stringify(e.toJSON(i))}}},81977:(e,t,i)=>{i.d(t,{CJ:()=>c,Cb:()=>l});var r=i(13802),n=i(7283),s=i(51777),o=i(41610),a=i(33156);function l(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const l=Object.getOwnPropertyDescriptor(t,i),c=(0,o.Oe)(t,i);l&&(l.get||l.set?(c.get=l.get||c.get,c.set=l.set||c.set):"value"in l&&("value"in e&&r.Z.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),c.value=e.value=l.value)),null!=e.readOnly&&(c.readOnly=e.readOnly);const u=e.aliasOf;if(u){const e="string"==typeof u?u:u.source,t="string"==typeof u?null:!0===u.overridable;let r;c.dependsOn=[e],c.get=function(){let t=(0,s.U2)(this,e);if("function"==typeof t){r||(r=e.split(".").slice(0,-1).join("."));const i=(0,s.U2)(this,r);i&&(t=t.bind(i))}return t},c.readOnly||(c.set=t?function(e){this._override(i,e)}:function(t){(0,a.t)(this,e,t)})}const h=e.type,d=e.types;if(!c.cast){let t;h?t=function(e){let t=0,i=e;if((0,n.AY)(e))return(0,n.sY)(e);for(;Array.isArray(i)&&1===i.length&&"string"!=typeof i[0]&&"number"!=typeof i[0];)i=i[0],t++;const r=i;if((0,n.gB)(r))return 0===t?(0,n.i$)(r):(0,n.Iu)((0,n.i$)(r),t);if(1===t)return(0,n.rY)(r);if(t>1)return(0,n.di)(r,t);const s=e;return s.from?s.from:(0,n.se)(s)}(h):d&&(t=Array.isArray(d)?(0,n.Ls)((0,n.N7)(d[0])):(0,n.N7)(d)),e.cast=function(e,t){if(e||t)return e?t?(i,r)=>t(e(i,r),r):e:t}(e.cast,t)}(0,o.tz)(c,e),e.range&&(c.cast=(0,n.Eg)(c.cast,e.range))}}function c(e,t,i){const r=(0,o.Oe)(e,i);r.json||(r.json={});let n=r.json;return void 0!==t&&(n.origins||(n.origins={}),n.origins[t]||(n.origins[t]={}),n=n.origins[t]),n}},34248:(e,t,i)=>{i.d(t,{r:()=>n});var r=i(81977);function n(e,t,i){let n,s;return void 0===t||Array.isArray(t)?(s=e,i=t,n=[void 0]):(s=t,n=Array.isArray(e)?e:[e]),(e,t)=>{const o=e.constructor.prototype;n.forEach((n=>{const a=(0,r.CJ)(e,n,s);a.read&&"object"==typeof a.read||(a.read={}),a.read.reader=o[t],i&&(a.read.source=(a.read.source||[]).concat(i))}))}}},2107:(e,t,i)=>{function r(e){return(t,i)=>{t[i]=e}}i.d(t,{c:()=>r})},40266:(e,t,i)=>{i.d(t,{j:()=>h});i(39994);var r=i(13802),n=i(91421),s=i(66175),o=i(41610),a=i(55860),l=i(48616);const c=new Set,u=new Set;function h(e){return t=>{e??="esri.core.Accessor",t.prototype.declaredClass=e,p(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!c.has(s.initialize)&&(c.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!u.has(s.destroy)&&(u.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);c.clear(),u.clear();const a=class extends t{constructor(...e){if(super(...e),this.constructor===a&&"function"==typeof this.postscript){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let e=i.length-1;e>=0;e--)i[e].call(this)}}),r.length){let e=!1;const t=this[n.l];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!e){e=!0,t.call(this);for(let e=0;e<r.length;e++)r[e].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};a.__accessorMetadata__=(0,o.fp)(t.prototype),a.prototype.declaredClass=e;const l=(e||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(a,"name",{value:l,configurable:!0}),a}}function d(e,t){return null==t.get?function(){const t=this.__accessor__,i=t.propertiesByName.get(e);if(void 0===i)return;t.mutable&&(0,a.it)(i);const r=t.store;return r.has(e)?r.get(e):i.metadata.value}:function(){const t=this.__accessor__,i=t.propertiesByName.get(e);if(void 0!==i)return i.getComputed(t)}}function p(e){const t=e.prototype,i=(0,o.fp)(t),r={};for(const e of Object.getOwnPropertyNames(i)){const t=i[e];(0,l.OM)(t),r[e]={enumerable:!0,configurable:!0,get:d(e,t),set(i){const r=this.__accessor__;if(void 0!==r){if(r.mutable)return r.initialized&&t.readOnly?f("read-only",e):r.lifecycle===s.F.CONSTRUCTED&&t.constructOnly?f("construct-only",e):void r.set(e,i)}else Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:i})}}}Object.defineProperties(e.prototype,r)}const f=(e,t)=>{r.Z.getLogger("esri.core.Accessor").error(`cannot assign to ${e} property '${t}'`)}},39835:(e,t,i)=>{i.d(t,{c:()=>n});var r=i(81977);function n(e,t,i){let n,s;return void 0===t?(s=e,n=[void 0]):"string"!=typeof t?(s=e,n=[void 0],i=t):(s=t,n=Array.isArray(e)?e:[e]),(e,t)=>{const o=e.constructor.prototype;for(const a of n){const n=(0,r.CJ)(e,a,s);n.write&&"object"==typeof n.write||(n.write={}),i&&(n.write.target=i),n.write.writer=o[t]}}}},20701:(e,t,i)=>{i.d(t,{M:()=>n});var r=i(65943);function n(e,t,i){t.keys().forEach((e=>{i.set(e,t.get(e),r.s3.DEFAULTS)}));const n=e.metadata;Object.keys(n).forEach((t=>{e.internalGet(t)&&i.set(t,e.internalGet(t),r.s3.DEFAULTS)}))}},27281:(e,t,i)=>{i.d(t,{$c:()=>f,Hg:()=>m,jW:()=>d,uD:()=>p,xb:()=>g});var r=i(74396),n=i(41831),s=i(95620);const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof r.Z}function l(e){return e instanceof n.Z?Object.keys(e.items):a(e)?(0,s.vw)(e).keys():e?Object.keys(e):[]}function c(e,t){return e instanceof n.Z?e.items[t]:e[t]}function u(e){return e?e.declaredClass:null}function h(e,t){const i=e.diff;if(i&&"function"==typeof i)return i(e,t);const r=l(e),n=l(t);if(0===r.length&&0===n.length)return;if(!r.length||!n.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const s=n.filter((e=>!r.includes(e))),d=r.filter((e=>!n.includes(e))),p=r.filter((i=>n.includes(i)&&c(e,i)!==c(t,i))).concat(s,d).sort(),f=u(e);if(f&&o.has(f)&&p.length)return{type:"complete",oldValue:e,newValue:t};let m;const g=a(e)&&a(t);for(const r of p){const n=c(e,r),s=c(t,r);let o;if((g||"function"!=typeof n&&"function"!=typeof s)&&n!==s&&(null!=n||null!=s)){if(i&&i[r]&&"function"==typeof i[r])o=i[r]?.(n,s);else if(n instanceof Date&&s instanceof Date){if(n.getTime()===s.getTime())continue;o={type:"complete",oldValue:n,newValue:s}}else o="object"==typeof n&&"object"==typeof s&&u(n)===u(s)?h(n,s):{type:"complete",oldValue:n,newValue:s};null!=o&&(null!=m?m.diff[r]=o:m={type:"partial",diff:{[r]:o}})}}return m}function d(e,t){return p(e,t)}function p(e,t){if(null==e)return!1;const i=t.split(".");let r=e;for(const e of i){if("complete"===r.type)return!0;if("partial"!==r.type)return!1;{const t=r.diff[e];if(!t)return!1;r=t}}return!0}function f(e,t){if(!e)return!1;if("partial"===e.type){const i=Object.keys(e.diff);return 1===i.length&&i[0]===t}return!1}function m(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:h(e,t)}function g(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!g(e))return!1;for(const e of t.removed)if(!g(e))return!1;for(const e of t.changed)if(!g(e))return!1;return!0}case"partial":for(const t in e.diff)if(!g(e.diff[t]))return!1;return!0}}},7283:(e,t,i)=>{i.d(t,{AY:()=>D,Eg:()=>d,Iu:()=>E,Ls:()=>T,N7:()=>O,TJ:()=>_,V5:()=>L,Zs:()=>l,di:()=>M,gB:()=>A,i$:()=>R,p2:()=>I,q9:()=>c,rY:()=>C,sY:()=>N,se:()=>x,vU:()=>u,z8:()=>P});i(39994);var r=i(13802),n=i(86114);const s=()=>r.Z.getLogger("esri.core.accessorSupport.ensureTypes");function o(e){return null==e?e:new Date(e)}function a(e){return null==e?e:!!e}function l(e){return null==e?e:e.toString()}function c(e,t=0){return null==e?e:(e=parseFloat(e),isNaN(e)?t:e)}function u(e){return null==e?e:Math.round(parseFloat(e))}function h(e){return null}function d(e,t){return i=>{let r=e(i);return null!=t.step&&(r=Math.round(r/t.step)*t.step),null!=t.min&&(r=Math.max(t.min,r)),null!=t.max&&(r=Math.min(t.max,r)),r}}function p(e){return e?.constructor&&void 0!==e.constructor.__accessorMetadata__}function f(e,t){return null!=t&&e&&!(t instanceof e)}function m(e){return e&&"isCollection"in e}function g(e){return e?.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function y(e,t){return!!p(t)&&(s().error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+v(e)+"'"),!0)}function _(e,t){return null==t?t:m(e)?function(e,t){if(!t?.constructor||!m(t.constructor))return y(e,t)?t:new e(t);const i=g(e.prototype.itemType),r=g(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(y(e,t),t):new e(t):t}(e,t):f(e,t)?y(e,t)?t:new e(t):t}function v(e){return e?.prototype?.declaredClass||"unknown"}const b=new WeakMap;function w(e){switch(e){case Number:return e=>c(e);case P:return u;case Boolean:return a;case String:return l;case Date:return o;case I:return h;default:return(0,n.s1)(b,e,(()=>_.bind(null,e)))}}function x(e,t){const i=w(e);return 1===arguments.length?i:i(t)}function T(e,t,i){return 1===arguments.length?T.bind(null,e):t?Array.isArray(t)?t.map((t=>e(t,i))):[e(t,i)]:t}function C(e,t){return 1===arguments.length?T((t=>x(e,t))):T((t=>x(e,t)),t)}function S(e,t,i){return 0!==t&&Array.isArray(i)?i.map((i=>S(e,t-1,i))):e(i)}function E(e,t,i){if(2===arguments.length)return i=>E(e,t,i);if(!i)return i;i=S(e,t,i);let r=t,n=i;for(;r>0&&Array.isArray(n);)r--,n=n[0];if(void 0!==n)for(let e=0;e<r;e++)i=[i];return i}function M(e,t,i){return 2===arguments.length?E((t=>x(e,t)),t):E((t=>x(e,t)),t,i)}function A(e){return!!Array.isArray(e)&&!e.some((t=>{const i=typeof t;return!("string"===i||"number"===i||"function"===i&&e.length>1)}))}function R(e,t){if(2===arguments.length)return R(e).call(null,t);const i=new Set,r=e.filter((e=>"function"!=typeof e)),n=e.filter((e=>"function"==typeof e));for(const t of e)"string"!=typeof t&&"number"!=typeof t||i.add(t);let o=null,a=null;return(e,t)=>{if(null==e)return e;const l=typeof e,c="string"===l||"number"===l;return c&&(i.has(e)||n.some((e=>"string"===l&&e===String||"number"===l&&e===Number)))||"object"===l&&n.some((t=>!f(e,t)))?e:(c&&r.length?(o||(o=r.map((e=>"string"==typeof e?`'${e}'`:`${e}`)).join(", ")),s().error("Accessor#set",`'${e}' is not a valid value for this property, only the following values are valid: ${o}`)):"object"==typeof e&&n.length?(a||(a=n.map((e=>v(e))).join(", ")),s().error("Accessor#set",`'${e}' is not a valid value for this property, value must be one of ${a}`)):s().error("Accessor#set",`'${e}' is not a valid value for this property`),t&&(t.valid=!1),null)}}function O(e,t){if(2===arguments.length)return O(e).call(null,t);const i={},r=[],n=[];for(const t in e.typeMap){const s=e.typeMap[t];i[t]=x(s),r.push(v(s)),n.push(t)}const o=()=>`'${r.join("', '")}'`,a=()=>`'${n.join("', '")}'`,l="string"==typeof e.key?t=>t[e.key]:e.key;return t=>{if(e.base&&!f(e.base,t))return t;if(null==t)return t;const r=l(t)||e.defaultKeyValue,n=i[r];if(!n)return s().error("Accessor#set",`Invalid property value, value needs to be one of ${o()}, or a plain object that can autocast (having .type = ${a()})`),null;if(!f(e.typeMap[r],t))return t;if("string"==typeof e.key&&!p(t)){const i={};for(const r in t)r!==e.key&&(i[r]=t[r]);return n(i)}return n(t)}}class P{}class I{}const L={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function D(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function N(e){switch(e.type){case"native":return x(e.value);case"array":return T(N(e.value));case"one-of":return function(e){let t=null;return(i,r)=>U(i,e)?i:(null==t&&(t=F(e)),s().error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}(e);default:return null}}function F(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case P:return"integer";case Date:return"date";case I:return"null";default:return v(e.value)}case"array":return`array of ${F(e.value)}`;case"one-of":{const t=e.values.map((e=>F(e)));return`one of ${t.slice(0,-1)} or ${t[t.length-1]}`}}return"unknown"}function U(e,t){if(null==e)return!0;switch(t.type){case"native":switch(t.value){case Number:case P:return"number"==typeof e;case Boolean:return"boolean"==typeof e;case String:return"string"==typeof e;case I:return null===e}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some((e=>!U(e,t.value)));case"one-of":return t.values.some((t=>U(e,t)))}}},48616:(e,t,i)=>{i.d(t,{hk:()=>u,HS:()=>h,Ah:()=>d,OM:()=>_});var r=i(7283);var n=i(3593);function s(e){if(e.json||(e.json={}),a(e.json),l(e.json),o(e.json),e.json.origins)for(const t in e.json.origins)a(e.json.origins[t]),l(e.json.origins[t]),o(e.json.origins[t]);return!0}function o(e){e.name&&(e.read&&"object"==typeof e.read?void 0===e.read.source&&(e.read.source=e.name):e.read={source:e.name},e.write&&"object"==typeof e.write?void 0===e.write.target&&(e.write.target=e.name):e.write={target:e.name})}function a(e){"boolean"==typeof e.read?e.read={enabled:e.read}:"function"==typeof e.read?e.read={enabled:!0,reader:e.read}:e.read&&"object"==typeof e.read&&void 0===e.read.enabled&&(e.read.enabled=!0)}function l(e){"boolean"==typeof e.write?e.write={enabled:e.write}:"function"==typeof e.write?e.write={enabled:!0,writer:e.write}:e.write&&"object"==typeof e.write&&void 0===e.write.enabled&&(e.write.enabled=!0)}var c=i(64626);function u(e,t){return p(e,"any",t?.origin)}function h(e,t){return p(e,"read",t?.origin)}function d(e,t){return p(e,"write",t?.origin)}function p(e,t,i){let r=e?.json;if(r?.origins&&i){let e;e="link-chart"===i?r.origins[i]&&("any"===t||t in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],e&&("any"===t||t in e)&&(r=e)}return r}function f(e){const t=function(e){return e.json.types?y(e.json):e.type?g(e):y(e)}(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?m(r):t;(0,n.U)(s,r,!1),r.types&&!r.write&&e.json.write?.enabled&&(r.write={...e.json.write}),(0,c.U)(s,r)}(0,n.U)(t,e.json,!0),(0,c.U)(t,e.json)}function m(e){return e.type?g(e):y(e)}function g(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!(0,r.gB)(i);)i=i[0],t++;return{type:i,ndimArray:t}}function y(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function _(e){s(e)&&(function(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const e in i)if(t[e]){const r=t[e];i[e].forEach((e=>{t[e]=r})),delete t[e]}}}(e),f(e))}},3593:(e,t,i)=>{i.d(t,{U:()=>c,d:()=>u});var r=i(13802),n=i(86745),s=i(96863),o=i(41610),a=i(15680);const l=()=>r.Z.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function c(e,t,i){e&&(!i&&!t.read||t.read?.reader||!1===t.read?.enabled||function(e){return"types"in e?g(e.types):m(e.type)}(e)&&(0,n.RB)("read.reader",u(e),t))}function u(e){const t=e.ndimArray??0;if(t>1)return function(e){const t=h(e),i=d.bind(null,t),r=e.ndimArray??0;return(e,t,n)=>{if(null==e)return e;e=i(e,n,r);let s=r,o=e;for(;s>0&&Array.isArray(o);)s--,o=o[0];if(void 0!==o)for(let t=0;t<s;t++)e=[e];return e}}(e);if(1===t)return p(e);if("type"in e&&f(e.type)){const t=e.type.prototype?.itemType?.Type,i=p("function"==typeof t?{type:t}:{types:t});return(t,r,n)=>{const s=i(t,r,n);return s?new e.type(s):s}}return h(e)}function h(e){return"type"in e?function(e){return e.prototype.read?(t,i,r)=>{if(null==t)return t;const n=typeof t;if("object"!==n)return void l().error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${n}'`);const s=new e;return s.read(t,r),s}:e.fromJSON}(e.type):function(e){let t=null;const i=e.errorContext??"type",r=e.validate;return(n,a,c)=>{if(null==n)return n;const u=typeof n;if("object"!==u)return void l().error(`Expected JSON value of type 'object' to deserialize, but got '${u}'`);t||(t=function(e){const t={};for(const i in e.typeMap){const r=e.typeMap[i],n=(0,o.fp)(r.prototype);if("function"==typeof e.key)continue;const s=n[e.key];if(!s)continue;if(s.json?.type&&Array.isArray(s.json.type)&&1===s.json.type.length&&"string"==typeof s.json.type[0]){t[s.json.type[0]]=r;continue}const a=s.json?.write;if(!a?.writer){t[i]=r;continue}const l=a.target,c="string"==typeof l?l:e.key,u={};a.writer(i,u,c),u[c]&&(t[u[c]]=r)}return t}(e));const h=e.key;if("string"!=typeof h)return;const d=n[h],p=d?t[d]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!p){const e=`Type '${d||"unknown"}' is not supported`;return c?.messages&&n&&c.messages.push(new s.Z(`${i}:unsupported`,e,{definition:n,context:c})),void l().error(e)}const f=new p;return f.read(n,c),r?r(f):f}}(e.types)}function d(e,t,i,r){return 0!==r&&Array.isArray(t)?t.map((t=>d(e,t,i,r-1))):e(t,void 0,i)}function p(e){const t=h(e);return(e,i,r)=>{if(null==e)return e;if(Array.isArray(e)){const i=[];for(const n of e){const e=t(n,void 0,r);void 0!==e&&i.push(e)}return i}const n=t(e,void 0,r);return void 0!==n?[n]:void 0}}function f(e){if(!(0,a.u)(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&("function"==typeof t.Type?m(t.Type):g(t.Type))}function m(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||f(e))}function g(e){for(const t in e.typeMap)if(!m(e.typeMap[t]))return!1;return!0}},15680:(e,t,i)=>{function r(e){return!!e&&e.prototype?.declaredClass&&0===e.prototype.declaredClass.indexOf("esri.core.Collection")}i.d(t,{u:()=>r})},64626:(e,t,i)=>{i.d(t,{U:()=>a,k:()=>h});var r=i(70375),n=i(13802),s=i(86745),o=i(15680);function a(e,t){if(!t.write||t.write.writer||!1===t.write.enabled&&!t.write.overridePolicy)return;const i=e?.ndimArray??0;e&&(1===i||"type"in e&&(0,o.u)(e.type))?t.write.writer=d:i>1?t.write.writer=function(e){return(t,i,r,n)=>{let o;if(null===t)o=null;else{o=p(t,n,e);let i=e,r=o;for(;i>0&&Array.isArray(r);)i--,r=r[0];if(void 0!==r)for(let e=0;e<i;e++)o=[o]}(0,s.RB)(r,o,i)}}(i):t.types?Array.isArray(t.types)?t.write.writer=function(e){return(t,i,r,n)=>t&&Array.isArray(t)?c(t.filter((t=>l(t,e,n))),i,r,n):c(t,i,r,n)}(t.types[0]):t.write.writer=function(e){return(t,i,r,n)=>t?l(t,e,n)?c(t,i,r,n):void 0:c(t,i,r,n)}(t.types):t.write.writer=c}function l(e,t,i){for(const i in t.typeMap)if(e instanceof t.typeMap[i])return!0;if(i?.messages){const s=t.errorContext??"type",o=`Values of type '${("function"!=typeof t.key?e[t.key]:e.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new r.Z(`${s}:unsupported`,o,{definition:e,context:i})),n.Z.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(o)}return!1}function c(e,t,i,r){(0,s.RB)(i,u(e,r),t)}function u(e,t){return e&&"function"==typeof e.write?e.write({},t):e&&"function"==typeof e.toJSON?e.toJSON():"number"==typeof e?h(e):e}function h(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function d(e,t,i,r){let n;null===e?n=null:e&&"function"==typeof e.map?(n=e.map((e=>u(e,r))),"function"==typeof n.toArray&&(n=n.toArray())):n=[u(e,r)],(0,s.RB)(i,n,t)}function p(e,t,i){return 0!==i&&Array.isArray(e)?e.map((e=>p(e,t,i-1))):u(e,t)}},51777:(e,t,i)=>{i.d(t,{$z:()=>o,Gg:()=>l,U2:()=>a});var r=i(95620);function n(e,t){const i="?"===e[e.length-1]?e.slice(0,-1):e;if(null!=t.getItemAt||Array.isArray(t)){const e=parseInt(i,10);if(!isNaN(e))return Array.isArray(t)?t[e]:t.at(e)}const n=(0,r.vw)(t);return(0,r.b6)(n,i)?n.get(i):t[i]}function s(e,t,i){if(null==e)return e;const r=n(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:s(r,t,i+1)}function o(e,t,i=0){return"string"!=typeof t||t.includes(".")?s(e,(0,r.NI)(t),i):n(t,e)}function a(e,t){return o(e,t)}function l(e,t){return void 0!==o(t,e)}},66175:(e,t,i)=>{var r;i.d(t,{F:()=>r}),function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED",e[e.DESTROYED=3]="DESTROYED"}(r||(r={}))},47216:(e,t,i)=>{i.d(t,{C:()=>r});const r=["operational-layers","basemap","ground"]},41610:(e,t,i)=>{i.d(t,{Oe:()=>o,fp:()=>s,tz:()=>a});var r=i(67134),n=i(95620);function s(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){t=Object.create(t);for(const e in t)t[e]=(0,r.d9)(t[e]);Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t={},Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function o(e,t){const i=s(e);let r=i[t];return r||(r=i[t]={}),r}function a(e,t){return(0,n.TS)(e,t,c)}const l=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function c(e){return l.test(e)?"replace":"merge"}},50516:(e,t,i)=>{i.d(t,{D:()=>n});var r=i(71760);function n(e){e?.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:t,newOrigin:i})=>{(0,r.l)(e)&&i&&e.originOf(t)!==i&&e.updateOrigin(t,i)}))}},70148:(e,t,i)=>{i.d(t,{$:()=>h,i:()=>u});var r=i(51777),n=i(95620),s=i(48616);function o(e,t,i){if(!e?.read||!1===e.read.enabled||!e.read.source)return!1;const n=e.read.source;if("string"==typeof n){if(n===t)return!0;if(n.includes(".")&&0===n.indexOf(t)&&(0,r.Gg)(n,i))return!0}else for(const e of n){if(e===t)return!0;if(e.includes(".")&&0===e.indexOf(t)&&(0,r.Gg)(e,i))return!0}return!1}function a(e,t,i,r,n){let a=(0,s.HS)(t[i],n);(function(e){return e&&(!e.read||!1!==e.read.enabled&&!e.read.source)})(a)&&(e[i]=!0);for(const l of Object.getOwnPropertyNames(t))a=(0,s.HS)(t[l],n),o(a,i,r)&&(e[l]=!0)}function l(e,t,i,r){const n=i.metadata,o=(0,s.hk)(n[t],r)?.default;if(void 0===o)return;const a="function"==typeof o?o.call(e,t,r):o;void 0!==a&&i.set(t,a)}const c={origin:"service"};function u(e,t,i=c){if(!t||"object"!=typeof t)return;const o=(0,n.vw)(e),u=o.metadata,h={};for(const e of Object.getOwnPropertyNames(t))a(h,u,e,t,i);o.setDefaultOrigin(i.origin);for(const n of Object.getOwnPropertyNames(h)){const a=(0,s.HS)(u[n],i).read,l=a?.source;let c;c=l&&"string"==typeof l?(0,r.$z)(t,l):t[n],a?.reader&&(c=a.reader.call(e,c,t,i)),void 0!==c&&o.set(n,c)}if(!i||!i.ignoreDefaults){o.setDefaultOrigin("defaults");for(const t of Object.getOwnPropertyNames(u))h[t]||l(e,t,o,i)}o.setDefaultOrigin("user")}function h(e,t,i,r=c){const n={...r,messages:[]};i(n),n.messages?.forEach((t=>{"warning"!==t.type||e.loaded?r?.messages&&r.messages.push(t):e.loadWarnings.push(t)}))}},33156:(e,t,i)=>{i.d(t,{t:()=>o});var r=i(70375),n=i(39994),s=(i(13802),i(51777));function o(e,t,i){if(e&&t)if("object"==typeof t)for(const i of Object.getOwnPropertyNames(t))o(e,i,t[i]);else{if(t.includes(".")){const r=t.split("."),n=r.splice(-1,1)[0];return void o((0,s.U2)(e,r),n,i)}const r=e.__accessor__;null!=r&&a(t,r),e[t]=i}}function a(e,t){if((0,n.Z)("esri-unknown-property-errors")&&!function(e,t){return null!=t.metadata[e]}(e,t))throw new r.Z("set:unknown-property",function(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}(e,t))}},55860:(e,t,i)=>{i.d(t,{GF:()=>v,LJ:()=>d,gb:()=>p,it:()=>c,mS:()=>y});i(39994);var r=i(13802),n=i(95620),s=i(38488);const o=new(i(63541).P),a=[];let l=o;function c(e){l.onAccessed(e)}let u=!1,h=!1;function d(e,t,i){if(u)return f(e,t,i);let r=null;return m(e),r=t.call(i),g(),r}function p(e,t){return d(o,e,t)}function f(e,t,i){const n=u;u=!0,m(e);let s=null;try{s=t.call(i)}catch(e){h&&r.Z.getLogger("esri.core.accessorSupport.tracking").error(e)}return g(),u=n,s}function m(e){l=e,a.push(e)}function g(){const e=a.length;if(e>1){const t=a.pop();l=a[e-2],t.onTrackingEnd()}else if(1===e){const e=a.pop();l=o,e.onTrackingEnd()}else l=o}function y(e,t){if(t.flags&s.v.DepTrackingInitialized)return;t.flags|=s.v.DepTrackingInitialized;const i=h;h=!1,t.flags&s.v.AutoTracked?f(t.trackingTarget,t.metadata.get,e):v(e,t),h=i}const _=[];function v(e,t){t.flags&s.v.ExplicitlyTracking||(t.flags|=s.v.ExplicitlyTracking,f(t.trackingTarget,(()=>{const i=t.metadata.dependsOn||_;for(const t of i)if("string"!=typeof t||t.includes(".")){const i=(0,n.NI)(t);for(let t=0,r=e;t<i.length&&null!=r&&"object"==typeof r;++t)r=b(r,i[t],t!==i.length-1)}else b(e,t,!1)})),t.flags&=~s.v.ExplicitlyTracking)}function b(e,t,i){const r="?"===t[t.length-1]?t.slice(0,-1):t;if(null!=e.getItemAt||Array.isArray(e)){const t=parseInt(r,10);if(!isNaN(t))return Array.isArray(e)?e[t]:e.at(t)}const s=(0,n.vw)(e);if(s){const t=s.propertiesByName.get(r);t&&(c(t),y(e,t))}return i?e[r]:void 0}},38488:(e,t,i)=>{var r;i.d(t,{v:()=>r}),function(e){e[e.Dirty=1]="Dirty",e[e.Overridden=2]="Overridden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"}(r||(r={}))},26096:(e,t,i)=>{i.d(t,{s:()=>n});var r=i(49210);class n extends r.s{notify(){const e=this._observers;if(e&&e.length>0){const t=e.slice();for(const e of t)e.onInvalidated(),e.onCommitted()}}}},24163:(e,t,i)=>{i.d(t,{M:()=>n});var r=i(63541);class n extends r.P{constructor(e){super(new s(e)),this._observer&&o.register(this,new WeakRef(this._observer),this)}destroy(){this._observer&&o.unregister(this._observer),this.accessed?.clear(),this.clear(),this._observer?.destroy()}}class s{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(1===e)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=a}}const o=new FinalizationRegistry((e=>{e.deref()?.destroy()}));function a(){}},63541:(e,t,i)=>{i.d(t,{P:()=>r});class r{constructor(e){this.accessed=void 0,this._handles=void 0,this._observer=e}destroy(){this.accessed?.clear(),this.clear()}onAccessed(e){null!=this._observer&&e!==this._observer&&(null==this.accessed&&(this.accessed=new Set),this.accessed.add(e))}onTrackingEnd(){null!=this._observer&&(this.clear(),null!=this.accessed&&(null==this._handles&&(this._handles=[]),this.accessed.forEach((e=>{this._handles.push(e.observe(this._observer))})),this.accessed.clear()))}clear(){if(null!=this._handles){for(let e=0;e<this._handles.length;++e)this._handles[e].remove();this._handles.length=0}}}},63235:(e,t,i)=>{i.d(t,{EH:()=>u,U5:()=>l,Xz:()=>c});var r=i(23148),n=i(55860),s=i(24163);let o=!1;const a=[];function l(e,t){let i=new s.M((function r(){if(!i||l)return;if(o)return void h(r);const s=a;i.clear(),o=!0,l=!0,a=(0,n.LJ)(i,e),l=!1,o=!1,t(a,s),d()})),a=null,l=!1;return l=!0,a=(0,n.LJ)(i,e),l=!1,(0,r.kB)((function(){i&&(i.destroy(),i=null,a=null)}))}function c(e,t){let i=new s.M((function(){t(o,a)})),o=null;function a(){return i?(i.clear(),o=(0,n.LJ)(i,e),o):null}return a(),(0,r.kB)((function(){i&&(i.destroy(),i=null),o=null}))}function u(e,t){let i=!1,a=!1;const l=!!t?.sync;let c=new s.M((()=>{i||a||(a=!0,l?u():queueMicrotask(u))}));function u(){a=!1,c&&!i&&(o?h(u):(c.clear(),o=!0,i=!0,(0,n.LJ)(c,e),i=!1,o=!1,d()))}return i=!0,(0,n.LJ)(c,e),i=!1,(0,r.kB)((function(){c&&(c.destroy(),c=null)}))}function h(e){a.includes(e)||a.unshift(e)}function d(){for(;a.length;)a.pop()()}},95620:(e,t,i)=>{i.d(t,{NI:()=>c,Qc:()=>h,TS:()=>a,b6:()=>o,vw:()=>s});var r=i(23148),n=i(67134);function s(e){return e.__accessor__??null}function o(e,t){return null!=e?.metadata?.[t]}function a(e,t,i){return l(e,t,i?{policy:i,path:""}:null)}function l(e,t,i){return t?Object.keys(t).reduce(((e,r)=>{const s=r;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${r}`:r,a=i.policy(o)),"replace"===a)return e[s]=t[s],e;if("replace-arrays"===a&&Array.isArray(e[s]))return e[s]=t[s],e;if(void 0===e[s])return e[s]=(0,n.d9)(t[s]),e;let c=e[s],u=t[s];if(c===u)return e;if(Array.isArray(u)||Array.isArray(e))c=c?Array.isArray(c)?e[s]=c.slice():e[s]=[c]:e[s]=[],u&&(Array.isArray(u)||(u=[u]),u.forEach((e=>{c.includes(e)||c.push(e)})));else if(u&&"object"==typeof u)if(i){const t=i.path;i.path=o,e[s]=l(c,u,i),i.path=t}else e[s]=l(c,u,null);else e.hasOwnProperty(r)&&!t.hasOwnProperty(r)||(e[s]=u);return e}),e||{}):e}function c(e){return Array.isArray(e)?e:e.split(".")}function u(e){return e.includes(",")?e.split(",").map((e=>e.trim())):[e.trim()]}function h(e,t,i,n){const s=function(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...u(i));return t}return u(e)}(t);if(1!==s.length){const t=s.map((t=>n(e,t,i)));return(0,r.AL)(t)}return n(e,s[0],i)}},81509:(e,t,i)=>{i.d(t,{BT:()=>w,Fs:()=>S,NC:()=>A,YP:()=>E,aQ:()=>M});var r,n=i(50904),s=i(23148),o=i(67134),a=i(2497),l=i(17262),c=i(19784),u=i(7958),h=i(51777),d=i(66175),p=i(63235),f=i(95620);!function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"}(r||(r={}));class m{constructor(){this.uid=(0,u.D)(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,t,i,n,s){return this.pool.acquire(r.Untracked,e,t,i,n,s,o.fS)}static acquireTracked(e,t,i,n){return this.pool.acquire(r.Tracked,e,t,i,null,null,n)}notify(e,t){this.type===r.Untracked?this.callback.call(this.target,e,t,this.path,this.target):this.callback.call(null,e,t,void 0,void 0)}acquire(e,t,i,r,n,s,o){this.uid=(0,u.D)(),this.removed=!1,this.type=e,this.oldValue=t,this.callback=i,this.getValue=r,this.target=n,this.path=s,this.equals=o}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=(0,u.D)(),this.removed=!0}}m.pool=new a.e(m);const g=new n.Z,y=new Set;let _;function v(e){y.delete(e),y.add(e),_||(_=(0,l.Os)(x))}function b(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function w(e){for(const t of y.values())t.target===e&&(t.removed=!0)}function x(){let e=10;for(;_&&e--;){_=null;const e=T(),t=g.acquire();for(const i of e){const e=i.uid;b(i),e===i.uid&&i.removed&&t.push(i)}for(const e of y)e.removed&&(t.push(e),y.delete(e));for(const e of t)m.pool.release(e);g.release(t),g.release(e),C.forEach((e=>e()))}}function T(){const e=g.acquire();e.length=y.size;let t=0;for(const i of y)e[t]=i,++t;return y.clear(),e}const C=new Set;function S(e){return C.add(e),(0,s.kB)((()=>C.delete(e)))}function E(e,t,i,r=!1){return e.__accessor__&&e.__accessor__.lifecycle!==d.F.DESTROYED?r?function(e,t,i){const r=(0,f.Qc)(e,t,i,((e,t,i)=>{let n=!1;return(0,p.U5)((()=>(0,h.$z)(e,t)),((s,a)=>{e.__accessor__.lifecycle!==d.F.DESTROYED?n||(n=!0,(0,o.fS)(a,s)||i.call(e,s,a,t,e),n=!1):r.remove()}))}));return r}(e,t,i):function(e,t,i){let r=(0,f.Qc)(e,t,i,((e,t,i)=>{let n,o,a=(0,p.Xz)((()=>(0,h.$z)(e,t)),((s,a)=>{e.__accessor__?.lifecycle===d.F.DESTROYED||n&&n.uid!==o?r.remove():(n||(n=m.acquireUntracked(s,i,a,e,t),o=n.uid),v(n))}));return(0,s.kB)((()=>{a.remove(),n&&(n.uid!==o||n.removed||(n.removed=!0,v(n)),n=null),r=a=null}))}));return r}(e,t,i):(0,s.kB)()}function M(e,t,i=!1,r=o.y7){return i?function(e,t,i){let r=!1;return(0,p.U5)(e,((e,n)=>{r||(r=!0,i(n,e)||t(e,n),r=!1)}))}(e,t,r):function(e,t,i){let r,n,o=(0,p.Xz)(e,((e,s)=>{r&&r.uid!==n?o.remove():(r||(r=m.acquireTracked(e,t,s,i),n=r.uid),v(r))}));return(0,s.kB)((()=>{o.remove(),r&&(r.uid!==n||r.removed||(r.removed=!0,v(r)),r=null),o=null}))}(e,t,r)}function A(e){return(0,c.fn)(y,(t=>t.oldValue===e))}},86561:(e,t,i)=>{i.d(t,{c:()=>p,d:()=>d});var r=i(7753),n=i(70375),s=i(13802),o=i(51777),a=i(65943),l=i(95620),c=i(48616);function u(e,t,i,r,n){const s={};return t.write?.writer?.call(e,r,s,i,n),s}function h(e,t,i,l,c,u){if(!l?.write)return!1;const h=(0,o.U2)(e,i);if(!c&&l.write.overridePolicy){const t=l.write.overridePolicy.call(e,h,i,u??void 0);void 0!==t&&(c=t)}if(c||(c=l.write),!c||!1===c.enabled)return!1;if(c.layerContainerTypes&&u?.layerContainerType&&!c.layerContainerTypes.includes(u.layerContainerType))return!1;if((null===h&&!c.allowNull&&!c.writerEnsuresNonNull||void 0===h)&&c.isRequired){const t=new n.Z("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return t&&u?.messages?u.messages.push(t):t&&!u&&s.Z.getLogger("esri.core.accessorSupport.write").error(t.name,t.message),!1}return void 0!==h&&(!(null===h&&!c.allowNull&&!c.writerEnsuresNonNull)&&(!(!(c.alwaysWriteDefaults||t.store.multipleOriginsSupported&&t.store.originOf(i)!==a.s3.DEFAULTS)&&function(e,t,i,n,s){const o=n.default;if(void 0===o)return!1;if(null!=n.defaultEquals)return n.defaultEquals(s);if("function"==typeof o){if(Array.isArray(s)){const n=o.call(e,t,i??void 0);return(0,r.fS)(n,s)}return!1}return o===s}(e,i,u,l,h))&&!(!c.ignoreOrigin&&u?.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<(0,a.M9)(u.origin))))}function d(e,t,i,r){const n=(0,l.vw)(e),s=n.metadata,o=(0,c.Ah)(s[t],r);return!!o&&h(e,n,t,o,i,r)}function p(e,t,i){if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return(0,l.TS)(t,e.toJSON(i));const r=(0,l.vw)(e),n=r.metadata;for(const s in n){const d=(0,c.Ah)(n[s],i);if(!h(e,r,s,d,void 0,i))continue;const p=(0,o.U2)(e,s),f=u(e,d,d.write&&"string"==typeof d.write.target?d.write.target:s,p,i);Object.keys(f).length>0&&(t=(0,l.TS)(t,f),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then((()=>(0,l.TS)(t,f,(()=>"replace-arrays"))))),i?.writtenProperties&&i.writtenProperties.push({target:e,propName:s,oldOrigin:(0,a.Wm)(r.store.originOf(s)),newOrigin:i.origin}))}return t}},7753:(e,t,i)=>{i.d(t,{$A:()=>g,$L:()=>o,FS:()=>S,FY:()=>x,Od:()=>A,SO:()=>y,TV:()=>M,Tw:()=>u,VV:()=>c,Vx:()=>d,_x:()=>s,cq:()=>v,e$:()=>b,e5:()=>p,fS:()=>h,hv:()=>T,ow:()=>O,p$:()=>a,pC:()=>R,sD:()=>C,vr:()=>m,zG:()=>f});var r=i(27755),n=i(4157);const s=1.5,o=1/s,a=.5;function l(e){return e}function c(e,t=l){return function(e,t=l){if(!e||0===e.length)return;let i=e[0],r=t(i);for(let n=1;n<e.length;++n){const s=e[n],o=Number(t(s));o>r&&(r=o,i=s)}return i}(e,(e=>-t(e)))}function u(e,t){return t?e.filter(((e,i,r)=>r.findIndex(t.bind(null,e))===i)):Array.from(new Set(e))}function h(e,t,i){if(null==e&&null==t)return!0;if(null==e||null==t||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function d(e,t){let i=e.length!==t.length;i&&(e.length=t.length);for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function p(e,t,i){let r,n;return i?(r=t.filter((t=>!e.some((e=>i(e,t))))),n=e.filter((e=>!t.some((t=>i(t,e)))))):(r=t.filter((t=>!e.includes(t))),n=e.filter((e=>!t.includes(e)))),{added:r,removed:n}}function f(e){return e&&"number"==typeof e.length}function m(e,t){const i=e.length;if(0===i)return[];const r=[];for(let n=0;n<i;n+=t)r.push(e.slice(n,n+t));return r}function g(e,t,i){const r=e.length;let n=0,s=r-1;for(;n<s;){const i=n+Math.floor((s-n)/2);t>e[i]?n=i+1:s=i}const o=e[n];return i?t>=e[r-1]?-1:o===t?n:n-1:o===t?n:-1}class y{constructor(){this.last=0}}const _=new y;function v(e,t,i,r){r=r||_;const n=Math.max(0,r.last-10);for(let s=n;s<i;++s)if(e[s]===t)return r.last=s,s;const s=Math.min(n,i);for(let i=0;i<s;++i)if(e[i]===t)return r.last=i,i;return-1}function b(e,t,i,n){const s=i??e.length,o=v(e,(0,r.CY)(t),s,n);if(-1!==o)return e[o]=e[s-1],null==i&&e.pop(),t}const w=new Set;function x(e,t,i=e.length,r=t.length,n,s){if(0===r||0===i)return i;w.clear();for(let e=0;e<r;++e)w.add(t[e]);n=n||_;const o=Math.max(0,n.last-10);for(let t=o;t<i;++t)if(w.has(e[t])&&(s?.push(e[t]),w.delete(e[t]),e[t]=e[i-1],--i,--t,0===w.size||0===i))return w.clear(),i;for(let t=0;t<o;++t)if(w.has(e[t])&&(s?.push(e[t]),w.delete(e[t]),e[t]=e[i-1],--i,--t,0===w.size||0===i))return w.clear(),i;return w.clear(),i}function T(e,t){let i=0;for(let r=0;r<e.length;++r){const n=e[r];t(n,r)&&(e[i]=n,i++)}e.length=i}function C(e,t,i){const r=e.length;if(t>=r)return e.slice();const n=S(i),s=new Set,o=[];for(;o.length<t;){const t=Math.floor(n()*r);s.has(t)||(s.add(t),o.push(e[t]))}return o}function S(e){return e?(E.seed=e,()=>E.getFloat()):Math.random}const E=new n.Z;function M(e,t){const i=S(t);for(let t=e.length-1;t>0;t--){const r=Math.floor(i()*(t+1)),n=e[t];e[t]=e[r],e[r]=n}return e}function A(e,t){const i=e.indexOf(t);return-1!==i?(e.splice(i,1),t):null}function R(e,t){return null!=e}const O=[]},67979:(e,t,i)=>{i.d(t,{Ed:()=>c,UI:()=>u,mt:()=>f,q6:()=>p,vr:()=>g,w6:()=>m});var r=i(36663),n=i(74396),s=i(61681),o=i(78668),a=i(81977),l=i(40266);function c(e,t,i){return(0,o.as)(e.map(((e,r)=>t.apply(i,[e,r]))))}async function u(e,t,i){return(await(0,o.as)(e.map(((e,r)=>t.apply(i,[e,r]))))).map((e=>e.value))}function h(e){return{ok:!0,value:e}}function d(e){return{ok:!1,error:e}}async function p(e){if(null==e)return{ok:!1,error:new Error("no promise provided")};try{return h(await e)}catch(e){return d(e)}}async function f(e){try{return h(await e)}catch(e){return(0,o.r9)(e),d(e)}}function m(e){if(!0===e.ok)return e.value;throw e.error}function g(e,t){return new y(e,t)}let y=class extends n.Z{get value(){return function(e){return null!=e&&!0===e.ok?e.value:null}(this._result)}get error(){return function(e){return null!=e&&!1===e.ok?e.error:null}(this._result)}get finished(){return null!=this._result}constructor(e,t){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=(0,s.IM)(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then((e=>{this._result=h(e),this._cleanup()}),(e=>{this._result=d(e),this._cleanup()})),this._abortHandle=(0,o.fu)(t,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=(0,s.hw)(this._abortHandle),this._abortController=null}};(0,r._)([(0,a.Cb)()],y.prototype,"value",null),(0,r._)([(0,a.Cb)()],y.prototype,"error",null),(0,r._)([(0,a.Cb)()],y.prototype,"finished",null),(0,r._)([(0,a.Cb)()],y.prototype,"promise",void 0),(0,r._)([(0,a.Cb)()],y.prototype,"_result",void 0),y=(0,r._)([(0,l.j)("esri.core.asyncUtils.ReactiveTask")],y)},18234:(e,t,i)=>{i.d(t,{m:()=>n});var r=i(23148);const n=function(e){return{setTimeout:(t,i)=>{const n=e.setTimeout(t,i);return(0,r.kB)((()=>e.clearTimeout(n)))}}}(globalThis)},58811:(e,t,i)=>{i.d(t,{R:()=>s,Z:()=>n});var r=i(41831);function n(e,t,i=r.Z){return t||(t=new i),t===e||(t.removeAll(),function(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}(e)?t.addMany(e):e&&t.add(e)),t}function s(e){return e}},39043:(e,t,i)=>{i.d(t,{Ch:()=>k,EX:()=>M,G:()=>P,H0:()=>z,Ht:()=>D,K6:()=>A,O:()=>L,Y3:()=>C,_Y:()=>T,_j:()=>O,c9:()=>F,gp:()=>N,jQ:()=>c,mj:()=>R,nR:()=>U,sJ:()=>S,vG:()=>I,xr:()=>x});var r=i(30936),n=i(7753),s=i(67134),o=i(19431),a=i(56999),l=i(52721);function c(e){return"r"in e&&"g"in e&&"b"in e}function u(e){return"h"in e&&"s"in e&&"v"in e}function h(e){return"l"in e&&"a"in e&&"b"in e}function d(e){return"l"in e&&"c"in e&&"h"in e}const p=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],f=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function m(e,t){const i=[];let r,n;if(e[0].length!==t.length)throw new Error("dimensions do not match");const s=e.length,o=e[0].length;let a=0;for(r=0;r<s;r++){for(a=0,n=0;n<o;n++)a+=e[r][n]*t[n];i.push(a)}return i}function g(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),i=m(p,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function y(e){const t=m(f,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function _(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function v(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function b(e){return function(e){const t=e.l,i=e.a,r=e.b,n=Math.sqrt(i*i+r*r);let s=Math.atan2(r,i);return s=s>0?s:s+2*Math.PI,{l:t,c:n,h:s}}(_(g(e)))}function w(e){return y(v(function(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}(e)))}function x(e){return c(e)?e:d(e)?w(e):h(e)?function(e){return y(v(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?y(e):u(e)?function(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,n=r*i,s=n*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:n,g:s,b:0};break;case 1:o={r:s,g:n,b:0};break;case 2:o={r:0,g:n,b:s};break;case 3:o={r:0,g:s,b:n};break;case 4:o={r:s,g:0,b:n};break;case 5:case 6:o={r:n,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-n),o.g=Math.round(o.g+r-n),o.b=Math.round(o.b+r-n),o}(e):e}function T(e){return u(e)?e:function(e){const t=e.r,i=e.g,r=e.b,n=Math.max(t,i,r),s=n-Math.min(t,i,r);let o=n,a=0===s?0:n===t?(i-r)/s%6:n===i?(r-t)/s+2:(t-i)/s+4,l=0===s?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(x(e))}function C(e){return h(e)?e:function(e){return _(g(e))}(x(e))}function S(e){return d(e)?e:b(x(e))}function E(e){let{r:t,g:i,b:n,a:s}=e;return s<1&&(t=Math.round(s*t+255*(1-s)),i=Math.round(s*i+255*(1-s)),n=Math.round(s*n+255*(1-s))),new r.Z({r:t,g:i,b:n})}function M(e,t){const{r:i,g:r,b:n}=t?.ignoreAlpha?e:E(e);return.2126*i+.7152*r+.0722*n}var A;function R(e,t=A.High){return M(e,{ignoreAlpha:!0})>t?new r.Z([0,0,0,e.a]):new r.Z([255,255,255,e.a])}function O(e,t){const i=C(e);i.l*=1-t;const r=x(i),n=e.clone();return n.setColor(r),n.a=e.a,n}function P(e,t){const i=e.clone();return i.a*=t,i}function I(e,t){const i=T(e);i.s*=t;const r=x(i),n=e.clone();return n.setColor(r),n.a=e.a,n}function L(e){return r.Z.toUnitRGBA(e)}function D(e,t){return e===t||null!=e&&null!=t&&(0,a.e)(e,t)}function N(e){return(0,l.al)(e[0],e[1],e[2],e.length>3?e[3]:1)}function F(e){return e[0]??=0,e[1]??=0,e[2]??=0,e}function U(e){return e.length=4,F(e),e[3]??=1,(0,o.uZ)(e[3],0,1),e}function k(e,t){const i=r.Z.toUnitRGBA(e);return i[3]*=t,i}function z(e,t,i={}){if(0===e.length||t<=0)return[];if(1===(e=e.map((e=>"string"==typeof e?new r.Z(e):e))).length||1===t){const i=[],r=e[0];for(let e=0;e<t;e++)i.push(r.clone());return i}if(i.shuffle&&(e=(0,n.TV)((0,s.d9)(e),i.seed)),e.length>=t){const i=[],r=(e.length-1)/(t-1);for(let n=0;n<t;n++){const t=Math.round(n*r);i.push(e[t].clone())}return i}return function(e,t,i={}){const r=[],s=e.length-1,o=Math.ceil((t-e.length)/s);e:for(let n=0;n<s;n++){const s=e[n],a=e[n+1];for(let n=1;n<=o;n++){const l=n/(o+1);if(r.push(V(s,a,l,i)),r.length+e.length===t)break e}}return[...e.map((e=>e.clone())),...(0,n.TV)(r,i.seed??1)]}(e,t,i)}!function(e){e[e.Low=160]="Low",e[e.High=225]="High"}(A||(A={}));const B=(e,t)=>{const i=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+i))};function V(e,t,i,s={}){const o=e.r,a=e.g,l=e.b,c=t.r,u=t.g,h=t.b,d=Math.round(o+(c-o)*i),p=Math.round(a+(u-a)*i),f=Math.round(l+(h-l)*i);if(!s.offset)return new r.Z([d,p,f]);const m=(0,n.FS)(s.seed);return new r.Z([B(d,m),B(p,m),B(f,m)])}},27755:(e,t,i)=>{i.d(t,{Bg:()=>r,CY:()=>s,sM:()=>n});i(39994);function r(e){}function n(e){return()=>e}function s(e){return e}},59801:(e,t,i)=>{i.d(t,{Mr:()=>c,Pq:()=>a,XV:()=>l,bP:()=>u,x9:()=>h});var r=i(39994);const n=new WeakMap;function s(e,t,i=!1){const r=` DEPRECATED - ${t}`;if(!i)return void e.warn(r);let s=n.get(e);s||(s=new Set,n.set(e,s)),s.has(t)||(s.add(t),e.warn(r))}const o="https://www.esriurl.com/";function a(e,t,i,n={}){(0,r.Z)("esri-deprecation-warnings")&&h(e,`This widget is deprecated. Use the ${t} component instead.`,{see:[`${t} component reference: ${o}${i}/`,`Esri's move to web components: ${o}components-transition-plan/`],replacement:`<${i}></${i}>`,warnOnce:!0,...n})}function l(e,t,i={}){if((0,r.Z)("esri-deprecation-warnings")){const{moduleName:r}=i;h(e,"Function: "+((r?r+"::":"")+t+"()"),i)}}function c(e,t,i={}){if((0,r.Z)("esri-deprecation-warnings")){const{moduleName:r}=i;h(e,"Property: "+((r?r+"::":"")+t),i)}}function u(e,t,i={}){(0,r.Z)("esri-deprecation-warnings")&&h(e,`Multiple argument constructor: ${t}`,{warnOnce:!0,replacement:`new ${t}({ <your properties here> })`,...i})}function h(e,t,i={}){if((0,r.Z)("esri-deprecation-warnings")){const{replacement:r,version:n,see:o,warnOnce:a}=i;let l=t;if(r&&(l+=`\n\t Replacement: ${r}`),n&&(l+=`\n\t Version: ${n}`),o)if(Array.isArray(o)){l+="\n\t See for more details:";for(const e of o)l+=`\n\t\t${e}`}else l+=`\n\t See ${o} for more details.`;s(e,l,a)}}},59183:(e,t,i)=>{function r(e){return"string"==typeof e?document.getElementById(e):e??null}function n(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}i.d(t,{L:()=>r,Y:()=>n})},49546:(e,t,i)=>{i.d(t,{IH:()=>a,OP:()=>n,on:()=>o});var r=i(23148);function n(e){return function(e){return null!=e&&"object"==typeof e&&"on"in e&&"function"==typeof e.on}(e)||s(e)}function s(e){return null!=e&&"object"==typeof e&&"addEventListener"in e&&"function"==typeof e.addEventListener}function o(e,t,i){if(!n(e))throw new TypeError("target is not a Evented or EventTarget object");return s(e)?function(e,t,i,n){if(Array.isArray(t)){const s=t.slice();for(const t of s)e.addEventListener(t,i,n);return(0,r.kB)((()=>{for(const t of s)e.removeEventListener(t,i,n)}))}return e.addEventListener(t,i,n),(0,r.kB)((()=>e.removeEventListener(t,i,n)))}(e,t,i):e.on(t,i)}function a(e,t,i){if(!n(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=o(e,t,(t=>{r.remove(),i.call(e,t)}));return r}},73534:(e,t,i)=>{i.d(t,{I:()=>n,v:()=>s});var r=i(19431);function n(e,t,i=0){const n=(0,r.uZ)(e,0,l);for(let e=0;e<4;e++)t[i+e]=Math.floor(256*c(n*o[e]))}function s(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*a[r];return i}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},69079:(e,t,i)=>{i.d(t,{BN:()=>h,Yc:()=>d,em:()=>n,hZ:()=>u,mx:()=>c});var r=i(51366);const n="arial-unicode-ms",s="woff2",o=new Map,a=new Set;class l{constructor(e,t){this.fontFace=e,this.promise=t}}async function c(e){const t=p(e),i=d(e),n=o.get(t);if(n)return n.promise;const c=new FontFace(e.family,`url('${r.Z.fontsUrl}/woff2/${i}.${s}') format('${s}')`,{style:e.style,weight:e.weight}),u=document.fonts;if(u.has(c)&&"loading"===c.status)return c.loaded;const h=c.load().then((()=>(u.add(c),c)));return o.set(t,new l(c,h)),a.add(c),h}function u(e){return a.has(e)}function h(e){if(!e)return n;const t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}function d(e){const t=f(e)+m(e);return h(e.family)+(t.length>0?t:"-regular")}function p(e){const t=f(e)+m(e);return(e.family||n)+(t.length>0?t:"-regular")}function f(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function m(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},23148:(e,t,i)=>{i.d(t,{AL:()=>a,F2:()=>c,R5:()=>s,ed:()=>u,iU:()=>l,kB:()=>n,yV:()=>o});const r={remove:()=>{}};function n(e){return e?{remove(){e&&(e(),e=void 0)}}:r}function s(e){e.forEach((e=>e?.remove()))}function o(e){s(e),e.length=0}function a(e){return n((()=>s(e)))}function l(e){return n((()=>e()?.remove()))}function c(e){return n((()=>e?.abort()))}function u(e){return n(null!=e?()=>e.destroy():void 0)}},39994:(e,t,i)=>{let r;function n(e){return"function"==typeof r[e]?r[e]=r[e](globalThis):r[e]}i.d(t,{Z:()=>n}),r=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},n.add=(e,t,i,s)=>{(s||void 0===r[e])&&(r[e]=t),i&&n(e)},n.cache=r,n.add("big-integer-warning-enabled",!0),n.add("esri-deprecation-warnings",!0),n.add("esri-tests-disable-screenshots",!1),n.add("esri-tests-use-full-window",!1),n.add("esri-tests-post-to-influx",!0),n.add("esri-cim-animations-enable-status","enabled"),n.add("esri-cim-animations-spotlight",!1),n.add("esri-cim-animations-freeze-time",!1),n.add("enable-feature:multiple-highlights",!0),(()=>{n.add("host-webworker",void 0!==globalThis.WorkerGlobalScope&&self instanceof globalThis.WorkerGlobalScope);const e="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document;if(n.add("host-browser",e),n.add("host-node","object"==typeof globalThis.process&&globalThis.process.versions?.node&&globalThis.process.versions.v8),n.add("dom",e),n("host-browser")){const e=navigator,t=e.userAgent,i=e.appVersion,r=parseFloat(i);if(n.add("wp",parseFloat(t.split("Windows Phone")[1])||void 0),n.add("msapp",parseFloat(t.split("MSAppHost/")[1])||void 0),n.add("khtml",i.includes("Konqueror")?r:void 0),n.add("edge",parseFloat(t.split("Edge/")[1])||void 0),n.add("opr",parseFloat(t.split("OPR/")[1])||void 0),n.add("webkit",!n("wp")&&!n("edge")&&parseFloat(t.split("WebKit/")[1])||void 0),n.add("chrome",!n("edge")&&!n("opr")&&parseFloat(t.split("Chrome/")[1])||void 0),n.add("android",!n("wp")&&parseFloat(t.split("Android ")[1])||void 0),n.add("safari",!i.includes("Safari")||n("wp")||n("chrome")||n("android")||n("edge")||n("opr")?void 0:parseFloat(i.split("Version/")[1])),n.add("mac",i.includes("Macintosh")),!n("wp")&&/(iPhone|iPod|iPad)/.test(t)){const e=RegExp.$1.replace(/P/,"p"),i=/OS ([\d_]+)/.test(t)?RegExp.$1:"1",r=parseFloat(i.replace(/_/,".").replaceAll("_",""));n.add(e,r),n.add("ios",r)}n("webkit")||(!t.includes("Gecko")||n("wp")||n("khtml")||n("edge")||n.add("mozilla",r),n("mozilla")&&n.add("ff",parseFloat(t.split("Firefox/")[1]||t.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&n.add("esri-mobile",t),i&&n.add("esri-iPhone",i),n.add("esri-geolocation",!!navigator.geolocation)}n.add("esri-wasm","WebAssembly"in globalThis),n.add("esri-performance-mode-frames-between-render",20),n.add("esri-force-performance-mode",!1),n.add("esri-shared-array-buffer",(()=>{const e="SharedArrayBuffer"in globalThis,t=!1===globalThis.crossOriginIsolated;return e&&!t})),n.add("wasm-simd",(()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))),n.add("esri-atomics","Atomics"in globalThis),n.add("esri-workers","Worker"in globalThis),n.add("web-feat:cache","caches"in globalThis),n.add("esri-workers-arraybuffer-transfer",!n("safari")||Number(n("safari"))>=12),n.add("workers-pool-size",8),n.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),n.add("featurelayer-simplify-payload-size-factors",[1,1,4]),n.add("featurelayer-fast-triangulation-enabled",!0),n.add("featurelayer-animation-enabled",!0),n.add("featurelayer-snapshot-enabled",!0),n.add("featurelayer-snapshot-point-min-threshold",8e4),n.add("featurelayer-snapshot-point-max-threshold",4e5),n.add("featurelayer-snapshot-point-coverage",.1),n.add("featurelayer-query-max-depth",4),n.add("featurelayer-query-pausing-enabled",!1),n.add("featurelayer-advanced-symbols",!1),n.add("featurelayer-pbf",!0),n.add("featurelayer-pbf-statistics",!1),n.add("feature-layers-workers",!0),n.add("feature-polyline-generalization-factor",1),n.add("mapview-transitions-duration",200),n.add("mapview-essential-goto-duration",200),n.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),n.add("mapserver-pbf-version-support",10.81),n.add("mapservice-popup-identify-max-tolerance",20),n.add("request-queue-concurrency-hosted",16),n.add("request-queue-concurrency-non-hosted",4),n.add("curve-densification-coarse-segments",128),n.add("curve-densification-max-segments",2e3),n.add("curve-densification-min-segments",3),n.add("curve-densification-pixels-per-segment",16),n.add("view-readyState-waiting-delay",1e3),n.add("gradient-depth-bias",.01),n.add("gradient-depth-epsilon",1e-8),n("host-webworker")||n("host-browser")&&(n.add("esri-csp-restrictions",(()=>{try{new Function}catch{return!0}return!1})),n.add("esri-image-decode",(()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then((()=>{n.add("esri-image-decode",!0,!0,!0)})).catch((()=>{n.add("esri-image-decode",!1,!0,!0)}))}return!1})),n.add("esri-url-encodes-apostrophe",(()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")})))})()},8955:(e,t,i)=>{i.d(t,{Jl:()=>h,n$:()=>p,r7:()=>u});var r=i(66341),n=i(70375),s=i(78668),o=i(3466),a=i(53729);let l=null,c=!0;function u(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t)}catch(e){c=!1}return d(e,t,i)}function h(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t,i)}catch(e){c=!1}const n=d(t,i,r);return n.data.set(e,0),n}function d(e,t,i){return i||(l||(l=document.createElement("canvas"),l.width=1,l.height=1),i=l),i.getContext("2d").createImageData(e,t)}async function p(e,t){const{arrayBuffer:l,mediaType:c}=await async function(e,t){const i=(0,o.sJ)(e);if(i?.isBase64)return{arrayBuffer:(0,a.R)(i.data),mediaType:i.mediaType};const n=await(0,r.Z)(e,{responseType:"array-buffer",...t});return{arrayBuffer:n.data,mediaType:n.getHeader?.("Content-Type")??""}}(e,t),u="image/png"===c;if("image/gif"===c){const{isAnimatedGIF:e,parseGif:r}=await i.e(41637).then(i.bind(i,41637));if(e(l))return r(l,t)}if(u){const{isAnimatedPNG:e,parseApng:r}=await i.e(74325).then(i.bind(i,74325));if(e(l))return r(l,t)}return async function(e,t){const i=window.URL.createObjectURL(e);try{const{data:e}=await(0,r.Z)(i,{...t,responseType:"image"});return e}catch(e){if(!(0,s.D_)(e))throw new n.Z("invalid-image",`Could not fetch requested image at ${i}`);throw e}finally{window.URL.revokeObjectURL(i)}}(new Blob([l],{type:c}),t)}},99118:(e,t,i)=>{function r(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function n(e,t){for(const i of e)if(null!=i&&t(i))return i}function s(e){return null!=e&&"function"==typeof e[Symbol.iterator]}i.d(t,{Fs:()=>r,TW:()=>s,sE:()=>n})},25709:(e,t,i)=>{i.d(t,{X:()=>n,w:()=>o});var r=i(86745);class n{constructor(e,t={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=t,this.apiValues=[],this.jsonValues=[],this._apiToJSON=function(e){const t={};for(const i in e)t[e[i]]=i;return t}(e),this.apiValues=s(this._apiToJSON),this.jsonValues=s(this._jsonToAPI),this.read=e=>this.fromJSON(e),this.write=(e,t,i)=>{const n=this.toJSON(e);void 0!==n&&(0,r.RB)(i,n,t)},this.write.isJSONMapWriter=!0}toJSON(e){if(null==e)return null;if(this._apiToJSON.hasOwnProperty(e)){const t=this._apiToJSON[e];return this._options.useNumericKeys?+t:t}return this._options.ignoreUnknown?null:e}fromJSON(e){return null!=e&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}}function s(e){const t=[];for(const i in e)t.push(i);return t.sort(),t}function o(){return function(e,t){return new n(e,{ignoreUnknown:!0,...t})}}},67134:(e,t,i)=>{i.d(t,{Vo:()=>a,d9:()=>o,fS:()=>p,tZ:()=>l,y7:()=>f,yd:()=>s});var r=i(7753),n=i(86098);function s(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(void 0===e[i]?delete e[i]:e[i]instanceof Object&&s(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&void 0===e[i]&&delete e[i];return e}function o(e){if(!e||"object"!=typeof e||"function"==typeof e)return e;const t=d(e);if(null!=t)return t;if(l(e))return e.clone();if(c(e))return e.map(o);if(u(e))throw new Error("Trying to clone an unclonable Accessor instance");const i={};for(const t of Object.getOwnPropertyNames(e))i[t]=o(e[t]);return i}function a(e){if(!e||"object"!=typeof e||"function"==typeof e||"HTMLElement"in globalThis&&e instanceof HTMLElement)return e;const t=d(e);if(null!=t)return t;if(c(e)){let t=!0;const i=e.map((e=>{const i=a(e);return null!=e&&null==i&&(t=!1),i}));return t?i:null}if(l(e))return e.clone();if(e instanceof File||e instanceof Blob)return e;if(u(e))return null;const i=new(0,Object.getPrototypeOf(e).constructor);for(const t of Object.getOwnPropertyNames(e)){const r=e[t],n=a(r);if(null!=r&&null==n)return null;i[t]=n}return i}function l(e){return"function"==typeof e.clone}function c(e){return"function"==typeof e.map&&"function"==typeof e.forEach}function u(e){return"function"==typeof e.notifyChange&&"function"==typeof e.watch}function h(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function d(e){if((0,n.W0)(e)||(0,n.lq)(e)||(0,n.KZ)(e)||(0,n.z3)(e)||(0,n.Uc)(e)||(0,n.Hx)(e)||(0,n.ZY)(e)||(0,n.xZ)(e)||(0,n.fS)(e))return e.slice();if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;for(const[i,r]of e)t.set(i,o(r));return t}if(e instanceof Set){const t=new Set;for(const i of e)t.add(o(i));return t}return null}function p(e,t){return e===t||"number"==typeof e&&isNaN(e)&&"number"==typeof t&&isNaN(t)||"function"==typeof e?.getTime&&"function"==typeof t?.getTime&&e.getTime()===t.getTime()||!1}function f(e,t){return e===t||(null==e||"string"==typeof e?e===t:"number"==typeof e?e===t||"number"==typeof t&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&(0,r.fS)(e,t):e instanceof Set?t instanceof Set&&function(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}(e,t):e instanceof Map?t instanceof Map&&function(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const e=t.get(i);if(e!==r||void 0===e&&!t.has(i))return!1}return!0}(e,t):!!h(e)&&h(t)&&function(e,t){if(null===e||null===t)return!1;const i=Object.keys(e);if(null===t||Object.keys(t).length!==i.length)return!1;for(const r of i)if(e[r]!==t[r]||!Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}(e,t))}},43056:(e,t,i)=>{function r(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function n(e,t,i,r){const n=t[r],s=t[r+1];e[r]=i[0]*n+i[2]*s+i[4],e[r+1]=i[1]*n+i[3]*s+i[5]}function s(e,t,i,r=0,s=0,o=2){const a=s||t.length/o;for(let s=r;s<a;s++)n(e,t,i,s*o)}i.d(t,{Ue:()=>r,Zz:()=>s});Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},create:r,createView:function(e,t){return new Float32Array(e,t,6)},fromValues:function(e,t,i,r,n,s){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=n,o[5]=s,o},transform:n,transformMany:s},Symbol.toStringTag,{value:"Module"}))},71508:(e,t,i)=>{function r(){return[1,0,0,1,0,0]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}i.d(t,{Ue:()=>r,d9:()=>n});const s=[1,0,0,1,0,0];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:s,clone:n,create:r,createView:function(e,t){return new Float64Array(e,t,6)},fromValues:function(e,t,i,r,n,s){return[e,t,i,r,n,s]}},Symbol.toStringTag,{value:"Module"}))},38642:(e,t,i)=>{function r(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function n(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function s(e,t,i,r,n,s,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}i.d(t,{Ue:()=>r,al:()=>s,d9:()=>n});Object.freeze(Object.defineProperty({__proto__:null,clone:n,create:r,createView:function(e,t){return new Float32Array(e,t,9)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},3965:(e,t,i)=>{function r(){return[1,0,0,0,1,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function s(e,t,i,r,n,s,o,a,l){return[e,t,i,r,n,s,o,a,l]}i.d(t,{Ue:()=>r,Wd:()=>o,al:()=>s,d9:()=>n});const o=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:n,create:r,createView:function(e,t){return new Float64Array(e,t,9)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},3308:(e,t,i)=>{function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function s(e,t,i,r,n,s,o,a,l,c,u,h,d,p,f,m){return[e,t,i,r,n,s,o,a,l,c,u,h,d,p,f,m]}i.d(t,{Ue:()=>r,Wd:()=>o,al:()=>s,d9:()=>n});const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:n,create:r,createView:function(e,t){return new Float64Array(e,t,16)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},96303:(e,t,i)=>{function r(){return[0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3]]}function s(e,t,i,r){return[e,t,i,r]}i.d(t,{Ue:()=>r,Wd:()=>o,al:()=>s,d9:()=>n});const o=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:n,create:r,fromValues:s},Symbol.toStringTag,{value:"Module"}))},45867:(e,t,i)=>{function r(){return new Float32Array(2)}function n(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function s(){return r()}function o(){return n(1,1)}function a(){return n(1,0)}function l(){return n(0,1)}i.d(t,{AG:()=>c,Ue:()=>r,al:()=>n,hq:()=>u});const c=s(),u=o(),h=a(),d=l();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:h,UNIT_Y:d,ZEROS:c,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},create:r,createView:function(e,t){return new Float32Array(e,t,2)},fromValues:n,ones:o,unitX:a,unitY:l,zeros:s},Symbol.toStringTag,{value:"Module"}))},84164:(e,t,i)=>{function r(){return[0,0]}function n(e){return[e[0],e[1]]}function s(e,t){return[e,t]}function o(e,t=[0,0]){const i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function a(){return[0,0]}function l(){return s(1,1)}function c(){return s(1,0)}function u(){return s(0,1)}i.d(t,{AG:()=>h,E9:()=>p,IO:()=>f,Ue:()=>r,al:()=>s,d9:()=>n,hq:()=>d,ll:()=>a,nI:()=>o});const h=[0,0],d=l(),p=c(),f=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:p,UNIT_Y:f,ZEROS:h,clone:n,create:r,createView:function(e,t){return new Float64Array(e,t,2)},freeze:function(e,t){return[e,t]},fromArray:o,fromValues:s,ones:l,unitX:c,unitY:u,zeros:a},Symbol.toStringTag,{value:"Module"}))},17703:(e,t,i)=>{function r(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function o(){return r()}function a(){return s(1,1,1)}function l(){return s(1,0,0)}function c(){return s(0,1,0)}function u(){return s(0,0,1)}i.d(t,{Ue:()=>r,al:()=>s,d9:()=>n});const h=o(),d=a(),p=l(),f=c(),m=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:p,UNIT_Y:f,UNIT_Z:m,ZEROS:h,clone:n,create:r,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:s,ones:a,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},81095:(e,t,i)=>{function r(){return[0,0,0]}function n(e){return[e[0],e[1],e[2]]}function s(e,t,i){return[e,t,i]}function o(e,t,i){return[e,t,i]}function a(e,t=[0,0,0]){const i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function l(){return[0,0,0]}function c(){return s(1,1,1)}function u(){return s(1,0,0)}function h(){return s(0,1,0)}function d(){return s(0,0,1)}i.d(t,{AG:()=>p,E9:()=>m,IO:()=>g,Ue:()=>r,al:()=>s,d9:()=>n,eG:()=>y,hq:()=>f,iU:()=>c,ll:()=>l,nI:()=>a,tN:()=>d,vV:()=>o});const p=[0,0,0],f=c(),m=u(),g=h(),y=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:f,UNIT_X:m,UNIT_Y:g,UNIT_Z:y,ZEROS:p,clone:n,create:r,createView:function(e,t){return new Float64Array(e,t,3)},freeze:o,fromArray:a,fromValues:s,ones:c,unitX:u,unitY:h,unitZ:d,zeros:l},Symbol.toStringTag,{value:"Module"}))},55939:(e,t,i)=>{function r(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function o(){return r()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function u(){return s(0,0,1,0)}function h(){return s(0,0,0,1)}i.d(t,{AG:()=>d,al:()=>s,d9:()=>n});const d=o(),p=a(),f=l(),m=c(),g=u(),y=h();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:y,UNIT_X:f,UNIT_Y:m,UNIT_Z:g,ZEROS:d,clone:n,create:r,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:a,unitW:h,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},52721:(e,t,i)=>{function r(){return[0,0,0,0]}function n(e){return[e[0],e[1],e[2],e[3]]}function s(e,t,i,r){return[e,t,i,r]}function o(e,t,i,r){return[e,t,i,r]}function a(e,t=[0,0,0,0]){const i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function l(){return[0,0,0,0]}function c(){return s(1,1,1,1)}function u(){return s(1,0,0,0)}function h(){return s(0,1,0,0)}function d(){return s(0,0,1,0)}function p(){return s(0,0,0,1)}i.d(t,{AG:()=>f,Ue:()=>r,al:()=>s,d9:()=>n,hq:()=>m,nI:()=>a,vV:()=>o});const f=[0,0,0,0],m=c(),g=u(),y=h(),_=d(),v=p();Object.freeze(Object.defineProperty({__proto__:null,ONES:m,UNIT_W:v,UNIT_X:g,UNIT_Y:y,UNIT_Z:_,ZEROS:f,clone:n,create:r,createView:function(e,t){return new Float64Array(e,t,4)},freeze:o,fromArray:a,fromValues:s,ones:c,unitW:p,unitX:u,unitY:h,unitZ:d,zeros:l},Symbol.toStringTag,{value:"Module"}))},40201:(e,t,i)=>{i.d(t,{Dc:()=>c,FD:()=>s,bn:()=>n,c$:()=>l});let r=1e-6;function n(){return r}const s=Math.random,o=Math.PI/180,a=180/Math.PI;function l(e){return e*o}function c(e){return e*a}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:s,equals:function(e,t){return Math.abs(e-t)<=r*Math.max(1,Math.abs(e),Math.abs(t))},getEpsilon:n,setEpsilon:function(e){r=e},toDegree:c,toRadian:l},Symbol.toStringTag,{value:"Module"}))},76231:(e,t,i)=>{i.d(t,{Iu:()=>u,Jp:()=>a,U1:()=>l,U_:()=>o,Us:()=>h,bA:()=>c,t8:()=>s,vc:()=>p,xJ:()=>d,yR:()=>n});var r=i(40201);function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function s(e,t,i,r,n,s,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=s,e[5]=o,e}function o(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5];let l=i*s-r*n;return l?(l=1/l,e[0]=s*l,e[1]=-r*l,e[2]=-n*l,e[3]=i*l,e[4]=(n*a-s*o)*l,e[5]=(r*o-i*a)*l,e):null}function a(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=i[0],u=i[1],h=i[2],d=i[3],p=i[4],f=i[5];return e[0]=r*c+s*u,e[1]=n*c+o*u,e[2]=r*h+s*d,e[3]=n*h+o*d,e[4]=r*p+s*f+a,e[5]=n*p+o*f+l,e}function l(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),u=Math.cos(i);return e[0]=r*u+s*c,e[1]=n*u+o*c,e[2]=r*-c+s*u,e[3]=n*-c+o*u,e[4]=a,e[5]=l,e}function c(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=i[0],u=i[1];return e[0]=r*c,e[1]=n*c,e[2]=s*u,e[3]=o*u,e[4]=a,e[5]=l,e}function u(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=i[0],u=i[1];return e[0]=r,e[1]=n,e[2]=s,e[3]=o,e[4]=r*c+s*u+a,e[5]=n*c+o*u+l,e}function h(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function d(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function p(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function f(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}const m=a,g=f;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,t){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=t[0],u=t[1],h=t[2],d=t[3],p=t[4],f=t[5],m=(0,r.bn)();return Math.abs(i-c)<=m*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-u)<=m*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-h)<=m*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-d)<=m*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=m*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-f)<=m*Math.max(1,Math.abs(l),Math.abs(f))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},fromRotation:h,fromScaling:d,fromTranslation:p,identity:n,invert:o,mul:m,multiply:a,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},rotate:l,scale:c,set:s,str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:g,subtract:f,translate:u},Symbol.toStringTag,{value:"Module"}))},46332:(e,t,i)=>{i.d(t,{GH:()=>u,Iu:()=>d,Jp:()=>h,U1:()=>p,U_:()=>l,Us:()=>y,XL:()=>b,bA:()=>f,en:()=>_,ex:()=>m,f6:()=>v,p4:()=>a,t8:()=>s,uj:()=>c,vc:()=>g,xO:()=>n,yR:()=>o});var r=i(40201);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function s(e,t,i,r,n,s,o,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function a(e,t){if(e===t){const i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function l(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l;let f=i*h+r*d+n*p;return f?(f=1/f,e[0]=h*f,e[1]=(-u*r+n*c)*f,e[2]=(a*r-n*o)*f,e[3]=d*f,e[4]=(u*i-n*l)*f,e[5]=(-a*i+n*s)*f,e[6]=p*f,e[7]=(-c*i+r*l)*f,e[8]=(o*i-r*s)*f,e):null}function c(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-a*c,e[1]=n*c-r*u,e[2]=r*a-n*o,e[3]=a*l-s*u,e[4]=i*u-n*l,e[5]=n*s-i*a,e[6]=s*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*s,e}function u(e){const t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-o*l)+i*(-c*n+o*a)+r*(l*n-s*a)}function h(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],y=i[5],_=i[6],v=i[7],b=i[8];return e[0]=d*r+p*o+f*c,e[1]=d*n+p*a+f*u,e[2]=d*s+p*l+f*h,e[3]=m*r+g*o+y*c,e[4]=m*n+g*a+y*u,e[5]=m*s+g*l+y*h,e[6]=_*r+v*o+b*c,e[7]=_*n+v*a+b*u,e[8]=_*s+v*l+b*h,e}function d(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1];return e[0]=r,e[1]=n,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=d*r+p*o+c,e[7]=d*n+p*a+u,e[8]=d*s+p*l+h,e}function p(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(i),p=Math.cos(i);return e[0]=p*r+d*o,e[1]=p*n+d*a,e[2]=p*s+d*l,e[3]=p*o-d*r,e[4]=p*a-d*n,e[5]=p*l-d*s,e[6]=c,e[7]=u,e[8]=h,e}function f(e,t,i){const r=i[0],n=i[1],s=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=s*t[6],e[7]=s*t[7],e[8]=s*t[8],e}function m(e,t,i){const r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e}function g(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function y(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function _(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=i+i,a=r+r,l=n+n,c=i*o,u=r*o,h=r*a,d=n*o,p=n*a,f=n*l,m=s*o,g=s*a,y=s*l;return e[0]=1-h-f,e[3]=u-y,e[6]=d+g,e[1]=u+y,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-h,e}function v(e,t){const i=t[0],r=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l,f=i*h+r*d+n*p;if(!f)return null;const m=1/f;return e[0]=h*m,e[1]=(-u*r+n*c)*m,e[2]=(a*r-n*o)*m,e[3]=d*m,e[4]=(u*i-n*l)*m,e[5]=(-a*i+n*s)*m,e[6]=p*m,e[7]=(-c*i+r*l)*m,e[8]=(o*i-r*s)*m,e}function b(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=i*a-r*o,v=i*l-n*o,b=i*c-s*o,w=r*l-n*a,x=r*c-s*a,T=n*c-s*l,C=u*m-h*f,S=u*g-d*f,E=u*y-p*f,M=h*g-d*m,A=h*y-p*m,R=d*y-p*g;let O=_*R-v*A+b*M+w*E-x*S+T*C;return O?(O=1/O,e[0]=(a*R-l*A+c*M)*O,e[1]=(l*E-o*R-c*S)*O,e[2]=(o*A-a*E+c*C)*O,e[3]=(n*A-r*R-s*M)*O,e[4]=(i*R-n*E+s*S)*O,e[5]=(r*E-i*A-s*C)*O,e[6]=(m*T-g*x+y*w)*O,e[7]=(g*b-f*T-y*v)*O,e[8]=(f*x-m*b+y*_)*O,e):null}function w(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}const x=h,T=w;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},adjoint:c,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},determinant:u,equals:function(e,t){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=t[0],p=t[1],f=t[2],m=t[3],g=t[4],y=t[5],_=t[6],v=t[7],b=t[8],w=(0,r.bn)();return Math.abs(i-d)<=w*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-p)<=w*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-f)<=w*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-m)<=w*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-g)<=w*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-y)<=w*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-_)<=w*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(u-v)<=w*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-b)<=w*Math.max(1,Math.abs(h),Math.abs(b))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromMat4:n,fromQuat:_,fromRotation:y,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromTranslation:g,identity:o,invert:l,isOrthoNormal:function(e){const t=(0,r.bn)(),i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8];return Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(n*n+a*a+u*u))<=t&&Math.abs(1-(s*s+l*l+h*h))<=t},mul:x,multiply:h,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},normalFromMat4:b,normalFromMat4Legacy:v,projection:function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},rotate:p,scale:f,scaleByVec2:m,set:s,str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},sub:T,subtract:w,translate:d,transpose:a},Symbol.toStringTag,{value:"Module"}))},32114:(e,t,i)=>{i.d(t,{I6:()=>U,Iu:()=>d,Iw:()=>R,JG:()=>s,Jp:()=>h,M5:()=>L,PS:()=>O,Q$:()=>M,QO:()=>T,U1:()=>f,U_:()=>u,Us:()=>b,aC:()=>w,bA:()=>p,dC:()=>V,en:()=>P,fS:()=>k,gT:()=>x,i0:()=>E,iS:()=>c,j6:()=>A,jI:()=>y,ji:()=>N,lM:()=>m,lv:()=>B,oy:()=>I,p4:()=>l,pV:()=>z,t8:()=>o,uD:()=>g,vc:()=>_,xJ:()=>v,yR:()=>a,zB:()=>D});var r=i(81095),n=i(40201);function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e,t,i,r,n,s,o,a,l,c,u,h,d,p,f,m,g){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e}function a(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t){if(e===t){const i=t[1],r=t[2],n=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=n,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function c(e,t){return u(e,t)||a(e),e}function u(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=i*a-r*o,v=i*l-n*o,b=i*c-s*o,w=r*l-n*a,x=r*c-s*a,T=n*c-s*l,C=u*m-h*f,S=u*g-d*f,E=u*y-p*f,M=h*g-d*m,A=h*y-p*m,R=d*y-p*g;let O=_*R-v*A+b*M+w*E-x*S+T*C;return O?(O=1/O,e[0]=(a*R-l*A+c*M)*O,e[1]=(n*A-r*R-s*M)*O,e[2]=(m*T-g*x+y*w)*O,e[3]=(d*x-h*T-p*w)*O,e[4]=(l*E-o*R-c*S)*O,e[5]=(i*R-n*E+s*S)*O,e[6]=(g*b-f*T-y*v)*O,e[7]=(u*T-d*b+p*v)*O,e[8]=(o*A-a*E+c*C)*O,e[9]=(r*E-i*A-s*C)*O,e[10]=(f*x-m*b+y*_)*O,e[11]=(h*b-u*x-p*_)*O,e[12]=(a*S-o*M-l*C)*O,e[13]=(i*M-r*S+n*C)*O,e[14]=(m*v-f*w-g*_)*O,e[15]=(u*w-h*v+d*_)*O,e):null}function h(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15];let v=i[0],b=i[1],w=i[2],x=i[3];return e[0]=v*r+b*a+w*h+x*m,e[1]=v*n+b*l+w*d+x*g,e[2]=v*s+b*c+w*p+x*y,e[3]=v*o+b*u+w*f+x*_,v=i[4],b=i[5],w=i[6],x=i[7],e[4]=v*r+b*a+w*h+x*m,e[5]=v*n+b*l+w*d+x*g,e[6]=v*s+b*c+w*p+x*y,e[7]=v*o+b*u+w*f+x*_,v=i[8],b=i[9],w=i[10],x=i[11],e[8]=v*r+b*a+w*h+x*m,e[9]=v*n+b*l+w*d+x*g,e[10]=v*s+b*c+w*p+x*y,e[11]=v*o+b*u+w*f+x*_,v=i[12],b=i[13],w=i[14],x=i[15],e[12]=v*r+b*a+w*h+x*m,e[13]=v*n+b*l+w*d+x*g,e[14]=v*s+b*c+w*p+x*y,e[15]=v*o+b*u+w*f+x*_,e}function d(e,t,i){const r=i[0],n=i[1],s=i[2];if(t===e)e[12]=t[0]*r+t[4]*n+t[8]*s+t[12],e[13]=t[1]*r+t[5]*n+t[9]*s+t[13],e[14]=t[2]*r+t[6]*n+t[10]*s+t[14],e[15]=t[3]*r+t[7]*n+t[11]*s+t[15];else{const i=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7],p=t[8],f=t[9],m=t[10],g=t[11];e[0]=i,e[1]=o,e[2]=a,e[3]=l,e[4]=c,e[5]=u,e[6]=h,e[7]=d,e[8]=p,e[9]=f,e[10]=m,e[11]=g,e[12]=i*r+c*n+p*s+t[12],e[13]=o*r+u*n+f*s+t[13],e[14]=a*r+h*n+m*s+t[14],e[15]=l*r+d*n+g*s+t[15]}return e}function p(e,t,i){const r=i[0],n=i[1],s=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,i,r){let o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);if(c<=(0,n.bn)())return void s(e,t);c=1/c,o*=c,a*=c,l*=c;const u=Math.sin(i),h=Math.cos(i),d=1-h,p=t[0],f=t[1],m=t[2],g=t[3],y=t[4],_=t[5],v=t[6],b=t[7],w=t[8],x=t[9],T=t[10],C=t[11],S=o*o*d+h,E=a*o*d+l*u,M=l*o*d-a*u,A=o*a*d-l*u,R=a*a*d+h,O=l*a*d+o*u,P=o*l*d+a*u,I=a*l*d-o*u,L=l*l*d+h;e[0]=p*S+y*E+w*M,e[1]=f*S+_*E+x*M,e[2]=m*S+v*E+T*M,e[3]=g*S+b*E+C*M,e[4]=p*A+y*R+w*O,e[5]=f*A+_*R+x*O,e[6]=m*A+v*R+T*O,e[7]=g*A+b*R+C*O,e[8]=p*P+y*I+w*L,e[9]=f*P+_*I+x*L,e[10]=m*P+v*I+T*L,e[11]=g*P+b*I+C*L,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15])}function m(e,t,i){const r=Math.sin(i),n=Math.cos(i),s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+c*r,e[5]=o*n+u*r,e[6]=a*n+h*r,e[7]=l*n+d*r,e[8]=c*n-s*r,e[9]=u*n-o*r,e[10]=h*n-a*r,e[11]=d*n-l*r,e}function g(e,t,i){const r=Math.sin(i),n=Math.cos(i),s=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-c*r,e[1]=o*n-u*r,e[2]=a*n-h*r,e[3]=l*n-d*r,e[8]=s*r+c*n,e[9]=o*r+u*n,e[10]=a*r+h*n,e[11]=l*r+d*n,e}function y(e,t,i){const r=Math.sin(i),n=Math.cos(i),s=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+c*r,e[1]=o*n+u*r,e[2]=a*n+h*r,e[3]=l*n+d*r,e[4]=c*n-s*r,e[5]=u*n-o*r,e[6]=h*n-a*r,e[7]=d*n-l*r,e}function _(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function v(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function b(e,t,i){if(0===t)return a(e);let r=i[0],s=i[1],o=i[2],l=Math.sqrt(r*r+s*s+o*o);if(l<=(0,n.bn)())return null;l=1/l,r*=l,s*=l,o*=l;const c=Math.sin(t),u=Math.cos(t),h=1-u;return e[0]=r*r*h+u,e[1]=s*r*h+o*c,e[2]=o*r*h-s*c,e[3]=0,e[4]=r*s*h-o*c,e[5]=s*s*h+u,e[6]=o*s*h+r*c,e[7]=0,e[8]=r*o*h+s*c,e[9]=s*o*h-r*c,e[10]=o*o*h+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function C(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],a=r+r,l=n+n,c=s+s,u=r*a,h=r*l,d=r*c,p=n*l,f=n*c,m=s*c,g=o*a,y=o*l,_=o*c;return e[0]=1-(p+m),e[1]=h+_,e[2]=d-y,e[3]=0,e[4]=h-_,e[5]=1-(u+m),e[6]=f+g,e[7]=0,e[8]=d+y,e[9]=f-g,e[10]=1-(u+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}const S=(0,r.Ue)();function E(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function M(e,t){const i=t[0],r=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(i*i+r*r+n*n),e[1]=Math.sqrt(s*s+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function A(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function R(e,t,i,r){const n=t[0],s=t[1],o=t[2],a=t[3],l=n+n,c=s+s,u=o+o,h=n*l,d=n*c,p=n*u,f=s*c,m=s*u,g=o*u,y=a*l,_=a*c,v=a*u,b=r[0],w=r[1],x=r[2];return e[0]=(1-(f+g))*b,e[1]=(d+v)*b,e[2]=(p-_)*b,e[3]=0,e[4]=(d-v)*w,e[5]=(1-(h+g))*w,e[6]=(m+y)*w,e[7]=0,e[8]=(p+_)*x,e[9]=(m-y)*x,e[10]=(1-(h+f))*x,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function O(e,t,i,r,n){const s=t[0],o=t[1],a=t[2],l=t[3],c=s+s,u=o+o,h=a+a,d=s*c,p=s*u,f=s*h,m=o*u,g=o*h,y=a*h,_=l*c,v=l*u,b=l*h,w=r[0],x=r[1],T=r[2],C=n[0],S=n[1],E=n[2],M=(1-(m+y))*w,A=(p+b)*w,R=(f-v)*w,O=(p-b)*x,P=(1-(d+y))*x,I=(g+_)*x,L=(f+v)*T,D=(g-_)*T,N=(1-(d+m))*T;return e[0]=M,e[1]=A,e[2]=R,e[3]=0,e[4]=O,e[5]=P,e[6]=I,e[7]=0,e[8]=L,e[9]=D,e[10]=N,e[11]=0,e[12]=i[0]+C-(M*C+O*S+L*E),e[13]=i[1]+S-(A*C+P*S+D*E),e[14]=i[2]+E-(R*C+I*S+N*E),e[15]=1,e}function P(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=i+i,a=r+r,l=n+n,c=i*o,u=r*o,h=r*a,d=n*o,p=n*a,f=n*l,m=s*o,g=s*a,y=s*l;return e[0]=1-h-f,e[1]=u+y,e[2]=d-g,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function I(e,t,i,r,n,s,o){const a=1/(i-t),l=1/(n-r),c=1/(s-o);return e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(n+r)*l,e[10]=(o+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*c,e[15]=0,e}function L(e,t,i,r,n,s,o){const a=1/(t-i),l=1/(r-n),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(n+r)*l,e[14]=(o+s)*c,e[15]=1,e}function D(e,t,i,r){const s=t[0],o=t[1],l=t[2];let c=s-i[0],u=o-i[1],h=l-i[2];const d=(0,n.bn)();if(Math.abs(c)<d&&Math.abs(u)<d&&Math.abs(h)<d)return void a(e);let p=1/Math.sqrt(c*c+u*u+h*h);c*=p,u*=p,h*=p;const f=r[0],m=r[1],g=r[2];let y=m*h-g*u,_=g*c-f*h,v=f*u-m*c;p=Math.sqrt(y*y+_*_+v*v),p?(p=1/p,y*=p,_*=p,v*=p):(y=0,_=0,v=0);let b=u*v-h*_,w=h*y-c*v,x=c*_-u*y;p=Math.sqrt(b*b+w*w+x*x),p?(p=1/p,b*=p,w*=p,x*=p):(b=0,w=0,x=0),e[0]=y,e[1]=b,e[2]=c,e[3]=0,e[4]=_,e[5]=w,e[6]=u,e[7]=0,e[8]=v,e[9]=x,e[10]=h,e[11]=0,e[12]=-(y*s+_*o+v*l),e[13]=-(b*s+w*o+x*l),e[14]=-(c*s+u*o+h*l),e[15]=1}function N(e,t,i,r){const n=t[0],s=t[1],o=t[2],a=r[0],l=r[1],c=r[2];let u=n-i[0],h=s-i[1],d=o-i[2],p=u*u+h*h+d*d;p>0&&(p=1/Math.sqrt(p),u*=p,h*=p,d*=p);let f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return p=f*f+m*m+g*g,p>0&&(p=1/Math.sqrt(p),f*=p,m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*f-u*g,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=n,e[13]=s,e[14]=o,e[15]=1,e}function F(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function U(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function k(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=t[0],b=t[1],w=t[2],x=t[3],T=t[4],C=t[5],S=t[6],E=t[7],M=t[8],A=t[9],R=t[10],O=t[11],P=t[12],I=t[13],L=t[14],D=t[15],N=(0,n.bn)();return Math.abs(i-v)<=N*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-b)<=N*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(s-w)<=N*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(o-x)<=N*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-T)<=N*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(l-C)<=N*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-S)<=N*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-E)<=N*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-M)<=N*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(d-A)<=N*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(p-R)<=N*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(f-O)<=N*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(m-P)<=N*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(g-I)<=N*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(y-L)<=N*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(_-D)<=N*Math.max(1,Math.abs(_),Math.abs(D))}function z(e){const t=(0,n.bn)(),i=e[0],r=e[1],s=e[2],o=e[4],a=e[5],l=e[6],c=e[8],u=e[9],h=e[10];return Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(r*r+a*a+u*u))<=t&&Math.abs(1-(s*s+l*l+h*h))<=t}function B(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[8]&&0===e[9]&&1===e[10]}const V=h,H=F;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},adjoint:function(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15];return e[0]=a*(d*y-p*g)-h*(l*y-c*g)+m*(l*p-c*d),e[1]=-(r*(d*y-p*g)-h*(n*y-s*g)+m*(n*p-s*d)),e[2]=r*(l*y-c*g)-a*(n*y-s*g)+m*(n*c-s*l),e[3]=-(r*(l*p-c*d)-a*(n*p-s*d)+h*(n*c-s*l)),e[4]=-(o*(d*y-p*g)-u*(l*y-c*g)+f*(l*p-c*d)),e[5]=i*(d*y-p*g)-u*(n*y-s*g)+f*(n*p-s*d),e[6]=-(i*(l*y-c*g)-o*(n*y-s*g)+f*(n*c-s*l)),e[7]=i*(l*p-c*d)-o*(n*p-s*d)+u*(n*c-s*l),e[8]=o*(h*y-p*m)-u*(a*y-c*m)+f*(a*p-c*h),e[9]=-(i*(h*y-p*m)-u*(r*y-s*m)+f*(r*p-s*h)),e[10]=i*(a*y-c*m)-o*(r*y-s*m)+f*(r*c-s*a),e[11]=-(i*(a*p-c*h)-o*(r*p-s*h)+u*(r*c-s*a)),e[12]=-(o*(h*g-d*m)-u*(a*g-l*m)+f*(a*d-l*h)),e[13]=i*(h*g-d*m)-u*(r*g-n*m)+f*(r*d-n*h),e[14]=-(i*(a*g-l*m)-o*(r*g-n*m)+f*(r*l-n*a)),e[15]=i*(a*d-l*h)-o*(r*d-n*h)+u*(r*l-n*a),e},copy:s,determinant:function(e){const t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*o-i*s)*(h*g-d*m)-(t*a-r*s)*(u*g-d*f)+(t*l-n*s)*(u*m-h*f)+(i*a-r*o)*(c*g-d*p)-(i*l-n*o)*(c*m-h*p)+(r*l-n*a)*(c*f-u*p)},equals:k,exactEquals:U,frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)},fromQuat:P,fromQuat2:function(e,t){const i=S,r=-t[0],n=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=r*r+n*n+s*s+o*o;return h>0?(i[0]=2*(a*o+u*r+l*s-c*n)/h,i[1]=2*(l*o+u*n+c*r-a*s)/h,i[2]=2*(c*o+u*s+a*n-l*r)/h):(i[0]=2*(a*o+u*r+l*s-c*n),i[1]=2*(l*o+u*n+c*r-a*s),i[2]=2*(c*o+u*s+a*n-l*r)),C(e,t,i),e},fromRotation:b,fromRotationTranslation:C,fromRotationTranslationScale:R,fromRotationTranslationScaleOrigin:O,fromScaling:v,fromTranslation:_,fromXRotation:w,fromYRotation:x,fromZRotation:T,frustum:I,getRotation:A,getScaling:M,getTranslation:E,hasIdentityRotation:B,identity:a,invert:u,invertOrIdentity:c,isOrthoNormal:z,lookAt:D,mul:V,multiply:h,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e},ortho:L,perspective:function(e,t,i,r,n){const s=1/Math.tan(t/2);let o;return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(o=1/(r-n),e[10]=(n+r)*o,e[14]=2*n*r*o):(e[10]=-1,e[14]=-2*r),e},perspectiveFromFieldOfView:function(e,t,i,r){const n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(n-s)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e},rotate:f,rotateX:m,rotateY:g,rotateZ:y,scale:p,set:o,str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},sub:H,subtract:F,targetTo:N,translate:d,transpose:l},Symbol.toStringTag,{value:"Module"}))},1845:(e,t,i)=>{i.d(t,{Bh:()=>u,I6:()=>R,Jp:()=>h,Kx:()=>f,Su:()=>g,U_:()=>p,b0:()=>P,t8:()=>_,yY:()=>c});var r=i(3965),n=i(96303),s=i(81095),o=i(40201),a=i(86717),l=i(56999);function c(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function u(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>(0,o.bn)()?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function h(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=r*u+o*a+n*c-s*l,e[1]=n*u+o*l+s*a-r*c,e[2]=s*u+o*c+r*l-n*a,e[3]=o*u-r*a-n*l-s*c,e}function d(e,t,i,r){const n=t[0],s=t[1],a=t[2],l=t[3];let c,u,h,d,p,f=i[0],m=i[1],g=i[2],y=i[3];return u=n*f+s*m+a*g+l*y,u<0&&(u=-u,f=-f,m=-m,g=-g,y=-y),1-u>(0,o.bn)()?(c=Math.acos(u),h=Math.sin(c),d=Math.sin((1-r)*c)/h,p=Math.sin(r*c)/h):(d=1-r,p=r),e[0]=d*n+p*f,e[1]=d*s+p*m,e[2]=d*a+p*g,e[3]=d*l+p*y,e}function p(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-n*a,e[3]=s*a,e}function f(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function m(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const n=(i+1)%3,s=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*s+s]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*n+s]-t[3*s+n])*r,e[n]=(t[3*n+i]+t[3*i+n])*r,e[s]=(t[3*s+i]+t[3*i+s])*r}return e}function g(e,t,i,r){const n=.5*Math.PI/180;t*=n,i*=n,r*=n;const s=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return e[0]=s*l*u-o*a*c,e[1]=o*a*u+s*l*c,e[2]=o*l*c-s*a*u,e[3]=o*l*u+s*a*c,e}const y=l.c,_=l.s,v=l.g,b=h,w=l.b,x=l.h,T=l.l,C=l.j,S=C,E=l.f,M=E,A=l.n,R=l.a,O=l.e;function P(e,t,i){const r=(0,a.f)(t,i);return r<-.999999?((0,a.e)(I,L,t),(0,a.H)(I)<1e-6&&(0,a.e)(I,D,t),(0,a.n)(I,I),c(e,I,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,a.e)(I,t,i),e[0]=I[0],e[1]=I[1],e[2]=I[2],e[3]=1+r,A(e,e))}const I=(0,s.Ue)(),L=(0,s.al)(1,0,0),D=(0,s.al)(0,1,0);const N=(0,n.Ue)(),F=(0,n.Ue)();const U=(0,r.Ue)();Object.freeze(Object.defineProperty({__proto__:null,add:v,calculateW:function(e,t){const i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e},conjugate:f,copy:y,dot:x,equals:O,exactEquals:R,fromEuler:g,fromMat3:m,getAxisAngle:u,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},invert:p,len:S,length:C,lerp:T,mul:b,multiply:h,normalize:A,random:function(e){const t=o.FD,i=t(),r=t(),n=t(),s=Math.sqrt(1-i),a=Math.sqrt(i);return e[0]=s*Math.sin(2*Math.PI*r),e[1]=s*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*n),e[3]=a*Math.cos(2*Math.PI*n),e},rotateX:function(e,t,i){i*=.5;const r=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=n*l+s*a,e[2]=s*l-n*a,e[3]=o*l-r*a,e},rotateY:function(e,t,i){i*=.5;const r=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-s*a,e[1]=n*l+o*a,e[2]=s*l+r*a,e[3]=o*l-n*a,e},rotateZ:function(e,t,i){i*=.5;const r=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=n*l-r*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e},rotationTo:P,scale:w,set:_,setAxes:function(e,t,i,r){const n=U;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],A(e,m(e,n))},setAxisAngle:c,slerp:d,sqlerp:function(e,t,i,r,n,s){return d(N,t,n,s),d(F,i,r,s),d(e,N,F,2*s*(1-s)),e},sqrLen:M,squaredLength:E,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}},Symbol.toStringTag,{value:"Module"}))},36531:(e,t,i)=>{i.d(t,{$X:()=>a,AK:()=>b,EU:()=>E,Fp:()=>h,Fv:()=>v,I6:()=>M,IH:()=>o,JG:()=>n,LG:()=>R,TE:()=>f,TK:()=>D,U1:()=>S,VV:()=>u,bA:()=>d,bI:()=>m,c:()=>T,fS:()=>A,iu:()=>C,kC:()=>w,kE:()=>g,lu:()=>P,od:()=>p,t7:()=>x,t8:()=>s,tk:()=>_,we:()=>y});var r=i(40201);function n(e,t){return e[0]=t[0],e[1]=t[1],e}function s(e,t,i){return e[0]=t,e[1]=i,e}function o(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function a(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function l(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function c(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function u(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function h(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function d(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function p(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function f(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function m(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function g(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function y(e){const t=e[0],i=e[1];return t*t+i*i}function _(e,t){return e[0]=-t[0],e[1]=-t[1],e}function v(e,t){const i=t[0],r=t[1];let n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e}function b(e,t){return e[0]*t[0]+e[1]*t[1]}function w(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function x(e,t,i,r){const n=t[0],s=t[1];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e}function T(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e}function C(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n+i[4],e[1]=i[1]*r+i[3]*n+i[5],e}function S(e,t,i,r){const n=t[0]-i[0],s=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=n*a-s*o+i[0],e[1]=n*o+s*a+i[1],e}function E(e,t){const i=e[0],r=e[1],n=t[0],s=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(i*n+r*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function M(e,t){return e[0]===t[0]&&e[1]===t[1]}function A(e,t){const i=e[0],n=e[1],s=t[0],o=t[1],a=(0,r.bn)();return Math.abs(i-s)<=a*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=a*Math.max(1,Math.abs(n),Math.abs(o))}function R(e,t,i,r,n){let s=t[0]-i[0],o=t[1]-i[1];const a=(r[0]*s+r[1]*o)*(n-1);return s=r[0]*a,o=r[1]*a,e[0]=t[0]+s,e[1]=t[1]+o,e}const O=g,P=a,I=l,L=c,D=f,N=m,F=y;Object.freeze(Object.defineProperty({__proto__:null,add:o,angle:E,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},copy:n,cross:w,dist:D,distance:f,div:L,divide:c,dot:b,equals:A,exactEquals:M,floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},len:O,length:g,lerp:x,max:h,min:u,mul:I,multiply:l,negate:_,normalize:v,projectAndScale:R,random:function(e,t=1){const i=2*(0,r.FD)()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},rotate:S,round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:d,scaleAndAdd:p,set:s,sqrDist:N,sqrLen:F,squaredDistance:m,squaredLength:y,str:function(e){return"vec2("+e[0]+", "+e[1]+")"},sub:P,subtract:a,transformMat2:T,transformMat2d:C,transformMat3:function(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[3]*n+i[6],e[1]=i[1]*r+i[4]*n+i[7],e},transformMat4:function(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e}},Symbol.toStringTag,{value:"Module"}))},63592:(e,t,i)=>{i.d(t,{G:()=>o,w:()=>a});var r=i(67979),n=i(41831),s=i(68309);async function o(e,t){return await e.load(),a(e,t)}async function a(e,t){const i=[],o=(...e)=>{for(const t of e)null!=t&&(Array.isArray(t)?o(...t):n.Z.isCollection(t)?t.forEach((e=>o(e))):s.Z.isLoadable(t)&&i.push(t))};t(o);let a=null;if(await(0,r.UI)(i,(async e=>{const t=await(0,r.q6)(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load());!1!==t.ok||a||(a=t)})),a)throw a.error;return e}},19431:(e,t,i)=>{i.d(t,{BV:()=>d,CW:()=>R,F3:()=>P,Kt:()=>m,Po:()=>S,Sf:()=>n,Vl:()=>h,W8:()=>g,Y8:()=>E,ZF:()=>f,aR:()=>v,bA:()=>u,b_:()=>p,eF:()=>I,fp:()=>a,nB:()=>y,oK:()=>M,oc:()=>O,pt:()=>_,sk:()=>l,t7:()=>c,uZ:()=>s,wt:()=>o});const r=new Float32Array(1);function n(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function s(e,t,i){return Math.min(Math.max(e,t),i)}function o(e){return!(e&e-1)}function a(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function l(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function c(e,t,i){return e+(t-e)*i}function u(e,t,i,r,n){return c(r,n,(e-t)/(i-t))}function h(e){return e*Math.PI/180}function d(e){return 180*e/Math.PI}function p(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function f(e){return Math.acos(s(e,-1,1))}function m(e){return Math.asin(s(e,-1,1))}function g(e,t,i=1e-6){return e===t||!(!Number.isFinite(e)||!Number.isFinite(t))&&(e>t?e-t:t-e)<=i}function y(e,t,i=1e-6){return!g(e,t,i)&&e>t}function _(e,t,i=1e-6){return!g(e,t,i)&&e<t}function v(e,t,i=1e-6){return g(e,t,i)||e>t}const b=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function w(e){return b.setFloat64(0,e),b.getBigInt64(0)}const x=BigInt("1000000"),T=C(1);function C(e){const t=w(e=Math.abs(e)),i=function(e){return b.setBigInt64(0,e),b.getFloat64(0)}(t<=x?x:t-x);return Math.abs(e-i)}function S(e,t,i=T){if(e===t)return!0;if(!Number.isFinite(e)||!Number.isFinite(t))return!1;if(null!=i&&C(Math.min(Math.abs(e),Math.abs(t)))<i)return Math.abs(e-t)<=i;const r=w(e),n=w(t);return r<0==n<0&&!((r<n?n-r:r-n)>x)}function E(e,t,i=1e-6){if(e===t)return!0;if(!Number.isFinite(e)||!Number.isFinite(t))return!1;const r=Math.abs(e-t),n=Math.abs(e),s=Math.abs(t);if(0===e||0===t||n<1e-12&&s<1e-12){if(r>.01*i)return!1}else if(r/(n+s)>i)return!1;return!0}function M(e){return A(Math.max(-P,Math.min(e,P)))}function A(e){return r[0]=e,r[0]}function R(e,t,i){const r=s((i-e)/(t-e),0,1);return r*r*(3-2*r)}function O(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(g(t,1)&&g(i,1)&&g(r,1))}const P=A(34028234663852886e22);function I(e,t,i){if(void 0===i||0==+i)return Math[e](t);if(t=+t,i=+i,isNaN(t)||"number"!=typeof i||i%1!=0)return NaN;let r=t.toString().split("e");return r=(t=Math[e](+(r[0]+"e"+(r[1]?+r[1]-i:-i)))).toString().split("e"),+(r[0]+"e"+(r[1]?+r[1]+i:i))}},61681:(e,t,i)=>{function r(e,t){if(null==e)throw new Error(t??"value is None")}function n(e){return e?.destroy(),null}function s(e){return e?.dispose(),null}function o(e){return e?.remove(),null}function a(e){return e?.abort(),null}function l(e){return e?.release(),null}function c(e,t,i){return null!=e&&null!=t?null!=i?i(e,t):e.equals(t):e===t}function u(e,t){return e?.[t]}function h(e,t){let i;return e.some(((e,r)=>(i=t(e,r),null!=i))),i??void 0}i.d(t,{IM:()=>a,M2:()=>s,O3:()=>r,RY:()=>l,SC:()=>n,_W:()=>c,aF:()=>u,ei:()=>h,hw:()=>o})},81506:(e,t,i)=>{function r(e){let t,i,r=[],n=!1;return function(...s){return n&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(s,r)||(i=e.apply(this,s),t=this,r=s,n=!0),i}}i.d(t,{H:()=>r})},99235:(e,t,i)=>{i.d(t,{F$:()=>o,G7:()=>c,HG:()=>d,Mm:()=>h,Qi:()=>p,YL:()=>n,YN:()=>u,du:()=>s,kk:()=>a});var r=i(86098);function n(e){return 32+e.length}const s=16;function o(e){if(!e)return 0;let t=h;for(const i in e)e.hasOwnProperty(i)&&(t+=l(e[i],!1));return t}function a(e){if(!e)return 0;if("number"==typeof e[0])return c(e);if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return u(e,8);let i=d;for(let r=0;r<t;r++)i+=l(e[r]);return i}(e);let t=h;for(const i in e)e.hasOwnProperty(i)&&(t+=l(e[i]));return t}function l(e,t=!0){switch(typeof e){case"object":return t?a(e):h;case"string":return n(e);case"number":return s;case"boolean":return 4;default:return 8}}function c(...e){return e.reduce(((e,t)=>e+(t?(0,r.fU)(t)?t.byteLength+p:Array.isArray(t)?u(t,s):0:0)),0)}function u(e,t){return d+e.length*t}const h=32,d=16,p=145},71760:(e,t,i)=>{function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{l:()=>r})},66581:(e,t,i)=>{i.d(t,{Y:()=>n});const r=[];function n(e){r.push(e),1===r.length&&queueMicrotask((()=>{const e=r.slice();r.length=0;for(const t of e)t()}))}},86745:(e,t,i)=>{i.d(t,{R:()=>a,RB:()=>o,RH:()=>n,hS:()=>s});var r=i(67134);function n(e,t,i=!1){return c(e,t,i)}function s(e,t){if(null!=t)return t[e]||l(e.split("."),!1,t)}function o(e,t,i){const r=e.split("."),n=r.pop(),s=l(r,!0,i);s&&n&&(s[n]=t)}function a(e,t){if(null==e&&null==t)return!1;if(null==e)return!0;if(null==t)return!0;if("object"==typeof e){if(Array.isArray(e)){const i=t;if(e.length!==i.length)return!0;for(let t=0;t<e.length;t++)if(a(e[t],i[t]))return!0;return!1}if(Object.keys(e).length!==Object.keys(t).length)return!0;for(const i in e)if(a(e[i],t[i]))return!0;return!1}return e!==t}function l(e,t,i){let r=i;for(const i of e){if(null==r)return;if(!(i in r)){if(!t)return;r[i]={}}r=r[i]}return r}function c(e,t,i){return t?Object.keys(t).reduce(((e,n)=>{let s=e[n],o=t[n];return s===o?e:void 0===s?(e[n]=(0,r.d9)(o),e):(Array.isArray(o)||Array.isArray(e)?(s=s?Array.isArray(s)?e[n]=s.slice():e[n]=[s]:e[n]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach((e=>{s.includes(e)||s.push(e)})):e[n]=o.slice())):o&&"object"==typeof o?e[n]=c(s,o,i):e.hasOwnProperty(n)&&!t.hasOwnProperty(n)||(e[n]=o),e)}),e||{}):e}},78668:(e,t,i)=>{i.d(t,{$F:()=>m,$h:()=>u,Bx:()=>O,CH:()=>S,D_:()=>y,Ds:()=>A,H9:()=>p,Hc:()=>h,Hl:()=>g,OT:()=>w,R8:()=>_,U3:()=>v,UO:()=>x,Vs:()=>C,Yn:()=>P,as:()=>b,e4:()=>T,fu:()=>f,gx:()=>M,hh:()=>R,k_:()=>c,r9:()=>d,y8:()=>E,zE:()=>l});var r=i(18234),n=i(70375),s=i(49546),o=i(13802),a=i(61681);function l(e="Aborted"){return new n.Z("AbortError",e)}function c(e,t="Aborted"){if(h(e))throw l(t)}function u(e){return e instanceof AbortSignal?e:e?.signal??void 0}function h(e){const t=u(e);return null!=t&&t.aborted}function d(e){if(y(e))throw e}function p(e){if(!y(e))throw e}function f(e,t){const i=u(e);if(null!=i){if(!i.aborted)return(0,s.IH)(i,"abort",(()=>t()));t()}}function m(e,t){const i=u(e);if(null!=i)return c(i),(0,s.IH)(i,"abort",(()=>t(l())))}function g(e,t){return null==u(t)?e:new Promise(((i,r)=>{let n=f(t,(()=>r(l())));const s=()=>{n=(0,a.hw)(n)};e.then(s,s),e.then(i,r)}))}function y(e){return"AbortError"===e?.name}async function _(e){try{return await e}catch(e){if(!y(e))throw e;return}}async function v(e,t=o.Z.getLogger("esri")){try{return await e}catch(e){y(e)||t.error(e)}}async function b(e){if(!e)return;if("function"!=typeof e.forEach){const t=Object.keys(e),i=t.map((t=>e[t])),r=await b(i),n={};return t.map(((e,t)=>n[e]=r[t])),n}const t=e;return Promise.allSettled(t).then((e=>Array.from(t,((t,i)=>{const r=e[i];return"fulfilled"===r.status?{promise:t,value:r.value}:{promise:t,error:r.reason}}))))}async function w(e){return(await Promise.allSettled(e)).filter((e=>"fulfilled"===e.status)).map((e=>e.value))}async function x(e){return(await Promise.allSettled(e)).filter((e=>"rejected"===e.status)).map((e=>e.reason))}function T(e,t,i){const r=new AbortController;return f(i,(()=>r.abort())),new Promise(((i,n)=>{let s=setTimeout((()=>{s=0,i(t)}),e);f(r,(()=>{s&&(clearTimeout(s),n(l()))}))}))}function C(e,t,i,r){const s=i&&"abort"in i?i:null;null!=r||s||(r=i);let o=setTimeout((()=>{o=0,s?.abort()}),t);const a=()=>r||new n.Z("promiseUtils:timeout","The wrapped promise did not resolve within "+t+" ms");return e.then((e=>{if(0===o)throw a();return clearTimeout(o),e}),(e=>{throw clearTimeout(o),0===o?a():e}))}function S(e,t){const i=new AbortController,r=setTimeout((()=>i.abort()),t);return f(e,(()=>{i.abort(),clearTimeout(r)})),{...e,signal:i.signal}}function E(e){return e&&"function"==typeof e.then}function M(e){return E(e)?e:Promise.resolve(e)}function A(e,t=-1){let i,r,n,s,o=null;const a=(...c)=>{if(i){r=c,s&&s.reject(l()),s=R();const e=s.promise;if(o){const e=o;o=null,e.abort()}return e}if(n=s||R(),s=null,t>0){const r=new AbortController;i=M(e(...c,r.signal));const n=i;T(t).then((()=>{i===n&&(s?r.abort():o=r)}))}else i=1,i=M(e(...c));const u=()=>{const e=r;r=n=i=o=null,null!=e&&a(...e)},h=i,d=n;return h.then(u,u),h.then(d.resolve,d.reject),d.promise};return a}function R(){let e,t;const i=new Promise(((i,r)=>{e=i,t=r})),n=t=>{e(t)};return n.resolve=t=>e(t),n.reject=e=>t(e),n.timeout=(e,t)=>r.m.setTimeout((()=>n.reject(t)),e),n.promise=i,n}function O(e,t){return e.then(t,t)}async function P(e){await Promise.resolve(),c(e)}},39405:(e,t,i)=>{i.d(t,{Fp:()=>u,GJ:()=>a,M1:()=>n,MQ:()=>f,Ww:()=>m,bA:()=>h,hw:()=>d,mE:()=>c,ne:()=>o,nn:()=>l,qF:()=>g,yG:()=>s,yP:()=>p});var r=i(17321);function n(e){return{value:e}}function s(e,t){return{type:(0,r.UF)(t),value:e,unit:t}}function o(e,t){return{type:(0,r.UF)(t),value:e,unit:t}}function a(e,t,i="arithmetic"){return{type:(0,r.UF)(t),value:e,unit:t,rotationType:i}}function l(e,t){const i=c(e,t);return"angle"===e.type?a(i,t,e.rotationType):function(e,t){return{type:(0,r.UF)(t),value:e,unit:t}}(i,t)}function c(e,t){return(0,r.En)(e.value,e.unit,t)}function u(e,t){return null==e?t:null==t||e.value>(0,r.En)(t.value,t.unit,e.unit)?e:t}function h(e,t){return null==e?null:{...e,value:e.value*t}}function d(e,t,i){if(t===i)return e;switch(i){case"arithmetic":case"geographic":return 90-e}}const p=s(0,"meters"),f=o(0,"square-meters"),m=(a(0,"radians"),a(0,"degrees")),g=a(0,"degrees","geographic")},76868:(e,t,i)=>{i.r(t),i.d(t,{autorun:()=>u.EH,initial:()=>C,mapCollection:()=>w,mapCollectionAsync:()=>x,on:()=>f,once:()=>m,pausable:()=>b,sync:()=>T,syncAndInitial:()=>S,watch:()=>h,when:()=>d,whenOnce:()=>g});var r=i(67979),n=i(41831),s=i(49546),o=i(23148),a=i(61681),l=i(78668),c=i(81509),u=i(63235);function h(e,t,i={}){return p(e,t,i,_)}function d(e,t,i={}){return p(e,t,i,v)}function p(e,t,i={},r){let n=null;const s=i.once?(e,i)=>{r(e)&&((0,a.hw)(n),t(e,i))}:(e,i)=>{r(e)&&t(e,i)};if(n=(0,c.aQ)(e,s,i.sync,i.equals),i.initial){const t=e();s(t,t)}return n}function f(e,t,i,r={}){let n=null,l=null,c=null;function u(){n&&l&&(l.remove(),r.onListenerRemove?.(n),n=null,l=null)}function d(e){r.once&&r.once&&(0,a.hw)(c),i(e)}const p=h(e,((e,i)=>{u(),(0,s.OP)(e)&&(n=e,l=(0,s.on)(e,t,d),r.onListenerAdd?.(e))}),{sync:r.sync,initial:!0});return c=(0,o.kB)((()=>{p.remove(),u()})),c}function m(e,t){return y(e,null,t)}function g(e,t){return y(e,v,t)}function y(e,t,i){if((0,l.Hc)(i))return Promise.reject((0,l.zE)());const r=e();if(t?.(r))return Promise.resolve(r);let n=null;function s(){n=(0,a.hw)(n)}return new Promise(((r,a)=>{n=(0,o.AL)([(0,l.fu)(i,(()=>{s(),a((0,l.zE)())})),p(e,(e=>{s(),r(e)}),{sync:!1,once:!0},t??_)])}))}function _(e){return!0}function v(e){return!!e}function b(e,t,i={}){let r=!1;const n=h(e,((e,i)=>{r||t(e,i)}),i);return{remove(){n.remove()},pause(){r=!0},resume(){r=!1}}}function w(e,t){const i=new n.Z,r=f(e,"after-splice",(({added:e,start:r,deleteCount:n})=>{const s=i.splice(r,n);for(const e of s)e.remove();if(e?.length){const n=e.map(t);i.addMany(n,r)}}),{sync:!0,onListenerRemove:()=>i.drain((e=>e.remove())),onListenerAdd:e=>i.addMany(e.items.map(t))});return i.addHandles(r),i}function x(e,t){const i=new n.Z,s=w(e,(e=>(0,r.vr)((async i=>{const r=await t(e,i);if((0,l.Hc)(i))throw r.remove(),(0,l.zE)();return r})))),a=()=>null,c=async e=>{const t=await e.promise,r=s.indexOf(e);r<0||i.splice(r,1,t)};i.addMany(s.items.map(a));for(const e of s)(0,l.R8)(c(e));const u=s.on("after-splice",(({added:e,start:t,deleteCount:r})=>{const n=i.splice(t,r);for(const e of n)e?.remove();if(e?.length){i.addMany(e.map(a),t);for(const t of e)(0,l.R8)(c(t))}}));return i.addHandles([(0,o.ed)(s),u]),i}const T={sync:!0},C={initial:!0},S={sync:!0,initial:!0}},17262:(e,t,i)=>{i.d(t,{A:()=>b,JM:()=>R,MU:()=>M,Os:()=>v,Yn:()=>A,bP:()=>x});var r=i(66581),n=i(31168),s=i(17135),o=i(78668),a=i(12928);class l{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}}class c{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}}let u=0,h=0;const d={time:(0,a.HA)(0),deltaTime:(0,a.HA)(0),elapsedFrameTime:(0,a.HA)(0),frameDuration:(0,a.HA)(0)},p=["prepare","preRender","render","postRender","update","finish"],f=[],m=new s.Z;class g{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1,y()}}function y(){null==w&&(u=performance.now(),w=requestAnimationFrame(T))}const _={frameTasks:m,willDispatch:!1,clearFrameTasks:function(e=!1){m.forAll((e=>{e.removed=!0})),e&&S()},dispatch:E,executeFrameTasks:function(e){const t=(0,a.HA)(e-u);u=e;const i=h>0?h:1e3/60,r=Math.max(0,t-i);d.time=e,d.frameDuration=(0,a.HA)(i-r);for(let i=0;i<p.length;i++){const r=performance.now(),n=p[i];m.forAll((r=>{r.paused||r.removed||(0===i&&r.ticks++,r.phases[n]&&(d.elapsedFrameTime=(0,a.HA)(performance.now()-e),d.deltaTime=0===r.ticks?(0,a.HA)(0):t,r.phases[n]?.call(r,d)))})),O[i].push(performance.now()-r)}S(),P.push(performance.now()-e)},reschedule:function(){null!=w&&(cancelAnimationFrame(w),w=requestAnimationFrame(T))}};function v(e){const t=new c(e);return f.push(t),_.willDispatch||(_.willDispatch=!0,(0,r.Y)(E)),t}function b(e){const t=new l(e);return m.push(t),y(),new g(t)}let w=null;function x(e){h=Math.max(0,e)}function T(){const e=performance.now();w=null;const t=m.some((e=>!e.paused&&!e.removed));w=t?requestAnimationFrame(T):null,_.executeFrameTasks(e)}const C=new s.Z;function S(){m.forAll((e=>{e.removed&&C.push(e)})),m.removeUnorderedMany(C.data,C.length),C.clear()}function E(){for(;f.length;){const e=f.shift();e.isActive&&e.callback()}_.willDispatch=!1}function M(e=1,t){const i=(0,o.hh)(),n=()=>{(0,o.Hc)(t)?i.reject((0,o.zE)()):0===e?i():(--e,(0,r.Y)((()=>n())))};return n(),i.promise}function A(e){return M(1,e)}async function R(e){await A(e),await new Promise((t=>requestAnimationFrame((()=>{e?.aborted||t()}))))}const O=p.map((e=>new n.Z(e))),P=new n.Z("total")},95550:(e,t,i)=>{i.d(t,{F2:()=>n,J$:()=>h,So:()=>d,Wv:()=>p,Wz:()=>s,c$:()=>f,gX:()=>u,md:()=>m,s1:()=>c,t_:()=>o,vW:()=>a,zF:()=>l});const r=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function n(e){return e?e/72*96:0}function s(e){return e?72*e/96:0}function o(e){if("string"==typeof e){const t=e.match(r);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),n="-"===e.charAt(0),o="px"===r?s(i):i;return n?-o:o}return console.warn("screenUtils.toPt: input not recognized!"),null}return e}function a(e=0,t=0){return{x:e,y:t}}function l(e){return e?a(e.x,e.y):null}function c(e=0,t=0){return[e,t]}function u(e=0,t=0){return[e,t]}function h(e=0,t=0,i=0){return[e,t,i]}function d(e){return e}function p(e){return e}function f(e){return e}function m(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}},18809:(e,t,i)=>{i.d(t,{t:()=>a});var r=i(67134),n=i(55860),s=i(26096);class o{constructor(e,t){this._observable=new s.s,this._value=e,this._equalityFunction=t}get value(){return(0,n.it)(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}}function a(e,t=r.y7){return new o(e,t)}},84684:(e,t,i)=>{let r;async function n(){return null==r&&(r=Promise.all([i.e(85491),i.e(52700)]).then(i.bind(i,33074)).then((e=>new e.WhereClauseCache(500,500)))),r}async function s(e,t){const i=await n(),r=i.get(e,t);if(null==r)throw i.getError(e,t);return r}function o(e,t){return e||=null,t||=null,"1=1"===e?t??e:"1=1"===t?e??t:e&&t?`(${e}) AND (${t})`:e??t}function a(e,t){return e||=null,t||=null,"1=1"===e||"1=1"===t||e===t?"1=1"===e?e:t:e&&t?`(${e}) OR (${t})`:e??t}function l(e,t){return 0===t.length?null:`${e} IN (${function(e){return e.map((e=>"string"==typeof e?function(e){return`'${e.replaceAll("'","''")}'`}(e):e)).join(",")}(t)})`}i.d(t,{D3:()=>a,EP:()=>s,Tk:()=>l,_$:()=>o})},46576:(e,t,i)=>{i.d(t,{A4:()=>s,L9:()=>o,yV:()=>n});var r=i(17126);class n{}function s(e){return e instanceof r.ld?e===n.instance:"unknown"===e?.toString().toLowerCase()}function o(e){return s(e)?n.instance:e}n.instance=new r.vF("Etc/UTC")},21130:(e,t,i)=>{i.d(t,{Cb:()=>u,Qs:()=>a,gx:()=>o,hP:()=>l,pZ:()=>h,pv:()=>d});var r=i(86745);const n=/\{([^}]+)\}/g;function s(e){return e??""}function o(e,t){return t?e.replaceAll(n,"object"==typeof t?(e,i)=>s((0,r.hS)(i,t)):(e,i)=>s(t(i))):e}function a(e,t){return e.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,(e=>t?.includes(e)?e:`\\${e}`))}function l(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}let c;function u(e){return c??=new DOMParser,c.parseFromString(e||"","text/html").body.innerText||""}function h(e,t){return new RegExp(`{${t}}`,"ig").test(e)}function d(e,...t){let i=e[0];for(let r=0;r<t.length;++r)i+=t[r]+e[r+1];return i}},4637:(e,t,i)=>{i.d(t,{a:()=>l,z:()=>c});var r=i(36663),n=i(41831),s=i(58811),o=(i(39994),i(13802),i(81977)),a=(i(4157),i(40266));let l=class extends n.Z{constructor(e){super(e),this.addHandles([this.on("before-add",(e=>{null==e.item&&e.preventDefault()})),this.on("after-add",(e=>this._own(e.item))),this.on("after-remove",(e=>this._release(e.item)))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(n.Z.ofType(this.itemType.Type))(e):new n.Z(e)}};function c(e,t){return{type:e,cast:s.R,set(i){const r=(0,s.Z)(i,this._get(t),e);r.owner=this,this._set(t,r)}}}(0,r._)([(0,o.Cb)()],l.prototype,"owner",null),l=(0,r._)([(0,a.j)("esri.core.support.OwningCollection")],l)},98940:(e,t,i)=>{i.d(t,{R:()=>u});var r=i(36663),n=i(74396),s=i(23148),o=i(76868),a=i(17262),l=i(81977),c=i(40266);let u=class extends n.Z{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,t,i={}){return this._installWatch(e,t,i,o.watch)}addWhen(e,t,i={}){return this._installWatch(e,t,i,o.when)}addOnCollectionChange(e,t,{initial:i=!1,final:r=!1}={}){const n=++this._handleId;return this.addHandles([(0,o.on)(e,"after-changes",this._createSyncUpdatingCallback(),o.sync),(0,o.on)(e,"change",t,{onListenerAdd:i?e=>t({added:e.toArray(),removed:[]}):void 0,onListenerRemove:r?e=>t({added:[],removed:e.toArray()}):void 0})],n),(0,s.kB)((()=>this.removeHandles(n)))}addPromise(e){if(null==e)return e;const t=++this._handleId;this.addHandles((0,s.kB)((()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this.hasHandles(h)||this._set("updating",!1))})),t),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this.removeHandles(t);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,t,i={},r){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=r(e,t,i);return this.addHandles(o,n),(0,s.kB)((()=>this.removeHandles(n)))}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=(0,o.watch)(e,i,{sync:!0,equals:()=>!1});return this.addHandles(r,t),r}_createSyncUpdatingCallback(){return()=>{this.removeHandles(h),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles((0,a.Os)((()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(h))})),h)}}};(0,r._)([(0,l.Cb)({readOnly:!0})],u.prototype,"updating",void 0),u=(0,r._)([(0,c.j)("esri.core.support.UpdatingHandles")],u);const h=-42},618:(e,t,i)=>{function r(e,t,i,r){let n=null,s=1e3;"number"==typeof t?(s=t,r=i):(n=t??null,s=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},c=(...e)=>{n&&n.apply(r,e),o=e,s?a||(a=setTimeout(l,s)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}i.d(t,{P:()=>r})},12928:(e,t,i)=>{function r(e){return e}function n(e){return 1e3*e}function s(e){return e}function o(e){return.001*e}i.d(t,{D9:()=>o,HA:()=>r,_H:()=>s,up:()=>n})},807:(e,t,i)=>{i.d(t,{JE:()=>c,Nm:()=>a,Ov:()=>h,fM:()=>o,kO:()=>l,rJ:()=>u});var r=i(72057),n=i(97718),s=i(17126);const o={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function a(e,t,i,o=n.By){const a=new s.vF((0,r.f1)(o)),l=s.ou.fromJSDate(e,{zone:a}),c="decades"===i||"centuries"===i?"year":d(i);return"decades"===i&&(t*=10),"centuries"===i&&(t*=100),l.plus({[c]:t}).toJSDate()}function l(e,t,i="milliseconds"){const r=e.getTime(),n=u(t,i,"milliseconds");return new Date(r+n)}function c(e,t,i=n.By){const o=new s.vF((0,r.f1)(i)),a=s.ou.fromJSDate(e,{zone:o});if("decades"===t||"centuries"===t){const e=a.startOf("year"),{year:i}=e,r=i-i%("decades"===t?10:100);return e.set({year:r}).toJSDate()}const l=d(t);return a.startOf(l).toJSDate()}function u(e,t,i){return 0===e?0:e*o[t]/o[i]}function h(e,t){return e&&t?e.intersection(t):e||t}function d(e){switch(e){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}},86098:(e,t,i)=>{i.d(t,{B3:()=>m,Hx:()=>c,KZ:()=>o,Op:()=>y,Q7:()=>g,Uc:()=>l,W0:()=>n,ZY:()=>u,c8:()=>f,eP:()=>r,fS:()=>d,fU:()=>p,lq:()=>s,xZ:()=>h,z3:()=>a});i(39994);function r(e){return e instanceof ArrayBuffer}function n(e){return"Int8Array"===e?.constructor?.name}function s(e){return"Uint8Array"===e?.constructor?.name}function o(e){return"Uint8ClampedArray"===e?.constructor?.name}function a(e){return"Int16Array"===e?.constructor?.name}function l(e){return"Uint16Array"===e?.constructor?.name}function c(e){return"Int32Array"===e?.constructor?.name}function u(e){return"Uint32Array"===e?.constructor?.name}function h(e){return"Float32Array"===e?.constructor?.name}function d(e){return"Float64Array"===e?.constructor?.name}function p(e){return"buffer"in e}const f=1024;function m(e){return d(e)||h(e)||c(e)||a(e)||n(e)}function g(e){return d(e)||h(e)}function y(e){return d(e)?179769e303:h(e)?3402823e32:u(e)?4294967295:l(e)?65535:s(e)||o(e)?255:c(e)?2147483647:a(e)?32767:n(e)?127:256}},7958:(e,t,i)=>{i.d(t,{D:()=>s,J:()=>n});let r=0;const n=0;function s(){return++r}},90551:(e,t,i)=>{i.d(t,{L4:()=>T,LO:()=>d,Qv:()=>u,Rd:()=>p,Ud:()=>y,VG:()=>h,Wv:()=>m,Zv:()=>v,aC:()=>b,h9:()=>g,ld:()=>w,mg:()=>f,q6:()=>_,sS:()=>M,yc:()=>x});var r=i(25015),n=i(16068),s=i(19431),o=i(39405),a=i(21130),l=i(17321),c=i(25741);function u(e,t,i){return e.units[t][i]}function h(e,t,i,r=2,n="abbr"){return`${(0,c.uf)(t,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:t>0?"never":"exceptZero"})} ${u(e,i,n)}`}function d(e,t,i,r=2,n="abbr"){return`${(0,c.uf)(t,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${u(e,i,n)}`}function p(e,t,i,r=2,n="abbr"){const s=(0,l.Y8)(t,i);return h(e,(0,l.En)(t,i,s),s,r,n)}function f(e,t,i,r=2,n="abbr"){const s=(0,l.Y8)(t,i);return d(e,(0,l.En)(t,i,s),s,r,n)}function m(e,t,i,r=2,n="abbr"){const s=(0,l.Dw)(t,i);return h(e,(0,l.En)(t,i,s),s,r,n)}function g(e,t,i,r=2,n="abbr"){const s=(0,l.Dw)(t,i);return d(e,(0,l.En)(t,i,s),s,r,n)}function y(e,t,i,r=2,n="abbr"){const s=(0,l.Q7)(t,i);return h(e,(0,l.En)(t,i,s),s,r,n)}function _(e,t,i,r=2,n="abbr"){const s=(0,l.Q7)(t,i);return d(e,(0,l.En)(t,i,s),s,r,n)}function v(e,t,i,r=2,n="abbr"){const s=(0,l.jl)(t,i);return h(e,(0,l.En)(t,i,s),s,r,n)}function b(e,t,i,r=2,n="abbr"){const s=(0,l.jl)(t,i);return d(e,(0,l.En)(t,i,s),s,r,n)}function w(e,t,i,r=2,n="abbr"){const s=(0,l.ZI)(t,i);return h(e,(0,l.En)(t,i,s),s,r,n)}function x(e,t,i,r=2,n="abbr"){const s=(0,l.LV)(t,i);return h(e,(0,l.En)(t,i,s),s,r,n)}function T(e,t,i,r,s,a=n.BV,u=!0){let h=a.normalize((0,o.hw)((0,l.En)(e,t,"degrees"),i,r),0,u);const d=((e,t)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:t,minimumFractionDigits:t,signDisplay:e>0?"never":"exceptZero"}))(h,s??2);return h=S(h,d),(0,c.uf)(h,d)}const C=new Map;function S(e,t){const i=JSON.stringify(t);let r=C.get(i);return r||(r=new Intl.NumberFormat("en-US",t),C.set(i,r)),/^[-+]?360\.?0*?$/.test(r.format(e))?0:e}const E=["B","kB","MB","GB","TB"];function M(e,t){let i=0===(t=Math.round(t))?0:Math.floor(Math.log(t)/Math.log(r.Y.KILOBYTES));i=(0,s.uZ)(i,0,E.length-1);const n=(0,c.uf)(t/r.Y.KILOBYTES**i,{maximumFractionDigits:2});return(0,a.gx)(e.units.bytes[E[i]],{fileSize:n})}},17321:(e,t,i)=>{i.d(t,{$C:()=>B,CN:()=>re,Dw:()=>L,En:()=>C,Jo:()=>ie,KR:()=>k,LV:()=>U,Q7:()=>D,UF:()=>x,V7:()=>R,Y8:()=>I,Y_:()=>p,Z7:()=>j,ZI:()=>F,ZO:()=>w,_R:()=>V,c9:()=>G,cM:()=>H,gV:()=>te,h8:()=>M,hd:()=>l,j5:()=>Y,jl:()=>N,nC:()=>E,oD:()=>v,oq:()=>X,qE:()=>$,qp:()=>S,r6:()=>Z,s_:()=>Q,ty:()=>z,up:()=>A,wd:()=>O,y:()=>J,yT:()=>ee,yv:()=>P});i(39994);var r=i(25709),n=i(69442),s=i(14260),o=i(35925),a=i(36644);const l=39.37,c=s.sv.radius*Math.PI/200,u=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,h=a.Z,d=/UNIT\[([^\]]+)]/i,p=new Set([4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104025,104026,104139,104140]),f=(0,r.w)()({millimeter:"millimeters",centimeter:"centimeters",meter:"meters",meter_german:"german-meters",kilometer:"kilometers",decimeter:"decimeters",micrometer:"micrometers",nanometer:"nanometers","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",fathom:"fathoms",nautical_mile:"nautical-miles",chain_us:"us-chains",link_us:"us-links",mile_us:"us-miles",yard_clarke:"clarke-yards",chain_clarke:"clarke-chains",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",link_sears:"sears-links",yard_benoit_1895_a:"benoit-1895-a-yards",foot_benoit_1895_a:"benoit-1895-a-feet",chain_benoit_1895_a:"benoit-1895-a-chains",link_benoit_1895_a:"benoit-1895-a-links",yard_benoit_1895_b:"benoit-1895-b-yards",foot_benoit_1895_b:"benoit-1895-b-feet",chain_benoit_1895_b:"benoit-1895-b-chains",link_benoit_1895_b:"benoit-1895-b-links",foot_1865:"1865-feet",foot_indian:"indian-feet",foot_indian_1937:"indian-1937-feet",foot_indian_1962:"indian-1962-feet",foot_indian_1975:"indian-1975-feet",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",yard_indian_1962:"indian-1962-yards",yard_indian_1975:"indian-1975-yards",statute_mile:"statute-miles",foot_gold_coast:"gold-coast-feet",foot_british_1936:"british-1936-feet",yard:"yards",chain:"chains",link:"links",yard_sears_1922_truncated:"sears-1922-truncated-yards",foot_sears_1922_truncated:"sears-1922-truncated-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains",link_sears_1922_truncated:"sears-1922-truncated-links",yard_us:"us-yards",inch:"inches",inch_us:"us-inches",rod:"rods",rod_us:"us-rods",nautical_mile_us:"us-nautical-miles",nautical_mile_uk:"uk-nautical-miles",smoot:"smoots",vara_tx:"tx-vara",point:"points"}),m=e=>e*e,g=e=>e*e*e,y={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},meters:{inBaseUnits:1},feet:{inBaseUnits:.3048},"us-feet":{inBaseUnits:.3048006096012192},"clarke-feet":{inBaseUnits:.3047972654},fathoms:{inBaseUnits:1.8288},"nautical-miles":{inBaseUnits:1852},"german-meters":{inBaseUnits:1.0000135965},"us-chains":{inBaseUnits:20.11684023368047},"us-links":{inBaseUnits:.2011684023368047},"us-miles":{inBaseUnits:1609.347218694438},kilometers:{inBaseUnits:1e3},"clarke-yards":{inBaseUnits:.9143917962},"clarke-chains":{inBaseUnits:20.1166195164},"clarke-links":{inBaseUnits:.201166195164},"sears-yards":{inBaseUnits:.9143984146160287},"sears-feet":{inBaseUnits:.3047994715386762},"sears-chains":{inBaseUnits:20.11676512155263},"sears-links":{inBaseUnits:.2011676512155263},"benoit-1895-a-yards":{inBaseUnits:.9143992},"benoit-1895-a-feet":{inBaseUnits:.3047997333333333},"benoit-1895-a-chains":{inBaseUnits:20.1167824},"benoit-1895-a-links":{inBaseUnits:.201167824},"benoit-1895-b-yards":{inBaseUnits:.9143992042898124},"benoit-1895-b-feet":{inBaseUnits:.3047997347632708},"benoit-1895-b-chains":{inBaseUnits:20.11678249437587},"benoit-1895-b-links":{inBaseUnits:.2011678249437587},"1865-feet":{inBaseUnits:.3048008333333334},"indian-feet":{inBaseUnits:.3047995102481469},"indian-1937-feet":{inBaseUnits:.30479841},"indian-1962-feet":{inBaseUnits:.3047996},"indian-1975-feet":{inBaseUnits:.3047995},"indian-yards":{inBaseUnits:.9143985307444408},"indian-1937-yards":{inBaseUnits:.91439523},"indian-1962-yards":{inBaseUnits:.9143988},"indian-1975-yards":{inBaseUnits:.9143985},miles:{inBaseUnits:1609.344},"statute-miles":{inBaseUnits:1609.344},"gold-coast-feet":{inBaseUnits:.3047997101815088},"british-1936-feet":{inBaseUnits:.3048007491},yards:{inBaseUnits:.9144},chains:{inBaseUnits:20.1168},links:{inBaseUnits:.201168},"sears-1922-truncated-yards":{inBaseUnits:.914398},"sears-1922-truncated-feet":{inBaseUnits:.3047993333333334},"sears-1922-truncated-chains":{inBaseUnits:20.116756},"sears-1922-truncated-links":{inBaseUnits:.20116756},"us-yards":{inBaseUnits:.9144018288036576},decimeters:{inBaseUnits:.1},inches:{inBaseUnits:.0254},"us-inches":{inBaseUnits:.0254000508001016},rods:{inBaseUnits:5.0292},"us-rods":{inBaseUnits:5.029210058420118},"us-nautical-miles":{inBaseUnits:1853.248},"uk-nautical-miles":{inBaseUnits:1853.184},smoots:{inBaseUnits:1.7018},"tx-vara":{inBaseUnits:.8466683600033867},points:{inBaseUnits:.0003527777777777778},micrometers:{inBaseUnits:1e-6},nanometers:{inBaseUnits:1e-9},"50-kilometers":{inBaseUnits:5e4},"150-kilometers":{inBaseUnits:15e4}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:m(.001)},"square-centimeters":{inBaseUnits:m(.01)},"square-decimeters":{inBaseUnits:m(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:m(1e3)},"square-inches":{inBaseUnits:m(.0254)},"square-feet":{inBaseUnits:m(.3048)},"square-yards":{inBaseUnits:m(.9144)},"square-miles":{inBaseUnits:m(1609.344)},"square-nautical-miles":{inBaseUnits:m(1852)},"square-us-feet":{inBaseUnits:m(1200/3937)},acres:{inBaseUnits:.0015625*m(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*g(.001)},"cubic-centimeters":{inBaseUnits:1e3*g(.01)},"cubic-decimeters":{inBaseUnits:1e3*g(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*g(1e3)},"cubic-inches":{inBaseUnits:1e3*g(.0254)},"cubic-feet":{inBaseUnits:1e3*g(.3048)},"cubic-yards":{inBaseUnits:1e3*g(.9144)},"cubic-miles":{inBaseUnits:1e3*g(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},_=(()=>{const e={};for(const t in y)for(const i in y[t].units)e[i]=t;return e})();const v=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],b=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function w(e){return"imperial"===e||"metric"===e}function x(e){const t=_[e];if(!t)throw new Error("unknown type");return t}function T(e,t=null){return t=t||x(e),y[t].baseUnit===e}function C(e,t,i){if(t===i)return e;const r=x(t);if(r!==x(i))throw new Error("incompatible units");const n=T(t,r)?e:function(e,t,i){return e*y[i].units[t].inBaseUnits}(e,t,r);return T(i,r)?n:function(e,t,i){return e/y[i].units[t].inBaseUnits}(n,i,r)}function S(e,t,i,r=!1){if(!r&&(0,o.sT)(t))throw new Error("Unable to convert from an angular unit to a linear unit.");const n=$(t);return n!==i&&(e=n?C(e,n,i):C(e*=G(t),"meters",i)),e}function E(e,t,i,r=!1){if(!r&&(0,o.sT)(i))throw new Error("Unable to convert from a linear unit to an angular unit.");const n=$(i);return t!==n&&(e=n?C(e,t,n):C(e,t,"meters")/G(i)),e}function M(e){switch(e){case"metric":return"meters";case"imperial":return"feet";default:return e}}function A(e){return M(e)}function R(e){switch(e){case"metric":return"square-meters";case"imperial":return"square-feet";default:return e}}function O(e,t,i){switch(i){case"metric":return I(e,t);case"imperial":return D(e,t);default:return i}}function P(e,t,i){switch(i){case"metric":return L(e,t);case"imperial":return N(e,t);default:return i}}function I(e,t){const i=C(e,t,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function L(e,t){const i=C(e,t,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function D(e,t){const i=C(e,t,"feet");return Math.abs(i)<1e3?"feet":"miles"}function N(e,t){const i=C(e,t,"feet");return Math.abs(i)<1e5?"feet":"miles"}function F(e,t){const i=C(e,t,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function U(e,t){const i=C(e,t,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function k(e,t,i){switch(i){case"metric":return F(e,t);case"imperial":return U(e,t);default:return i}}function z(e,t,i){return C(e,t,"meters")/(i*Math.PI/180)}function B(e){return f.fromJSON(e.toLowerCase())||null}function V(e){if(null!=e&&!(0,o.N$)(e))return 1;const t=G(e);return t>1e5?1:t}function H(e){return G(e)>=(0,n.Iu)(e).metersPerDegree?"meters":$(e)}function G(e,t=s.sv.metersPerDegree){return j(e,!0)??t}function j(e,t=!1){const i=e?.wkid??null,r=e?.wkt2??e?.wkt??null;let n=null;if(i){if((0,o.o$)(i))return s.yr.metersPerDegree;if((0,o.ME)(i))return s.Z1.metersPerDegree;n=h.values[h[i]],!n&&t&&p.has(i)&&(n=c)}else r&&(Q(r)?n=q(u.exec(r),n):K(r)&&(n=q(d.exec(r),n)));return n}function Z(e){return(0,o.sT)(e)?1:G(e)}function q(e,t){return e?.[1]?W(e[1]):t}function W(e){return parseFloat(e.split(",")[1])}function $(e){const t=e?.wkid??null,i=e?.wkt2??e?.wkt??null;let r=null;if(t)r=h.units[h[t]];else if(i){const e=Q(i)?u:K(i)?d:null;if(e){const t=e.exec(i);t?.[1]&&(r=function(e){const t=/[\\"']{1}([^\\"']+)/.exec(e);let i=t?.[1];if(!i||!B(i)){const t=W(e);i=null;const r=h.values;for(let e=0;e<r.length;++e)if(Math.abs(t-r[e])<1e-7){i=h.units[e];break}}return i}(t[1]))}}return null!=r?B(r):null}function Y(e){const t=$(e);return null!=t&&v.includes(t)?t:null}function J(e){const t=H(e);return null!=t&&v.includes(t)?t:null}function X(e){const t=$(e);return null==t?null:b.get(t)}function K(e){return/^GEOCCS/i.test(e)}function Q(e){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(e)}function ee(e){const t=$(e);if(null==t)return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"fathoms":case"nautical-miles":case"us-chains":case"us-links":case"us-miles":case"clarke-yards":case"clarke-chains":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"sears-links":case"benoit-1895-a-yards":case"benoit-1895-a-feet":case"benoit-1895-a-chains":case"benoit-1895-a-links":case"benoit-1895-b-yards":case"benoit-1895-b-feet":case"benoit-1895-b-chains":case"benoit-1895-b-links":case"1865-feet":case"indian-feet":case"indian-1937-feet":case"indian-1962-feet":case"indian-1975-feet":case"indian-yards":case"indian-1937-yards":case"indian-1962-yards":case"indian-1975-yards":case"statute-miles":case"gold-coast-feet":case"british-1936-feet":case"yards":case"chains":case"links":case"sears-1922-truncated-yards":case"sears-1922-truncated-feet":case"sears-1922-truncated-chains":case"sears-1922-truncated-links":case"us-yards":case"inches":case"us-inches":case"rods":case"us-rods":case"us-nautical-miles":case"uk-nautical-miles":case"smoots":case"tx-vara":case"points":return"imperial";case"millimeters":case"centimeters":case"meters":case"german-meters":case"kilometers":case"decimeters":case"micrometers":case"nanometers":case"50-kilometers":case"150-kilometers":return"metric"}return null}const te=(0,r.w)()({esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"}),ie=(0,r.w)()({esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"}),re=(0,r.w)()({esriDUDecimalDegrees:"degrees",esriDURadians:"radians"})},3466:(e,t,i)=>{i.d(t,{$U:()=>le,AH:()=>Q,B7:()=>O,D6:()=>H,Fv:()=>W,HK:()=>K,Hu:()=>ve,IR:()=>Ce,Ie:()=>ge,L:()=>M,Ml:()=>xe,P$:()=>Y,PF:()=>q,Qj:()=>me,R9:()=>b,TI:()=>E,YP:()=>J,Yd:()=>de,ZN:()=>be,Zo:()=>k,_l:()=>re,b7:()=>P,ed:()=>U,fZ:()=>Te,fl:()=>we,fw:()=>se,gi:()=>ne,hF:()=>Z,hO:()=>ce,jc:()=>X,kl:()=>G,mN:()=>A,oC:()=>oe,oh:()=>V,qg:()=>I,rS:()=>ee,sJ:()=>ie,tD:()=>F,tm:()=>z,u0:()=>R,v_:()=>$,vt:()=>pe,xs:()=>fe,zd:()=>_e});var r=i(51366),n=i(7753),s=i(70375),o=i(82064),a=i(13802),l=i(71924),c=i(53729);const u=r.Z.request,h="esri/config: esriConfig.request.proxyUrl is not set.",d=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,p=/^\s*http:/i,f=/^\s*https:/i,m=/^\s*file:/i,g=/:\d+$/,y=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,_=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),v=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");class b{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let t=this.uri.match(_);this.scheme=t[2]||(t[1]?"":null),this.authority=t[4]||(t[3]?"":null),this.path=t[5],this.query=t[7]||(t[6]?"":null),this.fragment=t[9]||(t[8]?"":null),null!=this.authority&&(t=this.authority.match(v),this.user=t[3]||null,this.password=t[4]||null,this.host=t[6]||t[7],this.port=t[9]||null)}toString(){return this.uri}}const w={},x=new b(r.Z.applicationUrl);let T=x;const C=function(){const e=T.path,t=e.slice(0,e.lastIndexOf("/")+1);return`${T.scheme}://${T.host}${null!=T.port?`:${T.port}`:""}${t}`}();let S=C;const E=()=>T,M=()=>S;function A(e){if(!e)return null;const t={path:null,query:null},i=new b(e),r=e.indexOf("?");return null===i.query?t.path=e:(t.path=e.slice(0,r),t.query=R(i.query)),i.fragment&&(t.hash=i.fragment,null===i.query&&(t.path=t.path.slice(0,t.path.length-(i.fragment.length+1)))),t}function R(e){const t=e.split("&"),i={};for(const e of t){if(!e)continue;const t=e.indexOf("=");let r,n;t<0?(r=decodeURIComponent(e),n=""):(r=decodeURIComponent(e.slice(0,t)),n=decodeURIComponent(e.slice(t+1)));let s=i[r];"string"==typeof s&&(s=i[r]=[s]),Array.isArray(s)?s.push(n):i[r]=n}return i}function O(e,t){return e?t&&"function"==typeof t?Object.keys(e).map((i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i])))).join("&"):Object.keys(e).map((i=>{const r=e[i];if(null==r)return"";const n=encodeURIComponent(i)+"=",s=t?.[i];return s?n+encodeURIComponent(s(r)):Array.isArray(r)?r.map((e=>o.Z.isSerializable(e)?n+encodeURIComponent(JSON.stringify(e)):n+encodeURIComponent(e))).join("&"):o.Z.isSerializable(r)?n+encodeURIComponent(JSON.stringify(r)):n+encodeURIComponent(r)})).filter((e=>e)).join("&"):""}function P(e=!1){let t,i=u.proxyUrl;if("string"==typeof e){t=le(e);const r=U(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw a.Z.getLogger("esri.core.urlUtils").warn(h),new s.Z("urlUtils:proxy-not-set",h);return t&&ue()&&(i=ce(i)),A(i)}function I(e,t=!1){const i=U(e);let r,n;if(i){const e=D(i.proxyUrl);r=e.path,n=e.query?R(e.query):null}else if(t){const t=P(e);r=t.path,n=t.query}if(r){const t=A(e);e=r+"?"+t.path;const i=O({...n,...t.query});i&&(e=`${e}?${i}`)}return e}const L={path:"",query:""};function D(e){const t=e.indexOf("?");return-1!==t?(L.path=e.slice(0,t),L.query=e.slice(t+1)):(L.path=e,L.query=null),L}function N(e){return(e=he(e=fe(e=D(e).path),!0)).toLowerCase()}function F(e){const t={proxyUrl:e.proxyUrl,urlPrefix:N(e.urlPrefix)},i=u.proxyRules,r=t.urlPrefix;let n=i.length;for(let e=0;e<i.length;e++){const t=i[e].urlPrefix;if(0===r.indexOf(t)){if(r.length===t.length)return-1;n=e;break}0===t.indexOf(r)&&(n=e+1)}return i.splice(n,0,t),n}function U(e){const t=u.proxyRules,i=N(e);for(let e=0;e<t.length;e++)if(0===i.indexOf(t[e].urlPrefix))return t[e]}function k(e,t){if(!e||!t)return!1;e=B(e),t=B(t);const i=(0,l.a5)(e),r=(0,l.a5)(t);return null!=i&&null!=r?i.portalHostname===r.portalHostname:null==i&&null==r&&H(e,t,!0)}function z(e,t){return e=B(e),t=B(t),he(e)===he(t)}function B(e){const t=(e=W(e)).indexOf("/sharing");return t>0?e.slice(0,t):e.replace(/\/+$/,"")}function V(e,t=u.interceptors){const i=t=>null==t||t instanceof RegExp&&t.test(e)||"string"==typeof t&&e.startsWith(t);if(t)for(const e of t)if(Array.isArray(e.urls)){if(e.urls.some(i))return e}else if(i(e.urls))return e;return null}function H(e,t,i=!1){if(!e||!t)return!1;const r=ye(e),n=ye(t);return!(!i&&r.scheme!==n.scheme)&&null!=r.host&&null!=n.host&&r.host.toLowerCase()===n.host.toLowerCase()&&r.port===n.port}function G(e){if("string"==typeof e){if(!J(e))return!0;e=ye(e)}if(H(e,T))return!0;const t=u.trustedServers||[];for(let i=0;i<t.length;i++){const r=j(t[i]);for(let t=0;t<r.length;t++)if(H(e,r[t]))return!0}return!1}function j(e){return w[e]||(ae(e)||oe(e)?w[e]=[new b(Z(e))]:w[e]=[new b(`http://${e}`),new b(`https://${e}`)]),w[e]}function Z(e,t=S,i){return oe(e)?i?.preserveProtocolRelative?e:"http"===T.scheme&&T.authority===Y(e).slice(2)?`http:${e}`:`https:${e}`:ae(e)?e:$("/"===e[0]?function(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return-1===i?e:e.slice(0,i)}(t):t,e)}function q(e,t=S,i){if(null==e||!J(e))return e;const r=W(e),n=r.toLowerCase(),s=W(t).toLowerCase().replace(/\/+$/,""),o=i?W(i).toLowerCase().replace(/\/+$/,""):null;if(o&&0!==s.indexOf(o))return e;const a=(e,t,i)=>-1===(i=e.indexOf(t,i))?e.length:i;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(-1===c)return e;if(o&&c<o.length)return e;e=r.slice(c);const u=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let t=0;t<u;t++)e=`../${e}`;else e=`./${e}`;return e}function W(e){return function(e){const t=u.httpsDomains;if(!function(e){return null!=e&&p.test(e)||"http"===T.scheme&&oe(e)}(e))return e;const i=e.indexOf("/",7);let r;if(r=-1===i?e:e.slice(0,i),r=r.toLowerCase().slice(7),g.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return"http"===T.scheme&&r===T.authority&&!y.test(e)||(ue()&&r===T.authority||t&&t.some((e=>r===e||r.endsWith(`.${e}`)))||ue()&&!U(e))&&(e=ce(e)),e}(e=function(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}(e=function(e){if(/^https?:\/\//i.test(e)){const t=D(e);e=(e=t.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}(e=Z(e=e.trim()))))}function $(...e){const t=e.filter(n.pC);if(!t?.length)return;const i=[];if(J(t[0])){const e=t[0],r=e.indexOf("//");-1!==r&&(i.push(e.slice(0,r+1)),function(e){return null!=e&&m.test(e)}(t[0])&&(i[0]+="/"),t[0]=e.slice(r+2))}else"/"===t[0][0]&&i.push("");const r=t.reduce(((e,t)=>t?e.concat(t.split("/")):e),[]);for(let e=0;e<r.length;e++){const t=r[e];".."===t&&i.length>0&&".."!==i[i.length-1]?i.pop():(!t&&e===r.length-1||t&&("."!==t||0===i.length))&&i.push(t)}return i.join("/")}function Y(e,t=!1){if(null==e||X(e)||K(e))return null;let i=e.indexOf("://");if(-1===i&&oe(e))i=2;else{if(-1===i)return null;i+=3}const r=e.indexOf("/",i);return-1!==r&&(e=e.slice(0,r)),t&&(e=he(e,!0)),e}function J(e){return oe(e)||ae(e)}function X(e){return null!=e&&"blob:"===e.slice(0,5)}function K(e){return null!=e&&"data:"===e.slice(0,5)}function Q(e){const t=ie(e);return t?.isBase64?(0,c.R)(t.data):null}function ee(e){return(0,c.s)(e).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const te=/^data:(.*?)(;base64)?,(.*)$/;function ie(e){const t=e.match(te);if(!t)return null;const[,i,r,n]=t;return{mediaType:i,isBase64:!!r,data:n}}function re(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}async function ne(e){return(await fetch(e)).blob()}function se(e){const t=Q(e);if(!t)return null;const i=ie(e);return new Blob([t],{type:i.mediaType})}function oe(e){return null!=e&&"/"===e[0]&&"/"===e[1]}function ae(e){return null!=e&&d.test(e)}function le(e){return null!=e&&f.test(e)||"https"===T.scheme&&oe(e)}function ce(e){return oe(e)?`https:${e}`:e.replace(p,"https:")}function ue(){return"https"===T.scheme}function he(e,t=!1){return oe(e)?e.slice(2):(e=e.replace(d,""),t&&e.length>1&&"/"===e[0]&&"/"===e[1]&&(e=e.slice(2)),e)}function de(e){let t=0;if(J(e)){const i=e.indexOf("//");-1!==i&&(t=i+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function pe(e,t){if(!e)return"";const i=A(e).path.replace(/\/+$/,""),r=i.slice(i.lastIndexOf("/")+1);if(!t?.length)return r;const n=new RegExp(`\\.(${t.join("|")})$`,"i");return r.replace(n,"")}function fe(e){return e.endsWith("/")?e:`${e}/`}function me(e){return e.replace(/\/+$/,"")}function ge(e,t,i){if(!(t&&i&&e&&J(e)))return e;const r=e.indexOf("//"),n=e.indexOf("/",r+2),s=e.indexOf(":",r+2),o=Math.min(n<0?e.length:n,s<0?e.length:s);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function ye(e){return"string"==typeof e?new b(Z(e)):(e.scheme||(e.scheme=T.scheme),e)}function _e(e){return Ee.test(e)}function ve(e,t){const i=A(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function be(e,t,i){const r=A(e),n=r.query||{};return n[t]=String(i),`${r.path}?${O(n)}`}function we(e,t){if(!t)return e;const i=A(e),r=i.query||{};for(const[e,i]of Object.entries(t))null!=i&&(r[e]=i);const n=O(r);return n?`${i.path}?${n}`:i.path}function xe(e){if(null==e)return null;const t=e.match(Se);return t?t[2]:null}function Te(e){if(null==e)return null;const t=e.match(Se);return t?{path:t[1],extension:t[2]}:{path:e,extension:null}}async function Ce(e){return"string"==typeof e?ie(e)??{data:e}:new Promise(((t,i)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(ie(r.result)),r.onerror=e=>i(e)}))}const Se=/([^.]*)\.([^/]*)$/,Ee=/(^data:image\/svg|\.svg$)/i},12173:(e,t,i)=>{i.d(t,{DO:()=>n,L3:()=>a,dG:()=>o,zS:()=>s});const r="randomUUID"in crypto;function n(){if(r)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=t=>e[t].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}function s(){return`{${n().toUpperCase()}}`}function o(){return`{${n()}}`}function a(e){const t=e.toUpperCase();return"{"!==e[0]?`{${t}}`:t}},97595:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(23148),n=(i(39994),i(78668)),s=i(58713),o=i(74143),a=i(6455),l=i(56481);class c{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new s.Z}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise(((i,r)=>{let s=!0;const o=e=>{(0,n.k_)(t.signal),s&&(s=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let s=0;s<e.length;++s){const a=e[s];(0,n.y8)(a)?this._clientPromises[s]=a.then((e=>(this._clients[s]=new l.Z(e,t,this._ongoingJobsQueue),o(i),this._clients[s])),(()=>(o(r),null))):(this._clients[s]=new l.Z(a,t,this._ongoingJobsQueue),this._clientPromises[s]=Promise.resolve(this._clients[s]),o(i))}}))}broadcast(e,t,i){const r=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const s=this._clientPromises[n];r[n]=s.then((r=>r?.invoke(e,t,i)))}return r}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject((0,n.zE)(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then((e=>e?.close()));this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,(0,o.E)(this)}invoke(e,t,i){return this.apply(e,[t],i)}apply(e,t,i){const r=(0,n.hh)();this._ongoingJobsQueue.push({methodName:e,data:t,invokeOptions:i,resolver:r});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then((e=>e?.jobAdded()))}return r.promise}createInvokeProxy(e){return(0,a.D)(this,e)}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,r.AL)(this._clients.map((i=>i.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let i=t.length;for(let r=0;r<this._clientPromises.length;++r)this._clientPromises[r].then((n=>{n&&(t[r]=n.openPort()),0==--i&&e(t)}))}))}get test(){}}},6455:(e,t,i)=>{function r(e,t){return new Proxy({},{get:(i,r,n)=>(...i)=>{let n,s;const o=i[i.length-1];return function(e){return"object"==typeof e&&!Array.isArray(e)&&null!=e&&("signal"in e||"transferList"in e||0===Object.keys(e).length)}(o)&&(n=o.signal,s=o.transferList,i.pop()),e.apply(t?`${t}.${r.toString()}`:r.toString(),i,{transferList:s,signal:n})}})}i.d(t,{D:()=>r})},56481:(e,t,i)=>{i.d(t,{Z:()=>b});var r=i(88256),n=i(70375),s=i(49546),o=i(23148),a=i(61681),l=i(78668),c=i(6455);const u={statsWorker:()=>Promise.all([i.e(8638),i.e(92799)]).then(i.bind(i,3805)),geometryEngineWorker:()=>Promise.all([i.e(89067),i.e(69946)]).then(i.bind(i,50922)),arcadeGeometryOperatorsWorker:()=>i.e(97827).then(i.bind(i,97827)),CSVSourceWorker:()=>Promise.all([i.e(10306),i.e(85491),i.e(8638),i.e(42616),i.e(57013)]).then(i.bind(i,57013)),EdgeProcessingWorker:()=>i.e(43042).then(i.bind(i,43042)),ElevationSamplerWorker:()=>i.e(12902).then(i.bind(i,12902)),FeatureServiceSnappingSourceWorker:()=>Promise.all([i.e(10306),i.e(85491),i.e(8638),i.e(42616),i.e(34947)]).then(i.bind(i,34947)),GeoJSONSourceWorker:()=>Promise.all([i.e(10306),i.e(85491),i.e(8638),i.e(42616),i.e(59955)]).then(i.bind(i,59955)),LercWorker:()=>i.e(9821).then(i.bind(i,9821)),MemorySourceWorker:()=>Promise.all([i.e(10306),i.e(85491),i.e(8638),i.e(42616),i.e(98536)]).then(i.bind(i,98536)),PBFDecoderWorker:()=>i.e(95019).then(i.bind(i,95019)),FeaturePipelineWorker:()=>Promise.all([i.e(10306),i.e(85491),i.e(8638),i.e(42616),i.e(95215),i.e(33712),i.e(69725),i.e(50959),i.e(25002),i.e(64850),i.e(39035)]).then(i.bind(i,23381)),PointCloudWorker:()=>i.e(95552).then(i.bind(i,95552)),RasterWorker:()=>Promise.all([i.e(5499),i.e(31434),i.e(72586),i.e(28514)]).then(i.bind(i,28514)),SceneLayerSnappingSourceWorker:()=>i.e(75400).then(i.bind(i,75400)),SceneLayerWorker:()=>i.e(12552).then(i.bind(i,16845)),WFSSourceWorker:()=>Promise.all([i.e(10306),i.e(85491),i.e(8638),i.e(42616),i.e(1691)]).then(i.bind(i,1691)),WorkerTileHandler:()=>i.e(63025).then(i.bind(i,63025)),Lyr3DWorker:()=>i.e(89725).then(i.bind(i,89725)),Feature3DPipelineWorker:()=>Promise.all([i.e(10306),i.e(85491),i.e(8638),i.e(42616),i.e(30838),i.e(37258)]).then(i.bind(i,37258)),TextureCompressionWorker:()=>i.e(2242).then(i.bind(i,2242))};var h=i(71627),d=i(9870);const{CLOSE:p,ABORT:f,INVOKE:m,RESPONSE:g,OPEN_PORT:y,ON:_}=h.Cs;class v{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===h.Cs.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class b{static connect(e,t){const i=new MessageChannel;let r;r="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const n=new b(i.port1,{channel:i,client:r,schedule:t});return"object"==typeof r&&"remoteClient"in r&&(r.remoteClient=n),b.clients.set(n,r),i.port2}static loadWorker(e){const t=u[e];return t?t():Promise.resolve(null)}constructor(e,t,i){this._port=e,this._jobQueue=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new v((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:p}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,i){return this.apply(e,[t],i)}apply(e,t,i){const r=i?.signal,s=i?.transferList;if(!this._port)return Promise.reject(new n.Z(h.xJ,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const o=(0,h.jt)();return new Promise(((i,n)=>{if((0,l.Hc)(r))return this._processWork(),void n((0,l.zE)());const c=(0,l.fu)(r,(()=>{const e=this._outJobs.get(o);e&&(this._outJobs.delete(o),this._processWork(),(0,a.hw)(e.abortHandle),this._post({type:f,jobId:o}),n((0,l.zE)()))})),u={resolve:i,reject:n,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:m,jobId:o,methodName:e,abortable:null!=r},t,s)}))}createInvokeProxy(e){return(0,c.D)(this,e)}on(e,t){const i=new MessageChannel;function r(e){t(e.data)}return this._port.postMessage({type:h.Cs.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",r),i.port1.start(),(0,o.kB)((()=>{i.port1.postMessage({type:h.Cs.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",r)}))}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:y,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=2)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:t,data:i,invokeOptions:r,resolver:n}=e;this.apply(t,i,r).then((e=>n.resolve(e))).catch((e=>n.reject(e)))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{(0,a.hw)(e.abortHandle),e.reject((0,l.zE)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){null!=this._schedule?this._schedule((()=>this._processMessage(e,!0))):this._processMessage(e,!1)}_processMessage(e,t){const i=(0,h.QM)(e);if(i)switch(i.type){case g:this._onResponseMessage(i);break;case m:t?this._onInvokeMessage(i):this._invokeQueue.push(i);break;case f:this._onAbortMessage(i);break;case p:this._onCloseMessage();break;case y:this._onOpenPortMessage(i);break;case _:this._onOnMessage(i)}}_onAbortMessage(e){const t=this._inJobs,i=e.jobId,r=t.get(i);this._invokeQueue.push(e),r&&(r.controller&&r.controller.abort(),t.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&b.clients.get(this)===e&&e.destroy(),b.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:i,data:r=[],abortable:n}=e,s=n?new AbortController:null,o=this._inJobs;let a,c=this._client,u=c[t];try{if(!u&&t&&t.includes(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)c=c[e[t]],u=c[e[t+1]]}if("function"!=typeof u)throw new TypeError(`${t} is not a function`);r.push({client:this,signal:s?s.signal:null}),a=u.apply(c,r)}catch(e){return void this._post({type:g,jobId:i,error:(0,h.AB)(e)})}(0,l.y8)(a)?(o.set(i,{controller:s,promise:a}),a.then((e=>{o.has(i)&&(o.delete(i),this._post({type:g,jobId:i},e))}),(e=>{o.has(i)&&(o.delete(i),(0,l.D_)(e)||this._post({type:g,jobId:i,error:(0,h.AB)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:g,jobId:i},a)}_onOpenPortMessage(e){new b(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,i=this._client.on(e.eventType,(e=>{t.postMessage(e)})),r=(0,s.on)(e.port,"message",(e=>{(0,h.QM)(e)?.type===h.Cs.CLOSE&&(r.remove(),i.remove(),t.close())}))}_onResponseMessage(e){const{jobId:t,error:i,data:r}=e,s=this._outJobs;if(!s.has(t))return;const o=s.get(t);s.delete(t),this._processWork(),(0,a.hw)(o.abortHandle),i?o.reject(n.Z.fromJSON(JSON.parse(i))):o.resolve(r)}_post(e,t,i){return(0,h.oi)(this._port,e,t,i)}}b.kernelInfo={buildDate:d.r,fullVersion:r.bR,revision:d.$},b.clients=new Map},12916:(e,t,i)=>{i.d(t,{q:()=>l});var r=i(7753),n=i(23148),s=i(13802),o=i(78668),a=i(62517);class l{constructor(e,t,i,r,n={}){this._mainMethod=t,this._transferLists=i,this._listeners=[],this._promise=(0,a.bA)(e,{...n,schedule:r}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>s.Z.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${t}`)))}on(e,t){const i={removed:!1,eventName:e,callback:t,threadHandle:null};return this._listeners.push(i),this._connectListener(i),(0,n.kB)((()=>{i.removed=!0,(0,r.Od)(this._listeners,i),this._thread&&null!=i.threadHandle&&i.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,i){if(this._thread){const r=this._transferLists[e],n=r?r(t):[];return this._thread.invoke(e,t,{transferList:n,signal:i})}return this._promise?this._promise.then((()=>((0,o.k_)(i),this.invokeMethod(e,t,i)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}}},74143:(e,t,i)=>{i.d(t,{E:()=>s,z:()=>n});const r=new FinalizationRegistry((e=>{e.close()}));function n(e,t){r.register(e,t,t)}function s(e){r.unregister(e)}},71627:(e,t,i)=>{i.d(t,{AB:()=>c,Cs:()=>o,QM:()=>h,d2:()=>p,jt:()=>l,oi:()=>u,xJ:()=>s});var r=i(39994),n=i(78668);const s="worker:port-closed";var o;!function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"}(o||(o={}));let a=0;function l(){return a++}function c(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function u(e,t,i,n){if(t.type===o.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==o.INVOKE&&t.type!==o.RESPONSE)return void e.postMessage(t);let s;if(function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(i)?(s=d(i.transferList),t.data=i.result):(s=d(n),t.data=i),s){if((0,r.Z)("ff"))for(const i of s)if("byteLength"in i&&i.byteLength>267386880){const i="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case o.INVOKE:throw i;case o.RESPONSE:return void u(e,{type:o.RESPONSE,jobId:t.jobId,error:c(i)})}}e.postMessage(t,s)}else e.postMessage(t)}function h(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function d(e){if(!e?.length)return null;if((0,r.Z)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||"ArrayBuffer"===e?.constructor?.name}(e)));return t.length?t:null}async function p(e){try{return await e}catch(e){const t=e?.name===s;if(!(0,n.D_)(e)&&!t)throw e;return}}},62517:(e,t,i)=>{i.d(t,{j2:()=>H,bA:()=>j});var r=i(70375),n=i(39994),s=i(78668),o=i(97595),a=i(74143),l=i(56481),c=i(13802),u=i(61681),h=i(66341),d=i(3466);const p={async request(e,t){const i=e.options,r=i.responseType;i.signal=t?.signal,i.responseType="native"===r||"native-request-init"===r?"native-request-init":r&&["blob","json","text"].includes(r)&&(0,d.oh)(e.url)?.after?r:"array-buffer";const n=await(0,h.Z)(e.url,i),s={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch(n.requestOptions?.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=(new TextEncoder).encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=(new TextEncoder).encode(s.data).buffer}return{result:s,transferList:[s.data]}}};var f=i(71627),m=i(36567),g=i(51366),y=(i(87090),i(88256));const _={};var v=i(66581);class b{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...i)=>e[t](...i)}))}}class w{constructor(){this._dispatcher=new b,this._workerPostMessage({type:f.Cs.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){(0,v.Y)((()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,i){this._dispatcher.addEventListener(e,t,i)}removeEventListener(e,t,i){this._dispatcher.removeEventListener(e,t,i)}_workerPostMessage(e){(0,v.Y)((()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))}))}async _workerMessageHandler(e){const t=(0,f.QM)(e);if(t&&t.type===f.Cs.OPEN){const{modulePath:e,jobId:i}=t;let r=await l.Z.loadWorker(e);r||(r=await import(e));const n=l.Z.connect(r);this._workerPostMessage({type:f.Cs.OPENED,jobId:i,data:n})}}}var x=i(8108),T=i(9870);const C=()=>c.Z.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:S}=f.Cs;let E,M;const A="Failed to create Worker. Fallback to execute module in main thread";async function R(){if(!(0,n.Z)("esri-workers"))return O(new w);if(!E&&!M)try{const e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split("{CONFIGURATION}").join(function(){let e;if(null!=g.Z.default){const t={...g.Z};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(g.Z));e.assetsPath=(0,d.hF)(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?(0,d.hF)(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,x.Kd)(),e.has={"esri-csp-restrictions":(0,n.Z)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,n.Z)("esri-2d-update-debug"),"esri-2d-log-updating":(0,n.Z)("esri-2d-log-updating"),"featurelayer-pbf":(0,n.Z)("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":(0,n.Z)("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":(0,n.Z)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,n.Z)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,n.Z)("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":(0,n.Z)("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":(0,n.Z)("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":(0,n.Z)("featurelayer-snapshot-enabled"),"esri-atomics":(0,n.Z)("esri-atomics"),"esri-shared-array-buffer":(0,n.Z)("esri-shared-array-buffer"),"esri-tiles-debug":(0,n.Z)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,n.Z)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,n.Z)("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=(0,d.hF)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=(0,d.hF)(e.workers.workerPath):e.workers.workerPath=(0,d.hF)((0,m.V)("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=g.Z.workers.loaderConfig,i=function(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages?.slice()||[],paths:{..._.paths,...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=_.baseUrl),t}({baseUrl:t?.baseUrl,locale:(0,x.Kd)(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t?.has},map:{...t?.map},paths:{...t?.paths},packages:t?.packages||[]}),r={buildDate:T.r,fullVersion:y.bR,revision:T.$};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}());E=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){M=e||{}}let e;if(E)try{e=new Worker(E,{name:"esri-worker-"+P++})}catch(t){C().warn(A,M),e=new w}else C().warn(A,M),e=new w;return O(e)}async function O(e){return new Promise((t=>{function i(n){const s=(0,f.QM)(n);s&&s.type===S&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(t){t.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),C().warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new w).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)}))}let P=0;const{ABORT:I,INVOKE:L,OPEN:D,OPENED:N,RESPONSE:F}=f.Cs;class U{static async create(e){const t=await R();return new U(t,e)}constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),c.Z.getLogger("esri.core.workers.WorkerOwner").error(e)}))}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:i}=t,r=(0,f.jt)();return new Promise(((t,n)=>{const o={resolve:t,reject:n,abortHandle:(0,s.$F)(i,(()=>{this._outJobs.delete(r),this._post({type:I,jobId:r})}))};this._outJobs.set(r,o),this._post({type:D,jobId:r,modulePath:e})}))}_onMessage(e){const t=(0,f.QM)(e);if(t)switch(t.type){case N:this._onOpenedMessage(t);break;case F:this._onResponseMessage(t);break;case I:this._onAbortMessage(t);break;case L:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,i=e.jobId,r=t.get(i);r&&(r.controller&&r.controller.abort(),t.delete(i))}_onInvokeMessage(e){const{methodName:t,jobId:i,data:r,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=p[t];let c;try{if("function"!=typeof l)throw new TypeError(`${t} is not a function`);c=l.call(null,r,{signal:o?o.signal:null})}catch(e){return void this._post({type:F,jobId:i,error:(0,f.AB)(e)})}(0,s.y8)(c)?(a.set(i,{controller:o,promise:c}),c.then((e=>{a.has(i)&&(a.delete(i),this._post({type:F,jobId:i},e))}),(e=>{a.has(i)&&(a.delete(i),e||(e={message:"Error encountered at method"+t}),(0,s.D_)(e)||this._post({type:F,jobId:i,error:(0,f.AB)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:F,jobId:i},c)}_onOpenedMessage(e){const{jobId:t,data:i}=e,r=this._outJobs.get(t);r&&(this._outJobs.delete(t),(0,u.hw)(r.abortHandle),r.resolve(i))}_onResponseMessage(e){const{jobId:t,error:i,data:n}=e,s=this._outJobs.get(t);s&&(this._outJobs.delete(t),(0,u.hw)(s.abortHandle),i?s.reject(r.Z.fromJSON(JSON.parse(i))):s.resolve(n))}_post(e,t,i){return(0,f.oi)(this.worker,e,t,i)}}const k=(0,n.Z)("host-browser")?Math.min(navigator.hardwareConcurrency-1,(0,n.Z)("workers-pool-size")??8):0;let z=(0,n.Z)("esri-mobile")?Math.min(k,3):k;z||(z=(0,n.Z)("safari")&&(0,n.Z)("mac")?7:2);let B=0;const V=[];function H(){W()}async function G(e,t){const i=new o.Z,{registryTarget:r,...n}=t;return await i.open(e,n),r&&(0,a.z)(r,i),i}async function j(e,t={}){if("string"!=typeof e)throw new r.Z("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if((0,n.Z)("host-webworker")&&!(0,n.Z)("esri-workers")&&(i="local"),"local"===i){let i=await l.Z.loadWorker(e);i||(i=await import(e)),(0,s.k_)(t.signal);const r=t.client||i;return G([l.Z.connect(i,t.schedule)],{...t,client:r})}if(await W(),(0,s.k_)(t.signal),"dedicated"===i){const i=B++%z;return G([await V[i].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const i=Math.min(t.maxNumWorkers,z);if(i<z){const r=new Array(i);for(let n=0;n<i;++n){const i=B++%z;r[n]=V[i].open(e,t)}return G(r,t)}}return G(V.map((i=>i.open(e,t))),t)}let Z,q=null;async function W(){if(q)return q;Z=new AbortController;const e=[];for(let t=0;t<z;t++){const i=U.create(t).then((e=>(V[t]=e,e)));e.push(i)}return q=Promise.all(e),q}},91772:(e,t,i)=>{i.d(t,{Z:()=>_});var r,n=i(36663),s=i(21130),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266)),l=i(20031),c=i(10186),u=i(14685),h=i(27127),d=i(68668),p=i(35925),f=i(39536);function m(e,t,i){return null==t?i:null==i?t:e(t,i)}let g=r=class extends l.Z{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,n){return function(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:"object"==typeof e?(e.spatialReference=null==e.spatialReference?u.Z.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:n??u.Z.WGS84}}static fromPoint(e){return new r({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new c.Z({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return null!=this.mmin&&null!=this.mmax}get hasZ(){return null!=this.zmin&&null!=this.zmax}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return null!=e.z&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new r;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,null!=this.zmin&&(e.zmin=this.zmin,e.zmax=this.zmax),null!=this.mmin&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&(0,f.Q8)(t,i)&&(e=t.isWebMercator?(0,f.$)(e):(0,f.Sx)(e,!0)),"point"===e.type?(0,h.aV)(this,e):"extent"===e.type&&(0,h.uP)(this,e)}equals(e){if(this===e)return!0;if(null==e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&(0,f.Q8)(t,i)&&(e=t.isWebMercator?(0,f.$)(e):(0,f.Sx)(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const e=(this.zmax-this.zmin)*t;this.zmin+=e,this.zmax-=e}if(this.hasM){const e=(this.mmax-this.mmin)*t;this.mmin+=e,this.mmax-=e}return this}intersects(e){if(null==e)return!1;"mesh"===e.type&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!(0,p.fS)(t,i)&&(0,f.Q8)(t,i)&&(e=t.isWebMercator?(0,f.$)(e):(0,f.Sx)(e,!0)),(0,d.IY)(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,null!=i&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=m(Math.min,this.zmin,e.zmin),this.zmax=m(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=m(Math.min,this.mmin,e.mmin),this.mmax=m(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:null!=e&&this.intersects(e)?(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=m(Math.max,this.zmin,e.zmin),this.zmax=m(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=m(Math.max,this.mmin,e.mmin),this.mmax=m(Math.min,this.mmax,e.mmax)),this):null}toJSON(e){return this.write({},e)}_shiftCM(e=(0,p.C5)(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?(0,f.Sx)(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=y(r.x,e).x),this.spatialReference=new u.Z((0,s.gx)((t.isWGS84?e.altTemplate:null)??e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,n=this.xmin,s=this.xmax;return n>=i&&n<=r&&s>=i&&s<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;const n=i??(0,p.C5)(r);if(null==n)return this;const s=this._getParts(n).map((e=>e.extent));if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(e)return this._shiftCM(n);if(t)return s;let o=!0,a=!0;return s.forEach((e=>{e.hasZ||(o=!1),e.hasM||(a=!1)})),{rings:s.map((e=>{const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(o){const i=(e.zmax-e.zmin)/2;for(let e=0;e<t.length;e++)t[e].push(i)}if(a){const i=(e.mmax-e.mmin)/2;for(let e=0;e<t.length;e++)t[e].push(i)}return t})),hasZ:o,hasM:a,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:i,ymax:n,spatialReference:s}=this,o=this.width,a=this.xmin,l=this.xmax;let c;e=e||(0,p.C5)(s);const[u,h]=e.valid;c=y(this.xmin,e);const d=c.x,f=c.frameId;c=y(this.xmax,e);const m=c.x,g=c.frameId,_=d===m&&o>0;if(o>2*h){const e=new r(a<l?d:m,i,h,n,s),o=new r(u,i,a<l?m:d,n,s),c=new r(0,i,h,n,s),p=new r(u,i,0,n,s),y=[],_=[];e.contains(c)&&y.push(f),e.contains(p)&&_.push(f),o.contains(c)&&y.push(g),o.contains(p)&&_.push(g);for(let e=f+1;e<g;e++)y.push(e),_.push(e);t.push({extent:e,frameIds:[f]},{extent:o,frameIds:[g]},{extent:c,frameIds:y},{extent:p,frameIds:_})}else d>m||_?t.push({extent:new r(d,i,h,n,s),frameIds:[f]},{extent:new r(u,i,m,n,s),frameIds:[g]}):t.push({extent:new r(d,i,m,n,s),frameIds:[f]});this.cache._parts=t}const i=this.hasZ,n=this.hasM;if(i||n){const e={};i&&(e.zmin=this.zmin,e.zmax=this.zmax),n&&(e.mmin=this.mmin,e.mmax=this.mmax);for(let i=0;i<t.length;i++)t[i].extent.set(e)}return t}};function y(e,t){const[i,r]=t.valid,n=2*r;let s,o=0;return e>r?(s=Math.ceil(Math.abs(e-r)/n),e-=s*n,o=s):e<i&&(s=Math.ceil(Math.abs(e-i)/n),e+=s*n,o=-s),{x:e,frameId:o}}(0,n._)([(0,o.Cb)({readOnly:!0})],g.prototype,"cache",null),(0,n._)([(0,o.Cb)({readOnly:!0})],g.prototype,"center",null),(0,n._)([(0,o.Cb)({readOnly:!0})],g.prototype,"extent",null),(0,n._)([(0,o.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],g.prototype,"hasM",null),(0,n._)([(0,o.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],g.prototype,"hasZ",null),(0,n._)([(0,o.Cb)({readOnly:!0})],g.prototype,"height",null),(0,n._)([(0,o.Cb)({readOnly:!0})],g.prototype,"width",null),(0,n._)([(0,o.Cb)({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],g.prototype,"xmin",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{write:!0}})],g.prototype,"ymin",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],g.prototype,"mmin",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],g.prototype,"zmin",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{write:!0}})],g.prototype,"xmax",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{write:!0}})],g.prototype,"ymax",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],g.prototype,"mmax",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],g.prototype,"zmax",void 0),g=r=(0,n._)([(0,a.j)("esri.geometry.Extent")],g),g.prototype.toJSON.isDefaultToJSON=!0;const _=g},20031:(e,t,i)=>{i.d(t,{Z:()=>u});var r=i(36663),n=i(82064),s=i(81977),o=(i(39994),i(13802),i(4157),i(34248)),a=i(40266),l=i(14685);let c=class extends n.Z{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=l.Z.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof l.Z)return e;if(null!=e){const i=new l.Z;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};(0,r._)([(0,s.Cb)()],c.prototype,"type",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],c.prototype,"cache",null),(0,r._)([(0,s.Cb)({readOnly:!0})],c.prototype,"extent",null),(0,r._)([(0,s.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],c.prototype,"hasM",void 0),(0,r._)([(0,s.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],c.prototype,"hasZ",void 0),(0,r._)([(0,s.Cb)({type:l.Z,json:{write:!0},value:l.Z.WGS84})],c.prototype,"spatialReference",void 0),(0,r._)([(0,o.r)("spatialReference")],c.prototype,"readSpatialReference",null),c=(0,r._)([(0,a.j)("esri.geometry.Geometry")],c);const u=c},64307:(e,t,i)=>{i.d(t,{Z:()=>v});var r,n=i(36663),s=i(7753),o=i(25709),a=i(82064),l=i(17321),c=i(96863),u=i(81977),h=(i(39994),i(13802),i(34248)),d=i(40266),p=i(39835);const f=(0,o.w)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),m=f.jsonValues.slice();(0,s.e$)(m,"orthometric");const g=(0,o.w)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let y=r=class extends a.Z{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return f.write(e,t,i)}readHeightModel(e,t,i){return f.read(e)||(i?.messages&&i.messages.push(function(e,t){return new c.Z("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:i})),null)}readHeightUnit(e,t,i){return g.read(e)||(i?.messages&&i.messages.push(_(e,{context:i})),null)}readHeightUnitService(e,t,i){return(0,l.$C)(e)||g.read(e)||(i?.messages&&i.messages.push(_(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new r({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=(0,l.cM)(t);return new r({heightModel:e.heightModel,heightUnit:i??void 0,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new r;return t.read(e,{origin:"web-scene"}),t}};function _(e,t){return new c.Z("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}(0,n._)([(0,u.Cb)({type:f.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:m,default:"ellipsoidal",write:{isRequired:!0}}}}})],y.prototype,"heightModel",void 0),(0,n._)([(0,p.c)("web-scene","heightModel")],y.prototype,"writeHeightModel",null),(0,n._)([(0,h.r)(["web-scene","service"],"heightModel")],y.prototype,"readHeightModel",null),(0,n._)([(0,u.Cb)({type:g.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:g.jsonValues,write:{writer:g.write,isRequired:!0}}}}})],y.prototype,"heightUnit",void 0),(0,n._)([(0,h.r)("web-scene","heightUnit")],y.prototype,"readHeightUnit",null),(0,n._)([(0,h.r)("service","heightUnit")],y.prototype,"readHeightUnitService",null),(0,n._)([(0,u.Cb)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],y.prototype,"vertCRS",void 0),(0,n._)([(0,h.r)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],y.prototype,"readVertCRS",null),y=r=(0,n._)([(0,d.j)("esri.geometry.HeightModelInfo")],y);const v=y},74304:(e,t,i)=>{i.d(t,{Z:()=>m});var r,n=i(36663),s=i(67134),o=i(81977),a=(i(39994),i(13802),i(40266)),l=i(39835),c=i(91772),u=i(20031),h=i(10186),d=i(36939);function p(e){return(t,i)=>null==t?i:null==i?t:e(t,i)}let f=r=class extends u.Z{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return{};const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):function(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points?.[0];return r&&(void 0===i.hasZ&&void 0===i.hasM?(i.hasZ=r.length>2,i.hasM=!1):void 0===i.hasZ?i.hasZ=r.length>3:void 0===i.hasM&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new c.Z,i=this.hasZ,r=this.hasM,n=i?3:2,s=e[0],o=p(Math.min),a=p(Math.max);let l,u,h,d,[f,m]=s,[g,y]=s;for(let t=0,s=e.length;t<s;t++){const s=e[t],[c,p]=s;if(f=o(f,c),m=o(m,p),g=a(g,c),y=a(y,p),i&&s.length>2){const e=s[2];l=o(l,e),h=a(h,e)}if(r&&s.length>n){const e=s[n];u=o(u,e),d=a(d,e)}}return t.xmin=f,t.ymin=m,t.xmax=g,t.ymax=y,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=h):(t.zmin=void 0,t.zmax=void 0),r?(t.mmin=u,t.mmax=d):(t.mmin=void 0,t.mmax=void 0),t}writePoints(e,t){t.points=(0,s.d9)(this.points)}addPoint(e){return(0,d.l)(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:(0,s.d9)(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new r(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new h.Z(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new h.Z(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?((0,d.l)(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return null!=e&&e>=0&&e<this.points.length}};(0,n._)([(0,o.Cb)({readOnly:!0})],f.prototype,"cache",null),(0,n._)([(0,o.Cb)()],f.prototype,"extent",null),(0,n._)([(0,o.Cb)({type:[[Number]],json:{write:{isRequired:!0}}})],f.prototype,"points",void 0),(0,n._)([(0,l.c)("points")],f.prototype,"writePoints",null),f=r=(0,n._)([(0,a.j)("esri.geometry.Multipoint")],f),f.prototype.toJSON.isDefaultToJSON=!0;const m=f},10186:(e,t,i)=>{i.d(t,{Z:()=>w});var r,n=i(36663),s=i(74396),o=i(13802),a=i(81977),l=i(69236),c=(i(39994),i(4157),i(34248)),u=i(40266),h=i(39835),d=i(7283),p=i(20031),f=i(14685),m=i(18649),g=i(35925),y=i(39536);const _=[0,0];function v(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}let b=r=class extends p.Z{static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",s.Z.isFrozen(i)?i:i.clone())}constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(e,t,i,r,n){let s;if(Array.isArray(e))s=e,n=t,e=s[0],t=s[1],i=s[2],r=s[3];else if(e&&"object"==typeof e){if(s=e,e=null!=s.x?s.x:s.longitude,t=null!=s.y?s.y:s.latitude,i=s.z,r=s.m,(n=s.spatialReference)&&"esri.geometry.SpatialReference"!==n.declaredClass&&(n=new f.Z(n)),null!=s.longitude||null!=s.latitude)if(null==s.longitude)o.Z.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(null==s.latitude)o.Z.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n?.isWebMercator){const i=(0,y.hG)(s.longitude,s.latitude,_);e=i[0],t=i[1]}}else v(i)?(n=i,i=null):v(r)&&(n=r,r=null);const a={x:e,y:t};return null==a.x&&null!=a.y?o.Z.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):null==a.y&&null!=a.x&&o.Z.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),null!=n&&(a.spatialReference=n),null!=i&&(a.z=i),null!=r&&(a.m=r),a}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return void 0!==this.m}set hasM(e){e!==(void 0!==this._get("m"))&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return void 0!==this.z}set hasZ(e){e!==(void 0!==this._get("z"))&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){return(0,m.$L)(this)}set latitude(e){const{spatialReference:t,x:i}=this;null!=e&&t&&(t.isWebMercator?this._set("y",(0,y.hG)(i,e,_)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){return(0,m.c6)(this)}set longitude(e){const{y:t,spatialReference:i}=this;null!=e&&i&&(i.isWebMercator?this._set("x",(0,y.hG)(e,t,_)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return"string"==typeof e?NaN:e}clone(){const e=new r;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return r.copy(e,this),this}equals(e){if(null==e)return!1;const{x:t,y:i,z:r,m:n,spatialReference:s}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:u}=e;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=(0,y.hG)(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=(0,y.R6)(l,c),u=s}return t===l&&i===c&&r===o&&n===a&&s.wkid===u.wkid}offset(e,t,i){return this.x+=e,this.y+=t,null!=i&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const e=(0,g.C5)(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,n=2*r;let s;return t>r?(s=Math.ceil(Math.abs(t-r)/n),t-=s*n):t<i&&(s=Math.ceil(Math.abs(t-i)/n),t+=s*n),this._set("x",t),this}distance(e){return(0,m.TE)(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};(0,n._)([(0,a.Cb)({readOnly:!0})],b.prototype,"cache",null),(0,n._)([(0,a.Cb)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],b.prototype,"hasM",null),(0,n._)([(0,a.Cb)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],b.prototype,"hasZ",null),(0,n._)([(0,a.Cb)({type:Number})],b.prototype,"latitude",null),(0,n._)([(0,a.Cb)({type:Number})],b.prototype,"longitude",null),(0,n._)([(0,a.Cb)({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),(0,l.p)((e=>isNaN(e)?e:(0,d.q9)(e)))],b.prototype,"x",void 0),(0,n._)([(0,h.c)("x")],b.prototype,"writeX",null),(0,n._)([(0,c.r)("x")],b.prototype,"readX",null),(0,n._)([(0,a.Cb)({type:Number,json:{write:!0}})],b.prototype,"y",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],b.prototype,"z",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],b.prototype,"m",void 0),b=r=(0,n._)([(0,u.j)("esri.geometry.Point")],b),b.prototype.toJSON.isDefaultToJSON=!0;const w=b},89542:(e,t,i)=>{i.d(t,{Z:()=>T});var r,n=i(36663),s=i(7753),o=i(67134),a=i(81977),l=(i(39994),i(13802),i(40266)),c=i(39835),u=i(91772),h=i(20031),d=i(10186),p=i(14685),f=i(18449),m=i(27127),g=i(38028),y=i(50842),_=i(68668),v=i(39536),b=i(36939);function w(e){return!Array.isArray(e[0])}let x=r=class extends h.Z{static fromExtent(e){const t=e.clone().normalize(),{spatialReference:i}=e;let n=!1,s=!1;for(const e of t)e.hasZ&&(n=!0),e.hasM&&(s=!0);const o={rings:t.map((e=>{const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(n&&e.hasZ){const i=e.zmin+.5*(e.zmax-e.zmin);for(let e=0;e<t.length;e++)t[e].push(i)}if(s&&e.hasM){const i=e.mmin+.5*(e.mmax-e.mmin);for(let e=0;e<t.length;e++)t[e].push(i)}return t})),spatialReference:i};return n&&(o.hasZ=!0),s&&(o.hasM=!0),new r(o)}constructor(e){super(function(e){if(!e)return;let{rings:t,hasM:i,hasZ:r,spatialReference:n}=e;switch(t??=[],function(e){return"number"==typeof e[0]?.[0]}(t)&&(t=[t]),t[0]?.[0]?.length){case 4:r??=!0,i??=!0;break;case 3:r??=!0!==i,i??=!r;break;default:r??=!1,i??=!1}return n??=p.Z.WGS84,{...e,hasM:i,hasZ:r,rings:t,spatialReference:n}}(e)),this.curveRings=void 0,this.rings=[],this.type="polygon"}get cache(){return this.commitProperty("curveRings"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("rings"),this.commitProperty("spatialReference"),{}}get centroid(){const e=(0,f.tO)(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new d.Z;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}writeCurveRings(e,t){t.curveRings=(0,o.d9)(e)}get extent(){const e=(0,y._w)(this),{spatialReference:t}=this;return e?new u.Z({...e,spatialReference:t}):null}get isSelfIntersecting(){return(0,_.Ff)(this.rings)}writeRings(e,t){t.rings=(0,o.d9)(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(w(e)){const r=[];for(let t=0,i=e.length;t<i;t++)r[t]=e[t].toArray();t[i]=r}else t[i]=e.slice();return this.notifyChange("rings"),this}clone(){const e=new r;return e.spatialReference=this.spatialReference,e.rings=(0,o.d9)(this.rings),e.curveRings=(0,o.d9)(this.curveRings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(null==e)return!1;const t=this.spatialReference,i=e.spatialReference;if(null!=t!=(null!=i))return!1;if(null!=t&&null!=i&&!t.equals(i))return!1;if(this.rings.length!==e.rings.length)return!1;const r=([e,t,i,r],[n,s,o,a])=>e===n&&t===s&&(null==i&&null==o||i===o)&&(null==r&&null==a||r===a);for(let t=0;t<this.rings.length;t++){const i=this.rings[t],n=e.rings[t];if(!(0,s.fS)(i,n,r))return!1}return!0}contains(e){if(!e)return!1;const t=(0,v.iV)(e,this.spatialReference);return(0,m.CI)(this,null!=t?t:e)}isClockwise(e){const t=w(e)?e.map((e=>this.hasZ?this.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])):e;return(0,g.bu)(t)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,n=this.hasM;return r&&!n?new d.Z(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new d.Z(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new d.Z(i[0],i[1],i[2],i[3],this.spatialReference):new d.Z(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?((0,b.l)(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new d.Z(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map((e=>new d.Z(e,i)));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?((0,b.l)(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(null==e||e<0||e>=this.rings.length)return!1;if(null!=t){const r=this.rings[e];if(i&&(t<0||t>r.length))return!1;if(!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};(0,n._)([(0,a.Cb)({readOnly:!0})],x.prototype,"cache",null),(0,n._)([(0,a.Cb)({readOnly:!0})],x.prototype,"centroid",null),(0,n._)([(0,a.Cb)({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],x.prototype,"curveRings",void 0),(0,n._)([(0,c.c)("curveRings")],x.prototype,"writeCurveRings",null),(0,n._)([(0,a.Cb)({readOnly:!0})],x.prototype,"extent",null),(0,n._)([(0,a.Cb)({readOnly:!0})],x.prototype,"isSelfIntersecting",null),(0,n._)([(0,a.Cb)({type:[[[Number]]],json:{write:{isRequired:!0}}})],x.prototype,"rings",void 0),(0,n._)([(0,c.c)("rings")],x.prototype,"writeRings",null),x=r=(0,n._)([(0,l.j)("esri.geometry.Polygon")],x);const T=x;x.prototype.toJSON.isDefaultToJSON=!0},90819:(e,t,i)=>{i.d(t,{Z:()=>g});var r,n=i(36663),s=i(67134),o=i(81977),a=(i(39994),i(13802),i(40266)),l=i(39835),c=i(91772),u=i(20031),h=i(10186),d=i(14685),p=i(50842),f=i(36939);let m=r=class extends u.Z{constructor(e){super(function(e){if(!e)return;let{paths:t,hasM:i,hasZ:r,spatialReference:n}=e;switch(t??=[],function(e){return"number"==typeof e[0]?.[0]}(t)&&(t=[t]),t[0]?.[0]?.length){case 4:r??=!0,i??=!0;break;case 3:r??=!0!==i,i??=!r;break;default:r??=!1,i??=!1}return n??=d.Z.WGS84,{...e,hasM:i,hasZ:r,paths:t,spatialReference:n}}(e)),this.curvePaths=void 0,this.paths=[],this.type="polyline"}get cache(){return this.commitProperty("curvePaths"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("paths"),this.commitProperty("spatialReference"),{}}writeCurvePaths(e,t){t.curvePaths=(0,s.d9)(e)}get extent(){const e=(0,p.Wn)(this),{spatialReference:t}=this;return e?new c.Z({...e,spatialReference:t}):null}writePaths(e,t){t.paths=(0,s.d9)(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(function(e){return!Array.isArray(e[0])}(e)){const r=[];for(let t=0,i=e.length;t<i;t++)r[t]=e[t].toArray();t[i]=r}else t[i]=e.slice();return this.notifyChange("paths"),this}clone(){const e=new r;return e.spatialReference=this.spatialReference,e.paths=(0,s.d9)(this.paths),e.curvePaths=(0,s.d9)(this.curvePaths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,n=this.hasM;return r&&!n?new h.Z(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new h.Z(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new h.Z(i[0],i[1],i[2],i[3],this.spatialReference):new h.Z(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?((0,f.l)(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map((e=>new h.Z(e,i)));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new h.Z(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?((0,f.l)(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(null==e||e<0||e>=this.paths.length)return!1;if(null!=t){const r=this.paths[e];if(i&&(t<0||t>r.length))return!1;if(!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};(0,n._)([(0,o.Cb)({readOnly:!0})],m.prototype,"cache",null),(0,n._)([(0,o.Cb)({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],m.prototype,"curvePaths",void 0),(0,n._)([(0,l.c)("curvePaths")],m.prototype,"writeCurvePaths",null),(0,n._)([(0,o.Cb)({readOnly:!0})],m.prototype,"extent",null),(0,n._)([(0,o.Cb)({type:[[[Number]]],json:{write:{isRequired:!0}}})],m.prototype,"paths",void 0),(0,n._)([(0,l.c)("paths")],m.prototype,"writePaths",null),m=r=(0,n._)([(0,a.j)("esri.geometry.Polyline")],m);const g=m;m.prototype.toJSON.isDefaultToJSON=!0},14685:(e,t,i)=>{i.d(t,{Z:()=>m});var r,n=i(36663),s=i(74396),o=i(82064),a=i(67134),l=i(17321),c=i(7283),u=i(81977),h=i(40266),d=i(39835),p=i(35925);let f=r=class extends o.Z{static fromJSON(e){if(!e)return null;if(102100===e?.wkid)return r.WebMercator;if(4326===e?.wkid)return r.WGS84;const t=new r;return t.read(e),t}constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(e){if(e&&"object"==typeof e)return e;return{["string"==typeof e?"wkt":"wkid"]:e}}get isWGS84(){return(0,p.oR)(this)}get isWebMercator(){return(0,p.sS)(this)}get isGeographic(){return(0,p.sT)(this)}get isWrappable(){return(0,p.MP)(this)}get metersPerUnit(){return(0,l.c9)(this)}get unit(){return(0,l.qE)(this)||(this.isGeographic?"degrees":null)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===r.WGS84)return new r(p.YU);if(this===r.WebMercator)return new r(p.IU);const e=new r;return null!=this.wkid?(e.wkid=this.wkid,null!=this.latestWkid&&(e.latestWkid=this.latestWkid),null!=this.vcsWkid&&(e.vcsWkid=this.vcsWkid),null!=this.latestVcsWkid&&(e.latestVcsWkid=this.latestVcsWkid)):(null!=this.wkt&&(e.wkt=this.wkt),null!=this.wkt2&&(e.wkt2=this.wkt2)),this.imageCoordinateSystem&&(e.imageCoordinateSystem=(0,a.d9)(this.imageCoordinateSystem)),e}equals(e){if(null==e)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(null==this.imageCoordinateSystem||null==e.imageCoordinateSystem)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,n=this.imageCoordinateSystem;return null==t||r?JSON.stringify(n)===JSON.stringify(e.imageCoordinateSystem):i?n.id===t&&n.referenceServiceName===i:n.id===t}return(0,p.fS)(this,e)}toJSON(e){return this.write(void 0,e)}};f.GCS_NAD_1927=null,f.WGS84=null,f.WebMercator=null,f.PlateCarree=null,(0,n._)([(0,u.Cb)({readOnly:!0})],f.prototype,"isWGS84",null),(0,n._)([(0,u.Cb)({readOnly:!0})],f.prototype,"isWebMercator",null),(0,n._)([(0,u.Cb)({readOnly:!0})],f.prototype,"isGeographic",null),(0,n._)([(0,u.Cb)({readOnly:!0})],f.prototype,"isWrappable",null),(0,n._)([(0,u.Cb)({type:c.z8,json:{write:!0}})],f.prototype,"latestWkid",void 0),(0,n._)([(0,u.Cb)({readOnly:!0})],f.prototype,"metersPerUnit",null),(0,n._)([(0,u.Cb)({readOnly:!0})],f.prototype,"unit",null),(0,n._)([(0,u.Cb)({type:c.z8,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null==this.wkt}}}}}}})],f.prototype,"wkid",void 0),(0,n._)([(0,u.Cb)({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null==this.wkid}}}}}}})],f.prototype,"wkt",void 0),(0,n._)([(0,d.c)("wkt"),(0,d.c)("web-scene","wkt")],f.prototype,"writeWkt",null),(0,n._)([(0,u.Cb)({type:String,json:{write:!1}})],f.prototype,"wkt2",void 0),(0,n._)([(0,u.Cb)({type:c.z8,json:{write:!0}})],f.prototype,"vcsWkid",void 0),(0,n._)([(0,u.Cb)({type:c.z8,json:{write:!0}})],f.prototype,"latestVcsWkid",void 0),(0,n._)([(0,u.Cb)()],f.prototype,"imageCoordinateSystem",void 0),f=r=(0,n._)([(0,h.j)("esri.geometry.SpatialReference")],f),f.prototype.toJSON.isDefaultToJSON=!0,f.GCS_NAD_1927=s.Z.freeze(new f({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'})),f.WGS84=s.Z.freeze(new f(p.YU)),f.WebMercator=s.Z.freeze(new f(p.IU)),f.PlateCarree=s.Z.freeze(new f(p.xO));const m=f},93138:(e,t,i)=>{i.d(t,{M:()=>n,j:()=>s});var r=i(70375);function n(e){if(e&&"object"==typeof e&&"type"in e&&"mesh"===e.type)throw new r.Z("Mesh geometries are not supported for this operation")}function s(e){e.forEach(n)}},69442:(e,t,i)=>{i.d(t,{Iu:()=>d,JL:()=>a,e8:()=>p,fY:()=>f,kU:()=>o,mM:()=>l,oe:()=>m,pn:()=>c});var r=i(14260),n=i(35925);function s(e){return{wkt:`GEOCCS["Spherical geocentric",\n    DATUM["Not specified",\n      SPHEROID["Sphere",${e.radius},0]],\n    PRIMEM["Greenwich",0.0,\n      AUTHORITY["EPSG","8901"]],\n    UNIT["m",1.0],\n    AXIS["Geocentric X",OTHER],\n    AXIS["Geocentric Y",EAST],\n    AXIS["Geocentric Z",NORTH]\n  ]`}}const o=s(r.sv),a=s(r.yr),l=s(r.Z1),c={wkt:`GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",${r.sv.radius},298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]`},u=a.wkt.toUpperCase(),h=l.wkt.toUpperCase();function d(e){if(null!=e&&(0,n.JY)(e)){const t=e.wkid,i=e.wkt2??e.wkt;if((0,n.o$)(t))return r.yr;const s=i?.toUpperCase();if(i&&s===u)return r.yr;if((0,n.ME)(t)||s&&s===h)return r.Z1}return r.sv}function p(e){return(0,n.o$)(e)?r.yr:(0,n.ME)(e)?r.Z1:r.sv}function f(e){return(0,n.fS)(e,o)}function m(e){return f(e)||(0,n.fS)(e,a)||(0,n.fS)(e,l)}},47349:(e,t,i)=>{function r(e){const t=[];for(e.reset();e.nextPath();){const i=[];for(;e.nextPoint();)i.push([e.x,e.y]);t.push(i)}return e.reset(),t}function n(e){const t=[];for(;e.nextPoint();)t.push([e.x,e.y]);return e.seekPathStart(),t}i.d(t,{M:()=>r,l:()=>n})},90472:(e,t,i)=>{i.r(t),i.d(t,{canProjectWithoutEngine:()=>j,getTransformation:()=>U,getTransformations:()=>k,initializeProjection:()=>q,isEqualBaseGCS:()=>Z,isLoaded:()=>A,isLoadedOrLoad:()=>R,isLoadedOrLoadFor:()=>O,load:()=>I,project:()=>L,projectExtent:()=>ie,projectMany:()=>D,projectMultipoint:()=>J,projectOrLoad:()=>N,projectOrLoadMany:()=>F,projectPoint:()=>$,projectPolygon:()=>ee,projectPolyline:()=>K,projectWithZConversion:()=>G,projectWithoutEngine:()=>W,requiresLoad:()=>P,test:()=>V,tryProjectWithZConversion:()=>H,unload:()=>B});var r=i(70375),n=i(78668),s=i(55860),o=i(26096),a=i(81095),l=i(93138),c=i(69442),u=i(91772),h=i(74304),d=i(96926),p=i(10186),f=i(89542),m=i(90819),g=i(14685),y=i(22349),_=i(12487),v=i(23916),b=i(44924),w=i(35925),x=i(95247);let T=null,C=null,S=null,E={};const M=new o.s;function A(){return!!T&&(0,d.i)()}function R(){return!!A()||((0,s.it)(M),I(),!1)}function O(e,t){return!e||!t||j(e,t)||R()}function P(e,t){return!j(e,t)&&!A()}function I(e){return null==S&&(S=Promise.all([(0,d.l)(),Promise.all([i.e(89067),i.e(58340)]).then(i.bind(i,89067)).then((e=>e.g)),i.e(48427).then(i.bind(i,48427))])),S.then((([,t,{hydratedAdapter:i}])=>{(0,n.k_)(e),C=i,T=t.default,T._enableProjection(d.p),M.notify()}))}function L(e,t,i=null,r=null){return Array.isArray(e)?0===e.length?[]:((0,l.j)(e),D(C,e,e[0].spatialReference,t,i,r)):((0,l.M)(e),D(C,[e],e.spatialReference,t,i,r)[0])}function D(e,t,i,r,n=null,s=null){if(null==i||null==r)return t;if(j(i,r,n))return t.map((e=>W(e,i,r)));if(null==n&&(0,c.fY)(i))return t.map((e=>W(e,i,g.Z.WGS84))).map((e=>H(e,r)));if(null==n&&(0,c.fY)(r))return t.map((e=>H(e,g.Z.WGS84))).map((e=>W(e,g.Z.WGS84,r)));if(null==n){const e=b.Z.cacheKey(i,r);void 0!==E[e]?n=E[e]:(null==(n=U(i,r,void 0))&&(n=new b.Z),E[e]=n)}if(null==T||null==e)throw new z;return null!=s?T._project(e,t,i,r,n,s):T._project(e,t,i,r,n)}function N(e,t){const i=F([e],t);return null!=i.pending?{pending:i.pending,geometry:null}:null!=i.geometries?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function F(e,t){if(!A())for(const i of e)if(null!=i&&!(0,w.fS)(i.spatialReference,t)&&(0,w.JY)(i.spatialReference)&&(0,w.JY)(t)&&!j(i.spatialReference,t))return(0,s.it)(M),{pending:I(),geometries:null};return{pending:null,geometries:e.map((e=>null==e?null:(0,w.fS)(e.spatialReference,t)?e:(0,w.JY)(e.spatialReference)&&(0,w.JY)(t)?H(e,t):null))}}function U(e,t,i=null){if(null==e||null==t)return null;if(null==T||null==C)throw new z;const r=T._getTransformation(C,e,t,i,i?.spatialReference);return null!==r?b.Z.fromGE(r):null}function k(e,t,i=null){if(null==T||null==C)throw new z;const r=T._getTransformationBySuitability(C,e,t,i,i?.spatialReference);if(null!==r){const e=[];for(const t of r)e.push(b.Z.fromGE(t));return e}return[]}class z extends r.Z{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function B(){T=null,C=null,S=null,E={}}const V={get loadPromise(){return S}};function H(e,t){try{const i=L(e,t);if(null==i)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=(0,x.k)(i.type,e.spatialReference,t);return null!=r&&r(i),i}catch(e){if(!(e instanceof z))throw e;return null}}async function G(e,t,i){const r=e.spatialReference;return null!=r&&null!=t&&await q(r,t,null,i),H(e,t)}function j(e,t,i){return!i&&(!!(0,w.fS)(e,t)||(0,w.JY)(e)&&(0,w.JY)(t)&&!!(0,_.R8)(e,t))}function Z(e,t){if((0,w.fS)(e,t))return!0;if(!(0,w.JY)(e)||!(0,w.JY)(t))return!1;const i=(0,w.oR)(e)||(0,w.sS)(e)||(0,w.yW)(e),r=(0,w.oR)(t)||(0,w.sS)(t)||(0,w.yW)(t);return i&&r}async function q(e,t,i,r){if(A())return(0,n.Yn)(r);if(Array.isArray(e)){for(const{source:t,dest:i,geographicTransformation:n}of e)if(t&&i&&!j(t,i,n))return I(r)}else if(e&&t&&!j(e,t,i))return I(r);return(0,n.Yn)(r)}function W(e,t,i){return e?"x"in e?Y(e,t,new p.Z,i,0):"xmin"in e?re(e,t,new u.Z,i,0):"rings"in e?te(e,t,new f.Z,i,0):"paths"in e?Q(e,t,new m.Z,i,0):"points"in e?X(e,t,new h.Z,i,0):null:null}function $(e,t,i=t.spatialReference,r=0){return null!=i&&null!=e.spatialReference&&null!=Y(e,e.spatialReference,t,i,r)}function Y(e,t,i,r,n){se[0]=e.x,se[1]=e.y;const s=e.z;return se[2]=void 0!==s?s:n,(0,y.projectBuffer)(se,t,0,se,r,0)?(i.x=se[0],i.y=se[1],i.spatialReference=r,void 0!==s||(0,c.oe)(r)?(i.z=se[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),void 0===e.m?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function J(e,t,i=t.spatialReference,r=0){return null!=e.spatialReference&&null!=i&&null!=X(e,e.spatialReference,t,i,r)}function X(e,t,i,r,n){const{points:s,hasZ:o,hasM:a}=e,l=[],u=s.length,h=[];for(const e of s)h.push(e[0],e[1],o?e[2]:n);if(!(0,y.projectBuffer)(h,t,0,h,r,0,u))return null;const d=o||(0,c.oe)(r);for(let e=0;e<u;++e){const t=3*e,i=h[t],r=h[t+1];d&&a?l.push([i,r,h[t+2],s[e][3]]):d?l.push([i,r,h[t+2]]):a?l.push([i,r,s[e][2]]):l.push([i,r])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function K(e,t,i=t.spatialReference,r=0){return null!=e.spatialReference&&null!=i&&null!=Q(e,e.spatialReference,t,i,r)}function Q(e,t,i,r,n){const{paths:s,hasZ:o,hasM:a}=e,l=[];if(!ne(s,o??!1,a??!1,t,l,r,n))return null;const u=o||(0,c.oe)(r);return i.paths=l,i.spatialReference=r,i.hasZ=u,i.hasM=a,i}function ee(e,t,i=t.spatialReference,r=0){return null!=e.spatialReference&&null!=i&&null!=te(e,e.spatialReference,t,i,r)}function te(e,t,i,r,n){const{rings:s,hasZ:o,hasM:a}=e,l=[];if(!ne(s,o??!1,a??!1,t,l,r,n))return null;const u=o||(0,c.oe)(r);return i.rings=l,i.spatialReference=r,i.hasZ=u,i.hasM=a,i}function ie(e,t,i=t.spatialReference,r=0){return null!=e.spatialReference&&null!=i&&null!=re(e,e.spatialReference,t,i,r)}function re(e,t,i,r,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:u,hasM:h}=e,d=u?e.zmin:n;if(!(0,v.R)(s,o,d,t,se,r))return null;const p=u||(0,c.oe)(r);i.xmin=se[0],i.ymin=se[1],p&&(i.zmin=se[2]);const f=u?e.zmax:n;return(0,v.R)(a,l,f,t,se,r)?(i.xmax=se[0],i.ymax=se[1],p&&(i.zmax=se[2]),h&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null}function ne(e,t,i,r,n,s,o=0){const a=new Array;for(const i of e)for(const e of i)a.push(e[0],e[1],t?e[2]:o);if(!(0,y.projectBuffer)(a,r,0,a,s,0))return!1;let l=0;n.length=0;const u=t||(0,c.oe)(s);for(const t of e){const e=new Array;for(const r of t)u&&i?e.push([a[l++],a[l++],a[l++],r[3]]):u?e.push([a[l++],a[l++],a[l++]]):i?(e.push([a[l++],a[l++],r[2]]),l++):(e.push([a[l++],a[l++]]),l++);n.push(e)}return!0}const se=(0,a.Ue)()},7845:(e,t,i)=>{i.d(t,{B:()=>c});var r=i(19431),n=i(32114),s=i(81095),o=i(89392),a=i(12487),l=i(35925);function c(e,t,i,r){const s=(0,a.E2)(e,r);if(null==s)return!1;const c=s.source.spatialReferenceId,f=s.dest.spatialReferenceId;if(c===f&&!u(f)&&(c!==a.Ej.UNKNOWN||(0,l.fS)(e,r)))return(0,n.vc)(i,t),!0;if(u(f)){const e=a.rf[c][a.Ej.LON_LAT],r=a.rf[a.Ej.LON_LAT][f];return null!=e&&null!=r&&(e(t,0,d,0),r(d,0,p,0),(0,o.q)(h*d[0],h*d[1],i),i[12]=p[0],i[13]=p[1],i[14]=p[2],!0)}const m=u(c);if((f===a.Ej.WEB_MERCATOR||f===a.Ej.PLATE_CARREE||f===a.Ej.WGS84||f===a.Ej.CGCS2000)&&(c===a.Ej.WGS84||m||c===a.Ej.WEB_MERCATOR||c===a.Ej.CGCS2000)){const e=a.rf[c][a.Ej.LON_LAT],r=a.rf[a.Ej.LON_LAT][f];return null!=e&&null!=r&&(e(t,0,d,0),r(d,0,p,0),m?(0,o.B)(h*d[0],h*d[1],i):(0,n.yR)(i),i[12]=p[0],i[13]=p[1],i[14]=p[2],!0)}return!1}function u(e){return e===a.Ej.SPHERICAL_ECEF||e===a.Ej.SPHERICAL_MARS_PCPF||e===a.Ej.SPHERICAL_MOON_PCPF||e===a.Ej.WGS84_ECEF}const h=(0,r.Vl)(1),d=(0,s.Ue)(),p=(0,s.Ue)()},89392:(e,t,i)=>{i.d(t,{B:()=>s,q:()=>n});var r=i(32114);function n(e,t,i){const r=Math.sin(e),n=Math.cos(e),s=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function s(e,t,i){return n(e,t,i),(0,r.p4)(i,i),i}},72884:(e,t,i)=>{i.d(t,{d:()=>a});var r=i(81095),n=i(22349),s=i(24568),o=i(35925);function a(e,t,i,r){return!(null==e||((0,o.fS)(t,r)?((0,s.JG)(i,e),0):(l[0]=e[0],l[1]=e[1],l[2]=0,!(0,n.projectBuffer)(l,t,0,l,r,0)||(i[0]=l[0],i[1]=l[1],l[0]=e[2],l[1]=e[3],l[2]=0,!(0,n.projectBuffer)(l,t,0,l,r,0)||(i[2]=l[0],i[3]=l[1],0)))))}const l=(0,r.Ue)()},22349:(e,t,i)=>{i.r(t),i.d(t,{projectBuffer:()=>n});var r=i(12487);function n(e,t,i,n,s,o,a=Math.floor(e.length/3)){const l=(0,r.R8)(t,s);if(null==l)return!1;if(l===r.iq){if(e===n&&i===o)return!0;const t=i+3*a;for(let r=i,s=o;r<t;r++,s++)n[s]=e[r];return!0}const c=i+3*a;for(let t=i,r=o;t<c;t+=3,r+=3)l(e,t,n,r);return!0}},57022:(e,t,i)=>{i.d(t,{K:()=>o,U:()=>a});var r=i(81095),n=i(90472),s=i(22349);function o(e,t,i,r){if((0,n.canProjectWithoutEngine)(e.spatialReference,i)){l[0]=e.x,l[1]=e.y;const n=e.z;return l[2]=n??r??0,(0,s.projectBuffer)(l,e.spatialReference,0,t,i,0)}const o=(0,n.tryProjectWithZConversion)(e,i);return!!o&&(t[0]=o?.x,t[1]=o?.y,t[2]=o?.z??r??0,!0)}async function a(e,t,i,r,s){return await(0,n.initializeProjection)(e.spatialReference,i,null,s),o(e,t,i,r)}const l=(0,r.Ue)()},10369:(e,t,i)=>{i.d(t,{A:()=>a,f:()=>o});var r=i(81095),n=i(90472),s=i(49757);function o(e,t,i){return!!(0,s.S)(e,t,l,i.spatialReference)&&(i.x=l[0],i.y=l[1],i.z=l[2],!0)}async function a(e,t,i,r){return await(0,n.initializeProjection)(t,i.spatialReference,null,r),o(e,t,i)}const l=(0,r.Ue)()},49757:(e,t,i)=>{i.d(t,{S:()=>s});i(90472);var r=i(14685),n=i(57022);function s(e,t,i,r,s){return!(null==t||null==r||e.length<2)&&(o.x=e[0],o.y=e[1],o.z=e[2],o.spatialReference=t,(0,n.K)(o,i,r,s))}const o=(0,i(98196).T)(0,0,0,r.Z.WGS84)},23916:(e,t,i)=>{i.d(t,{R:()=>s});var r=i(81095),n=i(22349);function s(e,t,i,r,s,a){return o[0]=e,o[1]=t,o[2]=i,(0,n.projectBuffer)(o,r,0,s,a,0)}const o=(0,r.Ue)()},12487:(e,t,i)=>{i.d(t,{E2:()=>p,Ej:()=>r,Ms:()=>Z,PR:()=>R,R8:()=>d,YD:()=>f,gH:()=>b,iq:()=>g,rf:()=>h,uT:()=>w});var r,n=i(19431),s=i(17321),o=i(69442),a=i(14260),l=i(36285),c=i(35925),u=i(52345);!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=7]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=9]="GCSMOON2000",e[e.LON_LAT=10]="LON_LAT",e[e.PLATE_CARREE=11]="PLATE_CARREE"}(r||(r={}));const h={[r.WGS84]:{[r.CGCS2000]:g,[r.GCSMARS2000]:null,[r.GCSMOON2000]:null,[r.LON_LAT]:g,[r.SPHERICAL_ECEF]:A,[r.SPHERICAL_MARS_PCPF]:null,[r.SPHERICAL_MOON_PCPF]:null,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:w,[r.PLATE_CARREE]:x,[r.WGS84]:g,[r.WGS84_ECEF]:N},[r.CGCS2000]:{[r.CGCS2000]:g,[r.GCSMARS2000]:null,[r.GCSMOON2000]:null,[r.LON_LAT]:g,[r.SPHERICAL_ECEF]:A,[r.SPHERICAL_MARS_PCPF]:null,[r.SPHERICAL_MOON_PCPF]:null,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:w,[r.PLATE_CARREE]:x,[r.WGS84]:g,[r.WGS84_ECEF]:N},[r.GCSMARS2000]:{[r.CGCS2000]:null,[r.GCSMARS2000]:g,[r.GCSMOON2000]:null,[r.LON_LAT]:g,[r.SPHERICAL_ECEF]:null,[r.SPHERICAL_MARS_PCPF]:M,[r.SPHERICAL_MOON_PCPF]:null,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:null,[r.PLATE_CARREE]:null,[r.WGS84]:null,[r.WGS84_ECEF]:null},[r.GCSMOON2000]:{[r.CGCS2000]:null,[r.GCSMARS2000]:null,[r.GCSMOON2000]:g,[r.LON_LAT]:g,[r.SPHERICAL_ECEF]:null,[r.SPHERICAL_MARS_PCPF]:null,[r.SPHERICAL_MOON_PCPF]:E,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:null,[r.PLATE_CARREE]:null,[r.WGS84]:null,[r.WGS84_ECEF]:null},[r.WEB_MERCATOR]:{[r.CGCS2000]:y,[r.GCSMARS2000]:null,[r.GCSMOON2000]:null,[r.LON_LAT]:y,[r.SPHERICAL_ECEF]:_,[r.SPHERICAL_MARS_PCPF]:null,[r.SPHERICAL_MOON_PCPF]:null,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:g,[r.PLATE_CARREE]:C,[r.WGS84]:y,[r.WGS84_ECEF]:v},[r.WGS84_ECEF]:{[r.CGCS2000]:F,[r.GCSMARS2000]:null,[r.GCSMOON2000]:null,[r.LON_LAT]:F,[r.SPHERICAL_ECEF]:U,[r.SPHERICAL_MARS_PCPF]:null,[r.SPHERICAL_MOON_PCPF]:null,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:k,[r.PLATE_CARREE]:function(e,t,i,r){F(e,t,i,r),x(i,r,i,r)},[r.WGS84]:F,[r.WGS84_ECEF]:g},[r.SPHERICAL_ECEF]:{[r.CGCS2000]:I,[r.GCSMARS2000]:null,[r.GCSMOON2000]:null,[r.LON_LAT]:I,[r.SPHERICAL_ECEF]:g,[r.SPHERICAL_MARS_PCPF]:null,[r.SPHERICAL_MOON_PCPF]:null,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:L,[r.PLATE_CARREE]:function(e,t,i,r){I(e,t,i,r),x(i,r,i,r)},[r.WGS84]:I,[r.WGS84_ECEF]:D},[r.SPHERICAL_MARS_PCPF]:{[r.CGCS2000]:null,[r.GCSMARS2000]:P,[r.GCSMOON2000]:null,[r.LON_LAT]:P,[r.SPHERICAL_ECEF]:null,[r.SPHERICAL_MARS_PCPF]:g,[r.SPHERICAL_MOON_PCPF]:null,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:null,[r.PLATE_CARREE]:null,[r.WGS84]:null,[r.WGS84_ECEF]:null},[r.SPHERICAL_MOON_PCPF]:{[r.CGCS2000]:null,[r.GCSMARS2000]:null,[r.GCSMOON2000]:O,[r.LON_LAT]:O,[r.SPHERICAL_ECEF]:null,[r.SPHERICAL_MARS_PCPF]:null,[r.SPHERICAL_MOON_PCPF]:g,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:null,[r.PLATE_CARREE]:null,[r.WGS84]:null,[r.WGS84_ECEF]:null},[r.UNKNOWN]:{[r.CGCS2000]:null,[r.GCSMARS2000]:null,[r.GCSMOON2000]:null,[r.LON_LAT]:null,[r.SPHERICAL_ECEF]:null,[r.SPHERICAL_MARS_PCPF]:null,[r.SPHERICAL_MOON_PCPF]:null,[r.UNKNOWN]:g,[r.WEB_MERCATOR]:null,[r.PLATE_CARREE]:null,[r.WGS84]:null,[r.WGS84_ECEF]:null},[r.LON_LAT]:{[r.CGCS2000]:g,[r.GCSMARS2000]:g,[r.GCSMOON2000]:g,[r.LON_LAT]:g,[r.SPHERICAL_ECEF]:A,[r.SPHERICAL_MARS_PCPF]:M,[r.SPHERICAL_MOON_PCPF]:E,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:w,[r.PLATE_CARREE]:x,[r.WGS84]:g,[r.WGS84_ECEF]:N},[r.PLATE_CARREE]:{[r.CGCS2000]:T,[r.GCSMARS2000]:null,[r.GCSMOON2000]:null,[r.LON_LAT]:T,[r.SPHERICAL_ECEF]:function(e,t,i,r){T(e,t,i,r),A(i,r,i,r)},[r.SPHERICAL_MARS_PCPF]:null,[r.SPHERICAL_MOON_PCPF]:null,[r.UNKNOWN]:null,[r.WEB_MERCATOR]:function(e,t,i,r){T(e,t,i,r),w(i,r,i,r)},[r.PLATE_CARREE]:g,[r.WGS84]:T,[r.WGS84_ECEF]:function(e,t,i,r){T(e,t,i,r),N(i,r,i,r)}}};function d(e,t){return p(e,t)?.projector}function p(e,t){if(null==e||null==t)return null;if(z.source.spatialReference===e&&z.dest.spatialReference===t)return z;const i=m(e,z.source),n=m(t,z.dest);return i===r.UNKNOWN&&n===r.UNKNOWN?(0,c.fS)(e,t)?z.projector=g:z.projector=null:z.projector=h[i][n],z}function f(e,t){switch(d(e,t)){case g:return"copy3";case A:return"wgs84ToSphericalECEF";case w:return"wgs84ToWebMercator";case x:return"wgs84ToPlateCarree";case N:return"wgs84ToWGS84ECEF";case y:return"webMercatorToWGS84";case _:return"webMercatorToSphericalECEF";case v:return"webMercatorToWGS84ECEF";case C:return"webMercatorToPlateCarree";case F:return"wgs84ECEFToWGS84";case U:return"wgs84ECEFToSphericalECEF";case k:return"wgs84ECEFToWebMercator";case I:return"sphericalECEFToWGS84";case L:return"sphericalECEFToWebMercator";case P:return"sphericalMarsPCPFToMars2000";case O:return"sphericalMoonPCPFToMoon2000";case D:return"sphericalECEFToWGS84ECEF";case M:return"mars2000ToSphericalPCPF";case E:return"moon2000ToSphericalPCPF";default:return null}}function m(e,t){return e?t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=(0,s.c9)(e,1)),(0,o.fY)(e)?t.spatialReferenceId=r.SPHERICAL_ECEF:(0,c.oR)(e)?t.spatialReferenceId=r.WGS84:(0,c.sS)(e)?t.spatialReferenceId=r.WEB_MERCATOR:(0,c.QM)(e)?t.spatialReferenceId=r.PLATE_CARREE:e.wkt===o.pn.wkt?t.spatialReferenceId=r.WGS84_ECEF:e.wkid===u.W.CGCS2000?t.spatialReferenceId=r.CGCS2000:e.wkt===o.JL.wkt?t.spatialReferenceId=r.SPHERICAL_MARS_PCPF:e.wkt===o.mM.wkt?t.spatialReferenceId=r.SPHERICAL_MOON_PCPF:(0,c.BZ)(e)?t.spatialReferenceId=r.GCSMARS2000:(0,c.V2)(e)?t.spatialReferenceId=r.GCSMOON2000:t.spatialReferenceId=r.UNKNOWN):r.UNKNOWN}function g(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function y(e,t,i,r){i[r]=V*(e[t]/G),i[r+1]=V*(H-2*Math.atan(Math.exp(-e[t+1]/G))),i[r+2]=e[t+2]}function _(e,t,i,r){const n=e[t]/G,s=H-2*Math.atan(Math.exp(-e[t+1]/G)),o=G+e[t+2],a=Math.cos(s)*o;i[r]=Math.cos(n)*a,i[r+1]=Math.sin(n)*a,i[r+2]=Math.sin(s)*o}function v(e,t,i,r){y(e,t,i,r),N(i,r,i,r)}function b(e,t,i,r,s){const o=.4999999*Math.PI,a=(0,n.uZ)(B*e[t+1],-o,o),l=Math.sin(a);i[r++]=B*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+l)/(1-l)),i[r]=e[t+2]}function w(e,t,i,r){b(e,t,i,r,a.sv)}function x(e,t,i,r){i[r]=e[t]*j,i[r+1]=e[t+1]*j,i[r+2]=e[t+2]}function T(e,t,i,r){i[r]=e[t]*Z,i[r+1]=e[t+1]*Z,i[r+2]=e[t+2]}function C(e,t,i,r){y(e,t,i,r),x(i,r,i,r)}function S(e,t,i,r,n){const s=n+e[t+2],o=B*e[t+1],a=B*e[t],l=Math.cos(o)*s;i[r]=Math.cos(a)*l,i[r+1]=Math.sin(a)*l,i[r+2]=Math.sin(o)*s}function E(e,t,i,r){S(e,t,i,r,a.Z1.radius)}function M(e,t,i,r){S(e,t,i,r,a.yr.radius)}function A(e,t,i,r){S(e,t,i,r,a.sv.radius)}function R(e,t,i,r,s){const o=e[t],a=e[t+1],l=e[t+2],c=Math.sqrt(o*o+a*a+l*l),u=(0,n.Kt)(l/(0===c?1:c)),h=Math.atan2(a,o);i[r++]=V*h,i[r++]=V*u,i[r]=c-s}function O(e,t,i,r){R(e,t,i,r,a.Z1.radius)}function P(e,t,i,r){R(e,t,i,r,a.yr.radius)}function I(e,t,i,r){R(e,t,i,r,a.sv.radius)}function L(e,t,i,r){I(e,t,i,r),w(i,r,i,r)}function D(e,t,i,r){I(e,t,i,r),N(i,r,i,r)}function N(e,t,i,r){!function(e,t,i,r,n){const s=B*e[t],o=B*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);i[r++]=(u+a)*c*Math.cos(s),i[r++]=(u+a)*c*Math.sin(s),i[r++]=(u*(1-n.eccentricitySquared)+a)*l}(e,t,i,r,a.sv)}function F(e,t,i,r){const n=l.cD,s=e[t],o=e[t+1],c=e[t+2];let u,h,d,p,f,m,g,y,_,v,b,w,x,T,C,S,E,M,A,R,O;u=Math.abs(c),h=s*s+o*o,d=Math.sqrt(h),p=h+c*c,f=Math.sqrt(p),R=Math.atan2(o,s),m=c*c/p,g=h/p,T=n.a2/f,C=n.a3-n.a4/f,g>.3?(y=u/f*(1+g*(n.a1+T+m*C)/f),A=Math.asin(y),v=y*y,_=Math.sqrt(1-v)):(_=d/f*(1-m*(n.a5-T-g*C)/f),A=Math.acos(_),v=1-_*_,y=Math.sqrt(v)),b=1-a.sv.eccentricitySquared*v,w=a.sv.radius/Math.sqrt(b),x=n.a6*w,T=d-w*_,C=u-x*y,E=_*T+y*C,S=_*C-y*T,M=S/(x/b+E),A+=M,O=E+S*M/2,c<0&&(A=-A),i[r++]=V*R,i[r++]=V*A,i[r]=O}function U(e,t,i,r){F(e,t,i,r),A(i,r,i,r)}function k(e,t,i,r){F(e,t,i,r),w(i,r,i,r)}const z={source:{spatialReference:null,spatialReferenceId:r.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:r.UNKNOWN,metersPerUnit:1},projector:g},B=(0,n.Vl)(1),V=(0,n.BV)(1),H=.5*Math.PI,G=a.sv.radius,j=G*Math.PI/180,Z=180/(G*Math.PI)},61170:(e,t,i)=>{i.d(t,{HQ:()=>a,VY:()=>l,rS:()=>u,wY:()=>c});var r=i(69442),n=i(14685),s=i(35925);const o=new n.Z(r.kU),a=new n.Z(r.JL),l=new n.Z(r.mM),c=new n.Z(r.pn);function u(e){const t=h.get(e);if(t)return t;let i=o;if(e)if(e===a)i=a;else if(e===l)i=l;else{const t=e.wkid,r=e.latestWkid;if(null!=t||null!=r)(0,s.o$)(t)||(0,s.o$)(r)?i=a:((0,s.ME)(t)||(0,s.ME)(r))&&(i=l);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===d?i=a:e===p&&(i=l)}}}return h.set(e,i),i}const h=new Map,d=a.wkt.toUpperCase(),p=l.wkt.toUpperCase()},19546:(e,t,i)=>{var r;i.d(t,{R:()=>r}),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(r||(r={}))},92570:(e,t,i)=>{i.d(t,{QZ:()=>s,Rq:()=>o,bg:()=>n});var r=i(86098);function n(e,t=!1){return e<=r.c8?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function s(e){return((0,r.fU)(e)?e.byteLength/8:e.length)<=r.c8?Array.from(e):new Float64Array(e)}function o(e,t,i){return Array.isArray(e)?e.slice(t,t+i):e.subarray(t,t+i)}},14260:(e,t,i)=>{i.d(t,{Z1:()=>o,sv:()=>n,yr:()=>s});class r{constructor(e,t,i,r,n,s){this.semiMajorAxis=e,this.flattening=t,this.outerAtmosphereRimWidth=i,this.atmosphereHeight=r,this.scaleHeight=n;const o=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*o,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const n=new r(6378137,1/298.257223563,3e5,1e5,.085,.006694379990137799),s=new r(3396190,1/169.8944472236118,23e4,6e4,.111),o=new r(1737400,0,0,0,0)},31725:(e,t,i)=>{i.d(t,{AA:()=>a,XO:()=>o,YI:()=>s,xx:()=>n});var r=i(86098);function n(e,t=!1){return e<=r.c8?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function s(e){return Array.isArray(e)?e.length<r.c8?e:new Float32Array(e):e.length<r.c8?Array.from(e):e}function o(e){return(Array.isArray(e)?e.length:e.byteLength/8)<=r.c8?Array.from(e):new Float32Array(e)}function a(e,t,i){return Array.isArray(e)?e.slice(t,t+i):e.subarray(t,t+i)}},44924:(e,t,i)=>{i.d(t,{Z:()=>s});let r=0;class n{static fromGE(e){const t=new n;return t._wkt=e.wkt,t._wkid=e.wkid,t._isInverse=e.isInverse,t}constructor(e){this.uid=r++,e?(this._wkt=null!=e.wkt?e.wkt:null,this._wkid=null!=e.wkid?e.wkid:-1,this._isInverse=null!=e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=r++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=r++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=r++}getInverse(){const e=new n;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}}class s{static cacheKey(e,t){return[e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??"",t.wkid?.toString()??"-1",t.wkt?.toString()??"",t.wkt2?.toString()??""].join()}static fromGE(e){const t=new s;let i="";for(const r of e.steps){const e=n.fromGE(r);t.steps.push(e),i+=e.uid.toString()+","}return t._cachedProjection={},t._gtlistentry=null,t._chain=i,t}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e?.steps)for(const t of e.steps)t instanceof n?this.steps.push(t):this.steps.push(new n({wkid:t.wkid,wkt:t.wkt,isInverse:t.isInverse}))}getInverse(){const e=new s;e.steps=[];for(let t=this.steps.length-1;t>=0;t--){const i=this.steps[t];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const t of this.steps)e+=t.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,t,i){this._cachedProjection[s.cacheKey(e,t)]=i}getCachedGeTransformation(e,t){let i="";for(const e of this.steps)i+=e.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const r=this._cachedProjection[s.cacheKey(e,t)];return void 0===r?null:r}}},35914:(e,t,i)=>{i.d(t,{$z:()=>s,KF:()=>u,LE:()=>p,WV:()=>f,X9:()=>o,mi:()=>n});var r=i(86098);function n(e){if(Array.isArray(e)){if(e.length<r.c8)return e}else if(e.length<r.c8)return Array.from(e);let t=!0,i=!0;return e.some(((e,r)=>(t=t&&0===e,i=i&&e===r,!t&&!i))),t?p(e.length):i?u(e.length):(0,r.fU)(e)&&e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?e:function(e){let t=!0;for(const i of e){if(i>=65536)return(0,r.fU)(e)?e:new Uint32Array(e);i>=256&&(t=!1)}return t?new Uint8Array(e):new Uint16Array(e)}(e)}function s(e){return e<=r.c8?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}function o(e){return e<=r.c8?new Array(e):new Uint32Array(e)}let a=h(131072);const l=[0],c=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function u(e){return 1===e?l:e<r.c8?Array.from(new Uint16Array(c.buffer,0,e)):e<c.length?new Uint16Array(c.buffer,0,e):(e>a.length&&(a=h(Math.max(2*a.length,e))),new Uint32Array(a.buffer,0,e))}function h(e){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}let d=new Uint8Array(65536);function p(e){if(1===e)return l;if(e<r.c8)return new Array(e).fill(0);if(e>d.length){const t=Math.max(2*d.length,e);d=new Uint8Array(t)}return new Uint8Array(d.buffer,0,e)}function f(){a=h(131072),d=new Uint8Array(65536)}},58626:(e,t,i)=>{i.d(t,{Z:()=>h});var r,n=i(36663),s=i(41151),o=i(82064),a=i(81977),l=(i(39994),i(13802),i(4157),i(79438)),c=i(40266);let u=r=class extends(s.Z.ClonableMixin(o.Z)){constructor(e){super(e),this.type="georeferenced",this.origin=null}};u.absolute=new r,(0,n._)([(0,l.J)({georeferenced:"georeferenced"},{readOnly:!0})],u.prototype,"type",void 0),(0,n._)([(0,a.Cb)({type:[Number],nonNullable:!1,json:{write:!0}})],u.prototype,"origin",void 0),u=r=(0,n._)([(0,c.j)("esri.geometry.support.MeshGeoreferencedVertexSpace")],u);const h=u},51619:(e,t,i)=>{i.d(t,{Z:()=>h});var r=i(36663),n=i(41151),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(79438)),l=i(40266),c=i(81095);let u=class extends(n.Z.ClonableMixin(s.Z)){constructor(e){super(e),this.type="local",this.origin=(0,c.Ue)()}};(0,r._)([(0,a.J)({local:"local"},{readOnly:!0})],u.prototype,"type",void 0),(0,r._)([(0,o.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"origin",void 0),u=(0,r._)([(0,l.j)("esri.geometry.support.MeshLocalVertexSpace")],u);const h=u},68403:(e,t,i)=>{i.d(t,{Z:()=>g});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266)),l=i(32114),c=i(3308),u=i(1845),h=i(96303),d=i(81095),p=i(34218);let f=r=class extends s.Z{constructor(e){super(e),this.translation=(0,d.Ue)(),this.rotationAxis=(0,d.nI)(p.up),this.rotationAngle=0,this.scale=(0,d.al)(1,1,1)}get rotation(){return(0,p.uT)(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=(0,d.d9)((0,p.ZZ)(e)),this.rotationAngle=(0,p.EU)(e)}get localMatrix(){const e=(0,c.Ue)();return(0,u.yY)(m,(0,p.ZZ)(this.rotation),(0,p.WH)(this.rotation)),(0,l.Iw)(e,m,this.translation,this.scale),e}get localMatrixInverse(){return(0,l.U_)((0,c.Ue)(),this.localMatrix)}equals(e){return this===e||null!=e&&(0,l.I6)(this.localMatrix,e.localMatrix)}clone(){const e={translation:(0,d.d9)(this.translation),rotationAxis:(0,d.d9)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,d.d9)(this.scale)};return new r(e)}};(0,n._)([(0,o.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"translation",void 0),(0,n._)([(0,o.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAxis",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAngle",void 0),(0,n._)([(0,o.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"scale",void 0),(0,n._)([(0,o.Cb)()],f.prototype,"rotation",null),(0,n._)([(0,o.Cb)()],f.prototype,"localMatrix",null),(0,n._)([(0,o.Cb)()],f.prototype,"localMatrixInverse",null),f=r=(0,n._)([(0,a.j)("esri.geometry.support.MeshTransform")],f);const m=(0,h.Ue)(),g=f},52345:(e,t,i)=>{var r;i.d(t,{W:()=>r}),function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"}(r||(r={}))},82584:(e,t,i)=>{i.d(t,{E9:()=>s,I6:()=>l,Vl:()=>r,bN:()=>a});var r,n;!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(r||(r={}));class s{constructor(e,t){this.x=e,this.y=t}clone(){return new s(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){return this.x=e,this.y=t,this}normalize(){const e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);return this.x/=i,this.y/=i,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,t){return this.x+=e,this.y+=t,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}assignSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}rotate(e,t){const i=this.x,r=this.y;return this.x=i*e-r*t,this.y=i*t+r*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}static add(e,t){return new s(e.x+t.x,e.y+t.y)}static sub(e,t){return new s(e.x-t.x,e.y-t.y)}}class o{constructor(e,t,i){this.ratio=e,this.x=t,this.y=i}}class a{constructor(e,t,i,r=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=r,this._pixelMargin=n,this._tileSize=512*r,this._dz=e,this._yPos=t,this._xPos=i}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;const i=e>>this._dz;t>i&&(t=i),this._margin=t,this._xmin=i*this._xPos-t,this._ymin=i*this._yPos-t,this._xmax=this._xmin+i+2*t,this._ymax=this._ymin+i+2*t}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new s(e,t),this._firstPt=new s(e,t),this._dist=0}lineTo(e,t){const i=this._isIn(e,t),r=new s(e,t),n=s.distance(this._prevPt,r);let a,l,c,u,h,d,p,f;if(i)this._prevIsIn?this._lineTo(e,t,!0):(a=this._prevPt,l=r,c=this._intersect(l,a),this._start=this._dist+n*(1-this._r),this._lineTo(c.x,c.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,a=r,c=this._intersect(l,a),this._lineTo(c.x,c.y,!0),this._lineTo(a.x,a.y,!1);else{const e=this._prevPt,t=r;if(e.x<=this._xmin&&t.x<=this._xmin||e.x>=this._xmax&&t.x>=this._xmax||e.y<=this._ymin&&t.y<=this._ymin||e.y>=this._ymax&&t.y>=this._ymax)this._lineTo(t.x,t.y,!1);else{const i=[];if((e.x<this._xmin&&t.x>this._xmin||e.x>this._xmin&&t.x<this._xmin)&&(u=(this._xmin-e.x)/(t.x-e.x),f=e.y+u*(t.y-e.y),f<=this._ymin?d=!1:f>=this._ymax?d=!0:i.push(new o(u,this._xmin,f))),(e.x<this._xmax&&t.x>this._xmax||e.x>this._xmax&&t.x<this._xmax)&&(u=(this._xmax-e.x)/(t.x-e.x),f=e.y+u*(t.y-e.y),f<=this._ymin?d=!1:f>=this._ymax?d=!0:i.push(new o(u,this._xmax,f))),(e.y<this._ymin&&t.y>this._ymin||e.y>this._ymin&&t.y<this._ymin)&&(u=(this._ymin-e.y)/(t.y-e.y),p=e.x+u*(t.x-e.x),p<=this._xmin?h=!1:p>=this._xmax?h=!0:i.push(new o(u,p,this._ymin))),(e.y<this._ymax&&t.y>this._ymax||e.y>this._ymax&&t.y<this._ymax)&&(u=(this._ymax-e.y)/(t.y-e.y),p=e.x+u*(t.x-e.x),p<=this._xmin?h=!1:p>=this._xmax?h=!0:i.push(new o(u,p,this._ymax))),0===i.length)h?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(i.length>1&&i[0].ratio>i[1].ratio)this._start=this._dist+n*i[1].ratio,this._lineTo(i[1].x,i[1].y,!0),this._lineTo(i[0].x,i[0].y,!0);else{this._start=this._dist+n*i[0].ratio;for(let e=0;e<i.length;e++)this._lineTo(i[e].x,i[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=n,this._prevIsIn=i,this._prevPt=r}close(){if(this._line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const i=this._line;let r=i.length;for(;r>=4&&(i[0].x===i[1].x&&i[0].x===i[r-2].x||i[0].y===i[1].y&&i[0].y===i[r-2].y);)i.pop(),i[0].x=i[r-2].x,i[0].y=i[r-2].y,--r}}result(e=!0){return this._pushLine(),0===this._lines.length?null:(this._type===r.Polygon&&e&&c.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==r.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,t=e.length;if(0===t)return null;const i=[];for(let r=0;r<t;r++)i.push({line:e[r],start:this._starts[r]||0});return i}_isIn(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_intersect(e,t){let i,r,n;if(t.x>=this._xmin&&t.x<=this._xmax)r=t.y<=this._ymin?this._ymin:this._ymax,n=(r-e.y)/(t.y-e.y),i=e.x+n*(t.x-e.x);else if(t.y>=this._ymin&&t.y<=this._ymax)i=t.x<=this._xmin?this._xmin:this._xmax,n=(i-e.x)/(t.x-e.x),r=e.y+n*(t.y-e.y);else{r=t.y<=this._ymin?this._ymin:this._ymax,i=t.x<=this._xmin?this._xmin:this._xmax;const s=(i-e.x)/(t.x-e.x),o=(r-e.y)/(t.y-e.y);s<o?(n=s,r=e.y+s*(t.y-e.y)):(n=o,i=e.x+o*(t.x-e.x))}return this._r=n,new s(i,r)}_pushLine(){this._line&&(this._type===r.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===r.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===r.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,t,i){this._type!==r.Polygon?i&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new s(e,t))):(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new s(e,t)),this._isH=!1,this._isV=!1)}_lineTo(e,t,i){let n,o;if(this._type!==r.Polygon)if(i){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1],n.equals(e,t)))return;this._line.push(new s(e,t))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){n=this._line[this._line.length-1];const i=n.x===e,r=n.y===t;if(i&&r)return;this._isH&&i||this._isV&&r?(n.x=e,n.y=t,o=this._line[this._line.length-2],o.x===e&&o.y===t?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(o=this._line[this._line.length-2],this._isH=o.x===e,this._isV=o.y===t)):(this._isH=o.x===e,this._isV=o.y===t)):(this._line.push(new s(e,t)),this._isH=i,this._isV=r)}else this._line.push(new s(e,t))}}class l{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,t){this._line&&this._lines.push(this._line),this._line=[];const i=this._ratio;this._line.push(new s(e*i,t*i))}lineTo(e,t){const i=this._ratio;this._line.push(new s(e*i,t*i))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(e){e[e.sideLeft=0]="sideLeft",e[e.sideRight=1]="sideRight",e[e.sideTop=2]="sideTop",e[e.sideBottom=3]="sideBottom"}(n||(n={}));class c{static simplify(e,t,i){if(!i)return;const r=-t,s=e+t,o=-t,a=e+t,l=[],u=[],h=i.length;for(let e=0;e<h;++e){const t=i[e];if(!t||t.length<2)continue;let c,h=t[0];const d=t.length;for(let i=1;i<d;++i)c=t[i],h.x===c.x&&(h.x<=r&&(h.y>c.y?(l.push(e),l.push(i),l.push(n.sideLeft),l.push(-1)):(u.push(e),u.push(i),u.push(n.sideLeft),u.push(-1))),h.x>=s&&(h.y<c.y?(l.push(e),l.push(i),l.push(n.sideRight),l.push(-1)):(u.push(e),u.push(i),u.push(n.sideRight),u.push(-1)))),h.y===c.y&&(h.y<=o&&(h.x<c.x?(l.push(e),l.push(i),l.push(n.sideTop),l.push(-1)):(u.push(e),u.push(i),u.push(n.sideTop),u.push(-1))),h.y>=a&&(h.x>c.x?(l.push(e),l.push(i),l.push(n.sideBottom),l.push(-1)):(u.push(e),u.push(i),u.push(n.sideBottom),u.push(-1)))),h=c}if(0===l.length||0===u.length)return;c.fillParent(i,u,l),c.fillParent(i,l,u);const d=[];c.calcDeltas(d,u,l),c.calcDeltas(d,l,u),c.addDeltas(d,i)}static fillParent(e,t,i){const r=i.length,s=t.length;for(let o=0;o<s;o+=4){const s=t[o],a=t[o+1],l=t[o+2],c=e[s][a-1],h=e[s][a];let d=8092,p=-1;for(let t=0;t<r;t+=4){if(i[t+2]!==l)continue;const r=i[t],s=i[t+1],o=e[r][s-1],a=e[r][s];switch(l){case n.sideLeft:case n.sideRight:if(u(c.y,o.y,a.y)&&u(h.y,o.y,a.y)){const e=Math.abs(a.y-o.y);e<d&&(d=e,p=t)}break;case n.sideTop:case n.sideBottom:if(u(c.x,o.x,a.x)&&u(h.x,o.x,a.x)){const e=Math.abs(a.x-o.x);e<d&&(d=e,p=t)}}}t[o+3]=p}}static calcDeltas(e,t,i){const r=t.length;for(let n=0;n<r;n+=4){const r=[],s=c.calcDelta(n,t,i,r);e.push(t[n]),e.push(t[n+1]),e.push(t[n+2]),e.push(s)}}static calcDelta(e,t,i,r){const n=t[e+3];if(-1===n)return 0;const s=r.length;return s>1&&r[s-2]===n?0:(r.push(n),c.calcDelta(n,i,t,r)+1)}static addDeltas(e,t){const i=e.length;let r=0;for(let t=0;t<i;t+=4){const i=e[t+3];i>r&&(r=i)}for(let s=0;s<i;s+=4){const i=t[e[s]],o=e[s+1],a=r-e[s+3];switch(e[s+2]){case n.sideLeft:i[o-1].x-=a,i[o].x-=a,1===o&&(i[i.length-1].x-=a),o===i.length-1&&(i[0].x-=a);break;case n.sideRight:i[o-1].x+=a,i[o].x+=a,1===o&&(i[i.length-1].x+=a),o===i.length-1&&(i[0].x+=a);break;case n.sideTop:i[o-1].y-=a,i[o].y-=a,1===o&&(i[i.length-1].y-=a),o===i.length-1&&(i[0].y-=a);break;case n.sideBottom:i[o-1].y+=a,i[o].y+=a,1===o&&(i[i.length-1].y+=a),o===i.length-1&&(i[0].y+=a)}}}}const u=(e,t,i)=>e>=t&&e<=i||e>=i&&e<=t},36644:(e,t,i)=>{let r;i.d(t,{Z:()=>n});const n={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,10592:0,10594:0,10596:0,10598:0,10601:0,10603:0,10626:0,10632:0,10665:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1,103978:2,103979:0,103980:2,103981:0};for(r=2e3;r<=2045;r++)n[r]=0;for(r=2056;r<=2065;r++)n[r]=0;for(r=2067;r<=2135;r++)n[r]=0;for(r=2137;r<=2154;r++)n[r]=0;for(r=2161;r<=2170;r++)n[r]=0;for(r=2172;r<=2193;r++)n[r]=0;for(r=2195;r<=2198;r++)n[r]=0;for(r=2200;r<=2203;r++)n[r]=0;for(r=2205;r<=2217;r++)n[r]=0;for(r=2222;r<=2224;r++)n[r]=1;for(r=2225;r<=2250;r++)n[r]=2;for(r=2251;r<=2253;r++)n[r]=1;for(r=2257;r<=2264;r++)n[r]=2;for(r=2274;r<=2279;r++)n[r]=2;for(r=2280;r<=2282;r++)n[r]=1;for(r=2283;r<=2289;r++)n[r]=2;for(r=2290;r<=2292;r++)n[r]=0;for(r=2308;r<=2313;r++)n[r]=0;for(r=2315;r<=2491;r++)n[r]=0;for(r=2494;r<=2866;r++)n[r]=0;for(r=2867;r<=2869;r++)n[r]=1;for(r=2870;r<=2888;r++)n[r]=2;for(r=2891;r<=2895;r++)n[r]=2;for(r=2896;r<=2898;r++)n[r]=1;for(r=2902;r<=2908;r++)n[r]=2;for(r=2915;r<=2920;r++)n[r]=2;for(r=2921;r<=2923;r++)n[r]=1;for(r=2924;r<=2930;r++)n[r]=2;for(r=2931;r<=2962;r++)n[r]=0;for(r=2964;r<=2968;r++)n[r]=2;for(r=2969;r<=2973;r++)n[r]=0;for(r=2975;r<=2991;r++)n[r]=0;for(r=2995;r<=3051;r++)n[r]=0;for(r=3054;r<=3079;r++)n[r]=0;for(r=3081;r<=3088;r++)n[r]=0;for(r=3092;r<=3101;r++)n[r]=0;for(r=3106;r<=3138;r++)n[r]=0;for(r=3146;r<=3151;r++)n[r]=0;for(r=3153;r<=3166;r++)n[r]=0;for(r=3168;r<=3172;r++)n[r]=0;for(r=3174;r<=3203;r++)n[r]=0;for(r=3294;r<=3358;r++)n[r]=0;for(r=3367;r<=3403;r++)n[r]=0;for(r=3408;r<=3416;r++)n[r]=0;for(r=3417;r<=3438;r++)n[r]=2;for(r=3441;r<=3446;r++)n[r]=2;for(r=3447;r<=3450;r++)n[r]=0;for(r=3451;r<=3459;r++)n[r]=2;for(r=3460;r<=3478;r++)n[r]=0;for(r=3554;r<=3559;r++)n[r]=0;for(r=3560;r<=3570;r++)n[r]=2;for(r=3571;r<=3581;r++)n[r]=0;for(r=3594;r<=3597;r++)n[r]=0;for(r=3601;r<=3604;r++)n[r]=0;for(r=3637;r<=3639;r++)n[r]=0;for(r=3665;r<=3667;r++)n[r]=0;for(r=3693;r<=3695;r++)n[r]=0;for(r=3701;r<=3727;r++)n[r]=0;for(r=3728;r<=3739;r++)n[r]=2;for(r=3740;r<=3751;r++)n[r]=0;for(r=3753;r<=3760;r++)n[r]=2;for(r=3761;r<=3773;r++)n[r]=0;for(r=3775;r<=3777;r++)n[r]=0;for(r=3779;r<=3781;r++)n[r]=0;for(r=3783;r<=3785;r++)n[r]=0;for(r=3788;r<=3791;r++)n[r]=0;for(r=3797;r<=3802;r++)n[r]=0;for(r=3814;r<=3816;r++)n[r]=0;for(r=3825;r<=3829;r++)n[r]=0;for(r=3832;r<=3841;r++)n[r]=0;for(r=3844;r<=3852;r++)n[r]=0;for(r=3873;r<=3885;r++)n[r]=0;for(r=3890;r<=3893;r++)n[r]=0;for(r=3907;r<=3912;r++)n[r]=0;for(r=3942;r<=3950;r++)n[r]=0;for(r=3968;r<=3970;r++)n[r]=0;for(r=3973;r<=3976;r++)n[r]=0;for(r=3986;r<=3989;r++)n[r]=0;for(r=3994;r<=3997;r++)n[r]=0;for(r=4048;r<=4051;r++)n[r]=0;for(r=4056;r<=4063;r++)n[r]=0;for(r=4093;r<=4096;r++)n[r]=0;for(r=4390;r<=4398;r++)n[r]=0;for(r=4399;r<=4413;r++)n[r]=2;for(r=4418;r<=4433;r++)n[r]=2;for(r=4455;r<=4457;r++)n[r]=2;for(r=4484;r<=4489;r++)n[r]=0;for(r=4491;r<=4554;r++)n[r]=0;for(r=4568;r<=4589;r++)n[r]=0;for(r=4652;r<=4656;r++)n[r]=0;for(r=4766;r<=4800;r++)n[r]=0;for(r=5014;r<=5016;r++)n[r]=0;for(r=5069;r<=5072;r++)n[r]=0;for(r=5105;r<=5130;r++)n[r]=0;for(r=5167;r<=5188;r++)n[r]=0;for(r=5253;r<=5259;r++)n[r]=0;for(r=5269;r<=5275;r++)n[r]=0;for(r=5292;r<=5311;r++)n[r]=0;for(r=5329;r<=5331;r++)n[r]=0;for(r=5343;r<=5349;r++)n[r]=0;for(r=5355;r<=5357;r++)n[r]=0;for(r=5387;r<=5389;r++)n[r]=0;for(r=5459;r<=5463;r++)n[r]=0;for(r=5479;r<=5482;r++)n[r]=0;for(r=5518;r<=5520;r++)n[r]=0;for(r=5530;r<=5539;r++)n[r]=0;for(r=5550;r<=5552;r++)n[r]=0;for(r=5562;r<=5583;r++)n[r]=0;for(r=5623;r<=5625;r++)n[r]=2;for(r=5631;r<=5639;r++)n[r]=0;for(r=5649;r<=5653;r++)n[r]=0;for(r=5663;r<=5680;r++)n[r]=0;for(r=5682;r<=5685;r++)n[r]=0;for(r=5875;r<=5877;r++)n[r]=0;for(r=5896;r<=5899;r++)n[r]=0;for(r=5921;r<=5940;r++)n[r]=0;for(r=6050;r<=6125;r++)n[r]=0;for(r=6244;r<=6275;r++)n[r]=0;for(r=6328;r<=6348;r++)n[r]=0;for(r=6350;r<=6356;r++)n[r]=0;for(r=6366;r<=6372;r++)n[r]=0;for(r=6381;r<=6387;r++)n[r]=0;for(r=6393;r<=6404;r++)n[r]=0;for(r=6480;r<=6483;r++)n[r]=0;for(r=6511;r<=6514;r++)n[r]=0;for(r=6579;r<=6581;r++)n[r]=0;for(r=6619;r<=6624;r++)n[r]=0;for(r=6625;r<=6627;r++)n[r]=2;for(r=6628;r<=6632;r++)n[r]=0;for(r=6634;r<=6637;r++)n[r]=0;for(r=6669;r<=6692;r++)n[r]=0;for(r=6707;r<=6709;r++)n[r]=0;for(r=6720;r<=6723;r++)n[r]=0;for(r=6732;r<=6738;r++)n[r]=0;for(r=6931;r<=6933;r++)n[r]=0;for(r=6956;r<=6959;r++)n[r]=0;for(r=7005;r<=7007;r++)n[r]=0;for(r=7057;r<=7070;r++)n[r]=2;for(r=7074;r<=7082;r++)n[r]=0;for(r=7109;r<=7118;r++)n[r]=0;for(r=7119;r<=7127;r++)n[r]=1;for(r=7374;r<=7376;r++)n[r]=0;for(r=7528;r<=7586;r++)n[r]=0;for(r=7587;r<=7645;r++)n[r]=2;for(r=7692;r<=7696;r++)n[r]=0;for(r=7755;r<=7787;r++)n[r]=0;for(r=7791;r<=7795;r++)n[r]=0;for(r=7799;r<=7801;r++)n[r]=0;for(r=7803;r<=7805;r++)n[r]=0;for(r=7825;r<=7831;r++)n[r]=0;for(r=7845;r<=7859;r++)n[r]=0;for(r=8013;r<=8032;r++)n[r]=0;for(r=8065;r<=8068;r++)n[r]=1;for(r=8518;r<=8529;r++)n[r]=2;for(r=8533;r<=8536;r++)n[r]=2;for(r=8538;r<=8540;r++)n[r]=2;for(r=8677;r<=8679;r++)n[r]=0;for(r=8836;r<=8840;r++)n[r]=0;for(r=8857;r<=8859;r++)n[r]=0;for(r=8908;r<=8910;r++)n[r]=0;for(r=9154;r<=9159;r++)n[r]=0;for(r=9205;r<=9218;r++)n[r]=0;for(r=9271;r<=9273;r++)n[r]=0;for(r=9295;r<=9297;r++)n[r]=0;for(r=9356;r<=9360;r++)n[r]=0;for(r=9404;r<=9407;r++)n[r]=0;for(r=9476;r<=9482;r++)n[r]=0;for(r=9487;r<=9494;r++)n[r]=0;for(r=9697;r<=9699;r++)n[r]=0;for(r=9821;r<=9865;r++)n[r]=0;for(r=10285;r<=10291;r++)n[r]=0;for(r=10314;r<=10317;r++)n[r]=0;for(r=10448;r<=10465;r++)n[r]=0;for(r=10731;r<=10733;r++)n[r]=0;for(r=11114;r<=11118;r++)n[r]=0;for(r=20004;r<=20032;r++)n[r]=0;for(r=20047;r<=20049;r++)n[r]=0;for(r=20062;r<=20092;r++)n[r]=0;for(r=20135;r<=20138;r++)n[r]=0;for(r=20248;r<=20258;r++)n[r]=0;for(r=20348;r<=20358;r++)n[r]=0;for(r=20436;r<=20440;r++)n[r]=0;for(r=20822;r<=20824;r++)n[r]=0;for(r=20904;r<=20932;r++)n[r]=0;for(r=20934;r<=20936;r++)n[r]=0;for(r=21004;r<=21032;r++)n[r]=0;for(r=21035;r<=21037;r++)n[r]=0;for(r=21095;r<=21097;r++)n[r]=0;for(r=21148;r<=21150;r++)n[r]=0;for(r=21207;r<=21264;r++)n[r]=0;for(r=21307;r<=21364;r++)n[r]=0;for(r=21413;r<=21423;r++)n[r]=0;for(r=21453;r<=21463;r++)n[r]=0;for(r=21473;r<=21483;r++)n[r]=0;for(r=21780;r<=21782;r++)n[r]=0;for(r=21891;r<=21894;r++)n[r]=0;for(r=21896;r<=21899;r++)n[r]=0;for(r=22171;r<=22177;r++)n[r]=0;for(r=22181;r<=22187;r++)n[r]=0;for(r=22191;r<=22197;r++)n[r]=0;for(r=22207;r<=22222;r++)n[r]=0;for(r=22229;r<=22232;r++)n[r]=0;for(r=22234;r<=22236;r++)n[r]=0;for(r=22243;r<=22250;r++)n[r]=0;for(r=22262;r<=22265;r++)n[r]=0;for(r=22307;r<=22322;r++)n[r]=0;for(r=22348;r<=22357;r++)n[r]=0;for(r=22407;r<=22422;r++)n[r]=0;for(r=22462;r<=22465;r++)n[r]=0;for(r=22521;r<=22525;r++)n[r]=0;for(r=22607;r<=22622;r++)n[r]=0;for(r=22641;r<=22646;r++)n[r]=0;for(r=22648;r<=22657;r++)n[r]=0;for(r=22707;r<=22722;r++)n[r]=0;for(r=22762;r<=22765;r++)n[r]=0;for(r=22807;r<=22822;r++)n[r]=0;for(r=22991;r<=22994;r++)n[r]=0;for(r=23028;r<=23038;r++)n[r]=0;for(r=23301;r<=23333;r++)n[r]=2;for(r=23830;r<=23853;r++)n[r]=0;for(r=23866;r<=23872;r++)n[r]=0;for(r=23877;r<=23884;r++)n[r]=0;for(r=23886;r<=23894;r++)n[r]=0;for(r=23946;r<=23948;r++)n[r]=0;for(r=24311;r<=24313;r++)n[r]=0;for(r=24342;r<=24347;r++)n[r]=0;for(r=24370;r<=24374;r++)n[r]=10;for(r=24375;r<=24381;r++)n[r]=0;for(r=24718;r<=24721;r++)n[r]=0;for(r=24817;r<=24821;r++)n[r]=0;for(r=24877;r<=24882;r++)n[r]=0;for(r=24891;r<=24893;r++)n[r]=0;for(r=25391;r<=25395;r++)n[r]=0;for(r=25828;r<=25838;r++)n[r]=0;for(r=26191;r<=26195;r++)n[r]=0;for(r=26391;r<=26393;r++)n[r]=0;for(r=26701;r<=26722;r++)n[r]=0;for(r=26729;r<=26799;r++)n[r]=2;for(r=26801;r<=26803;r++)n[r]=2;for(r=26811;r<=26813;r++)n[r]=2;for(r=26847;r<=26870;r++)n[r]=2;for(r=26891;r<=26899;r++)n[r]=0;for(r=26901;r<=26923;r++)n[r]=0;for(r=26929;r<=26946;r++)n[r]=0;for(r=26948;r<=26998;r++)n[r]=0;for(r=27037;r<=27040;r++)n[r]=0;for(r=27205;r<=27232;r++)n[r]=0;for(r=27258;r<=27260;r++)n[r]=0;for(r=27391;r<=27398;r++)n[r]=0;for(r=27561;r<=27564;r++)n[r]=0;for(r=27571;r<=27574;r++)n[r]=0;for(r=27581;r<=27584;r++)n[r]=0;for(r=27591;r<=27594;r++)n[r]=0;for(r=27700;r<=27707;r++)n[r]=0;for(r=28191;r<=28193;r++)n[r]=0;for(r=28348;r<=28358;r++)n[r]=0;for(r=28402;r<=28432;r++)n[r]=0;for(r=28462;r<=28492;r++)n[r]=0;for(r=29118;r<=29122;r++)n[r]=0;for(r=29168;r<=29172;r++)n[r]=0;for(r=29177;r<=29185;r++)n[r]=0;for(r=29187;r<=29195;r++)n[r]=0;for(r=29900;r<=29903;r++)n[r]=0;for(r=30161;r<=30179;r++)n[r]=0;for(r=30491;r<=30494;r++)n[r]=0;for(r=30729;r<=30732;r++)n[r]=0;for(r=31251;r<=31259;r++)n[r]=0;for(r=31265;r<=31268;r++)n[r]=0;for(r=31275;r<=31279;r++)n[r]=0;for(r=31281;r<=31297;r++)n[r]=0;for(r=31461;r<=31469;r++)n[r]=0;for(r=31491;r<=31495;r++)n[r]=0;for(r=31917;r<=31922;r++)n[r]=0;for(r=31965;r<=32e3;r++)n[r]=0;for(r=32001;r<=32003;r++)n[r]=2;for(r=32005;r<=32031;r++)n[r]=2;for(r=32033;r<=32060;r++)n[r]=2;for(r=32064;r<=32067;r++)n[r]=2;for(r=32074;r<=32077;r++)n[r]=2;for(r=32081;r<=32086;r++)n[r]=0;for(r=32107;r<=32130;r++)n[r]=0;for(r=32133;r<=32159;r++)n[r]=0;for(r=32164;r<=32167;r++)n[r]=2;for(r=32180;r<=32199;r++)n[r]=0;for(r=32201;r<=32260;r++)n[r]=0;for(r=32301;r<=32360;r++)n[r]=0;for(r=32401;r<=32460;r++)n[r]=0;for(r=32501;r<=32560;r++)n[r]=0;for(r=32601;r<=32662;r++)n[r]=0;for(r=32664;r<=32667;r++)n[r]=2;for(r=32701;r<=32761;r++)n[r]=0;for(r=53001;r<=53004;r++)n[r]=0;for(r=53008;r<=53019;r++)n[r]=0;for(r=53021;r<=53032;r++)n[r]=0;for(r=53034;r<=53037;r++)n[r]=0;for(r=53042;r<=53046;r++)n[r]=0;for(r=53074;r<=53080;r++)n[r]=0;for(r=54001;r<=54004;r++)n[r]=0;for(r=54008;r<=54019;r++)n[r]=0;for(r=54021;r<=54032;r++)n[r]=0;for(r=54034;r<=54037;r++)n[r]=0;for(r=54042;r<=54046;r++)n[r]=0;for(r=54048;r<=54053;r++)n[r]=0;for(r=54074;r<=54080;r++)n[r]=0;for(r=54098;r<=54101;r++)n[r]=0;for(r=102001;r<=102040;r++)n[r]=0;for(r=102042;r<=102063;r++)n[r]=0;for(r=102065;r<=102067;r++)n[r]=0;for(r=102070;r<=102117;r++)n[r]=0;for(r=102122;r<=102216;r++)n[r]=0;for(r=102221;r<=102377;r++)n[r]=0;for(r=102382;r<=102388;r++)n[r]=0;for(r=102389;r<=102398;r++)n[r]=2;for(r=102399;r<=102444;r++)n[r]=0;for(r=102445;r<=102447;r++)n[r]=2;for(r=102448;r<=102458;r++)n[r]=0;for(r=102459;r<=102468;r++)n[r]=2;for(r=102469;r<=102499;r++)n[r]=0;for(r=102500;r<=102519;r++)n[r]=1;for(r=102520;r<=102524;r++)n[r]=0;for(r=102525;r<=102529;r++)n[r]=2;for(r=102530;r<=102588;r++)n[r]=0;for(r=102590;r<=102598;r++)n[r]=0;for(r=102601;r<=102603;r++)n[r]=0;for(r=102605;r<=102628;r++)n[r]=0;for(r=102629;r<=102646;r++)n[r]=2;for(r=102648;r<=102700;r++)n[r]=2;for(r=102701;r<=102703;r++)n[r]=0;for(r=102707;r<=102730;r++)n[r]=2;for(r=102733;r<=102758;r++)n[r]=2;for(r=102767;r<=102900;r++)n[r]=0;for(r=102901;r<=102933;r++)n[r]=2;for(r=102934;r<=102950;r++)n[r]=13;for(r=102951;r<=102963;r++)n[r]=0;for(r=102965;r<=102969;r++)n[r]=0;for(r=102971;r<=102973;r++)n[r]=0;for(r=102975;r<=102989;r++)n[r]=0;for(r=102990;r<=102992;r++)n[r]=1;for(r=102997;r<=103002;r++)n[r]=0;for(r=103003;r<=103008;r++)n[r]=2;for(r=103009;r<=103011;r++)n[r]=0;for(r=103012;r<=103014;r++)n[r]=2;for(r=103019;r<=103021;r++)n[r]=0;for(r=103022;r<=103024;r++)n[r]=2;for(r=103029;r<=103031;r++)n[r]=0;for(r=103032;r<=103034;r++)n[r]=2;for(r=103065;r<=103068;r++)n[r]=0;for(r=103074;r<=103076;r++)n[r]=0;for(r=103077;r<=103079;r++)n[r]=1;for(r=103080;r<=103082;r++)n[r]=0;for(r=103083;r<=103085;r++)n[r]=2;for(r=103090;r<=103093;r++)n[r]=0;for(r=103097;r<=103099;r++)n[r]=0;for(r=103100;r<=103102;r++)n[r]=2;for(r=103107;r<=103109;r++)n[r]=0;for(r=103110;r<=103112;r++)n[r]=2;for(r=103113;r<=103116;r++)n[r]=0;for(r=103117;r<=103120;r++)n[r]=2;for(r=103153;r<=103157;r++)n[r]=0;for(r=103158;r<=103162;r++)n[r]=2;for(r=103163;r<=103165;r++)n[r]=0;for(r=103166;r<=103168;r++)n[r]=1;for(r=103169;r<=103171;r++)n[r]=2;for(r=103186;r<=103188;r++)n[r]=0;for(r=103189;r<=103191;r++)n[r]=2;for(r=103192;r<=103195;r++)n[r]=0;for(r=103196;r<=103199;r++)n[r]=2;for(r=103200;r<=103224;r++)n[r]=0;for(r=103225;r<=103227;r++)n[r]=1;for(r=103232;r<=103237;r++)n[r]=0;for(r=103238;r<=103243;r++)n[r]=2;for(r=103244;r<=103246;r++)n[r]=0;for(r=103247;r<=103249;r++)n[r]=2;for(r=103254;r<=103256;r++)n[r]=0;for(r=103257;r<=103259;r++)n[r]=2;for(r=103264;r<=103266;r++)n[r]=0;for(r=103267;r<=103269;r++)n[r]=2;for(r=103300;r<=103375;r++)n[r]=0;for(r=103381;r<=103383;r++)n[r]=0;for(r=103384;r<=103386;r++)n[r]=1;for(r=103387;r<=103389;r++)n[r]=0;for(r=103390;r<=103392;r++)n[r]=2;for(r=103397;r<=103399;r++)n[r]=0;for(r=103400;r<=103471;r++)n[r]=2;for(r=103476;r<=103478;r++)n[r]=0;for(r=103479;r<=103481;r++)n[r]=2;for(r=103486;r<=103488;r++)n[r]=0;for(r=103489;r<=103491;r++)n[r]=2;for(r=103492;r<=103495;r++)n[r]=0;for(r=103496;r<=103499;r++)n[r]=2;for(r=103528;r<=103543;r++)n[r]=0;for(r=103544;r<=103548;r++)n[r]=2;for(r=103549;r<=103551;r++)n[r]=0;for(r=103552;r<=103554;r++)n[r]=1;for(r=103555;r<=103557;r++)n[r]=2;for(r=103558;r<=103560;r++)n[r]=0;for(r=103571;r<=103573;r++)n[r]=0;for(r=103574;r<=103576;r++)n[r]=2;for(r=103577;r<=103580;r++)n[r]=0;for(r=103581;r<=103583;r++)n[r]=2;for(r=103595;r<=103694;r++)n[r]=0;for(r=103696;r<=103699;r++)n[r]=0;for(r=103700;r<=103793;r++)n[r]=2;for(r=103794;r<=103890;r++)n[r]=0;for(r=103891;r<=103896;r++)n[r]=2;for(r=103900;r<=103971;r++)n[r]=2;for(r=103972;r<=103977;r++)n[r]=0;for(r=112e3;r<=112101;r++)n[r]=0},37116:(e,t,i)=>{i.d(t,{BD:()=>C,Cb:()=>b,FY:()=>l,G1:()=>m,G_:()=>G,HH:()=>h,JR:()=>F,KE:()=>O,TC:()=>d,Tn:()=>I,Ue:()=>o,VK:()=>p,Wi:()=>g,Ye:()=>v,Zp:()=>M,al:()=>a,bA:()=>R,bM:()=>j,bZ:()=>U,be:()=>x,bf:()=>_,cS:()=>D,cv:()=>A,dp:()=>T,eZ:()=>u,fS:()=>B,gy:()=>H,is:()=>k,kK:()=>E,op:()=>P,pp:()=>f,r3:()=>S,re:()=>V,sU:()=>y,t8:()=>L,wp:()=>z,wq:()=>c,wz:()=>w,y8:()=>N});var r=i(91772),n=i(24568),s=i(92570);function o(e=j){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,i,r,n,s,a=o()){return a[0]=e,a[1]=t,a[2]=i,a[3]=r,a[4]=n,a[5]=s,a}function l(e,t=o()){return c(e,0,e.length/3,t)}function c(e,t,i,r=o()){return L(r,G),m(r,e,t,i),r}function u(e,t=(0,s.bg)(24)){const[i,r,n,o,a,l]=e;return t[0]=i,t[1]=r,t[2]=n,t[3]=i,t[4]=r,t[5]=l,t[6]=i,t[7]=a,t[8]=n,t[9]=i,t[10]=a,t[11]=l,t[12]=o,t[13]=r,t[14]=n,t[15]=o,t[16]=r,t[17]=l,t[18]=o,t[19]=a,t[20]=n,t[21]=o,t[22]=a,t[23]=l,t}function h(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new r.Z(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function d(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function p(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function f(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function m(e,t,i=0,r=t.length/3){let n=e[0],s=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let e=0;e<r;e++)n=Math.min(n,t[i+3*e]),s=Math.min(s,t[i+3*e+1]),o=Math.min(o,t[i+3*e+2]),a=Math.max(a,t[i+3*e]),l=Math.max(l,t[i+3*e+1]),c=Math.max(c,t[i+3*e+2]);e[0]=n,e[1]=s,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function g(e,t,i){const r=t.length;let n=e[0],s=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(i)for(let e=0;e<r;e++){const i=t[e];n=Math.min(n,i[0]),s=Math.min(s,i[1]),o=Math.min(o,i[2]),a=Math.max(a,i[0]),l=Math.max(l,i[1]),c=Math.max(c,i[2])}else for(let e=0;e<r;e++){const i=t[e];n=Math.min(n,i[0]),s=Math.min(s,i[1]),a=Math.max(a,i[0]),l=Math.max(l,i[1])}e[0]=n,e[1]=s,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function y(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function _(e){return e[0]>=e[3]?0:e[3]-e[0]}function v(e){return e[1]>=e[4]?0:e[4]-e[1]}function b(e){return e[2]>=e[5]?0:e[5]-e[2]}function w(e){const t=_(e),i=b(e),r=v(e);return Math.sqrt(t*t+i*i+r*r)}function x(e,t=[0,0,0]){return t[0]=e[0]+_(e)/2,t[1]=e[1]+v(e)/2,t[2]=e[2]+b(e)/2,t}function T(e,t=[0,0,0]){return t[0]=_(e),t[1]=v(e),t[2]=b(e),t}function C(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function S(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function E(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function M(e,t){return null==t||E(e,t)}function A(e,t,i,r,n=e){return n[0]=e[0]+t,n[1]=e[1]+i,n[2]=e[2]+r,n[3]=e[3]+t,n[4]=e[4]+i,n[5]=e[5]+r,n}function R(e,t,i=e){const r=e[0]+_(e)/2,n=e[1]+v(e)/2,s=e[2]+b(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=n+(e[1]-n)*t,i[2]=s+(e[2]-s)*t,i[3]=r+(e[3]-r)*t,i[4]=n+(e[4]-n)*t,i[5]=s+(e[5]-s)*t,i}function O(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function P(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function I(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function L(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function D(e){return e?L(e,G):o(G)}function N(e,t){return t||(t=(0,n.Ue)()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function F(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function U(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=Number.NEGATIVE_INFINITY,e[3]=r,e[4]=n,e[5]=Number.POSITIVE_INFINITY,e}function k(e){return 6===e.length}function z(e){return 0===_(e)&&0===v(e)&&0===b(e)}function B(e,t,i){if(null==e||null==t)return e===t;if(!k(e)||!k(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function V(e,t,i,r,n,s){return a(e,t,i,r,n,s,Z)}const H=[-1/0,-1/0,-1/0,1/0,1/0,1/0],G=[1/0,1/0,1/0,-1/0,-1/0,-1/0],j=[0,0,0,0,0,0],Z=o()},24568:(e,t,i)=>{i.d(t,{BD:()=>w,Cb:()=>g,G_:()=>U,HH:()=>u,Ho:()=>h,I7:()=>T,JG:()=>a,Qn:()=>C,SO:()=>y,TE:()=>O,Ue:()=>s,W4:()=>M,Wi:()=>p,al:()=>l,be:()=>v,cS:()=>I,cv:()=>P,d9:()=>o,d_:()=>m,fS:()=>N,gy:()=>F,hr:()=>x,jE:()=>S,jV:()=>R,jn:()=>d,kK:()=>E,oJ:()=>c,on:()=>b,py:()=>_,r3:()=>A,sU:()=>f,wp:()=>D});i(39994);var r=i(19431),n=i(91772);function s(e=k){return[e[0],e[1],e[2],e[3]]}function o(e){return[e[0],e[1],e[2],e[3]]}function a(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function l(e,t,i,r,n=s()){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function c(e,t=s()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function u(e,t,i=new n.Z){return i.xmin=e[0],i.ymin=e[1],i.xmax=e[2],i.ymax=e[3],i.spatialReference=t,i}function h(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function d(e,t,i){if(null!=t)if("length"in t)L(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):2!==t.length&&3!==t.length||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}else a(i,e)}function p(e,t,i=e){const r=t.length;let n=e[0],s=e[1],o=e[2],a=e[3];for(let e=0;e<r;e++){const i=t[e];n=Math.min(n,i[0]),s=Math.min(s,i[1]),o=Math.max(o,i[0]),a=Math.max(a,i[1])}return i[0]=n,i[1]=s,i[2]=o,i[3]=a,i}function f(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function m(e){return null==e||e[0]>=e[2]?0:e[2]-e[0]}function g(e){return null==e||e[1]>=e[3]?0:e[3]-e[1]}function y(e){return m(e)*g(e)}function _(e){return m(e)>0&&g(e)>0}function v(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function b(e){const t=m(e),i=g(e);return Math.sqrt(t*t+i*i)}function w(e,t){return S(e,t[0],t[1])}function x(e,t){const i=t[3],r=.5*(e[0]+e[2]),n=Math.abs(t[0]-r),s=.5*(e[2]-e[0]);if(n>i+s)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>i+a)return!1;if(n<s||l<a)return!0;const c=n-s,u=l-a;return c*c+u*u<=i*i}function T(e,t,i){const r=e[0],n=e[1],s=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:u}=i,h=(e,t)=>(u-l)*e+(a-c)*t+(c*l-a*u)<0,d=h(r,o),p=h(s,o),f=h(s,n),m=h(r,n);return!(d===p&&p===f&&f===m&&m===d||a<r&&c<r||a>s&&c>s||l>o&&u>o||l<n&&u<n)}function C(e,t){return S(e,t.x,t.y)}function S(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function E(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function M(e,t,i){return Math.max(t[0],e[0])-i<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])-i<=Math.min(t[3],e[3])}function A(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function R(e,t,i){if(null==t)return a(i,e);const n=t[0],s=t[1],o=t[2],l=t[3];return i[0]=(0,r.uZ)(e[0],n,o),i[1]=(0,r.uZ)(e[1],s,l),i[2]=(0,r.uZ)(e[2],n,o),i[3]=(0,r.uZ)(e[3],s,l),i}function O(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,n=Math.max(Math.abs(t[0]-i)-m(e)/2,0),s=Math.max(Math.abs(t[1]-r)-g(e)/2,0);return Math.sqrt(n*n+s*s)}function P(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function I(e){return e?a(e,U):s(U)}function L(e){return null!=e&&4===e.length}function D(e){return!(0!==m(e)&&isFinite(e[0])||0!==g(e)&&isFinite(e[1]))}function N(e,t){return L(e)&&L(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const F=[-1/0,-1/0,1/0,1/0],U=[1/0,1/0,-1/0,-1/0],k=[0,0,0,0]},34218:(e,t,i)=>{i.d(t,{EU:()=>g,Ue:()=>c,WH:()=>y,ZZ:()=>m,q_:()=>d,qw:()=>f,uT:()=>u,up:()=>v,zk:()=>h});var r=i(19431),n=i(32114),s=i(1845),o=i(96303),a=i(86717),l=i(81095);function c(e=v){return[e[0],e[1],e[2],e[3]]}function u(e,t,i=c()){return(0,a.c)(i,e),i[3]=t,i}function h(e,t,i){return(0,a.e)(i,e,t),(0,a.n)(i,i),i[3]=-(0,a.r)(e,t),i}function d(e,t=c()){const i=(0,n.j6)(b,e);return _(t,(0,r.BV)((0,s.Bh)(t,i))),t}function p(e,t,i=c()){return(0,s.yY)(b,e,y(e)),(0,s.yY)(w,t,y(t)),(0,s.Jp)(b,w,b),_(i,(0,r.BV)((0,s.Bh)(i,b)))}function f(e,t,i,r=c()){return u(l.E9,e,x),u(l.IO,t,T),u(l.eG,i,C),p(x,T,x),p(x,C,r),r}function m(e){return e}function g(e){return e[3]}function y(e){return(0,r.Vl)(e[3])}function _(e,t){return e[3]=t,e}const v=[0,0,1,0],b=(0,o.Ue)(),w=(0,o.Ue)(),x=(c(),c()),T=c(),C=c()},79880:(e,t,i)=>{i.d(t,{$P:()=>d,C6:()=>g,Cs:()=>p,Yg:()=>m,lC:()=>_,qu:()=>f});var r=i(24568);function n(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function s(e){return void 0!==e.points}function o(e){return void 0!==e.x&&void 0!==e.y}function a(e){return void 0!==e.paths}function l(e){return void 0!==e.rings}function c(e){return function(t,i){return null==t?i:null==i?t:e(t,i)}}const u=c(Math.min),h=c(Math.max);function d(e,t){return a(t)?g(e,t.paths,!1,!1):l(t)?g(e,t.rings,!1,!1):s(t)?_(e,t.points,!1,!1,!1,!1):n(t)?y(e,t):(o(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function p(e){let t,i,n,s;for(e.reset(),t=n=1/0,i=s=-1/0;e.nextPath();){const r=f(e);t=Math.min(r[0],t),n=Math.min(r[1],n),i=Math.max(r[2],i),s=Math.max(r[3],s)}return(0,r.Ue)([t,n,i,s])}function f(e){let t,i,n,s;for(t=n=1/0,i=s=-1/0;e.nextPoint();)t=Math.min(e.x,t),n=Math.min(e.y,n),i=Math.max(e.x,i),s=Math.max(e.y,s);return(0,r.Ue)([t,n,i,s])}function m(e,t){return a(t)?g(e,t.paths,!0,!1):l(t)?g(e,t.rings,!0,!1):s(t)?_(e,t.points,!0,!1,!0,!1):n(t)?y(e,t,!0,!1,!0,!1):(o(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function g(e,t,i,r){const n=i?3:2;if(!t.length||!t[0].length)return null;let s,o,a,l,[c,d]=t[0][0],[p,f]=t[0][0];for(let e=0;e<t.length;e++){const m=t[e];for(let e=0;e<m.length;e++){const t=m[e],[g,y]=t;if(c=u(c,g),d=u(d,y),p=h(p,g),f=h(f,y),i&&t.length>2){const e=t[2];s=u(s,e),o=h(o,e)}if(r&&t.length>n){const e=t[n];a=u(s,e),l=h(o,e)}}}return i?r?(e[0]=c,e[1]=d,e[2]=s,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=d,e[2]=s,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):r?(e[0]=c,e[1]=d,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=d,e[2]=p,e[3]=f,e.length=4,e)}function y(e,t,i,r,n,s){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let u=t.zmin,h=t.zmax,d=t.mmin,p=t.mmax;return n?(u=u||0,h=h||0,s?(d=d||0,p=p||0,e[0]=o,e[1]=l,e[2]=u,e[3]=d,e[4]=a,e[5]=c,e[6]=h,e[7]=p,e):(e[0]=o,e[1]=l,e[2]=u,e[3]=a,e[4]=c,e[5]=h,e)):s?(d=d||0,p=p||0,e[0]=o,e[1]=l,e[2]=d,e[3]=a,e[4]=c,e[5]=p,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function _(e,t,i,r,n,s){const o=i?3:2,a=r&&s,l=i&&n;if(!t.length||!t[0].length)return null;let c,d,p,f,[m,g]=t[0],[y,_]=t[0];for(let e=0;e<t.length;e++){const i=t[e],[r,n]=i;if(m=u(m,r),g=u(g,n),y=h(y,r),_=h(_,n),l&&i.length>2){const e=i[2];c=u(c,e),d=h(d,e)}if(a&&i.length>o){const e=i[o];p=u(c,e),f=h(d,e)}}return n?(c=c||0,d=d||0,s?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=c,e[3]=p,e[4]=y,e[5]=_,e[6]=d,e[7]=f,e):(e[0]=m,e[1]=g,e[2]=c,e[3]=y,e[4]=_,e[5]=d,e)):s?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=p,e[3]=y,e[4]=_,e[5]=f,e):(e[0]=m,e[1]=g,e[2]=y,e[3]=_,e)}},81936:(e,t,i)=>{i.d(t,{ly:()=>d,oS:()=>b,o7:()=>B,Jj:()=>j,Hz:()=>F,gK:()=>g,ey:()=>y,bj:()=>_,O1:()=>v,av:()=>A,Nu:()=>I,D_:()=>C,Eu:()=>p,q6:()=>w,or:()=>V,wA:()=>Z,Vs:()=>U,TS:()=>R,qt:()=>L,xA:()=>S,ct:()=>f,fP:()=>x,n1:()=>H,PP:()=>q,P_:()=>k,mw:()=>O,G5:()=>D,ne:()=>E,ek:()=>m,Cd:()=>T,zO:()=>G,TN:()=>W,ir:()=>z,v6:()=>P,hu:()=>N,mc:()=>M});class r{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=9;const s=this.TypedArrayConstructor;void 0===r&&(r=9*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-i)/s.BYTES_PER_ELEMENT),this.typedBufferStride=r/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let e=0;e<9;e++)t[e]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let e=0;e<9;e++)this.typedBuffer[i++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=i*t.typedBufferStride;for(let e=0;e<9;++e)r[s++]=n[o++]}get buffer(){return this.typedBuffer.buffer}}r.ElementCount=9;class n{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=16;const s=this.TypedArrayConstructor;void 0===r&&(r=16*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-i)/s.BYTES_PER_ELEMENT),this.typedBufferStride=r/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let e=0;e<16;e++)t[e]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let e=0;e<16;e++)this.typedBuffer[i++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){this.copyFromTypedBuffer(e,t.typedBuffer,i*t.typedBufferStride)}copyFromTypedBuffer(e,t,i){const r=this.typedBuffer;let n=e*this.typedBufferStride;for(let e=0;e<16;++e)r[n++]=t[i++]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=16;class s{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=1;const s=this.TypedArrayConstructor;void 0===r&&(r=s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-i)/s.BYTES_PER_ELEMENT),this.stride=r,this.typedBufferStride=r/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}s.ElementCount=1;var o=i(36531);class a{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=2;const s=this.TypedArrayConstructor;void 0===r&&(r=2*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-i)/s.BYTES_PER_ELEMENT),this.typedBufferStride=r/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,o.t8)(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=i*t.typedBufferStride;r[s++]=n[o++],r[s]=n[o]}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=2;var l=i(86717);class c{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=3;const s=this.TypedArrayConstructor;void 0===r&&(r=3*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-i)/s.BYTES_PER_ELEMENT),this.typedBufferStride=r/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,l.i)(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=i*t.typedBufferStride;r[s++]=n[o++],r[s++]=n[o++],r[s]=n[o]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=3;var u=i(56999);class h{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const s=this.TypedArrayConstructor;void 0===r&&(r=4*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-i)/s.BYTES_PER_ELEMENT),this.typedBufferStride=r/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,u.s)(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=i*t.typedBufferStride;r[s++]=n[o++],r[s++]=n[o++],r[s++]=n[o++],r[s]=n[o]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=4;class d extends s{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}static fromTypedArray(e,t){return new d(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}d.ElementType="f32";class p extends a{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class f extends c{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class m extends h{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f32";class g extends r{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f32";class y extends r{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f64";class _ extends n{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f32";class v extends n{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f64";class b extends s{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f64";class w extends a{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="f64";class x extends c{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="f64";class T extends h{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="f64";class C extends s{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u8";class S extends a{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="u8";class E extends c{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u8";class M extends h{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u8";class A extends s{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u16";class R extends a{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u16";class O extends c{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="u16";class P extends h{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="u16";class I extends s{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u32";class L extends a{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="u32";class D extends c{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class N extends h{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="u32";class F extends s{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="i8";class U extends a{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i8";class k extends c{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i8";class z extends h{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i8";class B extends s{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i16";class V extends a{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i16";class H extends c{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i16";class G extends h{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i16";class j extends s{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="i32";class Z extends a{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Z,e,t)}static fromTypedArray(e,t){return new Z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Z.ElementType="i32";class q extends c{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(q,e,t)}static fromTypedArray(e,t){return new q(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}q.ElementType="i32";class W extends h{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32"},90331:(e,t,i)=>{function r(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}i.d(t,{n1:()=>r})},18449:(e,t,i)=>{i.d(t,{$G:()=>s,NA:()=>h,Zc:()=>c,a:()=>a,tO:()=>o});var r=i(47349),n=i(38028);function s(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function o(e){return e?a(e.rings,e.hasZ??!1):null}function a(e,t){if(!e?.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let i=0,n=e.length;i<n;i++){const n=l(e[i],t,s);n&&r.push(n)}if(r.sort(((e,i)=>{let r=e[2]-i[2];return 0===r&&t&&(r=e[4]-i[4]),r})),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const r=e[0]&&e[0].length?function(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,o=0,a=0,l=0;for(let c=0,u=e.length;c<u-1;c++){const u=e[c],h=e[c+1];if(u&&h){i[0]=u[0],i[1]=u[1],r[0]=h[0],r[1]=h[1],t&&u.length>2&&h.length>2&&(i[2]=u[2],r[2]=h[2]);const e=(0,n.xA)(i,r);if(e){s+=e;const i=(0,n.Gi)(u,h);o+=e*i[0],a+=e*i[1],t&&i.length>2&&(l+=e*i[2])}}}return s>0?t?[o/s,a/s,l/s]:[o/s,a/s]:e.length?e[0]:null}(e[0],t):null;if(!r)return null;i[0]=r[0],i[1]=r[1],t&&r.length>2&&(i[2]=r[2])}return i}function l(e,t,i){let r=0,n=0,s=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,u=e.length&&t?e[0][2]:0;for(let h=0;h<e.length;h++){const d=e[h],p=e[(h+1)%e.length],[f,m,g]=d,y=f-l,_=m-c,[v,b,w]=p,x=v-l,T=b-c,C=y*T-x*_;if(o+=C,r+=(y+x)*C,n+=(_+T)*C,t&&d.length>2&&p.length>2){const e=g-u,t=w-u,i=y*t-x*e;s+=(e+t)*i,a+=i}f<i[0]&&(i[0]=f),f>i[1]&&(i[1]=f),m<i[2]&&(i[2]=m),m>i[3]&&(i[3]=m),t&&(g<i[4]&&(i[4]=g),g>i[5]&&(i[5]=g))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const h=[r/(6*o)+l,n/(6*o)+c,o];return t&&(i[4]===i[5]||0===a?(h[3]=(i[4]+i[5])/2,h[4]=0):(h[3]=s/(6*a)+u,h[4]=a)),h}function c(e,t){let i=0,r=0,n=0;e.nextPoint();const s=e.pathSize?e.x:0,o=e.pathSize?e.y:0;for(let a=0;a<e.pathSize;a++){e.seekInPath(a);const l=[e.x,e.y];e.seekInPath((a+1)%e.pathSize);const c=[e.x,e.y],[u,h]=l,d=u-s,p=h-o,[f,m]=c,g=f-s,y=m-o,_=d*y-g*p;n+=_,i+=(d+g)*_,r+=(p+y)*_,u<t[0]&&(t[0]=u),u>t[1]&&(t[1]=u),h<t[2]&&(t[2]=h),h>t[3]&&(t[3]=h)}return n>0&&(n*=-1),n?(n*=.5,[i/(6*n)+s,r/(6*n)+o,n]):null}function u(e){const{hasZ:t,totalSize:i}=e;if(0===i)return null;const s=[],o=[],a=t?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(e.reset();e.nextPath();){const t=l((0,r.l)(e),e.hasZ,a);t&&o.push(t)}if(o.sort(((e,i)=>{let r=e[2]-i[2];return 0===r&&t&&(r=e[4]-i[4]),r})),o.length&&(s[0]=o[0][0],s[1]=o[0][1],t&&(s[2]=o[0][3]),(s[0]<a[0]||s[0]>a[1]||s[1]<a[2]||s[1]>a[3]||t&&(s[2]<a[4]||s[2]>a[5]))&&(s.length=0)),!s.length){e.reset(),e.nextPath();const i=e.pathSize?function(e){const{hasZ:t}=e,i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,o=0,a=0,l=0;if(e.nextPoint()){let c=e.x,u=e.y,h=e.z;for(;e.nextPoint();){const d=e.x,p=e.y,f=e.z;i[0]=c,i[1]=u,r[0]=d,r[1]=p,t&&(i[2]=h,r[2]=f);const m=(0,n.xA)(i,r);if(m){s+=m;const e=(0,n.Gi)(i,r);o+=m*e[0],a+=m*e[1],t&&e.length>2&&(l+=m*e[2])}c=d,u=p,h=f}}return s>0?t?[o/s,a/s,l/s]:[o/s,a/s]:e.pathSize?(e.seekPathStart(),e.nextPoint(),[e.x,e.y]):null}(e):null;if(!i)return null;s[0]=i[0],s[1]=i[1],t&&i.length>2&&(s[2]=i[2])}return s}function h(e){let t=0;for(e.reset();e.nextPath();)t+=e.getCurrentRingArea();if(t<1e-6){const t=u(e);return t?[t[0],t[1]]:null}const i=[0,0];if(e.reset(),!e.nextPath()||!e.nextPoint())return null;const r=[e.x,e.y];for(e.reset();e.nextPath();)d(i,r,e);return i[0]*=1/t,i[1]*=1/t,i[0]+=r[0],i[1]+=r[1],i}function d(e,t,i){if(!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,n=i.y;i.nextPoint();let s,o=i.x-r,a=i.y-n,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-n,s=.16666666666666666*(l*a-c*o),e[0]+=s*(o+l),e[1]+=s*(a+c),o=l,a=c;const u=i.getCurrentRingArea(),h=[r,n];return h[0]-=t[0],h[1]-=t[1],h[0]*=u,h[1]*=u,e[0]+=h[0],e[1]+=h[1],e}},70740:(e,t,i)=>{i.d(t,{S$:()=>u,Ue:()=>o,Ws:()=>c,_k:()=>l,iL:()=>a});var r=i(19480),n=i(86717),s=i(97537);function o(e){return e?{ray:(0,s.Ue)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,s.Ue)(),c0:0,c1:Number.MAX_VALUE}}function a(e,t=o()){return(0,s.JG)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function l(e,t,i=o()){const r=(0,n.l)(e.vector);return(0,s.al)(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function c(e,t){return h(e,e.c0,t)}function u(e,t){return h(e,e.c1,t)}function h(e,t,i){return(0,n.g)(i,e.ray.origin,(0,n.h)(i,e.ray.direction,t))}new r.x((()=>o()))},27127:(e,t,i)=>{i.d(t,{CI:()=>u,Kv:()=>c,OQ:()=>a,Qg:()=>l,aV:()=>n,lQ:()=>s,uP:()=>o,wP:()=>h});const r=[0,0];function n(e,t){return null!=t&&c(e,t.x,t.y,t.z)}function s(e,t){if(!t.points?.length)return!1;for(const i of t.points)if(!a(e,i))return!1;return!0}function o(e,t){const{xmin:i,ymin:r,zmin:n,xmax:s,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?c(e,i,r,n)&&c(e,i,o,n)&&c(e,s,o,n)&&c(e,s,r,n)&&c(e,i,r,a)&&c(e,i,o,a)&&c(e,s,o,a)&&c(e,s,r,a):c(e,i,r)&&c(e,i,o)&&c(e,s,o)&&c(e,s,r)}function a(e,t){return c(e,t[0],t[1])}function l(e,t){return c(e,t[0],t[1],t[2])}function c(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(null==r||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function u(e,t){return r[1]=t.y,r[0]=t.x,function(e,t){return h(e.rings,t)}(e,r)}function h(e,t){if(!e)return!1;if(function(e){return!Array.isArray(e[0][0])}(e))return d(!1,e,t);let i=!1;for(let r=0,n=e.length;r<n;r++)i=d(i,e[r],t);return i}function d(e,t,i){const[r,n]=i;let s=e,o=0;for(let e=0,i=t.length;e<i;e++){o++,o===i&&(o=0);const[a,l]=t[e],[c,u]=t[o];(l<n&&u>=n||u<n&&l>=n)&&a+(n-l)/(u-l)*(c-a)<r&&(s=!s)}return s}},47190:(e,t,i)=>{i.d(t,{BR:()=>w,E2:()=>O,Is:()=>C,Kf:()=>b,NE:()=>E,P0:()=>v,Tz:()=>R,Ue:()=>d,bk:()=>f,ej:()=>x,id:()=>T,pb:()=>_,pt:()=>g,qf:()=>p,rF:()=>S,yS:()=>A});var r=i(32114),n=i(86717),s=i(81095),o=i(69442),a=i(14685),l=i(61170),c=i(19546),u=i(96739),h=i(73687);function d(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function p(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function f(e,t){return e.operations.getExtent(e.value,t),t}function m(e,t,i=function(e){return{operations:e,value:e.create()}}(e)){return i.operations=e,e.copy(t,i.value),i}function g(e){return m(h.s,(0,h.f)(0,0,0,(0,o.Iu)(e).radius))}const y=2**50;function _(){return m(u.b,(0,u.f)([0,0,0],[y,0,0],[0,y,0]))}function v(e,t,i){return e.operations.axisAt(e.value,t,c.R.Z,i)}function b(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function w(e,t,i){return e.operations.intersectRay(e.value,t,i)}function x(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function T(e,t){return e.operations.altitudeAt(e.value,t)}function C(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function S(e,t,i,s){return t!==s&&(0,r.JG)(s,t),(0,n.i)(M,s[12],s[13],s[14]),C(e,M,i,M),s[12]=M[0],s[13]=M[1],s[14]=M[2],s}function E(e,t,i){return e.operations.elevate(e.value,t,i.value)}const M=(0,s.Ue)();function A(e,t,i,r,s){return s[0]=(0,n.f)(e,t),s[1]=(0,n.f)(e,i),s[2]=(0,n.f)(e,r),s}function R(e,t,i,r,s){(0,n.c)(i,e),(0,n.c)(P,t),(0,n.n)(P,P),(0,n.e)(r,P,i),(0,n.e)(s,r,i)}function O(e,t){return e?(0,l.rS)(t):t.isGeographic?a.Z.PlateCarree:t}const P=(0,s.Ue)()},38028:(e,t,i)=>{i.d(t,{Gi:()=>d,Hu:()=>h,Pt:()=>x,Sq:()=>b,Tx:()=>c,Zy:()=>_,bu:()=>m,gQ:()=>w,n8:()=>f,nA:()=>o,nc:()=>v,ok:()=>p,pW:()=>y,r8:()=>u,xA:()=>a});var r=i(7753),n=i(19546),s=i(35925);function o(e){if(!e)return null;if(Array.isArray(e))return e;const t=e.hasZ,i=e.hasM;if("point"===e.type)return i&&t?[e.x,e.y,e.z,e.m]:t?[e.x,e.y,e.z]:i?[e.x,e.y,e.m]:[e.x,e.y];if("polygon"===e.type)return e.rings.slice();if("polyline"===e.type)return e.paths.slice();if("multipoint"===e.type)return e.points.slice();if("extent"===e.type){const t=e.clone().normalize();if(!t)return null;let i=!1,r=!1;return t.forEach((e=>{e.hasZ&&(i=!0),e.hasM&&(r=!0)})),t.map((e=>{const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(i&&e.hasZ){const i=.5*(e.zmax-e.zmin);for(let e=0;e<t.length;e++)t[e].push(i)}if(r&&e.hasM){const i=.5*(e.mmax-e.mmin);for(let e=0;e<t.length;e++)t[e].push(i)}return t}))}return null}function a(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}return Math.sqrt(i*i+r*r)}function l(e,t,i){const r=e[0]+i*(t[0]-e[0]),n=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,n,e[2]+i*(t[2]-e[2])]:[r,n]}function c(e,t,i,r){return u(e,t,i[r],i[r+1])}function u(e,t,i,r){const[n,s]=t,[o,a]=i,[l,c]=r,u=l-o,h=c-a,d=u*u+h*h,p=(n-o)*u+(s-a)*h,f=Math.min(1,Math.max(0,p/d));return e[0]=o+u*f,e[1]=a+h*f,e}function h(e,t,i,r,n,s){let o=i,a=r,l=n-o,c=s-a;if(0!==l||0!==c){const i=((e-o)*l+(t-a)*c)/(l*l+c*c);i>1?(o=n,a=s):i>0&&(o+=l*i,a+=c*i)}return l=e-o,c=t-a,l*l+c*c}function d(e,t){return l(e,t,.5)}function p(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=a(e[r],e[r+1]);return i}function f(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let n=0;n<i-1;++n){const i=a(e[n],e[n+1]);if(t-r<i){const s=(t-r)/i;return l(e[n],e[n+1],s)}r+=i}return e[i-1]}function m(e,t=n.R.X,i=n.R.Y){let r=0;const s=e.length;let o=e[0];for(let n=1;n<s;n++){const s=e[n];r+=(s[t]-o[t])*(s[i]+o[i]),o=s}if(!g(e)){const n=e[0];r+=(n[t]-o[t])*(n[i]+o[i])}return r>=0}function g(e){const t=e.length;return t<3||(0,r.fS)(e[0],e[t-1])}function y(e){"rings"in e&&(_(e),function(e){if(!("rings"in e))return!1;if(0===e.rings.length||m(e.rings[0]))return!1;for(const t of e.rings)t.reverse()}(e))}function _(e){if(!("rings"in e))return!1;let t=!1;for(const i of e.rings)g(i)||(i.push(i[0].slice()),t=!0);return t}function v(e){return"polygon"!==e.type&&"polyline"!==e.type||b("polygon"===e.type?e.rings:e.paths,e.spatialReference),e}function b(e,t){const i=(0,s.C5)(t);if(!i)return;const r=i.valid[0],n=i.valid[1],o=n-r;for(const t of e){let e=1/0,i=-1/0;for(const s of t){const t=w(s[0],r,n);e=Math.min(e,t),i=Math.max(i,t),s[0]=t}const s=i-e;o-s<s&&t.forEach((e=>{e[0]<0&&(e[0]+=o)}))}}function w(e,t,i){const r=i-t;return e<t?i-(t-e)%r:e>i?t+(e-t)%r:e}function x(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if("point"===e.type||"mesh"===e.type||"extent"===e.type)return!0;if("multipoint"===e.type)return e.points.length===t.points.length;const[i,r]="polyline"===e.type?[e.paths,t.paths]:[e.rings,t.rings];return i.length===r.length&&i.every(((e,t)=>e.length===r[t].length))}},50842:(e,t,i)=>{i.d(t,{Wn:()=>d,_w:()=>h,aO:()=>u});var r=i(79880);const n=[];function s(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function o(e,t,i,r,n,s){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:n,zmax:s}}function a(e,t,i,r,n,s){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:n,mmax:s}}function l(e,t,i,r,n,s,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:n,ymax:s,zmax:o,mmax:a}}function c(e,t=!1,i=!1){return t?i?l(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):o(e[0],e[1],e[2],e[3],e[4],e[5]):i?a(e[0],e[1],e[2],e[3],e[4],e[5]):s(e[0],e[1],e[2],e[3])}function u(e){return e?function(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}(e)?e:function(e){return void 0!==e.x&&void 0!==e.y}(e)?function(e){const{x:t,y:i,z:r,m:n}=e,c=null!=n;return null!=r?c?l(t,i,r,n,t,i,r,n):o(t,i,r,t,i,r):c?a(t,i,n,t,i,n):s(t,i,t,i)}(e):function(e){return void 0!==e.rings}(e)?h(e):function(e){return void 0!==e.paths}(e)?d(e):function(e){return void 0!==e.points}(e)?function(e){const{hasZ:t,hasM:i,points:s}=e;return c((0,r.lC)(n,s,t??!1,i??!1),t,i)}(e):null:null}function h(e){const{hasZ:t,hasM:i,rings:s}=e,o=(0,r.C6)(n,s,t??!1,i??!1);return o?c(o,t,i):null}function d(e){const{hasZ:t,hasM:i,paths:s}=e,o=(0,r.C6)(n,s,t??!1,i??!1);return o?c(o,t,i):null}},59934:(e,t,i)=>{i.d(t,{Hf:()=>g,JG:()=>y,Jp:()=>v,N9:()=>M,NQ:()=>n,Nu:()=>r,Ue:()=>m,Zr:()=>w,g8:()=>C,hr:()=>b,q_:()=>_,rN:()=>T,xu:()=>E,zq:()=>x});var r,n,s,o=i(19480),a=i(32114),l=i(86717),c=i(81095),u=i(56999),h=i(52721),d=i(70740),p=i(69430),f=i(68817);function m(e){return e?[(0,p.Ue)(e[0]),(0,p.Ue)(e[1]),(0,p.Ue)(e[2]),(0,p.Ue)(e[3]),(0,p.Ue)(e[4]),(0,p.Ue)(e[5])]:[(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)()]}function g(){return[(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)()]}function y(e,t){for(let i=0;i<M;i++)(0,p.JG)(e[i],t[i]);return e}function _(e,t,i,r=P){const n=(0,a.Jp)(f.MP.get(),t,e);(0,a.U_)(n,n);for(let e=0;e<A;++e){const t=(0,u.t)(f.o6.get(),R[e],n);(0,l.i)(r[e],t[0]/t[3],t[1]/t[3],t[2]/t[3])}v(i,r)}function v(e,t){(0,p.zk)(t[n.FAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_TOP_LEFT],e[r.LEFT]),(0,p.zk)(t[n.NEAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_RIGHT],t[n.FAR_TOP_RIGHT],e[r.RIGHT]),(0,p.zk)(t[n.FAR_BOTTOM_LEFT],t[n.FAR_BOTTOM_RIGHT],t[n.NEAR_BOTTOM_RIGHT],e[r.BOTTOM]),(0,p.zk)(t[n.NEAR_TOP_LEFT],t[n.NEAR_TOP_RIGHT],t[n.FAR_TOP_RIGHT],e[r.TOP]),(0,p.zk)(t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_RIGHT],t[n.NEAR_TOP_RIGHT],e[r.NEAR]),(0,p.zk)(t[n.FAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_LEFT],t[n.FAR_TOP_LEFT],e[r.FAR])}function b(e,t){for(let i=0;i<M;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function w(e,t){return S(e,(0,d.iL)(t,O.get()))}function x(e,t){for(let i=0;i<M;i++){const r=e[i];if(!(0,p.Er)(r,t))return!1}return!0}function T(e,t,i){return S(e,(0,d._k)(t,i,O.get()))}function C(e,t){for(let i=0;i<M;i++)if((0,p.jH)(e[i],t)>0)return!1;return!0}function S(e,t){for(let i=0;i<M;i++)if(!(0,p.oq)(e[i],t))return!1;return!0}(s=r||(r={}))[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT",s[s.BOTTOM=2]="BOTTOM",s[s.TOP=3]="TOP",s[s.NEAR=4]="NEAR",s[s.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(n||(n={}));const E={bottom:[n.FAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_LEFT,n.FAR_BOTTOM_LEFT],near:[n.NEAR_BOTTOM_LEFT,n.NEAR_BOTTOM_RIGHT,n.NEAR_TOP_RIGHT,n.NEAR_TOP_LEFT],far:[n.FAR_BOTTOM_RIGHT,n.FAR_BOTTOM_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_RIGHT],right:[n.NEAR_BOTTOM_RIGHT,n.FAR_BOTTOM_RIGHT,n.FAR_TOP_RIGHT,n.NEAR_TOP_RIGHT],left:[n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_TOP_LEFT,n.FAR_TOP_LEFT],top:[n.FAR_TOP_LEFT,n.NEAR_TOP_LEFT,n.NEAR_TOP_RIGHT,n.FAR_TOP_RIGHT]},M=6,A=8,R=[(0,h.al)(-1,-1,-1,1),(0,h.al)(1,-1,-1,1),(0,h.al)(1,1,-1,1),(0,h.al)(-1,1,-1,1),(0,h.al)(-1,-1,1,1),(0,h.al)(1,-1,1,1),(0,h.al)(1,1,1,1),(0,h.al)(-1,1,1,1)],O=new o.x(d.Ue),P=g()},36285:(e,t,i)=>{i.d(t,{Dg:()=>c,FQ:()=>s,Yr:()=>n,cD:()=>l});var r=i(14260);const n=Math.PI/180,s=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,o=r.sv.radius,a=r.sv.eccentricitySquared,l={a1:o*a,a2:o*a*o*a,a3:o*a*a/2,a4:o*a*o*a*2.5,a5:o*a+o*a*a/2,a6:1-a},c={4267:{a:6378206.4,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:r.sv.radius,f:r.sv.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:r.Z1.radius,f:r.Z1.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:r.yr.radius,f:r.yr.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:r.yr.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}}},85130:(e,t,i)=>{i.d(t,{Gb:()=>f,Jf:()=>g,Lc:()=>w,TB:()=>v,_q:()=>_,cA:()=>b,p8:()=>m});var r=i(70375),n=i(17321),s=i(7283),o=(i(10186),i(89542)),a=i(90819),l=i(14685),c=i(36285),u=i(35925);function h(e){if(!e)return null;const t=e.wkid;if(t)return c.Dg[t];const i=e.wkt2??e.wkt;return i?function(e){const t=c.FQ.exec(e);if(!t||2!==t.length)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const r=parseFloat(i[1]),n=parseFloat(i[2]);return isNaN(r)||isNaN(n)?null:{a:r,f:0===n?0:1/n}}(i):null}function d(e){const t=h(e);if(function(e){return null!=e&&"b"in e&&"eSq"in e&&"radius"in e}(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function p(e,t,i){const{a:r,eSq:n}=d(i),s=Math.sqrt(n),o=Math.sin(t[1]*c.Yr),a=r*t[0]*c.Yr;let l;return l=n>0?r*((1-n)*(o/(1-n*(o*o))-1/(2*s)*Math.log((1-s*o)/(1+s*o))))*.5:r*o,e[0]=a,e[1]=l,e}function f(e){return(0,u.sT)(e)&&!!h(e)}function m(e,t="square-meters"){if(e.some((e=>!f(e.spatialReference))))throw new r.Z("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let t=0;t<e.length;t++){const r=e[t],n=r.spatialReference,{radius:s,densificationRatio:o}=d(n),a=s*o;i.push(y(r,a))}const s=[],o=[0,0],a=[0,0];for(let e=0;e<i.length;e++){const{rings:r,spatialReference:l}=i[e];let c=0;for(let e=0;e<r.length;e++){const t=r[e];p(o,t[0],l),p(a,t[t.length-1],l);let i=a[0]*o[1]-o[0]*a[1];for(let e=0;e<t.length-1;e++)p(o,t[e+1],l),p(a,t[e],l),i+=a[0]*o[1]-o[0]*a[1];c+=i}c=(0,n.En)(c,"square-meters",t),s.push(c/-2)}return s}function g(e,t="meters"){if(!e)throw new r.Z("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some((e=>!f(e.spatialReference))))throw new r.Z("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let r=0;r<e.length;r++){const s=e[r],{spatialReference:o}=s,a="polyline"===s.type?s.paths:s.rings;let l=0;for(let e=0;e<a.length;e++){const t=a[e];let i=0;for(let e=1;e<t.length;e++){const r=t[e-1][0],n=t[e][0],s=t[e-1][1],a=t[e][1];if(s!==a||r!==n){const e=new _;b(e,[r,s],[n,a],o),i+=e.distance}}l+=i}l=(0,n.En)(l,"meters",t),i.push(l)}return i}function y(e,t){if("polyline"!==e.type&&"polygon"!==e.type)throw new r.Z("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=e;if(!f(i))throw new r.Z("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const n="polyline"===e.type?e.paths:e.rings,c=[],u=[0,0],h=new _;for(const e of n){const r=[];c.push(r),r.push([e[0][0],e[0][1]]);let n,s,o=e[0][0],a=e[0][1];for(let l=0;l<e.length-1;l++){if(n=e[l+1][0],s=e[l+1][1],o===n&&a===s)continue;const c=[o,a];b(h,[o,a],[n,s],i);const{azimuth:d,distance:p}=h,f=p/t;if(f>1){for(let e=1;e<=f-1;e++)v(u,c,d,e*t,i),r.push(u.slice());v(u,c,d,(p+Math.floor(f-1)*t)/2,i),r.push(u.slice())}v(u,c,d,p,i),r.push(u.slice()),o=u[0],a=u[1]}}const d=(0,s.TJ)(l.Z,i);return"polyline"===e.type?new a.Z({paths:c,spatialReference:d}):new o.Z({rings:c,spatialReference:d})}class _{constructor(e=0,t,i){this.distance=e,this.azimuth=t,this.reverseAzimuth=i}}function v(e,t,i,r,n){const s=t[0],o=t[1],a=s*c.Yr,l=o*c.Yr,u=(i??0)*c.Yr,{a:h,b:p,f}=d(n),m=Math.sin(u),g=Math.cos(u),y=(1-f)*Math.tan(l),_=1/Math.sqrt(1+y*y),v=y*_,b=Math.atan2(y,g),w=_*m,x=w*w,T=1-x,C=T*(h*h-p*p)/(p*p),S=1+C/16384*(4096+C*(C*(320-175*C)-768)),E=C/1024*(256+C*(C*(74-47*C)-128));let M,A,R,O=r/(p*S),P=2*Math.PI;for(;Math.abs(O-P)>1e-12;)R=Math.cos(2*b+O),M=Math.sin(O),A=Math.cos(O),P=O,O=r/(p*S)+E*M*(R+E/4*(A*(2*R*R-1)-E/6*R*(4*M*M-3)*(4*R*R-3)));const I=v*M-_*A*g,L=Math.atan2(v*A+_*M*g,(1-f)*Math.sqrt(x+I*I)),D=f/16*T*(4+f*(4-3*T)),N=Math.atan2(M*m,_*A-v*M*g)-(1-D)*f*w*(O+D*M*(R+D*A*(2*R*R-1)));return e[0]=(a+N)/c.Yr,e[1]=L/c.Yr,e}function b(e,t,i,r){const n=t[0]*c.Yr,s=t[1]*c.Yr,o=i[0]*c.Yr,a=i[1]*c.Yr,{a:l,b:u,f:h,radius:p}=d(r),f=o-n,m=Math.atan((1-h)*Math.tan(s)),g=Math.atan((1-h)*Math.tan(a)),y=Math.sin(m),_=Math.cos(m),v=Math.sin(g),b=Math.cos(g);let w,x,T,C,S,E,M,A,R,O,P=1e3,I=f;do{if(M=Math.sin(I),A=Math.cos(I),T=Math.sqrt(b*M*(b*M)+(_*v-y*b*A)*(_*v-y*b*A)),0===T)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;S=y*v+_*b*A,E=Math.atan2(T,S),R=_*b*M/T,x=1-R*R,C=S-2*y*v/x,isNaN(C)&&(C=0),O=h/16*x*(4+h*(4-3*x)),w=I,I=f+(1-O)*h*R*(E+O*T*(C+O*S*(2*C*C-1)))}while(Math.abs(I-w)>1e-12&&--P>0);if(0===P){const t=p,i=Math.acos(Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos(o-n))*t,r=o-n,l=Math.sin(r)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(r),h=Math.atan2(l,u);return e.azimuth=h/c.Yr,e.distance=i,e.reverseAzimuth=void 0,e}const L=x*(l*l-u*u)/(u*u),D=L/1024*(256+L*(L*(74-47*L)-128)),N=u*(1+L/16384*(4096+L*(L*(320-175*L)-768)))*(E-D*T*(C+D/4*(S*(2*C*C-1)-D/6*C*(4*T*T-3)*(4*C*C-3)))),F=Math.atan2(b*Math.sin(I),_*v-y*b*Math.cos(I)),U=Math.atan2(_*Math.sin(I),_*v*Math.cos(I)-y*b);return e.azimuth=F/c.Yr,e.distance=N,e.reverseAzimuth=U/c.Yr,e}function w(e){return f(e)?e:(0,u.sS)(e)?l.Z.WGS84:null}},64862:(e,t,i)=>{i.d(t,{Ku:()=>u,Wt:()=>a,qC:()=>f});i(39994);var r,n=i(70375),s=i(64307),o=i(20692);function a(e,t,i){const o=u(e),a=t,c=l(o,a,i);if(o){const t=s.Z.deriveUnitFromSR(o,e.spatialReference).heightUnit;if(!i&&t!==o.heightUnit){const e=new n.Z("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${t})`,{horizontalUnit:t});return new n.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:o,error:e})}}if(!function(e){return"heightModelInfo"in e&&null!=e.heightModelInfo||null!=e.spatialReference||!p(e)}(e)||c===r.Unsupported)return new n.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:o});switch(c){case r.Units:{const e=o?.heightUnit||"unknown",t=a?.heightUnit||"unknown",i=new n.Z("layerview:incompatible-height-unit",`The vertical units of the layer (${e}) must match the vertical units of the scene (${t})`,{layerUnit:e,sceneUnit:t});return new n.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:a,error:i})}case r.HeightModel:{const e=o?.heightModel||"unknown",t=a?.heightModel||"unknown",i=new n.Z("layerview:incompatible-height-model",`The height model of the layer (${e}) must match the height model of the scene (${t})`,{layerHeightModel:e,sceneHeightModel:t});return new n.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:a,error:i})}case r.CRS:{const e=o?.vertCRS||"unknown",t=a?.vertCRS||"unknown",i=new n.Z("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${e}) must match the vertical datum of the scene (${t})`,{layerDatum:e,sceneDatum:t});return new n.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:a,error:i})}}return null}function l(e,t,i){if(!c(e)||!c(t))return r.Unsupported;if(null==e||null==t)return r.Ok;if(!i&&e.heightUnit!==t.heightUnit)return r.Units;if(e.heightModel!==t.heightModel)return r.HeightModel;switch(e.heightModel){case"gravity-related-height":return r.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?r.Ok:r.CRS;default:return r.Unsupported}}function c(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function u(e){if("integrated-mesh-3dtiles"===e.type)return null;const t=e.url?(0,o.Qc)(e.url):void 0,i=e.spatialReference?.vcsWkid;return(null!=i||null==t||"ImageServer"!==t.serverType)&&h(e)&&e.heightModelInfo?e.heightModelInfo:p(e)?s.Z.deriveUnitFromSR(g,e.spatialReference):null}function h(e){return"heightModelInfo"in e}function d(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function p(e){return d(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):m(e)}function f(e){return null!=e.layers||m(e)||d(e)||h(e)}function m(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}!function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"}(r||(r={}));const g=new s.Z({heightModel:"gravity-related-height"})},68668:(e,t,i)=>{i.d(t,{Ff:()=>g,IY:()=>v,Nl:()=>p,UT:()=>_,h_:()=>s});var r=i(27127);function n(e,t){return(0,r.aV)(e,t)}function s(e,t){const i=e.hasZ&&t.hasZ;let r,n,s;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(n=t.ymin,e.ymax<n)return!1}else if(n=e.ymin,t.ymax<n)return!1;if(i&&t.hasZ)if(e.zmin<=t.zmin){if(s=t.zmin,e.zmax<s)return!1}else if(s=e.zmin,t.zmax<s)return!1;return!0}function o(e,t){const{points:i,hasZ:n}=t,s=n?r.Qg:r.OQ;for(const t of i)if(s(e,t))return!0;return!1}const a=[0,0],l=[0,0],c=[0,0],u=[0,0],h=[a,l,c,u],d=[[c,a],[a,l],[l,u],[u,c]];function p(e,t){return function(e,t){a[0]=e.xmin,a[1]=e.ymax,l[0]=e.xmax,l[1]=e.ymax,c[0]=e.xmin,c[1]=e.ymin,u[0]=e.xmax,u[1]=e.ymin;for(const e of h)if((0,r.wP)(t,e))return!0;for(const i of t){if(!i.length)continue;let t=i[0];if((0,r.OQ)(e,t))return!0;for(let n=1;n<i.length;n++){const s=i[n];if((0,r.OQ)(e,s)||y(t,s,d))return!0;t=s}}return!1}(e,t.rings)}function f(e,t){a[0]=e.xmin,a[1]=e.ymax,l[0]=e.xmax,l[1]=e.ymax,c[0]=e.xmin,c[1]=e.ymin,u[0]=e.xmax,u[1]=e.ymin;const i=t.paths;for(const t of i){if(!i.length)continue;let n=t[0];if((0,r.OQ)(e,n))return!0;for(let i=1;i<t.length;i++){const s=t[i];if((0,r.OQ)(e,s)||y(n,s,d))return!0;n=s}}return!1}const m=[0,0];function g(e){for(let t=0;t<e.length;t++){const i=e[t];for(let r=0;r<i.length-1;r++){const n=i[r],s=i[r+1];for(let i=t+1;i<e.length;i++)for(let t=0;t<e[i].length-1;t++){const r=e[i][t],o=e[i][t+1];if(_(n,s,r,o,m)&&!(m[0]===n[0]&&m[1]===n[1]||m[0]===r[0]&&m[1]===r[1]||m[0]===s[0]&&m[1]===s[1]||m[0]===o[0]&&m[1]===o[1]))return!0}}const r=i.length;if(!(r<=4))for(let e=0;e<r-3;e++){let t=r-1;0===e&&(t=r-2);const n=i[e],s=i[e+1];for(let r=e+2;r<t;r++){const e=i[r],t=i[r+1];if(_(n,s,e,t,m)&&!(m[0]===n[0]&&m[1]===n[1]||m[0]===e[0]&&m[1]===e[1]||m[0]===s[0]&&m[1]===s[1]||m[0]===t[0]&&m[1]===t[1]))return!0}}}return!1}function y(e,t,i){for(let r=0;r<i.length;r++)if(_(e,t,i[r][0],i[r][1]))return!0;return!1}function _(e,t,i,r,n){const[s,o]=e,[a,l]=t,[c,u]=i,[h,d]=r,p=h-c,f=s-c,m=a-s,g=d-u,y=o-u,_=l-o,v=g*m-p*_;if(0===v)return!1;const b=(p*y-g*f)/v,w=(m*y-_*f)/v;return b>=0&&b<=1&&w>=0&&w<=1&&(n&&(n[0]=s+b*(a-s),n[1]=o+b*(l-o)),!0)}function v(e){switch(e){case"esriGeometryEnvelope":case"extent":return s;case"esriGeometryMultipoint":case"multipoint":return o;case"esriGeometryPoint":case"point":return n;case"esriGeometryMultiPatch":case"multipatch":case"esriGeometryPolygon":case"polygon":return p;case"esriGeometryPolyline":case"polyline":return f}}},53736:(e,t,i)=>{i.d(t,{Ji:()=>m,YX:()=>c,aW:()=>u,im:()=>f,l9:()=>d,oU:()=>p,q9:()=>y,wp:()=>h});var r=i(91772),n=i(20031),s=i(74304),o=i(10186),a=i(89542),l=i(90819);function c(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function u(e){return void 0!==e.points}function h(e){return void 0!==e.x&&void 0!==e.y}function d(e){return void 0!==e.paths||void 0!==e.curvePaths}function p(e){return void 0!==e.rings||void 0!==e.curveRings}function f(e){return null==e?null:e instanceof n.Z?e:h(e)?o.Z.fromJSON(e):d(e)?l.Z.fromJSON(e):p(e)?a.Z.fromJSON(e):u(e)?s.Z.fromJSON(e):c(e)?r.Z.fromJSON(e):null}function m(e){return e?h(e)?"esriGeometryPoint":d(e)?"esriGeometryPolyline":p(e)?"esriGeometryPolygon":c(e)?"esriGeometryEnvelope":u(e)?"esriGeometryMultipoint":null:null}const g={esriGeometryPoint:o.Z,esriGeometryPolyline:l.Z,esriGeometryPolygon:a.Z,esriGeometryEnvelope:r.Z,esriGeometryMultipoint:s.Z,esriGeometryMultiPatch:a.Z};function y(e){return e&&g[e]||null}},56215:(e,t,i)=>{i.d(t,{AR:()=>_,Gr:()=>y,JG:()=>u,Jk:()=>p,KU:()=>m,Ue:()=>l,al:()=>h,ct:()=>g,nF:()=>f,re:()=>c,zk:()=>d});var r=i(19431),n=i(19480),s=i(86717),o=i(81095),a=i(68817);function l(e){return e?{origin:(0,o.d9)(e.origin),vector:(0,o.d9)(e.vector)}:{origin:(0,o.Ue)(),vector:(0,o.Ue)()}}function c(e,t){const i=w.get();return i.origin=e,i.vector=t,i}function u(e,t=l()){return h(e.origin,e.vector,t)}function h(e,t,i=l()){return(0,s.c)(i.origin,e),(0,s.c)(i.vector,t),i}function d(e,t,i=l()){return(0,s.c)(i.origin,e),(0,s.d)(i.vector,t,e),i}function p(e,t){const i=(0,s.d)(a.WM.get(),t,e.origin),n=(0,s.f)(e.vector,i),o=(0,s.f)(e.vector,e.vector),l=(0,r.uZ)(n/o,0,1),c=(0,s.d)(a.WM.get(),(0,s.h)(a.WM.get(),e.vector,l),i);return(0,s.f)(c,c)}function f(e,t,i){return g(e,t,0,1,i)}function m(e,t,i){return(0,s.g)(i,e.origin,(0,s.h)(i,e.vector,t))}function g(e,t,i,n,o){const{vector:l,origin:c}=e,u=(0,s.d)(a.WM.get(),t,c),h=(0,s.f)(l,u)/(0,s.k)(l);return(0,s.h)(o,l,(0,r.uZ)(h,i,n)),(0,s.g)(o,o,e.origin)}function y(e,t){if(v(e,c(t.origin,t.direction),!1,b)){const{tA:t,pB:i,distance2:r}=b;if(t>=0&&t<=1)return r;if(t<0)return(0,s.s)(e.origin,i);if(t>1)return(0,s.s)((0,s.g)(a.WM.get(),e.origin,e.vector),i)}return null}function _(e,t,i){return!!v(e,t,!0,b)&&((0,s.c)(i,b.pA),!0)}function v(e,t,i,n){const o=1e-6,l=e.origin,c=(0,s.g)(a.WM.get(),l,e.vector),u=t.origin,h=(0,s.g)(a.WM.get(),u,t.vector),d=a.WM.get(),p=a.WM.get();if(d[0]=l[0]-u[0],d[1]=l[1]-u[1],d[2]=l[2]-u[2],p[0]=h[0]-u[0],p[1]=h[1]-u[1],p[2]=h[2]-u[2],Math.abs(p[0])<o&&Math.abs(p[1])<o&&Math.abs(p[2])<o)return!1;const f=a.WM.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],Math.abs(f[0])<o&&Math.abs(f[1])<o&&Math.abs(f[2])<o)return!1;const m=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],g=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],y=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],_=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],v=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*_-g*g;if(Math.abs(v)<o)return!1;let b=(m*g-y*_)/v,w=(m+g*b)/_;i&&(b=(0,r.uZ)(b,0,1),w=(0,r.uZ)(w,0,1));const x=a.WM.get(),T=a.WM.get();return x[0]=l[0]+b*f[0],x[1]=l[1]+b*f[1],x[2]=l[2]+b*f[2],T[0]=u[0]+w*p[0],T[1]=u[1]+w*p[1],T[2]=u[2]+w*p[2],n.tA=b,n.tB=w,n.pA=x,n.pB=T,n.distance2=(0,s.s)(x,T),!0}const b={tA:0,tB:0,pA:(0,o.Ue)(),pB:(0,o.Ue)(),distance2:0},w=new n.x((()=>l()))},67262:(e,t,i)=>{i.d(t,{d:()=>s});var r=i(19431),n=i(35914);function s(e,t,i){const s=Array.isArray(e),u=s?e.length/t:e.byteLength/(4*t),h=s?e:new Uint32Array(e,0,u*t),d=i?.minReduction??0,p=i?.originalIndices||null,f=p?p.length:0,m=i?.componentOffsets||null;let g=0;if(m)for(let e=0;e<m.length-1;e++){const t=m[e+1]-m[e];t>g&&(g=t)}else g=u;const y=Math.floor(1.1*g)+1;(null==c||c.length<2*y)&&(c=new Uint32Array((0,r.Sf)(2*y)));for(let e=0;e<2*y;e++)c[e]=0;let _=0;const v=!!m&&!!p,b=v?f:u;let w=(0,n.$z)(u);const x=new Uint32Array(f),T=1.96;let C=0!==d?Math.ceil(4*T*T/(d*d)*d*(1-d)):b,S=1,E=m?m[1]:b;for(let e=0;e<b;e++){if(e===C){const t=1-_/e;if(t+T*Math.sqrt(t*(1-t)/e)<d)return null;C*=2}if(e===E){for(let e=0;e<2*y;e++)c[e]=0;if(p)for(let e=m[S-1];e<m[S];e++)x[e]=w[p[e]];E=m[++S]}const i=v?p[e]:e,r=i*t,n=l(h,r,t);let s=n%y,a=_;for(;0!==c[2*s+1];){if(c[2*s]===n){const e=c[2*s+1]-1;if(o(h,r,e*t,t)){a=w[e];break}}s++,s>=y&&(s-=y)}a===_&&(c[2*s]=n,c[2*s+1]=i+1,_++),w[i]=a}if(0!==d&&1-_/u<d)return null;if(v){for(let e=m[S-1];e<x.length;e++)x[e]=w[p[e]];w=(0,n.mi)(x)}const M=s?new Array(_):new Uint32Array(_*t);_=0;for(let e=0;e<b;e++)w[e]===_&&(a(h,(v?p[e]:e)*t,M,_*t,t),_++);if(p&&!v){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=w[p[t]];w=(0,n.mi)(e)}return{buffer:Array.isArray(M)?M:M.buffer,indices:w,uniqueCount:_}}function o(e,t,i,r){for(let n=0;n<r;n++)if(e[t+n]!==e[i+n])return!1;return!0}function a(e,t,i,r,n){for(let s=0;s<n;s++)i[r+s]=e[t+s]}function l(e,t,i){let r=0;for(let n=0;n<i;n++)r=e[t+n]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let c=null},50442:(e,t,i)=>{i.d(t,{G7:()=>h,QK:()=>c,rU:()=>u,vI:()=>d,z1:()=>a,zZ:()=>l});var r=i(86717),n=i(10186),s=i(58626),o=i(51619);function a(e){return null==e.origin}function l(e){return null!=e.origin}function c(e){return l(e.vertexSpace)}function u(e,t){if(!l(e))return null;const[i,r,s]=e.origin;return new n.Z({x:i,y:r,z:s,spatialReference:t})}function h(e,t){const{x:i,y:r,z:n,spatialReference:a}=e,l=[i,r,n??0];return"local"===(t?.vertexSpace??function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(a))?new o.Z({origin:l}):new s.Z({origin:l})}function d(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,r.p)(e.origin,t.origin))}},29927:(e,t,i)=>{i.d(t,{it:()=>E,wK:()=>S,aX:()=>C,or:()=>M,hR:()=>b});var r=i(51366),n=i(70375),s=i(13802),o=i(89542),a=i(90819),l=i(25266),c=i(35925),u=i(39536),h=i(66341),d=i(53736),p=i(84238);var f=i(3466),m=i(5167);const g=()=>s.Z.getLogger("esri.geometry.support.normalizeUtils");function y(e){return"polygon"===e[0].type}function _(e){return"polyline"===e[0].type}function v(e){const t=[];let i=0,r=0;for(let n=0;n<e.length;n++){const s=e[n];let o=null;for(let e=0;e<s.length;e++)o=s[e],t.push(o),0===e?(i=o[0],r=i):(i=Math.min(i,o[0]),r=Math.max(r,o[0]));o&&t.push([(i+r)/2,0])}return t}function b(e,t){if(!(e instanceof a.Z||e instanceof o.Z)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw g().error(e),new n.Z(e)}const i=(0,l.x3)(e),r=[];for(const e of i){const i=[];r.push(i),i.push([e[0][0],e[0][1]]);for(let r=0;r<e.length-1;r++){const n=e[r][0],s=e[r][1],o=e[r+1][0],a=e[r+1][1],l=Math.sqrt((o-n)*(o-n)+(a-s)*(a-s)),c=(a-s)/l,u=(o-n)/l,h=l/t;if(h>1){for(let e=1;e<=h-1;e++){const r=e*t,o=u*r+n,a=c*r+s;i.push([o,a])}const e=(l+Math.floor(h-1)*t)/2,r=u*e+n,o=c*e+s;i.push([r,o])}i.push([o,a])}}return function(e){return"polygon"===e.type}(e)?new o.Z({rings:r,spatialReference:e.spatialReference}):new a.Z({paths:r,spatialReference:e.spatialReference})}function w(e,t,i){if(t){const t=b(e,1e6);e=(0,u.Sx)(t,!0)}return i&&(e=(0,l.Sy)(e,i)),e}function x(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const i=(0,l.XZ)(r,t);e[0]=r+i*(-2*t)}else if(r<i){const t=(0,l.XZ)(r,i);e[0]=r+t*(-2*i)}}else{const r=e.x;if(r>t){const i=(0,l.XZ)(r,t);e=e.clone().offset(i*(-2*t),0)}else if(r<i){const t=(0,l.XZ)(r,i);e=e.clone().offset(t*(-2*i),0)}}return e}function T(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const n=t.cutIndexes[r],s=t.geometries[r],o=(0,l.x3)(s);for(let e=0;e<o.length;e++){const t=o[e];t.some((i=>{if(i[0]<180)return!0;{let i=0;for(let e=0;e<t.length;e++){const r=t[e][0];i=r>i?r:i}i=Number(i.toFixed(9));const r=-360*(0,l.XZ)(i,180);for(let i=0;i<t.length;i++){const t=s.getPoint(e,i);s.setPoint(e,i,t.clone().offset(r,0))}return!0}}))}if(n===i){if(y(e))for(const t of(0,l.x3)(s))e[n]=e[n].addRing(t);else if(_(e))for(const t of(0,l.x3)(s))e[n]=e[n].addPath(t)}else i=n,e[n]=s}return e}async function C(e,t,i){if(!Array.isArray(e))return C([e],t);t&&"string"!=typeof t&&g().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const n="string"==typeof t?t:t?.url??r.Z.geometryServiceUrl;let s,y,_,v,b,S,E,M,A=0;const R=[],O=[];for(const t of e)if(null!=t)if(s||(s=t.spatialReference,y=(0,c.C5)(s),_=s.isWebMercator,S=_?102100:4326,v=l.UZ[S].maxX,b=l.UZ[S].minX,E=l.UZ[S].plus180Line,M=l.UZ[S].minus180Line),y)if("mesh"===t.type)O.push(t);else if("point"===t.type)O.push(x(t.clone(),v,b));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>x(e,v,b))),O.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,y);O.push(e.rings?new o.Z(e):e)}else if(t.extent){const e=t.extent,i=(0,l.XZ)(e.xmin,b)*(2*v);let r=0===i?t.clone():(0,l.Sy)(t.clone(),i);e.offset(i,0);let{xmin:n,xmax:s}=e;n=Number(n.toFixed(9)),s=Number(s.toFixed(9)),e.intersects(E)&&s!==v?(A=s>A?s:A,r=w(r,_),R.push(r),O.push("cut")):e.intersects(M)&&n!==b?(A=s*(2*v)>A?s*(2*v):A,r=w(r,_,360),R.push(r),O.push("cut")):O.push(r)}else O.push(t.clone());else O.push(t);else O.push(t);let P=(0,l.XZ)(A,v),I=-90;const L=P,D=new a.Z;for(;P>0;){const e=360*P-180;D.addPath([[e,I],[e,-1*I]]),I*=-1,P--}if(R.length>0&&L>0){const t=T(R,await async function(e,t,i,r){const n=(0,p.en)(e),s=t[0].spatialReference,o={...r,responseType:"json",query:{...n.query,f:"json",sr:(0,c.B9)(s),target:JSON.stringify({geometryType:(0,d.Ji)(t[0]),geometries:t}),cutter:JSON.stringify(i)}},a=await(0,h.Z)(n.path+"/cut",o),{cutIndexes:l,geometries:u=[]}=a.data;return{cutIndexes:l,geometries:u.map((e=>{const t=(0,d.im)(e);return t.spatialReference=s,t}))}}(n,R,D,i)),r=[],s=[];for(let i=0;i<O.length;i++){const n=O[i];if("cut"!==n)s.push(n);else{const n=t.shift(),o=e[i];null!=o&&"polygon"===o.type&&o.rings&&o.rings.length>1&&n.rings.length>=o.rings.length?(r.push(n),s.push("simplify")):s.push(_?(0,u.$)(n):n)}}if(!r.length)return s;const o=await async function(e,t,i){const r="string"==typeof e?(0,f.mN)(e):e,n=t[0].spatialReference,s=(0,d.Ji)(t[0]),o={...i,query:{...r.query,f:"json",sr:(0,c.B9)(n),geometries:JSON.stringify((0,m.F)(t))}},{data:a}=await(0,h.Z)(r.path+"/simplify",o);return(0,m.o)(a.geometries,s,n)}(n,r,i),a=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?a.push(t):a.push(_?(0,u.$)(o.shift()):o.shift())}return a}const N=[];for(let e=0;e<O.length;e++){const t=O[e];if("cut"!==t)N.push(t);else{const e=R.shift();N.push(!0===_?(0,u.$)(e):e)}}return N}function S(e){if(!e)return null;const t=e.extent;if(!t)return null;const i=e.spatialReference&&(0,c.C5)(e.spatialReference);if(!i)return t;const[r,n]=i.valid,s=2*n,{width:o}=t;let a,{xmin:l,xmax:u}=t;if([l,u]=[u,l],"extent"===e.type||0===o||o<=n||o>s||l<r||u>n)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;a=v(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;a=v(e.paths);break;case"multipoint":a=e.points}const h=t.clone();for(let e=0;e<a.length;e++){let t=a[e][0];t<0?(t+=n,u=Math.max(t,u)):(t-=n,l=Math.min(t,l))}return h.xmin=l,h.xmax=u,h.width<o?(h.xmin-=n,h.xmax-=n,h):t}function E(e,t,i){const r=(0,c.C5)(i);if(null==r)return e;const[n,s]=r.valid,o=2*s;let a=0,l=0;t>s?a=Math.ceil(Math.abs(t-s)/o):t<n&&(a=-Math.ceil(Math.abs(t-n)/o)),e>s?l=Math.ceil(Math.abs(e-s)/o):e<n&&(l=-Math.ceil(Math.abs(e-n)/o));let u=e+(a-l)*o;const h=u-t;return h>s?u-=o:h<n&&(u+=o),u}function M(e,t){const i=(0,c.C5)(t);if(i){const[t,r]=i.valid,n=r-t;if(e<t)for(;e<t;)e+=n;if(e>r)for(;e>r;)e-=n}return e}},25266:(e,t,i)=>{i.d(t,{Sy:()=>l,UZ:()=>o,XZ:()=>a,x3:()=>c});var r=i(90819),n=i(14685),s=i(53736);const o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new r.Z({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:n.Z.WebMercator}),minus180Line:new r.Z({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:n.Z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new r.Z({paths:[[[180,-180],[180,180]]],spatialReference:n.Z.WGS84}),minus180Line:new r.Z({paths:[[[-180,-180],[-180,180]]],spatialReference:n.Z.WGS84})}};function a(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const i=c(e);for(const e of i)for(const i of e)i[0]+=t;return e}function c(e){return(0,s.oU)(e)?e.rings:e.paths}},69430:(e,t,i)=>{i.d(t,{Ac:()=>I,BR:()=>R,Er:()=>D,JG:()=>h,Kt:()=>z,Oy:()=>f,Qi:()=>V,T5:()=>S,TE:()=>U,Ue:()=>c,Yq:()=>m,al:()=>p,dZ:()=>P,fn:()=>A,jH:()=>k,my:()=>M,nF:()=>N,nI:()=>_,oq:()=>L,oy:()=>G,re:()=>u,rx:()=>O,st:()=>d,tk:()=>E,tx:()=>F,zk:()=>g,zu:()=>y});var r=i(19431),n=i(86717),s=i(81095),o=(i(56999),i(5700)),a=i(68817),l=i(35369);function c(e=H){return[e[0],e[1],e[2],e[3]]}function u(e=H[0],t=H[1],i=H[2],r=H[3]){return p(e,t,i,r,a.o6.get())}function h(e,t){return p(t[0],t[1],t[2],t[3],e)}function d(e){return e}function p(e,t,i,r,n=c()){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function f(e,t,i){return(0,n.c)(i,e),i[3]=t,i}function m(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function g(e,t,i,r=c()){const n=i[0]-t[0],s=i[1]-t[1],o=i[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],u=e[2]-t[2],h=s*u-o*l,d=o*a-n*u,p=n*l-s*a,f=h*h+d*d+p*p,m=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;return r[0]=h*m,r[1]=d*m,r[2]=p*m,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function y(e,t,i,r=0,s=Math.floor(i*(1/3)),o=Math.floor(i*(2/3))){if(i<3)return!1;t(b,r);let a=s,l=!1;for(;a<i-1&&!l;)t(w,a),a++,l=!(0,n.p)(b,w);if(!l)return!1;for(a=Math.max(a,o),l=!1;a<i&&!l;)t(x,a),a++,(0,n.d)(T,b,w),(0,n.n)(T,T),(0,n.d)(C,w,x),(0,n.n)(C,C),l=!(0,n.p)(b,x)&&!(0,n.p)(w,x)&&Math.abs((0,n.f)(T,C))<v;return l?(g(b,w,x,e),!0):(0!==r||1!==s||2!==o)&&y(e,t,i,0,1,2)}function _(e,t,i=!0){const r=t.length/3;return y(e,((e,i)=>(0,n.i)(e,t[3*i+0],t[3*i+1],t[3*i+2])),i?r-1:r)}const v=.99619469809,b=(0,s.Ue)(),w=(0,s.Ue)(),x=(0,s.Ue)(),T=(0,s.Ue)(),C=(0,s.Ue)();function S(e,t,i){return t!==e&&h(e,t),e[3]=-(0,n.f)(e,i),e}function E(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function M(e,t,i,r){return(0,n.e)(x,t,e),m(i,x,r)}function A(e,t,i,r){return B(V(e,t,(0,n.d)(a.WM.get(),i,t),j,r))}function R(e,t,i){return null!=t&&B(V(e,t.origin,t.direction,Z,i))}function O(e,t,i){return B(V(e,t.origin,t.vector,G.NONE,i))}function P(e,t,i){return B(V(e,t.origin,t.vector,G.CLAMP,i))}function I(e,t){return k(e,t)>=0}function L(e,t){const i=(0,n.f)(e,t.ray.direction),r=-k(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function D(e,t){const i=(0,n.f)(e,t.ray.direction),r=-k(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function N(e,t,i){const r=(0,n.h)(a.WM.get(),e,-e[3]),s=function(e,t,i){const r=(0,n.h)(a.WM.get(),e,(0,n.f)(e,t));return(0,n.d)(i,t,r),i}(e,(0,n.d)(a.WM.get(),t,r),a.WM.get());return(0,n.g)(i,s,r),i}function F(e,t,i,r){const s=e,c=a.WM.get(),u=a.WM.get();(0,l._F)(s,c,u);const h=(0,n.d)(a.WM.get(),i,t),d=(0,o.SR)(c,h),p=(0,o.SR)(u,h),f=(0,o.SR)(s,h);return(0,n.i)(r,d,p,f)}function U(e,t){return Math.abs(k(e,t))}function k(e,t){return(0,n.f)(e,t)+e[3]}var z;function B(e){return e===z.INTERSECTS_INSIDE_OUT||e===z.INTERSECTS_OUTSIDE_IN}function V(e,t,i,s,o){const a=(0,n.f)(e,i),l=k(e,t);if(0===a)return l>=0?z.INSIDE:z.OUTSIDE;let c=-l/a;return s&G.CLAMP&&(c=(0,r.uZ)(c,0,1)),!(s&G.INFINITE_MIN)&&c<0||!(s&G.INFINITE_MAX)&&c>1?l>=0?z.INSIDE:z.OUTSIDE:((0,n.g)(o,t,(0,n.h)(o,i,c)),l>=0?z.INTERSECTS_INSIDE_OUT:z.INTERSECTS_OUTSIDE_IN)}!function(e){e[e.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT",e[e.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN",e[e.INSIDE=2]="INSIDE",e[e.OUTSIDE=3]="OUTSIDE"}(z||(z={}));const H=[0,0,1,0];var G;!function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"}(G||(G={}));const j=G.INFINITE_MIN|G.INFINITE_MAX,Z=G.INFINITE_MAX},18649:(e,t,i)=>{i.d(t,{$L:()=>a,MW:()=>l,TE:()=>s,c6:()=>o});var r=i(35925),n=i(39536);function s(e,t){const i=e.x-t.x,r=e.y-t.y,n=null!=e.z&&null!=t.z?e.z-t.z:0;return Math.sqrt(i*i+r*r+n*n)}function o(e){return l(e,c)?.[0]??null}function a(e){return l(e,c)?.[1]??null}function l({x:e,y:t,spatialReference:i},s=[0,0]){if(i){if((0,r.sS)(i))return(0,n.R6)(e,t,s);if((0,r.sT)(i))return s[0]=e,s[1]=t,s}return null}const c=[0,0]},39393:(e,t,i)=>{i.d(t,{i:()=>l});var r=i(19431),n=i(17321),s=i(86717),o=i(19546),a=i(69430);function l(e,t,i){const l=function(e,t,i,r){const o=(e=>!Array.isArray(e[0]))(t)?(e,i)=>t[3*e+i]:(e,i)=>t[e][i],l=r?(0,n.c9)(r)/(0,n._R)(r):1;return(0,a.zu)(e,((e,t)=>(0,s.i)(e,o(t,0)*l,o(t,1)*l,o(t,2))),i)}(c,e,t,i)?(0,a.st)(c):[0,0,1];return Math.abs(l[2])>Math.cos((0,r.Vl)(80))?o.R.Z:Math.abs(l[1])>Math.abs(l[0])?o.R.Y:o.R.X}const c=(0,a.Ue)()},7505:(e,t,i)=>{i.d(t,{G6:()=>O,IN:()=>o,Ie:()=>R,J9:()=>M,Jd:()=>s,Kq:()=>S,RF:()=>C,U1:()=>A,oh:()=>n,s9:()=>E,vY:()=>r});i(53736);function r(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function n(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:i,translate:r}=e,n=i[0]??1,s=i[1]??1;return{originPosition:"lowerLeft",scale:[n,"lowerLeft"===t?s:-s,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function s({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function o({scale:e,translate:t},i){return Math.round((i-t[1])/e[1])}function a({scale:e,translate:t},i){return Math.round(((i??0)-t[2])/e[2])}function l({scale:e,translate:t},i){return i?Math.round((i-t[3])/e[3]):0}function c(e,t){return e&&t?p:e&&!t?h:!e&&t?d:u}const u=(e,t)=>{const i=[];if(!t.length)return null;const r=t[0];let n=s(e,r[0]),a=o(e,r[1]);i.push([n,a]);for(let r=1;r<t.length;r++){const[l,c]=t[r],u=s(e,l),h=o(e,c);u===n&&h===a||i.push([u-n,h-a]),n=u,a=h}return i},h=(e,t)=>{const i=[];if(!t.length)return null;const r=t[0];let n=s(e,r[0]),l=o(e,r[1]),c=a(e,r[2]);i.push([n,l,c]);for(let r=1;r<t.length;r++){const[u,h,d]=t[r],p=s(e,u),f=o(e,h),m=a(e,d);p===n&&f===l&&m===c||i.push([p-n,f-l,m]),n=p,l=f,c=m}return i},d=(e,t)=>{const i=[];if(!t.length)return null;const r=t[0];let n=s(e,r[0]),a=o(e,r[1]),c=l(e,r[2]);i.push([n,a,c]);for(let r=1;r<t.length;r++){const[u,h,d]=t[r],p=s(e,u),f=o(e,h),m=l(e,d);p===n&&f===a&&m===c||i.push([p-n,f-a,m]),n=p,a=f,c=m}return i},p=(e,t)=>{const i=[];if(!t.length)return null;const r=t[0];let n=s(e,r[0]),c=o(e,r[1]),u=a(e,r[2]),h=l(e,r[3]);i.push([n,c,u,h]);for(let r=1;r<t.length;r++){const[d,p,f,m]=t[r],g=s(e,d),y=o(e,p),_=a(e,f),v=l(e,m);g===n&&y===c&&_===u&&v===h||i.push([g-n,y-c,_,v]),n=g,c=y,u=_,h=v}return i};function f({scale:e,translate:t},i){return i*e[0]+t[0]}function m({scale:e,translate:t},i){return i*e[1]+t[1]}function g({scale:e,translate:t},i){return(i??0)*e[2]+t[2]}function y({scale:e,translate:t},i){return i?i*e[3]+t[3]:0}function _(e,t){return e&&t?x:e&&!t?b:!e&&t?w:v}const v=(e,t)=>{const i=new Array(t.length);if(!t.length)return i;const r=t[0];let n=f(e,r[0]),s=m(e,r[1]);i[0]=[n,s];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let e=1;e<t.length;e++){const[r,o]=t[e];n+=l*r,s+=c*o,i[e]=[n,s]}return i},b=(e,t)=>{const i=new Array(t.length);if(!t.length)return i;const r=t[0];let n=f(e,r[0]),s=m(e,r[1]);i[0]=[n,s,g(e,r[2])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let r=1;r<t.length;r++){const[o,a,u]=t[r];n+=l*o,s+=c*a,i[r]=[n,s,g(e,u)]}return i},w=(e,t)=>{const i=new Array(t.length);if(!t.length)return i;const r=t[0];let n=f(e,r[0]),s=m(e,r[1]);i[0]=[n,s,y(e,r[2])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let r=1;r<t.length;r++){const[o,a,u]=t[r];n+=l*o,s+=c*a,i[r]=[n,s,y(e,u)]}return i},x=(e,t)=>{const i=new Array(t.length);if(!t.length)return i;const r=t[0];let n=f(e,r[0]),s=m(e,r[1]);i[0]=[n,s,g(e,r[2]),y(e,r[3])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let r=1;r<t.length;r++){const[o,a,u,h]=t[r];n+=l*o,s+=c*a,i[r]=[n,s,g(e,u),y(e,h)]}return i};function T(e,t,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=t(e,i[n]);return r}function C(e,t,i){const r=n(e);return t.x=s(r,i.x),t.y=o(r,i.y),null!=i.z&&(t.z=a(r,i.z)),null!=i.m&&(t.m=l(r,i.m)),t}function S(e,t,i){const r=function(e,t,i,r){const n=[],s=c(i,r);for(let i=0;i<t.length;i++){const r=s(e,t[i]);r&&r.length>=3&&n.push(r)}return n.length?n:null}(n(e),i.rings,i.hasZ,i.hasM);return r?(t.rings=r,t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t):null}function E(e,t,i){const r=function(e,t,i,r){const n=[],s=c(i,r);for(let i=0;i<t.length;i++){const r=s(e,t[i]);r&&r.length>=2&&n.push(r)}return n.length?n:null}(n(e),i.paths,i.hasZ,i.hasM);return r?(t.paths=r,t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t):null}function M(e,t,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(null!=i){const o=n(e);t.points=_(r,s)(o,i.points),t.hasZ=r,t.hasM=s}return t}function A(e,t,i,r=null!=i?.z,s=null!=i?.m){if(null==i)return t;const o=n(e);return t.x=f(o,i.x),t.y=m(o,i.y),r&&(t.z=g(o,i.z)),s&&(t.m=y(o,i.m)),t}function R(e,t,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(null!=i){const o=n(e);t.rings=T(o,_(r,s),i.rings),t.hasZ=r,t.hasM=s}return t}function O(e,t,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(null!=i){const o=n(e);t.paths=T(o,_(r,s),i.paths),t.hasZ=r,t.hasM=s}return t}},97537:(e,t,i)=>{i.d(t,{JG:()=>f,JI:()=>_,Jk:()=>y,Ue:()=>u,_w:()=>v,al:()=>g,fS:()=>d,re:()=>p,zk:()=>m});var r=i(7753),n=i(19480),s=i(46332),o=i(3965),a=i(86717),l=i(81095),c=i(68817);function u(e){return e?h((0,l.d9)(e.origin),(0,l.d9)(e.direction)):h((0,l.Ue)(),(0,l.Ue)())}function h(e,t){return{origin:e,direction:t}}function d(e,t){return(0,r.fS)(e.origin,t.origin)&&(0,r.fS)(e.direction,t.direction)}function p(e,t){const i=b.get();return i.origin=e,i.direction=t,i}function f(e,t=u()){return g(e.origin,e.direction,t)}function m(e,t,i=u()){return(0,a.c)(i.origin,e),(0,a.d)(i.direction,t,e),i}function g(e,t,i=u()){return(0,a.c)(i.origin,e),(0,a.c)(i.direction,t),i}function y(e,t){const i=(0,a.e)(c.WM.get(),(0,a.n)(c.WM.get(),e.direction),(0,a.d)(c.WM.get(),t,e.origin));return(0,a.f)(i,i)}function _(e,t,i){const r=(0,a.f)(e.direction,(0,a.d)(i,t,e.origin));return(0,a.g)(i,e.origin,(0,a.h)(i,e.direction,r)),i}function v(e,t,i,r){const n=e.origin,o=t.origin,l=e.direction,c=t.direction,u=(0,a.f)((0,a.n)(x,l),(0,a.n)(T,c));if(Math.abs(u)>=1)return null;const h=(0,a.e)(x,l,c),d=(0,a.a)(w,o,n),p=(0,s.t8)(C,l[0],l[1],l[2],-c[0],-c[1],-c[2],h[0],h[1],h[2]),f=(0,s.U_)(C,p);if(null==f)return[i,r];const m=(0,a.f)((0,a.i)(x,f[0],f[3],f[6]),d),g=(0,a.f)((0,a.i)(T,f[1],f[4],f[7]),d);return(0,a.g)(i,n,(0,a.h)(w,l,m)),(0,a.g)(r,o,(0,a.h)(w,c,g)),[i,r]}const b=new n.x((()=>u())),w=(0,l.Ue)(),x=(0,l.Ue)(),T=(0,l.Ue)(),C=(0,o.Ue)()},68577:(e,t,i)=>{i.d(t,{DE:()=>a,Nf:()=>c,dp:()=>o,o2:()=>l,yZ:()=>s});var r=i(19431),n=i(17321);function s(e,t){const i=t||e.extent,r=e.width,s=(0,n.c9)(i?.spatialReference);return i&&r?i.width/r*s*n.hd*96:0}function o(e,t){return e/((0,n.c9)(t)*n.hd*96)}function a(e){return e/(96*n.hd)}function l(e,t,i){return function(e,t){return 0===t||(0,r.W8)(e,t)||e<t}(e,t)&&function(e,t){return 0===t||(0,r.W8)(e,t)||e>t}(e,i)}function c(e,t){return(0,r.W8)(e,t)?0:(e||Number.POSITIVE_INFINITY)>(t||Number.POSITIVE_INFINITY)?1:-1}},35925:(e,t,i)=>{i.d(t,{B9:()=>f,BZ:()=>T,C5:()=>p,DK:()=>l,IU:()=>R,JY:()=>M,ME:()=>C,MP:()=>E,N$:()=>g,QM:()=>w,V2:()=>S,YU:()=>A,fS:()=>d,o$:()=>x,oR:()=>y,sS:()=>b,sT:()=>m,xO:()=>O,xl:()=>_,yW:()=>v});var r=i(21130),n=(i(96926),i(52345)),s=i(36644);const o=[102100,102113,3857,3785,900913],a=[4326,...o,104905,104971],l=[-20037508.342788905,20037508.342788905],c=[-20037508.342787,20037508.342787],u={wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:l,origin:c,dx:1e-5},h={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:l,origin:c,dx:1e-5},102100:u,3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:l,origin:c,dx:1e-5},3857:u,4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},900913:u};function d(e,t){if(e===t)return!0;if(null==e||null==t)return!1;const i=e.wkid,r=t.wkid;if(null!=i||null!=r){if(i===r)return!0;if(b(e)&&b(t))return!0;const n=e.latestWkid;if(null!=n&&r===n)return!0;const s=t.latestWkid;return null!=s&&i===s}let n,s;return e.wkt2&&t.wkt2?(n=e.wkt2,s=t.wkt2):e.wkt&&t.wkt&&(n=e.wkt,s=t.wkt),!(!n||!s)&&n.toUpperCase()===s.toUpperCase()}function p(e){const t=e?.wkid;return null!=t&&t>=2e3&&h[t]||null}function f(e){if(!e)return;const{wkid:t,vcsWkid:i}=e;if(t)return i?JSON.stringify({wkid:t,vcsWkid:i}):String(t);const r=e.wkt||e.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function m(e){if(!M(e))return!1;const{wkid:t}=e;if(t)return null==s.Z[t];const i=e.wkt2||e.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function g(e){return!(T(e)||S(e))}function y(e){return 4326===e?.wkid}function _(e){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(e)}function v(e){return e?.wkid===n.W.CGCS2000}function b(e){const t=e?.wkid;return null!=t&&t>=2e3&&o.includes(t)}function w(e){return 32662===e?.wkid}function x(e){return e===n.W.GCSMARS2000||e===n.W.GCSMARS2000_SPHERE}function T(e){return x(e?.wkid)}function C(e){return e===n.W.GCSMOON2000}function S(e){return C(e?.wkid)}function E(e){const t=e?.wkid;return null!=t&&t>=2e3&&a.includes(t)}function M(e){if(null==e)return!1;const t=e.wkid;return null!=t&&t>=2e3||null!=e.wkt2||null!=e.wkt}const A={wkid:4326,wkt:(0,r.gx)(h[4326].wkTemplate,{Central_Meridian:"0.0"})},R={wkid:102100,latestWkid:3857},O={wkid:32662}},42772:(e,t,i)=>{i.d(t,{bE:()=>c,wu:()=>l});var r=i(19480),n=i(86717),s=i(81095),o=i(56215);i(68817);function a(e){return e?{p0:(0,s.d9)(e.p0),p1:(0,s.d9)(e.p1),p2:(0,s.d9)(e.p2)}:{p0:(0,s.Ue)(),p1:(0,s.Ue)(),p2:(0,s.Ue)()}}function l(e,t,i){const r=t[0]-e[0],n=t[1]-e[1],s=i[0]-e[0],o=i[1]-e[1];return.5*Math.abs(r*o-n*s)}function c(e,t,i){return(0,n.d)(u,t,e),(0,n.d)(h,i,e),.5*(0,n.l)((0,n.e)(u,u,h))}new r.x(o.Ue),new r.x((()=>a()));const u=(0,s.Ue)(),h=(0,s.Ue)()},35413:(e,t,i)=>{i.d(t,{Ni:()=>d,ZI:()=>r,bT:()=>h});var r,n=i(5992),s=i(19546),o=i(38028),a=i(92570),l=i(35914),c=i(39393),u=i(67262);function h(e){const t=d(e.rings,e.hasZ,r.CCW_IS_HOLE,e.spatialReference),i=new Array;let s=0,o=0;for(const e of t.polygons){const r=e.count,c=e.index,u=(0,a.Rq)(t.position,3*c,3*r),h=e.holeIndices.map((e=>e-c)),d=(0,l.mi)((0,n.e)(u,h,3));i.push({position:u,faces:d}),s+=u.length,o+=d.length}const c=function(e,t,i){if(1===e.length)return e[0];const r=(0,a.bg)(t),n=new Array(i);let s=0,o=0,c=0;for(const t of e){for(let e=0;e<t.position.length;e++)r[s++]=t.position[e];for(const e of t.faces)n[o++]=e+c;c=s/3}return{position:r,faces:(0,l.mi)(n)}}(i,s,o),h=Array.isArray(c.position)?(0,u.d)(c.position,3,{originalIndices:c.faces}):(0,u.d)(c.position.buffer,6,{originalIndices:c.faces});return c.position=(0,a.QZ)(new Float64Array(h.buffer)),c.faces=h.indices,c}function d(e,t,i,n){const s=e.length,o=new Array(s),l=new Array(s),c=new Array(s);let u=0;for(let t=0;t<s;++t)u+=e[t].length;let h=0,d=0,m=0;const g=(0,a.bg)(3*u);let y=0;for(let a=s-1;a>=0;a--){const u=e[a],_=i===r.CCW_IS_HOLE&&f(u,t,n);if(_&&1!==s)o[h++]=u;else{let e=u.length;for(let t=0;t<h;++t)e+=o[t].length;const i={index:y,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};i.pathLengths[0]=u.length,u.length>0&&(c[m++]={index:y,count:u.length}),y=_?p(u,u.length-1,-1,g,y,u.length,t):p(u,0,1,g,y,u.length,t);for(let e=0;e<h;++e){const r=o[e];i.holeIndices[e]=y,i.pathLengths[e+1]=r.length,r.length>0&&(c[m++]={index:y,count:r.length}),y=p(r,0,1,g,y,r.length,t)}h=0,i.count>0&&(l[d++]=i)}}for(let e=0;e<h;++e){const i=o[e];i.length>0&&(c[m++]={index:y,count:i.length}),y=p(i,0,1,g,y,i.length,t)}return l.length=d,c.length=m,{position:g,polygons:l,outlines:c}}function p(e,t,i,r,n,s,o){n*=3;for(let a=0;a<s;++a){const s=e[t];r[n++]=s[0],r[n++]=s[1],r[n++]=o&&s[2]?s[2]:0,t+=i}return n/3}function f(e,t,i){if(!t)return!(0,o.bu)(e);const r=e.length-1;switch((0,c.i)(e,r,i)){case s.R.X:return!(0,o.bu)(e,s.R.Y,s.R.Z);case s.R.Y:return!(0,o.bu)(e,s.R.X,s.R.Z);case s.R.Z:return!(0,o.bu)(e,s.R.X,s.R.Y)}}!function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(r||(r={}))},59659:(e,t,i)=>{i.d(t,{Mk:()=>u,P$:()=>h,qM:()=>d});var r=i(25709),n=i(91772),s=i(20031),o=i(74304),a=i(10186),l=i(89542),c=i(90819);const u=(0,r.w)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),h=(0,r.w)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),d={base:s.Z,key:"type",typeMap:{extent:n.Z,multipoint:o.Z,point:a.Z,polyline:c.Z,polygon:l.Z}}},5700:(e,t,i)=>{i.d(t,{EU:()=>l,SR:()=>a,cp:()=>c,nF:()=>o});var r=i(19431),n=i(86717),s=i(81095);function o(e,t,i){const r=(0,n.f)(e,t)/(0,n.f)(e,e);return(0,n.h)(i,e,r)}function a(e,t){return(0,n.f)(e,t)/(0,n.l)(e)}function l(e,t){const i=(0,n.f)(e,t)/((0,n.l)(e)*(0,n.l)(t));return-(0,r.ZF)(i)}function c(e,t,i){(0,n.n)(u,e),(0,n.n)(h,t);const s=(0,n.f)(u,h),o=(0,r.ZF)(s),a=(0,n.e)(u,u,h);return(0,n.f)(a,i)<0?2*Math.PI-o:o}const u=(0,s.Ue)(),h=(0,s.Ue)()},68817:(e,t,i)=>{i.d(t,{MP:()=>f,vD:()=>m,qW:()=>h,WM:()=>d,o6:()=>p});i(39994);var r=i(66581),n=i(3965),s=i(3308),o=i(96303),a=i(84164),l=i(81095),c=i(52721);class u{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&(0,r.Y)((()=>this._reset())),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new u(a.Ue)}static createVec3f64(){return new u(l.Ue)}static createVec4f64(){return new u(c.Ue)}static createMat3f64(){return new u(n.Ue)}static createMat4f64(){return new u(s.Ue)}static createQuatf64(){return new u(o.Ue)}get test(){}}const h=u.createVec2f64(),d=u.createVec3f64(),p=u.createVec4f64(),f=(u.createMat3f64(),u.createMat4f64()),m=u.createQuatf64()},39536:(e,t,i)=>{i.d(t,{$:()=>v,Q8:()=>m,R6:()=>_,Sx:()=>b,hG:()=>y,iV:()=>g,mZ:()=>h,tp:()=>u});var r=i(67134),n=i(93138),s=i(14685),o=i(14260),a=i(35925);function l(e){return 57.29577951308232*e}function c(e){return.017453292519943*e}function u(e){return e/o.sv.radius}function h(e){return Math.PI/2-2*Math.atan(Math.exp(-e/o.sv.radius))}function d(e){return null!=e.wkid||null!=e.wkt}const p=[0,0];function f(e,t,i,r,n){const s=e,o=n;if(o.spatialReference=i,"x"in s&&"x"in o)[o.x,o.y]=t(s.x,s.y,p,r);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=t(s.xmin,s.ymin,p,r),[o.xmax,o.ymax]=t(s.xmax,s.ymax,p,r);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const e="paths"in s?s.paths:s.rings,i=[];let n;for(let s=0;s<e.length;s++){const o=e[s];n=[],i.push(n);for(let e=0;e<o.length;e++)n.push(t(o[e][0],o[e][1],[0,0],r)),o[e].length>2&&n[e].push(o[e][2]),o[e].length>3&&n[e].push(o[e][3])}"paths"in o?o.paths=i:o.rings=i}else if("points"in s&&"points"in o){const e=s.points,i=[];for(let n=0;n<e.length;n++)i[n]=t(e[n][0],e[n][1],[0,0],r),e[n].length>2&&i[n].push(e[n][2]),e[n].length>3&&i[n].push(e[n][3]);o.points=i}return n}function m(e,t){const i=e&&(d(e)?e:e.spatialReference),r=t&&(d(t)?t:t.spatialReference);return!(e&&"type"in e&&"mesh"===e.type||t&&"type"in t&&"mesh"===t.type||!i||!r)&&(!!(0,a.fS)(r,i)||(0,a.sS)(r)&&(0,a.oR)(i)||(0,a.sS)(i)&&(0,a.oR)(r))}function g(e,t){if(null==e)return null;const i=e.spatialReference,n=t&&(d(t)?t:t.spatialReference);return m(i,n)?(0,a.fS)(i,n)?(0,r.d9)(e):(0,a.sS)(n)?f(e,y,s.Z.WebMercator,!1,(0,r.d9)(e)):(0,a.oR)(n)?f(e,_,s.Z.WGS84,!1,(0,r.d9)(e)):null:null}function y(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=c(t);return i[0]=c(e)*o.sv.radius,i[1]=o.sv.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function _(e,t,i=[0,0],r=!1){if(e===a.DK[0])i[0]=-180;else if(e===a.DK[1])i[0]=180;else{const t=l(e/o.sv.radius);i[0]=r?t:t-360*Math.floor((t+180)/360)}return i[1]=l(Math.PI/2-2*Math.atan(Math.exp(-t/o.sv.radius))),i}function v(e,t=!1,i=(0,r.d9)(e)){return(0,n.M)(e),(0,n.M)(i),f(e,y,s.Z.WebMercator,t,i)}function b(e,t=!1,i=(0,r.d9)(e)){return(0,n.M)(e),(0,n.M)(i),f(e,_,s.Z.WGS84,t,i)}},36939:(e,t,i)=>{function r(e,t,i=!1){let{hasM:r,hasZ:n}=e;Array.isArray(t)?4!==t.length||r||n?3===t.length&&i&&!r?(n=!0,r=!1):3===t.length&&r&&n&&(r=!1,n=!1):(r=!0,n=!0):(n=!n&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!n||t.hasZ)),e.hasZ=n,e.hasM=r}i.d(t,{l:()=>r})},95247:(e,t,i)=>{i.d(t,{k:()=>o});var r=i(17321),n=i(69442),s=i(35925);function o(e,t,i){if(null==t||null==i||i.vcsWkid||(0,s.fS)(t,i)||(0,n.oe)(t)||(0,n.oe)(i))return null;const o=(0,r._R)(t)/(0,r._R)(i);if(1===o)return null;switch(e){case"point":case"esriGeometryPoint":return e=>function(e,t){null!=e?.z&&(e.z*=t)}(e,o);case"polyline":case"esriGeometryPolyline":return e=>function(e,t){if(e)for(const i of e.paths)for(const e of i)e.length>2&&(e[2]*=t)}(e,o);case"polygon":case"esriGeometryPolygon":return e=>function(e,t){if(e)for(const i of e.rings)for(const e of i)e.length>2&&(e[2]*=t)}(e,o);case"multipoint":case"esriGeometryMultipoint":return e=>function(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}(e,o);case"extent":case"esriGeometryEnvelope":return e=>function(e,t){e&&null!=e.zmin&&null!=e.zmax&&(e.zmin*=t,e.zmax*=t)}(e,o);default:return null}}},87090:(e,t,i)=>{i.r(t),i.d(t,{convertDateFormatToIntlOptions:()=>r.Ze,convertNumberFormatToIntlOptions:()=>n.sh,createJSONLoader:()=>d,fetchMessageBundle:()=>a.ME,formatDate:()=>r.p6,formatDateOnly:()=>r.o8,formatNumber:()=>n.uf,formatTimeOnly:()=>r.LJ,formatTimestamp:()=>r.i$,getLocale:()=>o.Kd,normalizeMessageBundleLocale:()=>a.Su,onLocaleChange:()=>o.qe,prefersRTL:()=>o.l7,registerMessageBundleLoader:()=>a.tz,setLocale:()=>o.i_,substitute:()=>s.n});var r=i(72057),n=i(25741),s=i(61547),o=i(8108),a=i(60720),l=i(66341),c=i(70375);async function u(e){if(null!=p.fetchBundleAsset)return p.fetchBundleAsset(e);const t=await(0,l.Z)(e,{responseType:"text"});return JSON.parse(t.data)}class h{constructor({base:e="",pattern:t,location:i=new URL(window.location.href)}){let r;r="string"==typeof i?e=>new URL(e,new URL(i,window.location.href)).href:i instanceof URL?e=>new URL(e,i).href:i,this.pattern="string"==typeof t?new RegExp(`^${t}`):t,this.getAssetUrl=r,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,t){return async function(e,t,i,r){const n=t.exec(i);if(!n)throw new c.Z("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],l=(0,a.Su)(r),h=`${s}${o}.json`,d=l?`${s}${o}_${l}.json`:h;let p;try{p=await u(e(d))}catch(t){if(d===h)throw new c.Z("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:t});try{p=await u(e(h))}catch(e){throw new c.Z("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:e})}}return p}(this.getAssetUrl,this.matcher,e,t)}}function d(e){return new h(e)}const p={};var f=i(36567);(0,a.tz)(d({pattern:"esri/",location:f.V}))},72057:(e,t,i)=>{i.d(t,{LJ:()=>M,Xr:()=>b,Ze:()=>C,f1:()=>R,i$:()=>A,o8:()=>E,p6:()=>S});var r=i(25709),n=i(8108),s=i(97718),o=(i(72559),i(17126));const a={year:void 0,month:void 0,day:void 0,weekday:void 0},l={hour:void 0,minute:void 0,second:void 0},c={timeZone:s.pt},u={year:"numeric",month:"numeric",day:"numeric"},h={year:"numeric",month:"long",day:"numeric"},d={year:"numeric",month:"short",day:"numeric"},p={year:"numeric",month:"long",weekday:"long",day:"numeric"},f={hour:"numeric",minute:"numeric"},m={...f,second:"numeric"},g={hourCycle:"h23"},y={...f,...g},_={...m,...g},v={"short-date":u,"short-date-short-time":{...u,...f},"short-date-short-time-24":{...u,...y},"short-date-long-time":{...u,...m},"short-date-long-time-24":{...u,..._},"short-date-le":u,"short-date-le-short-time":{...u,...f},"short-date-le-short-time-24":{...u,...y},"short-date-le-long-time":{...u,...m},"short-date-le-long-time-24":{...u,..._},"long-month-day-year":h,"long-month-day-year-short-time":{...h,...f},"long-month-day-year-short-time-24":{...h,...y},"long-month-day-year-long-time":{...h,...m},"long-month-day-year-long-time-24":{...h,..._},"day-short-month-year":d,"day-short-month-year-short-time":{...d,...f},"day-short-month-year-short-time-24":{...d,...y},"day-short-month-year-long-time":{...d,...m},"day-short-month-year-long-time-24":{...d,..._},"long-date":p,"long-date-short-time":{...p,...f},"long-date-short-time-24":{...p,...y},"long-date-long-time":{...p,...m},"long-date-long-time-24":{...p,..._},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":f,"long-time":m},b=(0,r.w)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),w={ar:"ar-u-nu-latn-ca-gregory"};let x=new WeakMap;const T=v["short-date-short-time"];function C(e){return v[e]}function S(e,t=T){return function(e){let t=x.get(e);if(!t){const i=(0,n.Kd)(),r=w[i]||i,o=R(e.timeZone??s.By),a={...e,timeZone:o};t=new Intl.DateTimeFormat(r,a),x.set(e,t)}return t}(t).format(e)}function E(e,t=T){return S(new Date(e),{...t,...c,...l})}function M(e,t=T){return S(new Date(`1970-01-01T${e}Z`),{...t,...c,...a})}function A(e,t=T){if(t.timeZone)return S(new Date(e),t);const i=o.ou.fromISO(e,{setZone:!0}),r=(0,n.Kd)(),a=w[r]??r,l=0===i.offset?s.pt:t.timeZone,c={...t,timeZone:l};return i.toLocaleString(c,{locale:a})}function R(e){switch(e){case s.By:return s.o5;case s._4:return s.pt;default:return e}}(0,n.Ze)((()=>{x=new WeakMap}))},8108:(e,t,i)=>{i.d(t,{G3:()=>h,Kd:()=>c,Ze:()=>y,i_:()=>u,l7:()=>p,qe:()=>m});var r=i(23148);let n,s;const o=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale,a=globalThis.document?.documentElement;function l(){const e=a?.getAttribute("lang"),t=globalThis.navigator?.language;return o??e??t??"en"}function c(){return void 0===s&&(s=l()),s}function u(e){n=e||void 0,_()}function h(e=c()){return/^([a-zA-Z]{2,3})(?:[_-][a-zA-Z0-9]+)*$/.exec(e)?.[1].toLowerCase()}const d={he:!0,ar:!0};function p(e=c()){const t=h(e);return void 0!==t&&(d[t]||!1)}const f=[];function m(e){return f.push(e),(0,r.kB)((()=>f.splice(f.indexOf(e),1)))}const g=[];function y(e){return g.push(e),(0,r.kB)((()=>g.splice(g.indexOf(e),1)))}function _(){const e=n??l();s!==e&&([...g].forEach((t=>t(e))),s=e,[...f].forEach((t=>t(e))))}globalThis.addEventListener?.("languagechange",_),a&&new MutationObserver((()=>{_()})).observe(a,{attributeFilter:["lang"]})},60720:(e,t,i)=>{i.d(t,{ME:()=>f,Su:()=>m,tz:()=>p});var r=i(70375),n=i(23148),s=i(78668),o=i(8108);const a=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,l={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function c(e){if(function(e){return e in l}(e)){const t=l[e];return!0===t?e:t}return null}const u=[],h=new Map;function d(e){for(const t of h.keys())g(e.pattern,t)&&h.delete(t)}function p(e){return u.includes(e)||(d(e),u.unshift(e)),(0,n.kB)((()=>{const t=u.indexOf(e);t>-1&&(u.splice(t,1),d(e))}))}async function f(e){const t=(0,o.Kd)();h.has(e)||h.set(e,async function(e,t){const i=[];for(const r of u)if(g(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(e){i.push(e)}if(i.length)throw new r.Z("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i});throw new r.Z("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,t));const i=h.get(e);return i&&await y.add(i),i}function m(e){if(!a.test(e))return null;const t=a.exec(e);if(null===t)return null;const[,i,r]=t;return c(i+(r?"-"+r.toUpperCase():""))??c(i)}function g(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}(0,o.Ze)((()=>{h.clear()}));const y=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=(0,s.hh)())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}}},25741:(e,t,i)=>{i.d(t,{p3:()=>u,sh:()=>l,uf:()=>c});var r=i(8108);const n={ar:"ar-u-nu-latn"};let s=new WeakMap,o={};function a(e){const t=e||o;if(!s.has(t)){const i=(0,r.Kd)(),o=n[(0,r.Kd)()]||i;s.set(t,new Intl.NumberFormat(o,e))}return s.get(t)}function l(e={}){const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function c(e,t){return Object.is(e,-0)&&(e=0),a(t).format(e)}function u(e,t=(0,r.Kd)()){if(!e)return null;let i=h.get(t);if(!i){const e=a().formatToParts(12345.6),r=[...a({useGrouping:!1}).format(9876543210)].reverse(),n=new Map(r.map(((e,t)=>[e,t]))),s=new RegExp(`[${e.find((e=>"group"===e.type))?.value}]`,"g"),o=new RegExp(`[${e.find((e=>"decimal"===e.type))?.value}]`),l=new RegExp(`[${r.join("")}]`,"g"),c=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,u=/[-\u2212\u2013\u2014\u2015]/g;i=e=>{if(""===(e=e.trim().replaceAll(s,"").replace(o,".").replace(l,(e=>String(n.get(e)))).replaceAll(c,"").replaceAll(u,"-")))return null;const t=Number(e);return isNaN(t)?null:t},h.set(t,i)}return i(e)}(0,r.Ze)((()=>{s=new WeakMap,o={}}));const h=new Map},61547:(e,t,i)=>{i.d(t,{n:()=>c});var r=i(13802),n=i(86745),s=i(21130),o=i(72057),a=i(25741);const l=()=>r.Z.getLogger("esri.intl.substitute");function c(e,t,i={}){const{format:r={}}=i;return(0,s.gx)(e,(e=>function(e,t,i){let r,s;const o=e.indexOf(":");if(-1===o?r=e.trim():(r=e.slice(0,o).trim(),s=e.slice(o+1).trim()),!r)return"";const a=(0,n.hS)(r,t);if(null==a)return"";const l=(s?i?.[s]:null)??i?.[r];return l?u(a,l):s?h(a,s):d(a)}(e,t,r)))}function u(e,t){switch(t.type){case"date":return(0,o.p6)(e,t.intlOptions);case"number":return(0,a.uf)(e,t.intlOptions);default:return l().warn("missing format descriptor for key {key}"),d(e)}}function h(e,t){switch(t.toLowerCase()){case"dateformat":return(0,o.p6)(e);case"numberformat":return(0,a.uf)(e);default:return l().warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?(0,o.p6)(e):/^numberformat/i.test(t)?(0,a.uf)(e):d(e)}}function d(e){switch(typeof e){case"string":return e;case"number":return(0,a.uf)(e);case"boolean":return""+e;default:return e instanceof Date?(0,o.p6)(e):""}}},88256:(e,t,i)=>{i.d(t,{Dp:()=>c,bR:()=>a,i8:()=>s,id:()=>o,qh:()=>l});var r=i(39994),n=i(3466);Symbol.dispose??=Symbol("Symbol.dispose"),Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");const s="4.32";let o,a=s;function l(e){o=e}function c(e){const t=o?.findCredential(e);return t?.token?(0,n.ZN)(e,"token",t.token):e}a="4.32.10",(0,r.Z)("host-webworker")||globalThis.$arcgis||Object.defineProperty(globalThis,"$arcgis",{configurable:!1,enumerable:!0,writable:!1,value:{}}),(0,r.Z)("host-webworker")},45857:(e,t,i)=>{i.d(t,{Z:()=>p});var r=i(36663),n=i(81977),s=(i(39994),i(13802),i(4157),i(40266)),o=i(4637),a=i(38481),l=i(27668),c=i(95874),u=i(94449),h=i(74710);let d=class extends((0,l.h7)((0,c.M)(a.Z))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new u.J,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,r._)([(0,n.Cb)({type:h.Z})],d.prototype,"elevationInfo",void 0),(0,r._)([(0,n.Cb)((0,o.z)(u.J,"graphics"))],d.prototype,"graphics",void 0),(0,r._)([(0,n.Cb)({type:["show","hide"]})],d.prototype,"listMode",void 0),(0,r._)([(0,n.Cb)()],d.prototype,"screenSizePerspectiveEnabled",void 0),(0,r._)([(0,n.Cb)({readOnly:!0})],d.prototype,"type",void 0),(0,r._)([(0,n.Cb)({constructOnly:!0})],d.prototype,"internal",void 0),d=(0,r._)([(0,s.j)("esri.layers.GraphicsLayer")],d);const p=d},38481:(e,t,i)=>{i.d(t,{Z:()=>b});var r=i(36663),n=i(66341),s=i(70375),o=i(31355),a=i(86618),l=i(68309),c=i(13802),u=i(78668),h=i(3466),d=i(81977),p=(i(39994),i(4157),i(40266)),f=i(91772),m=i(14685),g=i(51366);var y=i(49684);let _=0,v=class extends(o.Z.EventedMixin(a.Z.IdentifiableMixin(l.Z))){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new f.Z(-180,-90,180,90,m.Z.WGS84),this.id=Date.now().toString(16)+"-layer-"+_++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=m.Z.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const t="string"==typeof e?{url:e}:e;return(await i.e(66361).then(i.bind(i,66361))).fromUrl(t)}static fromPortalItem(e){return async function(e){const t="portalItem"in e?e:{portalItem:e},{fromItem:r}=await i.e(55831).then(i.bind(i,55831));try{return await r(t)}catch(e){const i=t?.portalItem,r=i?.id||"unset",n=i?.portal?.url||g.Z.portalUrl;throw c.Z.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+n+"', id: '"+r+"')",e),e}}(e)}initialize(){this.when().catch((e=>{(0,u.D_)(e)||c.Z.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})}))}destroy(){const e=this.parent;if(e){const t=this;"layers"in e&&e.layers.includes(t)?e.layers.remove(t):"tables"in e&&e.tables.includes(t)?e.tables.remove(t):"baseLayers"in e&&e.baseLayers.includes(t)?e.baseLayers.remove(t):"referenceLayers"in e&&e.referenceLayers.includes(t)&&e.referenceLayers.remove(t),this._set("parent",null)}}get effectiveVisible(){let e=this.visible;const t=this.parent;return e&&t&&"effectiveVisible"in t&&(e&&=t.effectiveVisible),e}get hasAttributionData(){return null!=this.attributionDataUrl}get parsedUrl(){return(0,h.mN)(this.url)}createLayerView(e,t){return Promise.reject(new s.Z("layer:create-layer-view","Layer does not support creating a layer view"))}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await(0,n.Z)(e,{query:{f:"json"},responseType:"json"})).data;throw new s.Z("layer:no-attribution-data","Layer does not have attribution data")}};(0,r._)([(0,d.Cb)({type:String})],v.prototype,"attributionDataUrl",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],v.prototype,"effectiveVisible",null),(0,r._)([(0,d.Cb)({type:f.Z})],v.prototype,"fullExtent",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],v.prototype,"hasAttributionData",null),(0,r._)([(0,d.Cb)({type:String,clonable:!1})],v.prototype,"id",void 0),(0,r._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],v.prototype,"legendEnabled",void 0),(0,r._)([(0,d.Cb)({type:["show","hide","hide-children"]})],v.prototype,"listMode",void 0),(0,r._)([(0,d.Cb)({type:Number,range:{min:0,max:1},nonNullable:!0})],v.prototype,"opacity",void 0),(0,r._)([(0,d.Cb)({clonable:!1})],v.prototype,"parent",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],v.prototype,"parsedUrl",null),(0,r._)([(0,d.Cb)({type:Boolean,readOnly:!0})],v.prototype,"persistenceEnabled",void 0),(0,r._)([(0,d.Cb)({type:Boolean})],v.prototype,"popupEnabled",void 0),(0,r._)([(0,d.Cb)({type:Boolean})],v.prototype,"attributionVisible",void 0),(0,r._)([(0,d.Cb)({type:m.Z})],v.prototype,"spatialReference",void 0),(0,r._)([(0,d.Cb)({type:String})],v.prototype,"title",void 0),(0,r._)([(0,d.Cb)({readOnly:!0,json:{read:!1}})],v.prototype,"type",void 0),(0,r._)([(0,d.Cb)()],v.prototype,"url",void 0),(0,r._)([(0,d.Cb)({type:y.Z})],v.prototype,"visibilityTimeExtent",void 0),(0,r._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],v.prototype,"visible",void 0),v=(0,r._)([(0,p.j)("esri.layers.Layer")],v);const b=v},20375:(e,t,i)=>{i.d(t,{d:()=>r});const r="OBJECTID"},92955:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Pe});var r=i(36663),n=i(80085),s=i(80020),o=i(41151),a=i(41831),l=i(70375),c=i(13802),u=i(61681),h=i(15842),d=i(78668),p=i(76868),f=i(81977),m=(i(39994),i(4157),i(95620)),g=i(34248),y=i(40266),_=i(65943),v=i(10186),b=i(38481),w=i(30676),x=i(91223),T=i(87232),C=i(63989),S=i(15801),E=i(43330),M=i(18241),A=i(95874),R=i(93902),O=i(2030),P=i(82064),I=i(14845);function L({associatedLayer:e,serviceUpdateTimeStamp:t}){const i=e?.editingInfo?.lastEditDate,r=e?.serverGens,n=null!=i,s=null!=t,o=n&&s&&t.lastUpdate!==i.getTime();return n&&(o||!s&&r?.minServerGen!==r?.serverGen)}var D=i(23756),N=i(49684),F=i(52193);const U=e=>{let t=class extends e{constructor(){super(...arguments),this.serviceTimeInfo=null}get timeInfo(){const e=this.associatedLayer?.timeInfo;if(null==e)return null;const t=e.clone();return(0,I.UF)(t,this.fieldsIndex),t}set timeInfo(e){(0,I.UF)(e,this.fieldsIndex),this._override("timeInfo",e)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(e){this._override("timeExtent",e)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(e){this._override("timeOffset",e)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(e){this._override("datesInUnknownTimezone",e)}async loadTimeInfoFromService(e){const{serviceTimeInfo:t}=this;if(null==t)return;const{startTimeField:i,endTimeField:r}=t;if(null==i&&null==r)return;if(L({associatedLayer:this.associatedLayer,serviceUpdateTimeStamp:this.serviceUpdateTimeStamp}))return;const n=async t=>{let r=null;try{r=(await(this.fetchStatistics?.(t,e)))?.stats}catch{}if(null==r)return null;const{minTimeStr:n,min:s,maxTimeStr:o,max:a}=r,l=t===i?n??s:o??a;return null!=l?new Date(l):null},[s,o]=await Promise.all([n(i),n(r)]);if(null!=i&&null==s||null!=r&&null==o)return;const a=new N.Z({start:s,end:o});this.setAtOrigin("timeInfo",new D.Z({endField:r,startField:i,fullTimeExtent:a}),"service")}};return(0,r._)([(0,f.Cb)({type:D.Z,json:{read:!1,write:!1}})],t.prototype,"timeInfo",null),(0,r._)([(0,f.Cb)({type:N.Z,json:{read:!1,write:!1}})],t.prototype,"timeExtent",null),(0,r._)([(0,f.Cb)({type:F.Z,json:{read:!1,write:!1}})],t.prototype,"timeOffset",null),(0,r._)([(0,f.Cb)({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],t.prototype,"datesInUnknownTimezone",null),(0,r._)([(0,f.Cb)({type:k,readOnly:!0,json:{read:{source:"timeInfo"}}})],t.prototype,"serviceTimeInfo",void 0),t=(0,r._)([(0,y.j)("esri.layers.mixins.TemporalSceneLayer")],t),t};let k=class extends P.Z{constructor(){super(...arguments),this.endTimeField=null,this.startTimeField=null}};(0,r._)([(0,f.Cb)({type:String})],k.prototype,"endTimeField",void 0),(0,r._)([(0,f.Cb)({type:String})],k.prototype,"startTimeField",void 0),k=(0,r._)([(0,y.j)("esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo")],k);var z=i(20692),B=i(53264),V=i(31484),H=i(23072),G=i(23556),j=i(48257),Z=i(69766),q=i(89076),W=i(28790),$=i(97304),Y=i(13449),J=i(7923),X=i(49341),K=i(94081),Q=i(92557),ee=i(37104);let te=class extends P.Z{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};(0,r._)([(0,f.Cb)({type:String,json:{read:!0,write:{isRequired:!0}}})],te.prototype,"name",void 0),(0,r._)([(0,f.Cb)({type:String,json:{read:!0,write:{isRequired:!0}}})],te.prototype,"field",void 0),(0,r._)([(0,f.Cb)({type:[Number],json:{read:!0,write:!0}})],te.prototype,"currentRangeExtent",void 0),(0,r._)([(0,f.Cb)({type:[Number],json:{read:!0,write:!0}})],te.prototype,"fullRangeExtent",void 0),(0,r._)([(0,f.Cb)({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],te.prototype,"type",void 0),te=(0,r._)([(0,y.j)("esri.layers.support.RangeInfo")],te);var ie,re=i(66341),ne=i(67134),se=i(98786),oe=i(96863),ae=i(89542),le=i(90472);let ce=ie=class extends(P.Z.JSONSupportMixin(a.Z.ofType(ae.Z))){constructor(e){super(e)}clone(){return new ie(this.items.map((e=>e.clone())))}write(e,t){return this.toJSON(t)}toJSON(e){const t=e?.layer?.spatialReference;return t?this.toArray().map((i=>{if(!t.equals(i.spatialReference)){if(!(0,le.canProjectWithoutEngine)(i.spatialReference,t))return e?.messages?.push(new oe.Z("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const r=new ae.Z;(0,le.projectPolygon)(i,r,t),i=r}const r=i.toJSON(e);return delete r.spatialReference,r})).filter((e=>null!=e)):(e?.messages?.push(new oe.Z("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map((t=>t.toJSON(e))))}static fromJSON(e,t){const i=new ie;return e.forEach((e=>i.add(ae.Z.fromJSON(e,t)))),i}};ce=ie=(0,r._)([(0,y.j)("esri.layers.support.PolygonCollection")],ce);const ue=ce;var he,de=i(16641);let pe=he=class extends P.Z{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new ue,this._geometriesSource=null}initialize(){this.addHandles((0,p.on)((()=>this.geometries),"after-changes",(()=>this.geometries=this.geometries),p.sync))}readGeometries(e,t,i){Array.isArray(e)?this.geometries=ue.fromJSON(e,i):this._geometriesSource={url:(0,de.f)(e,i),context:i}}async loadGeometries(e,t){if(null==this._geometriesSource)return;const{url:i,context:r}=this._geometriesSource,n=await(0,re.Z)(i,{responseType:"json",signal:t?.signal}),s=e.toJSON(),o=n.data.map((e=>({...e,spatialReference:s})));this.geometries=ue.fromJSON(o,r),this._geometriesSource=null}clone(){const e=new he({geometries:(0,ne.d9)(this.geometries),spatialRelationship:this.spatialRelationship});return e._geometriesSource=this._geometriesSource,e}};(0,r._)([(0,f.Cb)({type:["disjoint","contains"],nonNullable:!0,json:{write:{isRequired:!0}}})],pe.prototype,"spatialRelationship",void 0),(0,r._)([(0,f.Cb)({type:ue,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),(0,se.B)({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],pe.prototype,"geometries",void 0),(0,r._)([(0,g.r)(["web-scene","portal-item"],"geometries")],pe.prototype,"readGeometries",null),pe=he=(0,r._)([(0,y.j)("esri.layers.support.SceneFilter")],pe);const fe=pe;var me=i(3466);var ge=i(16603),ye=i(88623),_e=i(14626),ve=i(83772),be=i(10171);async function we(e){const t=[];for(const i of e)i.name.toLowerCase().endsWith(".zip")?t.push(xe(i)):t.push(Promise.resolve(i));return(await Promise.all(t)).flat()}async function xe(e){const{BlobReader:t,ZipReader:r,BlobWriter:n}=await i.e(64339).then(i.bind(i,64339)),s=[],o=new r(new t(e));return(await o.getEntries()).forEach((e=>{if(e.directory||/^__MACOS/i.test(e.filename))return;const t=new n,i=e.getData?.(t).then((t=>new File([t],e.filename)));i&&s.push(i)})),Promise.all(s)}var Te=i(78565),Ce=i(59439),Se=i(78621);const Ee=new Set(["3DObject","Point"]),Me=(0,q.v)();let Ae=class extends(U((0,S.o1)((0,R.Vt)((0,T.Y)((0,E.q)((0,M.I)((0,A.M)((0,h.R)((0,C.N)((0,x.V)(o.Z.ClonableMixin(b.Z)))))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new a.Z,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}destroy(){this._set("renderer",null),this.associatedLayer=(0,u.SC)(this.associatedLayer)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){const i=this.getField(e)?.domain??null;return this.associatedLayer?(0,G.cy)(this.associatedLayer,e,t,i):i}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get attributeTableTemplate(){return this.associatedLayer?.attributeTableTemplate??null}get fieldsIndex(){return new W.Z(this.fields)}readNodePages(e,t,i){return"Point"===t.layerType&&(e=t.pointNodePages),null==e||"object"!=typeof e?null:$.U4.fromJSON(e,i)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return null!=this.associatedLayer&&(0,G.sX)(this.associatedLayer)}get geometryType(){return Oe[this.profile]||"mesh"}set renderer(e){(0,I.YN)(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return null!=e&&"object"==typeof e||(e={}),null==e.color&&(e.color=!1),e}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(e){e=null!=e?e:V.C;const{query:t,queryRelated:i,editing:{supportsGlobalId:r,supportsRollbackOnFailure:n,supportsUploadWithItemId:s,supportsGeometryUpdate:o,supportsReturnServiceEditsInSourceSpatialReference:a},data:{supportsZ:l,supportsM:c,isVersioned:u,supportsAttachment:h},operations:{supportsEditing:d,supportsAdd:p,supportsUpdate:f,supportsDelete:m,supportsQuery:g,supportsQueryAttachments:y,supportsAsyncConvert3D:_}}=e,v=e.operations.supportsChangeTracking,b=!!this.associatedLayer?.infoFor3D;return{query:t,queryRelated:i,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:a,supportsRollbackOnFailure:n,supportsGeometryUpdate:b&&o,supportsUploadWithItemId:s},data:{supportsAttachment:h,supportsZ:l,supportsM:c,isVersioned:u},operations:{supportsQuery:g,supportsQueryAttachments:y,supportsEditing:d&&v,supportsAdd:b&&p&&v,supportsDelete:b&&m&&v,supportsUpdate:f&&v,supportsAsyncConvert3D:_}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.associatedLayer?.editingEnabled??!1}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some((t=>("esriFieldTypeOID"===t.type&&(e=t.name),!!e))),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some((t=>("esriFieldTypeGlobalID"===t.type&&(e=t.name),!!e))),e||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(e,t){const i=t.store.profile;return null!=i&&Re[i]?Re[i]:(c.Z.getLogger(this).error("Unknown or missing profile",{profile:i,layer:this}),"mesh-pyramids")}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(e){this._override("useViewTime",e)}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){const t=null!=e?e.signal:null;await this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(d.r9),await this._fetchService(t),await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),this._loadFilterGeometries()]),this._validateElevationInfo(),this._applyAssociatedLayerOverrides(),this._populateFieldUsageInfo(),await this.loadTimeInfoFromService(e),await(0,ge.y)(this,{origin:"service"},t),(0,I.YN)(this.renderer,this.fieldsIndex),await this.finishLoadEditablePortalLayer(e)}async beforeSave(){null!=this.filter&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(e){c.Z.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:e}),this.filter=null}}createQuery(){const e=new _e.Z;return"mesh"===this.geometryType?this.capabilities.query.supportsReturnMesh&&(e.returnGeometry=!0):(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e.outFields=["*"],e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryExtent(e||this.createQuery(),t)))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryFeatureCount(e||this.createQuery(),t)))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryFeatures(e||this.createQuery(),t))).then((e=>{if(e?.features)for(const t of e.features)t.layer=this,t.sourceLayer=this;return e}))}async queryRelatedFeatures(e,t){if(await this.load(),!this.associatedLayer)throw new l.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){if(await this.load(),!this.associatedLayer)throw new l.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(e,t)}async queryCachedAttributes(e,t){const i=(0,I.Lk)(this.fieldsIndex,await(0,Ce.e7)(this,(0,Ce.V5)(this)));return(0,Te.xe)(this.parsedUrl?.path??"",this.attributeStorageInfo??[],e,t,i,this.apiKey,this.customParameters)}async queryCachedFeature(e,t){const i=await this.queryCachedAttributes(e,[t]);if(!i||0===i.length)throw new l.Z("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const r=new n.Z;return r.attributes=i[0],r.layer=this,r.sourceLayer=this,r}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryObjectIds(e||this.createQuery(),t)))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryAttachments(e,t)))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(c.Z.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return(0,be.eZ)(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return e?.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new l.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new l.Z("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return null!=this.statisticsInfo&&this.statisticsInfo.some((t=>t.name===e))}async queryCachedStatistics(e,t){return await this.load(t),await this.fetchStatistics(e,t)}async saveAs(e,t){return this._debouncedSaveOperations(R.xp.SAVE_AS,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(R.xp.SAVE,e)}async applyEdits(e,t){const{applyEdits:r}=await i.e(23261).then(i.bind(i,23261));let n=t;await this.load();const s=this.associatedLayer;if(!s)throw new l.Z(`${this.type}-layer:not-editable`,"Service is not editable");await s.load();const{globalIdField:o}=s,a=!!s.infoFor3D,c=n?.globalIdUsed??!0;if(a&&null==o)throw new l.Z(`${this.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(a&&!c)throw new l.Z(`${this.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");return(0,z.M8)(s.url)&&a&&null!=e.deleteFeatures&&null!=o&&(n={...n,globalIdToObjectId:await(0,G.HW)(s,e.deleteFeatures,o)}),r(this,s.source,e,n)}async uploadAssets(e,t){if(await this.load(),null==this.associatedLayer)throw new l.Z(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(e,t)}on(e,t){return super.on(e,t)}async convertMesh(e,t){t??={};const r=e=>{throw c.Z.getLogger(this).error(".convertMesh()",e.message),e};await this.load(),this.infoFor3D||r(new l.Z("invalid:layer","SceneLayer has no capability for mesh conversion"));const n=await this.extractAndFilterFiles(e),s=n.reduce(((e,t)=>(0,Y.$z)(this.infoFor3D,t)?e+1:e),0);0===s&&r(new w.Q_),s>1&&r(new w.i1);const o=this.spatialReference,a=t.location??new v.Z({x:0,y:0,z:0,spatialReference:o}),u=a.spatialReference.isGeographic?"local":"georeferenced",{default:h}=await Promise.all([i.e(93911),i.e(15857)]).then(i.bind(i,15857)),d=h.createWithExternalSource(a,n,{vertexSpace:u,transform:(0,ee.c)(a.spatialReference),unitConversionDisabled:!0}),[p]=await this.uploadAssets([d],{...t,useAssetOrigin:!t.location});return p}async extractAndFilterFiles(e){await this.load();const t=this.infoFor3D;return t?(await we(e)).filter((e=>(0,Y.F7)(t,e))):e}validateLayer(e){if(e.layerType&&!Ee.has(e.layerType))throw new l.Z("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new l.Z("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new l.Z("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});!function(e,t){let i=!1,r=!1;if(null==e)i=!0,r=!0;else{const n=t&&t.isGeographic;switch(e){case"east-north-up":case"earth-centered":i=!0,r=n;break;case"vertex-reference-frame":i=!0,r=!n;break;default:i=!1}}if(!i)throw new l.Z("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!r)throw new l.Z("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if("points"===this.profile)e.push("Point");else{if("mesh-pyramids"!==this.profile)throw new l.Z("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const t=!!this.attributeStorageInfo?.some((t=>t.name===e.name)),i=!!this.associatedLayer?.fields?.some((t=>t&&e.name===t.name)),r={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||i,supportsLayerQuery:i};this._fieldUsageInfo[e.name]=r}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let e=null;for(const t of this.associatedLayer.fields){const i=this.getField(t.name);i?(!i.domain&&t.domain&&(i.domain=t.domain.clone()),i.editable=t.editable,i.nullable=t.nullable,i.length=t.length):(e||(e=this.fields?this.fields.slice():[]),e.push(t.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const e=["popupTemplate","popupEnabled"],t=(0,m.vw)(this);for(let i=0;i<e.length;i++){const r=e[i],n=this.originIdOf(r),s=this.associatedLayer.originIdOf(r);n<s&&(s===_.s3.SERVICE||s===_.s3.PORTAL_ITEM)&&t.setAtOrigin(r,this.associatedLayer[r],s)}}_applyAssociatedLayerExtentOverride(){const e=this.associatedLayer?.getAtOrigin("fullExtent","service");null!=this.associatedLayer?.infoFor3D&&e&&(0,z.M8)(this.associatedLayer?.url)&&L(this)&&(0,m.vw)(this).setAtOrigin("fullExtent",e.clone(),_.s3.SERVICE)}_applyAssociatedLayerPrivileges(){const e=this.associatedLayer;e&&(this._set("userHasEditingPrivileges",e.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",e.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",e.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(e){if(["mesh-pyramids","points"].includes(this.profile))try{const{serverUrl:t,layerId:i,portalItem:r}=await(0,B.w)(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e}),n=await Q.T.FeatureLayer();this.associatedLayer=new n({url:t,customParameters:this.customParameters,layerId:i,portalItem:r}),await this.associatedLayer.load()}catch(e){(0,d.D_)(e)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await(0,p.whenOnce)((()=>this.popupEnabled&&null!=this.popupTemplate));const e=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?c.Z.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):c.Z.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;"mesh-pyramids"===this.profile&&(0,ve.LR)(c.Z.getLogger(this),(0,ve.Wb)("Mesh scene layers","relative-to-scene",e)),(0,ve.LR)(c.Z.getLogger(this),(0,ve.kf)("Scene layers",e))}async fetchStatistics(e,t){return await async function({fieldName:e,statisticsInfo:t,errorContext:i,fieldsIndex:r,path:n,customParameters:s,apiKey:o,signal:a}){if(null==t)throw new l.Z(`${i}:no-cached-statistics`,"Cached statistics are not available for this layer");const c=r.get(e);if(null==c)throw new l.Z(`${i}:field-unexisting`,`Field '${e}' does not exist on the layer`);const u=t.find((e=>e.name===c.name));if(null==u)throw new l.Z(`${i}:no-cached-statistics`,"Cached statistics for this attribute are not available");const h=(0,me.v_)(n,u.href),{data:d}=await(0,re.Z)(h,{query:{f:"json",...s,token:o},responseType:"json",signal:a});return d}({fieldName:e,statisticsInfo:this.statisticsInfo,errorContext:"scenelayer",fieldsIndex:this.fieldsIndex,path:this.parsedUrl?.path??"",customParameters:this.customParameters,apiKey:this.apiKey,signal:t?.signal})}};(0,r._)([(0,f.Cb)({types:{key:"type",base:j.B,typeMap:{selection:Z.Z}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],Ae.prototype,"featureReduction",void 0),(0,r._)([(0,f.Cb)({type:[te],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],Ae.prototype,"rangeInfos",void 0),(0,r._)([(0,f.Cb)({json:{read:!1}})],Ae.prototype,"associatedLayer",void 0),(0,r._)([(0,f.Cb)({type:["show","hide"]})],Ae.prototype,"listMode",void 0),(0,r._)([(0,f.Cb)({type:["ArcGISSceneServiceLayer"]})],Ae.prototype,"operationalLayerType",void 0),(0,r._)([(0,f.Cb)({json:{read:!1},readOnly:!0})],Ae.prototype,"type",void 0),(0,r._)([(0,f.Cb)({...Me.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Ae.prototype,"fields",void 0),(0,r._)([(0,f.Cb)()],Ae.prototype,"types",null),(0,r._)([(0,f.Cb)()],Ae.prototype,"typeIdField",null),(0,r._)([(0,f.Cb)()],Ae.prototype,"templates",null),(0,r._)([(0,f.Cb)()],Ae.prototype,"formTemplate",null),(0,r._)([(0,f.Cb)()],Ae.prototype,"attributeTableTemplate",null),(0,r._)([(0,f.Cb)({readOnly:!0,clonable:!1})],Ae.prototype,"fieldsIndex",null),(0,r._)([(0,f.Cb)({type:K.Z,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Ae.prototype,"floorInfo",void 0),(0,r._)([(0,f.Cb)(Me.outFields)],Ae.prototype,"outFields",void 0),(0,r._)([(0,f.Cb)({type:$.U4,readOnly:!0,json:{read:!1}})],Ae.prototype,"nodePages",void 0),(0,r._)([(0,g.r)("service","nodePages",["nodePages","pointNodePages"])],Ae.prototype,"readNodePages",null),(0,r._)([(0,f.Cb)({type:[$.QI],readOnly:!0})],Ae.prototype,"materialDefinitions",void 0),(0,r._)([(0,f.Cb)({type:[$.Yh],readOnly:!0})],Ae.prototype,"textureSetDefinitions",void 0),(0,r._)([(0,f.Cb)({type:[$.H3],readOnly:!0})],Ae.prototype,"geometryDefinitions",void 0),(0,r._)([(0,f.Cb)({readOnly:!0})],Ae.prototype,"serviceUpdateTimeStamp",void 0),(0,r._)([(0,f.Cb)({readOnly:!0})],Ae.prototype,"attributeStorageInfo",void 0),(0,r._)([(0,f.Cb)({readOnly:!0})],Ae.prototype,"statisticsInfo",void 0),(0,r._)([(0,f.Cb)({type:a.Z.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],Ae.prototype,"excludeObjectIds",void 0),(0,r._)([(0,f.Cb)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Ae.prototype,"definitionExpression",void 0),(0,r._)([(0,f.Cb)({type:fe,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],Ae.prototype,"filter",void 0),(0,r._)([(0,f.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ae.prototype,"path",void 0),(0,r._)([(0,f.Cb)(H.PV)],Ae.prototype,"elevationInfo",null),(0,r._)([(0,f.Cb)({readOnly:!0,json:{read:!1}})],Ae.prototype,"effectiveCapabilities",null),(0,r._)([(0,f.Cb)({readOnly:!0})],Ae.prototype,"effectiveEditingEnabled",null),(0,r._)([(0,f.Cb)({type:String})],Ae.prototype,"geometryType",null),(0,r._)([(0,f.Cb)(H.iR)],Ae.prototype,"labelsVisible",void 0),(0,r._)([(0,f.Cb)({type:[J.Z],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:X.r},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:X.r},write:!0}})],Ae.prototype,"labelingInfo",void 0),(0,r._)([(0,f.Cb)(H.rn)],Ae.prototype,"legendEnabled",void 0),(0,r._)([(0,f.Cb)({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){if("number"==typeof e&&e>=0&&e<=1)return e;const i=t.layerDefinition?.drawingInfo?.transparency;return void 0!==i?(0,Se.b)(i):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],Ae.prototype,"opacity",void 0),(0,r._)([(0,f.Cb)({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Ae.prototype,"priority",void 0),(0,r._)([(0,f.Cb)({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Ae.prototype,"semantic",void 0),(0,r._)([(0,f.Cb)({types:ye.o,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],Ae.prototype,"renderer",null),(0,r._)([(0,f.Cb)({json:{read:!1}})],Ae.prototype,"cachedDrawingInfo",void 0),(0,r._)([(0,g.r)("service","cachedDrawingInfo")],Ae.prototype,"readCachedDrawingInfo",null),(0,r._)([(0,f.Cb)({readOnly:!0,json:{read:!1}})],Ae.prototype,"capabilities",null),(0,r._)([(0,f.Cb)({type:Boolean,json:{read:!1}})],Ae.prototype,"editingEnabled",null),(0,r._)([(0,f.Cb)({readOnly:!0,json:{write:!1,read:!1}})],Ae.prototype,"infoFor3D",null),(0,r._)([(0,f.Cb)({readOnly:!0,json:{write:!1,read:!1}})],Ae.prototype,"relationships",null),(0,r._)([(0,f.Cb)(H.C_)],Ae.prototype,"popupEnabled",void 0),(0,r._)([(0,f.Cb)({type:s.Z,json:{name:"popupInfo",write:!0}})],Ae.prototype,"popupTemplate",void 0),(0,r._)([(0,f.Cb)({readOnly:!0,json:{read:!1}})],Ae.prototype,"defaultPopupTemplate",null),(0,r._)([(0,f.Cb)({type:String,json:{read:!1}})],Ae.prototype,"objectIdField",void 0),(0,r._)([(0,g.r)("service","objectIdField",["objectIdField","fields"])],Ae.prototype,"readObjectIdField",null),(0,r._)([(0,f.Cb)({type:String,json:{read:!1}})],Ae.prototype,"globalIdField",void 0),(0,r._)([(0,g.r)("service","globalIdField",["globalIdField","fields"])],Ae.prototype,"readGlobalIdField",null),(0,r._)([(0,f.Cb)({readOnly:!0,type:String,json:{read:!1}})],Ae.prototype,"displayField",null),(0,r._)([(0,f.Cb)({type:String,json:{read:!1}})],Ae.prototype,"profile",void 0),(0,r._)([(0,g.r)("service","profile",["store.profile"])],Ae.prototype,"readProfile",null),(0,r._)([(0,f.Cb)({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],Ae.prototype,"normalReferenceFrame",void 0),(0,r._)([(0,f.Cb)(H.YI)],Ae.prototype,"screenSizePerspectiveEnabled",void 0),(0,r._)([(0,f.Cb)({json:{read:!1,origins:{service:{read:!0}}}})],Ae.prototype,"serviceItemId",void 0),(0,r._)([(0,f.Cb)(O.I)],Ae.prototype,"useViewTime",null),Ae=(0,r._)([(0,y.j)("esri.layers.SceneLayer")],Ae);const Re={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Oe={"mesh-pyramids":"mesh",points:"point"},Pe=Ae},16358:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ae});var r=i(36663),n=i(66341),s=i(67979),o=i(70375),a=i(67134),l=i(15842),c=i(78668),u=i(3466),h=i(81977),d=(i(39994),i(13802)),p=i(34248),f=i(40266),m=i(39835),g=i(91772),y=i(14685),_=i(38481),v=i(91223),b=i(89993),w=i(87232),x=i(27668),T=i(63989),C=i(43330),S=i(18241),E=i(12478),M=i(95874);let A=null;var R=i(86098);class O{constructor(e,t){this._spriteSource=e,this._maxTextureSize=t,this.devicePixelRatio=1,this._spriteImageFormat="png",this._isRetina=!1,this._spritesData={},this.image=null,this.width=null,this.height=null,this.loadStatus="not-loaded","url"===e.type&&e.spriteFormat&&(this._spriteImageFormat=e.spriteFormat),e.pixelRatio&&(this.devicePixelRatio=e.pixelRatio),this.baseURL=e.spriteUrl}get spriteNames(){const e=[];for(const t in this._spritesData)e.push(t);return e.sort(),e}getSpriteInfo(e){return this._spritesData?this._spritesData[e]:null}async load(e){if(this.baseURL){this.loadStatus="loading";try{await this._loadSprites(e),this.loadStatus="loaded"}catch{this.loadStatus="failed"}}else this.loadStatus="failed"}async _loadSprites(e){this._isRetina=this.devicePixelRatio>1.15;const{width:t,height:i,data:r,json:n}=await this._getSpriteData(this._spriteSource,e),s=Object.keys(n);if(!s||0===s.length||!r)return this._spritesData=this.image=null,void(this.width=this.height=0);this._spritesData=n,this.width=t,this.height=i;const a=Math.max(this._maxTextureSize,4096);if(t>a||i>a){const e=`Sprite resource for style ${this.baseURL} is bigger than the maximum allowed of ${a} pixels}`;throw d.Z.getLogger("esri.layers.support.SpriteSource").error(e),new o.Z("SpriteSource",e)}let l;for(let e=0;e<r.length;e+=4)l=r[e+3]/255,r[e]=r[e]*l,r[e+1]=r[e+1]*l,r[e+2]=r[e+2]*l;this.image=r}async _getSpriteData(e,t){if("image"===e.type){let t,i;if(this.devicePixelRatio<1.15){if(!e.spriteSource1x)throw new o.Z("SpriteSource","no image data provided for low resolution sprites!");t=e.spriteSource1x.image,i=e.spriteSource1x.json}else{if(!e.spriteSource2x)throw new o.Z("SpriteSource","no image data provided for high resolution sprites!");t=e.spriteSource2x.image,i=e.spriteSource2x.json}return"width"in t&&"height"in t&&"data"in t&&((0,R.eP)(t.data)||(0,R.KZ)(t.data))?{width:t.width,height:t.height,data:new Uint8Array(t.data),json:i}:{...P(t),json:i}}const i=(0,u.mN)(this.baseURL),r=i.query?"?"+(0,u.B7)(i.query):"",s=this._isRetina?"@2x":"",a=`${i.path}${s}.${this._spriteImageFormat}${r}`,l=`${i.path}${s}.json${r}`,[c,h]=await Promise.all([(0,n.Z)(l,t),(0,n.Z)(a,{responseType:"image",...t})]);return{...P(h.data),json:c.data}}}function P(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.width,t.height=e.height,i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height);return{width:e.width,height:e.height,data:new Uint8Array(r.data)}}var I=i(81590),L=i(43550),D=i(35925),N=i(39536),F=i(87241);class U{constructor(e){this.url=e}destroy(){this._tileIndexPromise=null}async fetchTileIndex(){return this._tileIndexPromise||(this._tileIndexPromise=(0,n.Z)(this.url).then((e=>e.data.index))),this._tileIndexPromise}async dataKey(e,t){const i=await this.fetchTileIndex();return(0,c.k_)(t),this._getIndexedDataKey(i,e)}_getIndexedDataKey(e,t){const i=[t];if(t.level<0||t.row<0||t.col<0||t.row>>t.level>0||t.col>>t.level>0)return null;let r=t;for(;0!==r.level;)r=new F.Z(r.level-1,r.row>>1,r.col>>1,r.world),i.push(r);let n,s,o=e,a=i.pop();if(1===o)return a;for(;i.length;)if(n=i.pop(),s=(1&n.col)+((1&n.row)<<1),o){if(0===o[s]){a=null;break}if(1===o[s]){a=n;break}a=n,o=o[s]}return a}}var k=i(61681);class z{constructor(e,t){this._tilemap=e,this._tileIndexUrl=t}destroy(){this._tilemap=(0,k.SC)(this._tilemap),this._tileIndexPromise=null}async fetchTileIndex(e){return this._tileIndexPromise||(this._tileIndexPromise=(0,n.Z)(this._tileIndexUrl,{query:{...e?.query}}).then((e=>e.data.index))),this._tileIndexPromise}dataKey(e,t){const{level:i,row:r,col:n}=e,s=new F.Z(e);return this._tilemap.fetchAvailabilityUpsample(i,r,n,s,t).then((()=>(s.world=e.world,s))).catch((e=>{if((0,c.D_)(e))throw e;return null}))}}var B=i(86114);class V{constructor(e){this._tileUrl=e,this._promise=null,this._abortController=null,this._abortOptions=[]}getData(e){(null==this._promise||(0,c.Hc)(this._abortController?.signal))&&(this._promise=this._makeRequest(this._tileUrl));const t=this._abortOptions;return t.push(e),(0,c.fu)(e,(()=>{t.every((e=>(0,c.Hc)(e)))&&this._abortController.abort()})),this._promise.then((e=>(0,a.d9)(e)))}async _makeRequest(e){this._abortController=new AbortController;const{data:t}=await(0,n.Z)(e,{responseType:"array-buffer",signal:this._abortController.signal});return t}}const H=new Map;function G(e,t){return(0,B.s1)(H,e,(()=>new V(e))).getData(t).finally((()=>H.delete(e)))}class j{constructor(e,t,i){this.tilemap=null,this.tileInfo=null,this.capabilities=null,this.fullExtent=null,this.initialExtent=null,this.name=e,this.sourceUrl=t;const r=(0,u.mN)(this.sourceUrl),n=(0,a.d9)(i),s=n.tiles;if(r)for(let e=0;e<s.length;e++){const t=(0,u.mN)(s[e]);t&&((0,u.YP)(t.path)||(t.path=(0,u.v_)(r.path,t.path)),s[e]=(0,u.fl)(t.path,{...r.query,...t.query}))}this.tileServers=s;const o=i.capabilities&&i.capabilities.split(",").map((e=>e.toLowerCase().trim())),l=!0===i?.exportTilesAllowed,c=!0===o?.includes("tilemap"),h=l&&i.hasOwnProperty("maxExportTilesCount")?i.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:l,supportsTileMap:c},exportTiles:l?{maxExportTilesCount:+h}:null},this.tileInfo=I.Z.fromJSON(n.tileInfo);const d=i.tileMap?(0,u.fl)((0,u.v_)(r.path,i.tileMap),r.query??{}):null;c?(this.type="vector-tile",this.tilemap=new z(new L.y({layer:{parsedUrl:r,tileInfo:this.tileInfo},minLOD:n.minLOD??this.tileInfo.lods[0].level,maxLOD:n.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}),d)):d&&(this.tilemap=new U(d)),this.fullExtent=g.Z.fromJSON(i.fullExtent),this.initialExtent=g.Z.fromJSON(i.initialExtent)}destroy(){this.tilemap?.destroy()}async getRefKey(e,t){return this.tilemap?this.tilemap.dataKey(e,t):e}requestTile(e,t,i,r){return function(e,t,i,r,n){const s=(0,u.mN)(e),o=s.query;if(o)for(const[e,n]of Object.entries(o))switch(n){case"{x}":o[e]=r.toString();break;case"{y}":o[e]=i.toString();break;case"{z}":o[e]=t.toString()}const a=s.path;return G((0,u.fl)(a.replaceAll(/\{z\}/gi,t.toString()).replaceAll(/\{y\}/gi,i.toString()).replaceAll(/\{x\}/gi,r.toString()),{...s.query}),n)}(this.tileServers[t%this.tileServers.length],e,t,i,r)}isCompatibleWith(e){const t=this.tileInfo,i=e.tileInfo;if(!t.spatialReference.equals(i.spatialReference))return!1;if(!t.origin.equals(i.origin))return!1;if(Math.round(t.dpi)!==Math.round(i.dpi))return!1;const r=t.lods,n=i.lods,s=Math.min(r.length,n.length);for(let e=0;e<s;e++){const t=r[e],i=n[e];if(t.level!==i.level||Math.round(t.scale)!==Math.round(i.scale))return!1}return!0}}function Z(...e){let t;for(const i of e)if(null!=i)if((0,u.oC)(i)){if(t){const e=t.split("://")[0];t=e+":"+i.trim()}}else t=(0,u.YP)(i)?i:(0,u.v_)(t,i);return t?(0,u.Qj)(t):void 0}async function q(e,t,i,r,s){let o,a,l;if((0,c.k_)(s),"string"==typeof i){const e=(0,u.Fv)(i);l=await(0,n.Z)(e,{...s,responseType:"json",query:{f:"json",...s?.query}}),l.ssl&&(o&&(o=o.replace(/^http:/i,"https:")),a&&(a=a.replace(/^http:/i,"https:"))),o=e,a=e}else null!=i&&(l={data:i},o=i.jsonUrl||null,a=r);const h=l?.data;if($(h))return e.styleUrl=o||null,async function(e,t,i,r){const n=i?(0,u.Yd)(i):(0,u.L)();e.styleBase=n,e.style=t,t["sprite-format"]&&"webp"===t["sprite-format"].toLowerCase()&&(e.spriteFormat="webp");const s=[];if(t.sources&&t.sources.esri){const i=t.sources.esri;i.url?await q(e,"esri",Z(n,i.url),void 0,r):s.push(q(e,"esri",i,n,r))}for(const i of Object.keys(t.sources))"esri"!==i&&"vector"===t.sources[i].type&&(t.sources[i].url?s.push(q(e,i,Z(n,t.sources[i].url),void 0,r)):t.sources[i].tiles&&s.push(q(e,i,t.sources[i],n,r)));await Promise.all(s)}(e,h,a,s);if(function(e){return!$(e)}(h))return e.sourceUrl?Y(e,h,a,!1,t,s):(e.sourceUrl=o||null,Y(e,h,a,!0,t,s));throw new Error("You must specify the URL or the JSON for a service or for a style.")}function W(e){return"object"==typeof e&&!!e&&"tilejson"in e&&null!=e.tilejson}function $(e){return!!e&&"sources"in e&&!!e.sources}async function Y(e,t,i,r,n,s){const o=i?(0,u.Qj)(i)+"/":(0,u.L)(),l=function(e){const t=512;if(function(e){return e.hasOwnProperty("tileInfo")}(e)){const i=e?.tileInfo;return null!=i&&(null==i.rows&&(i.rows=t),null==i.cols&&(i.cols=t)),e}const i={xmin:-20037507.067161843,ymin:-20037507.067161843,xmax:20037507.067161843,ymax:20037507.067161843,spatialReference:{wkid:102100,latestWkid:3857}};let r=null;if(W(e)){const{bounds:t}=e;if(t){const e=(0,N.$)({x:t[0],y:t[1],spatialReference:(0,a.d9)(D.YU)}),i=(0,N.$)({x:t[2],y:t[3],spatialReference:(0,a.d9)(D.YU)});r={xmin:e.x,ymin:e.y,xmax:i.x,ymax:i.y,spatialReference:(0,a.d9)(D.IU)}}}null===r&&(r=i);let n=78271.51696400007,s=295828763.7957775;const o=[],l=e.hasOwnProperty("maxzoom")&&null!=e.maxzoom?+e.maxzoom:22,c=0,u=0;for(let e=0;e<=l;e++)o.push({level:e,scale:s,resolution:n}),n/=2,s/=2;return{capabilities:"TilesOnly",initialExtent:r,fullExtent:i,minScale:c,maxScale:u,tiles:e.tiles,tileInfo:{rows:t,cols:t,dpi:96,format:"pbf",origin:{x:-20037508.342787,y:20037508.342787},lods:o,spatialReference:(0,a.d9)(D.IU)}}}(t),c=new j(n,(0,u.fl)(o,s?.query??{}),l);if(!r&&e.primarySourceName in e.sourceNameToSource){const t=e.sourceNameToSource[e.primarySourceName];if(!t.isCompatibleWith(c))return;null!=c.fullExtent&&(null!=t.fullExtent?t.fullExtent.union(c.fullExtent):t.fullExtent=c.fullExtent.clone()),t.tileInfo&&c.tileInfo&&t.tileInfo.lods.length<c.tileInfo.lods.length&&(t.tileInfo=c.tileInfo)}if(r&&(e.sourceBase=o,e.source=t,e.validatedSource=l,e.primarySourceName=n),e.sourceNameToSource[n]=c,!W(e)&&"defaultStyles"in t&&!e.style){if(null==t.defaultStyles)throw new Error;return"string"==typeof t.defaultStyles?q(e,"",Z(o,t.defaultStyles,"root.json"),void 0,s):q(e,"",t.defaultStyles,Z(o,"root.json"),s)}}var J=i(84513),X=i(71924),K=i(16641),Q=i(10186),ee=i(13054);const te=1e-6;function ie(e,t){if(e===t)return!0;if(null==e&&null!=t)return!1;if(null!=e&&null==t)return!1;if(null==e||null==t)return!1;if(!e.spatialReference.equals(t.spatialReference)||e.dpi!==t.dpi)return!1;const i=e.origin,r=t.origin;if(Math.abs(i.x-r.x)>=te||Math.abs(i.y-r.y)>=te)return!1;let n,s;e.lods[0].scale>t.lods[0].scale?(n=e,s=t):(s=e,n=t);for(let e=n.lods[0].scale;e>=s.lods[s.lods.length-1].scale-te;e/=2)if(Math.abs(e-s.lods[0].scale)<te)return!0;return!1}function re(e,t){if(e===t)return e;if(null==e&&null!=t)return t;if(null!=e&&null==t)return e;if(null==e||null==t)return null;const i=e.size[0],r=e.format,n=e.dpi,s=new Q.Z({x:e.origin.x,y:e.origin.y}),o=e.spatialReference,a=e.lods[0].scale>t.lods[0].scale?e.lods[0]:t.lods[0],l=e.lods[e.lods.length-1].scale<=t.lods[t.lods.length-1].scale?e.lods[e.lods.length-1]:t.lods[t.lods.length-1],c=a.scale,u=a.resolution,h=l.scale,d=[];let p=c,f=u,m=0;for(;p>=h;)d.push(new ee.Z({level:m,resolution:f,scale:p})),m++,p/=2,f/=2;return new I.Z({size:[i,i],dpi:n,format:r||"pbf",origin:s,lods:d,spatialReference:o})}var ne=i(63043),se=i(35119);let oe=class extends((0,x.h7)((0,M.M)((0,E.Q)((0,b.Z)((0,w.Y)((0,C.q)((0,S.I)((0,T.N)((0,v.V)((0,l.R)(_.Z))))))))))){constructor(...e){super(...e),this._spriteSourceMap=new Map,this.currentStyleInfo=null,this.isReference=null,this.operationalLayerType="VectorTileLayer",this.path=null,this.refreshInterval=0,this.style=null,this.tilemapCache=null,this.type="vector-tile",this.url=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}destroy(){if(this.sourceNameToSource)for(const e of Object.values(this.sourceNameToSource))e?.destroy();this.primarySource?.destroy(),this._spriteSourceMap.clear()}async prefetchResources(e){await this.loadSpriteSource(globalThis.devicePixelRatio||1,e)}load(e){const t=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},e).catch(c.r9).then((async()=>{if(!this.portalItem?.id)return;const t=`${this.portalItem.itemCdnUrl}/resources/styles/root.json`;(await(0,n.Z)(t,{...e,query:{f:"json",...this.customParameters,token:this.apiKey},authMode:this.portalItem.portal.authMode})).data&&this.read({url:t},(0,J.h)(this.portalItem,"portal-item"))})).catch(c.r9).then((()=>this._loadStyle(e)));return this.addResolvingPromise(t),Promise.resolve(this)}get attributionDataUrl(){const e=this.currentStyleInfo,t=e?.serviceUrl&&(0,u.mN)(e.serviceUrl);if(!t)return null;const i=this._getDefaultAttribution(t.path);return i?(0,u.fl)(i,{...this.customParameters,token:this.apiKey}):null}get capabilities(){const e=this.primarySource;return e?e.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}}get fullExtent(){return this.primarySource?.fullExtent||null}get initialExtent(){return this.primarySource?.initialExtent||null}get parsedUrl(){return this.serviceUrl?(0,u.mN)(this.serviceUrl):null}get serviceUrl(){return this.currentStyleInfo?.serviceUrl||null}get spatialReference(){return this.tileInfo?.spatialReference??null}get styleUrl(){return this.currentStyleInfo?.styleUrl||null}writeStyleUrl(e,t){e&&(0,u.oC)(e)&&(e=`https:${e}`);const i=(0,X.a5)(e);t.styleUrl=(0,K.e)(e,i)}get tileInfo(){const e=[];for(const t in this.sourceNameToSource)e.push(this.sourceNameToSource[t]);let t=this.primarySource?.tileInfo||new I.Z;if(e.length>1)for(let i=0;i<e.length;i++)ie(t,e[i].tileInfo)&&(t=re(t,e[i].tileInfo));return t}readTilemapCache(e,t){const i=t.capabilities?.includes("Tilemap");return i?new L.y({layer:this}):null}readVersion(e,t){return t.version?parseFloat(t.version):parseFloat(t.currentVersion)}async loadSpriteSource(e=1,t){if(!this._spriteSourceMap.has(e)){const i=(0,se.h)().maxTextureSize,r=this.currentStyleInfo?.spriteUrl?(0,u.fl)(this.currentStyleInfo.spriteUrl,{...this.customParameters,token:this.apiKey}):null,n=new O({type:"url",spriteUrl:r,pixelRatio:e,spriteFormat:this.currentStyleInfo?.spriteFormat},i);await n.load(t),this._spriteSourceMap.set(e,n)}return this._spriteSourceMap.get(e)}async setSpriteSource(e,t){if(!e)return null;const i=(0,se.h)().maxTextureSize,r=e.spriteUrl,n=r?(0,u.fl)(r,{...this.customParameters,token:this.apiKey}):null;if(!n&&"url"===e.type)return null;const s=new O(e,i);try{await s.load(t);const i=e.pixelRatio||1;return this._spriteSourceMap.clear(),this._spriteSourceMap.set(i,s),n&&this.currentStyleInfo&&(this.currentStyleInfo.spriteUrl=n),this.emit("spriteSource-change",{spriteSource:s}),s}catch(e){(0,c.r9)(e)}return null}async loadStyle(e,t){const i=e||this.style||this.url;return this._loadingTask&&"string"==typeof i&&this.url===i||(this._loadingTask?.abort(),this._loadingTask=(0,s.vr)((e=>(this._spriteSourceMap.clear(),this._getSourceAndStyle(i,{signal:e}))),t)),this._loadingTask.promise}getStyleLayerId(e){return this.styleRepository.getStyleLayerId(e)}getStyleLayerIndex(e){return this.styleRepository.getStyleLayerIndex(e)}getPaintProperties(e){return(0,a.d9)(this.styleRepository?.getPaintProperties(e))}setPaintProperties(e,t){const i=this.styleRepository.isPainterDataDriven(e);this.styleRepository.setPaintProperties(e,t);const r=this.styleRepository.isPainterDataDriven(e);this.emit("paint-change",{layer:e,paint:t,isDataDriven:i||r})}getStyleLayer(e){return(0,a.d9)(this.styleRepository.getStyleLayer(e))}setStyleLayer(e,t){this.styleRepository.setStyleLayer(e,t),this.emit("style-layer-change",{layer:e,index:t})}deleteStyleLayer(e){this.styleRepository.deleteStyleLayer(e),this.emit("delete-style-layer",{layer:e})}getLayoutProperties(e){return(0,a.d9)(this.styleRepository.getLayoutProperties(e))}setLayoutProperties(e,t){this.styleRepository.setLayoutProperties(e,t),this.emit("layout-change",{layer:e,layout:t})}setStyleLayerVisibility(e,t){this.styleRepository.setStyleLayerVisibility(e,t),this.emit("style-layer-visibility-change",{layer:e,visibility:t})}getStyleLayerVisibility(e){return this.styleRepository.getStyleLayerVisibility(e)}write(e,t){return t?.origin&&!this.styleUrl?(t.messages&&t.messages.push(new o.Z("vectortilelayer:unsupported",`VectorTileLayer (${this.title}, ${this.id}) with style defined by JSON only are not supported`,{layer:this})),null):super.write(e,t)}getTileUrl(e,t,i){return null}async _getSourceAndStyle(e,t){if(!e)throw new Error("invalid style!");const i=await async function(e,t){const i={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[r,n]="string"==typeof e?[e,null]:[null,e.jsonUrl];return await q(i,"esri",e,n,t),{layerDefinition:i.validatedSource,url:r,serviceUrl:i.sourceUrl,style:i.style,styleUrl:i.styleUrl,spriteUrl:i.style.sprite&&Z(i.styleBase,i.style.sprite),spriteFormat:i.spriteFormat,glyphsUrl:i.style.glyphs&&Z(i.styleBase,i.style.glyphs),sourceNameToSource:i.sourceNameToSource,primarySourceName:i.primarySourceName}}(e,{...t,query:{...this.customParameters,token:this.apiKey}});"webp"===i.spriteFormat&&(await function(e){if(A)return A;const t={lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};return A=new Promise((i=>{const r=new Image;r.onload=()=>{r.onload=r.onerror=null,i(r.width>0&&r.height>0)},r.onerror=()=>{r.onload=r.onerror=null,i(!1)},r.src="data:image/webp;base64,"+t[e]})),A}("lossy")||(i.spriteFormat="png")),this._set("currentStyleInfo",{...i}),"string"==typeof e?(this.url=e,this.style=null):(this.url=null,this.style=e),this._set("sourceNameToSource",i.sourceNameToSource),this._set("primarySource",i.sourceNameToSource[i.primarySourceName]),this._set("styleRepository",new ne.Z(i.style)),this.read(i.layerDefinition,{origin:"service"}),this.emit("load-style")}_getDefaultAttribution(e){const t=e.match(/^https?:\/\/(?:basemaps|basemapsbeta|basemapsdev)(?:-api)?\.arcgis\.com(\/[^/]+)?\/arcgis\/rest\/services\/([^/]+(\/[^/]+)*)\/vectortileserver/i),i=["OpenBasemap_v2","OpenBasemap_GCS_v2","OpenStreetMap_v2","OpenStreetMap_Daylight_v2","OpenStreetMap_Export_v2","OpenStreetMap_FTS_v2","OpenStreetMap_GCS_v2","World_Basemap","World_Basemap_v2","World_Basemap_Export_v2","World_Basemap_GCS_v2","World_Basemap_WGS84","World_Contours_v2","World_Hillshade_v2"];if(!t)return;const r=t[2]&&t[2].toLowerCase();if(!r)return;const n=t[1]||"";for(const e of i)if(e.toLowerCase().includes(r))return(0,u.Fv)(`//static.arcgis.com/attribution/Vector${n}/${e}`)}async _loadStyle(e){return this._loadingTask?.promise??this.loadStyle(null,e)}};(0,r._)([(0,h.Cb)({readOnly:!0})],oe.prototype,"attributionDataUrl",null),(0,r._)([(0,h.Cb)({type:["show","hide"]})],oe.prototype,"listMode",void 0),(0,r._)([(0,h.Cb)({json:{read:!0,write:!0}})],oe.prototype,"blendMode",void 0),(0,r._)([(0,h.Cb)({readOnly:!0,json:{read:!1}})],oe.prototype,"capabilities",null),(0,r._)([(0,h.Cb)({readOnly:!0})],oe.prototype,"currentStyleInfo",void 0),(0,r._)([(0,h.Cb)({json:{read:!1},readOnly:!0,type:g.Z})],oe.prototype,"fullExtent",null),(0,r._)([(0,h.Cb)({json:{read:!1},readOnly:!0,type:g.Z})],oe.prototype,"initialExtent",null),(0,r._)([(0,h.Cb)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],oe.prototype,"isReference",void 0),(0,r._)([(0,h.Cb)({type:["VectorTileLayer"]})],oe.prototype,"operationalLayerType",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],oe.prototype,"parsedUrl",null),(0,r._)([(0,h.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],oe.prototype,"path",void 0),(0,r._)([(0,h.Cb)({type:Number,json:{write:!1,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],oe.prototype,"refreshInterval",void 0),(0,r._)([(0,h.Cb)()],oe.prototype,"style",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],oe.prototype,"serviceUrl",null),(0,r._)([(0,h.Cb)({type:y.Z,readOnly:!0})],oe.prototype,"spatialReference",null),(0,r._)([(0,h.Cb)({readOnly:!0})],oe.prototype,"styleRepository",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],oe.prototype,"sourceNameToSource",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],oe.prototype,"primarySource",void 0),(0,r._)([(0,h.Cb)({type:String,readOnly:!0,json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],oe.prototype,"styleUrl",null),(0,r._)([(0,m.c)(["portal-item","web-document"],"styleUrl")],oe.prototype,"writeStyleUrl",null),(0,r._)([(0,h.Cb)({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:I.Z})],oe.prototype,"tileInfo",null),(0,r._)([(0,h.Cb)()],oe.prototype,"tilemapCache",void 0),(0,r._)([(0,p.r)("service","tilemapCache",["capabilities","tileInfo"])],oe.prototype,"readTilemapCache",null),(0,r._)([(0,h.Cb)({json:{read:!1},readOnly:!0,value:"vector-tile"})],oe.prototype,"type",void 0),(0,r._)([(0,h.Cb)({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],oe.prototype,"url",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],oe.prototype,"version",void 0),(0,r._)([(0,p.r)("version",["version","currentVersion"])],oe.prototype,"readVersion",null),oe=(0,r._)([(0,f.j)("esri.layers.VectorTileLayer")],oe);const ae=oe},86573:(e,t,i)=>{i.d(t,{rk:()=>l,Tj:()=>c,GI:()=>u,CE:()=>h,Tq:()=>d,Zx:()=>p,Ee:()=>g});var r=i(86875),n=i(95550);function s(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}const o=s();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:function(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},create:s,createView:function(e,t){return new Float32Array(e,t,16)},fromValues:function(e,t,i,r,n,s,o,a,l,c,u,h,d,p,f,m){const g=new Float32Array(16);return g[0]=e,g[1]=t,g[2]=i,g[3]=r,g[4]=n,g[5]=s,g[6]=o,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g}},Symbol.toStringTag,{value:"Module"}));var a=i(32114);class l{constructor(e,t,i){this.strength=e,this.radius=t,this.threshold=i,this.type="bloom"}interpolate(e,t,i){this.strength=f(e.strength,t.strength,i),this.radius=f(e.radius,t.radius,i),this.threshold=f(e.threshold,t.threshold,i)}clone(){return new l(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:m(this.radius),strength:this.strength,threshold:this.threshold}}}class c{constructor(e){this.radius=e,this.type="blur"}interpolate(e,t,i){this.radius=Math.round(f(e.radius,t.radius,i))}clone(){return new c(this.radius)}toJSON(){return{type:"blur",radius:m(this.radius)}}}class u{constructor(e,t){this.type=e,this.amount=t,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,i){this.amount=f(e.amount,t.amount,i),this._updateMatrix()}clone(){return new u(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||s();switch(this.type){case"brightness":this._colorMatrix=((e,t)=>{const i=(0,a.t8)(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return(0,a.p4)(i,i)})(e,this.amount);break;case"contrast":this._colorMatrix=((e,t)=>{const i=(0,a.t8)(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return(0,a.p4)(i,i)})(e,this.amount);break;case"grayscale":this._colorMatrix=((e,t)=>{const i=1-t,r=(0,a.t8)(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return(0,a.p4)(r,r)})(e,this.amount);break;case"invert":this._colorMatrix=((e,t)=>{const i=1-2*t,r=(0,a.t8)(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return(0,a.p4)(r,r)})(e,this.amount);break;case"saturate":this._colorMatrix=((e,t)=>{const i=(0,a.t8)(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return(0,a.p4)(i,i)})(e,this.amount);break;case"sepia":this._colorMatrix=((e,t)=>{const i=1-t,r=(0,a.t8)(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return(0,a.p4)(r,r)})(e,this.amount)}}}class h{constructor(e,t,i,r){this.offsetX=e,this.offsetY=t,this.blurRadius=i,this.color=r,this.type="drop-shadow"}interpolate(e,t,i){this.offsetX=f(e.offsetX,t.offsetX,i),this.offsetY=f(e.offsetY,t.offsetY,i),this.blurRadius=f(e.blurRadius,t.blurRadius,i),this.color[0]=Math.round(f(e.color[0],t.color[0],i)),this.color[1]=Math.round(f(e.color[1],t.color[1],i)),this.color[2]=Math.round(f(e.color[2],t.color[2],i)),this.color[3]=f(e.color[3],t.color[3],i)}clone(){return new h(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:m(this.offsetX),yoffset:m(this.offsetY),blurRadius:m(this.blurRadius),color:e}}}class d{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,i){this.angle=f(e.angle,t.angle,i),this._updateMatrix()}clone(){return new d(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||s();this._colorMatrix=((e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),n=(0,a.t8)(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return(0,a.p4)(n,n)})(e,this.angle)}}class p{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,t,i){this.amount=f(e.amount,t.amount,i)}clone(){return new p(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function f(e,t,i){return e+(t-e)*i}function m(e){return Math.round(1e3*(0,n.Wz)(e))/1e3}function g(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new u(e.type,0);case"saturate":case"brightness":case"contrast":return new u(e.type,1);case"opacity":return new p(1);case"hue-rotate":return new d(0);case"blur":return new c(0);case"drop-shadow":return new h(0,0,0,[...(0,r.h$)("transparent")]);case"bloom":return new l(0,0,1)}}},50913:(e,t,i)=>{i.d(t,{cW:()=>l,ij:()=>a,rM:()=>c});var r=i(70375),n=i(86745),s=i(13045),o=i(60278);function a(e,t,i){try{return function(e){if(!e||0===e.length)return null;if(function(e){const t=e[0];return!!t&&"scale"in t}(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:c(i.value)});return t}return c(e)}(e)}catch(e){i?.messages?.push(e)}return null}function l(e,t,i,r){try{const r=function(e){const t=(0,s.Q)(e);return t?(0,o.Cb)(t)?t.map((e=>e.toJSON())):t.map((({scale:e,effects:t})=>({scale:e,value:t.map((e=>e.toJSON()))}))):null}(e);(0,n.RB)(i,r,t)}catch(e){r.messages&&r.messages.push(e)}}function c(e){if(!e?.length)return"";const t=[];for(const i of e){let e=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":e=[u(i,"amount")];break;case"blur":e=[u(i,"radius","pt")];break;case"hue-rotate":e=[u(i,"angle","deg")];break;case"drop-shadow":e=[u(i,"xoffset","pt"),u(i,"yoffset","pt"),u(i,"blurRadius","pt"),h(i,"color")];break;case"bloom":e=[u(i,"strength"),u(i,"radius","pt"),u(i,"threshold")]}const r=`${i.type}(${e.filter(Boolean).join(" ")})`;(0,s.Q)(r),t.push(r)}return t.join(" ")}function u(e,t,i){if(null==e[t])throw new r.Z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function h(e,t){if(null==e[t])throw new r.Z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}},13045:(e,t,i)=>{i.d(t,{Q:()=>u});var r=i(86875),n=i(70375),s=i(86573),o=i(60278);function a(e,t,i,r){var n=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(n,a.prototype),n.expected=t,n.found=i,n.location=r,n.name="SyntaxError",n}function l(e,t,i){return i=i||" ",e.length>t?e:(t-=e.length,e+(i+=i.repeat(t)).slice(0,t))}function c(e,t){var i,r={},n=(t=void 0!==t?t:{}).grammarSource,s={start:ce},o=ce,l="none",c=",",u="grad",h="turn",d=/^[ \t\n\r]/,p=/^[a-z\-]/,f=/^[0-9a-fA-F]/,m=/^[+\-]/,g=/^[0-9]/,y=se("none"),_=re("none",!1),v=re(")",!1),b=re(",",!1),w=se("whitespace"),x=ne([" ","\t","\n","\r"],!1,!1),T=se("function"),C=re("(",!1),S=se("identifier"),E=ne([["a","z"],"-"],!1,!1),M=se("percentage"),A=re("%",!1),R=se("length"),O=re("px",!1),P=re("cm",!1),I=re("mm",!1),L=re("in",!1),D=re("pt",!1),N=re("pc",!1),F=se("angle"),U=re("deg",!1),k=re("rad",!1),z=re("grad",!1),B=re("turn",!1),V=se("number"),H=se("color"),G=re("#",!1),j=ne([["0","9"],["a","f"],["A","F"]],!1,!1),Z=ne(["+","-"],!1,!1),q=ne([["0","9"]],!1,!1),W=re(".",!1),$=re("e",!1),Y=function(e,t){return t.length>0?function(e,t,i){return[e].concat(function(e,t){return e.map((function(e){return e[t]}))}(t,i))}(e,t,3):[e]},J=0|t.peg$currPos,X=J,K=[{line:1,column:1}],Q=J,ee=t.peg$maxFailExpected||[],te=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=s[t.startRule]}function ie(){return e.substring(X,J)}function re(e,t){return{type:"literal",text:e,ignoreCase:t}}function ne(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function se(e){return{type:"other",description:e}}function oe(t){var i,r=K[t];if(r)return r;if(t>=K.length)i=K.length-1;else for(i=t;!K[--i];);for(r={line:(r=K[i]).line,column:r.column};i<t;)10===e.charCodeAt(i)?(r.line++,r.column=1):r.column++,i++;return K[t]=r,r}function ae(e,t,i){var r=oe(e),s=oe(t);return{source:n,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:s.line,column:s.column}}}function le(e){J<Q||(J>Q&&(Q=J,ee=[]),ee.push(e))}function ce(){var e;return(e=ue())===r&&(e=function(){var e,t;if(e=[],(t=he())!==r)for(;t!==r;)e.push(t),t=he();else e=r;return e}()),e}function ue(){var t,i;return te++,t=J,pe(),e.substr(J,4)===l?(i=l,J+=4):(i=r,0===te&&le(_)),i!==r?(pe(),X=t,t=[]):(J=t,t=r),te--,t===r&&0===te&&le(y),t}function he(){var t,i,n,s;return t=J,pe(),(i=function(){var t,i,n;return te++,t=J,(i=fe())!==r?(40===e.charCodeAt(J)?(n="(",J++):(n=r,0===te&&le(C)),n!==r?(X=t,t=i):(J=t,t=r)):(J=t,t=r),te--,t===r&&(i=r,0===te&&le(T)),t}())!==r?(pe(),(n=function(){var t,i,n,s,o,a,l,u;if(t=J,(i=de())!==r){for(n=[],s=J,o=pe(),44===e.charCodeAt(J)?(a=c,J++):(a=r,0===te&&le(b)),a===r&&(a=null),l=pe(),(u=de())!==r?s=o=[o,a,l,u]:(J=s,s=r);s!==r;)n.push(s),s=J,o=pe(),44===e.charCodeAt(J)?(a=c,J++):(a=r,0===te&&le(b)),a===r&&(a=null),l=pe(),(u=de())!==r?s=o=[o,a,l,u]:(J=s,s=r);X=t,t=Y(i,n)}else J=t,t=r;return t}())===r&&(n=null),pe(),41===e.charCodeAt(J)?(s=")",J++):(s=r,0===te&&le(v)),s!==r?(pe(),X=t,t=function(e,t){return{type:"function",name:e,parameters:t||[]}}(i,n)):(J=t,t=r)):(J=t,t=r),t}function de(){var e,t;return e=J,(t=me())===r&&(t=ge())===r&&(t=ye())===r&&(t=function(){var e,t;return te++,e=J,pe(),(t=ve())!==r?(X=e,e=function(e){return{value:e,unit:null}}(t)):(J=e,e=r),te--,e===r&&0===te&&le(V),e}()),t!==r&&(X=e,t=function(e){return{type:"quantity",value:e.value,unit:e.unit}}(t)),(e=t)===r&&(e=J,(t=_e())!==r&&(X=e,t=function(e){return{type:"color",colorType:e.type,value:e.value}}(t)),e=t),e}function pe(){var t,i;for(te++,t=[],i=e.charAt(J),d.test(i)?J++:(i=r,0===te&&le(x));i!==r;)t.push(i),i=e.charAt(J),d.test(i)?J++:(i=r,0===te&&le(x));return te--,i=r,0===te&&le(w),t}function fe(){var t,i,n;if(te++,t=J,i=[],n=e.charAt(J),p.test(n)?J++:(n=r,0===te&&le(E)),n!==r)for(;n!==r;)i.push(n),n=e.charAt(J),p.test(n)?J++:(n=r,0===te&&le(E));else i=r;return i!==r&&(X=t,i=ie()),te--,(t=i)===r&&(i=r,0===te&&le(S)),t}function me(){var t,i,n;return te++,t=J,pe(),(i=ve())!==r?(37===e.charCodeAt(J)?(n="%",J++):(n=r,0===te&&le(A)),n!==r?(X=t,t=function(e){return{value:e,unit:"%"}}(i)):(J=t,t=r)):(J=t,t=r),te--,t===r&&0===te&&le(M),t}function ge(){var t,i,n;return te++,t=J,pe(),(i=ve())!==r?("px"===e.substr(J,2)?(n="px",J+=2):(n=r,0===te&&le(O)),n!==r?(X=t,t=function(e){return{value:e,unit:"px"}}(i)):(J=t,t=r)):(J=t,t=r),t===r&&(t=J,pe(),(i=ve())!==r?("cm"===e.substr(J,2)?(n="cm",J+=2):(n=r,0===te&&le(P)),n!==r?(X=t,t=function(e){return{value:e,unit:"cm"}}(i)):(J=t,t=r)):(J=t,t=r),t===r&&(t=J,pe(),(i=ve())!==r?("mm"===e.substr(J,2)?(n="mm",J+=2):(n=r,0===te&&le(I)),n!==r?(X=t,t=function(e){return{value:e,unit:"mm"}}(i)):(J=t,t=r)):(J=t,t=r),t===r&&(t=J,pe(),(i=ve())!==r?("in"===e.substr(J,2)?(n="in",J+=2):(n=r,0===te&&le(L)),n!==r?(X=t,t=function(e){return{value:e,unit:"in"}}(i)):(J=t,t=r)):(J=t,t=r),t===r&&(t=J,pe(),(i=ve())!==r?("pt"===e.substr(J,2)?(n="pt",J+=2):(n=r,0===te&&le(D)),n!==r?(X=t,t=function(e){return{value:e,unit:"pt"}}(i)):(J=t,t=r)):(J=t,t=r),t===r&&(t=J,pe(),(i=ve())!==r?("pc"===e.substr(J,2)?(n="pc",J+=2):(n=r,0===te&&le(N)),n!==r?(X=t,t=function(e){return{value:e,unit:"pc"}}(i)):(J=t,t=r)):(J=t,t=r)))))),te--,t===r&&0===te&&le(R),t}function ye(){var t,i,n;return te++,t=J,(i=ve())!==r?("deg"===e.substr(J,3)?(n="deg",J+=3):(n=r,0===te&&le(U)),n!==r?(X=t,t=function(e){return{value:e,unit:"deg"}}(i)):(J=t,t=r)):(J=t,t=r),t===r&&(t=J,(i=ve())!==r?("rad"===e.substr(J,3)?(n="rad",J+=3):(n=r,0===te&&le(k)),n!==r?(X=t,t=function(e){return{value:e,unit:"rad"}}(i)):(J=t,t=r)):(J=t,t=r),t===r&&(t=J,(i=ve())!==r?(e.substr(J,4)===u?(n=u,J+=4):(n=r,0===te&&le(z)),n!==r?(X=t,t=function(e){return{value:e,unit:"grad"}}(i)):(J=t,t=r)):(J=t,t=r),t===r&&(t=J,(i=ve())!==r?(e.substr(J,4)===h?(n=h,J+=4):(n=r,0===te&&le(B)),n!==r?(X=t,t=function(e){return{value:e,unit:"turn"}}(i)):(J=t,t=r)):(J=t,t=r)))),te--,t===r&&(i=r,0===te&&le(F)),t}function _e(){var t,i,n,s;if(te++,t=J,35===e.charCodeAt(J)?(i="#",J++):(i=r,0===te&&le(G)),i!==r){if(n=[],s=e.charAt(J),f.test(s)?J++:(s=r,0===te&&le(j)),s!==r)for(;s!==r;)n.push(s),s=e.charAt(J),f.test(s)?J++:(s=r,0===te&&le(j));else n=r;n!==r?(X=t,t={type:"hex",value:ie()}):(J=t,t=r)}else J=t,t=r;return t===r&&(t=J,(i=he())!==r&&(X=t,i=function(e){return{type:"function",value:e}}(i)),(t=i)===r&&(t=J,(i=fe())!==r&&(X=t,i={type:"named",value:ie()}),t=i)),te--,t===r&&(i=r,0===te&&le(H)),t}function ve(){var t,i,n,s,o,a,l,c;for(t=J,i=e.charAt(J),m.test(i)?J++:(i=r,0===te&&le(Z)),i===r&&(i=null),n=J,s=[],o=e.charAt(J),g.test(o)?J++:(o=r,0===te&&le(q));o!==r;)s.push(o),o=e.charAt(J),g.test(o)?J++:(o=r,0===te&&le(q));if(46===e.charCodeAt(J)?(o=".",J++):(o=r,0===te&&le(W)),o!==r){if(a=[],l=e.charAt(J),g.test(l)?J++:(l=r,0===te&&le(q)),l!==r)for(;l!==r;)a.push(l),l=e.charAt(J),g.test(l)?J++:(l=r,0===te&&le(q));else a=r;a!==r?n=s=[s,o,a]:(J=n,n=r)}else J=n,n=r;if(n===r)if(n=[],s=e.charAt(J),g.test(s)?J++:(s=r,0===te&&le(q)),s!==r)for(;s!==r;)n.push(s),s=e.charAt(J),g.test(s)?J++:(s=r,0===te&&le(q));else n=r;if(n!==r){if(s=J,101===e.charCodeAt(J)?(o="e",J++):(o=r,0===te&&le($)),o!==r){if(a=e.charAt(J),m.test(a)?J++:(a=r,0===te&&le(Z)),a===r&&(a=null),l=[],c=e.charAt(J),g.test(c)?J++:(c=r,0===te&&le(q)),c!==r)for(;c!==r;)l.push(c),c=e.charAt(J),g.test(c)?J++:(c=r,0===te&&le(q));else l=r;l!==r?s=o=[o,a,l]:(J=s,s=r)}else J=s,s=r;s===r&&(s=null),X=t,t=parseFloat(ie())}else J=t,t=r;return t}if(i=o(),t.peg$library)return{peg$result:i,peg$currPos:J,peg$FAILED:r,peg$maxFailExpected:ee,peg$maxFailPos:Q};if(i!==r&&J===e.length)return i;throw i!==r&&J<e.length&&le({type:"end"}),function(e,t,i){return new a(a.buildMessage(e,t),e,t,i)}(ee,Q<e.length?e.charAt(Q):null,Q<e.length?ae(Q,Q+1):ae(Q,Q))}function u(e){if(!e||0===e.length)return null;if("string"==typeof e){const t=h(e);return t&&0!==t.length?t:null}const t=e.map((e=>{if(!Number.isFinite(e.scale)||e.scale<=0)throw new n.Z("effect:invalid-scale","scale must be finite and greater than 0",{stop:e});return{scale:e.scale,effects:h(e.value)}}));t.sort(((e,t)=>t.effects.length-e.effects.length));for(let e=0;e<t.length-1;e++){if(!(0,o.AS)(t[e].effects,t[e+1].effects))throw new n.Z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[e].effects,b:t[e+1].effects});(0,o.uF)(t[e].effects,t[e+1].effects)}return t.sort(((e,t)=>t.scale-e.scale)),t}function h(e){let t;if(!e)return[];try{t=c(e)}catch(t){throw new n.Z("effect:invalid-syntax","Invalid effect syntax",{value:e,error:t})}return t.map((e=>function(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(e){let t=1;return d(e.parameters,1),1===e.parameters.length&&(t=y(e.parameters[0])),new s.GI(e.name,t)}(e);case"opacity":return function(e){let t=1;return d(e.parameters,1),1===e.parameters.length&&(t=y(e.parameters[0])),new s.Zx(t)}(e);case"hue-rotate":return function(e){let t=0;return d(e.parameters,1),1===e.parameters.length&&(t=function(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=m[e.unit]))throw new n.Z("effect:type-error",`Expected <angle>, Actual: ${p(e)}`,{term:e})}(e),e.value*m[e.unit]||0}(e.parameters[0])),new s.Tq(t)}(e);case"blur":return function(e){let t=0;return d(e.parameters,1),1===e.parameters.length&&(t=v(e.parameters[0]),f(t,e.parameters[0])),new s.Tj(t)}(e);case"drop-shadow":return function(e){const t=[];let i=null;for(const r of e.parameters)if("color"===r.type){if(t.length&&Object.freeze(t),i)throw new n.Z("effect:type-error","Accepts only one color",{});i=b(r)}else{const e=v(r);if(Object.isFrozen(t))throw new n.Z("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&f(e,r)}if(t.length<2||t.length>3)throw new n.Z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new s.CE(t[0],t[1],t[2]||0,i||w("black"))}(e);case"bloom":return function(e){let t=1,i=0,r=0;return d(e.parameters,3),e.parameters[0]&&(t=y(e.parameters[0])),e.parameters[1]&&(i=v(e.parameters[1]),f(i,e.parameters[1])),e.parameters[2]&&(r=y(e.parameters[2])),new s.rk(t,i,r)}(e)}}catch(t){throw t.details.filter=e,t}throw new n.Z("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}(e)))}function d(e,t){if(e.length>t)throw new n.Z("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function p(e){if("color"===e.type)return"<color>";if(e.unit){if(e.unit in g)return"<length>";if(e.unit in m)return"<angle>";if("%"===e.unit)return"<percentage>"}return"<double>"}function f(e,t){if(e<0)throw new n.Z("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}(function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i})(a,Error),a.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var i,r=null;for(i=0;i<e.length;i++)if(e[i].source===this.location.source){r=e[i].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(n):n,o=this.location.source+":"+s.line+":"+s.column;if(r){var a=this.location.end,c=l("",s.line.toString().length," "),u=r[n.line-1],h=(n.line===a.line?a.column:u.length+1)-n.column||1;t+="\n --\x3e "+o+"\n"+c+" |\n"+s.line+" | "+u+"\n"+c+" | "+l("",n.column-1," ")+l("",h,"^")}else t+="\n at "+o}return t},a.buildMessage=function(e,t){var i={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function o(e){return i[e.type](e)}return"Expected "+function(e){var t,i,r=e.map(o);if(r.sort(),r.length>0){for(t=1,i=1;t<r.length;t++)r[t-1]!==r[t]&&(r[i]=r[t],i++);r.length=i}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."};const m={deg:1,grad:.9,rad:180/Math.PI,turn:360};const g={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function y(e){!function(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new n.Z("effect:type-error",`Expected <double> or <percentage>, Actual: ${p(e)}`,{term:e})}(e);const t=e.value;return f(t,e),"%"===e.unit?.01*t:t}function _(e){return function(e){if("quantity"!==e.type||null!==e.unit)throw new n.Z("effect:type-error",`Expected <double>, Actual: ${p(e)}`,{term:e})}(e),f(e.value,e),e.value}function v(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=g[e.unit]))throw new n.Z("effect:type-error",`Expected <length>, Actual: ${p(e)}`,{term:e})}(e),e.value*g[e.unit]||0}function b(e){switch(e.colorType){case"hex":return(0,r.rW)(e.value);case"named":return w(e.value);case"function":return function(e){if(d(e.parameters,4),x.test(e.name))return[y(e.parameters[0]),y(e.parameters[1]),y(e.parameters[2]),e.parameters[3]?y(e.parameters[3]):1];if(T.test(e.name))return(0,r.B7)(_(e.parameters[0]),y(e.parameters[1]),y(e.parameters[2]),e.parameters[3]?y(e.parameters[3]):1);throw new n.Z("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}(e.value)}}function w(e){if(!(0,r.St)(e))throw new n.Z("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return(0,r.VL)(e)}const x=/^rgba?/i,T=/^hsla?/i},60278:(e,t,i)=>{i.d(t,{AS:()=>n,Cb:()=>o,uF:()=>s,yQ:()=>a});var r=i(86573);function n(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every(((e,t)=>e.type===i[t].type))}function s(e,t){const i=e.length>t.length?e:t,n=e.length>t.length?t:e;for(let e=n.length;e<i.length;e++)n.push((0,r.Ee)(i[e]))}function o(e){const t=e[0];return!!t&&"type"in t}function a(e,t){return JSON.stringify(e??null)===JSON.stringify(t??null)}},59958:(e,t,i)=>{i.d(t,{S6:()=>a,u_:()=>o});var r=i(99235),n=i(33480),s=i(15540);class o{constructor(e=null,t={},i,r,n=0){this.geometry=e,this.attributes=t,this.centroid=i,this.objectId=r,this.displayId=n}static fromJSON(e){const t=e.geometry?s.Z.fromJSON(e.geometry):null,i=e.centroid?s.Z.fromJSON(e.centroid):null,r=e.objectId;return new o(t,e.attributes,i,r)}weakClone(){const e=new o(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),t=new o(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t}ensureCentroid(e){return this.centroid??=(0,n.Y)(new s.Z,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+(0,r.F$)(this.attributes)+(this.geometry?.usedMemory??0)}}function a(e){return!!e.geometry?.coords?.length}},61619:(e,t,i)=>{i.d(t,{Z:()=>r});class r{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new r;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},15540:(e,t,i)=>{i.d(t,{Z:()=>n});var r=i(99235);class n{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new n(e.lengths,e.coords)}static fromRect(e){const[t,i,r,s]=e,o=r-t,a=s-i;return new n([5],[t,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}get usedMemory(){return 64+(0,r.G7)(this.lengths,this.coords)}area(){let e=0,t=0;if(!this.lengths.length)return 0;for(let i=0;i<this.lengths.length;i++){const r=this.lengths[i];if(r<3)continue;let n=this.coords[2*t],s=this.coords[2*t+1];for(let i=1;i<r;i+=1){const r=this.coords[2*(i+t)],o=this.coords[2*(i+t)+1];e+=-.5*(r-n)*(o+s),n=r,s=o}t+=r}return e}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const r=this.lengths[i];for(let i=0;i<r;i++)e(this.coords[2*(i+t)],this.coords[2*(i+t)+1]);t+=r}}deltaDecode(){const e=this.clone(),{coords:t,lengths:i}=e;let r=0;for(const e of i){for(let i=1;i<e;i++)t[2*(r+i)]+=t[2*(r+i)-2],t[2*(r+i)+1]+=t[2*(r+i)-1];r+=e}return e}clone(e){if(0===this.lengths.length)return new n([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),i=this.coords.slice(0,t);return e?(e.set(i),new n(this.lengths,e)):new n(Array.from(this.lengths),Array.from(i))}}},33480:(e,t,i)=>{function r(e,t){return e?t?4:3:t?3:2}function n(e,t,i,n){if(!t?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const a=e.coords,l=[],c=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:h}=t,d=r(i,n);let p=0;for(const e of u){const t=s(c,h,p,e,i,n);t&&l.push(t),p+=e*d}if(l.sort(((e,t)=>{let r=e[2]-t[2];return 0===r&&i&&(r=e[4]-t[4]),r})),l.length){let e=6*l[0][2];a[0]=l[0][0]/e,a[1]=l[0][1]/e,i&&(e=6*l[0][4],a[2]=0!==e?l[0][3]/e:0),(a[0]<c[0]||a[0]>c[1]||a[1]<c[2]||a[1]>c[3]||i&&(a[2]<c[4]||a[2]>c[5]))&&(a.length=0)}if(!a.length){const e=t.lengths[0]?o(h,0,u[0],i,n):null;if(!e)return null;a[0]=e[0],a[1]=e[1],i&&e.length>2&&(a[2]=e[2])}return e}function s(e,t,i,n,s,o){const a=r(s,o);let l=i,c=i+a,u=0,h=0,d=0,p=0,f=0;for(let i=0,r=n-1;i<r;i++,l+=a,c+=a){const i=t[l],r=t[l+1],n=t[l+2],o=t[c],a=t[c+1],m=t[c+2];let g=i*a-o*r;p+=g,u+=(i+o)*g,h+=(r+a)*g,s&&(g=i*m-o*n,d+=(n+m)*g,f+=g),i<e[0]&&(e[0]=i),i>e[1]&&(e[1]=i),r<e[2]&&(e[2]=r),r>e[3]&&(e[3]=r),s&&(n<e[4]&&(e[4]=n),n>e[5]&&(e[5]=n))}if(p>0&&(p*=-1),f>0&&(f*=-1),!p)return null;const m=[u,h,.5*p];return s&&(m[3]=d,m[4]=.5*f),m}function o(e,t,i,n,s){const o=r(n,s);let h=t,d=t+o,p=0,f=0,m=0,g=0;for(let t=0,r=i-1;t<r;t++,h+=o,d+=o){const t=e[h],i=e[h+1],r=e[h+2],s=e[d],o=e[d+1],y=e[d+2],_=n?l(t,i,r,s,o,y):a(t,i,s,o);if(_)if(p+=_,n){const e=u(t,i,r,s,o,y);f+=_*e[0],m+=_*e[1],g+=_*e[2]}else{const e=c(t,i,s,o);f+=_*e[0],m+=_*e[1]}}return p>0?n?[f/p,m/p,g/p]:[f/p,m/p]:i>0?n?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function a(e,t,i,r){const n=i-e,s=r-t;return Math.sqrt(n*n+s*s)}function l(e,t,i,r,n,s){const o=r-e,a=n-t,l=s-i;return Math.sqrt(o*o+a*a+l*l)}function c(e,t,i,r){return[e+.5*(i-e),t+.5*(r-t)]}function u(e,t,i,r,n,s){return[e+.5*(r-e),t+.5*(n-t),i+.5*(s-i)]}i.d(t,{Y:()=>n})},96457:(e,t,i)=>{function r(e,t,i){return{objectId:e,target:t,distance:i,type:"vertex"}}function n(e,t,i,r,n,s=!1){return{objectId:e,target:t,distance:i,type:"edge",start:r,end:n,draped:s}}i.d(t,{p:()=>n,u:()=>r})},41109:(e,t,i)=>{i.d(t,{Fz:()=>l,fS:()=>u,kg:()=>a});i(39994);var r=i(19431),n=i(35925);function s(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const r=e[i],n=t[i];if(r.length!==n.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1}return!0}function o(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!s(e[i],t[i]))return!1;return!0}function a(e,t){return e===t||null!=e&&null!=t&&(0,n.fS)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function l(e,t,i){return e===t||null!=e&&null!=t&&(0,n.fS)(e.spatialReference,t.spatialReference)&&(0,r.W8)(e.x,t.x,i)&&(0,r.W8)(e.y,t.y,i)&&(0,r.W8)(e.z??0,t.z??0,i)&&(0,r.W8)(e.m??0,t.m??0,i)}function c(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return a(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,n.fS)(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,n.fS)(e.spatialReference,t.spatialReference)&&o(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,n.fS)(e.spatialReference,t.spatialReference)&&o(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,n.fS)(e.spatialReference,t.spatialReference)&&s(e.points,t.points)}(e,t);case"mesh":return!1;default:return}}function u(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!c(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const r of i)if(e[r]!==t[r])return!1;return!0}(e.attributes,t.attributes)}},94486:(e,t,i)=>{function r(e){return"point"===e.type}i.d(t,{f:()=>r})},48358:(e,t,i)=>{i.d(t,{FS:()=>w,MS:()=>T,PA:()=>m,Pj:()=>f,R3:()=>v,S6:()=>p,TF:()=>x,Wh:()=>d,Xw:()=>_,_0:()=>C,dF:()=>b,ph:()=>y});i(39994);var r=i(99235),n=i(7958),s=i(14685),o=i(37116),a=i(24568),l=i(7505),c=i(59659),u=i(12512),h=i(5709);i(41109);class d{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function p(e){return null!=e.geometry}class f{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function m(e,t){const i=c.Mk.fromJSON(e.geometryType),r=s.Z.fromJSON(e.spatialReference),o=e.transform,a=e.objectIdFieldName,h=t?.maxStringAttributeLength,d=t?.maxStringAttributeFields;let p;const f=e.features.map((t=>{const s=function(e,t,i,r){return{uid:(0,n.D)(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:g(e.geometry,t,i),visible:!0}}(t,i,r,e.objectIdFieldName),c=s.geometry;if(C(s.attributes,d,h,(e=>{p??=[];const t=T(s,a);null!=t&&p.push({objectId:t,attribute:e})})),null!=c&&o)switch(c.type){case"point":s.geometry=(0,l.U1)(o,c,c);break;case"multipoint":s.geometry=(0,l.J9)(o,c,c);break;case"polygon":s.geometry=(0,l.Ie)(o,c,c);break;case"polyline":s.geometry=(0,l.G6)(o,c,c);break;case"extent":case"mesh":s.geometry=c}return s}));return{geometryType:i,features:f,spatialReference:r,fields:e.fields?.map((e=>u.Z.fromJSON(e)))??[],objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null,missingAttributes:p}}function g(e,t,i){if(null==e)return null;switch(t){case"point":{const t=e;return{x:t.x,y:t.y,z:t.z,m:t.m,hasZ:null!=t.z,hasM:null!=t.m,type:"point",spatialReference:i}}case"polyline":{const t=e;return{paths:t.paths,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polyline",spatialReference:i}}case"polygon":{const t=e;return{rings:t.rings,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const t=e;return{points:t.points,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"multipoint",spatialReference:i}}}}function y(e){if(null==e)return 0;switch(e.type){case"point":return r.Mm+10+8+24;case"polyline":case"polygon":{let t=0;const i=2+(e.hasZ?1:0)+(e.hasM?1:0),n="polyline"===e.type?e.paths:e.rings;if(("polyline"===e.type?e.curvePaths:e.curveRings)?.length){const e=3*(0,h.wj)()*128;t=8*e*i+128*e+32*(n.length+1)}else t=(0,r.kk)(n);return r.Mm+64+t+34}case"multipoint":{const t=(0,r.kk)(e.points);return r.Mm+t+64+34+32}case"extent":return r.Mm+10+64+34;case"mesh":{const t=e.vertexAttributes;return r.Mm+(0,r.G7)(t.position,t.normal,t.uv,t.tangent)}default:return r.Mm}}function _(e){let t=32;return t+=(0,r.F$)(e.attributes),t+=3,t+=8+y(e.geometry),t}function v(e){if(null==e)return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function b(e){if(null==e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function w(e,t){switch((0,o.cS)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)(0,o.Wi)(t,e.paths[i],!!e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)(0,o.Wi)(t,e.rings[i],!!e.hasZ);break;case"multipoint":(0,o.Wi)(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function x(e,t){switch((0,a.cS)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)(0,a.Wi)(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)(0,a.Wi)(t,e.rings[i]);break;case"multipoint":(0,a.Wi)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function T(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}function C(e,t,i,r){if(t?.size&&null!=i&&e)for(const n in e){if(!t.has(n))continue;const s=e[n];"string"==typeof s&&s.length>i&&(r(n),e[n]="")}}},98196:(e,t,i)=>{function r(e,t,i,r){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:r,type:"point"}}function n(e,t,i,r,n){e.x=t,e.y=i,e.z=r,e.hasZ=null!=r,e.spatialReference=n}i.d(t,{T:()=>r,y:()=>n})},12065:(e,t,i)=>{i.d(t,{$:()=>se,$g:()=>oe,EI:()=>W,GH:()=>$,IN:()=>w,Iv:()=>F,J6:()=>k,Jd:()=>b,Nh:()=>te,RZ:()=>ee,Uy:()=>V,VG:()=>he,XA:()=>Z,Yn:()=>q,cn:()=>X,dd:()=>N,di:()=>Y,eG:()=>B,fQ:()=>S,hY:()=>ae,h_:()=>K,ks:()=>H,lM:()=>Q,lz:()=>ce,zj:()=>ie});var r=i(70375),n=i(13802),s=i(61681),o=i(37116),a=i(24568),l=i(53736),c=i(59958),u=i(61619),h=i(15540);function d(e,t){return e?t?4:3:t?3:2}const p=()=>n.Z.getLogger("esri.layers.graphics.featureConversionUtils"),f={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},m=(e,t,i,r,n,s)=>{e[i]=n,e[i+1]=s},g=(e,t,i,r,n,s)=>{e[i]=n,e[i+1]=s,e[i+2]=t[r+2]},y=(e,t,i,r,n,s)=>{e[i]=n,e[i+1]=s,e[i+2]=t[r+3]},_=(e,t,i,r,n,s)=>{e[i]=n,e[i+1]=s,e[i+2]=t[r+2],e[i+3]=t[r+3]};function v(e,t,i,r){if(e){if(i)return t&&r?_:g;if(t&&r)return y}else if(t&&r)return g;return m}function b({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function w({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function x({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function T({scale:e,translate:t},i){return Math.round((i-t[1])/e[1])}function C({scale:e,translate:t},i,r){return i*e[r]+t[r]}function S(e,t,i){return e?t?i?I(e):A(e):i?O(e):E(e):null}function E(e){const t=e.coords;return{x:t[0],y:t[1]}}function M(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function A(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function R(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function O(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function P(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function I(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function L(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function D(e,t){return e&&t?L:e?R:t?P:M}function N(e,t,i=D(null!=t.z,null!=t.m)){return i(e,t)}function F(e,t,i){if(null==e)return null;const r=d(t,i),n=[];for(let t=0;t<e.coords.length;t+=r){const i=[];for(let n=0;n<r;n++)i.push(e.coords[t+n]);n.push(i)}return t?i?{points:n,hasZ:t,hasM:i}:{points:n,hasZ:t}:i?{points:n,hasM:i}:{points:n}}function U(e,t,i=d(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let n=0;for(const e of t.points)for(let t=0;t<i;t++)r[n++]=e[t];return e}function k(e,t,i){if(!e)return null;const r=d(t,i),{coords:n,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let i=0;i<e;i++){const e=[];for(let t=0;t<r;t++)e.push(n[a++]);t.push(e)}o.push(t)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function z(e,t,i=d(t.hasZ,t.hasM)){const{lengths:r,coords:n}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<i;e++)n[s++]=t[e];r.push(e.length)}return e}function B(e,t,i){if(!e)return null;const r=d(t,i),{coords:n,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let i=0;i<e;i++){const e=[];for(let t=0;t<r;t++)e.push(n[a++]);t.push(e)}o.push(t)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function V(e,t,i=t.hasZ,r=t.hasM){return H(e,t.rings,i,r)}function H(e,t,i,r){const n=d(i,r),{lengths:s,coords:o}=e;let a=0;de(e);for(const e of t){for(const t of e)for(let e=0;e<n;e++)o[a++]=t[e];s.push(e.length)}return e}const G=[],j=[];function Z(e,t,i,r,n){G[0]=e;const[s]=q(j,G,t,i,r,n);return pe(G),pe(j),s}function q(e,t,i,n,s,o){if(pe(e),!i){for(const i of t){const t=o?i.attributes[o]:void 0;e.push(new c.u_(null,i.attributes,null,t))}return e}switch(i){case"esriGeometryPoint":return function(e,t,i,r,n){const s=D(i,r);for(const{geometry:i,attributes:r}of t){const t=null!=i?s(new h.Z,i):null;e.push(new c.u_(t,r,null,n?r[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryMultipoint":return function(e,t,i,r,n){const s=d(i,r);for(const{geometry:i,attributes:r}of t){const t=null!=i?U(new h.Z,i,s):null;e.push(new c.u_(t,r,null,n?r[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryPolyline":return function(e,t,i,r,n){const s=d(i,r);for(const{geometry:i,attributes:r,centroid:o}of t){const t=null!=i?z(new h.Z,i,s):null,a=null!=o?N(new h.Z,o):null;e.push(new c.u_(t,r,a,n?r[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,i,r,n){for(const{geometry:s,centroid:o,attributes:a}of t){const t=null!=s?V(new h.Z,s,i,r):null,l=n?a[n]:void 0;null!=o?e.push(new c.u_(t,a,M(new h.Z,o),l)):e.push(new c.u_(t,a,null,l))}return e}(e,t,n,s,o);default:p().error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${i}'`)),pe(e)}return e}function W(e,t,i,r){j[0]=e,J(G,j,t,i,r);const n=G[0];return pe(G),pe(j),n}function $(e,t,i){if(null==e)return null;const n=new h.Z;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==i&&(i=e.hasM),(0,l.wp)(e)?D(null!=t?t:null!=e.z,null!=i?i:null!=e.m)(n,e):(0,l.oU)(e)?V(n,e,t,i):(0,l.l9)(e)?z(n,e,d(t,i)):(0,l.aW)(e)?U(n,e,d(t,i)):void p().error("convertFromGeometry:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${e}'`))}function Y(e,t,i,n){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(t){case"esriGeometryPoint":{let e=E;return i&&n?e=I:i?e=A:n&&(e=O),e(s)}case"esriGeometryMultipoint":return F(s,i,n);case"esriGeometryPolyline":return k(s,i,n);case"esriGeometryPolygon":return B(s,i,n);default:return p().error("convertToGeometry:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${t}'`)),null}}function J(e,t,i,n,s){if(pe(e),null==i)return function(e,t){for(const i of t)e.push({attributes:i.attributes});return e}(e,t);switch(i){case"esriGeometryPoint":return function(e,t,i,r){let n=E;i&&r?n=I:i?n=A:r&&(n=O);for(const i of t){const{geometry:t,attributes:r}=i,s=null!=t?n(t):null;e.push({attributes:r,geometry:s})}return e}(e,t,n,s);case"esriGeometryMultipoint":return function(e,t,i,r){for(const{geometry:n,attributes:s}of t)e.push({attributes:s,geometry:null!=n?F(n,i,r):null});return e}(e,t,n,s);case"esriGeometryPolyline":return function(e,t,i,r){for(const{geometry:n,attributes:s}of t)e.push({attributes:s,geometry:null!=n?k(n,i,r):null});return e}(e,t,n,s);case"esriGeometryPolygon":return function(e,t,i,r){for(const{geometry:n,attributes:s,centroid:o}of t){const t=null!=n?B(n,i,r):null;if(null!=o){const i=E(o);e.push({attributes:s,centroid:i,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,t,n,s);default:p().error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${i}'`))}return e}function X(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:d}=e,p={features:J([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:u,queryGeometry:Y(h,d,!1,!1)};return r&&(p.transform=r),c&&(p.exceededTransferLimit=c),s&&(p.hasM=s),o&&(p.hasZ=o),p}function K(e,t){const i=new u.Z,{hasM:n,hasZ:s,features:o,objectIdFieldName:a,spatialReference:l,geometryType:c,exceededTransferLimit:h,transform:d,fields:f}=e;return f&&(i.fields=f),i.geometryType=c??null,i.objectIdFieldName=a??t??null,i.spatialReference=l??null,i.objectIdFieldName?(o&&q(i.features,o,c,s,n,i.objectIdFieldName),h&&(i.exceededTransferLimit=h),n&&(i.hasM=n),s&&(i.hasZ=s),d&&(i.transform=d),i):(p().error(new r.Z("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function Q(e){const{transform:t,features:i,hasM:r,hasZ:n}=e;if(!t)return e;for(const e of i)null!=e.geometry&&oe(e.geometry,e.geometry,r,n,t),null!=e.centroid&&oe(e.centroid,e.centroid,r,n,t);return e.transform=null,e}function ee(e,t){const{geometryType:i,features:r,hasM:n,hasZ:s}=t;if(!e)return t;for(let t=0;t<r.length;t++){const o=r[t],a=o.weakClone();a.geometry=new h.Z,te(a.geometry,o.geometry,n,s,i,e),o.centroid&&(a.centroid=new h.Z,te(a.centroid,o.centroid,n,s,"esriGeometryPoint",e)),r[t]=a}return t.transform=e,t}function te(e,t,i,r,n,s,o=i,a=r){if(de(e),!t?.coords.length)return null;const l=f[n],{coords:c,lengths:u}=t,h=d(i,r),p=d(i&&o,r&&a),m=v(i,r,o,a);if(!u.length)return m(e.coords,c,0,0,b(s,c[0]),w(s,c[1])),de(e,h,0),e;let g,y,_,x,T=0,C=0,S=C;for(const t of u){if(t<l)continue;let i=0;C=S,_=g=b(s,c[T]),x=y=w(s,c[T+1]),m(e.coords,c,C,T,_,x),i++,T+=h,C+=p;for(let r=1;r<t;r++,T+=h)_=b(s,c[T]),x=w(s,c[T+1]),_===g&&x===y||(m(e.coords,c,C,T,_-g,x-y),C+=p,i++,g=_,y=x);i>=l&&(e.lengths.push(i),S=C)}return pe(e.coords,S),e.coords.length?e:null}function ie(e,t,i,r,n,s,o=i,a=r){if(de(e),!t?.coords.length)return null;const l=f[n],{coords:c,lengths:u}=t,h=d(i,r),p=d(i&&o,r&&a),m=v(i,r,o,a);if(!u.length)return m(e.coords,c,0,0,c[0],c[1]),de(e,h,0),e;let g=0;const y=s*s;for(const t of u){if(t<l){g+=t*h;continue}const i=e.coords.length/p,r=g,n=g+(t-1)*h;m(e.coords,c,e.coords.length,r,c[r],c[r+1]),ne(e.coords,c,h,y,m,r,n),m(e.coords,c,e.coords.length,n,c[n],c[n+1]);const s=e.coords.length/p-i;s>=l?e.lengths.push(s):pe(e.coords,i*p),g+=t*h}return e.coords.length?e:null}function re(e,t,i,r){const n=e[t],s=e[t+1],o=e[i],a=e[i+1],l=e[r],c=e[r+1];let u=o,h=a,d=l-u,p=c-h;if(0!==d||0!==p){const e=((n-u)*d+(s-h)*p)/(d*d+p*p);e>1?(u=l,h=c):e>0&&(u+=d*e,h+=p*e)}return d=n-u,p=s-h,d*d+p*p}function ne(e,t,i,r,n,s,o){let a,l=r,c=0;for(let e=s+i;e<o;e+=i)a=re(t,e,s,o),a>l&&(c=e,l=a);l>r&&(c-s>i&&ne(e,t,i,r,n,s,c),n(e,t,e.length,c,t[c],t[c+1]),o-c>i&&ne(e,t,i,r,n,c,o))}function se(e,t,i,r){if(!t?.coords?.length)return null;const n=d(i,r);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=n){const i=e[t],r=e[t+1];s=Math.min(s,i),c=Math.max(c,i),l=Math.min(l,r),u=Math.max(u,r)}}return(0,o.is)(e)?(0,o.bZ)(e,s,l,c,u):(0,a.al)(s,l,c,u,e),e}function oe(e,t,i,r,n){const{coords:o,lengths:a}=t,l=d(i,r);if(!o.length)return e!==t&&de(e),e;(0,s.O3)(n);const{originPosition:c,scale:u,translate:h}=n,p=fe;p.originPosition=c;const f=p.scale;f[0]=u[0]??1,f[1]=-(u[1]??1),f[2]=u[2]??1,f[3]=u[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!a.length){for(let t=0;t<l;++t)e.coords[t]=C(p,o[t],t);return e!==t&&de(e,l,0),e}let g=0;for(let t=0;t<a.length;t++){const i=a[t];e.lengths[t]=i;for(let t=0;t<l;++t)e.coords[g+t]=C(p,o[g+t],t);let r=e.coords[g],n=e.coords[g+1];g+=l;for(let t=1;t<i;t++,g+=l){r+=o[g]*f[0],n+=o[g+1]*f[1],e.coords[g]=r,e.coords[g+1]=n;for(let t=2;t<l;++t)e.coords[g+t]=C(p,o[g+t],t)}}return e!==t&&de(e,o.length,a.length),e}function ae(e,t,i,r,n,s){if(de(e),e.lengths.push(...t.lengths),i===n&&r===s)for(let i=0;i<t.coords.length;i++)e.coords.push(t.coords[i]);else{const o=d(i,r),a=v(i,r,n,s),l=t.coords;for(let t=0;t<l.length;t+=o)a(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e}function le(e,t,i,r){let n=0,s=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const i=s+e[r*(t+a)],l=o+e[r*(t+a)+1],c=(i-s)*(l+o);s=i,o=l,n+=c}return.5*n}function ce(e,t){const{coords:i,lengths:r}=e;let n=0,s=0;for(let e=0;e<r.length;e++){const o=r[e];s+=le(i,n,o,t),n+=o}return Math.abs(s)}function ue(e,t,i,r){return 0==e*r-i*t&&e*i+t*r>0}function he(e,t,i,r,n){const s=d(r,n);if(!e.lengths.length){if(e.coords.length<2)return null;const[i,r]=e.coords,n=x(t,i),s=T(t,r);return new h.Z([],[n,s])}const o=new h.Z([],[0,0]),a=f[i],l="esriGeometryPolygon"===i||"esriGeometryPolyline"===i;let c=0,u=0;for(let i=0;i<e.lengths.length;i++){const r=e.lengths[i],n=u;let h=x(t,e.coords[s*c]),d=T(t,e.coords[s*c+1]);o.coords[u++]=h,o.coords[u++]=d;let p=0,f=0,m=1;for(let i=1;i<r;i++){const r=x(t,e.coords[s*(i+c)]),n=T(t,e.coords[s*(i+c)+1]);if(r!==h||n!==d){const e=r-h,t=n-d;l&&ue(p,f,e,t)?(o.coords[u-2]+=e,o.coords[u-1]+=t,h+=e,d+=t):(o.coords[u++]=r,o.coords[u++]=n,h=r,d=n,p=e,f=t,m+=1)}}m<a?u=n:o.lengths.push(m),c+=r}return 0===o.lengths.length?null:o}function de(e,t=0,i=0){pe(e.lengths,i),pe(e.coords,t)}function pe(e,t=0){e.length!==t&&(e.length=t)}const fe={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},45043:(e,t,i)=>{i.d(t,{D:()=>y,Ou:()=>c,WG:()=>g,kB:()=>d,mW:()=>h});var r=i(80085),n=(i(39994),i(67134)),s=i(86098),o=i(14685),a=i(53736),l=i(98196);function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function h(e,t){return e?function(e){return"declaredClass"in e}(e)?e:new r.Z({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,n.d9)(e.symbol),attributes:(0,n.d9)(e.attributes),geometry:d(e.geometry)}):null}function d(e){return null==e?null:c(e)?e:(0,a.im)(function(e){const{wkid:t,wkt:i,wkt2:r,latestWkid:n}=e.spatialReference,s={wkid:t,wkt:i,wkt2:r,latestWkid:n};switch(e.type){case"point":{const{x:t,y:i,z:r,m:n}=e;return{x:t,y:i,z:r,m:n,spatialReference:s}}case"polygon":{const{rings:t,hasZ:i,hasM:r}=e;return{rings:p(t),hasZ:i,hasM:r,spatialReference:s}}case"polyline":{const{paths:t,hasZ:i,hasM:r}=e;return{paths:p(t),hasZ:i,hasM:r,spatialReference:s}}case"extent":{const{xmin:t,xmax:i,ymin:r,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h}=e;return{xmin:t,xmax:i,ymin:r,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h,spatialReference:s}}case"multipoint":{const{points:t,hasZ:i,hasM:r}=e;return{points:m(t)?f(t):t,hasZ:i,hasM:r,spatialReference:s}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return m(t);return!1}(e)?e.map((e=>f(e))):e}function f(e){return e.map((e=>Array.from(e)))}function m(e){return e.length>0&&((0,s.xZ)(e[0])||(0,s.fS)(e[0]))}function g(e,t){if(!e)return null;let i;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=void 0,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=(0,l.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}function y(e){const{wkid:t,wkt:i,wkt2:r,latestWkid:n}=e,s={wkid:t,wkt:i,wkt2:r,latestWkid:n};return o.Z.fromJSON(s)}},30676:(e,t,i)=>{i.d(t,{AC:()=>c,Fz:()=>h,Q_:()=>m,_C:()=>u,fB:()=>d,i1:()=>g,jO:()=>p,kE:()=>l,ks:()=>a,s8:()=>f,sc:()=>o});var r=i(70375);const n="upload-assets",s=()=>new Error;class o extends r.Z{constructor(){super(`${n}:unsupported`,"Layer does not support asset uploads.",s())}}class a extends r.Z{constructor(){super(`${n}:no-glb-support`,"Layer does not support glb.",s())}}class l extends r.Z{constructor(){super(`${n}:no-supported-source`,"No supported external source found",s())}}class c extends r.Z{constructor(){super(`${n}:not-base-64`,"Expected gltf data in base64 format after conversion.",s())}}class u extends r.Z{constructor(){super(`${n}:unable-to-prepare-options`,"Unable to prepare uploadAsset request options.",s())}}class h extends r.Z{constructor(e,t){super(`${n}:bad-response`,`Bad response. Uploaded ${e} items and received ${t} results.`,s())}}class d extends r.Z{constructor(e,t){super(`${n}-layer:upload-failed`,`Failed to upload mesh file ${e}. Error code: ${t?.code??"-1"}. Error message: ${t?.messages??"unknown"}`,s())}}class p extends r.Z{constructor(e){super(`${n}-layer:unsupported-format`,`The service allowed us to upload an asset of FormatID ${e}, but it does not list it in its supported formats.`,s())}}class f extends r.Z{constructor(){super(`${n}:convert3D-failed`,"convert3D failed.")}}class m extends r.Z{constructor(){super("invalid-input:no-model","No supported model found")}}class g extends r.Z{constructor(){super("invalid-input:multiple-models","Multiple supported models found")}}},91223:(e,t,i)=>{i.d(t,{V:()=>o});var r=i(36663),n=i(81977),s=(i(39994),i(13802),i(4157),i(40266));const o=e=>{let t=class extends e{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):function(e){return"portalItem"in e}(this)?this.portalItem?.apiKey:null}set apiKey(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,r._)([(0,n.Cb)({type:String})],t.prototype,"apiKey",null),t=(0,r._)([(0,s.j)("esri.layers.mixins.APIKeyMixin")],t),t}},89993:(e,t,i)=>{i.d(t,{Z:()=>h});var r=i(36663),n=i(81977),s=(i(39994),i(13802),i(4157),i(34248)),o=i(40266),a=i(14685),l=i(81590),c=i(88289),u=i(43550);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}destroy(){this.tilemapCache?.destroy?.()}readMinScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}readMaxScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,t,i){const r=t.capabilities?.includes("Tilemap");let{minLOD:n,maxLOD:s,minScale:o,maxScale:a}=t;if(null==n&&null==s&&(0!==o||0!==a)){const e=e=>Math.round(1e4*e)/1e4;o=e(o||t.tileInfo.lods[0].scale),a=e(a||t.tileInfo.lods[t.tileInfo.lods.length-1].scale);for(const i of t.tileInfo.lods){const t=e(i.scale);n=t>=o?i.level:n,s=t>=a?i.level:s}}if(r)return new u.y({layer:this,minLOD:n,maxLOD:s});if(t.tileInfo){const e=new l.Z;return e.read(t.tileInfo,i),new c.Z(e,n,s)}return null}};return(0,r._)([(0,n.Cb)({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),(0,r._)([(0,n.Cb)()],t.prototype,"minScale",void 0),(0,r._)([(0,s.r)("service","minScale")],t.prototype,"readMinScale",null),(0,r._)([(0,n.Cb)()],t.prototype,"maxScale",void 0),(0,r._)([(0,s.r)("service","maxScale")],t.prototype,"readMaxScale",null),(0,r._)([(0,n.Cb)({type:a.Z})],t.prototype,"spatialReference",void 0),(0,r._)([(0,n.Cb)({readOnly:!0})],t.prototype,"supportsBlankTile",null),(0,r._)([(0,n.Cb)({type:l.Z})],t.prototype,"tileInfo",void 0),(0,r._)([(0,n.Cb)()],t.prototype,"tilemapCache",void 0),(0,r._)([(0,s.r)("service","tilemapCache",["capabilities","tileInfo"])],t.prototype,"readTilemapCache",null),(0,r._)([(0,n.Cb)()],t.prototype,"version",void 0),t=(0,r._)([(0,o.j)("esri.layers.mixins.ArcGISCachedService")],t),t}},87232:(e,t,i)=>{i.d(t,{Y:()=>l});var r=i(36663),n=i(13802),s=i(81977),o=(i(39994),i(4157),i(40266)),a=i(20692);const l=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=(0,a.Qc)(this.url);if(e?.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",(0,a.Nm)(e,n.Z.getLogger(this)))}};return(0,r._)([(0,s.Cb)()],t.prototype,"title",null),(0,r._)([(0,s.Cb)({type:String})],t.prototype,"url",null),t=(0,r._)([(0,o.j)("esri.layers.mixins.ArcGISService")],t),t}},27668:(e,t,i)=>{i.d(t,{h7:()=>h,nE:()=>l,qu:()=>u});var r=i(36663),n=i(81977),s=(i(39994),i(13802),i(4157),i(40266)),o=i(47216),a=i(50913);const l={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:o.C}},"portal-item":{read:!0,write:{layerContainerTypes:o.C}}}}},c={read:{reader:a.ij},write:{allowNull:!0,writer:a.cW,layerContainerTypes:o.C}},u={json:{read:!1,write:!1,origins:{"web-map":c,"portal-item":c}}},h=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,r._)([(0,n.Cb)(l)],t.prototype,"blendMode",void 0),(0,r._)([(0,n.Cb)(u)],t.prototype,"effect",void 0),t=(0,r._)([(0,s.j)("esri.layers.mixins.BlendLayer")],t),t}},63989:(e,t,i)=>{i.d(t,{N:()=>o});var r=i(36663),n=i(81977),s=(i(39994),i(13802),i(4157),i(40266));const o=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return(0,r._)([(0,n.Cb)({type:Object,json:{write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0)})}}})],t.prototype,"customParameters",void 0),t=(0,r._)([(0,s.j)("esri.layers.mixins.CustomParametersMixin")],t),t}},15801:(e,t,i)=>{i.d(t,{jF:()=>h,lQ:()=>p,o1:()=>g});var r=i(36663),n=i(31355),s=i(67134),o=i(78668),a=i(81977),l=(i(39994),i(13802),i(40266)),c=i(43980);const u=new n.Z.EventEmitter;function h(e,t,i=null,r=!1){const n=(0,o.hh)();return r=null==t||r,u.emit("apply-edits",{serviceUrl:e,layerId:t,gdbVersion:i,mayReceiveServiceEdits:r,result:n.promise}),n}const d=Symbol();function p(e){return null!=e&&"object"==typeof e&&d in e}function f(e){return null!=e&&"object"==typeof e&&"gdbVersion"in e}function m(e,t,i){const r=new URL(e).host,n=c.Jp.get(r),s=e=>!e||e===n;return s(t)&&s(i)||t===i}const g=e=>{var t;let i=class extends e{constructor(...e){super(...e),this[t]=!0,this._applyEditsHandler=e=>{const{serviceUrl:t,layerId:i,gdbVersion:r,mayReceiveServiceEdits:n,result:o}=e,a=t===this.url,l=null!=i&&null!=this.layerId&&i===this.layerId,c=f(this),u=f(this)&&m(t,r,this.gdbVersion);if(!a||c&&!u||!l&&!n)return;const h=o.then((e=>{if(this.lastEditsEventDate=new Date,l&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit("edits",(0,s.d9)(e)),e;const i=e.editedFeatures?.find((({layerId:e})=>e===this.layerId));if(i){const{adds:t,updates:r,deletes:n}=i.editedFeatures,o={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:t?t.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],deletedFeatures:n?n.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],updatedFeatures:r?r.map((({current:{attributes:e}})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],editedFeatures:(0,s.d9)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.d9)(e.historicMoment)};return this.emit("edits",o),o}const n={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,s.d9)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.d9)(e.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(t,r,n.historicMoment)&&this.emit("edits",n),n})).then((e=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(t,r,e.historicMoment)&&(this.historicMoment=e.historicMoment),e)));this.emit("apply-edits",{result:h})},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:i,moment:r}=e,n=t===this.url,s=f(this),o=f(this)&&m(t,i,this.gdbVersion),a=f(this)&&!m(t,this.gdbVersion,null);n&&s&&o&&a&&"historicMoment"in this&&this.historicMoment!==r&&(this.historicMoment=r)},this.when().then((()=>{this.addHandles(function(e){return u.on("apply-edits",new WeakRef(e))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function(e){return u.on("update-moment",new WeakRef(e))}(this._updateMomentHandler))}),(()=>{}))}_shouldUpdateHistoricMoment(e,t,i){return"historicMoment"in this&&this.historicMoment!==i&&(0,c.JV)(e,t)}};return t=d,(0,r._)([(0,a.Cb)()],i.prototype,"lastEditsEventDate",void 0),i=(0,r._)([(0,l.j)("esri.layers.mixins.EditBusLayer")],i),i}},43330:(e,t,i)=>{i.d(t,{q:()=>b});var r=i(36663),n=i(70375),s=i(3466),o=i(81977),a=i(7283),l=(i(39994),i(4157),i(34248)),c=i(40266),u=i(39835),h=i(47216),d=i(70148),p=i(86561);const f={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},m={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},g={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},y={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,Object3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":f,"web-map/basemap":m,"web-map/tables":g,"link-chart/operational-layers":{...f,LinkChartLayer:!0},"link-chart/basemap":m,"link-chart/tables":g,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0,WCS:!0},"portal-item/tables":{ArcGISFeatureLayer:!0,SubtypeGroupTable:!0}};var _=i(23072),v=i(49684);const b=e=>{let t=class extends e{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(e,t,i){return"Group Layer"===i?.portalItem?.type?void 0:e}writeListMode(e,t,i,r){(r&&"ground"===r.layerContainerType||e&&(0,p.d)(this,i,{},r))&&(t[i]=e)}writeOperationalLayerType(e,t,i){e&&(t[i]=e)}writeTitle(e,t){t.title=e??"Layer"}readVisibilityTimeExtent(e){return e?v.Z.fromArray(e):null}writeVisibilityTimeExtent(e,t,i,r){e&&"tables"!==r.layerContainerType&&(e.isEmpty?r?.messages&&r.messages.push(new n.Z("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):t[i]=e.toArray())}read(e,t){t&&(t.layer=this),(0,d.$)(this,e,(t=>super.read(e,t)),t)}write(e,t){if(!this.persistenceEnabled&&!t?.ignorePersistenceEnabled)return null;if(t?.origin){const e=`${t.origin}/${t.layerContainerType||"operational-layers"}`;let i=!!y[e]?.[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(i=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===e&&(i=!1),!i)return t.messages?.push(new n.Z("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const i=super.write(e,{...t,layer:this}),r=!!t&&!!t.messages&&!!t.messages.filter((e=>e instanceof n.Z&&"web-document-write:property-required"===e.name)).length;return(0,s.jc)(i?.url)?(t?.messages?.push(new n.Z("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&r?null:i}beforeSave(){}};return(0,r._)([(0,o.Cb)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),(0,r._)([(0,l.r)("id",["id"])],t.prototype,"readId",null),(0,r._)([(0,o.Cb)(_.rT)],t.prototype,"listMode",void 0),(0,r._)([(0,u.c)("listMode")],t.prototype,"writeListMode",null),(0,r._)([(0,o.Cb)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:h.C,isRequired:!0}}}}})],t.prototype,"operationalLayerType",void 0),(0,r._)([(0,u.c)("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),(0,r._)([(0,o.Cb)(_.Oh)],t.prototype,"opacity",void 0),(0,r._)([(0,o.Cb)({type:Boolean,readOnly:!1})],t.prototype,"persistenceEnabled",void 0),(0,r._)([(0,o.Cb)({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),(0,r._)([(0,u.c)("title"),(0,u.c)(["web-scene"],"title")],t.prototype,"writeTitle",null),(0,r._)([(0,o.Cb)({type:v.Z,json:{origins:{"web-scene":{write:{layerContainerTypes:h.C}}}}})],t.prototype,"visibilityTimeExtent",void 0),(0,r._)([(0,l.r)("visibilityTimeExtent")],t.prototype,"readVisibilityTimeExtent",null),(0,r._)([(0,u.c)(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[a.z8,a.p2]]}})],t.prototype,"writeVisibilityTimeExtent",null),(0,r._)([(0,o.Cb)({type:Boolean,json:{name:"visibility",write:{layerContainerTypes:h.C}}})],t.prototype,"visible",void 0),t=(0,r._)([(0,c.j)("esri.layers.mixins.OperationalLayer")],t),t}},18241:(e,t,i)=>{i.d(t,{I:()=>x});var r=i(36663),n=i(51366),s=i(88256),o=i(66341),a=i(67979),l=i(70375),c=i(13802),u=i(61681),h=i(78668),d=i(3466),p=i(81977),f=(i(39994),i(4157),i(34248)),m=i(40266),g=i(39835),y=i(54957),_=i(93968),v=i(53110),b=i(90298),w=i(31370);const x=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,u.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,i){if(t.itemId)return new v.default({id:t.itemId,portal:i?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem?.id)try{const{load:r}=await i.e(49112).then(i.bind(i,49112));return(0,h.k_)(t),await r({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap,populateGroupLayer:e.populateGroupLayer},t)}catch(e){throw(0,h.D_)(e)||c.Z.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${e}`),e}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch((e=>((0,h.r9)(e),!0))))}async setUserPrivileges(e,t){if(!n.Z.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(t);if(this.url)try{const{features:{edit:i,fullEdit:r},content:{updateItem:n}}=await this._fetchUserPrivileges(e,t);this._set("userHasEditingPrivileges",i),this._set("userHasFullEditingPrivileges",r),this._set("userHasUpdateItemPrivileges",n)}catch(e){(0,h.r9)(e)}}async _fetchUserPrivileges(e,t){let i=this.portalItem;if(!e||!i||!i.loaded||i.sourceUrl)return this._fetchFallbackUserPrivileges(t);const r=!s.id?.findCredential(this.url),n=e===i.id;if(n&&i.portal.user)return this._getUserPrivileges(i,r);let o,a;if(n)o=i.portal.url;else try{o=await(0,y.oP)(this.url,t)}catch(e){(0,h.r9)(e)}if(!o||!(0,d.Zo)(o,i.portal.url))return this._fetchFallbackUserPrivileges(t);try{const e=null!=t?t.signal:null;a=await(s.id?.getCredential(`${o}/sharing`,{prompt:!1,signal:e}))}catch(e){(0,h.r9)(e)}if(!a)return{features:{edit:true,fullEdit:false},content:{updateItem:false}};try{if(n?await i.reload():(i=new v.default({id:e,portal:{url:o}}),await i.load(t)),i.portal.user)return this._getUserPrivileges(i,r)}catch(e){(0,h.r9)(e)}return{features:{edit:true,fullEdit:false},content:{updateItem:false}}}_getUserPrivileges(e,t){const i=(0,w.Ss)(e);return t&&(i.features.edit=!0),i}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(e){(0,h.r9)(e)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){const t=this.url?s.id?.findCredential(this.url):null;if(!t)return!0;const i=T.credential===t?T.user:await this._fetchEditingUser(e);return T.credential=t,T.user=i,null==i?.privileges||i.privileges.includes("features:user:edit")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const i=s.id?.findServerInfo(this.url??"");if(!i?.owningSystemUrl)return null;const r=`${i.owningSystemUrl}/sharing/rest`,n=_.Z.getDefault();if(n&&n.loaded&&(0,d.Fv)(n.restUrl)===(0,d.Fv)(r))return n.user;const l=`${r}/community/self`,c=null!=e?e.signal:null,u=await(0,a.q6)((0,o.Z)(l,{authMode:"no-prompt",query:{f:"json"},signal:c}));return u.ok?b.Z.fromJSON(u.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const i=t?.portal,r=this.portalItem?.id&&(this.portalItem.portal||_.Z.getDefault());return i&&r&&!(0,d.tm)(r.restUrl,i.restUrl)?(t.messages&&t.messages.push(new l.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return(0,r._)([(0,p.Cb)({type:v.default})],t.prototype,"portalItem",null),(0,r._)([(0,f.r)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,r._)([(0,g.c)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,r._)([(0,p.Cb)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,r._)([(0,p.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),(0,r._)([(0,p.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),(0,r._)([(0,p.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=(0,r._)([(0,m.j)("esri.layers.mixins.PortalLayer")],t),t},T={credential:null,user:null}},12478:(e,t,i)=>{i.d(t,{Q:()=>w,d:()=>b});var r=i(36663),n=(i(39994),i(13802)),s=i(78668),o=i(81977),a=i(69236),l=(i(4157),i(40266)),c=i(47216),u=i(41831),h=i(76868),d=i(63235);const p=new u.Z,f=new WeakMap;function m(e){return null!=e&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e}function g(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:g(t,e%t):0}let y=0,_=0;function v(){const e=Date.now();let t=!1;for(const i of p){const r=i.deref();r?r.refreshInterval&&e-(f.get(r)??0)+5>=6e4*r.refreshInterval&&(f.set(r,e),r.refresh(e)):t=!0}if(t)for(let e=p.length-1;e>=0;e--)p.at(e).deref()||p.removeAt(e)}(0,d.EH)((()=>{const e=Date.now();let t=0;for(const i of p){const r=i.deref();r&&(t=g(Math.round(6e4*r.refreshInterval),t),r.refreshInterval?f.get(r)||f.set(r,e):f.delete(r))}if(t!==_){if(_=t,clearInterval(y),0===_)return void(y=0);y=setInterval(v,_)}}),h.sync);function b(e){return null!=e&&"object"==typeof e&&"refreshTimestamp"in e&&"refresh"in e}const w=e=>{let t=class extends e{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,s.Ds)((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||function(e){m(e)&&p.push(new WeakRef(e))}(this)}),(()=>{}))}destroy(){!function(e){const t=p.find((t=>t.deref()===e));t&&p.remove(t)}(this)}castRefreshInterval(e){return e>=.1?e:e<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){(0,s.R8)(this._debounceHasDataChanged()).then((t=>{t&&this._set("refreshTimestamp",e),this.emit("refresh",{dataChanged:t})}),(e=>{n.Z.getLogger(this).error(e),this.emit("refresh",{dataChanged:!1,error:e})}))}async hasDataChanged(){return!0}get test(){}};return(0,r._)([(0,o.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:c.C}}}}})],t.prototype,"refreshInterval",void 0),(0,r._)([(0,a.p)("refreshInterval")],t.prototype,"castRefreshInterval",null),(0,r._)([(0,o.Cb)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],t.prototype,"refreshParameters",null),t=(0,r._)([(0,l.j)("esri.layers.mixins.RefreshableLayer")],t),t}},95874:(e,t,i)=>{i.d(t,{M:()=>o});var r=i(36663),n=i(81977),s=(i(39994),i(13802),i(4157),i(40266));const o=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const e={minScale:this.minScale,maxScale:this.maxScale},t=this.parent;t&&"effectiveScaleRange"in t&&function(e,t){e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale}(e,t.effectiveScaleRange);const i=this._get("effectiveScaleRange");return i&&i.minScale===e.minScale&&i.maxScale===e.maxScale?i:e}};return(0,r._)([(0,n.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),(0,r._)([(0,n.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),(0,r._)([(0,n.Cb)({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=(0,r._)([(0,s.j)("esri.layers.mixins.ScaleRangeLayer")],t),t}},93902:(e,t,i)=>{i.d(t,{xp:()=>D,Vt:()=>M});var r=i(36663),n=i(66341),s=i(70375),o=i(13802),a=i(78668),l=i(3466),c=i(81977),u=(i(39994),i(4157),i(34248)),h=i(40266),d=i(39835),p=i(50516),f=i(91772),m=i(64307),g=i(14685),y=i(20692),_=i(23072),v=i(40909);let b=null;function w(){return b}var x=i(93968),T=i(53110),C=i(84513),S=i(83415),E=i(60629);const M=e=>{let t=class extends e{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,a.Ds)((async(e,t,i)=>{switch(e){case D.SAVE:return this._save(t);case D.SAVE_AS:return this._saveAs(i,t)}}))}readSpatialReference(e,t){return R(t)}readFullExtent(e,t,i){if(null!=e&&"object"==typeof e){const r=null==e.spatialReference?{...e,spatialReference:R(t)}:e;return f.Z.fromJSON(r,i)}const r=t.store,n=R(t);return null==n||null==r?.extent||!Array.isArray(r.extent)||r.extent.some((e=>e<A))?null:new f.Z({xmin:r.extent[0],ymin:r.extent[1],xmax:r.extent[2],ymax:r.extent[3],spatialReference:n})}parseVersionString(e){const t={major:Number.NaN,minor:Number.NaN,versionString:e},i=e.split(".");return i.length>=2&&(t.major=parseInt(i[0],10),t.minor=parseInt(i[1],10)),t}readVersion(e,t){const i=t.store,r=null!=i.version?i.version.toString():"";return this.parseVersionString(r)}readTitlePortalItem(e){return"item-title"!==this.sublayerTitleMode?void 0:e}readTitleService(e,t){const i=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return this.url?(0,y.a7)(this.url,t.name):t.name;let r=t.name;if(!r&&this.url){const e=(0,y.Qc)(this.url);null!=e&&(r=e.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&i&&(r=i+" - "+r),(0,y.ld)(r)}set url(e){if(null==e)return void this._set("url",e);const t=(0,y.XG)({layer:this,url:e,nonStandardUrlAllowed:!1,logger:o.Z.getLogger(this)});this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){(0,y.wH)(this,e,"layers",t,r)}get parsedUrl(){const e=this._get("url"),t=(0,l.mN)(e);return t&&null!=this.layerId&&(t.path=`${t.path}/layers/${this.layerId}`),t}async _fetchIndexAndUpdateExtent(e,t){this.indexInfo=(0,v.T)(this.parsedUrl?.path??"",this.rootNode,e,this.customParameters,this.apiKey,o.Z.getLogger(this),t),null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(e){if("page"===e?.type){const t=e.rootIndex%e.pageSize,i=e.rootPage?.nodes?.[t];if(null==i?.obb?.center||null==i.obb.halfSize)throw new s.Z("sceneservice:invalid-node-page","Invalid node page.");if(i.obb.center[0]<A||null==this.fullExtent||this.fullExtent.hasZ)return;const r=i.obb.halfSize,n=i.obb.center[2],o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this.fullExtent.zmin=n-o,this.fullExtent.zmax=n+o}else if("node"===e?.type){const t=e.rootNode?.mbs;if(!Array.isArray(t)||4!==t.length||t[0]<A)return;const i=t[2],r=t[3],{fullExtent:n}=this;n&&(n.zmin=i-r,n.zmax=i+r)}}async _fetchService(e){if(null==this.url)throw new s.Z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const t=await this._fetchFirstLayerId(e);null!=t&&(this.layerId=t)}return this._fetchServiceLayer(e)}async _fetchFirstLayerId(e){const t=await(0,n.Z)(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e});if(t.data&&Array.isArray(t.data.layers)&&t.data.layers.length>0)return t.data.layers[0].id}async _fetchServiceLayer(e){const t=await(0,n.Z)(this.parsedUrl?.path??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e});t.ssl&&this.url&&(this.url=this.url.replace(/^http:/i,"https:"));let i=!1;if(t.data.layerType&&"Voxel"===t.data.layerType&&(i=!0),i)return this._fetchVoxelServiceLayer();const r=t.data;this.read(r,this._getServiceContext()),this.validateLayer(r)}async _fetchVoxelServiceLayer(e){const t=(await(0,n.Z)(this.parsedUrl?.path+"/layer",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e})).data;this.read(t,this._getServiceContext()),this.validateLayer(t)}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&"function"==typeof this.beforeSave&&await this.beforeSave()}validateLayer(e){}async _saveAs(e,t){const i={...L,...t};let r=T.default.from(e);if(!r)throw new s.Z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");r.id&&(r=r.clone(),r.id=null);const n=r.portal||x.Z.getDefault();await this._ensureLoadBeforeSave(),r.type=I,r.portal=n;const o=(0,C.Y)(r,"portal-item",!0),a={layers:[this.write({},o)]};return await Promise.all(o.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(a,o,i),this.url&&(r.url=this.url),r.title||(r.title=this.title),O(r,i,P.newItem),await n.signIn(),await n.user.addItem({item:r,folder:i?.folder,data:a}),await(0,S.H)(this.resourceReferences,o),this.portalItem=r,(0,p.D)(o),o.portalItem=r,r}async _save(e){const t={...L,...e};if(!this.portalItem)throw new s.Z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(this.portalItem.type!==I)throw new s.Z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${I}"`);await this._ensureLoadBeforeSave();const i=(0,C.Y)(this.portalItem,"portal-item",!0),r={layers:[this.write({},i)]};return await Promise.all(i.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(r,i,t),this.url&&(this.portalItem.url=this.url),this.portalItem.title||(this.portalItem.title=this.title),O(this.portalItem,t,P.existingItem),await(0,S.b)(this.portalItem,r,this.resourceReferences,i),(0,p.D)(i),this.portalItem}async _validateAgainstJSONSchema(e,t,i){const r=i?.validationOptions;(0,E.z)(t,{errorName:"sceneservice:save"},{ignoreUnsupported:r?.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});const n=r?.enabled,a=w();if(n&&a){const t=(await a()).validate(e,i.portalItemLayerType);if(!t.length)return;const n=`Layer item did not validate:\n${t.join("\n")}`;if(o.Z.getLogger(this).error(`_validateAgainstJSONSchema(): ${n}`),"throw"===r.failPolicy){const e=t.map((e=>new s.Z("sceneservice:schema-validation",e)));throw new s.Z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{validationErrors:e})}}}};return(0,r._)([(0,c.Cb)(_.id)],t.prototype,"id",void 0),(0,r._)([(0,c.Cb)({type:g.Z})],t.prototype,"spatialReference",void 0),(0,r._)([(0,u.r)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readSpatialReference",null),(0,r._)([(0,c.Cb)({type:f.Z})],t.prototype,"fullExtent",void 0),(0,r._)([(0,u.r)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readFullExtent",null),(0,r._)([(0,c.Cb)({readOnly:!0,type:m.Z})],t.prototype,"heightModelInfo",void 0),(0,r._)([(0,c.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],t.prototype,"minScale",void 0),(0,r._)([(0,c.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],t.prototype,"maxScale",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],t.prototype,"version",void 0),(0,r._)([(0,u.r)("version",["store.version"])],t.prototype,"readVersion",null),(0,r._)([(0,c.Cb)({type:String,json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),(0,r._)([(0,c.Cb)({type:String,json:{read:!1}})],t.prototype,"sublayerTitleMode",void 0),(0,r._)([(0,c.Cb)({type:String})],t.prototype,"title",void 0),(0,r._)([(0,u.r)("portal-item","title")],t.prototype,"readTitlePortalItem",null),(0,r._)([(0,u.r)("service","title",["name"])],t.prototype,"readTitleService",null),(0,r._)([(0,c.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],t.prototype,"layerId",void 0),(0,r._)([(0,c.Cb)(_.HQ)],t.prototype,"url",null),(0,r._)([(0,d.c)("url")],t.prototype,"writeUrl",null),(0,r._)([(0,c.Cb)()],t.prototype,"parsedUrl",null),(0,r._)([(0,c.Cb)({readOnly:!0})],t.prototype,"store",void 0),(0,r._)([(0,c.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],t.prototype,"rootNode",void 0),t=(0,r._)([(0,h.j)("esri.layers.mixins.SceneService")],t),t},A=-1e38;function R(e){if(null!=e.spatialReference)return g.Z.fromJSON(e.spatialReference);const t=e.store,i=t.indexCRS||t.geographicCRS,r=i&&parseInt(i.slice(i.lastIndexOf("/")+1),10);return null!=r?new g.Z(r):null}function O(e,t,i){e.typeKeywords||(e.typeKeywords=[]);const r=t.getTypeKeywords();for(const t of r)e.typeKeywords.push(t);e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,i)=>i.indexOf(e)===t)),i===P.newItem&&(e.typeKeywords=e.typeKeywords.filter((e=>"Hosted Service"!==e))))}var P;!function(e){e[e.existingItem=0]="existingItem",e[e.newItem=1]="newItem"}(P||(P={}));const I="Scene Service",L={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var D;!function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(D||(D={}))},2030:(e,t,i)=>{i.d(t,{I:()=>p,n:()=>f});var r=i(36663),n=i(81977),s=(i(39994),i(13802),i(4157),i(34248)),o=i(40266),a=i(47216),l=i(14845),c=i(23756),u=i(80680),h=i(49684),d=i(52193);const p={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:a.C}}},f=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const i=t.timeInfo.exportOptions;if(!i)return null;const r=i.timeOffset,n=u.v.fromJSON(i.timeOffsetUnits);return r&&n?new d.Z({value:r,unit:n}):null}set timeInfo(e){(0,l.UF)(e,this.fieldsIndex),this._set("timeInfo",e)}};return(0,r._)([(0,n.Cb)({type:h.Z,json:{write:!1}})],t.prototype,"timeExtent",void 0),(0,r._)([(0,n.Cb)({type:d.Z})],t.prototype,"timeOffset",void 0),(0,r._)([(0,s.r)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),(0,r._)([(0,n.Cb)({value:null,type:c.Z,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),(0,r._)([(0,n.Cb)(p)],t.prototype,"useViewTime",void 0),t=(0,r._)([(0,o.j)("esri.layers.mixins.TemporalLayer")],t),t}},21432:(e,t,i)=>{i.d(t,{u:()=>l});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266));let l=r=class extends s.Z{constructor(e){super(e),this.name=null,this.code=null}clone(){return new r({name:this.name,code:this.code})}};(0,n._)([(0,o.Cb)({type:String,json:{write:{isRequired:!0}}})],l.prototype,"name",void 0),(0,n._)([(0,o.Cb)({type:[String,Number],json:{write:{isRequired:!0}}})],l.prototype,"code",void 0),l=r=(0,n._)([(0,a.j)("esri.layers.support.CodedValue")],l)},7767:(e,t,i)=>{i.d(t,{Z:()=>d});var r,n=i(36663),s=i(67134),o=i(81977),a=(i(39994),i(13802),i(79438)),l=i(40266),c=i(21432),u=i(34225);let h=r=class extends u.Z{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some((e=>(String(e.code)===i&&(t=e.name),!!t)))}return t}clone(){return new r({codedValues:(0,s.d9)(this.codedValues),name:this.name})}};(0,n._)([(0,o.Cb)({type:[c.u],json:{write:{isRequired:!0}}})],h.prototype,"codedValues",void 0),(0,n._)([(0,a.J)({codedValue:"coded-value"})],h.prototype,"type",void 0),h=r=(0,n._)([(0,l.j)("esri.layers.support.CodedValueDomain")],h);const d=h},34225:(e,t,i)=>{i.d(t,{Z:()=>h});var r=i(36663),n=i(25709),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(79438)),l=i(40266);const c=new n.X({inherited:"inherited",codedValue:"coded-value",range:"range"});let u=class extends s.Z{constructor(e){super(e),this.name=null,this.type=null}};(0,r._)([(0,o.Cb)({type:String,json:{write:!0}})],u.prototype,"name",void 0),(0,r._)([(0,a.J)(c),(0,o.Cb)({json:{write:{isRequired:!0}}})],u.prototype,"type",void 0),u=(0,r._)([(0,l.j)("esri.layers.support.Domain")],u);const h=u},8184:(e,t,i)=>{i.r(t),i.d(t,{ElevationQuery:()=>_,GeometryDescriptor:()=>v,getFinestLodIndex:()=>C});var r=i(67979),n=i(70375),s=i(61681),o=i(78668),a=i(17321),l=i(74304),c=i(10186),u=i(90819),h=i(90472),d=i(24568),p=i(56397),f=i(73742);class m{constructor(e,t=null){if(this.tile=e,null!=t&&null!=e){const i=e.extent;this._samplerData=new f.K(t,i)}}get zmin(){return null!=this._samplerData?this._samplerData.data.minValue:0}get zmax(){return null!=this._samplerData?this._samplerData.data.maxValue:0}get hasNoDataValues(){return!!this._samplerData?.data.hasNoDataValues}sample(e,t){if(null==this._samplerData)return;const{safeWidth:i,data:r,dx:n,dy:s,y1:o,x0:a}=this._samplerData,{width:l,values:c,noDataValue:u}=r,h=g(s*(o-t),0,i),d=g(n*(e-a),0,i),p=Math.floor(h),f=Math.floor(d),m=p*l+f,y=m+l,_=c[m],v=c[y],b=c[m+1],w=c[y+1];if(_!==u&&v!==u&&b!==u&&w!==u){const e=d-f,t=_+(b-_)*e;return t+(v+(w-v)*e-t)*(h-p)}}}function g(e,t,i){return e<t?t:e>i?i:e}var y=i(23758);class _{async queryAll(e,t,i){if(!(e=i?.ignoreInvisibleLayers?e.filter((e=>e.visible)):e.slice()).length)throw new n.Z("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");const r=v.fromGeometry(t);let s=!1;i?.returnSampleInfo||(s=!0);const o={...S,...i,returnSampleInfo:!0},a=await this.query(e[e.length-1],r,o),l=await this._queryAllContinue(e,a,o);return l.geometry=l.geometry.export(),s&&delete l.sampleInfo,l}async query(e,t,i){if(!e)throw new n.Z("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");if(!t||!(t instanceof v)&&"point"!==t.type&&"multipoint"!==t.type&&"polyline"!==t.type)throw new n.Z("elevation-query:invalid-geometry","Only point, polyline and multipoint geometries can be used to query elevation");const r={...S,...i},o=new x(e,t.spatialReference,r),l=r.signal;return await e.load({signal:l}),await async function(e,t,i){let r;const s=e.layer.tileInfo.spatialReference;if(t instanceof v?r=await t.project(s,i):(await(0,h.initializeProjection)([{source:t.spatialReference,dest:s}],{signal:i}),r=(0,h.project)(t,s)),!r)throw new n.Z("elevation-query:spatial-reference-mismatch",`Cannot query elevation in '${t.spatialReference.wkid}' on an elevation service in '${s.wkid}'`);e.geometry=v.fromGeometry(r)}(o,t,l),await this._selectTiles(o,l),await M(o,l),function(e){e.geometry.coordinates.forEach((t=>{const i=t.elevationTile;let r=e.options.noDataValue;if(i){const e=i.sample(t.x,t.y);null!=e?r=e:t.elevationTile=null}t.z=r}))}(o),async function(e,t){const i=await e.geometry.project(e.outSpatialReference,t);(0,s.O3)(i);const r={geometry:i.export(),noDataValue:e.options.noDataValue};return e.options.returnSampleInfo&&(r.sampleInfo=function(e){const t=e.layer.tileInfo,i=(0,a.c9)(t.spatialReference);return e.geometry.coordinates.map((r=>{let n=-1;return r.elevationTile&&r.elevationTile!==e.outsideExtentTile&&(n=t.lodAt(r.elevationTile.tile.level).resolution*i),{demResolution:n}}))}(e)),e.geometry.coordinates.forEach((e=>{e.tile=null,e.elevationTile=null})),r}(o,l)}async createSampler(e,t,i){if(!e)throw new n.Z("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");if(!t||"extent"!==t.type)throw new n.Z("elevation-query:invalid-extent","Invalid or undefined extent");const r={...S,...i};return this._createSampler(e,t,r)}async createSamplerAll(e,t,i){if(!(e=i?.ignoreInvisibleLayers?e.filter((e=>e.visible)):e.slice()).length)throw new n.Z("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");if(!t||"extent"!==t.type)throw new n.Z("elevation-query:invalid-extent","Invalid or undefined extent");const r={...S,...i,returnSampleInfo:!0},s=await this._createSampler(e[e.length-1],t,r);return this._createSamplerAllContinue(e,t,s,r)}async _createSampler(e,t,i,r){const n=i.signal;await e.load({signal:n});const s=t.spatialReference,o=e.tileInfo.spatialReference;s.equals(o)||(await(0,h.initializeProjection)([{source:s,dest:o}],{signal:n}),t=(0,h.project)(t,o));const a=new T(e,t,i,r);return await this._selectTiles(a,n),await M(a,n),new p.Tl(a.elevationTiles,a.layer.tileInfo,a.options.noDataValue)}async _createSamplerAllContinue(e,t,i,r){if(e.pop(),!e.length)return i;const n=i.samplers.filter((e=>!e.tile.hasNoDataValues)).map((e=>(0,d.oJ)(e.extent))),s=await this._createSampler(e[e.length-1],t,r,n);if(0===s.samplers.length)return i;const o=i.samplers.concat(s.samplers),a=new p.Tl(o,r.noDataValue);return this._createSamplerAllContinue(e,t,a,r)}async _queryAllContinue(e,t,i){const r=e.pop(),n=t.geometry.coordinates,o=t.sampleInfo;(0,s.O3)(o);const a=[],l=[];for(let t=0;t<n.length;t++){const i=o[t];i.demResolution>=0?i.source||(i.source=r):e.length&&(a.push(n[t]),l.push(t))}if(!e.length||0===a.length)return t;const c=t.geometry.clone(a),u=await this.query(e[e.length-1],c,i),h=u.sampleInfo;if(!h)throw new Error("no sampleInfo");return l.forEach(((e,t)=>{n[e].z=u.geometry.coordinates[t].z,o[e].demResolution=h[t].demResolution})),this._queryAllContinue(e,t,i)}async _selectTiles(e,t){"geometry"===e.type&&function(e){if(null==e.layer.fullExtent)return;const t=new m(null);t.sample=()=>e.options.noDataValue,e.outsideExtentTile=t;const i=e.layer.fullExtent;e.geometry.coordinates.forEach((e=>{const r=e.x,n=e.y;(r<i.xmin||r>i.xmax||n<i.ymin||n>i.ymax)&&(e.elevationTile=t)}))}(e);const i=e.options.demResolution;if("number"==typeof i)!function(e,t){const i=function(e,t){const{tileInfo:i,tilemapCache:r}=e.layer,n=t/(0,a.c9)(i.spatialReference),s=E(i,r);let o=s[0],l=0;for(let e=1;e<s.length;e++){const t=s[e];Math.abs(t.resolution-n)<Math.abs(o.resolution-n)&&(o=t,l=e)}return l}(e,t);e.selectTilesAtLOD(i)}(e,i);else if("finest-contiguous"===i)await this._selectTilesFinestContiguous(e,t);else{if("auto"!==i)throw new n.Z("elevation-query:invalid-dem-resolution",`Invalid dem resolution value '${i}', expected a number, "finest-contiguous" or "auto"`);await this._selectTilesAuto(e,t)}}async _selectTilesFinestContiguous(e,t){const{tileInfo:i,tilemapCache:r}=e.layer,n=C(i,r,e.options.minDemResolution);await this._selectTilesFinestContiguousAt(e,n,t)}async _selectTilesFinestContiguousAt(e,t,i){const r=e.layer;if(e.selectTilesAtLOD(t),t<0)return;const s=r.tilemapCache,a=e.getTilesToFetch();try{if(s&&!R(s))await(0,o.Hl)(Promise.all(a.map((e=>s.fetchAvailability(e.level,e.row,e.col,{signal:i})))),i);else if(await M(e,i),!e.allElevationTilesFetched())throw e.clearElevationTiles(),new n.Z("elevation-query:has-unavailable-tiles")}catch(r){(0,o.r9)(r),await this._selectTilesFinestContiguousAt(e,t-1,i)}}async _selectTilesAuto(e,t){(function(e){const{tileInfo:t,tilemapCache:i}=e.layer,r=C(t,i,e.options.minDemResolution);e.selectTilesAtLOD(r,e.options.maximumAutoTileRequests)})(e),function(e){const t=e.layer.tileInfo;let i=0;const r={},n=e=>{null!=e.id&&(e.id in r?r[e.id]++:(r[e.id]=1,i++))},s=e=>{if(null==e.id)return;const t=r[e.id];1===t?(delete r[e.id],i--):r[e.id]=t-1};e.forEachTileToFetch(n,s);let o=!0;for(;o&&(o=!1,e.forEachTileToFetch((r=>{i<=e.options.maximumAutoTileRequests||(s(r),t.upsampleTile(r)&&(o=!0),n(r))}),s),o););}(e);const i=e.layer.tilemapCache;if(!i||R(i))return this._selectTilesAutoPrefetchUpsample(e,t);const n=e.getTilesToFetch(),s={},a=n.map((async e=>{const n=new y.f(null,0,0,0,(0,d.Ue)()),a=await(0,r.q6)(i.fetchAvailabilityUpsample(e.level,e.row,e.col,n,{signal:t}));!1!==a.ok?null!=e.id&&(s[e.id]=n):(0,o.r9)(a.error)}));await(0,o.Hl)(Promise.all(a),t),e.remapTiles(s)}async _selectTilesAutoPrefetchUpsample(e,t){const i=e.layer.tileInfo;await M(e,t);let r=!1;e.forEachTileToFetch(((e,t)=>{i.upsampleTile(e)?r=!0:t()})),r&&await this._selectTilesAutoPrefetchUpsample(e,t)}}class v{export(){return this._exporter(this.coordinates,this.spatialReference)}clone(e){const t=new v;return t.geometry=this.geometry,t.spatialReference=this.spatialReference,t.coordinates=e||this.coordinates.map((e=>e.clone())),t._exporter=this._exporter,t}async project(e,t){if(this.spatialReference.equals(e))return this.clone();await(0,h.initializeProjection)([{source:this.spatialReference,dest:e}],{signal:t});const i=new l.Z({spatialReference:this.spatialReference,points:this.coordinates.map((e=>[e.x,e.y]))}),r=(0,h.project)(i,e);if(!r)return null;const n=this.coordinates.map(((e,t)=>{const i=e.clone(),n=r.points[t];return i.x=n[0],i.y=n[1],i})),s=this.clone(n);return s.spatialReference=e,s}static fromGeometry(e){const t=new v;if(t.geometry=e,t.spatialReference=e.spatialReference,e instanceof v)t.coordinates=e.coordinates.map((e=>e.clone())),t._exporter=(t,i)=>{const r=e.clone(t);return r.spatialReference=i,r};else switch(e.type){case"point":{const i=e,{hasZ:r,hasM:n}=i;t.coordinates=r&&n?[new b(i.x,i.y,i.z,i.m)]:r?[new b(i.x,i.y,i.z)]:n?[new b(i.x,i.y,null,i.m)]:[new b(i.x,i.y)],t._exporter=(t,i)=>e.hasM?new c.Z(t[0].x,t[0].y,t[0].z,t[0].m,i):new c.Z(t[0].x,t[0].y,t[0].z,i);break}case"multipoint":{const i=e,{hasZ:r,hasM:n}=i;t.coordinates=r&&n?i.points.map((e=>new b(e[0],e[1],e[2],e[3]))):r?i.points.map((e=>new b(e[0],e[1],e[2]))):n?i.points.map((e=>new b(e[0],e[1],null,e[2]))):i.points.map((e=>new b(e[0],e[1]))),t._exporter=(t,i)=>e.hasM?new l.Z({points:t.map((e=>[e.x,e.y,e.z,e.m])),hasZ:!0,hasM:!0,spatialReference:i}):new l.Z(t.map((e=>[e.x,e.y,e.z])),i);break}case"polyline":{const i=e,r=[],n=[],{hasZ:s,hasM:o}=e;let a=0;for(const e of i.paths)if(n.push([a,a+e.length]),a+=e.length,s&&o)for(const t of e)r.push(new b(t[0],t[1],t[2],t[3]));else if(s)for(const t of e)r.push(new b(t[0],t[1],t[2]));else if(o)for(const t of e)r.push(new b(t[0],t[1],null,t[2]));else for(const t of e)r.push(new b(t[0],t[1]));t.coordinates=r,t._exporter=(t,i)=>{const r=e.hasM?t.map((e=>[e.x,e.y,e.z??0,e.m??0])):t.map((e=>[e.x,e.y,e.z??0])),s=n.map((e=>r.slice(e[0],e[1])));return new u.Z({paths:s,hasM:e.hasM,hasZ:!0,spatialReference:i})};break}}return t}}class b{constructor(e,t,i=null,r=null,n=null,s=null){this.x=e,this.y=t,this.z=i,this.m=r,this.tile=n,this.elevationTile=s}clone(){return new b(this.x,this.y,this.z,this.m)}}class w{constructor(e,t){this.layer=e,this.options=t}}class x extends w{constructor(e,t,i){super(e,i),this.outSpatialReference=t,this.type="geometry"}selectTilesAtLOD(e){if(e<0)this.geometry.coordinates.forEach((e=>e.tile=null));else{const{tileInfo:t,tilemapCache:i}=this.layer,r=E(t,i)[e].level;this.geometry.coordinates.forEach((e=>e.tile=t.tileAt(r,e.x,e.y)))}}allElevationTilesFetched(){return!this.geometry.coordinates.some((e=>!e.elevationTile))}clearElevationTiles(){for(const e of this.geometry.coordinates)e.elevationTile!==this.outsideExtentTile&&(e.elevationTile=null)}populateElevationTiles(e){for(const t of this.geometry.coordinates)!t.elevationTile&&t.tile?.id&&(t.elevationTile=e[t.tile.id])}remapTiles(e){for(const t of this.geometry.coordinates){const i=t.tile?.id;t.tile=i?e[i]:null}}getTilesToFetch(){const e={},t=[];for(const i of this.geometry.coordinates){const r=i.tile;if(!r)continue;const n=i.tile?.id;i.elevationTile||!n||e[n]||(e[n]=r,t.push(r))}return t}forEachTileToFetch(e){for(const t of this.geometry.coordinates)t.tile&&!t.elevationTile&&e(t.tile,(()=>{t.tile=null}))}}class T extends w{constructor(e,t,i,r){super(e,i),this.type="extent",this.elevationTiles=[],this._candidateTiles=[],this._fetchedCandidates=new Set,this.extent=t.clone().intersection(e.fullExtent),this.maskExtents=r}selectTilesAtLOD(e,t){const i=this._maximumLodForRequests(t),r=Math.min(i,e);r<0?this._candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(r)}_maximumLodForRequests(e){const{tileInfo:t,tilemapCache:i}=this.layer,r=E(t,i);if(!e)return r.length-1;const n=this.extent;if(null==n)return-1;for(let i=r.length-1;i>=0;i--){const s=r[i],o=s.resolution*t.size[0],a=s.resolution*t.size[1];if(Math.ceil(n.width/o)*Math.ceil(n.height/a)<=e)return i}return-1}allElevationTilesFetched(){return this._candidateTiles.length===this.elevationTiles.length}clearElevationTiles(){this.elevationTiles.length=0,this._fetchedCandidates.clear()}populateElevationTiles(e){for(const t of this._candidateTiles){const i=t.id&&e[t.id];i&&(this._fetchedCandidates.add(t),this.elevationTiles.push(i))}}remapTiles(e){this._candidateTiles=A(this._candidateTiles.map((t=>e[t.id])))}getTilesToFetch(){return this._candidateTiles}forEachTileToFetch(e,t){const i=this._candidateTiles;this._candidateTiles=[],i.forEach((i=>{if(this._fetchedCandidates.has(i))return void(t&&t(i));let r=!1;e(i,(()=>r=!0)),r?t&&t(i):this._candidateTiles.push(i)})),this._candidateTiles=A(this._candidateTiles,t)}_selectCandidateTilesCoveringExtentAt(e){this._candidateTiles.length=0;const t=this.extent;if(null==t)return;const{tileInfo:i,tilemapCache:r}=this.layer,n=E(i,r)[e],s=i.tileAt(n.level,t.xmin,t.ymin),o=s.extent;if(null==o)return;const a=n.resolution*i.size[0],l=n.resolution*i.size[1],c=Math.ceil((t.xmax-o[0])/a),u=Math.ceil((t.ymax-o[1])/l);for(let e=0;e<u;e++)for(let t=0;t<c;t++){const r=new y.f(null,s.level,s.row-e,s.col+t);i.updateTileInfo(r),this._tileIsMasked(r)||this._candidateTiles.push(r)}}_tileIsMasked(e){return!!this.maskExtents&&this.maskExtents.some((t=>e.extent&&(0,d.r3)(t,e.extent)))}}function C(e,t,i=0){const r=E(e,t);let n=r.length-1;if(i>0){const t=i/(0,a.c9)(e.spatialReference),s=r.findIndex((e=>e.resolution<t));0===s?n=0:s>0&&(n=s-1)}return n}const S={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:"auto",minDemResolution:0};function E(e,t){const i=e.lods;if(R(t)){const{effectiveMinLOD:e,effectiveMaxLOD:r}=t;return i.filter((t=>t.level>=e&&t.level<=r))}return i}async function M(e,t){const i=e.getTilesToFetch(),r={},n=e.options.cache,s=e.options.noDataValue,a=i.map((async i=>{if(null==i.id)return;const o=`${e.layer.uid}:${i.id}:${s}`,a=null!=n?n.get(o):null,l=null!=a?a:await e.layer.fetchTile(i.level,i.row,i.col,{noDataValue:s,signal:t});null!=n&&n.put(o,l),r[i.id]=new m(i,l)}));await(0,o.Hl)(Promise.allSettled(a),t),e.populateElevationTiles(r)}function A(e,t){const i={},r=[];for(const n of e){const e=n.id;e&&!i[e]?(i[e]=n,r.push(n)):t&&t(n)}const n=r.sort(((e,t)=>e.level-t.level));return n.filter(((e,i)=>{for(let r=0;r<i;r++){const i=n[r].extent;if(i&&e.extent&&(0,d.r3)(i,e.extent))return t&&t(e),!1}return!0}))}function R(e){return null!=e?.tileInfo}},56397:(e,t,i)=>{i.d(t,{G$:()=>p,Tl:()=>d});i(39994);var r=i(23148),n=i(13802),s=i(17321),o=i(10186),a=i(24568),l=i(39536);const c=()=>n.Z.getLogger("esri.layers.support.ElevationSampler");class u{queryElevation(e){return p(e.clone(),this)}on(){return(0,r.kB)()}projectIfRequired(e,t){return f(e,t)}}class h extends u{get spatialReference(){return this.extent.spatialReference}constructor(e,t,i){super(),this.tile=e,this.noDataValue=i;const r=e.tile.extent;this.extent=(0,a.HH)(r,t.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=r;const n=(0,s.c9)(t.spatialReference),o=t.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const t=this.projectIfRequired(e,this.spatialReference);return null!=t&&this.containsAt(t.x,t.y)}containsAt(e,t){return(0,a.jE)(this._aaExtent,e,t)}elevationAt(e,t){if(!this.containsAt(e,t)){const i=this.extent,r=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return c().warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${r})`),this.noDataValue}return this.tile.sample(e,t)??this.noDataValue}}class d extends u{get spatialReference(){return this.extent.spatialReference}constructor(e,t,i){let r;super(),"number"==typeof t?(this.noDataValue=t,r=null):(r=t,this.noDataValue=i),this.samplers=r?e.map((e=>new h(e,r,this.noDataValue))):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:e,max:t}=n.demResolution;this.demResolution={min:e,max:t};for(let e=1;e<this.samplers.length;e++){const t=this.samplers[e];this.extent.union(t.extent),this.demResolution.min=Math.min(this.demResolution.min,t.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,t.demResolution.max)}}else this.extent=(0,a.HH)((0,a.Ue)(),r.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,t){let i,r=!1;for(const n of this.samplers)if(n.containsAt(e,t)&&(r=!0,i=n.elevationAt(e,t),i!==n.noDataValue))return i;return null!=i?i:(r||c().warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler`),this.noDataValue)}}function p(e,t){const i=f(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":!function(e,t,i){e.z=i.elevationAt(t.x,t.y)}(e,i,t);break;case"polyline":!function(e,t,i){m.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let n=0;n<e.paths.length;n++){const s=e.paths[n],o=t.paths[n];for(let e=0;e<s.length;e++){const t=s[e],n=o[e];m.x=n[0],m.y=n[1],r&&(t[3]=t[2]),t[2]=i.elevationAt(m.x,m.y)}}e.hasZ=!0}(e,i,t);break;case"multipoint":!function(e,t,i){m.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let n=0;n<e.points.length;n++){const s=e.points[n],o=t.points[n];m.x=o[0],m.y=o[1],r&&(s[3]=s[2]),s[2]=i.elevationAt(m.x,m.y)}e.hasZ=!0}(e,i,t)}return e}function f(e,t){if(null==e)return null;const i=e.spatialReference;if(i.equals(t))return e;const r=(0,l.iV)(e,t);return r||c().error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}const m=new o.Z},73742:(e,t,i)=>{i.d(t,{K:()=>r});class r{constructor(e,t){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(t[2]-t[0]),this.dy=(e.width-1)/(t[3]-t[1]),this.x0=t[0],this.y1=t[3]}}},48257:(e,t,i)=>{i.d(t,{B:()=>a});var r=i(36663),n=i(82064),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(){super(...arguments),this.type=null}};(0,r._)([(0,s.Cb)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.layers.support.FeatureReduction")],a)},69766:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(48257);let l=r=class extends a.B{constructor(e){super(e),this.type="selection"}clone(){return new r}};(0,n._)([(0,s.Cb)({type:["selection"]})],l.prototype,"type",void 0),l=r=(0,n._)([(0,o.j)("esri.layers.support.FeatureReductionSelection")],l);const c=l},12512:(e,t,i)=>{i.d(t,{Z:()=>g});var r,n=i(36663),s=i(25709),o=i(82064),a=i(81977),l=i(7283),c=(i(39994),i(4157),i(79438)),u=i(34248),h=i(40266),d=i(12795),p=i(86349);const f=new s.X({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let m=r=class extends o.Z{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,{description:t}){let i=null;try{i=t?JSON.parse(t):null}catch(e){}return i?.value??null}readValueType(e,{description:t}){let i=null;try{i=t?JSON.parse(t):null}catch(e){}return i?f.fromJSON(i.fieldValueType):null}clone(){return new r({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],m.prototype,"alias",void 0),(0,n._)([(0,a.Cb)({type:[String,Number],json:{write:{allowNull:!0}}})],m.prototype,"defaultValue",void 0),(0,n._)([(0,a.Cb)()],m.prototype,"description",void 0),(0,n._)([(0,u.r)("description")],m.prototype,"readDescription",null),(0,n._)([(0,a.Cb)({types:d.V5,json:{read:{reader:d.im},write:!0}})],m.prototype,"domain",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"editable",void 0),(0,n._)([(0,a.Cb)({type:l.z8,json:{write:{overridePolicy:e=>({enabled:Number.isFinite(e)})}}})],m.prototype,"length",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],m.prototype,"name",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"nullable",void 0),(0,n._)([(0,c.J)(p.v)],m.prototype,"type",void 0),(0,n._)([(0,a.Cb)()],m.prototype,"valueType",void 0),(0,n._)([(0,u.r)("valueType",["description"])],m.prototype,"readValueType",null),(0,n._)([(0,a.Cb)({type:Boolean,json:{read:!1}})],m.prototype,"visible",void 0),m=r=(0,n._)([(0,h.j)("esri.layers.support.Field")],m);const g=m},28790:(e,t,i)=>{i.d(t,{Z:()=>p});var r=i(70375),n=i(82064),s=i(13802),o=i(86114),a=i(46576),l=i(14845),c=i(97718),u=i(72559),h=i(17126);const d=new Map;class p{static fromJSON(e){return new p(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new p(e.fields??[],y(e))}static fromLayerJSON(e){return new p(e.fields??[],y(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const i=[];for(const e of this.fields){const t=e?.name,r=m(t);if(t&&r){const n=f(t);this._fieldsMap.set(t,e),this._fieldsMap.set(n,e),this._normalizedFieldsMap.set(r,e),i.push(`${n}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),(0,l.y2)(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):(0,l.H7)(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),(0,l.Dl)(e)||(0,l.Se)(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}i.sort(),this.uid=i.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)(0,l.Dl)(e)||(0,l.Se)(e)||e.nullable||void 0!==(0,l.os)(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(f(e))??this._normalizedFieldsMap.get(m(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(e){const t=this.get(e&&"string"!=typeof e?e.name:e);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):"date"===t.type||"esriFieldTypeDate"===t.type?(s.Z.getLogger("esri.layers.support.FieldsIndex").errorOnce(new r.Z("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),c.pt):g.has(t.type)?c._4:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===c._4?a.yV.instance:t===c.pt?h.Qf.utcInstance:(0,o.s1)(d,t,(()=>h.vF.create(t))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return(0,l.sX)(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>n.Z.isSerializable(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function f(e){return e.trim().toLowerCase()}function m(e){return(0,l.q6)(e)?.toLowerCase()??""}const g=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function y(e){const t=new Map;if(!e.fields)return t;const i=!0===e.datesInUnknownTimezone,{timeInfo:r,editFieldsInfo:n}=e,s=(r?"startField"in r?r.startField:r.startTimeField:"")??"",o=(r?"endField"in r?r.endField:r.endTimeField:"")??"",a=function(e){return"dateFieldsTimeZone"in e}(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?(0,u.Jv)(e.dateFieldsTimeReference):null,l=n?function(e){return"timeZone"in e}(n)?n.timeZone??a:n.dateFieldsTimeReference?(0,u.Jv)(n.dateFieldsTimeReference):a??c.pt:null,h=r?function(e){return"timeZone"in e}(r)?r.timeZone??a:r.timeReference?(0,u.Jv)(r.timeReference):a:null,d=new Map([[f(n?.creationDateField??""),l],[f(n?.editDateField??""),l],[f(s),h],[f(o),h]]);for(const{name:r,type:n}of e.fields)if(g.has(n))t.set(r,c._4);else if("date"!==n&&"esriFieldTypeDate"!==n)t.set(r,null);else if(i)t.set(r,c._4);else{const e=d.get(f(r??""))??a;t.set(r,e)}return t}},40909:(e,t,i)=>{i.d(t,{T:()=>s});var r=i(66341),n=i(70375);async function s(e,t,i,s,o,a,l){let c=null;if(null!=i){const t=`${e}/nodepages/`,n=t+Math.floor(i.rootIndex/i.nodesPerPage);try{return{type:"page",rootPage:(await(0,r.Z)(n,{query:{f:"json",...s,token:o},responseType:"json",signal:l})).data,rootIndex:i.rootIndex,pageSize:i.nodesPerPage,lodMetric:i.lodSelectionMetricType,urlPrefix:t}}catch(e){null!=a&&a.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",n,e),c=e}}if(!t)return null;const u=t?.split("/").pop(),h=`${e}/nodes/`,d=h+u;try{return{type:"node",rootNode:(await(0,r.Z)(d,{query:{f:"json",...s,token:o},responseType:"json",signal:l})).data,urlPrefix:h}}catch(e){throw new n.Z("sceneservice:root-node-missing","Root node missing.",{pageError:c,nodeError:e,url:d})}}},97304:(e,t,i)=>{i.d(t,{H3:()=>y,QI:()=>h,U4:()=>l,Yh:()=>p});var r=i(36663),n=i(82064),s=i(81977),o=(i(39994),i(13802),i(4157),i(79438)),a=i(40266);let l=class extends n.Z{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};(0,r._)([(0,s.Cb)({type:Number})],l.prototype,"nodesPerPage",void 0),(0,r._)([(0,s.Cb)({type:Number})],l.prototype,"rootIndex",void 0),(0,r._)([(0,s.Cb)({type:String})],l.prototype,"lodSelectionMetricType",void 0),l=(0,r._)([(0,a.j)("esri.layers.support.I3SLayerDefinitions.I3SNodePageDefinition")],l);let c=class extends n.Z{constructor(){super(...arguments),this.factor=1}};(0,r._)([(0,s.Cb)({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],c.prototype,"id",void 0),(0,r._)([(0,s.Cb)({type:Number})],c.prototype,"factor",void 0),c=(0,r._)([(0,a.j)("esri.layers.support.I3SLayerDefinitions.I3SMaterialTexture")],c);let u=class extends n.Z{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};(0,r._)([(0,s.Cb)({type:[Number]})],u.prototype,"baseColorFactor",void 0),(0,r._)([(0,s.Cb)({type:c})],u.prototype,"baseColorTexture",void 0),(0,r._)([(0,s.Cb)({type:c})],u.prototype,"metallicRoughnessTexture",void 0),(0,r._)([(0,s.Cb)({type:Number})],u.prototype,"metallicFactor",void 0),(0,r._)([(0,s.Cb)({type:Number})],u.prototype,"roughnessFactor",void 0),u=(0,r._)([(0,a.j)("esri.layers.support.I3SLayerDefinitions.I3SMaterialPBRMetallicRoughness")],u);let h=class extends n.Z{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};(0,r._)([(0,o.J)({opaque:"opaque",mask:"mask",blend:"blend"})],h.prototype,"alphaMode",void 0),(0,r._)([(0,s.Cb)({type:Number})],h.prototype,"alphaCutoff",void 0),(0,r._)([(0,s.Cb)({type:Boolean})],h.prototype,"doubleSided",void 0),(0,r._)([(0,o.J)({none:"none",back:"back",front:"front"})],h.prototype,"cullFace",void 0),(0,r._)([(0,s.Cb)({type:c})],h.prototype,"normalTexture",void 0),(0,r._)([(0,s.Cb)({type:c})],h.prototype,"occlusionTexture",void 0),(0,r._)([(0,s.Cb)({type:c})],h.prototype,"emissiveTexture",void 0),(0,r._)([(0,s.Cb)({type:[Number]})],h.prototype,"emissiveFactor",void 0),(0,r._)([(0,s.Cb)({type:u})],h.prototype,"pbrMetallicRoughness",void 0),h=(0,r._)([(0,a.j)("esri.layers.support.I3SLayerDefinitions.I3SMaterialDefinition")],h);let d=class extends n.Z{};(0,r._)([(0,s.Cb)({type:String,json:{read:{source:["name","index"],reader:(e,t)=>null!=e?e:`${t.index}`}}})],d.prototype,"name",void 0),(0,r._)([(0,o.J)({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],d.prototype,"format",void 0),d=(0,r._)([(0,a.j)("esri.layers.support.I3SLayerDefinitions.I3STextureFormat")],d);let p=class extends n.Z{constructor(){super(...arguments),this.atlas=!1}};(0,r._)([(0,s.Cb)({type:[d]})],p.prototype,"formats",void 0),(0,r._)([(0,s.Cb)({type:Boolean})],p.prototype,"atlas",void 0),p=(0,r._)([(0,a.j)("esri.layers.support.I3SLayerDefinitions.I3STextureSetDefinition")],p);let f=class extends n.Z{};(0,r._)([(0,o.J)({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],f.prototype,"type",void 0),(0,r._)([(0,s.Cb)({type:Number})],f.prototype,"component",void 0),f=(0,r._)([(0,a.j)("esri.layers.support.I3SLayerDefinitions.I3SGeometryAttribute")],f);let m=class extends n.Z{};(0,r._)([(0,o.J)({draco:"draco"})],m.prototype,"encoding",void 0),(0,r._)([(0,s.Cb)({type:[String]})],m.prototype,"attributes",void 0),m=(0,r._)([(0,a.j)("esri.layers.support.I3SLayerDefinitions.I3SGeometryCompressedAttributes")],m);let g=class extends n.Z{constructor(){super(...arguments),this.offset=0}};(0,r._)([(0,s.Cb)({type:Number})],g.prototype,"offset",void 0),(0,r._)([(0,s.Cb)({type:f})],g.prototype,"position",void 0),(0,r._)([(0,s.Cb)({type:f})],g.prototype,"normal",void 0),(0,r._)([(0,s.Cb)({type:f})],g.prototype,"uv0",void 0),(0,r._)([(0,s.Cb)({type:f})],g.prototype,"color",void 0),(0,r._)([(0,s.Cb)({type:f})],g.prototype,"uvRegion",void 0),(0,r._)([(0,s.Cb)({type:f})],g.prototype,"featureId",void 0),(0,r._)([(0,s.Cb)({type:f})],g.prototype,"faceRange",void 0),(0,r._)([(0,s.Cb)({type:m})],g.prototype,"compressedAttributes",void 0),g=(0,r._)([(0,a.j)("esri.layers.support.I3SLayerDefinitions.I3SGeometryBuffer")],g);let y=class extends n.Z{};(0,r._)([(0,o.J)({triangle:"triangle"})],y.prototype,"topology",void 0),(0,r._)([(0,s.Cb)()],y.prototype,"geometryBuffers",void 0),y=(0,r._)([(0,a.j)("esri.layers.support.I3SLayerDefinitions.I3SGeometryDefinition")],y)},36253:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=(i(13802),i(39994),i(4157),i(70375),i(79438)),o=i(40266),a=i(34225);let l=r=class extends a.Z{constructor(e){super(e),this.type="inherited"}clone(){return new r}};(0,n._)([(0,s.J)({inherited:"inherited"})],l.prototype,"type",void 0),l=r=(0,n._)([(0,o.j)("esri.layers.support.InheritedDomain")],l);const c=l},13054:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(82064),o=i(81977),a=i(7283),l=(i(39994),i(4157),i(40266));let c=r=class extends s.Z{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new r({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,n._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0),(0,n._)([(0,o.Cb)({type:a.z8,json:{write:!0}})],c.prototype,"level",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0),(0,n._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0),(0,n._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"rows",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{write:!0}})],c.prototype,"scale",void 0),c=r=(0,n._)([(0,l.j)("esri.layers.support.LOD")],c);const u=c},7923:(e,t,i)=>{i.d(t,{Z:()=>C});var r,n=i(36663),s=(i(39994),i(25709)),o=i(82064),a=i(67134),l=i(95550),c=i(81977),u=(i(13802),i(34248)),h=i(40266),d=i(39835),p=i(59693),f=i(1110),m=i(54957),g=i(5310),y=i(83313),_=i(9539);const v=new s.X({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function b(e,t,i){return{enabled:!(0,m.A2)(i?.layer)}}function w(e){return!e||"service"!==e.origin&&!("map-image"===e.layer?.type)}function x(e){return!!function(e){return"map-image"===e?.type}(e)&&!!e.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}let T=r=class extends o.Z{static evaluateWhere(e,t){const i=(e,t,i)=>{switch(t){case"=":return e==i;case"<>":return e!=i;case">":return e>i;case">=":return e>=i;case"<":return e<i;case"<=":return e<=i}return!1};try{if(null==e)return!0;const r=e.split(" ");if(3===r.length)return i(t[r[0]],r[1],r[2]);if(7===r.length){const e=i(t[r[0]],r[1],r[2]),n=r[3],s=i(t[r[4]],r[5],r[6]);switch(n){case"AND":return e&&s;case"OR":return e||s}}return!1}catch(e){}}constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=g.Rz,this.useCodedValues=void 0,this.where=null}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)e=(0,f.z7)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const t=(0,f.el)(this.labelExpressionInfo.expression);t&&(e="["+t+"]")}null!=e&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(null==e&&null!=this.labelExpression&&w(r))e=new p.Z({expression:this.getLabelExpressionArcade()});else if(!e)return;const n=e.toJSON(r);n.expression&&(t[i]=n)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return(0,f.hV)(this)}getLabelExpressionArcade(){return(0,f.YI)(this)}getLabelExpressionSingleField(){return(0,f.UO)(this)}hash(){return JSON.stringify(this)}clone(){return new r({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:(0,a.d9)(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:(0,a.d9)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};(0,n._)([(0,c.Cb)({type:String,json:{write:!0}})],T.prototype,"name",void 0),(0,n._)([(0,c.Cb)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:b}}}}})],T.prototype,"allowOverrun",void 0),(0,n._)([(0,c.Cb)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:b}}}}})],T.prototype,"deconflictionStrategy",void 0),(0,n._)([(0,c.Cb)({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&"service"===i?.origin&&x(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],T.prototype,"labelExpression",void 0),(0,n._)([(0,u.r)("labelExpression")],T.prototype,"readLabelExpression",null),(0,n._)([(0,d.c)("labelExpression")],T.prototype,"writeLabelExpression",null),(0,n._)([(0,c.Cb)({type:p.Z,json:{write:{overridePolicy:(e,t,i)=>function(e){return w(e)||x(e?.layer)}(i)?{allowNull:!0}:{enabled:!1}}}})],T.prototype,"labelExpressionInfo",void 0),(0,n._)([(0,d.c)("labelExpressionInfo")],T.prototype,"writeLabelExpressionInfo",null),(0,n._)([(0,c.Cb)({type:v.apiValues,json:{type:v.jsonValues,read:v.read,write:v.write}})],T.prototype,"labelPlacement",void 0),(0,n._)([(0,c.Cb)({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],T.prototype,"labelPosition",void 0),(0,n._)([(0,c.Cb)({type:Number})],T.prototype,"maxScale",void 0),(0,n._)([(0,d.c)("maxScale")],T.prototype,"writeMaxScale",null),(0,n._)([(0,c.Cb)({type:Number})],T.prototype,"minScale",void 0),(0,n._)([(0,d.c)("minScale")],T.prototype,"writeMinScale",null),(0,n._)([(0,c.Cb)({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:b}}}}})],T.prototype,"repeatLabel",void 0),(0,n._)([(0,c.Cb)({type:Number,cast:l.t_,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:b}}}}})],T.prototype,"repeatLabelDistance",void 0),(0,n._)([(0,c.Cb)({types:_.yK,json:{origins:{"web-scene":{types:_.S6,write:y.vX,default:null}},write:y.vX,default:null}})],T.prototype,"symbol",void 0),(0,n._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],T.prototype,"useCodedValues",void 0),(0,n._)([(0,c.Cb)({type:String,json:{write:!0}})],T.prototype,"where",void 0),T=r=(0,n._)([(0,h.j)("esri.layers.support.LabelClass")],T);const C=T},59693:(e,t,i)=>{i.d(t,{Z:()=>d});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(34248)),l=i(40266),c=i(39835),u=i(1110);let h=r=class extends s.Z{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?(0,u.dI)(t.value):e}writeExpression(e,t,i){null!=this.value&&(e=(0,u.dI)(this.value)),null!=e&&(t[i]=e)}clone(){return new r({expression:this.expression,title:this.title,value:this.value})}};(0,n._)([(0,o.Cb)({type:String,json:{write:{writerEnsuresNonNull:!0}}})],h.prototype,"expression",void 0),(0,n._)([(0,a.r)("expression",["expression","value"])],h.prototype,"readExpression",null),(0,n._)([(0,c.c)("expression")],h.prototype,"writeExpression",null),(0,n._)([(0,o.Cb)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],h.prototype,"title",void 0),(0,n._)([(0,o.Cb)({json:{read:!1,write:!1}})],h.prototype,"value",void 0),h=r=(0,n._)([(0,l.j)("esri.layers.support.LabelExpressionInfo")],h);const d=h},94081:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(41831),o=i(82064),a=i(81977),l=(i(39994),i(13802),i(4157),i(40266));let c=r=class extends o.Z{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new s.Z}clone(){return new r({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,n._)([(0,a.Cb)({type:String,json:{write:{isRequired:!0}}})],c.prototype,"floorField",void 0),(0,n._)([(0,a.Cb)({json:{read:!1,write:!1}})],c.prototype,"viewAllMode",void 0),(0,n._)([(0,a.Cb)({json:{read:!1,write:!1}})],c.prototype,"viewAllLevelIds",void 0),c=r=(0,n._)([(0,l.j)("esri.layers.support.LayerFloorInfo")],c);const u=c},253:(e,t,i)=>{i.d(t,{b:()=>o});var r=i(78668),n=i(18809),s=i(14169);class o{constructor(){this._tasks=new Array,this._runningTasks=(0,n.t)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return s.J;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return++this._runningTasks.value,new Promise(((r,n)=>this._tasks.push(new a(r,n,e,t,i)))).finally((()=>--this._runningTasks.value))}unshift(e,t,i){return++this._runningTasks.value,new Promise(((r,n)=>this._tasks.unshift(new a(r,n,e,t,i)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const i=(0,r.Hc)(t.signal);if(i&&!t.abortCallback)t.reject((0,r.zE)());else{const n=i?t.abortCallback?.((0,r.zE)()):t.callback(e);(0,r.y8)(n)?n.then(t.resolve,t.reject):t.resolve(n)}}catch(e){t.reject(e)}return!0}cancelAll(){const e=(0,r.zE)();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,i,r,n){this.resolve=e,this.reject=t,this.callback=i,this.signal=r,this.abortCallback=n}}},24912:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(79438)),a=i(40266),l=i(34225);let c=r=class extends l.Z{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new r({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};(0,n._)([(0,s.Cb)({json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]},isRequired:!0}}})],c.prototype,"maxValue",void 0),(0,n._)([(0,s.Cb)({json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range?.[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]},isRequired:!0}}})],c.prototype,"minValue",void 0),(0,n._)([(0,o.J)({range:"range"})],c.prototype,"type",void 0),c=r=(0,n._)([(0,a.j)("esri.layers.support.RangeDomain")],c);const u=c},81590:(e,t,i)=>{i.d(t,{Z:()=>x});var r,n=i(36663),s=i(25709),o=i(82064),a=i(17321),l=i(81977),c=i(7283),u=(i(39994),i(4157),i(34248)),h=i(40266),d=i(39835),p=i(10186),f=i(14685),m=i(24568),g=i(35925),y=i(39536),_=i(13054),v=i(23758);const b=new s.X({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let w=r=class extends o.Z{static create(e={}){const{resolutionFactor:t=1,scales:i,size:n=256,spatialReference:s=f.Z.WebMercator,numLODs:o=24}=e;if(!(0,g.JY)(s)){const e=[];if(i)for(let t=0;t<i.length;t++){const r=i[t];e.push(new _.Z({level:t,scale:r,resolution:r}))}else{let t=5e-4;for(let i=o-1;i>=0;i--)e.unshift(new _.Z({level:i,scale:t,resolution:t})),t*=2}return new r({dpi:96,lods:e,origin:new p.Z(0,0,s),size:[n,n],spatialReference:s})}const l=(0,g.C5)(s),c=e.origin?new p.Z({x:e.origin.x,y:e.origin.y,spatialReference:s}):new p.Z(l?{x:l.origin[0],y:l.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),u=1/(39.37*(0,a.c9)(s)*96),h=[];if(i)for(let e=0;e<i.length;e++){const t=i[e],r=t*u;h.push(new _.Z({level:e,scale:t,resolution:r}))}else{let e=(0,g.sT)(s)?512/n*591657527.5917094:256/n*591657527.591555;const i=Math.ceil(o/t);h.push(new _.Z({level:0,scale:e,resolution:e*u}));for(let r=1;r<i;r++){const i=e/2**t,n=i*u;h.push(new _.Z({level:r,scale:i,resolution:n})),e=i}}return new r({dpi:96,lods:h,origin:c,size:[n,n],spatialReference:s})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=(0,g.C5)(e);return e.isWrappable&&!!i&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return p.Z.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,i=0;const r=[],n=this._levelToLOD={};e&&(t=-1/0,i=1/0,e.forEach((e=>{r.push(e.scale),t=e.scale>t?e.scale:t,i=e.scale<i?e.scale:i,n[e.level]=e}))),this._set("scales",r),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const i=t[r],n=t[r+1];if(i<=e)return r;if(n===e)return r+1;if(i>e&&n<e)return r+Math.log(i/e)/Math.log(i/n)}return r}tileAt(e,t,i,r){const n=this.lodAt(e);if(!n)return null;let s,o;if("number"==typeof t)s=t,o=i;else if((0,g.fS)(t.spatialReference,this.spatialReference))s=t.x,o=t.y,r=i;else{const e=(0,y.iV)(t,this.spatialReference);if(null==e)return null;s=e.x,o=e.y,r=i}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return r||(r=new v.f(null,0,0,0,(0,m.Ue)())),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=r.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===r.ExtrapolateOptions.POWER_OF_TWO){const t=this.lods[this.lods.length-1];t.level<e.level&&(i=t)}if(!i)return;const n=e.level-i.level,s=i.resolution*this.size[0]/2**n,o=i.resolution*this.size[1]/2**n;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=(0,m.Ue)()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*o,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+o}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const i=this.lodAt(t.level);if(null==i)return null;const{resolution:r}=i,n=r*this.size[0],s=r*this.size[1];return e[0]=this.origin.x+t.col*n,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+n,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return r.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===e)return null;const t=(512===this.size[0]&&256===e?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&0===t)return this;const i=[],n=this.lods.length-t;for(let e=0;e<n;e++){const r=e+t,{scale:n,resolution:s}=r>=0?this.lods[r]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};i.push(new _.Z({level:e,scale:n,resolution:s}))}return new r({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],w.prototype,"compressionQuality",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],w.prototype,"dpi",void 0),(0,n._)([(0,l.Cb)({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],w.prototype,"format",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],w.prototype,"isWrappable",null),(0,n._)([(0,l.Cb)({type:p.Z,json:{write:!0}})],w.prototype,"origin",void 0),(0,n._)([(0,u.r)("origin")],w.prototype,"readOrigin",null),(0,n._)([(0,l.Cb)({type:[_.Z],value:null,json:{write:!0}})],w.prototype,"lods",null),(0,n._)([(0,l.Cb)({readOnly:!0})],w.prototype,"scales",void 0),(0,n._)([(0,l.Cb)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],w.prototype,"size",void 0),(0,n._)([(0,u.r)("size",["rows","cols"])],w.prototype,"readSize",null),(0,n._)([(0,d.c)("size",{cols:{type:c.z8},rows:{type:c.z8}})],w.prototype,"writeSize",null),(0,n._)([(0,l.Cb)({type:f.Z,json:{write:!0}})],w.prototype,"spatialReference",void 0),w=r=(0,n._)([(0,h.j)("esri.layers.support.TileInfo")],w),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(w||(w={}));const x=w},88289:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(70375),n=i(78668);class s{constructor(e,t=0,i=e.lods[e.lods.length-1].level){this.tileInfo=e,this.minLOD=t,this.maxLOD=i,e.lodAt(t)||(this.minLOD=e.lods[0].level),e.lodAt(i)||(this.maxLOD=e.lods[e.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(e,t,i){const r=this.tileInfo?.lodAt(e);return!r||e<this.minLOD||e>this.maxLOD?"unavailable":r.cols&&r.rows?i>=r.cols[0]&&i<=r.cols[1]&&t>=r.rows[0]&&t<=r.rows[1]?"unknown":"unavailable":"unknown"}async fetchAvailability(e,t,i,s){await(0,n.Yn)(s);const o=this.getAvailability(e,t,i);if("unavailable"===o)throw new r.Z("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return o}async fetchAvailabilityUpsample(e,t,i,r,s){await(0,n.Yn)(s),r.level=e,r.row=t,r.col=i;const o=this.tileInfo;return o.updateTileInfo(r),this.fetchAvailability(e,t,i,s).catch((e=>{if((0,n.D_)(e))throw e;if(o.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r,s);throw e}))}}},23758:(e,t,i)=>{i.d(t,{f:()=>r});class r{constructor(e,t,i,r,n){this.id=e,this.level=t,this.row=i,this.col=r,this.extent=n}}},43550:(e,t,i)=>{i.d(t,{y:()=>S});var r,n=i(36663),s=i(66341),o=i(74396),a=i(25015),l=i(70375),c=i(23148),u=(i(39994),i(55854)),h=i(17135),d=i(78668),p=i(76868),f=i(17262),m=i(3466),g=i(81977),y=(i(13802),i(4157),i(40266)),_=i(23758),v=i(67134),b=i(99235),w=i(86098);class x{constructor(e){!function(e){if(!e?.location)throw new l.Z("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new l.Z("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new l.Z("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new l.Z("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new l.Z("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}(e);const{location:t,data:i}=e;this.location=Object.freeze((0,v.d9)(t));const r=this.location.width,n=this.location.height;let s=!0,o=!0;const a=function(e,t=!1){return e<=w.c8?t?new Array(e).fill(0):new Array(e):new Uint32Array(e)}(Math.ceil(r*n/32));let c=0;for(let e=0;e<i.length;e++){const t=e%32;i[e]?(o=!1,a[c]|=1<<t):s=!1,31===t&&++c}o?(this._availability="unavailable",this.byteSize=40):s?(this._availability="available",this.byteSize=40):(this._availability=a,this.byteSize=40+(0,b.G7)(a))}getAvailability(e,t){if("unavailable"===this._availability||"available"===this._availability)return this._availability;const i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i%32,n=i>>5,s=this._availability;return n<0||n>s.length?"unknown":s[n]&1<<r?"available":"unavailable"}static fromDefinition(e,t){const i=e.service.request||s.Z,{row:r,col:n,width:o,height:a}=e,c={query:{f:"json"}};return t=t?{...c,...t}:c,i(function(e){let t;if(e.service.tileServers?.length){const i=e.service.tileServers;t=`${i&&i.length?i[e.row%i.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}else t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;const i=e.service.query;return i&&(t=`${t}?${i}`),t}(e),t).then((e=>e.data)).catch((e=>{if(422===e?.details?.httpStatus)return{location:{top:r,left:n,width:o,height:a},valid:!0,data:new Array(o*a).fill(0)};throw e})).then((e=>{if(e.location&&(e.location.top!==r||e.location.left!==n||e.location.width!==o||e.location.height!==a))throw new l.Z("tilemap:location-mismatch","Tilemap response for different location than requested",{response:e,definition:{top:r,left:n,width:o,height:a}});return x.fromJSON(e)}))}static fromJSON(e){return Object.freeze(new x(e))}}function T(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}function C(e,t,i){return new l.Z("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})}let S=r=class extends o.Z{constructor(e){super(e),this._pendingTilemapRequests={},this.request=s.Z,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new u.z(2*a.Y.MEGABYTES),this.addHandles((0,p.watch)((()=>{const{layer:e}=this;return[e?.parsedUrl,e?.tileServers,e?.apiKey,e?.customParameters]}),(()=>this._initializeTilemapDefinition()),p.initial))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(e,t,i){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return"unavailable";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"}fetchAvailability(e,t,i,r){return!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD?Promise.reject(C(e,t,i)):this._fetchTilemap(e,t,i,r).catch((e=>e)).then((r=>{if(r instanceof x){const n=r.getAvailability(t,i);if("unavailable"===n)throw C(e,t,i);return n}if((0,d.D_)(r))throw r;return"unknown"}))}fetchAvailabilityUpsample(e,t,i,r,n){r.level=e,r.row=t,r.col=i;const s=this.layer.tileInfo;s.updateTileInfo(r);const o=this.fetchAvailability(e,t,i,n).catch((e=>{if((0,d.D_)(e))throw e;if(s.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r,n);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,n,o),o}async _fetchAvailabilityUpsamplePrefetch(e,t,i,n,s,o){if(!this._prefetchingEnabled||null==e)return;const a=`prefetch-${e}`;if(this.hasHandles(a))return;const l=new AbortController;o.then((()=>l.abort()),(()=>l.abort()));let u=!1;const h=(0,c.kB)((()=>{u||(u=!0,l.abort())}));if(this.addHandles(h,a),await(0,f.MU)(10,l.signal).catch((()=>{})),u||(u=!0,this.removeHandles(a)),(0,d.Hc)(l))return;const p=new _.f(e,t,i,n),m={...s,signal:l.signal},g=this.layer.tileInfo;for(let e=0;r._prefetches.length<r._maxPrefetch&&g.upsampleTile(p);++e){const e=this.fetchAvailability(p.level,p.row,p.col,m);r._prefetches.push(e);const t=()=>{r._prefetches.removeUnordered(e)};e.then(t,t)}}_fetchTilemap(e,t,i,r){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return Promise.reject(new l.Z("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const n=this._tmpTilemapDefinition,s=this._tilemapFromCache(e,t,i,n);if(s)return Promise.resolve(s);const o=r?.signal;return r={...r,signal:null},new Promise(((e,t)=>{(0,d.fu)(o,(()=>t((0,d.zE)())));const i=T(n);let s=this._pendingTilemapRequests[i];if(!s){s=x.fromDefinition(n,r).then((e=>(this._tilemapCache.put(i,e,e.byteSize),e)));const e=()=>{delete this._pendingTilemapRequests[i]};this._pendingTilemapRequests[i]=s,s.then(e,e)}s.then(e,t)}))}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const{parsedUrl:e,apiKey:t,customParameters:i}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:(0,m.B7)({...e.query,...i,token:t??e.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const n=T(r);return this._tilemapCache.get(n)}get test(){}};S._maxPrefetch=4,S._prefetches=new h.Z({initialSize:r._maxPrefetch}),(0,n._)([(0,g.Cb)({constructOnly:!0})],S.prototype,"layer",void 0),(0,n._)([(0,g.Cb)({constructOnly:!0})],S.prototype,"minLOD",void 0),(0,n._)([(0,g.Cb)({constructOnly:!0})],S.prototype,"maxLOD",void 0),(0,n._)([(0,g.Cb)({constructOnly:!0})],S.prototype,"request",void 0),(0,n._)([(0,g.Cb)({constructOnly:!0})],S.prototype,"size",void 0),S=r=(0,n._)([(0,y.j)("esri.layers.support.TilemapCache")],S)},23756:(e,t,i)=>{i.d(t,{Z:()=>m});var r=i(36663),n=i(41151),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(34248)),l=i(40266),c=i(39835),u=i(49684),h=i(52193),d=i(72559);function p(e,t){return h.Z.fromJSON({value:e,unit:t})}let f=class extends(n.Z.ClonableMixin(s.Z)){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,t){return t.timeExtent&&Array.isArray(t.timeExtent)&&2===t.timeExtent.length?u.Z.fromArray(t.timeExtent):null}writeFullTimeExtent(e,t){null!=e?.start&&null!=e.end?t.timeExtent=e.toArray():t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?p(t.timeInterval,t.timeIntervalUnits):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?p(t.defaultTimeInterval,t.defaultTimeIntervalUnits):null}writeInterval(e,t){t.timeInterval=e?.toJSON().value??null,t.timeIntervalUnits=e?.toJSON().unit??null}};(0,r._)([(0,o.Cb)({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],f.prototype,"cumulative",void 0),(0,r._)([(0,o.Cb)({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],f.prototype,"endField",void 0),(0,r._)([(0,o.Cb)({type:u.Z,json:{write:{enabled:!0,allowNull:!0}}})],f.prototype,"fullTimeExtent",void 0),(0,r._)([(0,a.r)("fullTimeExtent",["timeExtent"])],f.prototype,"readFullTimeExtent",null),(0,r._)([(0,c.c)("fullTimeExtent")],f.prototype,"writeFullTimeExtent",null),(0,r._)([(0,o.Cb)({type:Boolean,json:{write:!0}})],f.prototype,"hasLiveData",void 0),(0,r._)([(0,o.Cb)({type:h.Z,json:{write:{enabled:!0,allowNull:!0}}})],f.prototype,"interval",void 0),(0,r._)([(0,a.r)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],f.prototype,"readInterval",null),(0,r._)([(0,c.c)("interval")],f.prototype,"writeInterval",null),(0,r._)([(0,o.Cb)({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],f.prototype,"startField",void 0),(0,r._)([(0,o.Cb)((0,d.mi)("timeReference",!0))],f.prototype,"timeZone",void 0),(0,r._)([(0,o.Cb)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],f.prototype,"trackIdField",void 0),(0,r._)([(0,o.Cb)({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],f.prototype,"useTime",void 0),(0,r._)([(0,o.Cb)({type:[Date],json:{read:!1}})],f.prototype,"stops",void 0),f=(0,r._)([(0,l.j)("esri.layers.support.TimeInfo")],f);const m=f},20692:(e,t,i)=>{i.d(t,{B5:()=>u,DR:()=>d,G:()=>v,M8:()=>m,Nm:()=>g,Qc:()=>h,XG:()=>y,a7:()=>f,ld:()=>p,wH:()=>_});var r=i(3466),n=i(16641);const s={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},o=Object.values(s),a=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),c=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function u(e){return a.test(e)}function h(e){if(null==e)return null;const t=(0,r.mN)(e),i=t?.path.match(a)||t?.path.match(l);if(!i)return null;const[,n,o,c,u]=i,h=o.indexOf("/");return{title:p(-1!==h?o.slice(h+1):o),serverType:s[c.toLowerCase()],sublayer:null!=u&&""!==u?parseInt(u,10):null,url:{path:n}}}function d(e){const t=(0,r.mN)(e).path.match(c);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function p(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function f(e,t){const i=[];if(e){const t=h(e);null!=t&&t.title&&i.push(t.title)}if(t){const e=p(t);i.push(e)}if(2===i.length){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function m(e){let t=(0,r.P$)(e,!0);return!!t&&(t=t.toLowerCase(),t.endsWith(".arcgis.com")&&(t.startsWith("services")||t.startsWith("tiles")||t.startsWith("features")))}function g(e,t){return e?(0,r.Qj)((0,r.Hu)(e,t)):e}function y(e){let{url:t}=e;if(!t)return{url:t};t=(0,r.Hu)(t,e.logger);const i=(0,r.mN)(t),n=h(i.path);let s;if(null!=n)null!=n.sublayer&&null==e.layer.layerId&&(s=n.sublayer),t=n.url.path;else if(e.nonStandardUrlAllowed){const e=d(i.path);null!=e&&(t=e.serviceUrl,s=e.sublayerId)}return{url:(0,r.Qj)(t),layerId:s}}function _(e,t,i,s,o){(0,n.w)(t,s,"url",o),s.url&&null!=e.layerId&&(s.url=(0,r.v_)(s.url,i,e.layerId.toString()))}function v(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),n=t.includes("/imageserver/wmsserver"),s=t.includes("/wmsserver");return i&&(r||n||s)}},53264:(e,t,i)=>{i.d(t,{w:()=>u});var r=i(88256),n=i(66341),s=i(70375),o=i(78668),a=i(20692),l=i(93968),c=i(53110);async function u(e,t){const i=(0,a.Qc)(e);if(!i)throw new s.Z("invalid-url","Invalid scene service url");const u={...t,sceneServerUrl:i.url.path,layerId:i.sublayer??void 0};if(u.sceneLayerItem??=await async function(e){const t=(await h(e)).serviceItemId;if(!t)return null;const i=new c.default({id:t,apiKey:e.apiKey}),s=await async function(e){const t=r.id?.findServerInfo(e.sceneServerUrl);if(t?.owningSystemUrl)return t.owningSystemUrl;const i=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const t=(await(0,n.Z)(i,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(t)return t}catch(e){(0,o.r9)(e)}return null}(e);null!=s&&(i.portal=new l.Z({url:s}));try{return await i.load({signal:e.signal})}catch(e){return(0,o.r9)(e),null}}(u),null==u.sceneLayerItem)return d(u.sceneServerUrl.replace("/SceneServer","/FeatureServer"),u);const p=await async function({sceneLayerItem:e,signal:t}){if(!e)return null;try{const i=(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:t})).find((e=>"Feature Service"===e.type))||null;if(!i)return null;const r=new c.default({portal:i.portal,id:i.id});return await r.load(),r}catch(e){return(0,o.r9)(e),null}}(u);if(!p?.url)throw new s.Z("related-service-not-found","Could not find feature service through portal item relationship");u.featureServiceItem=p;const f=await d(p.url,u);return f.portalItem=p,f}async function h(e){if(e.rootDocument)return e.rootDocument;const t={query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:e.signal};try{const i=await(0,n.Z)(e.sceneServerUrl,t);e.rootDocument=i.data}catch{e.rootDocument={}}return e.rootDocument}async function d(e,t){const i=(0,a.Qc)(e);if(!i)throw new s.Z("invalid-feature-service-url","Invalid feature service url");const r=i.url.path,o=t.layerId;if(null==o)return{serverUrl:r};const l=h(t),c=t.featureServiceItem?await t.featureServiceItem.fetchData("json"):null,u=(c?.layers?.[0]||c?.tables?.[0])?.customParameters,d=e=>{const i={query:{f:"json",...u},responseType:"json",authMode:e,signal:t.signal};return(0,n.Z)(r,i)},p=d("anonymous").catch((()=>d("no-prompt"))),[f,m]=await Promise.all([p,l]),g=m?.layers,y=f.data&&f.data.layers;if(!Array.isArray(y))throw new Error("expected layers array");if(Array.isArray(g)){for(let e=0;e<Math.min(g.length,y.length);e++)if(g[e].id===o)return{serverUrl:r,layerId:y[e].id}}else if(null!=o&&o<y.length)return{serverUrl:r,layerId:y[o].id};throw new Error("could not find matching associated sublayer")}},31484:(e,t,i)=>{i.d(t,{C:()=>n,s:()=>r});const r={supportsDate:!1,supportsFixedInterval:!1,supportsAutoInterval:!1,supportsFixedBoundaries:!1,supportsStackBy:!1,supportsSplitBy:!1,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!1,supportedStatistics:void 0,supportedNormalizationTypes:void 0},n={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsOrderByFields:!1,supportsResize:!1},data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryBins:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:r,query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsCurrentUser:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsReturnMesh:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsTrueCurve:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}}},23072:(e,t,i)=>{i.d(t,{C_:()=>h,HQ:()=>p,Lx:()=>g,Oh:()=>_,PV:()=>m,YI:()=>u,bT:()=>v,iR:()=>d,id:()=>w,rO:()=>x,rT:()=>C,rn:()=>f,t4:()=>S,u1:()=>T,vg:()=>b});var r=i(47216),n=i(91772),s=i(14685),o=i(16641),a=i(74710),l=i(88369),c=i(78621);const u={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:r.C}}},h={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},d={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:r.C}}},p={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:o.w}}},f={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:r.C}}},m={value:null,type:a.Z,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:r.C}}};function g(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const y={write:{enabled:!0,layerContainerTypes:r.C},read:!0},_={type:Number,json:{origins:{"web-document":y,"portal-item":{write:{layerContainerTypes:r.C}}}}},v={..._,json:{..._.json,origins:{"web-document":{...y,write:{enabled:!0,layerContainerTypes:r.C,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&"service"!==i.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition?.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,c.b)(t.layerDefinition.drawingInfo.transparency):void 0:(0,c.b)(t.drawingInfo.transparency)}}},b={type:n.Z,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=n.Z.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(i.spatialReference=s.Z.fromJSON(t.spatialReference)),i}}}},read:!1}},w={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},x={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.minScale",write:{layerContainerTypes:r.C}}},T={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.maxScale",write:{layerContainerTypes:r.C}}},C={json:{write:{ignoreOrigin:!0,layerContainerTypes:r.C},origins:{"web-map":{read:!1,write:!1}}}},S={type:l.Z,json:{name:"attributeTableInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}}},69143:(e,t,i)=>{i.d(t,{D3:()=>d,V$:()=>r});var r,n=i(19784),s=i(52300);!function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"}(r||(r={}));const o=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function a(e){return null!=e&&o.has(e.type)}function l(e){return null!=e&&("date-only"===e.type||"esriFieldTypeDateOnly"===e.type)}function c(e){return null!=e&&("timestamp-offset"===e.type||"esriFieldTypeTimestampOffset"===e.type)}function u(e){return null!=e&&("time-only"===e.type||"esriFieldTypeTimeOnly"===e.type)}const h=new Set(["single","double","esriFieldTypeSingle","esriFieldTypeDouble"]);(0,n.G0)(o,h);function d(e,t){const i=t??e?.domain;if(!i||"range"!==i.type)return;const r="range"in i?i.range[0]:i.minValue,n="range"in i?i.range[1]:i.maxValue,s=a(e);return l(e)||u(e)||c(e)?{...p(e,n,r),isInteger:s}:{min:null!=r&&"number"==typeof r?r:null,max:null!=n&&"number"==typeof n?n:null,rawMin:r,rawMax:n,isInteger:s}}function p(e,t,i){return l(e)?{min:(0,s.A9)(i)?.toMillis(),max:(0,s.A9)(t)?.toMillis(),rawMin:i,rawMax:t}:u(e)?{min:(0,s.bk)(i)?.toMillis(),max:(0,s.bk)(t)?.toMillis(),rawMin:i,rawMax:t}:c(e)?{min:(0,s.US)(i)?.toMillis(),max:(0,s.US)(t)?.toMillis(),rawMin:i,rawMax:t}:{max:null,min:null}}},12795:(e,t,i)=>{i.d(t,{V5:()=>a,im:()=>l});i(39994);var r=i(7767),n=i(34225),s=i(36253),o=i(24912);const a={key:"type",base:n.Z,typeMap:{range:o.Z,"coded-value":r.Z,inherited:s.Z}};function l(e){if(!e?.type)return null;switch(e.type){case"range":return o.Z.fromJSON(e);case"codedValue":return r.Z.fromJSON(e);case"inherited":return s.Z.fromJSON(e)}return null}},23556:(e,t,i)=>{i.d(t,{$F:()=>re,C9:()=>N,Ci:()=>R,FV:()=>A,Fr:()=>x,HW:()=>te,JD:()=>T,JY:()=>B,Jj:()=>E,K7:()=>G,KE:()=>L,KL:()=>ie,O2:()=>ne,Ob:()=>Q,SU:()=>O,UM:()=>J,VG:()=>I,Wd:()=>q,Y5:()=>S,cy:()=>V,fz:()=>Y,gG:()=>F,k6:()=>H,kZ:()=>z,kp:()=>D,nU:()=>$,rP:()=>U,rk:()=>k,sX:()=>X,tD:()=>P,uA:()=>ee,uj:()=>M});var r=i(88256),n=i(67979),s=i(70375),o=i(25709),a=i(84684),l=i(12173),c=i(3593),u=i(21432),h=i(7767),d=i(39406),p=i(14845),f=i(54957),m=i(50172),g=i(72043),y=i(67692),_=i(45634),v=i(14626),b=i(8284),w=i(9539);const x=new o.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function T(e,t,i,r){const n=await Z(e);if(await C(e,t,r),!n.addAttachment)throw new s.Z(r,"Layer source does not support addAttachment capability");return n.addAttachment(t,i)}function C(e,t,i){const{attributes:r}=t,{objectIdField:n}=e;return e.capabilities?.data?.supportsAttachment?t?r?n&&r[n]?Promise.resolve():Promise.reject(new s.Z(i,`feature is missing the identifying attribute ${n}`)):Promise.reject(new s.Z(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new s.Z(i,"A feature is required to add/delete/update attachments")):Promise.reject(new s.Z(i,"this layer doesn't support attachments"))}async function S(e,t,i,r,n){const o=await Z(e);if(await C(e,t,n),!o.updateAttachment)throw new s.Z(n,"Layer source does not support updateAttachment capability");return o.updateAttachment(t,i,r)}async function E(e,t,r){const{applyEdits:n}=await i.e(23261).then(i.bind(i,23261)),s=await e.load();let o=r;return"feature"===s.type&&s.infoFor3D&&null!=t.deleteFeatures&&null!=s.globalIdField&&(o={...o,globalIdToObjectId:await te(s,t.deleteFeatures,s.globalIdField)}),n(s,s.source,t,r)}async function M(e,t,r){const{uploadAssets:n}=await i.e(23261).then(i.bind(i,23261)),s=await e.load();return n(s,s.source,t,r)}async function A(e,t,i,r){const n=await Z(e);if(await C(e,t,r),!n.deleteAttachments)throw new s.Z(r,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(t,i)}async function R(e,t,i){const r=(await e.load({signal:t?.signal})).source;if(!r.fetchRecomputedExtents)throw new s.Z(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(t)}async function O(e,t,i,r){t=y.Z.from(t),await e.load();const n=e.source,o=e.capabilities;if(!o?.data?.supportsAttachment)throw new s.Z(r,"this layer doesn't support attachments");const{attachmentTypes:a,objectIds:l,globalIds:c,num:u,size:h,start:d,where:p}=t;if(!o?.operations?.supportsQueryAttachments&&(a?.length>0||c?.length>0||h?.length>0||u||d||p))throw new s.Z(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(l?.length||c?.length||p))throw new s.Z(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!n.queryAttachments)throw new s.Z(r,"Layer source does not support queryAttachments capability",t);return!o?.attachment?.supportsOrderByFields&&t.orderByFields?.length&&((t=t.clone()).orderByFields=null),n.queryAttachments(t)}async function P(e,t,i,r){const n=await Z(e);if(!n.queryObjectIds)throw new s.Z(r,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(v.Z.from(t)??e.createQuery(),i)}async function I(e,t,i,r){const n=await Z(e);if(!n.queryFeatureCount)throw new s.Z(r,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(v.Z.from(t)??e.createQuery(),i)}async function L(e,t,i,r){const n=await Z(e);if(!n.queryExtent)throw new s.Z(r,"Layer source does not support queryExtent capability");return n.queryExtent(v.Z.from(t)??e.createQuery(),i)}async function D(e,t,i,r){const n=await Z(e);if(!n.queryRelatedFeatures)throw new s.Z(r,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures(b.default.from(t),i)}async function N(e,t,i,r){const n=await Z(e);if(!n.queryRelatedFeaturesCount)throw new s.Z(r,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount(b.default.from(t),i)}async function F(e){const t=e.source;if(t?.refresh)try{const{dataChanged:i,updates:r}=await t.refresh();if(null!=r&&(e.sourceJSON={...e.sourceJSON,...r},e.read(r,{origin:"service",url:e.parsedUrl})),i)return!0}catch{}if(e.definitionExpression)try{return(await(0,a.EP)(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function U(e){const t=new v.Z,i=e.capabilities?.data,r=e.capabilities?.query;t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&null!=e.returnZ&&(t.returnZ=e.returnZ),i.supportsM&&null!=e.returnM&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:n,timeExtent:s}=e;return t.timeExtent=null!=n&&null!=s?s.offset(-n.value,n.unit):s||null,t.multipatchOption="multipatch"===e.geometryType?"xyFootprint":null,t}function k(e){const{globalIdField:t,fields:i}=e;if(t)return t;if(i)for(const e of i)if("esriFieldTypeGlobalID"===e.type)return e.name}function z(e){const{objectIdField:t,fields:i}=e;if(t)return t;if(i)for(const e of i)if("esriFieldTypeOID"===e.type)return e.name}function B(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}function V(e,t,i,r){const n=i?.feature,s=!!e.subtypes?.length;if(s&&!i?.excludeImpliedDomains){const i=G(e,t);if(i)return i}const o=s&&H(e,n);if(o){const e=o?.domains?.[t];return"inherited"===e?.type?r:e}const a=ie(e.types,e.typeIdField,n);if(a){const e=a.domains&&a.domains[t];if(e&&"inherited"!==e?.type)return e}if(r)return r;if(!i?.excludeImpliedDomains){const i=function(e,t){const{fieldsIndex:i}=e,{name:r,type:n}=i.get(t)??{};if(!r)return null;if(("typeIdField"in e?i.get(e.typeIdField)?.name:null)===r&&"types"in e&&e.types?.length){const t=e.types.map((e=>new u.u({code:j(e.id,n),name:e.name})));return new h.Z({codedValues:t})}return null}(e,t);if(i)return i}return null}function H(e,t){const{subtypes:i,subtypeField:r}=e;if(!t?.attributes||!i?.length||!r)return null;const n=t.attributes[r];return null==n?null:i.find((e=>e.code===n))}function G(e,t){const{fieldsIndex:i,subtypeField:r}=e,{name:n,type:s}=i.get(t)??{};if(!n)return null;if((r&&i.get(r)?.name)===n&&e.subtypes?.length){const t=e.subtypes.map((e=>new u.u({code:j(e.code,s),name:e.name})));if(t?.length)return new h.Z({codedValues:t})}return null}function j(e,t){return t?(0,p.qN)({type:t})&&"number"==typeof e?`${e}`:(0,p.Vo)({type:t})&&"string"==typeof e?Number.parseInt(e,10):e:e}async function Z(e){return(await e.load()).source}async function q(e,t){if(!r.id)return;const i=r.id.findCredential(e);if(i)return i.userId;let n;try{const i=await(0,f.oP)(e,t);i&&(n=await r.id.checkSignInStatus(`${i}/sharing`))}catch(e){}return n?n.userId:null}async function W(e,t){if(!r.id)return;if(r.id.findCredential(e))return;let i;try{const n=await(0,f.oP)(e,t);n&&(i=await r.id.checkSignInStatus(`${n}/sharing`))}catch(e){}if(i)try{const i=null!=t?t.signal:null;await r.id.getCredential(e,{signal:i})}catch(e){}}async function $(e,t,i){const r=e.parsedUrl?.path;r&&e.authenticationTriggerEvent===t&&await W(r,i)}async function Y(e){const t=e.parsedUrl?.path;t&&function(e){return function(e){return!(!(0,f.W$)(e)||!e.capabilities?.query.supportsCurrentUser)}(e)&&("serviceDefinitionExpression"in e&&J(e.serviceDefinitionExpression)||"definitionExpression"in e&&J(e.definitionExpression))}(e)&&await W(t)}function J(e){return!!e?.toLowerCase().includes("current_user")}function X(e){return!re(e)&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}const K=(0,c.d)({types:w.QT});function Q(e,t){if(e.defaultSymbol)return e.types?.length?new g.Z({defaultSymbol:K(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map((e=>({id:e.id,symbol:K(e.symbol,e,t)})))}):new m.Z({symbol:K(e.defaultSymbol,e,t)})}function ee(e){let t=e.sourceJSON?.cacheMaxAge;if(!t)return!1;const i=e.editingInfo?.lastEditDate?.getTime();return null==i||(t*=1e3,Date.now()-i<t)}async function te(e,t,i){if(null==t)return null;const r=[],{objectIdField:s}=e;if(t.forEach((e=>{let t=null;if("attributes"in e){const{attributes:r}=e;t={globalId:r[i],objectId:null!=r[s]&&-1!==r[s]?r[s]:null}}else t={globalId:e.globalId,objectId:null!=e.objectId&&-1!==e.objectId?e.objectId:null};null!=t.globalId&&(null!=t.objectId&&-1!==t.objectId||r.push(t.globalId))})),0===r.length)return null;const o=e.createQuery();o.where=r.map((e=>`${i}='${e}'`)).join(" OR "),o.returnGeometry=!1,o.outFields=[s,i],o.cacheHint=!1;const a=await(0,n.mt)((0,d.UK)(e,o));if(!a.ok)return null;const c=new Map,u=a.value.features;for(const e of u){const t=e.attributes[i],r=e.attributes[s];null!=t&&null!=r&&-1!==r&&c.set((0,l.L3)(t),r)}return c}function ie(e,t,i){if(!t||!i||!e)return null;const r=i.getAttribute(t);return null==r?null:e.find((e=>{const{id:t}=e;return null!=t&&t.toString()===r.toString()}))??null}function re(e){return e.sourceJSON?.isMultiServicesView||function(e){return!!e.sourceJSON?.capabilities?.toLowerCase().split(",").map((e=>e.trim())).includes("map")}(e)}function ne(e,t,i){const r=t?.queryAttributeBins;if(!r)throw new s.Z(i,"Layer source does not support binning");switch(e.binParameters.type){case"auto-interval":if(!r.supportsAutoInterval)throw new s.Z(i,"Layer source does not support auto-interval binning");if(e.binParameters.normalizationType&&(!r.supportsNormalization||!se(e.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new s.Z(i,"Layer source does not support normalization binning");break;case"date":if(!r.supportsDate)throw new s.Z(i,"Layer source does not support date binning");if(e.binParameters.snapToData&&!r.supportsSnapToData)throw new s.Z(i,"Layer source does not support snapToData binning");if(e.binParameters.returnFullIntervalBin&&!r.supportsReturnFullIntervalBin)throw new s.Z(i,"Layer source does not support returnFullIntervalBin binning");break;case"fixed-boundaries":if(!r.supportsFixedBoundaries)throw new s.Z(i,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!r.supportsFixedInterval)throw new s.Z(i,"Layer source does not support fixed-interval binning");if(e.binParameters.normalizationType&&(!r.supportsNormalization||!se(e.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new s.Z(i,"Layer source does not support normalization binning")}if(e.binParameters.stackBy&&!r.supportsStackBy)throw new s.Z(i,"Layer source does not support stackBy binning");if(e.binParameters.splitBy&&!r.supportsSplitBy)throw new s.Z(i,"Layer source does not support splitBy binning");if(e.binParameters.firstDayOfWeek&&!r.supportsFirstDayOfWeek)throw new s.Z(i,"Layer source does not support firstDayOfWeek binning");const n=r?.supportedStatistics;if(e.outStatistics&&n){const t=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:r}of e.outStatistics){const e=t.get(r);if(e&&!n[e])throw new s.Z(i,`Layer source does not support ${r} statistic type`)}}}function se(e,t){return null!=e&&!!t?.[_.P.toJSON(e)]}},39406:(e,t,i)=>{i.d(t,{UK:()=>n,qo:()=>s});var r=i(14626);async function n(e,t,i){t=t.clone(),e.capabilities.query.supportsMaxRecordCountFactor&&(t.maxRecordCountFactor=o(e));const r=s(e),n=e.capabilities.query.supportsPagination;t.start=0,t.num=r;let a=null;for(;;){const s=await e.source.queryFeaturesJSON(t,i);if(null==a?a=s:a.features=a.features.concat(s.features),a.exceededTransferLimit=s.exceededTransferLimit,!n||!s.exceededTransferLimit)break;t.start+=r}return a}function s(e){return o(e)*function(e){return e.capabilities.query.maxRecordCount||2e3}(e)}function o(e){return e.capabilities.query.supportsMaxRecordCountFactor?r.Z.MAX_MAX_RECORD_COUNT_FACTOR:1}},89076:(e,t,i)=>{i.d(t,{v:()=>l});var r=i(39994),n=i(13802),s=i(12512),o=i(28790),a=i(14845);function l(){return{fields:{type:[s.Z],value:null,set:function(e){if(e&&(0,r.Z)("big-integer-warning-enabled")){const t=e.filter((e=>"big-integer"===e.type||"oid"===e.type&&(e.length||0)>=8));if(t.length){const e=t.map((e=>`'${e.name}'`)).join(", ");n.Z.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${e}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",e)}},fieldsIndex:{readOnly:!0,get(){return o.Z.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e?.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e){const i=this.fieldsIndex?.has(t);i||n.Z.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e})}return(0,a.Q0)(this.fieldsIndex,e)}}}}},86349:(e,t,i)=>{i.d(t,{v:()=>r});const r=new(i(25709).X)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"})},14845:(e,t,i)=>{i.d(t,{AB:()=>x,CH:()=>N,Dl:()=>de,E2:()=>P,Ec:()=>Ae,Fv:()=>j,Gm:()=>Me,H7:()=>oe,Hp:()=>G,Lk:()=>T,Ll:()=>L,Mu:()=>Z,O5:()=>M,Pz:()=>ye,Q0:()=>b,Qc:()=>_e,Qj:()=>D,R9:()=>Ee,Se:()=>pe,TK:()=>C,UF:()=>_,UQ:()=>ce,Vo:()=>se,WH:()=>F,YN:()=>g,ZR:()=>$,ZV:()=>O,d2:()=>fe,gd:()=>w,ig:()=>ue,io:()=>S,ld:()=>Re,os:()=>W,q6:()=>p,qN:()=>ae,sX:()=>he,vP:()=>Se,vl:()=>R,y2:()=>le});var r=i(70375),n=i(86745),s=i(19784),o=i(84684),a=i(69143),l=i(77631),c=i(30879),u=i(32646);const h=/^([0-9_])/,d=/[^a-z0-9_\u0080-\uffff]+/gi;function p(e){return null==e?null:e.trim().replaceAll(d,"_").replace(h,"F$1")||null}const f=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],m=["field","normalizationField"];function g(e,t){if(null!=e&&null!=t)for(const i of Array.isArray(e)?e:[e])if(y(f,i,t),"visualVariables"in i&&i.visualVariables)for(const e of i.visualVariables)y(m,e,t)}function y(e,t,i){if(e)for(const r of e){const e=(0,n.hS)(r,t),s=e&&"function"!=typeof e&&i.get(e);s&&(0,n.RB)(r,s.name,t)}}function _(e,t){if(null!=e&&t?.fields?.length)if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i?.name??null,e.endField=r?.name??null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i?.name??null,e.endTimeField=r?.name??null}}const v=new Set;function b(e,t){return e&&t?(v.clear(),w(v,e,t),Array.from(v).sort()):[]}function w(e,t,i){if(i)if(t?.fields?.length)if(i.includes("*"))for(const{name:i}of t.fields)e.add(i);else for(const r of i)x(e,t,r);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const t of i)null!=t&&e.add(t)}}function x(e,t,i){if("string"==typeof i)if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function T(e,t){return null==t||null==e?[]:t.includes("*")?(e.fields??[]).map((e=>e.name)):t}function C(e,t,i=1){if(!t||!e)return[];if(t.includes("*"))return["*"];const r=b(e,t);return r.length/e.fields.length>=i?["*"]:r}async function S(e,t,i){if(!i)return;let r;const n=(0,l.b)(i);if(n)r=[n];else{const{arcadeUtils:e}=await(0,c.LC)();r=e.extractFieldNames(i,t?.fields?.map((e=>e.name)))}for(const i of r)x(e,t,i)}async function E(e,t,i){if(i&&"1=1"!==i){const n=await(0,o.EP)(i,t);if(!n.isStandardized)throw new r.Z("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});w(e,t,n.fieldNames)}}function M({displayField:e,fields:t}){return e||(t?.length?A(t,"name-or-title")||A(t,"unique-identifier")||A(t,"type-or-category")||function(e){for(const t of e){if(!t?.name)continue;const e=t.name.toLowerCase();if(e.includes("name")||e.includes("title"))return t.name}return null}(t):null)}function A(e,t){for(const i of e)if(i?.valueType&&i.valueType===t)return i.name;return null}async function R(e,t){if(!t)return;const i=t.elevationInfo?.featureExpressionInfo;return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function O(e,t,i){if(!t||!i||!("fields"in i))return;const r=[],n=i.popupTemplate;r.push(I(e,t,n)),i.fields&&r.push(...i.fields.map((async i=>function(e,t,i){i.onStatisticExpression?S(e,t,i.onStatisticExpression.expression):e.add(i.onStatisticField)}(e,t.fieldsIndex,i)))),await Promise.all(r)}async function P(e,t){const{fieldsIndex:i,trackInfo:r}=t;if(!t||!r||!i)return;const n=[r.latestObservations.renderer?.collectRequiredFields(e,i),r.previousObservations.renderer?.collectRequiredFields(e,i),r.trackLines.renderer?.collectRequiredFields(e,i)];r.popupTemplate&&n.push(I(e,t,r.popupTemplate));for(const t of[r.latestObservations.labelingInfo,r.previousObservations.labelingInfo,r.trackLines.labelingInfo])if(t)for(const r of t)n.push(q(e,i,r));await Promise.all(n)}async function I(e,t,i){const r=[];i?.expressionInfos&&r.push(...i.expressionInfos.map((i=>S(e,t.fieldsIndex,i.expression))));const n=i?.content;if(Array.isArray(n))for(const i of n)"expression"===i.type&&i.expressionInfo&&r.push(S(e,t.fieldsIndex,i.expressionInfo.expression));await Promise.all(r)}async function L(e,t,i){t&&(t.timeInfo&&i?.timeExtent&&w(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&w(e,t.fieldsIndex,[t.floorInfo.floorField]),null!=i?.where&&await E(e,t.fieldsIndex,i.where))}async function D(e,t,i){t&&i&&await Promise.all(i.map((i=>async function(e,t,i){t&&i&&(i.valueExpression?await S(e,t.fieldsIndex,i.valueExpression):i.field&&x(e,t.fieldsIndex,i.field))}(e,t,i))))}function N(e){return e?b(e.fieldsIndex,V(e)):[]}async function F(e,t,i){if(!t||!i)return;const r=t.fieldsIndex;await Promise.all(i.filters.map((t=>E(e,r,t.where))))}const U=new Set(["oid","global-id","guid"]),k=new Set(["oid","global-id"]),z=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function B(e){const t=new Set;H(e).forEach((e=>t.add(e))),function(e){if(!e)return[];const t=e.geometryFieldsInfo;return t?b(e.fieldsIndex,[t.shapeAreaField,t.shapeLengthField]):[]}(e).forEach((e=>t.add(e.toLowerCase())));const i=e&&"infoFor3D"in e?e.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach((e=>t.add(e.toLowerCase()))),Object.values(i.transformFieldRoles).forEach((e=>t.add(e.toLowerCase())))),Array.from(t)}function V(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;if(!t)return[];const{creationDateField:i,creatorField:r,editDateField:n,editorField:s}=t;return[i,r,n,s].filter(Boolean)}function H(e){return V(e).map((e=>e.toLowerCase()))}function G(e,t){return e.editable&&!U.has(e.type)&&!H(t).includes(e.name?.toLowerCase()??"")}function j(e,t){const i=e.name?.toLowerCase()??"";return!(null!=t?.objectIdField&&i===t.objectIdField.toLowerCase()||null!=t?.globalIdField&&i===t.globalIdField.toLowerCase()||B(t).includes(i)||k.has(e.type)||z.some((e=>e.test(i))))}async function Z(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i?.length&&await Promise.all(i.map((t=>q(e,r,t))))}async function q(e,t,i){if(!i)return;const r=i.getLabelExpression(),n=i.where;if("arcade"===r.type)await S(e,t,r.expression);else{const i=r.expression.match(/{[^}]*}/g);i&&i.forEach((i=>{x(e,t,i.slice(1,-1))}))}await E(e,t,n)}function W(e){const t=e.defaultValue;return void 0!==t&&Q(e,t)?t:e.nullable?null:void 0}function $(e){const t="string"==typeof e?{type:e}:e;return ae(t)?255:"esriFieldTypeDate"===t.type||"date"===t.type?8:void 0}function Y(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function J(e){return null===e||Y(e)}function X(e){return null===e||Number.isInteger(e)}function K(){return!0}function Q(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=e.nullable?X:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?J:Y;break;case"string":case"esriFieldTypeString":i=e.nullable?u.tM:u.HD;break;default:i=K}return 1===arguments.length?i:i(t)}const ee=["integer","small-integer","big-integer"],te=["single","double"],ie=new Set([...ee,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]),re=new Set([...te,"esriFieldTypeSingle","esriFieldTypeDouble"]),ne=(0,s.G0)(ie,re);function se(e){return null!=e&&ie.has(e.type)}function oe(e){return null!=e&&ne.has(e.type)}function ae(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function le(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}function ce(e){return null!=e&&("date-only"===e.type||"esriFieldTypeDateOnly"===e.type)}function ue(e){return null!=e&&("timestamp-offset"===e.type||"esriFieldTypeTimestampOffset"===e.type)}function he(e){return null!=e&&("time-only"===e.type||"esriFieldTypeTimeOnly"===e.type)}function de(e){return null!=e&&("oid"===e.type||"esriFieldTypeOID"===e.type)}function pe(e){return null!=e&&("global-id"===e.type||"esriFieldTypeGlobalID"===e.type)}function fe(e,t){return null===_e(e,t)}var me,ge;function ye(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function _e(e,t){return null==e||e.nullable&&null===t?null:Q(e,t)?oe(e)&&!function(e,t){const i="string"==typeof e?ve(e):e;if(!i)return!1;const r=i.min,n=i.max;return i.isInteger?Number.isInteger(t)&&t>=r&&t<=n:t>=r&&t<=n}(e.type,Number(t))?me.OUT_OF_RANGE:null:ge.INVALID_TYPE}function ve(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return be;case"esriFieldTypeInteger":case"integer":return we;case"esriFieldTypeBigInteger":case"big-integer":return xe;case"esriFieldTypeSingle":case"single":return Te;case"esriFieldTypeDouble":case"double":return Ce}}!function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"}(me||(me={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(ge||(ge={}));const be={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},we={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},xe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},Te={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},Ce={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function Se(e,t,i){switch(e){case a.V$.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case a.V$.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case ge.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case me.OUT_OF_RANGE:{const{min:e,max:r}=ve(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${e} to ${r}`}}}function Ee(e,t){return!Me(e,t,null)}function Me(e,t,i){if(!t?.attributes||!e){if(null!=i)for(const t of e??[])i.add(t);return!0}const r=new Set(Object.keys(t.attributes));let n=!1;for(const t of e)if(!r.has(t)){if(n=!0,null==i)break;i.add(t)}return n}function Ae(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some((t=>e.toLowerCase().startsWith(t)))}function Re(e){const t=e?.match(/{[^}]+}/g);return t?t.map((e=>e.slice(1,-1).split(":")[0].trim())):[]}},13449:(e,t,i)=>{i.d(t,{$6:()=>x,$z:()=>s,F7:()=>n,S0:()=>o,Si:()=>f,Wr:()=>g,X4:()=>h,Zq:()=>d,d1:()=>l,dm:()=>c,eP:()=>u,fe:()=>p,sg:()=>m});const r=[["binary","application/octet-stream","bin",""]];function n(e,t){return null!=_(t.name,e?.supportedFormats??[])}function s(e,t){if(!e)return!1;const i=c(t,e.supportedFormats??[]);return null!=i&&e.editFormats.includes(i)}function o(e,t){return v(function(e,t){const i=e.toLowerCase();return y(t).find((e=>b(e)===i))}(e,t))}function a(e,t){return v(_(e,t))}function l(e,t){return b(function(e,t){return y(t).find((t=>v(t)===e))}(e,t))}function c(e,t){return a(e.name,t)??o(e.type,t)}function u(e,t,i){return o(e,i)??a(t,i)}function h({supportedFormats:e}){return u("model/gltf-binary","glb",e)}function d(e){const t=h(e);return null!=t&&e.editFormats.includes(t)}function p({supportedFormats:e}){return u("model/gltf+json","gltf",e)}function f(e){if(!e)return null;const t=h(e),i=p(e);let r=null;for(const n of e.queryFormats){if(n===t)return n;n===i&&(r=n)}return r}function m({supportedFormats:e}){return u("application/esri3do-SR_world","wld",e)}function g({supportedFormats:e}){return u("application/esri3do-SR_prj","prj",e)}function y(e){return[...r,...e]}function _(e,t){const i=e.toLowerCase();return y(t).find((e=>w(e).some((e=>i.endsWith(e)))))}function v(e){return e?.[0]}function b(e){return e?.[1].toLowerCase()}function w(e){return e?.[2].split(",").map((e=>e.toLowerCase()))??[]}function x(e){return e.tables?.find((e=>"assetMaps"===e.role))}},13667:(e,t,i)=>{i.d(t,{B:()=>y,J:()=>g});var r=i(70375),n=i(13802),s=i(84684),o=i(72057),a=i(25741),l=i(69143),c=i(14845),u=i(1110),h=i(77631),d=i(30879);const p=()=>n.Z.getLogger("esri.layers.support.labelFormatUtils"),f={type:"simple",evaluate:()=>null},m={getAttribute:(e,t)=>e.field(t)};async function g(e,t,i){if(!e||!e.symbol||!t)return f;const n=e.where,o=(0,u.hV)(e);let a;if("arcade"===o.type){const e=(0,h.b)(o.expression),n=t.get(e);if(n&&((0,c.Vo)(n)||(0,c.H7)(n)||(0,c.qN)(n)))a={type:"simple",evaluate(e){const t="attributes"in e?e.attributes?.[n.name]:e.field(n.name);return null==t?"":t.toString()}};else{const e=await(0,d.WW)(o.expression,i,t);if(null==e)return f;a={type:"arcade",evaluate(t,i){try{const r="attributes"in t?e.repurposeFeature(t):t;r.contextTimeZone=i??null;const n=e.evaluate({$view:{timeZone:i},$feature:r},e.services);if(null!=n)return n.toString()}catch(e){p().error(new r.Z("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:e,feature:t,expression:o}))}return null},needsHydrationToEvaluate:()=>null==(0,u.el)(o.expression)}}}else a={type:"simple",evaluate:e=>o.expression.replaceAll(/{[^}]*}/g,(i=>{const r=i.slice(1,-1),n=t.get(r);if(!n)return i;let s=null;return s="attributes"in e?e?.attributes?.[n.name]:e.field(n.name),null==s?"":y(s,n)}))};if(n){let e;try{e=await(0,s.EP)(n,t)}catch(e){return p().error(new r.Z("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:n,error:e})),f}const i=a.evaluate;a.evaluate=(t,s)=>{const o="attributes"in t?void 0:m;try{if(e.testFeature(t,o))return i(t,s)}catch(e){p().error(new r.Z("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:n,feature:t,error:e}))}return null}}return a}function y(e,t){if(null==e)return"";const i=t.domain;if(i)if("codedValue"===i.type||"coded-value"===i.type){const t=e;for(const e of i.codedValues)if(e.code===t)return e.name}else if("range"===i.type){const{max:r,min:n}=(0,l.D3)(t),s=+e;if(null!=n&&null!=r&&n<=s&&s<=r)return i.name}let r=e;return(0,c.y2)(t)?r=(0,o.p6)(r,(0,o.Ze)("short-date")):(0,c.H7)(t)&&(r=(0,a.uf)(+r)),r||""}},1110:(e,t,i)=>{i.d(t,{UG:()=>h,UO:()=>m,YI:()=>f,dI:()=>g,el:()=>w,hV:()=>p,z7:()=>d});var r=i(21130);const n="__begin__",s="__end__",o=new RegExp(n,"ig"),a=new RegExp(s,"ig"),l=new RegExp("^"+n,"i"),c=new RegExp(s+"$","i"),u='"';function h(e){return e.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function d(e){return e.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function p(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=h(e.labelExpression),t.type="conventional"),t}function f(e){const t=p(e);switch(t.type){case"conventional":return g(t.expression);case"arcade":return t.expression}return null}function m(e){const t=p(e);switch(t.type){case"conventional":return function(e){const t=e?.match(y);return t?.[1].trim()||null}(t.expression);case"arcade":return w(t.expression)}return null}function g(e){let t;return e?(t=(0,r.gx)(e,(e=>n+'$feature["'+e+'"]'+s)),t=l.test(t)?t.replace(l,""):u+t,t=c.test(t)?t.replace(c,""):t+u,t=t.replaceAll(o,'" + ').replaceAll(a,' + "')):t='""',t}const y=/^\s*\{([^}]+)\}\s*$/i;const _=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,v=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,b=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function w(e){if(!e)return null;let t=_.exec(e)||v.exec(e);return t?t[1]||t[3]:(t=b.exec(e),t?t[2]:null)}},49341:(e,t,i)=>{i.d(t,{a:()=>u,r:()=>l});var r=i(70375),n=i(13802),s=i(7923);const o=()=>n.Z.getLogger("esri.layers.support.labelingInfo"),a=/\[([^[\]]+)\]/gi;function l(e,t,i){return e?e.map((e=>{const r=new s.Z;if(r.read(e,i),r.labelExpression){const e=t.fields||t.layerDefinition?.fields||this.fields;r.labelExpression=r.labelExpression.replaceAll(a,((t,i)=>`[${function(e,t){if(!t)return e;const i=e.toLowerCase();for(let e=0;e<t.length;e++){const r=t[e].name;if(r.toLowerCase()===i)return r}return e}(i,e)}]`))}return r})):null}const c={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryMultiPatch:["always-horizontal"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function u(e,t){const i=[];for(const n of e){const e=n.labelPlacement,s=c[t];if(!n.symbol)return o().warn("No ILabelClass symbol specified."),[];if(!s)return o().error(new r.Z("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${t}' is not supported`)),[];if(s.includes(e))i.push(n);else{const r=s[0];e&&o().warn(`Found invalid label placement type ${e} for ${t}. Defaulting to ${r}`);const a=n.clone();a.labelPlacement=r,i.push(a)}}return i}},54957:(e,t,i)=>{i.d(t,{$4:()=>f,A2:()=>p,Am:()=>y,CY:()=>h,Hd:()=>l,S1:()=>C,Te:()=>o,Tv:()=>g,W$:()=>T,e9:()=>a,fE:()=>s,fP:()=>b,fb:()=>d,fg:()=>c,iC:()=>u,ln:()=>S,mt:()=>w,nx:()=>m,oP:()=>x,rQ:()=>v,sy:()=>_});var r=i(88256),n=i(66341);function s(e){return c(e)||function(e){return"scene"===e?.type}(e)}function o(e){return null!=e&&"object"==typeof e&&"type"in e&&"feature"===e.type}function a(e){return null!=e&&"object"==typeof e&&"type"in e&&"subtype-group"===e.type&&"sublayers"in e}function l(e){return"subtype-sublayer"===e?.type}function c(e){const t=e?.type;return"imagery-tile"===t||"tile"===t||"open-street-map"===t||"vector-tile"===t||"web-tile"===t||"wmts"===t}function u(e){const t=e?.type;return"base-tile"===t||"tile"===t||"elevation"===t||"imagery-tile"===t||"base-elevation"===t||"open-street-map"===t||"wcs"===t||"web-tile"===t||"wmts"===t||"vector-tile"===t}function h(e){return null!=e&&"type"in e&&"group"===e.type}const d={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function p(e){const t=e?.type;return"building-scene"===t||"integrated-mesh"===t||"point-cloud"===t||"scene"===t}function f(e){return"IntegratedMeshLayer"===e||"IntegratedMesh3DTilesLayer"===e}function m(e){return"integrated-mesh"===e||"integrated-mesh-3dtiles"===e}function g(e){return"voxel"===e?.type}function y(e){return"imagery-tile"===e?.type}function _(e){return null!=e?.parent&&"declaredClass"in e.parent&&"esri.Basemap"===e.parent.declaredClass&&e.parent.baseLayers.includes(e)}function v(e){return"feature"===e?.type&&!e.url&&"memory"===e.source?.type}function b(e){const t=e?.type;return("feature"===t||"subtype-group"===t||"oriented-imagery"===t)&&"feature-layer"===e?.source?.type}function w(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}async function x(e,t){const i=r.id?.findServerInfo(e);if(null!=i?.currentVersion)return i.owningSystemUrl||null;const s=e.toLowerCase().indexOf("/rest/services");if(-1===s)return null;const o=`${e.slice(0,s)}/rest/info`,a=null!=t?t.signal:null,{data:l}=await(0,n.Z)(o,{query:{f:"json"},responseType:"json",signal:a});return l?.owningSystemUrl||null}function T(e){if(!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function C(e){return T(e)?"effectiveCapabilities"in e?e.effectiveCapabilities:e.capabilities:null}function S(e){return!!function(e){if(!("editingEnabled"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}(e)&&("effectiveEditingEnabled"in e?e.effectiveEditingEnabled:e.editingEnabled)}},92557:(e,t,i)=>{i.d(t,{T:()=>r});const r={BingMapsLayer:async()=>(await i.e(31968).then(i.bind(i,31968))).default,BuildingSceneLayer:async()=>(await Promise.all([i.e(41984),i.e(63789),i.e(12926),i.e(65456),i.e(23833)]).then(i.bind(i,23833))).default,CSVLayer:async()=>(await Promise.all([i.e(41984),i.e(63789),i.e(12926),i.e(85848)]).then(i.bind(i,89849))).default,CatalogLayer:async()=>(await Promise.all([i.e(63789),i.e(96027),i.e(87676),i.e(42020),i.e(44629)]).then(i.bind(i,47503))).default,DimensionLayer:async()=>(await i.e(91076).then(i.bind(i,91076))).default,ElevationLayer:async()=>(await i.e(98558).then(i.bind(i,98558))).default,FeatureLayer:async()=>(await Promise.all([i.e(41984),i.e(63789),i.e(12926),i.e(85645)]).then(i.bind(i,12926))).default,GeoJSONLayer:async()=>(await Promise.all([i.e(41984),i.e(81655)]).then(i.bind(i,81655))).default,GeoRSSLayer:async()=>(await i.e(84417).then(i.bind(i,84417))).default,GroupLayer:async()=>(await i.e(56753).then(i.bind(i,56753))).default,ImageryLayer:async()=>(await Promise.all([i.e(96027),i.e(5499),i.e(31434),i.e(2700),i.e(69702)]).then(i.bind(i,34025))).default,ImageryTileLayer:async()=>(await Promise.all([i.e(5499),i.e(31434),i.e(72586),i.e(2700),i.e(91812),i.e(98179)]).then(i.bind(i,98179))).default,IntegratedMesh3DTilesLayer:async()=>(await i.e(97102).then(i.bind(i,97102))).default,IntegratedMeshLayer:async()=>(await i.e(6172).then(i.bind(i,6172))).default,KMLLayer:async()=>(await i.e(80693).then(i.bind(i,80693))).default,KnowledgeGraphLayer:async()=>(await Promise.all([i.e(10306),i.e(85491),i.e(41984),i.e(8638),i.e(42616),i.e(19893),i.e(79013),i.e(67126)]).then(i.bind(i,67126))).default,LineOfSightLayer:async()=>(await i.e(42037).then(i.bind(i,42037))).default,LinkChartLayer:async()=>(await Promise.all([i.e(10306),i.e(85491),i.e(41984),i.e(8638),i.e(42616),i.e(19893),i.e(79013),i.e(47111)]).then(i.bind(i,47111))).default,MapImageLayer:async()=>(await Promise.all([i.e(96027),i.e(2769),i.e(74883)]).then(i.bind(i,69420))).default,MapNotesLayer:async()=>(await Promise.all([i.e(41984),i.e(63789),i.e(12926),i.e(52421)]).then(i.bind(i,78414))).default,MediaLayer:async()=>(await Promise.all([i.e(31683),i.e(90015)]).then(i.bind(i,42078))).default,OGCFeatureLayer:async()=>(await Promise.all([i.e(41984),i.e(64850),i.e(66487)]).then(i.bind(i,53963))).default,OpenStreetMapLayer:async()=>(await i.e(33206).then(i.bind(i,81388))).default,OrientedImageryLayer:async()=>(await Promise.all([i.e(41984),i.e(63789),i.e(12926),i.e(32939)]).then(i.bind(i,94365))).default,PointCloudLayer:async()=>(await i.e(73108).then(i.bind(i,73108))).default,RouteLayer:async()=>(await Promise.all([i.e(63970),i.e(52641)]).then(i.bind(i,52641))).default,SceneLayer:async()=>(await Promise.resolve().then(i.bind(i,92955))).default,StreamLayer:async()=>(await Promise.all([i.e(41984),i.e(75609)]).then(i.bind(i,75609))).default,SubtypeGroupLayer:async()=>(await Promise.all([i.e(63789),i.e(50515)]).then(i.bind(i,99076))).default,TileLayer:async()=>(await Promise.all([i.e(96027),i.e(2769),i.e(24923)]).then(i.bind(i,75369))).default,UnknownLayer:async()=>(await i.e(40081).then(i.bind(i,40081))).default,UnsupportedLayer:async()=>(await i.e(74864).then(i.bind(i,74864))).default,VectorTileLayer:async()=>(await Promise.resolve().then(i.bind(i,16358))).default,VideoLayer:async()=>(await Promise.all([i.e(80974),i.e(46842)]).then(i.bind(i,46842))).default,ViewshedLayer:async()=>(await i.e(77785).then(i.bind(i,77785))).default,VoxelLayer:async()=>(await i.e(41390).then(i.bind(i,41390))).default,WCSLayer:async()=>(await Promise.all([i.e(5499),i.e(31434),i.e(72586),i.e(2700),i.e(91812),i.e(14900)]).then(i.bind(i,14900))).default,WFSLayer:async()=>(await Promise.all([i.e(41984),i.e(84420)]).then(i.bind(i,84420))).default,WMSLayer:async()=>(await i.e(61936).then(i.bind(i,61936))).default,WMTSLayer:async()=>(await i.e(69862).then(i.bind(i,69862))).default,WebTileLayer:async()=>(await i.e(89859).then(i.bind(i,89859))).default}},37104:(e,t,i)=>{i.d(t,{c:()=>s});var r=i(17321),n=i(68403);function s(e){const t=1/(0,r.c9)(e,1);return 1!==t?new n.Z({scale:[t,t,t]}):void 0}},10743:(e,t,i)=>{i.d(t,{n:()=>I});var r,n=i(36663),s=i(25709),o=i(82064),a=i(81977),l=i(69236),c=i(79438),u=i(34248),h=i(40266),d=i(7283),p=i(3593),f=i(12512),m=i(81580),g=(i(39994),i(13802),i(4157),i(14685)),y=i(59659);let _=r=class extends o.Z{constructor(e){super(e),this.type="query-table"}clone(){const{workspaceId:e,query:t,oidFields:i,spatialReference:n,geometryType:s}=this,o={workspaceId:e,query:t,oidFields:i,spatialReference:n?.clone()??void 0,geometryType:s};return new r(o)}};var v;(0,n._)([(0,c.J)({queryTable:"query-table"}),(0,a.Cb)({json:{write:{isRequired:!0}}})],_.prototype,"type",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],_.prototype,"workspaceId",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],_.prototype,"query",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],_.prototype,"oidFields",void 0),(0,n._)([(0,a.Cb)({type:g.Z,json:{write:!0}})],_.prototype,"spatialReference",void 0),(0,n._)([(0,c.J)(y.Mk)],_.prototype,"geometryType",void 0),_=r=(0,n._)([(0,h.j)("esri.layers.support.source.QueryTableDataSource")],_);let b=v=class extends o.Z{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new v({workspaceId:e,dataSourceName:t})}};var w;(0,n._)([(0,c.J)({raster:"raster"}),(0,a.Cb)({json:{write:{isRequired:!0}}})],b.prototype,"type",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],b.prototype,"dataSourceName",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],b.prototype,"workspaceId",void 0),b=v=(0,n._)([(0,h.j)("esri.layers.support.source.RasterDataSource")],b);let x=w=class extends o.Z{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new w({workspaceId:e,gdbVersion:t,dataSourceName:i})}};var T,C;(0,n._)([(0,c.J)({table:"table"}),(0,a.Cb)({json:{write:{isRequired:!0}}})],x.prototype,"type",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],x.prototype,"workspaceId",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],x.prototype,"gdbVersion",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],x.prototype,"dataSourceName",void 0),x=w=(0,n._)([(0,h.j)("esri.layers.support.source.TableDataSource")],x);const S=(0,s.w)()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let E=T=class extends o.Z{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return A()(e,t,i)}castLeftTableSource(e){return(0,d.N7)(O(),e)}readRightTableSource(e,t,i){return A()(e,t,i)}castRightTableSource(e){return(0,d.N7)(O(),e)}clone(){const{leftTableKey:e,rightTableKey:t,leftTableSource:i,rightTableSource:r,joinType:n}=this,s={leftTableKey:e,rightTableKey:t,leftTableSource:i?.clone()??void 0,rightTableSource:r?.clone()??void 0,joinType:n};return new T(s)}};(0,n._)([(0,c.J)({joinTable:"join-table"}),(0,a.Cb)({json:{write:{isRequired:!0}}})],E.prototype,"type",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],E.prototype,"leftTableKey",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],E.prototype,"rightTableKey",void 0),(0,n._)([(0,a.Cb)({json:{write:!0}})],E.prototype,"leftTableSource",void 0),(0,n._)([(0,u.r)("leftTableSource")],E.prototype,"readLeftTableSource",null),(0,n._)([(0,l.p)("leftTableSource")],E.prototype,"castLeftTableSource",null),(0,n._)([(0,a.Cb)({json:{write:!0}})],E.prototype,"rightTableSource",void 0),(0,n._)([(0,u.r)("rightTableSource")],E.prototype,"readRightTableSource",null),(0,n._)([(0,l.p)("rightTableSource")],E.prototype,"castRightTableSource",null),(0,n._)([(0,c.J)(S)],E.prototype,"joinType",void 0),E=T=(0,n._)([(0,h.j)("esri.layers.support.source.JoinTableDataSource")],E);let M=null;function A(){return M||(M=(0,p.d)({types:O()})),M}let R=null;function O(){return R||(R={key:"type",base:null,typeMap:{"data-layer":I,"map-layer":m.R}}),R}const P={key:"type",base:null,typeMap:{"join-table":E,"query-table":_,raster:b,table:x}};let I=C=class extends o.Z{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new C({fields:e,dataSource:t})}};(0,n._)([(0,c.J)({dataLayer:"data-layer"}),(0,a.Cb)({json:{write:{isRequired:!0}}})],I.prototype,"type",void 0),(0,n._)([(0,a.Cb)({type:[f.Z],json:{write:!0}})],I.prototype,"fields",void 0),(0,n._)([(0,a.Cb)({types:P,json:{write:!0}})],I.prototype,"dataSource",void 0),I=C=(0,n._)([(0,h.j)("esri.layers.support.source.DataLayerSource")],I),I.from=(0,d.se)(I)},81580:(e,t,i)=>{i.d(t,{R:()=>u});var r,n=i(36663),s=i(82064),o=i(81977),a=i(7283),l=(i(39994),i(4157),i(79438)),c=i(40266);let u=r=class extends s.Z{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new r({mapLayerId:e,gdbVersion:t})}};(0,n._)([(0,l.J)({mapLayer:"map-layer"}),(0,o.Cb)({json:{write:{isRequired:!0}}})],u.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:a.z8,json:{write:{isRequired:!0}}})],u.prototype,"mapLayerId",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],u.prototype,"gdbVersion",void 0),u=r=(0,n._)([(0,c.j)("esri.layers.support.source.MapLayerSource")],u)},26503:(e,t,i)=>{var r;i.d(t,{E:()=>r}),function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"}(r||(r={}))},66311:(e,t,i)=>{i.d(t,{W:()=>s,v:()=>o});var r=i(56803);const n={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{"-"===t.charAt(0)?e.style.setProperty(t,i):e.style[t]=i}};let s=e=>(0,r.l7)(n,e),o={create:(e,t)=>(t=s(t),(0,r.WV)(e,document.createElement("div"),void 0,t),(0,r.UQ)(e,t)),append:(e,t,i)=>(i=s(i),(0,r.WV)(t,e,void 0,i),(0,r.UQ)(t,i)),insertBefore:(e,t,i)=>(i=s(i),(0,r.WV)(t,e.parentNode,e,i),(0,r.UQ)(t,i)),merge:(e,t,i)=>(i=s(i),t.domNode=e,(0,r.Yj)(e,t,i),(0,r.UQ)(t,i)),replace:(e,t,i)=>(i=s(i),(0,r.WV)(t,e.parentNode,e,i),e.parentNode.removeChild(e),(0,r.UQ)(t,i))}},56803:(e,t,i)=>{i.d(t,{UQ:()=>A,WV:()=>C,Yj:()=>T,l7:()=>l});var r=i(54956);const n="http://www.w3.org/",s=`${n}2000/svg`,o=`${n}1999/xlink`;let a=[],l=(e,t)=>{let i={};return Object.keys(e).forEach((t=>{i[t]=e[t]})),t&&Object.keys(t).forEach((e=>{i[e]=t[e]})),i},c=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),u=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},h=(e,t,i)=>{if(""!==t.vnodeSelector)for(let r=i;r<e.length;r++)if(c(e[r],t))return r;return-1},d=(e,t,i,r)=>{let n=e[t];if(""===n.vnodeSelector)return;let s=n.properties;if(!(s?void 0===s.key?s.bind:s.key:void 0))for(let s=0;s<e.length;s++)if(s!==t){let t=e[s];if(c(t,n))throw new Error(`${i.vnodeSelector} had a ${n.vnodeSelector} child ${"added"===r?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},p=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},f=[],m=!1,g=e=>{(e.children||[]).forEach(g),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},y=()=>{m=!1,f.forEach(g),f.length=0},_=e=>{f.push(e),m||(m=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(y,{timeout:16}):setTimeout(y,16))},v=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i){t.style.pointerEvents="none";let r=()=>{t.parentNode&&(t.parentNode.removeChild(t),_(e))};return void i(t,r,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),_(e))},b=(e,t,i)=>{if(!t)return;let n=i.eventHandlerInterceptor,a=Object.keys(t),l=a.length;for(let c=0;c<l;c++){let l=a[c],h=t[l];if("className"===l)throw new Error('Property "className" is not supported, use "class".');if("class"===l)S(e,h,!0);else if("classes"===l){let t=Object.keys(h),i=t.length;for(let r=0;r<i;r++){let i=t[r];h[i]&&e.classList.add(i)}}else if("styles"===l){let t=Object.keys(h),r=t.length;for(let n=0;n<r;n++){let r=t[n],s=h[r];s&&(u(s),i.styleApplyer(e,r,s))}}else if("key"!==l&&null!=h){let a=typeof h;"function"===a?(0===l.lastIndexOf("on",0)&&(n&&(h=n(l,h,e,t)),"oninput"===l&&function(){let e=h;h=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}()),e[l]=h):i.namespace===s?"href"===l?e.setAttributeNS(o,l,h):e.setAttribute(l,h):"string"===a&&"value"!==l?"innerHTML"===l?e[l]=r.w3.sanitize(h):w(e)&&l in e?e[l]=h:e.setAttribute(l,h):e[l]=h}}};function w(e){if(!(e instanceof Element&&e.tagName.includes("-")))return!1;const t=window.customElements.get(e.tagName.toLowerCase());return!!t&&e instanceof t}let x,T=(e,t,i)=>{((e,t,i)=>{if(t)for(let r of t)C(r,e,void 0,i)})(e,t.children,i),t.text&&(e.textContent=t.text),b(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},C=(e,t,i,r)=>{let n,o=0,a=e.vnodeSelector,c=t.ownerDocument;if(""===a)n=e.domNode=c.createTextNode(e.text),void 0!==i?t.insertBefore(n,i):t.appendChild(n);else{for(let u=0;u<=a.length;++u){let h=a.charAt(u);if(u===a.length||"."===h||"#"===h){let h=a.charAt(o-1),d=a.slice(o,u);"."===h?n.classList.add(d):"#"===h?n.id=d:("svg"===d&&(r=l(r,{namespace:s})),void 0!==r.namespace?n=e.domNode=c.createElementNS(r.namespace,d):(n=e.domNode=e.domNode||c.createElement(d),"input"===d&&e.properties&&void 0!==e.properties.type&&n.setAttribute("type",e.properties.type)),void 0!==i?t.insertBefore(n,i):n.parentNode!==t&&t.appendChild(n)),o=u+1}}T(n,e,r)}},S=(e,t,i)=>{t&&t.split(" ").forEach((t=>{t&&e.classList.toggle(t,i)}))},E=(e,t,i,n)=>{if(!i)return;let a=!1,l=Object.keys(i),c=l.length;for(let h=0;h<c;h++){let c=l[h],d=i[c],p=t[c];if("class"===c)p!==d&&(S(e,p,!1),S(e,d,!0));else if("classes"===c){let t=e.classList,i=Object.keys(d),r=i.length;for(let e=0;e<r;e++){let r=i[e],n=!!d[r];n!==!!p[r]&&(a=!0,n?t.add(r):t.remove(r))}}else if("styles"===c){let t=Object.keys(d),i=t.length;for(let r=0;r<i;r++){let i=t[r],s=d[i];s!==p[i]&&(a=!0,s?(u(s),n.styleApplyer(e,i,s)):n.styleApplyer(e,i,""))}}else if(d||"string"!=typeof p||(d=""),"value"!==c||w(e)){if(d!==p){let t=typeof d;"function"===t&&n.eventHandlerInterceptor||(n.namespace===s?"href"===c?e.setAttributeNS(o,c,d):e.setAttribute(c,d):"string"===t?"innerHTML"===c?e[c]=r.w3.sanitize(d):"role"===c&&""===d?e.removeAttribute(c):w(e)&&c in e?e[c]=d:e.setAttribute(c,d):e[c]!==d&&(e[c]=d),a=!0)}}else{let t=e[c];t!==d&&(e["oninput-value"]?t===e["oninput-value"]:d!==p)&&(e[c]=d,e["oninput-value"]=void 0),d!==p&&(a=!0)}}return a},M=(e,t,i,r,n)=>{if(i===r)return!1;r=r||a;let s,o=(i=i||a).length,l=r.length,u=0,f=0,m=!1;for(;f<l;){let a=u<o?i[u]:void 0,l=r[f];if(void 0!==a&&c(a,l))m=x(a,l,n)||m,u++;else{let a=h(i,l,u+1);if(a>=0){for(s=u;s<a;s++)v(i[s]),d(i,s,e,"removed");m=x(i[a],l,n)||m,u=a+1}else C(l,t,u<o?i[u].domNode:void 0,n),p(l),d(r,f,e,"added")}f++}if(o>u)for(s=u;s<o;s++)v(i[s]),d(i,s,e,"removed");return m};x=(e,t,i)=>{let r=e.domNode,n=!1;if(e===t)return!1;let o=!1;if(""===t.vnodeSelector){if(t.text!==e.text){let e=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(e,r),t.domNode=e,n=!0,n}t.domNode=r}else 0===t.vnodeSelector.lastIndexOf("svg",0)&&(i=l(i,{namespace:s})),e.text!==t.text&&(o=!0,void 0===t.text?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,o=M(t,r,e.children,t.children,i)||o,o=E(r,e.properties,t.properties,i)||o,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return o&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),n};let A=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,x(r,i,t)},domNode:e.domNode})},22591:(e,t,i)=>{i.d(t,{E:()=>l});var r=i(66311);let n,s=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};n=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let o=(e,t)=>{let i=e;return t.forEach((e=>{i=i&&i.children?n(i.children,(t=>t.domNode===e)):void 0})),i},a=(e,t,i)=>{let r=function(r){i("domEvent",r);let n=t(),a=s(r.currentTarget,n.domNode);a.reverse();let l,c=o(n.getLastRender(),a);return e.scheduleRender(),c&&(l=c.properties[`on${r.type}`].apply(c.properties.bind||this,arguments)),i("domEventProcessed",r),l};return(e,t,i,n)=>r},l=e=>{let t,i,n=(0,r.W)(e),s=n.performanceLogger,o=!0,l=!1,c=[],u=[],h=(e,i,r)=>{let o;n.eventHandlerInterceptor=a(t,(()=>o),s),o=e(i,r(),n),c.push(o),u.push(r)},d=()=>{if(i=void 0,o){o=!1,s("renderStart",void 0);for(let e=0;e<c.length;e++){let t=u[e]();s("rendered",void 0),c[e].update(t),s("patched",void 0)}s("renderDone",void 0),o=!0}};return t={renderNow:d,scheduleRender:()=>{i||l||(i=requestAnimationFrame(d))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),l=!0},resume:()=>{l=!1,o=!0,t.scheduleRender()},append:(e,t)=>{h(r.v.append,e,t)},insertBefore:(e,t)=>{h(r.v.insertBefore,e,t)},merge:(e,t)=>{h(r.v.merge,e,t)},replace:(e,t)=>{h(r.v.replace,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t}},97949:(e,t,i)=>{function r(e){return null!=e&&"object"==typeof e&&"2d"===e.type&&"linkchart"===e.view2dType}i.d(t,{T:()=>r})},4970:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266));let l=r=class extends s.Z{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new r({title:this.title,expression:this.expression})}};(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,n._)([(0,o.Cb)({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"returnType",void 0),l=r=(0,n._)([(0,a.j)("esri.popup.ElementExpressionInfo")],l);const c=l},18228:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266));let l=r=class extends s.Z{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new r({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"name",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,n._)([(0,o.Cb)({type:["string","number"],json:{write:!0}})],l.prototype,"returnType",void 0),l=r=(0,n._)([(0,a.j)("esri.popup.ExpressionInfo")],l);const c=l},78213:(e,t,i)=>{i.d(t,{Z:()=>d});var r,n=i(36663),s=i(25709),o=i(82064),a=i(81977),l=(i(39994),i(13802),i(4157),i(79438)),c=i(40266),u=i(20878);let h=r=class extends o.Z{constructor(e){super(e),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new r({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],h.prototype,"fieldName",void 0),(0,n._)([(0,a.Cb)({type:u.Z,json:{write:!0}})],h.prototype,"format",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],h.prototype,"isEditable",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,n._)([(0,l.J)(new s.X({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],h.prototype,"stringFieldOption",void 0),(0,n._)([(0,a.Cb)({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],h.prototype,"statisticType",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],h.prototype,"tooltip",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],h.prototype,"visible",void 0),h=r=(0,n._)([(0,c.j)("esri.popup.FieldInfo")],h);const d=h},24834:(e,t,i)=>{i.d(t,{Z:()=>u});var r=i(36663),n=i(41151),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(17814),l=i(31808);let c=class extends(n.Z.ClonableMixin(a.Z)){constructor(e){super(e),this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};(0,r._)([(0,s.Cb)({type:String,json:{write:!0}})],c.prototype,"description",void 0),(0,r._)([(0,s.Cb)({type:["auto","preview","list"],json:{write:!0}})],c.prototype,"displayType",void 0),(0,r._)([(0,s.Cb)({type:[l.Z],json:{write:!0}})],c.prototype,"orderByFields",void 0),(0,r._)([(0,s.Cb)({type:String,json:{write:!0}})],c.prototype,"title",void 0),(0,r._)([(0,s.Cb)({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],c.prototype,"type",void 0),c=(0,r._)([(0,o.j)("esri.popup.content.AttachmentsContent")],c);const u=c},49902:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(86076),l=i(99806);let c=r=class extends a.Z{constructor(e){super(e),this.type="bar-chart"}clone(){return new r({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};(0,n._)([(0,s.Cb)({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:l.l.write,isRequired:!0}}})],c.prototype,"type",void 0),c=r=(0,n._)([(0,o.j)("esri.popup.content.BarChartMediaInfo")],c);const u=c},10367:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(86076),l=i(99806);let c=r=class extends a.Z{constructor(e){super(e),this.type="column-chart"}clone(){return new r({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};(0,n._)([(0,s.Cb)({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:l.l.write,isRequired:!0}}})],c.prototype,"type",void 0),c=r=(0,n._)([(0,o.j)("esri.popup.content.ColumnChartMediaInfo")],c);const u=c},17814:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(36663),n=i(82064),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(e){super(e),this.type=null}};(0,r._)([(0,s.Cb)({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.popup.content.Content")],a);const l=a},15902:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(67134),o=i(81977),a=(i(39994),i(13802),i(40266)),l=i(17814);let c=r=class extends l.Z{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new r({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?(0,s.d9)(this.outFields):null})}};(0,n._)([(0,o.Cb)()],c.prototype,"creator",void 0),(0,n._)([(0,o.Cb)()],c.prototype,"destroyer",void 0),(0,n._)([(0,o.Cb)()],c.prototype,"outFields",void 0),(0,n._)([(0,o.Cb)({type:["custom"],readOnly:!0})],c.prototype,"type",void 0),c=r=(0,n._)([(0,a.j)("esri.popup.content.CustomContent")],c);const u=c},32776:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(4970),l=i(17814);let c=r=class extends l.Z{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){return new r({expressionInfo:this.expressionInfo?.clone()})}};(0,n._)([(0,s.Cb)({type:a.Z,json:{write:!0}})],c.prototype,"expressionInfo",void 0),(0,n._)([(0,s.Cb)({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0),c=r=(0,n._)([(0,o.j)("esri.popup.content.ExpressionContent")],c);const u=c},29893:(e,t,i)=>{i.d(t,{Z:()=>d});var r,n=i(36663),s=i(67134),o=i(81977),a=(i(39994),i(13802),i(40266)),l=i(39835),c=i(78213),u=i(17814);let h=r=class extends u.Z{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map((e=>e.toJSON()))}clone(){return new r((0,s.d9)({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};(0,n._)([(0,o.Cb)({type:Object,json:{write:!0}})],h.prototype,"attributes",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],h.prototype,"description",void 0),(0,n._)([(0,o.Cb)({type:[c.Z]})],h.prototype,"fieldInfos",void 0),(0,n._)([(0,l.c)("fieldInfos")],h.prototype,"writeFieldInfos",null),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],h.prototype,"title",void 0),(0,n._)([(0,o.Cb)({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],h.prototype,"type",void 0),h=r=(0,n._)([(0,a.j)("esri.popup.content.FieldsContent")],h);const d=h},2781:(e,t,i)=>{i.d(t,{Z:()=>p});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(16606),l=i(82064);let c=r=class extends l.Z{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new r({linkURL:this.linkURL,sourceURL:this.sourceURL})}};(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],c.prototype,"linkURL",void 0),(0,n._)([(0,s.Cb)({type:String,json:{write:{isRequired:!0}}})],c.prototype,"sourceURL",void 0),c=r=(0,n._)([(0,o.j)("esri.popup.content.support.ImageMediaInfoValue")],c);const u=c;var h;let d=h=class extends a.Z{constructor(e){super(e),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new h({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};(0,n._)([(0,s.Cb)({type:Number,json:{write:!0}})],d.prototype,"refreshInterval",void 0),(0,n._)([(0,s.Cb)({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],d.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:u,json:{write:{isRequired:!0}}})],d.prototype,"value",void 0),d=h=(0,n._)([(0,o.j)("esri.popup.content.ImageMediaInfo")],d);const p=d},66345:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(86076),l=i(99806);let c=r=class extends a.Z{constructor(e){super(e),this.type="line-chart"}clone(){return new r({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};(0,n._)([(0,s.Cb)({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:l.l.write,isRequired:!0}}})],c.prototype,"type",void 0),c=r=(0,n._)([(0,o.j)("esri.popup.content.LineChartMediaInfo")],c);const u=c},21363:(e,t,i)=>{i.d(t,{Z:()=>_});var r,n=i(36663),s=i(67134),o=i(81977),a=(i(39994),i(13802),i(34248)),l=i(40266),c=i(39835),u=i(49902),h=i(10367),d=i(17814),p=i(2781),f=i(66345),m=i(17097),g=i(36598);let y=r=class extends d.Z{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map((e=>"image"===e.type?p.Z.fromJSON(e):"barchart"===e.type?u.Z.fromJSON(e):"columnchart"===e.type?h.Z.fromJSON(e):"linechart"===e.type?f.Z.fromJSON(e):"piechart"===e.type?m.Z.fromJSON(e):void 0)).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map((e=>e.toJSON()))}clone(){return new r((0,s.d9)({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};(0,n._)([(0,o.Cb)()],y.prototype,"activeMediaInfoIndex",void 0),(0,n._)([(0,o.Cb)({type:Object,json:{write:!0}})],y.prototype,"attributes",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],y.prototype,"description",void 0),(0,n._)([(0,o.Cb)({types:[g.V]})],y.prototype,"mediaInfos",void 0),(0,n._)([(0,a.r)("mediaInfos")],y.prototype,"readMediaInfos",null),(0,n._)([(0,c.c)("mediaInfos")],y.prototype,"writeMediaInfos",null),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],y.prototype,"title",void 0),(0,n._)([(0,o.Cb)({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],y.prototype,"type",void 0),y=r=(0,n._)([(0,l.j)("esri.popup.content.MediaContent")],y);const _=y},17097:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(86076),l=i(99806);let c=r=class extends a.Z{constructor(e){super(e),this.type="pie-chart"}clone(){return new r({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};(0,n._)([(0,s.Cb)({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:l.l.write,isRequired:!0}}})],c.prototype,"type",void 0),c=r=(0,n._)([(0,o.j)("esri.popup.content.PieChartMediaInfo")],c);const u=c},83373:(e,t,i)=>{i.d(t,{Z:()=>h});var r=i(36663),n=i(41151),s=i(81977),o=i(7283),a=(i(39994),i(4157),i(40266)),l=i(17814),c=i(79163);let u=class extends(n.Z.ClonableMixin(l.Z)){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};(0,r._)([(0,s.Cb)({type:String,json:{write:!0}})],u.prototype,"description",void 0),(0,r._)([(0,s.Cb)({type:Number,json:{type:o.z8,write:!0}})],u.prototype,"displayCount",void 0),(0,r._)([(0,s.Cb)({type:["list"],json:{write:{isRequired:!0}}})],u.prototype,"displayType",void 0),(0,r._)([(0,s.Cb)({type:[c.Z],json:{write:!0}})],u.prototype,"orderByFields",void 0),(0,r._)([(0,s.Cb)({type:Number,json:{type:o.z8,write:{isRequired:!0}}})],u.prototype,"relationshipId",void 0),(0,r._)([(0,s.Cb)({type:String,json:{write:!0}})],u.prototype,"title",void 0),(0,r._)([(0,s.Cb)({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],u.prototype,"type",void 0),u=(0,r._)([(0,a.j)("esri.popup.content.RelationshipContent")],u);const h=u},58106:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(17814);let l=r=class extends a.Z{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new r({text:this.text})}};(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],l.prototype,"text",void 0),(0,n._)([(0,s.Cb)({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],l.prototype,"type",void 0),l=r=(0,n._)([(0,o.j)("esri.popup.content.TextContent")],l);const c=l},82699:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(36663),n=i(41151),s=i(81977),o=i(7283),a=(i(39994),i(4157),i(79438)),l=i(40266),c=i(17814),u=i(46257);let h=class extends(n.Z.ClonableMixin(c.Z)){constructor(e){super(e),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};(0,r._)([(0,s.Cb)({type:String,json:{write:!0}})],h.prototype,"description",void 0),(0,r._)([(0,s.Cb)({type:Number,json:{type:o.z8,write:!0}})],h.prototype,"displayCount",void 0),(0,r._)([(0,s.Cb)({type:String,json:{write:!0}})],h.prototype,"title",void 0),(0,r._)([(0,s.Cb)({type:[u.Z],json:{write:!0}})],h.prototype,"associationTypes",void 0),(0,r._)([(0,a.J)({utilityNetworkAssociations:"utility-network-associations"})],h.prototype,"type",void 0),h=(0,r._)([(0,l.j)("esri.popup.content.UtilityNetworkAssociationsContent")],h);const d=h},86076:(e,t,i)=>{i.d(t,{Z:()=>g});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(16606),l=i(30936),c=i(82064),u=i(67134),h=i(7283),d=i(94268);let p=r=class extends c.Z{constructor(e){super(e),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new r({colors:(0,u.d9)(this.colors),fields:(0,u.d9)(this.fields),normalizeField:this.normalizeField,series:(0,u.d9)(this.series),tooltipField:this.tooltipField})}};(0,n._)([(0,s.Cb)({type:[l.Z],json:{type:[[h.z8]],write:!0}})],p.prototype,"colors",void 0),(0,n._)([(0,s.Cb)({type:[String],json:{write:{isRequired:!0}}})],p.prototype,"fields",void 0),(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],p.prototype,"normalizeField",void 0),(0,n._)([(0,s.Cb)({type:[d.Z],json:{read:!1}})],p.prototype,"series",void 0),(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],p.prototype,"tooltipField",void 0),p=r=(0,n._)([(0,o.j)("esri.popup.content.support.ChartMediaInfoValue")],p);const f=p;let m=class extends a.Z{constructor(e){super(e),this.type=null,this.value=void 0}};(0,n._)([(0,s.Cb)({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],m.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:f,json:{write:{isRequired:!0}}})],m.prototype,"value",void 0),m=(0,n._)([(0,o.j)("esri.popup.content.mixins.ChartMediaInfo")],m);const g=m},16606:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(36663),n=i(82064),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};(0,r._)([(0,s.Cb)({type:String,json:{write:!0}})],a.prototype,"altText",void 0),(0,r._)([(0,s.Cb)({type:String,json:{write:!0}})],a.prototype,"caption",void 0),(0,r._)([(0,s.Cb)({type:String,json:{write:!0}})],a.prototype,"title",void 0),(0,r._)([(0,s.Cb)({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.popup.content.mixins.MediaInfo")],a);const l=a},94268:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=i(74396),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266));let l=r=class extends s.Z{constructor(e){super(e),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new r({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};(0,n._)([(0,o.Cb)()],l.prototype,"color",void 0),(0,n._)([(0,o.Cb)()],l.prototype,"fieldName",void 0),(0,n._)([(0,o.Cb)()],l.prototype,"tooltip",void 0),(0,n._)([(0,o.Cb)()],l.prototype,"value",void 0),l=r=(0,n._)([(0,a.j)("esri.popup.content.support.ChartMediaInfoValueSeries")],l);const c=l},99806:(e,t,i)=>{i.d(t,{l:()=>r});const r=(0,i(25709).w)()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"})},36598:(e,t,i)=>{i.d(t,{V:()=>l});var r=i(49902),n=i(10367),s=i(2781),o=i(66345),a=i(17097);const l={base:i(16606).Z,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":r.Z,"column-chart":n.Z,"line-chart":o.Z,"pie-chart":a.Z,image:s.Z}}},31808:(e,t,i)=>{i.d(t,{Z:()=>h});var r=i(36663),n=i(41151),s=i(25709),o=i(82064),a=i(81977),l=(i(39994),i(13802),i(4157),i(40266));const c=new s.X({asc:"ascending",desc:"descending"});let u=class extends(n.Z.ClonableMixin(o.Z)){constructor(e){super(e),this.field=null,this.order="ascending"}};(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],u.prototype,"field",void 0),(0,r._)([(0,a.Cb)({type:c.apiValues,json:{type:c.jsonValues,read:c.read,write:c.write}})],u.prototype,"order",void 0),u=(0,r._)([(0,l.j)("esri.popup.support.AttachmentsOrderByInfo")],u);const h=u},20878:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(36663),n=i(41151),s=i(82064),o=i(81977),a=i(7283),l=(i(39994),i(4157),i(79438)),c=i(40266),u=i(72057);let h=class extends(n.Z.ClonableMixin(s.Z)){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};(0,r._)([(0,l.J)(u.Xr)],h.prototype,"dateFormat",void 0),(0,r._)([(0,o.Cb)({type:Boolean,json:{write:!0}})],h.prototype,"digitSeparator",void 0),(0,r._)([(0,o.Cb)({type:a.z8,json:{write:!0}})],h.prototype,"places",void 0),h=(0,r._)([(0,c.j)("esri.popup.support.FieldInfoFormat")],h);const d=h},79163:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266));let l=r=class extends s.Z{constructor(e){super(e),this.field=null,this.order=null}clone(){return new r({field:this.field,order:this.order})}};(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"field",void 0),(0,n._)([(0,o.Cb)({type:["asc","desc"],json:{write:!0}})],l.prototype,"order",void 0),l=r=(0,n._)([(0,a.j)("esri.popup.support.RelatedRecordsInfoFieldOrder")],l);const c=l},46257:(e,t,i)=>{i.d(t,{Z:()=>u});var r=i(36663),n=i(41151),s=i(82064),o=i(81977),a=i(7283),l=(i(39994),i(4157),i(40266));let c=class extends(n.Z.ClonableMixin(s.Z)){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};(0,r._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"title",void 0),(0,r._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"description",void 0),(0,r._)([(0,o.Cb)({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],c.prototype,"type",void 0),(0,r._)([(0,o.Cb)({type:Number,json:{type:a.z8,write:!0}})],c.prototype,"associatedNetworkSourceId",void 0),(0,r._)([(0,o.Cb)({type:Number,json:{type:a.z8,write:!0}})],c.prototype,"associatedAssetGroup",void 0),(0,r._)([(0,o.Cb)({type:Number,json:{type:a.z8,write:!0}})],c.prototype,"associatedAssetType",void 0),c=(0,r._)([(0,l.j)("esri.popup.support.UtilityNetworkAssociationType")],c);const u=c},93968:(e,t,i)=>{i.d(t,{Z:()=>O});var r=i(36663),n=i(51366),s=i(88256),o=i(66341),a=i(70375),l=i(82064),c=i(68309),u=i(61681),h=i(78668),d=i(81977),p=i(7283),f=(i(39994),i(4157),i(34248)),m=i(40266),g=i(91772),y=i(8108);let _;var v=i(36069),b=i(58874),w=i(74396);i(13802);let x=class extends w.Z{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};(0,r._)([(0,d.Cb)()],x.prototype,"nextQueryParams",void 0),(0,r._)([(0,d.Cb)()],x.prototype,"queryParams",void 0),(0,r._)([(0,d.Cb)()],x.prototype,"results",void 0),(0,r._)([(0,d.Cb)()],x.prototype,"total",void 0),x=(0,r._)([(0,m.j)("esri.portal.PortalQueryResult")],x);const T=x;var C,S=i(90298),E=i(99522);let M;const A={PortalGroup:()=>Promise.resolve({default:v.Z}),PortalItem:()=>Promise.resolve().then(i.bind(i,53110)),PortalUser:()=>Promise.resolve({default:S.Z})};let R=C=class extends(l.Z.JSONSupportMixin(c.Z)){constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.default3DBasemapQuery=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.hasClassificationSchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=n.Z.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useDefault3dBasemap=!1,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return"string"==typeof e?{url:e}:e}destroy(){P.unregister(this),this.defaultBasemap=(0,u.SC)(this.defaultBasemap),this.defaultDevBasemap=(0,u.SC)(this.defaultDevBasemap),this.defaultVectorBasemap=(0,u.SC)(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=(0,u.hw)(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)n.Z.request.trustedServers.includes(t)||n.Z.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=this.user?.orgId,t=!e||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get hasAPIKey(){return(0,E.TF)(this.url)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.slice(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e?e.toLowerCase():e}readUser(e){let t=null;return e&&(t=S.Z.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(i.bind(i,10017)).then((({default:t})=>{(0,h.k_)(e),M=t})).then((()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,e))).then((e=>{if(!this.hasAPIKey&&s.id){const e=s.id;this.credential=e.findCredential(this.restUrl),this.credential||this.authMode!==C.AUTH_MODE_AUTO&&this.authMode!==C.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=e.on("credential-create",function(e){const t=s.id;return()=>{const i=e.deref();i&&t.findCredential(i.restUrl)&&i.signIn().catch((()=>{}))}}(new WeakRef(this))),P.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await i.e(98558).then(i.bind(i,98558))).default;return e?e.map((e=>new t({id:e.id,url:e.url}))):[]}async fetchBasemaps(e,t){const i=await this._fetchBasemaps(e,t);if(!0===t?.include3d&&!1!==this.use3dBasemaps){const r=await this._fetchBasemaps3D(e,t);i.unshift(...r)}return i}async fetchDefault3DBasemap(e){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||"none"===this.default3DBasemapQuery)return null;const t=new b.Z;t.query=this.default3DBasemapQuery,t.disableExtraQuery=!0;const i=(await this.queryItems(t,e)).results.find((e=>"Web Scene"===e.type));return i?new M({portalItem:i}):null}fetchCategorySchema(e){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",e).then((e=>e.categorySchema)):(0,h.Hc)(e)?Promise.reject((0,h.zE)()):Promise.resolve([])}async fetchClassificationSchema(e){return this.hasClassificationSchema?this.request(this.restUrl+"/portals/self/classification/classificationSchema",e).then((e=>e.classificationSchema)):null}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new b.Z({num:100,sortField:"title"});if(t?.length){const r=[];for(const e of t)r.push(`(title:"${e.title}" AND owner:${e.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then((e=>e.results))}return(0,h.Hc)(e)?Promise.reject((0,h.zE)()):Promise.resolve([])}fetchRegions(e){const t=this.user?.culture||this.culture||(0,y.Kd)();return this.request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){const t=this.user?.culture||this.culture||(0,y.Kd)();return this.request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return function(e){return _&&!_.destroyed||(_=e()),_}((()=>new C))}queryGroups(e,t){return this.queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this.queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this.queryPortal("/community/users",e,"PortalUser",t)}fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",n={authMode:e,query:{culture:(0,y.Kd)().toLowerCase()},withCredentials:!0,...i};return"auto"===n.authMode&&(n.authMode="no-prompt"),t&&(n.query.default=!0),this.request(r,n)}queryPortal(e,t,i,r){const n=(0,p.se)(b.Z,t),s=t=>this.request(this.restUrl+e,{...n.toRequestOptions(this),...r}).then((e=>{const i=n.clone();return i.start=e.nextStart,new T({nextQueryParams:i,queryParams:n,total:e.total,results:C._resultsToTypedArray(t,{portal:this},e,r)})})).then((e=>Promise.all(e.results.map((t=>"function"==typeof t.when?t.when():e))).then((()=>e),(t=>((0,h.r9)(t),e)))));return i&&A[i]?A[i]().then((({default:e})=>((0,h.k_)(r),s(e)))):s()}signIn(){if(this.hasAPIKey)return this.load().then((()=>{if(!this.user)throw new a.Z("portal:not-authenticated","Unable to authenticate user. Portal.user is missing")}));if(this.authMode===C.AUTH_MODE_ANONYMOUS||this.authMode===C.AUTH_MODE_NO_PROMPT&&!s.id)return Promise.reject(new a.Z("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const e=e=>Promise.resolve().then((()=>"not-loaded"===this.loadStatus?(e||(this.authMode="immediate"),this.load().then((()=>null))):"loading"===this.loadStatus?this.load().then((()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate")))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate")))).then((e=>{e&&(this.sourceJSON=e,this.read(e))}));return s.id?s.id.getCredential(this.restUrl,{prompt:this.authMode!==C.AUTH_MODE_NO_PROMPT}).then((t=>e(t))):e(this.credential)}normalizeUrl(e){const t=this.credential?.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}requestToTypedArray(e,t,i){return this.request(e,t).then((e=>{const t=C._resultsToTypedArray(i,{portal:this},e);return Promise.all(t.map((t=>"function"==typeof t.when?t.when():e))).then((()=>t),(()=>t))}))}request(e,t={}){const i={f:"json",...t.query},{authMode:r=(this.authMode===C.AUTH_MODE_ANONYMOUS||this.authMode===C.AUTH_MODE_NO_PROMPT?this.authMode:"auto"),body:n=null,cacheBust:s=!1,method:a="auto",responseType:l="json",signal:c}=t,u={authMode:r,body:n,cacheBust:s,method:a,query:i,responseType:l,timeout:0,signal:c};return t.withCredentials&&(u.withCredentials=!0),(0,o.Z)(this._normalizeSSL(e),u).then((e=>e.data))}toJSON(){throw new a.Z("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new C({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new a.Z("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}async _fetchBasemaps(e,t){const i=new b.Z;i.query=e||(this.hasAPIKey?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,t);if(!r.total)return[];const n=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const s=await n.queryItems(i,t);return s.total?s.results.filter((e=>"Web Map"===e.type)).map((e=>new M({portalItem:e}))):[]}async _fetchBasemaps3D(e,t){const i=e||this.basemapGalleryGroupQuery3D;if(!i)return[];if(this.hasAPIKey)return[];const r=new b.Z({query:i,disableExtraQuery:!0}),n=await this.queryGroups(r,t);if(!n.total)return[];const s=n.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(r,t);return o.total?o.results.filter((e=>"Web Scene"===e.type)).map((e=>new M({portalItem:e}))):[]}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(e){if(e){const t=M.fromJSON(e);return t.portalItem={portal:this},t}return null}static _resultsToTypedArray(e,t,i,r){let n;if(i){const s=null!=r?r.signal:null;n=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(n=n.map((i=>{const r=Object.assign(e?e.fromJSON(i):i,t);return"function"==typeof r.load&&r.load(s),r})))}else n=[];return n}};R.AUTH_MODE_ANONYMOUS="anonymous",R.AUTH_MODE_AUTO="auto",R.AUTH_MODE_IMMEDIATE="immediate",R.AUTH_MODE_NO_PROMPT="no-prompt",(0,r._)([(0,d.Cb)()],R.prototype,"access",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"allSSL",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"authMode",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"authorizedCrossOriginDomains",void 0),(0,r._)([(0,f.r)("authorizedCrossOriginDomains")],R.prototype,"readAuthorizedCrossOriginDomains",null),(0,r._)([(0,d.Cb)()],R.prototype,"basemapGalleryGroupQuery",void 0),(0,r._)([(0,d.Cb)({json:{name:"3DBasemapGalleryGroupQuery"}})],R.prototype,"basemapGalleryGroupQuery3D",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"bingKey",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"canListApps",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"canListData",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"canListPreProvisionedItems",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"canProvisionDirectPurchase",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"canSearchPublic",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"canShareBingPublic",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"canSharePublic",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"canSignInArcGIS",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"canSignInIDP",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"colorSetsGroupQuery",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"commentsEnabled",void 0),(0,r._)([(0,d.Cb)({type:Date})],R.prototype,"created",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"credential",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"culture",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"currentVersion",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"customBaseUrl",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"default3DBasemapQuery",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"defaultBasemap",void 0),(0,r._)([(0,f.r)("defaultBasemap")],R.prototype,"readDefaultBasemap",null),(0,r._)([(0,d.Cb)()],R.prototype,"defaultDevBasemap",void 0),(0,r._)([(0,f.r)("defaultDevBasemap")],R.prototype,"readDefaultDevBasemap",null),(0,r._)([(0,d.Cb)({type:g.Z})],R.prototype,"defaultExtent",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"defaultVectorBasemap",void 0),(0,r._)([(0,f.r)("defaultVectorBasemap")],R.prototype,"readDefaultVectorBasemap",null),(0,r._)([(0,d.Cb)()],R.prototype,"description",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"devBasemapGalleryGroupQuery",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"eueiEnabled",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],R.prototype,"extraQuery",null),(0,r._)([(0,d.Cb)()],R.prototype,"featuredGroups",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"featuredItemsGroupQuery",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"galleryTemplatesGroupQuery",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"layoutGroupQuery",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"livingAtlasGroupQuery",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],R.prototype,"hasAPIKey",null),(0,r._)([(0,d.Cb)()],R.prototype,"hasCategorySchema",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"hasClassificationSchema",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"helpBase",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"helperServices",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"helpMap",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"homePageFeaturedContent",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"homePageFeaturedContentCount",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"httpPort",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"httpsPort",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"id",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"ipCntryCode",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],R.prototype,"isOrganization",null),(0,r._)([(0,d.Cb)()],R.prototype,"isPortal",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"isReadOnly",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],R.prototype,"itemPageUrl",null),(0,r._)([(0,d.Cb)()],R.prototype,"layerTemplatesGroupQuery",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"maxTokenExpirationMinutes",void 0),(0,r._)([(0,d.Cb)({type:Date})],R.prototype,"modified",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"name",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"portalHostname",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"portalMode",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"portalProperties",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"region",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"recycleBinEnabled",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],R.prototype,"restUrl",null),(0,r._)([(0,d.Cb)()],R.prototype,"rotatorPanels",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"showHomePageDescription",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"sourceJSON",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"staticImagesUrl",void 0),(0,r._)([(0,d.Cb)({json:{name:"2DStylesGroupQuery"}})],R.prototype,"stylesGroupQuery2d",void 0),(0,r._)([(0,d.Cb)({json:{name:"stylesGroupQuery"}})],R.prototype,"stylesGroupQuery3d",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"supportsHostedServices",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"symbolSetsGroupQuery",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"templatesGroupQuery",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"thumbnail",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],R.prototype,"thumbnailUrl",null),(0,r._)([(0,d.Cb)()],R.prototype,"units",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"url",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"urlKey",void 0),(0,r._)([(0,f.r)("urlKey")],R.prototype,"readUrlKey",null),(0,r._)([(0,d.Cb)()],R.prototype,"user",void 0),(0,r._)([(0,f.r)("user")],R.prototype,"readUser",null),(0,r._)([(0,d.Cb)()],R.prototype,"use3dBasemaps",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"useDefault3dBasemap",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"useStandardizedQuery",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"useVectorBasemaps",void 0),(0,r._)([(0,d.Cb)()],R.prototype,"vectorBasemapGalleryGroupQuery",void 0),R=C=(0,r._)([(0,m.j)("esri.portal.Portal")],R);const O=R,P=new FinalizationRegistry((e=>{e.remove()}))},36069:(e,t,i)=>{i.d(t,{Z:()=>d});var r,n=i(36663),s=i(70375),o=i(82064),a=i(81977),l=i(7283),c=(i(39994),i(4157),i(40266)),u=i(58874);let h=r=class extends o.Z{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t&&this.portal?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.portal?.restUrl;return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal.request(this.url+"/categorySchema",e).then((t=>{const i=t.categorySchema||[];return i.some((e=>"contentCategorySetsGroupQuery.LivingAtlas"===e.source))?this._fetchCategorySchemaSet("LivingAtlas",e):i}))}fetchMembers(e){return this.portal.request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new s.Z("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new r({sourceJSON:e});return t.read(e),t}queryItems(e,t){let i=(0,l.se)(u.Z,e);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new u.Z,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new u.Z,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,t))}_fetchCategorySchemaSet(e,t){const i=this.portal;return i.fetchSelf(i.authMode,!0,t).then((e=>{const r=e.contentCategorySetsGroupQuery;if(r){const e=new u.Z({disableExtraQuery:!0,num:1,query:r});return i.queryGroups(e,t)}throw new s.Z("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")})).then((i=>{if(i.total){const r=i.results[0],n=new u.Z({num:1,query:`typekeywords:"${e}"`});return r.queryItems(n,t)}throw new s.Z("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")})).then((e=>e.total?e.results[0].fetchData("json",t).then((e=>{const t=e?.categorySchema;return t?.length?t:[]})):[]))}};(0,n._)([(0,a.Cb)()],h.prototype,"access",void 0),(0,n._)([(0,a.Cb)({type:Date})],h.prototype,"created",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"description",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"id",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"isInvitationOnly",void 0),(0,n._)([(0,a.Cb)({type:Date})],h.prototype,"modified",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"owner",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"portal",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"snippet",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"sortField",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"sortOrder",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"sourceJSON",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"tags",void 0),(0,n._)([(0,a.Cb)()],h.prototype,"thumbnail",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],h.prototype,"thumbnailUrl",null),(0,n._)([(0,a.Cb)()],h.prototype,"title",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],h.prototype,"url",null),h=r=(0,n._)([(0,c.j)("esri.portal.PortalGroup")],h);const d=h},53110:(e,t,i)=>{i.r(t),i.d(t,{default:()=>R});var r=i(36663),n=i(36567),s=i(70375),o=i(82064),a=i(67134),l=i(68309),c=i(3466),u=i(81977),h=i(7283),d=i(34248),p=i(40266),f=i(91772),m=i(93968),g=i(74396),y=i(13802),_=i(69236);i(39994),i(4157);let v=class extends g.Z{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:b(e.path,e.portalItem)}:e}set path(e){null!=e&&(0,c.YP)(e)?y.Z.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return b(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.cdnUrl;if(null==i)throw new s.Z("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey,_ts:t?.cacheBust?Date.now():null},signal:t?.signal})}async update(e,t){const{addOrUpdateResources:r}=await Promise.resolve().then(i.bind(i,68611));return await r(this.portalItem,[{resource:this,content:e,compress:t?.compress,access:t?.access}],"update",t),this}hasPath(){return null!=this.path}};function b(e,t){return null==e?e:(e=e.replace(/^\/+/,""),null!=t&&(0,c.YP)(e)&&(e=(0,c.PF)(e,t.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}(0,r._)([(0,u.Cb)()],v.prototype,"portalItem",void 0),(0,r._)([(0,u.Cb)({type:String,value:null})],v.prototype,"path",null),(0,r._)([(0,_.p)("path")],v.prototype,"_castPath",null),(0,r._)([(0,u.Cb)({type:String,readOnly:!0})],v.prototype,"url",null),(0,r._)([(0,u.Cb)({type:String,readOnly:!0})],v.prototype,"cdnUrl",null),(0,r._)([(0,u.Cb)({type:String,readOnly:!0})],v.prototype,"itemRelativeUrl",null),v=(0,r._)([(0,p.j)("esri.portal.PortalItemResource")],v);const w=v;let x=class extends g.Z{constructor(e){super(e),this.created=null,this.rating=null}};(0,r._)([(0,u.Cb)({type:Date})],x.prototype,"created",void 0),(0,r._)([(0,u.Cb)()],x.prototype,"rating",void 0),x=(0,r._)([(0,p.j)("esri.portal.PortalRating")],x);const T=x;var C,S=i(16641);const E=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),M=new Set(["KML","GeoJson","CSV"]);let A=C=class extends(o.Z.JSONSupportMixin(l.Z)){static from(e){return(0,h.TJ)(C,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.classification=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return"Feature Service"===e||"Feature Collection"===e?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":"Image Service"===e?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?i="Scene Layer":"Video Service"===e?i="Video Layer":"Scene Package"===e?i="Scene Layer Package":"Stream Service"===e?i="Feature Layer":"Geoprocessing Service"===e?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===e?i="GeoEnrichment Service":"Geocoding Service"===e?i="Locator":"Microsoft Powerpoint"===e?i="Microsoft PowerPoint":"GeoJson"===e?i="GeoJSON":"Globe Service"===e?i="Globe Layer":"Vector Tile Service"===e?i="Tile Layer":"netCDF"===e?i="NetCDF":"Map Service"===e?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e?.toLowerCase().includes("add in")?i=e.replaceAll(/(add in)/gi,"Add-In"):"datastore catalog service"===e?i="Big Data File Share":"Compact Tile Package"===e?i="Tile Package (tpkx)":"Raster function template"===e?i="Raster Function Template":"OGCFeatureServer"===e?i="OGC Feature Layer":"web mapping application"===e&&t.includes("configurableApp")?i="Instant App":"Insights Page"===e?i="Insights Report":"Excalibur Imagery Project"===e?i="Excalibur Project":"3DTiles Service"===e?i="3D tiles layer":"3DTiles Package"===e&&(i="3D tiles package"),i}readExtent(e){return e&&e.length?new f.Z(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type?.toLowerCase()||"",t=this.typeKeywords||[];let i,r=!1,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1,h=!1;return e.indexOf("service")>0||"feature collection"===e||"kml"===e||"wms"===e||"wmts"===e||"wfs"===e?(r=t.includes("Hosted Service"),"feature service"===e||"feature collection"===e||"kml"===e||"wfs"===e?(s=t.includes("Table"),o=t.includes("Route Layer"),a=t.includes("Markup"),l=t.includes("Spatiotemporal"),c=t.includes("UtilityNetwork"),i=l&&s?"spatiotemporaltable":s?"table":o?"routelayer":a?"markup":l?"spatiotemporal":c?"utilitynetwork":r?"featureshosted":"features"):"map service"===e||"wms"===e||"wmts"===e?(l=t.includes("Spatiotemporal"),u=t.includes("Relational"),i=l||u?"mapimages":r||t.includes("Tiled")||"wmts"===e?"maptiles":"mapimages"):i="scene service"===e?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===e?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===e?"streamlayer":"vector tile service"===e?"vectortile":"datastore catalog service"===e?"datastorecollection":"geocoding service"===e?"geocodeservice":"video service"===e?t.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===e?t.includes("Web Tool")?"tool":"layers":"geodata service"===e?"geodataservice":"3dtiles service"===e?t.includes("3DObject")?"3dobjecttileslayer":t.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):"web map"===e||"cityengine web scene"===e?i="maps":"web scene"===e?i=t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===e&&t.includes("configurableApp")?i="instantapps":"web mapping application"===e||"mobile application"===e||"application"===e||"operation view"===e||"desktop application"===e?i="apps":"map document"===e||"map package"===e||"published map"===e||"scene document"===e||"globe document"===e||"basemap package"===e||"mobile basemap package"===e||"mobile map package"===e||"project package"===e||"project template"===e||"pro map"===e||"layout"===e||"layer"===e&&t.includes("ArcGIS Pro")||"explorer map"===e&&t.indexOf("Explorer Document")?i="mapsgray":"service definition"===e||"shapefile"===e||"cad drawing"===e||"geojson"===e||"netcdf"===e||"administrative report"===e?i="datafiles":"360 vr experience"===e?i="360vr":"explorer add in"===e||"desktop add in"===e||"windows viewer add in"===e||"windows viewer configuration"===e?i="appsgray":"arcgis pro add in"===e||"arcgis pro configuration"===e?i="addindesktop":"pdf"===e?i="pdf":"microsoft word"===e?i="word":"microsoft excel"===e?i="excel":"microsoft powerpoint"===e?i="ppt":"rule package"===e||"file geodatabase"===e||"sqlite geodatabase"===e||"csv collection"===e||"kml collection"===e||"windows mobile package"===e||"map template"===e||"desktop application template"===e||"gml"===e||"arcpad package"===e||"code sample"===e||"document link"===e||"earth configuration"===e||"operations dashboard add in"===e||"rules package"===e||"workflow manager package"===e||"explorer map"===e&&t.includes("Explorer Mapping Application")||t.includes("Document")?i="datafilesgray":"network analysis service"===e||"geoprocessing service"===e||"geodata service"===e||"geometry service"===e||"geoprocessing package"===e||"locator package"===e||"geoprocessing sample"===e||"workflow manager service"===e?i="toolsgray":"layer"===e||"layer package"===e||"explorer layer"===e?i="layersgray":"analysis model"===e?i="analysismodel":"scene package"===e?i="scenepackage":"3dtiles package"===e?i="3dtileslayerpackage":"3dtiles service"===e?i="3dtileslayer":"mobile scene package"===e?i="mobilescenepackage":"tile package"===e||"compact tile package"===e?i="tilepackage":"task file"===e?i="taskfile":"report template"===e?i="report-template":"statistical data collection"===e?i="statisticaldatacollection":"insights workbook"===e?i="workbook":"insights model"===e?i="insightsmodel":"insights page"===e?i="insightspage":"insights theme"===e?i="insightstheme":"hub initiative"===e?i="hubinitiative":"hub page"===e?i="hubpage":"hub site application"===e?i="hubsite":"hub event"===e?i="hubevent":"hub project"===e?i="hubproject":"relational database connection"===e?i="relationaldatabaseconnection":"big data file share"===e?i="datastorecollection":"image collection"===e?i="imagecollection":"desktop style"===e?i="desktopstyle":"style"===e?i=t.includes("Dictionary")?"dictionarystyle":"style":"dashboard"===e?i="dashboard":"raster function template"===e?i="rasterprocessingtemplate":"vector tile package"===e?i="vectortilepackage":"ortho mapping project"===e?i="orthomappingproject":"ortho mapping template"===e?i="orthomappingtemplate":"solution"===e?i="solutions":"geopackage"===e?i="geopackage":"deep learning package"===e?i="deeplearningpackage":"real time analytic"===e?i="realtimeanalytics":"reality mapping project"===e?i="realitymappingproject":"big data analytic"===e?i="bigdataanalytics":"feed"===e?i="feed":"excalibur imagery project"===e?i="excaliburimageryproject":"notebook"===e?i="notebook":"storymap"===e?i="storymap":"survey123 add in"===e?i="survey123addin":"mission"===e?i="mission":"mission report"===e?i="missionreport":"mission template"===e?i="missiontemplate":"quickcapture project"===e?i="quickcaptureproject":"pro report"===e?i="proreport":"pro report template"===e?i="proreporttemplate":"urban model"===e?i="urbanmodel":"urban project"===e?i="urbanproject":"web experience"===e?i="experiencebuilder":"web experience template"===e?i="webexperiencetemplate":"experience builder widget"===e?i="experiencebuilderwidget":"experience builder widget package"===e?i="experiencebuilderwidgetpackage":"workflow"===e?i="workflow":"kernel gateway connection"===e?i="kernelgatewayconnection":"insights script"===e?i="insightsscript":"hub initiative template"===e?i="hubinitiativetemplate":"storymap theme"===e?i="storymaptheme":"knowledge graph"===e?i="knowledgegraph":"knowledge graph layer"===e?i="knowledgegraphlayer":"knowledge studio project"===e?i="knowledgestudio":"native application"===e?i="nativeapp":"native application installer"===e?i="nativeappinstaller":"web link chart"===e?i="linkchart":"knowledge graph web investigation"===e?i="investigation":"ogcfeatureserver"===e?i="features":"pro presentation"===e?i="propresentation":"pro project"===e?i="proproject":"insights workbook package"===e?i="insightsworkbookpackage":"apache parquet"===e?i="apacheparquet":"notebook code snippet library"===e?i="notebookcodesnippets":"suitability model"===e?i="suitabilitymodel":"esri classifier definition"===e?i="classifierdefinition":"esri classification schema"===e?i="classificationschema":"insights data engineering workbook"===e?i="dataengineeringworkbook":"insights data engineering model"===e?i="dataengineeringmodel":"deep learning studio project"===e?i="deeplearningproject":"discussion"===e?i="discussion":"allsource project"===e?i="allsourceproject":"api key"===e?i="apikey":"data pipeline"===e?i="datapipelines":"group layer"===e?(h=t.includes("Map"),i=h?"layergroup2d":"layergroup"):i="media layer"===e?"onlinemedialayer":"form"===e?t.includes("Survey123")?"survey":"datafilesgray":"csv"===e?"csv":"image"===e?"image":"maps",i?(0,n.V)("esri/images/portal/"+i+"16.png"):null}get isLayer(){return null!=this.type&&E.has(this.type)}get itemCdnUrl(){return(0,S.a)(this.itemUrl)}get itemPageUrl(){const e=this.portal?.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){const e=this.portal?.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`)??null:null}get userItemUrl(){const e=this.portal?.restUrl;if(!e)return null;const t=this.owner||this.portal?.user?.username;return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){const t=this.portal??(this.portal=m.Z.getDefault()),i=t.load(e).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:null!=e?e.signal:null,query:{token:this.apiKey}}):{})).then((e=>{this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}},i=e instanceof T?e.rating:e;return null==i||isNaN(i)||"number"!=typeof e||(t.query.rating=i),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new T({rating:i,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:(0,a.d9)(this.applicationProxies),avgRating:this.avgRating,categories:(0,a.d9)(this.categories),classification:(0,a.d9)(this.classification),created:(0,a.d9)(this.created),culture:this.culture,description:this.description,extent:(0,a.d9)(this.extent),groupCategories:(0,a.d9)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:(0,a.d9)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:(0,a.d9)(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,a.d9)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.d9)(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new C({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){const e=this.toJSON();for(const t of["tags","typeKeywords","categories"])e[t]=e[t]?.join(", ");for(const t of["extent","classification"]){const i=e[t];i&&(e[t]=JSON.stringify(i))}return e}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return this.portal.request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return null!=t.rating?(t.created=new Date(t.created),new T(t)):null}fetchRelatedItems(e,t){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},C)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then((e=>(this.applicationProxies&&!Object.hasOwn(e,"appProxies")&&(this.applicationProxies=null),this.sourceJSON=e,this.read(e),this)))}update(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e?.data,i={method:"post"};i.query=this.createPostQuery();for(const e in i.query)null===i.query[e]&&(i.query[e]="");return i.query.clearEmptyFields=!0,null!=t&&("string"==typeof t?i.query.text=t:"object"==typeof t&&(i.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,i).then((()=>this.reload()))})):Promise.reject(new s.Z("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new s.Z("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:i}=this;await t.signIn();const{copyResources:r,folder:n,tags:o,title:a}=e||{},l={method:"post",query:{copyPrivateResources:"all"===r,folder:"string"==typeof n?n:n?.id,includeResources:!!r,tags:o?.join(","),title:a}},{itemId:c}=await t.request(`${i}/copy`,l);return new C({id:c,portal:t})}updateThumbnail(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if("string"==typeof t)(0,c.HK)(t)?r.query={data:t}:r.query={url:(0,c.hF)(t)},null!=i&&(r.query.filename=i);else{const e=new FormData;null!=i?e.append("file",t,i):e.append("file",t),r.body=e}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then((()=>this.reload()))})):Promise.reject(new s.Z("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){const{fetchResources:r}=await Promise.resolve().then(i.bind(i,68611));return r(this,e,t)}async addResource(e,t,r){const{addOrUpdateResources:n}=await Promise.resolve().then(i.bind(i,68611));return e.portalItem=this,await n(this,[{resource:e,content:t,compress:r?.compress,access:r?.access}],"add",r),e}async removeResource(e,t){const{removeResource:r}=await Promise.resolve().then(i.bind(i,68611));if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new s.Z("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,e,t)}async removeAllResources(e){const{removeAllResources:t}=await Promise.resolve().then(i.bind(i,68611));return t(this,e)}resourceFromPath(e){return new w({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:(0,a.d9)(this.categories),classification:(0,a.d9)(this.classification),created:this.created?.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,a.d9)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.d9)(this.typeKeywords),url:this.url};return(0,a.yd)(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new C({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};(0,r._)([(0,u.Cb)({type:["private","shared","org","public"]})],A.prototype,"access",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"accessInformation",void 0),(0,r._)([(0,u.Cb)({type:String})],A.prototype,"apiKey",void 0),(0,r._)([(0,u.Cb)({json:{read:{source:"appProxies"}}})],A.prototype,"applicationProxies",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"avgRating",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"categories",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"classification",void 0),(0,r._)([(0,u.Cb)({type:Date})],A.prototype,"created",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"culture",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"description",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],A.prototype,"displayName",null),(0,r._)([(0,u.Cb)({type:f.Z})],A.prototype,"extent",void 0),(0,r._)([(0,d.r)("extent")],A.prototype,"readExtent",null),(0,r._)([(0,u.Cb)()],A.prototype,"groupCategories",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],A.prototype,"iconUrl",null),(0,r._)([(0,u.Cb)()],A.prototype,"id",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],A.prototype,"isLayer",null),(0,r._)([(0,u.Cb)({type:Boolean,readOnly:!0})],A.prototype,"isOrgItem",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"itemControl",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],A.prototype,"itemPageUrl",null),(0,r._)([(0,u.Cb)({readOnly:!0})],A.prototype,"itemUrl",null),(0,r._)([(0,u.Cb)()],A.prototype,"licenseInfo",void 0),(0,r._)([(0,u.Cb)({type:Date})],A.prototype,"modified",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"name",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"numComments",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"numRatings",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"numViews",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"owner",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"ownerFolder",void 0),(0,r._)([(0,u.Cb)({type:m.Z})],A.prototype,"portal",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"screenshots",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"size",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"snippet",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"sourceJSON",void 0),(0,r._)([(0,u.Cb)({type:String})],A.prototype,"sourceUrl",void 0),(0,r._)([(0,u.Cb)({type:String})],A.prototype,"spatialReference",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"tags",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"thumbnail",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],A.prototype,"thumbnailUrl",null),(0,r._)([(0,u.Cb)()],A.prototype,"title",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"type",void 0),(0,r._)([(0,u.Cb)()],A.prototype,"typeKeywords",void 0),(0,r._)([(0,u.Cb)({type:String,json:{read(e,t){if(M.has(t.type)){const t=this.portal?.restUrl;e||=t&&this.id?`${t}/content/items/${this.id}/data`:null}return e}}})],A.prototype,"url",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],A.prototype,"userItemUrl",null),A=C=(0,r._)([(0,p.j)("esri.portal.PortalItem")],A);const R=A},58874:(e,t,i)=>{i.d(t,{Z:()=>m});var r,n=i(36663),s=i(74396),o=i(25709),a=i(67134),l=i(81977),c=(i(39994),i(13802),i(40266)),u=i(91772),h=i(14685),d=i(39536);const p=new o.X({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let f=r=class extends s.Z{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){"asc"!==e&&"desc"!==e||this._set("sortOrder",e)}clone(){return new r({categories:this.categories?(0,a.d9)(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i=[];this.categories&&(i=this.categories.map((e=>Array.isArray(e)?JSON.stringify(e):e)));let r="";if(this.extent){const e=(0,d.iV)(this.extent,h.Z.WGS84);null!=e&&(r=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`)}let n=this.query;!this.disableExtraQuery&&e.extraQuery&&(n="("+n+")"+e.extraQuery);const s={categories:i,bbox:r,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map((e=>p.toJSON(e.trim()))).join(","),s.sortOrder=this.sortOrder),{query:{...t,...s}}}};(0,n._)([(0,l.Cb)()],f.prototype,"categories",void 0),(0,n._)([(0,l.Cb)()],f.prototype,"disableExtraQuery",void 0),(0,n._)([(0,l.Cb)({type:u.Z})],f.prototype,"extent",void 0),(0,n._)([(0,l.Cb)()],f.prototype,"filter",void 0),(0,n._)([(0,l.Cb)()],f.prototype,"num",void 0),(0,n._)([(0,l.Cb)()],f.prototype,"query",void 0),(0,n._)([(0,l.Cb)()],f.prototype,"sortField",void 0),(0,n._)([(0,l.Cb)()],f.prototype,"sortOrder",null),(0,n._)([(0,l.Cb)()],f.prototype,"start",void 0),f=r=(0,n._)([(0,c.j)("esri.portal.PortalQueryParams")],f);const m=f},90298:(e,t,i)=>{i.d(t,{Z:()=>p});var r=i(36663),n=i(70375),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266));let l=class extends s.Z{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new n.Z("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};(0,r._)([(0,o.Cb)({type:Date})],l.prototype,"created",void 0),(0,r._)([(0,o.Cb)()],l.prototype,"id",void 0),(0,r._)([(0,o.Cb)()],l.prototype,"portal",void 0),(0,r._)([(0,o.Cb)()],l.prototype,"title",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],l.prototype,"url",null),(0,r._)([(0,o.Cb)()],l.prototype,"username",void 0),l=(0,r._)([(0,a.j)("esri.portal.PortalFolder")],l);const c=l;var u,h=i(36069);let d=u=class extends s.Z{constructor(e){super(e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal.normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.portal?.restUrl;return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e?.data,r=e?.folder,n={method:"post"};t&&(n.query=t.createPostQuery(),null!=i&&("string"==typeof i?n.query.text=i:"object"==typeof i&&(n.query.text=JSON.stringify(i))));let s=this.userContentUrl;return r&&(s+="/"+("string"==typeof r?r:r.id)),this.portal.request(s+"/addItem",n).then((e=>(t.id=e.id,t.portal=this.portal,t.loaded?t.reload():t.load())))}async deleteItem(e,t=!1){let i=this.userContentUrl;e.ownerFolder&&(i+="/"+e.ownerFolder);const r=t?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${e.id}/delete`,{method:"post",query:r}),e.id=null,e.portal=null}async deleteItems(e,t=!1){e=e.slice();const i=this.userContentUrl+"/deleteItems",r=[],s=e.map((e=>e.id));if(s.length){const o={method:"post",query:{items:s.join(","),permanentDelete:t}},a=await this.portal.request(i,o);for(const t of a.results){const i=e.find((e=>t.itemId===e.id)),s=t.success;let o=null;s?(i.id=null,i.portal=null):t.error&&(o=new n.Z("portal:delete-item-failed",t.error.message,t.error)),r.push({item:i,success:s,error:o})}}return r}fetchFolders(){return this.portal.request(this.userContentUrl??"",{query:{num:1}}).then((e=>{let t;return t=e&&e.folders?e.folders.map((e=>{const t=c.fromJSON(e);return t.portal=this.portal,t})):[],t}))}fetchGroups(){return this.portal.request(this.url??"").then((e=>{let t;return t=e&&e.groups?e.groups.map((e=>{const t=h.Z.fromJSON(e);return t.portal=this.portal,t})):[],t}))}async fetchItems(e){e??={};let t=this.userContentUrl??"";e.folder&&(t+="/"+e.folder.id);const{default:r}=await Promise.resolve().then(i.bind(i,53110)),n={folders:!1,inRecycleBin:!!e.inRecycleBin||null,foldersContent:!(e.folder||!e.includeSubfolderItems)||null,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"},s=await this.portal.request(t,{query:n});let o;return s?.items?(o=s.items.map((e=>{const t=r.fromJSON(e);return t.portal=this.portal,t})),await Promise.all(o.map((e=>e.load()))),{items:o,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then((e=>e.tags))}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new h.Z({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new n.Z("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(e,t){const i=this.userContentUrl,r=t?{folderID:"string"==typeof t?t:t.id}:null;await this.portal.request(i+`/items/${e.id}/restore`,{method:"post",query:r})}toJSON(){throw new n.Z("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new u({sourceJSON:e});return t.read(e),t}};(0,r._)([(0,o.Cb)()],d.prototype,"access",void 0),(0,r._)([(0,o.Cb)({type:Date})],d.prototype,"created",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"culture",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"description",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"email",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"favGroupId",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"fullName",void 0),(0,r._)([(0,o.Cb)({type:Date})],d.prototype,"modified",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"orgId",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"portal",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"preferredView",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"privileges",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"region",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"role",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"roleId",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"sourceJSON",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"thumbnail",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],d.prototype,"thumbnailUrl",null),(0,r._)([(0,o.Cb)()],d.prototype,"units",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],d.prototype,"userContentUrl",null),(0,r._)([(0,o.Cb)({readOnly:!0})],d.prototype,"url",null),(0,r._)([(0,o.Cb)()],d.prototype,"username",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"userLicenseTypeId",void 0),(0,r._)([(0,o.Cb)()],d.prototype,"userType",void 0),d=u=(0,r._)([(0,a.j)("esri.portal.PortalUser")],d);const p=d},84513:(e,t,i)=>{i.d(t,{Y:()=>o,h:()=>s});var r=i(3466),n=i(93968);function s(e,t){return{...a(e,t),readResourcePaths:[]}}function o(e,t,i){const n=(0,r.mN)(e.itemUrl);return{...a(e,t),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:n?{rootPath:n.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function a(e,t){return{origin:t,url:(0,r.mN)(e.itemUrl),portal:e.portal||n.Z.getDefault(),portalItem:e}}},31370:(e,t,i)=>{i.d(t,{$o:()=>h,Fj:()=>l,IW:()=>u,Ss:()=>p,_$:()=>a,ck:()=>c,hz:()=>d,qj:()=>o});var r=i(90472),n=i(14685),s=i(39536);function o(e,t){if(!a(e,t)){const i=e.typeKeywords;i?i.push(t):e.typeKeywords=[t]}}function a(e,t){return!!e.typeKeywords?.includes(t)}function l(e){return a(e,d.HOSTED_SERVICE)}function c(e,t){const i=e.typeKeywords;if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}}function u(e,t,i){i?o(e,t):c(e,t)}async function h(e){const t=e.clone().normalize();let i;if(t.length>1)for(const e of t)i?e.width>i.width&&(i=e):i=e;else i=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,s.Sx)(e);const i=n.Z.WGS84;return await(0,r.initializeProjection)(t,i),(0,r.project)(e,i)}(i)}const d={DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function p(e){const{portal:t,isOrgItem:i,itemControl:r}=e,n=t.user?.privileges;let s=!n||n.includes("features:user:edit"),o=!!i&&!!n?.includes("features:user:fullEdit");const a="update"===r||"admin"===r;return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}},51876:(e,t,i)=>{i.d(t,{B:()=>n});var r=i(3466);function n(e){return s[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){const t=(0,r.Ml)(e);return l[t]||o}(e.url)}(e)]||a}const s={},o="text/plain",a=s[o],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const e in l)s[l[e]]=e},68611:(e,t,i)=>{i.r(t),i.d(t,{addOrUpdateResources:()=>a,contentToBlob:()=>d,fetchResources:()=>o,getSiblingOfSameType:()=>p,getSiblingOfSameTypeI:()=>f,removeAllResources:()=>c,removeResource:()=>l,splitPrefixFileNameAndExtension:()=>h});var r=i(66341),n=i(70375),s=i(3466);async function o(e,t={},i){await e.load(i);const r=(0,s.v_)(e.itemUrl,"resources"),{start:n=1,num:o=10,sortOrder:a="asc",sortField:l="resource"}=t,c={query:{start:n,num:o,sortOrder:a,sortField:l,token:e.apiKey},signal:i?.signal},u=await e.portal.request(r,c);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map((({created:t,size:i,resource:r})=>({created:new Date(t),size:i,resource:e.resourceFromPath(r)})))}}async function a(e,t,i,r){const o=new Map;for(const{resource:e,content:r,compress:s,access:a}of t){if(!e.hasPath())throw new n.Z(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[t,l]=u(e.path),c=`${t}/${s??""}/${a??""}`;o.has(c)||o.set(c,{prefix:t,compress:s,access:a,files:[]}),o.get(c).files.push({fileName:l,content:r})}await e.load(r);const a=(0,s.v_)(e.userItemUrl,"add"===i?"addResources":"updateResources");for(const{prefix:t,compress:i,access:n,files:s}of o.values()){const o=25;for(let l=0;l<s.length;l+=o){const c=s.slice(l,l+o),u=new FormData;t&&"."!==t&&u.append("resourcesPrefix",t),i&&u.append("compress","true"),n&&u.append("access",n);let h=0;for(const{fileName:e,content:t}of c)u.append("file"+ ++h,t,e);u.append("f","json"),await e.portal.request(a,{method:"post",body:u,signal:r?.signal})}}}async function l(e,t,i){if(!t.hasPath())throw new n.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(i);const r=(0,s.v_)(e.userItemUrl,"removeResources");await e.portal.request(r,{method:"post",query:{resource:t.path},signal:i?.signal}),t.portalItem=null}async function c(e,t){await e.load(t);const i=(0,s.v_)(e.userItemUrl,"removeResources");return e.portal.request(i,{method:"post",query:{deleteAll:!0},signal:t?.signal})}function u(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function h(e){const[t,i]=function(e){const t=(0,s.Ml)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[r,n]=u(t);return[r,n,i]}async function d(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await(0,r.Z)(e.url,{responseType:"blob"})).data}function p(e,t){if(!e.hasPath())return null;const[i,,r]=h(e.path);return e.portalItem.resourceFromPath((0,s.v_)(i,t+r))}function f(e,t){if(!e.hasPath())return null;const[i,,r]=h(e.path);return e.portalItem.resourceFromPath((0,s.v_)(i,t+r))}},71924:(e,t,i)=>{i.d(t,{P5:()=>o,a5:()=>s,c_:()=>a});const r=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,n={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function s(e){const t=e?.match(r);if(!t)return null;const[,i,s,o]=t;if(!i)return null;let a=null,l=null,c=null;const{devext:u,qaext:h,www:d}=n;if(s)if(a=i,o)switch(o.toLowerCase()){case"devext":({customBaseUrl:l,portalHostname:c}=u);break;case"qa":({customBaseUrl:l,portalHostname:c}=h);break;default:return null}else({customBaseUrl:l,portalHostname:c}=d);else switch(i.toLowerCase()){case"devext":({customBaseUrl:l,portalHostname:c}=u);break;case"qaext":({customBaseUrl:l,portalHostname:c}=h);break;case"www":({customBaseUrl:l,portalHostname:c}=d);break;default:return null}return{customBaseUrl:l,isPortal:!1,portalHostname:c,urlKey:a}}function o(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}function a(e){const t=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return t.test(e)?e=e.replace(t,"https://www.arcgis.com"):i.test(e)?e=e.replace(i,"https://devext.arcgis.com"):r.test(e)&&(e=e.replace(r,"https://qaext.arcgis.com")),e}},80680:(e,t,i)=>{i.d(t,{v:()=>r});const r=(0,i(25709).w)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},71197:(e,t,i)=>{i.d(t,{Y:()=>n});var r=i(18327);const n={readOnly:!0,get(){return(0,r.R)(this.view)}}},86004:(e,t,i)=>{i.d(t,{Z:()=>A});var r,n=i(36663),s=i(25709),o=i(67134),a=i(13802),l=i(81977),c=i(69236),u=i(79438),h=i(34248),d=i(40266),p=i(39835),f=i(7283),m=i(14845),g=i(22836),y=i(54642),_=i(24326),v=i(99520),b=i(98655),w=i(30879),x=i(9539);const T="percent-of-total",C="field",S=new s.X({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:T,esriNormalizeByField:C}),E=(0,f.se)(_.Z);let M=r=class extends((0,y.W)(g.Z)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map((e=>{const t=new _.Z;return t.read(e,i),null==t.minValue&&(t.minValue=r),null==t.maxValue&&(t.maxValue=t.minValue),r=t.maxValue,t}))}writeClassBreakInfos(e,t,i,r){const n=e.map((e=>e.write({},r)));this._areClassBreaksConsecutive()&&n.forEach((e=>delete e.classMinValue)),t[i]=n}castField(e){return null==e?e:"function"==typeof e?(a.Z.getLogger(this).error(".field: field must be a string value"),null):(0,f.Zs)(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=null!=this.normalizationTotal;return t||i?(e=t&&C||i&&T||null,t&&i&&a.Z.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==C&&e!==T||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r="number"==typeof e?new _.Z({minValue:e,maxValue:t,symbol:(0,x.se)(i)}):E((0,o.d9)(e)),this.classBreakInfos.push(r),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]===e&&i[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&null==t?.arcade&&a.Z.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&null==t?.arcade&&(i={...i,arcade:await(0,w.LC)()});const r=this.getBreakIndex(e,i);return-1!==r?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void a.Z.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&null==t?.arcade){const e=await(0,w.LC)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),i={...i,arcade:e}}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}get symbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new r({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:(0,o.d9)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:(0,o.d9)(this.visualVariables),legendOptions:(0,o.d9)(this.legendOptions),authoringInfo:(0,o.d9)(this.authoringInfo)})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.symbols.map((i=>i.collectRequiredFields(e,t))),(0,m.io)(e,t,this.valueExpression)];(0,m.AB)(e,t,this.field),(0,m.AB)(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:n,arcade:s,timeZone:o}=t??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=s.arcadeUtils;if(!l){const e=c.createSyntaxTree(a);l=c.createFunction(e),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=c.executeFunction(l,c.createExecContext(e,c.getViewInfo({viewingMode:i,scale:r,spatialReference:n}),o));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let n=parseFloat(i[t]);if(r){const e=this.normalizationTotal,t=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if("log"===r)n=Math.log(n)*Math.LOG10E;else if(r!==T||null==e||isNaN(e)){if(r===C&&!isNaN(t)){if(isNaN(n)||isNaN(t))return-1;n/=t}}else n=n/e*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};(0,n._)([(0,l.Cb)(v.KK)],M.prototype,"backgroundFillSymbol",void 0),(0,n._)([(0,l.Cb)({type:[_.Z],json:{write:{isRequired:!0}}})],M.prototype,"classBreakInfos",void 0),(0,n._)([(0,h.r)("classBreakInfos")],M.prototype,"readClassBreakInfos",null),(0,n._)([(0,p.c)("classBreakInfos")],M.prototype,"writeClassBreakInfos",null),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],M.prototype,"defaultLabel",void 0),(0,n._)([(0,l.Cb)(v.Gn)],M.prototype,"defaultSymbol",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],M.prototype,"field",void 0),(0,n._)([(0,c.p)("field")],M.prototype,"castField",null),(0,n._)([(0,l.Cb)({type:Boolean})],M.prototype,"isMaxInclusive",void 0),(0,n._)([(0,l.Cb)({type:b.Z,json:{write:!0}})],M.prototype,"legendOptions",void 0),(0,n._)([(0,l.Cb)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],M.prototype,"minValue",null),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],M.prototype,"normalizationField",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],M.prototype,"normalizationTotal",void 0),(0,n._)([(0,l.Cb)({type:S.apiValues,value:null,json:{type:S.jsonValues,read:S.read,write:S.write}})],M.prototype,"normalizationType",null),(0,n._)([(0,u.J)({classBreaks:"class-breaks"})],M.prototype,"type",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],M.prototype,"valueExpression",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],M.prototype,"valueExpressionTitle",void 0),M=r=(0,n._)([(0,d.j)("esri.renderers.ClassBreaksRenderer")],M);const A=M},22836:(e,t,i)=>{i.d(t,{Z:()=>h});var r=i(36663),n=i(25709),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266)),l=i(12552);const c=new n.X({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let u=class extends s.Z{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}get symbols(){return[]}get arcadeRequired(){return!1}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};(0,r._)([(0,o.Cb)({type:l.Z,json:{write:!0}})],u.prototype,"authoringInfo",void 0),(0,r._)([(0,o.Cb)({type:c.apiValues,readOnly:!0,json:{type:c.jsonValues,read:!1,write:{writer:c.write,ignoreOrigin:!0,isRequired:!0}}})],u.prototype,"type",void 0),u=(0,r._)([(0,a.j)("esri.renderers.Renderer")],u);const h=u},50172:(e,t,i)=>{i.d(t,{Z:()=>p});var r,n=i(36663),s=i(67134),o=i(81977),a=(i(39994),i(13802),i(79438)),l=i(40266),c=i(22836),u=i(54642),h=i(99520);let d=r=class extends((0,u.W)(c.Z)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.symbols.map((i=>i.collectRequiredFields(e,t))))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}get symbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return this.symbols.reduce(((e,t)=>e+JSON.stringify(t)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new r({description:this.description,label:this.label,symbol:(0,s.d9)(this.symbol),visualVariables:(0,s.d9)(this.visualVariables),authoringInfo:(0,s.d9)(this.authoringInfo)})}};(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],d.prototype,"description",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,n._)([(0,o.Cb)(h.EW)],d.prototype,"symbol",void 0),(0,n._)([(0,a.J)({simple:"simple"})],d.prototype,"type",void 0),d=r=(0,n._)([(0,l.j)("esri.renderers.SimpleRenderer")],d);const p=d},72043:(e,t,i)=>{i.d(t,{Z:()=>q});var r=i(36663),n=i(70375),s=i(67134),o=i(13802),a=i(86745),l=i(76868),c=i(81977),u=i(69236),h=i(79438),d=i(34248),p=i(40266),f=i(39835),m=i(27281),g=i(7283),y=i(14845),_=i(93968),v=i(22836),b=i(54642),w=i(99520),x=i(98655),T=i(41151),C=i(82064);i(39994),i(4157);let S=class extends(T.Z.ClonableMixin(C.Z)){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};(0,r._)([(0,c.Cb)(w.GY)],S.prototype,"value",void 0),(0,r._)([(0,c.Cb)(w.GY)],S.prototype,"value2",void 0),(0,r._)([(0,c.Cb)(w.GY)],S.prototype,"value3",void 0),S=(0,r._)([(0,p.j)("esri.renderers.support.UniqueValue")],S);const E=S;var M=i(7753);let A=class extends(T.Z.ClonableMixin(C.Z)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(null==e)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return"string"===t||"number"===t?e.map((e=>new E({value:e}))):"object"===t?e[0]instanceof E?e:e.map((e=>new E(e))):null}};(0,r._)([(0,c.Cb)({type:String,json:{write:!0}})],A.prototype,"description",void 0),(0,r._)([(0,c.Cb)({type:String,json:{write:!0}})],A.prototype,"label",void 0),(0,r._)([(0,c.Cb)(w.Gn)],A.prototype,"symbol",void 0),(0,r._)([(0,c.Cb)({type:[E],json:{type:[[String]],read:{reader:e=>e?e.map((e=>new E({value:e[0],value2:e[1],value3:e[2]}))):null},write:{writer:(e,t)=>{const i=[];for(const t of e){const e=[t.value,t.value2,t.value3].filter(M.pC).map((e=>e.toString()));i.push(e)}t.values=i}}}})],A.prototype,"values",void 0),(0,r._)([(0,u.p)("values")],A.prototype,"castValues",null),A=(0,r._)([(0,p.j)("esri.renderers.support.UniqueValueClass")],A);const R=A;let O=class extends(T.Z.ClonableMixin(C.Z)){constructor(e){super(e),this.heading=null,this.classes=null}};(0,r._)([(0,c.Cb)({type:String,json:{write:!0}})],O.prototype,"heading",void 0),(0,r._)([(0,c.Cb)({type:[R],json:{write:{isRequired:!0}}})],O.prototype,"classes",void 0),O=(0,r._)([(0,p.j)("esri.renderers.support.UniqueValueGroup")],O);const P=O;var I,L=i(19946),D=i(30879),N=i(16641),F=i(27948),U=i(97207),k=i(9539);const z="esri.renderers.UniqueValueRenderer",B=()=>o.Z.getLogger(z),V="uvInfos-watcher",H="uvGroups-watcher",G=(0,g.se)(L.Z);function j(e){return null!=e&&""!==e&&("string"!=typeof e||""!==e.trim()&&"<null>"!==e.toLowerCase())||(e=null),e+""}let Z=I=class extends((0,b.W)(v.Z)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let i=!1;const r={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<t.length;n++){const s=e.find((e=>e.value===t[n].value));s?(0,m.Hg)(s,t[n])?(r.changed.push({type:"complete",oldValue:s,newValue:t[n]}),i=!0):r.unchanged.push({oldValue:s,newValue:t[n]}):(r.added.push(t[n]),i=!0)}for(let n=0;n<e.length;n++)t.find((t=>t.value===e[n].value))||(r.removed.push(e[n]),i=!0);return i?r:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return null==e||"function"==typeof e?e:(0,g.Zs)(e)}writeField(e,t,i,r){"string"==typeof e?t[i]=e:r?.messages?r.messages.push(new n.Z("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):B().error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,i){return i.portal||_.Z.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=(0,N.f)(t.styleUrl,i);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=(0,N.t)(e.styleUrl,r))}set uniqueValueGroups(e){this.styleOrigin?B().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?B().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void B().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i="object"==typeof e?G(e):new L.Z({value:e,symbol:(0,k.se)(t)}),this.uniqueValueInfos?.push(i),this._valueInfoMap[j(i.value)]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void B().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t)for(let i=0;i<t.length;i++){const r=t[i];if(String(r.value)===String(e)){delete this._valueInfoMap[j(e)],t.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&null==t?.arcade&&(i={...i,arcade:await(0,D.LC)()}),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void B().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");return this._getUniqueValueInfo(e,t)?.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&null==i?.arcade){const e=await(0,D.LC)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),i={...i,arcade:e}}return this._getUniqueValueInfo(e,i)?.symbol||this.defaultSymbol}get symbols(){const e=[];for(const t of this.uniqueValueInfos??[])t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=this.uniqueValueInfos?.reduce(((e,t)=>e+t.getMeshHash()),"");return`${e}.${t}.${i}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new I({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:(0,s.d9)(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:(0,s.d9)(this.visualVariables),legendOptions:(0,s.d9)(this.legendOptions),authoringInfo:(0,s.d9)(this.authoringInfo),backgroundFillSymbol:(0,s.d9)(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=(0,s.d9)(this.uniqueValueInfos),i=(0,s.d9)(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze((0,s.d9)(this.styleOrigin))),Object.freeze(t),Object.freeze(i)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",i),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.symbols.map((i=>i.collectRequiredFields(e,t))),(0,y.io)(e,t,this.valueExpression)];(0,y.AB)(e,t,this.field),(0,y.AB)(e,t,this.field2),(0,y.AB)(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return(0,U.n2)(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e?.data&&Array.isArray(e.data.items)&&e.data.items.forEach((i=>{const r=new F.Z({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const n=new L.Z({value:i.name,symbol:r});t.push(n),this._valueInfoMap[j(i.name)]=n})),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",",")}_updateUniqueValues(){null!=this._isInfosSource&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[j(t.value)]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(V);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const i of e)t.push((0,l.watch)((()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description})),((e,t)=>{e!==t&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)}),{sync:!0}));this.addHandles(t,V)}}_watchUniqueValueGroups(){this.removeHandles(H);const{uniqueValueGroups:e}=this;if(e){const t=[];for(const i of e){t.push((0,l.watch)((()=>({classes:i.classes})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}));for(const e of i.classes??[])t.push((0,l.watch)((()=>({symbol:e.symbol,values:e.values,label:e.label,description:e.description})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}))}this.addHandles(t,H)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:i,field3:r,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:o}=this;if(!t&&!o)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!t||!i);for(const t of s)for(const s of t.classes??[]){const{symbol:t,label:o,values:l,description:c}=s;for(const s of l??[]){const{value:l,value2:u,value3:h}=s,d=[l];i&&d.push(u),r&&d.push(h);const p=a?d.join(n||""):d[0]??void 0;e.push(new L.Z({symbol:t,label:o,value:p,description:c}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:i,valueExpression:r,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!t&&!r||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!t||!i),a=s.map((e=>{const{symbol:t,label:i,value:r,description:s}=e,[a,l,c]=o?r?.toString()?.split(n||"")||[]:[r];return new R({symbol:t,label:i,description:s,values:[new E({value:a,value2:l,value3:c})]})})),l=[new P({classes:a})];e&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:n,arcade:s,timeZone:o}=t??{};let a=this._cache.compiledFunc;const l=s.arcadeUtils;if(!a){const e=l.createSyntaxTree(this.valueExpression);a=l.createFunction(e),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:i,scale:r,spatialReference:n}),o));return this._valueInfoMap[j(c)]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if(this.field2){const e=this.field2,n=this.field3,s=[];t&&s.push(i[t]),e&&s.push(i[e]),n&&s.push(i[n]),r=s.join(this.fieldDelimiter||"")}else t&&(r=i[t]);return this._valueInfoMap[j(r)]}static fromPortalStyle(e,t){const i=new I(t?.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t?.portal||_.Z.getDefault());const r=i.populateFromStyle();return r.catch((t=>{B().error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),r}static fromStyleUrl(e,t){const i=new I(t?.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch((t=>{B().error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),r}};(0,r._)([(0,c.Cb)({readOnly:!0})],Z.prototype,"_cache",null),(0,r._)([(0,h.J)({uniqueValue:"unique-value"})],Z.prototype,"type",void 0),(0,r._)([(0,c.Cb)(w.KK)],Z.prototype,"backgroundFillSymbol",void 0),(0,r._)([(0,c.Cb)({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Z.prototype,"field",null),(0,r._)([(0,u.p)("field")],Z.prototype,"castField",null),(0,r._)([(0,f.c)("field")],Z.prototype,"writeField",null),(0,r._)([(0,c.Cb)({type:String,value:null,json:{write:!0}})],Z.prototype,"field2",null),(0,r._)([(0,c.Cb)({type:String,value:null,json:{write:!0}})],Z.prototype,"field3",null),(0,r._)([(0,c.Cb)({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],Z.prototype,"orderByClassesEnabled",void 0),(0,r._)([(0,c.Cb)({type:String,value:null,json:{write:!0}})],Z.prototype,"valueExpression",null),(0,r._)([(0,c.Cb)({type:String,json:{write:!0}})],Z.prototype,"valueExpressionTitle",void 0),(0,r._)([(0,c.Cb)({type:x.Z,json:{write:!0}})],Z.prototype,"legendOptions",void 0),(0,r._)([(0,c.Cb)({type:String,json:{write:!0}})],Z.prototype,"defaultLabel",void 0),(0,r._)([(0,c.Cb)((0,a.RH)({...w.Gn},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Z.prototype,"defaultSymbol",null),(0,r._)([(0,c.Cb)({type:String,value:null,json:{write:!0}})],Z.prototype,"fieldDelimiter",null),(0,r._)([(0,c.Cb)({type:_.Z,readOnly:!0})],Z.prototype,"portal",void 0),(0,r._)([(0,d.r)("portal",["styleName"])],Z.prototype,"readPortal",null),(0,r._)([(0,c.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Z.prototype,"styleOrigin",void 0),(0,r._)([(0,d.r)("styleOrigin",["styleName","styleUrl"])],Z.prototype,"readStyleOrigin",null),(0,r._)([(0,f.c)("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Z.prototype,"writeStyleOrigin",null),(0,r._)([(0,c.Cb)({type:[P],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,i)=>(t.uniqueValueGroups||function(e){const{field1:t,field2:i,field3:r,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:o}=e,a=!(!t||!i);return[{classes:(s??[]).map((e=>{const{symbol:s,label:l,value:c,description:u}=e,[h,d,p]=a?c?.toString()?.split(n||"")||[]:[c],f=[];return(t||o)&&f.push(h),i&&f.push(d),r&&f.push(p),{symbol:s,label:l,values:[f],description:u}}))}]}(t)).map((e=>P.fromJSON(e,i)))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Z.prototype,"uniqueValueGroups",null),(0,r._)([(0,c.Cb)({type:[L.Z],json:{read:!1,write:{isRequired:!0,overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0,isRequired:!0}}}}})],Z.prototype,"uniqueValueInfos",null),Z=I=(0,r._)([(0,p.j)(z)],Z);const q=Z},54642:(e,t,i)=>{i.d(t,{W:()=>S});var r=i(36663),n=i(81977),s=(i(39994),i(13802)),o=(i(4157),i(34248)),a=i(40266),l=i(39835),c=i(14845),u=i(72300),h=i(41909),d=i(76880),p=i(16303),f=i(24810),m=i(74396),g=i(25709),y=i(96863);const _={color:u.Z,size:p.Z,opacity:h.Z,rotation:d.Z},v=new g.X({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),b=/^\[([^\]]+)\]$/i;let w=class extends m.Z{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e?.filter((e=>!!e)),e?.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some((e=>!!e.target))&&e.sort(((e,t)=>{let i=null;return i=e.target===t.target?0:e.target?1:-1,i}));for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:n}=t,o=r?.match(b),a=o?.[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map((e=>{const t=v.read(e.type),r=_[t];r||(s.Z.getLogger(this).warn(`Unknown variable type: ${t}`),i?.messages&&i.messages.push(new y.Z("visual-variable:unsupported",`visualVariable of type '${t}' is not supported`,{definition:e,context:i})));const n=new r;return n.read(e,i),n}))}writeVariables(e,t){const i=[];for(const r of e){const e=r.toJSON(t);e&&i.push(e)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};(0,r._)([(0,n.Cb)()],w.prototype,"visualVariables",null),w=(0,r._)([(0,a.j)("esri.renderers.visualVariables.VisualVariableFactory")],w);const x=w;var T=i(77631);const C={base:f.Z,key:"type",typeMap:{opacity:h.Z,color:u.Z,rotation:d.Z,size:p.Z}},S=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new x}set visualVariables(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(e,t,i){return this._vvFactory.readVariables(e,t,i)}writeVisualVariables(e,t,i,r){t[i]=this._vvFactory.writeVariables(e,r)}get arcadeRequiredForVisualVariables(){return this.visualVariables?.some((({arcadeRequired:e})=>e))??!1}hasVisualVariables(e,t){return e?this.getVisualVariablesForType(e,t).length>0:this.getVisualVariablesForType("size",t).length>0||this.getVisualVariablesForType("color",t).length>0||this.getVisualVariablesForType("opacity",t).length>0||this.getVisualVariablesForType("rotation",t).length>0}getVisualVariablesForType(e,t){return this.visualVariables?.filter((i=>i.type===e&&("string"==typeof t?i.target===t:!1!==t||!i.target)))??[]}async collectVVRequiredFields(e,t){let i=[];this.visualVariables&&(i=i.concat(this.visualVariables));for(const r of i)r&&(r.field&&(0,c.AB)(e,t,r.field),r.normalizationField&&(0,c.AB)(e,t,r.normalizationField),r.valueExpression&&(E(r.valueExpression,e,t)||await(0,c.io)(e,t,r.valueExpression)))}};return(0,r._)([(0,n.Cb)({types:[C],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),(0,r._)([(0,o.r)("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),(0,r._)([(0,l.c)("visualVariables")],t.prototype,"writeVisualVariables",null),t=(0,r._)([(0,a.j)("esri.renderers.mixins.VisualVariablesMixin")],t),t};function E(e,t,i){const r=(0,T.v)(e);return null!=r&&((0,c.AB)(t,i,r),!0)}},12552:(e,t,i)=>{i.d(t,{Z:()=>N});var r,n=i(36663),s=i(25709),o=i(82064),a=i(67134),l=i(81977),c=i(7283),u=i(34248),h=i(40266);i(39994),i(13802),i(4157);let d=r=class extends o.Z{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new r({minValue:this.minValue,maxValue:this.maxValue})}};var p;(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],d.prototype,"minValue",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],d.prototype,"maxValue",void 0),d=r=(0,n._)([(0,h.j)("esri.renderers.support.AuthoringInfoClassBreakInfo")],d);let f=p=class extends o.Z{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new p({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:(0,a.d9)(this.classBreakInfos)})}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],f.prototype,"field",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],f.prototype,"normalizationField",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],f.prototype,"label",void 0),(0,n._)([(0,l.Cb)({type:[d],json:{write:!0}})],f.prototype,"classBreakInfos",void 0),f=p=(0,n._)([(0,h.j)("esri.renderers.support.AuthoringInfoFieldInfo")],f);var m,g=i(69236);let y=m=class extends o.Z{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new m({label:this.label,value:this.value,size:this.size})}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],y.prototype,"label",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],y.prototype,"size",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],y.prototype,"value",void 0),y=m=(0,n._)([(0,h.j)("esri.renderers.support.AuthoringInfoSizeStop")],y);const _=y;var v;const b=new s.X({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),w=new s.X({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),x={key:e=>"number"==typeof e?"number":"string",typeMap:{number:Number,string:String},base:null},T=["high-to-low","above-and-below","centered-on","extremes"],C=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],S=["seconds","minutes","hours","days","months","years"];let E=v=class extends o.Z{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return"string"==typeof e||"number"==typeof e?e:null}get normalizationField(){return"reference-size"===this.theme?this._get("normalizationField"):null}set normalizationField(e){this._set("normalizationField",e)}get referenceSizeScale(){return"reference-size"===this.theme?this._get("referenceSizeScale"):null}set referenceSizeScale(e){this._set("referenceSizeScale",e)}get referenceSizeSymbolStyle(){return"reference-size"===this.theme?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(e){this._set("referenceSizeSymbolStyle",e)}castStartTime(e){return"string"==typeof e||"number"==typeof e?e:null}get sizeStops(){return"reference-size"===this.theme?this._get("sizeStops"):null}set sizeStops(e){this._set("sizeStops",e)}get style(){return"color"===this.type?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new v({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:(0,a.d9)(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};(0,n._)([(0,l.Cb)({types:x,json:{write:!0}})],E.prototype,"endTime",void 0),(0,n._)([(0,g.p)("endTime")],E.prototype,"castEndTime",null),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],E.prototype,"field",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],E.prototype,"maxSliderValue",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],E.prototype,"minSliderValue",void 0),(0,n._)([(0,l.Cb)({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],E.prototype,"normalizationField",null),(0,n._)([(0,l.Cb)({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],E.prototype,"referenceSizeScale",null),(0,n._)([(0,l.Cb)({type:["circle","diamond","hexagon-flat","hexagon-pointy","square"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],E.prototype,"referenceSizeSymbolStyle",null),(0,n._)([(0,l.Cb)({types:x,json:{write:!0}})],E.prototype,"startTime",void 0),(0,n._)([(0,g.p)("startTime")],E.prototype,"castStartTime",null),(0,n._)([(0,l.Cb)({type:[_],json:{origins:{"web-scene":{write:!1}},write:!0}})],E.prototype,"sizeStops",null),(0,n._)([(0,l.Cb)({type:b.apiValues,value:null,json:{type:b.jsonValues,read:b.read,write:b.write}})],E.prototype,"style",null),(0,n._)([(0,l.Cb)({type:C,value:null,json:{type:C,origins:{"web-scene":{type:T,write:{writer:(e,t)=>{T.includes(e)&&(t.theme=e)}}}},write:!0}})],E.prototype,"theme",null),(0,n._)([(0,l.Cb)({type:w.apiValues,json:{type:w.jsonValues,read:w.read,write:w.write}})],E.prototype,"type",void 0),(0,n._)([(0,l.Cb)({type:S,json:{type:S,write:!0}})],E.prototype,"units",void 0),E=v=(0,n._)([(0,h.j)("esri.renderers.support.AuthoringInfoVisualVariable")],E);const M=E;var A,R=i(81657);const O=new s.X({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),P=new s.X({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),I=new s.X({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),L=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"];let D=A=class extends o.Z{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?(0,R.i)(e):void 0}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new A({classificationMethod:this.classificationMethod,colorRamp:(0,a.d9)(this.colorRamp),fadeRatio:(0,a.d9)(this.fadeRatio),fields:this.fields?.slice(),field1:(0,a.d9)(this.field1),field2:(0,a.d9)(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((e=>e.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};(0,n._)([(0,l.Cb)({type:O.apiValues,value:null,json:{type:O.jsonValues,read:O.read,write:O.write,origins:{"web-document":{default:"manual",type:O.jsonValues,read:O.read,write:O.write}}}})],D.prototype,"classificationMethod",null),(0,n._)([(0,l.Cb)({types:R.V,json:{write:!0}})],D.prototype,"colorRamp",void 0),(0,n._)([(0,u.r)("colorRamp")],D.prototype,"readColorRamp",null),(0,n._)([(0,l.Cb)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],D.prototype,"fadeRatio",void 0),(0,n._)([(0,l.Cb)({type:[String],value:null,json:{write:!0}})],D.prototype,"fields",null),(0,n._)([(0,l.Cb)({type:f,value:null,json:{write:!0}})],D.prototype,"field1",null),(0,n._)([(0,l.Cb)({type:f,value:null,json:{write:!0}})],D.prototype,"field2",null),(0,n._)([(0,l.Cb)({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],D.prototype,"flowTheme",null),(0,n._)([(0,l.Cb)({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],D.prototype,"focus",null),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],D.prototype,"isAutoGenerated",void 0),(0,n._)([(0,l.Cb)({type:Number,value:null,json:{type:c.z8,write:!0}})],D.prototype,"numClasses",null),(0,n._)([(0,l.Cb)({type:L,json:{type:L,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],D.prototype,"lengthUnit",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],D.prototype,"maxSliderValue",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],D.prototype,"minSliderValue",void 0),(0,n._)([(0,l.Cb)({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],D.prototype,"statistics",null),(0,n._)([(0,l.Cb)({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],D.prototype,"standardDeviationInterval",null),(0,n._)([(0,l.Cb)({type:P.apiValues,value:null,json:{type:P.jsonValues,read:P.read,write:P.write,origins:{"web-scene":{type:I.jsonValues,write:{writer:I.write,overridePolicy:e=>({enabled:"flow"!==e})}}}}})],D.prototype,"type",null),(0,n._)([(0,l.Cb)({type:[M],json:{write:!0}})],D.prototype,"visualVariables",void 0),(0,n._)([(0,l.Cb)({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],D.prototype,"univariateSymbolStyle",null),(0,n._)([(0,l.Cb)({type:["high-to-low","above-and-below","above","below"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],D.prototype,"univariateTheme",null),D=A=(0,n._)([(0,h.j)("esri.renderers.support.AuthoringInfo")],D);const N=D},24326:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266)),l=i(99520);let c=r=class extends s.Z{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new r({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"description",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],c.prototype,"minValue",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],c.prototype,"maxValue",void 0),(0,n._)([(0,o.Cb)(l.EW)],c.prototype,"symbol",void 0),c=r=(0,n._)([(0,a.j)("esri.renderers.support.ClassBreakInfo")],c);const u=c},7541:(e,t,i)=>{i.d(t,{Z:()=>h});var r,n=i(36663),s=i(30936),o=i(82064),a=i(81977),l=i(7283),c=(i(39994),i(4157),i(40266));let u=r=class extends o.Z{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new r({color:this.color&&this.color.clone(),ratio:this.ratio})}};(0,n._)([(0,a.Cb)({type:s.Z,json:{type:[l.z8],default:null,write:{isRequired:!0}}})],u.prototype,"color",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{write:{isRequired:!0}}})],u.prototype,"ratio",void 0),u=r=(0,n._)([(0,c.j)("esri.renderers.support.HeatmapColorStop")],u);const h=u},98655:(e,t,i)=>{i.d(t,{Z:()=>f});var r,n=i(36663),s=i(41151),o=i(25709),a=i(82064),l=i(81977),c=i(7283),u=(i(39994),i(4157),i(79438)),h=i(40266);const d=(0,o.w)()({ascendingValues:"ascending-values",descendingValues:"descending-values"});let p=r=class extends(s.Z.ClonableMixin(a.Z)){static from(e){return(0,c.TJ)(r,e)}constructor(e){super(e),this.title=null,this.order=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],p.prototype,"title",void 0),(0,n._)([(0,u.J)(d)],p.prototype,"order",void 0),p=r=(0,n._)([(0,h.j)("esri.renderers.support.RendererLegendOptions")],p);const f=p},3330:(e,t,i)=>{i.d(t,{E:()=>r});class r{constructor(e,t){this.renderer=e,this.symbol=t}}},19946:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266)),l=i(99520);let c=r=class extends s.Z{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new r({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${e}`}};(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"description",void 0),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,n._)([(0,o.Cb)(l.EW)],c.prototype,"symbol",void 0),(0,n._)([(0,o.Cb)(l.GY)],c.prototype,"value",void 0),c=r=(0,n._)([(0,a.j)("esri.renderers.support.UniqueValueInfo")],c);const u=c},99520:(e,t,i)=>{i.d(t,{EW:()=>u,GY:()=>d,Gn:()=>c,KK:()=>h});var r=i(86745),n=i(3593),s=i(57770),o=i(18251),a=i(83313),l=i(9539);const c={types:l.QT,json:{write:{writer:a.cW},origins:{"web-scene":{types:l.f_,write:{writer:a.cW},read:{reader:(0,n.d)({types:l.f_})}}}}},u=(0,r.RH)({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},c),h={types:{base:o.Z,key:"type",typeMap:{"simple-fill":l.LB.typeMap["simple-fill"],"picture-fill":l.LB.typeMap["picture-fill"],"polygon-3d":l.LB.typeMap["polygon-3d"],cim:l.LB.typeMap.cim}},json:{write:{writer:a.cW},origins:{"web-scene":{type:s.Z,write:{writer:a.cW}}}}},d={cast:e=>null==e||"string"==typeof e||"number"==typeof e?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e?.toString()}}}}},94672:(e,t,i)=>{i.d(t,{AJ:()=>c,If:()=>d,k0:()=>l,uI:()=>h,ul:()=>a,wx:()=>p});var r=i(19431),n=i(95550),s=i(56999),o=i(52721);const a=2.4;function l(e){return(0,n.Wz)(e*a)}function c(e){return(0,n.F2)(e)/a}function u(e,t,i,n){let{color:o,ratio:a}=t,{color:l,ratio:c}=i;if(c===a){const e=1e-6;1===c?a-=e:c+=e}const u=(0,r.uZ)((n-a)/(c-a),0,1);(0,s.l)(e,o.toArray(),l.toArray(),u)}function h(e){const t=new Uint8ClampedArray(2048);if(e=e.filter((({ratio:e})=>e>=0&&e<=1)).sort(((e,t)=>e.ratio-t.ratio)).map((({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)}))),e.length<1)return t;let i=e[0],r=e[0],n=1;const s=(0,o.Ue)();for(let o=0;o<512;o++){const a=(o+.5)/512;for(;a>r.ratio&&n<e.length;)i=r,r=e[n++];u(s,i,r,a),t.set(s,4*o)}return t}function d(e,t,i){const r=Math.sqrt(e**2+t**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function p(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1}},6923:(e,t,i)=>{i.d(t,{a:()=>s});var r=i(17321),n=i(14260);const s={unknown:1,inches:(0,r.En)(1,"meters","inches"),feet:(0,r.En)(1,"meters","feet"),"us-feet":(0,r.En)(1,"meters","us-feet"),yards:(0,r.En)(1,"meters","yards"),miles:(0,r.En)(1,"meters","miles"),"nautical-miles":(0,r.En)(1,"meters","nautical-miles"),millimeters:(0,r.En)(1,"meters","millimeters"),centimeters:(0,r.En)(1,"meters","centimeters"),decimeters:(0,r.En)(1,"meters","decimeters"),meters:(0,r.En)(1,"meters","meters"),kilometers:(0,r.En)(1,"meters","kilometers"),"decimal-degrees":1/(0,r.ty)(1,"meters",n.sv.radius)}},67905:(e,t,i)=>{i.d(t,{Kb:()=>o,o2:()=>c,sV:()=>l,xn:()=>a});var r=i(30936),n=i(3330),s=i(36496);function o(e,t){const i=function(e,t){if(null!=e.symbol)return e.symbol;const i=t?.renderer;return null!=i&&"dot-density"!==i.type?i.getSymbol(e,t):null}(e,t);if(null==i)return null;const r=t?.renderer,o=new n.E(r,i);if(null==r||!("visualVariables"in r)||!r.visualVariables)return o;const a=(0,s.getVisualVariableValues)(r,e,t)??[],l=["proportional","proportional","proportional"];for(const{variable:e,value:t}of a)switch(e.type){case"color":o.color=t.toRgba();break;case"size":if("outline"===e.target)o.outlineSize=t;else{const i=e.axis,r=e.useSymbolValue?"symbol-value":t;switch(i){case"width":l[0]=r;break;case"depth":l[1]=r;break;case"height":l[2]=r;break;case"width-and-depth":l[0]=l[1]=r;break;default:l[0]=l[1]=l[2]=r}}break;case"opacity":o.opacity=t;break;case"rotation":switch(e.axis){case"tilt":o.tilt=t;break;case"roll":o.roll=t;break;default:o.heading=t}}return"proportional"===l[0]&&"proportional"===l[1]&&"proportional"===l[2]||(o.size=l),o}async function a(e,t){const i=await async function(e,t){return null!=e.symbol?e.symbol:t?.renderer?.getSymbolAsync(e,t)??null}(e,t);if(!i)return null;const o=t?.renderer,a=new n.E(o,i);if(!o||!("visualVariables"in o)||!o.visualVariables)return a;const l=(0,s.getVisualVariableValues)(o,e,t)??[],c=["proportional","proportional","proportional"];for(const{variable:e,value:t}of l)if("color"===e.type)a.color=r.Z.toUnitRGBA(t);else if("size"===e.type)if("outline"===e.target)a.outlineSize=t;else{const i=e.axis,r=e.useSymbolValue?"symbol-value":t;"width"===i?c[0]=r:"depth"===i?c[1]=r:"height"===i?c[2]=r:c[0]=c[1]="width-and-depth"===i?r:c[2]=r}else"opacity"===e.type?a.opacity=t:"rotation"===e.type&&"tilt"===e.axis?a.tilt=t:"rotation"===e.type&&"roll"===e.axis?a.roll=t:"rotation"===e.type&&(a.heading=t);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(a.size=c),a}function l(e,t=0){const i=e[t];return"number"==typeof i&&isFinite(i)?i:null}function c(e){for(let t=0;t<3;t++){const i=e[t];if("number"==typeof i)return isFinite(i)?i:0}return 0}},16603:(e,t,i)=>{i.d(t,{y:()=>o});var r=i(67979),n=i(78668),s=i(96863);async function o(e,t,i){const o=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(o&&"unique-value"===o.type&&o.styleOrigin){const a=await(0,r.q6)(o.populateFromStyle());if((0,n.k_)(i),!1===a.ok){const i=a.error;t?.messages&&t.messages.push(new s.Z("renderer:style-reference",`Failed to create unique value renderer from style reference: ${i.message}`,{error:i,context:t})),e.clear("renderer",t?.origin)}}}},88623:(e,t,i)=>{i.d(t,{Av:()=>fe,o:()=>me});var r=i(13802),n=i(86004),s=i(36663),o=i(67134),a=i(81977),l=(i(39994),i(40266)),c=i(39835),u=i(14845),h=i(22836),d=i(54642),p=i(30936),f=i(66341),m=i(70375),g=i(55854),y=i(78668),_=i(26139),v=i(53736),b=i(28790),w=i(30879),x=i(62589),T=i(60789);const C="esri.renderers.support.DictionaryLoader",S={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class E{constructor(e,t,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new g.z(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=t,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,t){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{i=await this._dictionaryPromise}catch(e){if((0,y.D_)(e))return this._dictionaryPromise=null,null}const r=this._dictionaryVersion?.greaterEqual(4,0),n={};if(this.fieldMap)for(const t of this._symbolFields){const i=(0,T.Ts)(this.fieldMap[t],this._fieldIndex);if(i){const s=e.attributes[i];n[t]=r?s:null!=s?""+e.attributes[i]:""}else n[t]=""}let s=null;try{s=i?.(n,t)}catch(e){return null}if(!s||"string"!=typeof s||"invalid"===s)return null;const o=s.split(";"),a=[],l=[];for(let t=0;t<o.length;t++){const i=o[t];if(i)if(i.includes("po:")){const t=i.slice(3).split("|");if(3===t.length){const i=t[0],r=t[1];let n=t[2];const s="countrylabel";if(i===s&&"TextString"===r){if(null!=this.fieldMap){let t=this.fieldMap[s];null==t&&(t=s,this.fieldMap[t]=t),e.attributes[t]=n}continue}if("DashTemplate"===r)n=n.split(" ").map((e=>Number(e)));else if("Color"===r){const e=new p.Z(n).toRgba();n=[e[0],e[1],e[2],255*e[3]]}else n=Number(n);l.push({primitiveName:i,propertyName:r,value:n,defaultValue:null})}}else if(i.includes("|")){for(const e of i.split("|"))if(this._itemNames.has(e)){a.push(e);break}}else if(this._itemNames.has(i))a.push(i);else if(0===t){a.length=0;let t="Invalid_P";null!=e.geometry&&((0,v.oU)(e.geometry)?t="Invalid_A":(0,v.l9)(e.geometry)&&(t="Invalid_L")),a.push(t);break}}const c=null==e.geometry||!e.geometry.hasZ&&"point"===e.geometry.type;return this._cimPartsToCIMSymbol(e,a,l,c,t)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void r.Z.getLogger(C).error("no valid URL!");const t=(0,f.Z)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:null!=e?e.signal:null}),[{data:i}]=await Promise.all([t,(0,w.LC)()]);if(!i)throw this._dictionaryPromise=null,new m.Z("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:n,dictionary_version:s,expression:o,itemsNames:a}=i,l=o;let c=!1;s&&(this._dictionaryVersion=_.G.parse(s),c=this._dictionaryVersion.greaterEqual(4,0)),this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=n.symbol;const u={};if(this.config){const e=this.config;for(const t in e)u[t]=e[t]}if(n.configuration)for(const e of n.configuration)u.hasOwnProperty(e.name)||(u[e.name]=e.value);const h=[];if(e?.fields&&this.fieldMap)for(const t in this.fieldMap){const i=this.fieldMap[t],r=e.fields.filter((e=>e.name.toLowerCase()===i?.toLowerCase()));r.length>0&&h.push({...r[0],type:c?r[0].type:"esriFieldTypeString"})}h.length>0&&(this._fieldIndex=new b.Z(h));const d=(0,w.pp)(l,null!=e?e.spatialReference:null,h,u).then((e=>{const t={scale:0};return(i,r)=>{if(null==e)return null;const n=e.repurposeFeature({geometry:null,attributes:i});return t.scale=null!=r?r.scale??void 0:void 0,e.evaluate({$feature:n,$view:t},e.services)}})).catch((e=>(r.Z.getLogger(C).error("Creating dictionary expression failed:",e),null)));return this._dictionaryPromise=d,d}async _cimPartsToCIMSymbol(e,t,r,n,s){const a=new Array(t.length);for(let e=0;e<t.length;e++)a[e]=this._getSymbolPart(t[e],s);let l=await Promise.all(a);const c=this.fieldMap;if(c&&l.length>0){const{OverrideHelper:t}=await i.e(57970).then(i.bind(i,57970));l=(0,o.d9)(l);for(const i of l)t.applyDictionaryTextOverrides(i,e,c,this._fieldIndex,(0,T.e0)(i))}return new x.Z({data:M(l,r,n)})}async _getSymbolPart(e,t){const i=this._symbolCache.get(e);if(i)return i;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const r=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=(0,f.Z)(r,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,n),n.finally((()=>this._ongoingRequests.delete(e)));try{const t=await n;return this._symbolCache.put(e,t.data),t.data}catch(e){throw e}}}function M(e,t,i){if(!e||0===e.length)return null;const r={...e[0]};if(e.length>1){r.effects=null,r.symbolLayers=[];for(const t of e){const e=t;if(null!=e.effects)for(const t of e.symbolLayers)null==t.effects?t.effects=e.effects:t.effects.unshift(...e.effects);r.symbolLayers.unshift(...e.symbolLayers)}}return i&&(r.callout=S),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:t}}var A;let R=A=class extends((0,d.W)(h.Z)){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new E(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){r?.origin||super.writeVisualVariables(e,t,i,r)}clone(){return new A({config:(0,o.d9)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:(0,o.d9)(this.fieldMap),url:(0,o.d9)(this.url),visualVariables:(0,o.d9)(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await(0,u.io)(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}get symbols(){return[]}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};(0,s._)([(0,a.Cb)({type:E})],R.prototype,"_loader",null),(0,s._)([(0,a.Cb)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],R.prototype,"config",void 0),(0,s._)([(0,a.Cb)({type:Object,json:{write:!0}})],R.prototype,"fieldMap",void 0),(0,s._)([(0,a.Cb)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],R.prototype,"scaleExpression",void 0),(0,s._)([(0,c.c)("scaleExpression")],R.prototype,"writeData",null),(0,s._)([(0,a.Cb)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],R.prototype,"scaleExpressionTitle",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],R.prototype,"url",void 0),(0,s._)([(0,c.c)("visualVariables")],R.prototype,"writeVisualVariables",null),R=A=(0,s._)([(0,l.j)("esri.renderers.DictionaryRenderer")],R);const O=R;var P,I=i(79438),L=i(82064),D=i(69236),N=(i(4157),i(7283));let F=P=class extends L.Z{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(r.Z.getLogger(this).error(".field: field must be a string value"),null):(0,N.Zs)(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new P({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,s._)([(0,a.Cb)({type:p.Z,json:{type:[Number],write:!0}})],F.prototype,"color",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],F.prototype,"field",void 0),(0,s._)([(0,D.p)("field")],F.prototype,"castField",null),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],F.prototype,"label",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],F.prototype,"valueExpression",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],F.prototype,"valueExpressionTitle",void 0),F=P=(0,s._)([(0,l.j)("esri.renderers.support.AttributeColorInfo")],F);const U=F;var k;let z=k=class extends L.Z{constructor(){super(...arguments),this.unit=null}clone(){return new k({unit:this.unit})}};(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],z.prototype,"unit",void 0),z=k=(0,s._)([(0,l.j)("esri.renderers.support.DotDensityLegendOptions")],z);const B=z;var V,H=i(43411),G=i(15498);let j=V=class extends((0,d.W)(h.Z)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new p.Z([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new G.Z,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new H.Z({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new V({attributes:(0,o.d9)(this.attributes),backgroundColor:(0,o.d9)(this.backgroundColor),dotBlendingEnabled:(0,o.d9)(this.dotBlendingEnabled),dotShape:(0,o.d9)(this.dotShape),dotSize:(0,o.d9)(this.dotSize),dotValue:(0,o.d9)(this.dotValue),legendOptions:(0,o.d9)(this.legendOptions),outline:(0,o.d9)(this.outline),referenceScale:(0,o.d9)(this.referenceScale),seed:(0,o.d9)(this.seed),visualVariables:(0,o.d9)(this.visualVariables),authoringInfo:(0,o.d9)(this.authoringInfo)})}getControllerHash(){const e=this.attributes?.map((e=>e.field||e.valueExpression||""));return`${e}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes??[])i.valueExpression&&await(0,u.io)(e,t,i.valueExpression),i.field&&e.add(i.field)}};(0,s._)([(0,a.Cb)({type:[U],json:{write:!0}})],j.prototype,"attributes",void 0),(0,s._)([(0,a.Cb)({type:p.Z,json:{write:!0}})],j.prototype,"backgroundColor",void 0),(0,s._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],j.prototype,"dotBlendingEnabled",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!1}})],j.prototype,"dotShape",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],j.prototype,"dotSize",void 0),(0,s._)([(0,a.Cb)({type:B,json:{write:!0}})],j.prototype,"legendOptions",void 0),(0,s._)([(0,a.Cb)({type:G.Z,json:{default:null,write:!0}})],j.prototype,"outline",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],j.prototype,"dotValue",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],j.prototype,"referenceScale",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],j.prototype,"seed",void 0),(0,s._)([(0,I.J)({dotDensity:"dot-density"})],j.prototype,"type",void 0),j=V=(0,s._)([(0,l.j)("esri.renderers.DotDensityRenderer")],j);const Z=j;var q=i(95550),W=i(12552),$=i(7541),Y=i(41151);let J=class extends(Y.Z.ClonableMixin(L.Z)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],J.prototype,"minLabel",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],J.prototype,"maxLabel",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],J.prototype,"title",void 0),J=(0,s._)([(0,l.j)("esri.renderers.support.HeatmapLegendOptions")],J);var X,K=i(94672),Q=i(1759);function ee(e){if(null!=e){const{maxDensity:t,minDensity:i,radius:r}=e;if(null!=t||null!=i||null!=r){const{blurRadius:t,maxPixelIntensity:i,minPixelIntensity:r,...n}=e;return n}}return e}let te=X=class extends h.Z{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new $.Z({ratio:0,color:new p.Z("rgba(255, 140, 0, 0)")}),new $.Z({ratio:.75,color:new p.Z("rgba(255, 140, 0, 1)")}),new $.Z({ratio:.9,color:new p.Z("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(e){return ee(e)}get blurRadius(){return(0,K.AJ)(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",(0,K.k0)(e)),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(K.ul**2*this.blurRadius**4)}read(e,t){e=ee(e),super.read(e,t)}getSymbol(){return new Q.Z}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,r=this.valueExpression;i&&"string"==typeof i&&(0,u.AB)(e,t,i),r&&"string"==typeof r&&await(0,u.io)(e,t,r)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new X({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:(0,o.d9)(this.colorStops),field:this.field,legendOptions:(0,o.d9)(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,s._)([(0,a.Cb)({type:W.Z,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],te.prototype,"authoringInfo",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],te.prototype,"blurRadius",null),(0,s._)([(0,a.Cb)({type:[$.Z],json:{write:{isRequired:!0}}})],te.prototype,"colorStops",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],te.prototype,"field",void 0),(0,s._)([(0,a.Cb)({type:J,json:{write:!0}})],te.prototype,"legendOptions",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],te.prototype,"maxDensity",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],te.prototype,"maxPixelIntensity",null),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],te.prototype,"minDensity",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],te.prototype,"minPixelIntensity",null),(0,s._)([(0,a.Cb)({type:Number,cast:q.t_,json:{write:!0}})],te.prototype,"radius",void 0),(0,s._)([(0,a.Cb)({type:Number,range:{min:0},json:{default:0,write:!0}})],te.prototype,"referenceScale",void 0),(0,s._)([(0,I.J)({heatmap:"heatmap"})],te.prototype,"type",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],te.prototype,"valueExpression",void 0),(0,s._)([(0,a.Cb)({type:String})],te.prototype,"valueExpressionTitle",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],te.prototype,"_pixelIntensityToDensity",null),te=X=(0,s._)([(0,l.j)("esri.renderers.HeatmapRenderer")],te);const ie=te;var re=i(7753),ne=i(99520);let se=class extends(Y.Z.ClonableMixin(L.Z)){constructor(){super(...arguments),this.color=new p.Z([0,0,0,0]),this.label=null,this.threshold=0}};(0,s._)([(0,a.Cb)({type:p.Z,json:{write:!0}})],se.prototype,"color",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],se.prototype,"label",void 0),(0,s._)([(0,a.Cb)({type:Number,range:{min:0,max:1},json:{write:!0}})],se.prototype,"threshold",void 0),se=(0,s._)([(0,l.j)("esri.renderers.support.OthersCategory")],se);var oe=i(98655),ae=i(41909),le=i(16303);const ce={base:i(24810).Z,key:"type",typeMap:{size:le.Z,opacity:ae.Z}};let ue=class extends((0,d.W)(Y.Z.ClonableMixin(h.Z))){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new p.Z([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new se,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){return new Q.Z({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(re.pC)}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return this.symbols.reduce(((e,t)=>e+JSON.stringify(t)),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await(0,u.io)(e,t,i.valueExpression),i.field&&e.add(i.field)}};(0,s._)([(0,a.Cb)({type:[U],json:{write:!0}})],ue.prototype,"attributes",void 0),(0,s._)([(0,a.Cb)(ne.KK)],ue.prototype,"backgroundFillSymbol",void 0),(0,s._)([(0,a.Cb)({type:p.Z,json:{write:!0}})],ue.prototype,"defaultColor",void 0),(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],ue.prototype,"defaultLabel",void 0),(0,s._)([(0,a.Cb)({type:Number,range:{min:0,max:1},json:{write:!0}})],ue.prototype,"holePercentage",void 0),(0,s._)([(0,a.Cb)({type:se,json:{write:!0}})],ue.prototype,"othersCategory",void 0),(0,s._)([(0,a.Cb)({type:oe.Z,json:{write:!0}})],ue.prototype,"legendOptions",void 0),(0,s._)([(0,a.Cb)({type:G.Z,json:{default:null,write:!0}})],ue.prototype,"outline",void 0),(0,s._)([(0,a.Cb)({type:Number,cast:q.t_,json:{write:!0}})],ue.prototype,"size",void 0),(0,s._)([(0,I.J)({pieChart:"pie-chart"})],ue.prototype,"type",void 0),(0,s._)([(0,a.Cb)({types:[ce]})],ue.prototype,"visualVariables",void 0),ue=(0,s._)([(0,l.j)("esri.renderers.PieChartRenderer")],ue);const he=ue;var de=i(50172),pe=i(72043);const fe={key:"type",base:h.Z,typeMap:{heatmap:ie,simple:de.Z,"unique-value":pe.Z,"class-breaks":n.Z,"dot-density":Z,dictionary:O,"pie-chart":he},errorContext:"renderer"},me={key:"type",base:h.Z,typeMap:{simple:de.Z,"unique-value":pe.Z,"class-breaks":n.Z,heatmap:ie},errorContext:"renderer",validate:function(e){switch(e.type){case"simple":return function(e){if(e.symbol)return e;r.Z.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}(e);case"unique-value":return function(e){const t=e.uniqueValueInfos,i=t?.filter((({symbol:e,label:t},i)=>(e||r.Z.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${i}] ${t}) without a symbol from web scene.`),!!e)));return i?.length!==t?.length&&(e.uniqueValueInfos=i),e}(e);case"class-breaks":return function(e){const t=e.classBreakInfos,i=t?.filter((({symbol:e,label:t},i)=>(e||r.Z.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${i}] ${t}) without a symbol from web scene.`),!!e)));return i?.length!==t?.length&&(e.classBreakInfos=i),e}(e);case"heatmap":return e}}}},72300:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(24810),l=i(68844);let c=r=class extends a.Z{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new r({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,n._)([(0,s.Cb)({readOnly:!0})],c.prototype,"cache",null),(0,n._)([(0,s.Cb)({type:["color"],json:{type:["colorInfo"]}})],c.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],c.prototype,"normalizationField",void 0),(0,n._)([(0,s.Cb)({type:[l.Z],json:{write:!0}})],c.prototype,"stops",null),c=r=(0,n._)([(0,o.j)("esri.renderers.visualVariables.ColorVariable")],c);const u=c},41909:(e,t,i)=>{i.d(t,{Z:()=>y});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(24810),l=i(82064),c=i(7283),u=i(34248),h=i(39835),d=i(78621);let p=r=class extends l.Z{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return(0,d.b)(t.transparency)}writeOpacity(e,t,i){t[i]=(0,d.a)(e)}clone(){return new r({label:this.label,opacity:this.opacity,value:this.value})}};(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],p.prototype,"label",void 0),(0,n._)([(0,s.Cb)({type:Number,json:{type:c.z8,write:{target:"transparency",isRequired:!0}}})],p.prototype,"opacity",void 0),(0,n._)([(0,u.r)("opacity",["transparency"])],p.prototype,"readOpacity",null),(0,n._)([(0,h.c)("opacity")],p.prototype,"writeOpacity",null),(0,n._)([(0,s.Cb)({type:Number,json:{write:{isRequired:!0}}})],p.prototype,"value",void 0),p=r=(0,n._)([(0,o.j)("esri.renderers.visualVariables.support.OpacityStop")],p);const f=p;var m;let g=m=class extends a.Z{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new m({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,n._)([(0,s.Cb)({readOnly:!0})],g.prototype,"cache",null),(0,n._)([(0,s.Cb)({type:["opacity"],json:{type:["transparencyInfo"]}})],g.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],g.prototype,"normalizationField",void 0),(0,n._)([(0,s.Cb)({type:[f],json:{write:!0}})],g.prototype,"stops",null),g=m=(0,n._)([(0,o.j)("esri.renderers.visualVariables.OpacityVariable")],g);const y=g},76880:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(24810);let l=r=class extends a.Z{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){return new r({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};(0,n._)([(0,s.Cb)({readOnly:!0})],l.prototype,"cache",null),(0,n._)([(0,s.Cb)({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],l.prototype,"axis",void 0),(0,n._)([(0,s.Cb)({type:["rotation"],json:{type:["rotationInfo"]}})],l.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],l.prototype,"rotationType",void 0),l=r=(0,n._)([(0,o.j)("esri.renderers.visualVariables.RotationVariable")],l);const c=l},16303:(e,t,i)=>{i.d(t,{Z:()=>E});var r=i(36663),n=i(70375),s=i(25709),o=i(13802),a=i(81977),l=i(69236),c=i(34248),u=i(40266),h=i(39835),d=i(24810),p=i(95550);var f=i(73665),m=(i(39994),i(4157),i(63329));let g=class extends m.Z{constructor(){super(...arguments),this.customValues=null}};(0,r._)([(0,a.Cb)({type:[Number],json:{write:!0}})],g.prototype,"customValues",void 0),g=(0,r._)([(0,u.j)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],g);const y=g;var _,v=i(67272),b=i(36496);const w=new s.X({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),x=new s.X({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function T(e){if(null!=e)return"string"==typeof e||"number"==typeof e?function(e){return(0,p.t_)(e)}(e):"size"===e.type?(0,v.iY)(e)?e:(delete(e={...e}).type,new S(e)):void 0}function C(e,t,i){if("object"!=typeof e)return e;const r=new S;return r.read(e,i),r}let S=_=class extends d.Z{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:null!=this.valueExpression&&b.viewScaleRE.test(this.valueExpression)}}set index(e){(0,v.iY)(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),(0,v.iY)(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return(0,v.PS)(this)}set maxDataValue(e){e&&this.stops&&(o.Z.getLogger(this).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(o.Z.getLogger(this).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return T(e)}readMaxSize(e,t,i){return C(e,0,i)}set minDataValue(e){e&&this.stops&&(o.Z.getLogger(this).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(o.Z.getLogger(this).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return T(e)}readMinSize(e,t,i){return C(e,0,i)}get arcadeRequired(){return!!this.valueExpression||null!=this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||null!=this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)):e&&(o.Z.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return(0,v.QW)(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if("$view.scale"===e){if(r?.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;r.messages.push(new n.Z("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?x.read(e):null}clone(){return new _({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,v.iY)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,v.iY)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===v.hL.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===v.hL.Stops){const e=this.stops;if(!e)return this;const t=e.map((e=>e.size)).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map((e=>e.value||0))}};(0,r._)([(0,a.Cb)({readOnly:!0})],S.prototype,"cache",null),(0,r._)([(0,a.Cb)({type:w.apiValues,json:{type:w.jsonValues,origins:{"web-map":{read:!1}},read:w.read,write:w.write}})],S.prototype,"axis",void 0),(0,r._)([(0,a.Cb)()],S.prototype,"index",null),(0,r._)([(0,a.Cb)({type:String,readOnly:!0})],S.prototype,"inputValueType",null),(0,r._)([(0,a.Cb)({type:y,json:{write:!0}})],S.prototype,"legendOptions",void 0),(0,r._)([(0,a.Cb)({type:Number,value:null,json:{write:!0}})],S.prototype,"maxDataValue",null),(0,r._)([(0,a.Cb)({type:Number,value:null,json:{write:!0}})],S.prototype,"maxSize",null),(0,r._)([(0,l.p)("maxSize")],S.prototype,"castMaxSize",null),(0,r._)([(0,c.r)("maxSize")],S.prototype,"readMaxSize",null),(0,r._)([(0,a.Cb)({type:Number,value:null,json:{write:!0}})],S.prototype,"minDataValue",null),(0,r._)([(0,a.Cb)({type:Number,value:null,json:{write:!0}})],S.prototype,"minSize",null),(0,r._)([(0,l.p)("minSize")],S.prototype,"castMinSize",null),(0,r._)([(0,c.r)("minSize")],S.prototype,"readMinSize",null),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],S.prototype,"normalizationField",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],S.prototype,"arcadeRequired",null),(0,r._)([(0,a.Cb)({type:String})],S.prototype,"scaleBy",void 0),(0,r._)([(0,a.Cb)({type:[f.Z],value:null,json:{write:!0}})],S.prototype,"stops",null),(0,r._)([(0,a.Cb)({type:["outline"],json:{write:!0}})],S.prototype,"target",void 0),(0,r._)([(0,a.Cb)({type:String,readOnly:!0})],S.prototype,"transformationType",null),(0,r._)([(0,a.Cb)({type:["size"],json:{type:["sizeInfo"]}})],S.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],S.prototype,"useSymbolValue",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],S.prototype,"valueExpression",void 0),(0,r._)([(0,c.r)("valueExpression",["valueExpression","expression"])],S.prototype,"readValueExpression",null),(0,r._)([(0,h.c)("web-scene","valueExpression")],S.prototype,"writeValueExpressionWebScene",null),(0,r._)([(0,a.Cb)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],S.prototype,"valueRepresentation",void 0),(0,r._)([(0,a.Cb)({type:x.apiValues,json:{write:x.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],S.prototype,"valueUnit",void 0),(0,r._)([(0,c.r)("valueUnit")],S.prototype,"readValueUnit",null),S=_=(0,r._)([(0,u.j)("esri.renderers.visualVariables.SizeVariable")],S);const E=S},24810:(e,t,i)=>{i.d(t,{Z:()=>f});var r=i(36663),n=i(25709),s=i(82064),o=i(13802),a=i(81977),l=i(69236),c=i(40266),u=i(7283),h=i(63329);const d=new n.X({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let p=class extends s.Z{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(o.Z.getLogger(this).error(".field: field must be a string value"),null):(0,u.Zs)(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};(0,r._)([(0,a.Cb)()],p.prototype,"index",void 0),(0,r._)([(0,a.Cb)({type:d.apiValues,readOnly:!0,json:{read:d.read,write:{writer:d.write,isRequired:!0}}})],p.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],p.prototype,"field",void 0),(0,r._)([(0,l.p)("field")],p.prototype,"castField",null),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],p.prototype,"valueExpression",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],p.prototype,"valueExpressionTitle",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],p.prototype,"arcadeRequired",null),(0,r._)([(0,a.Cb)({type:h.Z,json:{write:!0}})],p.prototype,"legendOptions",void 0),p=(0,r._)([(0,c.j)("esri.renderers.visualVariables.VisualVariable")],p);const f=p},68844:(e,t,i)=>{i.d(t,{Z:()=>d});var r,n=i(36663),s=i(30936),o=i(82064),a=i(81977),l=i(7283),c=(i(39994),i(4157),i(40266)),u=i(39835);let h=r=class extends o.Z{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=e??0}clone(){return new r({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};(0,n._)([(0,a.Cb)({type:s.Z,json:{type:[l.z8],write:{isRequired:!0}}})],h.prototype,"color",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],h.prototype,"value",void 0),(0,n._)([(0,u.c)("value")],h.prototype,"writeValue",null),h=r=(0,n._)([(0,c.j)("esri.renderers.visualVariables.support.ColorStop")],h);const d=h},73665:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(82064),o=i(95550),a=i(81977),l=(i(39994),i(13802),i(4157),i(40266));let c=r=class extends s.Z{constructor(e){super(e),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new r({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,n._)([(0,a.Cb)({type:Number,cast:o.t_,json:{write:{isRequired:!0}}})],c.prototype,"size",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{write:{isRequired:!0}}})],c.prototype,"value",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!1}})],c.prototype,"useMinValue",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!1}})],c.prototype,"useMaxValue",void 0),c=r=(0,n._)([(0,l.j)("esri.renderers.visualVariables.support.SizeStop")],c);const u=c},63329:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(36663),n=i(41151),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266));let l=class extends(n.Z.ClonableMixin(s.Z)){constructor(){super(...arguments),this.showLegend=null,this.title=null}};(0,r._)([(0,o.Cb)({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),(0,r._)([(0,o.Cb)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=(0,r._)([(0,a.j)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l);const c=l},67272:(e,t,i)=>{var r,n;function s(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function o(e){return null!=e&&!isNaN(e)&&isFinite(e)}function a(e){return e.valueExpression?r.Expression:e.field&&"string"==typeof e.field?r.Field:r.Unknown}function l(e,t){const i=t||a(e),s=e.valueUnit||"unknown";return i===r.Unknown?n.Constant:e.stops?n.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?n.ClampedLinear:"unknown"===s?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?n.Proportional:n.Additive:n.Identity:n.RealWorldSize}i.d(t,{PS:()=>a,QW:()=>l,RY:()=>r,hL:()=>n,iY:()=>s,qh:()=>o}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(r||(r={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(n||(n={}))},36496:(e,t,i)=>{i.r(t),i.d(t,{getAllSizes:()=>S,getColor:()=>m,getOpacity:()=>g,getRotationAngle:()=>y,getSize:()=>_,getSizeForValue:()=>w,getSizeFromNumberOrVariable:()=>v,getSizeRangeAtScale:()=>x,getVisualVariableValues:()=>T,viewScaleRE:()=>f});var r=i(30936),n=i(80085),s=i(27755),o=i(13802),a=i(6923),l=i(67272);const c=()=>o.Z.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u=e=>c().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),h=()=>c().error("Use of arcade expressions requires an arcade context"),d=new n.Z,p=Math.PI,f=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function m(e,t,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!n)return;if("esri.renderers.visualVariables.ColorVariable"!==n.declaredClass)return void u("ColorVariable");const s="number"==typeof t,o=s?null:t,a=o?.attributes;let l=s?t:null;const c=n.field,{ipData:d,hasExpression:p}=n.cache;let f=n.cache.compiledFunc;if(!c&&!p){const e=n.stops;return e&&e[0]&&e[0].color}if("number"!=typeof l)if(p){if(null==i?.arcade)return void h();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,r=t.getViewInfo(e),s=t.createExecContext(o,r,i.timeZone);if(!f){const e=t.createSyntaxTree(n.valueExpression);f=t.createFunction(e),n.cache.compiledFunc=f}l=t.executeFunction(f,s)}else a&&(l=a[c]);const m=n.normalizationField,g=null!=a&&null!=m?parseFloat(a[m]):void 0;if(null!=l&&(!m||s||!isNaN(g)&&0!==g)){isNaN(g)||s||(l/=g);const e=C(l,d);if(e){const t=e[0],s=e[1],o=t===s?n.stops[t].color:r.Z.blendColors(n.stops[t].color,n.stops[s].color,e[2],null!=i?i.color:void 0);return new r.Z(o)}}}function g(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.OpacityVariable"!==r.declaredClass)return void u("OpacityVariable");const n="number"==typeof t,s=n?null:t,o=s?.attributes;let a=n?t:null;const l=r.field,{ipData:c,hasExpression:d}=r.cache;let p=r.cache.compiledFunc;if(!l&&!d){const e=r.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof a)if(d){if(null==i?.arcade)return void h();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,n=t.getViewInfo(e),o=t.createExecContext(s,n,i.timeZone);if(!p){const e=t.createSyntaxTree(r.valueExpression);p=t.createFunction(e),r.cache.compiledFunc=p}a=t.executeFunction(p,o)}else o&&(a=o[l]);const f=r.normalizationField,m=null!=o&&null!=f?parseFloat(o[f]):void 0;if(null!=a&&(!f||n||!isNaN(m)&&0!==m)){isNaN(m)||n||(a/=m);const e=C(a,c);if(e){const t=e[0],i=e[1];if(t===i)return r.stops[t].opacity;{const n=r.stops[t].opacity;return n+(r.stops[i].opacity-n)*e[2]}}}}function y(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.RotationVariable"!==r.declaredClass)return void u("RotationVariable");const n=r.axis||"heading",s="heading"===n&&"arithmetic"===r.rotationType?90:0,o="heading"===n&&"arithmetic"===r.rotationType?-1:1,a="number"==typeof t?null:t,l=a?.attributes,c=r.field,{hasExpression:d}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!d)return f;if(d){if(null==i?.arcade)return void h();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,n=t.getViewInfo(e),s=t.createExecContext(a,n,i.timeZone);if(!p){const e=t.createSyntaxTree(r.valueExpression);p=t.createFunction(e),r.cache.compiledFunc=p}f=t.executeFunction(p,s)}else l&&(f=l[c]||0);return f="number"!=typeof f||isNaN(f)?null:s+o*f,f}function _(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.SizeVariable"!==r.declaredClass)return void u("SizeVariable");const n=w(function(e,t,i){const r="number"==typeof t,n=r?null:t,s=n?.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let c=e.cache.compiledFunc;if(a){const t=null!=i?i.scale:void 0,r=null!=i?i.view:void 0;o=null==t||"3d"===r?function(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}(e):t}else if(!r)switch(e.inputValueType){case l.RY.Expression:{if(null==i?.arcade)return void h();const t={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},r=i.arcade.arcadeUtils,s=r.getViewInfo(t),a=r.createExecContext(n,s,i.timeZone);if(!c){const t=r.createSyntaxTree(e.valueExpression);c=r.createFunction(t),e.cache.compiledFunc=c}o=r.executeFunction(c,a);break}case l.RY.Field:s&&(o=s[e.field]);break;case l.RY.Unknown:o=null}if(!(0,l.qh)(o))return null;if(r||!e.normalizationField)return o;const u=s?parseFloat(s[e.normalizationField]):null;return(0,l.qh)(u)&&0!==u?o/u:null}(r,t,i),r,t,i,r.cache.ipData);return null==n||isNaN(n)?0:n}function v(e,t,i){return null==e?null:(0,l.iY)(e)?_(e,t,i):(0,l.qh)(e)?e:null}function b(e,t,i){return(0,l.qh)(i)&&e>i?i:(0,l.qh)(t)&&e<t?t:e}function w(e,t,i,r,n){switch(t.transformationType){case l.hL.Additive:return function(e,t,i,r){return e+((v(t.minSize,i,r)||t.minDataValue)??0)}(e,t,i,r);case l.hL.Constant:return function(e,t,i){const r=e.stops;let n=r?.length&&r[0].size;return null==n&&(n=e.minSize),v(n,t,i)}(t,i,r);case l.hL.ClampedLinear:return function(e,t,i,r){const n=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),s=v(t.minSize,i,r),o=v(t.maxSize,i,r),a=null!=r?r.shape:void 0;if(e<=t.minDataValue)return s;if(e>=t.maxDataValue)return o;if(null==s||null==o)return null;if("area"===t.scaleBy&&a){const e="circle"===a,t=e?p*(s/2)**2:s*s,i=t+n*((e?p*(o/2)**2:o*o)-t);return e?2*Math.sqrt(i/p):Math.sqrt(i)}return s+n*(o-s)}(e,t,i,r);case l.hL.Proportional:return function(e,t,i,r){const n=null!=r?r.shape:void 0,s=e/t.minDataValue,o=v(t.minSize,i,r),a=v(t.maxSize,i,r);let l=null;return l="circle"===n?2*Math.sqrt(s*(o/2)**2):"square"===n||"diamond"===n||"image"===n?Math.sqrt(s*o**2):s*o,b(l,o,a)}(e,t,i,r);case l.hL.Stops:return function(e,t,i,r,n){const[s,o,a]=C(e,n);if(s===o)return v(t.stops?.[s].size,i,r);{const e=v(t.stops?.[s].size,i,r);return e+(v(t.stops?.[o].size,i,r)-e)*a}}(e,t,i,r,n);case l.hL.RealWorldSize:return function(e,t,i,r){const n=(r?.resolution??1)*a.a[t.valueUnit],s=v(t.minSize,i,r),o=v(t.maxSize,i,r),{valueRepresentation:l}=t;let c=null;return c="area"===l?2*Math.sqrt(e/p)/n:"radius"===l||"distance"===l?2*e/n:e/n,b(c,s,o)}(e,t,i,r);case l.hL.Identity:return e;case l.hL.Unknown:return null}}function x(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&"3d"===i||t))return null;const n={scale:t,view:i};let s=v(e.minSize,d,n),o=v(e.maxSize,d,n);if(null!=s||null!=o){if(s>o){const e=o;o=s,s=e}return{minSize:s,maxSize:o}}}function T(e,t,i){if(!e.visualVariables)return;const r=[],n=[],s=[],o=[],a=[];for(const t of e.visualVariables)switch(t.type){case"color":n.push(t);break;case"opacity":s.push(t);break;case"rotation":a.push(t);break;case"size":o.push(t)}return n.forEach((e=>{const n=m(e,t,i);r.push({variable:e,value:n})})),s.forEach((e=>{const n=g(e,t,i);r.push({variable:e,value:n})})),a.forEach((e=>{const n=y(e,t,i);r.push({variable:e,value:n})})),o.forEach((e=>{const n=_(e,t,i);r.push({variable:e,value:n})})),r.filter((e=>null!=e.value))}function C(e,t){if(!t)return;let i=0,r=t.length-1;return t.some(((t,n)=>e<t?(r=n,!0):(i=n,!1))),[i,r,(e-t[i])/(t[r]-t[i])]}function S(e,t,i){const r=["proportional","proportional","proportional"];for(const n of e){const e=n.useSymbolValue?"symbol-value":_(n,t,i);switch(n.axis){case"width":r[0]=e;break;case"depth":r[1]=e;break;case"height":r[2]=e;break;case"width-and-depth":r[0]=e,r[1]=e;break;case"all":case void 0:case null:r[0]=e,r[1]=e,r[2]=e;break;default:(0,s.Bg)(n.axis)}}return r}},66341:(e,t,i)=>{i.d(t,{Z:()=>m});var r=i(51366),n=i(88256),s=i(70375),o=i(39994),a=i(67134),l=i(86114),c=i(78668),u=i(3466),h=i(20692),d=i(71924),p=i(99522),f=i(73401);async function m(e,t){e instanceof URL&&(e=e.toString()),t?.query instanceof URLSearchParams&&(t.query=(0,u.u0)(t.query.toString().replaceAll("+"," ")));const r=(0,u.HK)(e),n=(0,u.jc)(e);n||r||(e=(0,u.Fv)(e));const s={url:e,requestOptions:{...t}},a=e=>({data:e,getAllHeaders:x,getHeader:x,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),d=(0,u.oh)(e,y.internalInterceptors);if(d){const e=await R(d,s);if(null!=e)return a(e)}let p=(0,u.oh)(e);if(p){const e=await R(p,s);if(null!=e)return a(e);p.after||p.error||(p=null)}if(e=s.url,"image"===(t=s.requestOptions).responseType&&((0,o.Z)("host-webworker")||(0,o.Z)("host-node")))throw S("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if("head"===t.method){if(t.body)throw S("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||n)throw S("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await async function(){(0,o.Z)("host-webworker")&&!g&&(g=await i.e(53714).then(i.bind(i,53714)))}(),g)return g.execute(e,t);const f=new AbortController,m=(0,c.fu)(t,(()=>f.abort())),_={controller:f,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:p,params:s,redoRequest:!1,useIdentity:y.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},v=t.useRequestQueue?async function(e){const t=function(e){let t,i;return"string"==typeof e?(t=(0,u.P$)(e,!0),i=(0,h.M8)(e)):(t=e.origin,i=(0,h.M8)(e.toString())),null==t?null:{origin:t,isHosted:i}}(e.params.url);if(!t)return I(e);const{QueueProcessor:r}=await i.e(29258).then(i.bind(i,29258)),n=(0,l.s1)(P,t.origin,(()=>{const e=t.isHosted?(0,o.Z)("request-queue-concurrency-hosted"):(0,o.Z)("request-queue-concurrency-non-hosted");return new r({concurrency:e,process:e=>{if((0,c.Hc)(e.params.requestOptions))throw S("",(0,c.zE)("Request canceled"),e.params);return I(e)}})}));return n.push(e)}(_):I(_),b=await v.finally((()=>m?.remove()));return p?.after?.(b),b}let g;const y=r.Z.request,_="FormData"in globalThis,v=new Set([499,498,403,401]),b=new Set(["COM_0056","COM_0057","SB_0008"]),w=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],x=()=>null,T=Symbol();function C(e){const t=(0,u.P$)(e);return!t||t.endsWith(".arcgis.com")||m._corsServers.includes(t)||(0,u.kl)(t)}function S(e,t,i,r){let n="Error";const o={url:i.url,requestOptions:i.requestOptions,getAllHeaders:x,getHeader:x,ssl:!1};if(t instanceof s.Z)return t.details?(t.details=(0,a.d9)(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=o,t;if(t){const e=r&&(()=>Array.from(r.headers)),i=r&&(e=>r.headers.get(e)),s=r?.status,a=t.message;a&&(n=a),e&&i&&(o.getAllHeaders=e,o.getHeader=i),o.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||s||0,o.subCode=t.subcode,o.messageCode=t.messageCode,"string"==typeof t.details?o.messages=[t.details]:o.messages=t.details,o.raw=T in t?t[T]:t}return(0,c.D_)(t)?(0,c.zE)():new s.Z(e,n,o)}async function E(){n.id||await i.e(58632).then(i.bind(i,58632))}function M(e){return w.some((t=>t.test(e)))}async function A(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions??{},s=(0,u.jc)(t)||(0,u.HK)(t),a=i.responseType||"json",l=s?0:null!=i.timeout?i.timeout:y.timeout;let h=!1;if(!s){e.useSSL&&(t=(0,u.hO)(t));let s={...i.query};e.credentialToken&&(s.token=e.credentialToken);let a=(0,u.B7)(s);(0,o.Z)("esri-url-encodes-apostrophe")&&(a=a.replaceAll("'","%27"));const l=t.length+1+a.length;let c;h="delete"===i.method||"post"===i.method||"put"===i.method||!!i.body||l>y.maxUrlLength;const p=i.useProxy||!!(0,u.ed)(t);if(p){const e=(0,u.b7)(t);c=e.path,!h&&c.length+1+l>y.maxUrlLength&&(h=!0),e.query&&(s={...e.query,...s})}if("HEAD"===r.method&&(h||p)){if(h){if(l>y.maxUrlLength)throw S("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params);throw S("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params)}if(p)throw S("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(h?(r.method="delete"===i.method?"DELETE":"put"===i.method?"PUT":"POST",i.body?t=(0,u.fl)(t,s):(r.body=(0,u.B7)(s),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=(0,u.fl)(t,s),p&&(e.useProxy=!0,t=`${c}?${t}`),s.token&&_&&r.body instanceof FormData&&!(0,d.P5)(t)&&r.body.set("token",s.token),i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!(0,u.D6)(t,(0,u.TI)()))if((0,u.kl)(t))e.withCredentials=!0;else if(n.id){n.id.findServerInfo(t)?.webTierAuth&&(e.withCredentials=!0)}e.withCredentials&&(r.credentials="include",(0,f.jH)(t)&&await(0,f.jz)(h?(0,u.fl)(t,s):t))}let p,g,v=0,b=!1;l>0&&(v=setTimeout((()=>{b=!0,e.controller.abort()}),l));try{if("native-request-init"===i.responseType)g=r,g.url=t,i.signal?g.signal=i.signal:delete g.signal;else if("image"!==i.responseType||"default"!==r.cache||"GET"!==r.method||h||function(e){if(e)for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0;return!1}(i.headers)||!s&&!e.useProxy&&y.proxyUrl&&!C(t)){if(m._beforeFetch&&await m._beforeFetch(t,r),p=await fetch(t,r),m._afterFetch&&await m._afterFetch(p),e.useProxy||function(e){const t=(0,u.P$)(e);t&&!m._corsServers.includes(t)&&m._corsServers.push(t)}(t),"native"===i.responseType)g=p;else if("HEAD"!==r.method)if(p.ok){switch(a){case"array-buffer":g=await p.arrayBuffer();break;case"blob":case"image":g=await p.blob();break;default:g=await p.text()}if(v&&(clearTimeout(v),v=0),"json"===a||"xml"===a||"document"===a)if(g)switch(a){case"json":g=JSON.parse(g);break;case"xml":g=O(g,"application/xml");break;case"document":g=O(g,"text/html")}else g=null;if(g){if("array-buffer"===a||"blob"===a){const e=p.headers.get("Content-Type");if(e&&/application\/json|text\/plain/i.test(e)&&g["blob"===a?"size":"byteLength"]<=750)try{const e=await new Response(g).json();e.error&&(g=e)}catch{}}"image"===a&&g instanceof Blob&&(g=await D(URL.createObjectURL(g),e,!0))}}else{g=await p.text();try{g=JSON.parse(g)}catch{}}}else g=await D(t,e)}catch(r){if("AbortError"===r.name){if(b)throw(0,f.Tf)();throw(0,c.zE)("Request canceled")}if(!(!p&&r instanceof TypeError&&y.proxyUrl)||i.body||"delete"===i.method||"head"===i.method||"post"===i.method||"put"===i.method||e.useProxy||C(t))throw r;e.redoRequest=!0,(0,u.tD)({proxyUrl:y.proxyUrl,urlPrefix:(0,u.P$)(t)??""})}finally{v&&clearTimeout(v)}return[p,g]}async function R(e,t){if(null!=e.responseData)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let i,r;try{r=await e.before(t)}catch(e){i=S("request:interceptor",e,t)}if((r instanceof Error||r instanceof s.Z)&&(i=S("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function O(e,t){let i;try{i=(new DOMParser).parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}m._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],m._beforeFetch=void 0,m._afterFetch=void 0;const P=new Map;async function I(e){let t,i;await async function(e){const t=e.params.url,i=e.params.requestOptions,s=e.controller.signal,o=i.body;let a=null,l=null;if(_&&"HTMLFormElement"in globalThis&&(o instanceof FormData?a=o:o instanceof HTMLFormElement&&(a=new FormData(o))),"string"==typeof o&&(l=o),e.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:"head"===i.method?"HEAD":"GET",mode:"cors",priority:y.priority,redirect:"follow",signal:s},(a||l)&&(e.fetchOptions.body=a||l),"anonymous"===i.authMode&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||i.query?.token||a?.get("token")),!e.hasToken&&(0,p.TF)(t)&&(i.query||(i.query={}),i.query.token=r.Z.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!M(t)&&!(0,c.Hc)(s)){let r;"immediate"===i.authMode?(await E(),r=await n.id.getCredential(t,{signal:s}),e.credential=r):"no-prompt"===i.authMode?(await E(),r=await n.id.getCredential(t,{prompt:!1,signal:s}).catch((()=>{})),e.credential=r):n.id&&(r=n.id.findCredential(t)),r&&(e.credentialToken=r.token,e.useSSL=!!r.ssl)}}(e);try{do{[t,i]=await A(e)}while(!await L(e,t,i))}catch(i){const r=S("request:server",i,e.params,t);throw r.details.ssl=e.useSSL,e.interceptor?.error&&e.interceptor.error(r),r}const s=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(s)){if(!e.hasToken&&!e.credentialToken&&i.user?.username&&!(0,u.kl)(s)){const e=(0,u.P$)(s,!0);e&&y.trustedServers.push(e)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&(0,f.Hu)(i.authorizedCrossOriginNoCorsDomains)}const o=e.credential;if(o&&n.id){let e=n.id.findServerInfo(o.server)?.owningSystemUrl;if(e){e=e.replace(/\/?$/,"/sharing");const t=n.id.findCredential(e,o.userId);t&&-1===n.id._getIdenticalSvcIdx(e,t)&&t.resources.unshift(e)}}return{data:i,getAllHeaders:t?()=>Array.from(t.headers):x,getHeader:t?e=>t.headers.get(e):x,httpStatus:t?.status??200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function L(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||"native"===r.responseType||"native-request-init"===r.responseType)return!0;let s,o;if(i&&(i.error&&"object"==typeof i.error?s=i.error:"error"===i.status&&Array.isArray(i.messages)&&(s={...i},s[T]=i,s.details=i.messages)),!s&&!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[T]=i,s;let a,l=null;s&&(o=Number(s.code),l=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a?.toUpperCase());const c=r.authMode;if(403===o&&(4===l||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&("no-prompt"!==c||498===o)&&void 0!==o&&v.has(o)&&!M(e.params.url)&&(403!==o||(!a||!b.has(a))&&(null==l||2===l&&e.credentialToken))){await E();try{const t=await n.id.getCredential(e.params.url,{error:S("request:server",s,e.params),prompt:"no-prompt"!==c,signal:e.controller.signal,token:e.credentialToken});return e.credential=t,e.credentialToken=t.token,e.useSSL=e.useSSL||t.ssl,!1}catch(t){if("no-prompt"===c)return e.credential=void 0,e.credentialToken=void 0,!1;s=t}}if(s)throw s;return!0}function D(e,t,i=!1){const r=t.controller.signal,n=new Image;return t.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=y.priority,n.src=e,(0,f.fY)(n,e,i,r)}},5167:(e,t,i)=>{i.d(t,{F:()=>n,o:()=>s});var r=i(53736);function n(e){return{geometryType:(0,r.Ji)(e[0]),geometries:e.map((e=>e.toJSON()))}}function s(e,t,i){const n=(0,r.q9)(t);return e.map((e=>{const t=n.fromJSON(e);return t.spatialReference=i,t}))}},27661:(e,t,i)=>{i.d(t,{Z:()=>p});var r,n=i(36663),s=i(30936),o=i(67134),a=i(81977),l=i(7283),c=i(79438),u=i(40266),h=i(85905);let d=r=class extends h.Z{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new r({fromColor:(0,o.d9)(this.fromColor),toColor:(0,o.d9)(this.toColor),algorithm:this.algorithm})}};(0,n._)([(0,c.J)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],d.prototype,"algorithm",void 0),(0,n._)([(0,a.Cb)({type:s.Z,json:{type:[l.z8],write:!0}})],d.prototype,"fromColor",void 0),(0,n._)([(0,a.Cb)({type:s.Z,json:{type:[l.z8],write:!0}})],d.prototype,"toColor",void 0),(0,n._)([(0,a.Cb)({type:["algorithmic"]})],d.prototype,"type",void 0),d=r=(0,n._)([(0,u.j)("esri.rest.support.AlgorithmicColorRamp")],d);const p=d},67692:(e,t,i)=>{i.d(t,{Z:()=>d});var r,n=i(36663),s=i(82064),o=i(67134),a=i(81977),l=i(7283),c=i(40266),u=i(39835);let h=r=class extends s.Z{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.orderByFields=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new r((0,o.d9)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};(0,n._)([(0,a.Cb)({type:[String],json:{write:!0}})],h.prototype,"attachmentTypes",void 0),(0,n._)([(0,a.Cb)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],h.prototype,"attachmentsWhere",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],h.prototype,"cacheHint",void 0),(0,n._)([(0,a.Cb)({type:[String],json:{write:!0}})],h.prototype,"keywords",void 0),(0,n._)([(0,a.Cb)({type:[String],json:{write:!0}})],h.prototype,"globalIds",void 0),(0,n._)([(0,a.Cb)({json:{write:!0}})],h.prototype,"name",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],h.prototype,"num",void 0),(0,n._)([(0,a.Cb)({type:[Number],json:{write:!0}})],h.prototype,"objectIds",void 0),(0,n._)([(0,a.Cb)({type:[String],json:{write:!0}})],h.prototype,"orderByFields",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{default:!1,write:!0}})],h.prototype,"returnMetadata",void 0),(0,n._)([(0,a.Cb)({type:[Number],json:{write:!0}})],h.prototype,"size",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],h.prototype,"start",void 0),(0,n._)([(0,u.c)("start"),(0,u.c)("num")],h.prototype,"writeStart",null),(0,n._)([(0,a.Cb)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],h.prototype,"where",void 0),h=r=(0,n._)([(0,c.j)("esri.rest.support.AttachmentQuery")],h),h.from=(0,l.se)(h);const d=h},85905:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(36663),n=i(82064),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(e){super(e),this.type=null}};(0,r._)([(0,s.Cb)({readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.rest.support.ColorRamp")],a);const l=a},38651:(e,t,i)=>{i.d(t,{Z:()=>h});var r,n=i(36663),s=i(67134),o=i(81977),a=(i(39994),i(13802),i(40266)),l=i(27661),c=i(85905);let u=r=class extends c.Z{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new r({colorRamps:(0,s.d9)(this.colorRamps)})}};(0,n._)([(0,o.Cb)({type:[l.Z],json:{write:!0}})],u.prototype,"colorRamps",void 0),(0,n._)([(0,o.Cb)({type:["multipart"]})],u.prototype,"type",void 0),u=r=(0,n._)([(0,a.j)("esri.rest.support.MultipartColorRamp")],u);const h=u},45634:(e,t,i)=>{i.d(t,{P:()=>c,d:()=>d});var r=i(36663),n=i(25709),s=i(13802),o=i(81977),a=(i(39994),i(4157),i(79438)),l=i(40266);const c=(0,n.w)()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),u="percent-of-total",h="field",d=e=>{let t=class extends e{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=null!=this.normalizationTotal;return t||i?(e=t&&h||i&&u||null,t&&i&&s.Z.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==h&&e!==u||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}};return(0,r._)([(0,o.Cb)({type:String,json:{name:"parameters.normalizationField",write:!0}})],t.prototype,"normalizationField",void 0),(0,r._)([(0,o.Cb)({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],t.prototype,"normalizationMaxValue",void 0),(0,r._)([(0,o.Cb)({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],t.prototype,"normalizationMinValue",void 0),(0,r._)([(0,o.Cb)({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],t.prototype,"normalizationTotal",void 0),(0,r._)([(0,a.J)(c,{name:"parameters.normalizationType"})],t.prototype,"normalizationType",null),t=(0,r._)([(0,l.j)("esri.rest.support.NormalizationBinParametersMixin")],t),t}},56836:(e,t,i)=>{i.d(t,{Z:()=>p});var r,n=i(36663),s=i(25709),o=i(82064),a=i(67134),l=i(81977),c=(i(39994),i(13802),i(40266)),u=i(91772);const h=new s.X({upperLeft:"upper-left",lowerLeft:"lower-left"});let d=r=class extends o.Z{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new r((0,a.d9)({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};(0,n._)([(0,l.Cb)({type:u.Z,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],d.prototype,"extent",void 0),(0,n._)([(0,l.Cb)({type:["view","edit"],json:{write:!0}})],d.prototype,"mode",void 0),(0,n._)([(0,l.Cb)({type:String,json:{read:h.read,write:h.write}})],d.prototype,"originPosition",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],d.prototype,"tolerance",void 0),d=r=(0,n._)([(0,c.j)("esri.rest.support.QuantizationParameters")],d);const p=d},14626:(e,t,i)=>{i.d(t,{Z:()=>A});var r=i(36663),n=i(25709),s=i(82064),o=i(67134),a=i(81977),l=i(69236),c=i(79438),u=i(40266),h=i(39835),d=i(7283),p=i(10186),f=i(14685),m=i(53736),g=i(59659),y=i(10743),_=i(41151);i(39994),i(13802),i(4157);let v=class extends(_.Z.ClonableMixin(s.Z)){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};(0,r._)([(0,a.Cb)({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.onFields&&this.onFields.length>0}}}}})],v.prototype,"onFields",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],v.prototype,"operator",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],v.prototype,"searchTerm",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],v.prototype,"searchType",void 0),v=(0,r._)([(0,u.j)("esri.rest.support.FullTextSearch")],v);const b=v;var w,x=i(56836),T=i(63581),C=i(53631),S=i(49684);const E=new n.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let M=w=class extends s.Z{static from(e){return(0,d.TJ)(w,e)}constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.returnTrueCurves=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(e){return"number"==typeof e||"object"==typeof e?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const t in e){const r=e[t];Array.isArray(r)?i[t]=r.map((e=>e instanceof Date?e.getTime():e)):r instanceof Date?i[t]=r.getTime():i[t]=r}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new w((0,o.d9)({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:null!=this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,returnTrueCurves:this.returnTrueCurves,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};M.MAX_MAX_RECORD_COUNT_FACTOR=5,(0,r._)([(0,a.Cb)({json:{write:!0}})],M.prototype,"aggregateIds",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],M.prototype,"cacheHint",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"compactGeometryEnabled",void 0),(0,r._)([(0,a.Cb)({json:{write:!0}})],M.prototype,"datumTransformation",void 0),(0,r._)([(0,l.p)("datumTransformation")],M.prototype,"castDatumTransformation",null),(0,r._)([(0,a.Cb)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"defaultSpatialReferenceEnabled",void 0),(0,r._)([(0,a.Cb)({type:Number,json:{write:!0}})],M.prototype,"distance",void 0),(0,r._)([(0,a.Cb)({type:y.n,json:{write:!0}})],M.prototype,"dynamicDataSource",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],M.prototype,"formatOf3DObjects",void 0),(0,r._)([(0,a.Cb)({type:[b],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.fullText&&this.fullText.length>0}}}}})],M.prototype,"fullText",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],M.prototype,"gdbVersion",void 0),(0,r._)([(0,a.Cb)({types:g.qM,json:{read:m.im,write:!0}})],M.prototype,"geometry",void 0),(0,r._)([(0,a.Cb)({type:Number,json:{write:!0}})],M.prototype,"geometryPrecision",void 0),(0,r._)([(0,a.Cb)({type:[String],json:{write:!0}})],M.prototype,"groupByFieldsForStatistics",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],M.prototype,"having",void 0),(0,r._)([(0,a.Cb)({type:Date})],M.prototype,"historicMoment",void 0),(0,r._)([(0,h.c)("historicMoment")],M.prototype,"writeHistoricMoment",null),(0,r._)([(0,a.Cb)({type:Number,json:{write:!0}})],M.prototype,"maxAllowableOffset",void 0),(0,r._)([(0,a.Cb)({type:Number,cast:e=>e<1?1:e>M.MAX_MAX_RECORD_COUNT_FACTOR?M.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],M.prototype,"maxRecordCountFactor",void 0),(0,r._)([(0,a.Cb)({type:["xyFootprint"],json:{write:!0}})],M.prototype,"multipatchOption",void 0),(0,r._)([(0,a.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],M.prototype,"num",void 0),(0,r._)([(0,a.Cb)({json:{write:!0}})],M.prototype,"objectIds",void 0),(0,r._)([(0,a.Cb)({type:[String],json:{write:!0}})],M.prototype,"orderByFields",void 0),(0,r._)([(0,a.Cb)({type:[String],json:{write:!0}})],M.prototype,"outFields",void 0),(0,r._)([(0,a.Cb)({type:f.Z,json:{name:"outSR",write:!0}})],M.prototype,"outSpatialReference",void 0),(0,r._)([(0,a.Cb)({type:[C.Z],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.outStatistics&&this.outStatistics.length>0}}}}})],M.prototype,"outStatistics",void 0),(0,r._)([(0,a.Cb)({json:{write:!0}})],M.prototype,"parameterValues",void 0),(0,r._)([(0,h.c)("parameterValues")],M.prototype,"writeParameterValues",null),(0,r._)([(0,a.Cb)({type:p.Z,json:{write:!0}})],M.prototype,"pixelSize",void 0),(0,r._)([(0,a.Cb)({type:x.Z,json:{write:!0}})],M.prototype,"quantizationParameters",void 0),(0,r._)([(0,a.Cb)({type:[Object],json:{write:!0}})],M.prototype,"rangeValues",void 0),(0,r._)([(0,a.Cb)({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],M.prototype,"relationParameter",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],M.prototype,"resultType",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"returnCentroid",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"returnDistinctValues",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{default:!0,write:!0}})],M.prototype,"returnExceededLimitFeatures",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],M.prototype,"returnGeometry",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"returnQueryGeometry",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"returnM",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],M.prototype,"returnZ",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],M.prototype,"returnTrueCurves",void 0),(0,r._)([(0,a.Cb)({type:f.Z,json:{write:!0}})],M.prototype,"sourceSpatialReference",void 0),(0,r._)([(0,c.J)(T.A,{ignoreUnknown:!1,name:"spatialRel"})],M.prototype,"spatialRelationship",void 0),(0,r._)([(0,a.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],M.prototype,"start",void 0),(0,r._)([(0,h.c)("start"),(0,h.c)("num")],M.prototype,"writeStart",null),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],M.prototype,"sqlFormat",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],M.prototype,"text",void 0),(0,r._)([(0,a.Cb)({type:S.Z,json:{write:!0}})],M.prototype,"timeExtent",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"timeReferenceUnknownClient",void 0),(0,r._)([(0,c.J)(E,{ignoreUnknown:!1}),(0,a.Cb)({json:{write:{overridePolicy(e){return{enabled:!!e&&null!=this.distance}}}}})],M.prototype,"units",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:{overridePolicy(e){return{enabled:null!=e||null!=this.start&&this.start>0}}}}})],M.prototype,"where",void 0),(0,r._)([(0,h.c)("where")],M.prototype,"writeWhere",null),M=w=(0,r._)([(0,u.j)("esri.rest.support.Query")],M);const A=M},8284:(e,t,i)=>{i.r(t),i.d(t,{default:()=>f});var r,n=i(36663),s=i(82064),o=i(67134),a=i(81977),l=i(7283),c=i(40266),u=i(39835),h=i(14685),d=i(10743);let p=r=class extends s.Z{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&null==this.where&&(t.definitionExpression="1=1")}clone(){return new r((0,o.d9)({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};(0,n._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],p.prototype,"cacheHint",void 0),(0,n._)([(0,a.Cb)({type:d.n,json:{write:!0}})],p.prototype,"dynamicDataSource",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],p.prototype,"gdbVersion",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{write:!0}})],p.prototype,"geometryPrecision",void 0),(0,n._)([(0,a.Cb)({type:Date})],p.prototype,"historicMoment",void 0),(0,n._)([(0,u.c)("historicMoment")],p.prototype,"_writeHistoricMoment",null),(0,n._)([(0,a.Cb)({type:Number,json:{write:!0}})],p.prototype,"maxAllowableOffset",void 0),(0,n._)([(0,a.Cb)({json:{write:!0}})],p.prototype,"objectIds",void 0),(0,n._)([(0,a.Cb)({type:[String],json:{write:!0}})],p.prototype,"orderByFields",void 0),(0,n._)([(0,a.Cb)({type:[String],json:{write:!0}})],p.prototype,"outFields",void 0),(0,n._)([(0,a.Cb)({type:h.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],p.prototype,"outSpatialReference",void 0),(0,n._)([(0,a.Cb)({json:{write:!0}})],p.prototype,"relationshipId",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],p.prototype,"start",void 0),(0,n._)([(0,u.c)("start"),(0,u.c)("num")],p.prototype,"writeStart",null),(0,n._)([(0,a.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],p.prototype,"num",void 0),(0,n._)([(0,a.Cb)({json:{write:!0}})],p.prototype,"returnGeometry",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],p.prototype,"returnM",void 0),(0,n._)([(0,a.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],p.prototype,"returnZ",void 0),(0,n._)([(0,a.Cb)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],p.prototype,"where",void 0),p=r=(0,n._)([(0,c.j)("esri.rest.support.RelationshipQuery")],p),p.from=(0,l.se)(p);const f=p},53631:(e,t,i)=>{i.d(t,{Z:()=>p});var r,n=i(36663),s=i(25709),o=i(82064),a=i(67134),l=i(81977),c=(i(39994),i(13802),i(40266)),u=i(39835);const h=new s.X({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let d=r=class extends o.Z{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(t.statisticParameters=(0,a.d9)(e))}clone(){return new r({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:(0,a.d9)(this.statisticParameters)})}};(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],d.prototype,"maxPointCount",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],d.prototype,"maxRecordCount",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],d.prototype,"maxVertexCount",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],d.prototype,"onStatisticField",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],d.prototype,"outStatisticFieldName",void 0),(0,n._)([(0,l.Cb)({type:String,json:{read:{source:"statisticType",reader:h.read},write:{target:"statisticType",writer:h.write}}})],d.prototype,"statisticType",void 0),(0,n._)([(0,l.Cb)({type:Object})],d.prototype,"statisticParameters",void 0),(0,n._)([(0,u.c)("statisticParameters")],d.prototype,"writeStatisticParameters",null),d=r=(0,n._)([(0,c.j)("esri.rest.support.StatisticDefinition")],d);const p=d},81657:(e,t,i)=>{i.d(t,{V:()=>o,i:()=>a});var r=i(27661),n=i(85905),s=i(38651);const o={key:"type",base:n.Z,typeMap:{algorithmic:r.Z,multipart:s.Z}};function a(e){return e?.type?"algorithmic"===e.type?r.Z.fromJSON(e):"multipart"===e.type?s.Z.fromJSON(e):null:null}},63581:(e,t,i)=>{i.d(t,{A:()=>r});const r=new(i(25709).X)({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"})},84238:(e,t,i)=>{i.d(t,{cv:()=>a,en:()=>o,lA:()=>s});i(51366),i(88256);var r=i(67134),n=i(3466);i(99522);function s(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function o(e){return"string"==typeof e?(0,n.mN)(e):(0,r.d9)(e)}function a(e,t,i){const r={};for(const n in e){if("declaredClass"===n)continue;const s=e[n];if(null!=s&&"function"!=typeof s)if(Array.isArray(s))r[n]=s.map((e=>a(e)));else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(i?.[n]);r[n]=t?e:JSON.stringify(e)}else r[n]=t?s:JSON.stringify(s);else r[n]=s}return r}},94449:(e,t,i)=>{i.d(t,{J:()=>c});var r=i(36663),n=i(80085),s=(i(13802),i(7283)),o=(i(39994),i(4157),i(70375),i(2107)),a=i(40266),l=i(4637);let c=class extends l.a{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};(0,r._)([(0,o.c)({Type:n.Z,ensureType:(0,s.se)(n.Z)})],c.prototype,"itemType",void 0),c=(0,r._)([(0,a.j)("esri.support.GraphicsCollection")],c)},9008:(e,t,i)=>{i.d(t,{K:()=>d});var r=i(36663),n=i(41831),s=i(58811),o=i(13802),a=i(78668),l=i(81977),c=(i(39994),i(4157),i(40266)),u=i(38481);function h(e,t,i){let r,n;if(e)for(let s=0,o=e.length;s<o;s++){if(r=e.at(s),r?.[t]===i)return r;if("group"===r?.type&&(n=h(r.layers,t,i),n))return n}}const d=e=>{let t=class extends e{constructor(...e){super(...e),this.layers=new n.Z;const t=e=>{e.parent=this,this.layerAdded(e),"elevation"!==e.type&&"base-elevation"!==e.type||o.Z.getLogger(this).error(`Layer 'title:${e.title}, id:${e.id}' of type '${e.type}' is not supported as an operational layer and will therefore be ignored.`)},i=e=>{e.parent=null,this.layerRemoved(e)};this.addHandles([this.layers.on("before-add",(e=>{if(e.item===this)return e.preventDefault(),void o.Z.getLogger(this).error("#add()","Cannot add layer to itself.");(e=>{e.parent&&"remove"in e.parent&&e.parent.remove(e)})(e.item)})),this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>i(e.item)))])}destroy(){const e=this.layers.toArray();for(const t of e)t.destroy();this.layers.destroy()}set layers(e){this._set("layers",(0,s.Z)(e,this._get("layers")))}add(e,t){const i=this.layers;if(t=i.getNextIndex(t),e instanceof u.Z){const r=e;r.parent===this?this.reorder(r,t):i.add(r,t)}else(0,a.y8)(e)?e.then((e=>{this.destroyed||this.add(e,t)})):o.Z.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const i=this.layers;let r=i.getNextIndex(t);e.slice().forEach((e=>{e.parent!==this?(i.add(e,r),r+=1):this.reorder(e,r)}))}findLayerById(e){return h(this.layers,"id",e)}findLayerByUid(e){return h(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return(0,r._)([(0,l.Cb)()],t.prototype,"layers",null),t=(0,r._)([(0,c.j)("esri.support.LayersMixin")],t),t}},98234:(e,t,i)=>{i.d(t,{Q:()=>h});var r=i(36663),n=i(41831),s=i(58811),o=i(13802),a=i(81977),l=(i(39994),i(4157),i(40266));const c=new Set(["feature","subtype-group"]);function u(e,t,i){if(e)for(let r=0,n=e.length;r<n;r++){const n=e.at(r);if(n[t]===i)return n;if("group"===n?.type){const e=u(n.tables,t,i);if(e)return e}}}const h=e=>{let t=class extends e{constructor(...e){super(...e),this.tables=new n.Z,this.addHandles([this.tables.on("after-add",(e=>{const t=e.item;t.parent&&t.parent!==this&&"tables"in t.parent&&t.parent.tables.remove(t),t.parent=this,c.has(t.type)||o.Z.getLogger(this).error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as a table and will therefore be ignored.`)})),this.tables.on("after-remove",(e=>{e.item.parent=null}))])}destroy(){const e=this.tables.toArray();for(const t of e)t.destroy();this.tables.destroy()}set tables(e){this._set("tables",(0,s.Z)(e,this._get("tables")))}findTableById(e){return u(this.tables,"id",e)}findTableByUid(e){return u(this.tables,"uid",e)}};return(0,r._)([(0,a.Cb)()],t.prototype,"tables",null),t=(0,r._)([(0,l.j)("esri.support.TablesMixin")],t),t}},83258:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(74396),o=i(86618),a=i(81977),l=(i(39994),i(13802),i(4157),i(40266));let c=r=class extends(o.Z.IdentifiableMixin(s.Z)){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new r({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};(0,n._)([(0,a.Cb)()],c.prototype,"active",void 0),(0,n._)([(0,a.Cb)()],c.prototype,"className",void 0),(0,n._)([(0,a.Cb)()],c.prototype,"disabled",void 0),(0,n._)([(0,a.Cb)()],c.prototype,"icon",void 0),(0,n._)([(0,a.Cb)()],c.prototype,"id",void 0),(0,n._)([(0,a.Cb)()],c.prototype,"indicator",void 0),(0,n._)([(0,a.Cb)()],c.prototype,"title",void 0),(0,n._)([(0,a.Cb)()],c.prototype,"type",void 0),(0,n._)([(0,a.Cb)()],c.prototype,"visible",void 0),c=r=(0,n._)([(0,l.j)("esri.support.actions.ActionBase")],c);const u=c},97837:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(83258);let l=r=class extends a.Z{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new r({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};(0,n._)([(0,s.Cb)()],l.prototype,"image",void 0),l=r=(0,n._)([(0,o.j)("esri.support.actions.ActionButton")],l);const c=l},15600:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(83258);let l=r=class extends a.Z{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new r({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};(0,n._)([(0,s.Cb)()],l.prototype,"image",void 0),(0,n._)([(0,s.Cb)()],l.prototype,"value",void 0),l=r=(0,n._)([(0,o.j)("esri.support.actions.ActionToggle")],l);const c=l},99522:(e,t,i)=>{i.d(t,{TF:()=>a});var r=i(51366),n=i(3466);const s=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function o(e){const t=(0,n.P$)(e,!0);return!!t&&t.endsWith(".arcgis.com")&&!s.has(t)&&!e.endsWith("/sharing/rest/generateToken")}function a(e,t){return!(!t&&!r.Z.apiKey||!o(e))}},77631:(e,t,i)=>{function r(e){if(!e)return;const t=e.match(n);return t?.groups?t.groups.doubleQuoted??t.groups.singleQuoted??t.groups.dotNotation:void 0}i.d(t,{b:()=>r,v:()=>s});const n=/^(\$feature\[(?:"(?<doubleQuoted>[^"]+)"|'(?<singleQuoted>[^']+)')\]|\$feature\.(?<dotNotation>[a-zA-Z_][a-zA-Z0-9_]*))$/i;function s(e){return e.match(o)?.[1]?.replace(/\\'/g,"'")??null}const o=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/},30879:(e,t,i)=>{i.d(t,{C7:()=>l,LC:()=>u,WW:()=>h,Yi:()=>d,pp:()=>p});var r=i(78053),n=i(70375),s=i(13802),o=i(14685);const a=["geometry","scale","timeProperties"];function l(e,t){if(null!=t)for(const i of a)t.hasArcadeDependency(i)&&e.add(i);return e}let c;function u(){return c||(c=(async()=>{const e=await Promise.all([i.e(85491),i.e(78050),i.e(12317)]).then(i.bind(i,35));return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature,Voxel:e.Voxel}})()),c}const h=(e,t,i)=>f.create(e,t,i,null,["$feature","$view"],[]),d=(e,t,i)=>f.create(e,t,i,null,["$feature","$view"],[]),p=(e,t,i,r)=>f.create(e,t,i,r,["$feature","$view"],[]);class f{constructor(e,t,i,r,n,s,o){this._dependencies=new Map,this.services=null,this.script=e,this.evaluate=r;const a=Array.isArray(s)?s:s?.fields;this.fields=a??[],this._syntaxTree=i,this._arcade=t,this._arcadeFeature=n,this._spatialReference=o,this._dependencies.set("geometry",t.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set("scale",this._arcade.referencesMember(this._syntaxTree,"scale")),this._dependencies.set("timeProperties",this._arcade.scriptUsesViewProperties(this._syntaxTree,["timeProperties"]))}static async create(e,t,i,a,l,c){const{arcade:h,Feature:d,Dictionary:p}=await u(),m=t instanceof o.Z?t:o.Z.fromJSON(t);let g;try{g=h.parseScript(e,c)}catch(t){return s.Z.getLogger("esri.support.arcadeOnDemand").error(new n.Z("arcade-bad-expression","Failed to parse arcade script",{script:e,error:t})),null}const y=l.reduce(((e,t)=>({...e,[t]:null})),{});let _=null;null!=a&&(_=new p(a),_.immutable=!0,y.$config=null);const v=h.scriptUsesGeometryEngine(g),b=v&&h.enableGeometrySupport(),w=h.scriptUsesFeatureSet(g)&&h.enableFeatureSetSupport(),x=h.scriptIsAsync(g),T=x&&h.enableAsyncSupport(),C={vars:y,spatialReference:m,useAsync:!!T};await Promise.all([b,w,T]);const S=new Set;await h.loadDependentModules(S,g,null,x,v);const E=new p;E.immutable=!1,E.setField("scale",0);const M=h.compileScript(g,C);return new f(e,h,g,((e,t)=>{const i=e.$view?.timeZone;if("$view"in e&&e.$view){let t;if(E.setField("scale","object"==typeof e.$view&&"scale"in e.$view?e.$view.scale:void 0),"object"==typeof e.$view&&"timeProperties"in e.$view&&null!=e.$view.timeProperties){const{currentStart:n,currentEnd:s}=e.$view.timeProperties;t=new p({currentStart:null!=n?null!=i?r.iG.epochToArcadeDate(n,i):r.iG.unknownEpochToArcadeDate(n):void 0,currentEnd:null!=s?null!=i?r.iG.epochToArcadeDate(s,i):r.iG.unknownEpochToArcadeDate(s):void 0,startIncluded:!0,endIncluded:!0})}E.setField("timeProperties",t),e.$view=E}return _&&(e.$config=_),M({vars:e,spatialReference:m,services:t,timeZone:i})}),new d,i,m)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}references(e){return this._dependencies.get(e)??!1}}},53729:(e,t,i)=>{function r(e){const t=atob(e),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return i.buffer}function n(e){const t=new Uint8Array(e);let i="";for(let e=0;e<t.length;e++)i+=String.fromCharCode(t[e]);return btoa(i)}i.d(t,{R:()=>r,s:()=>n})},2725:(e,t,i)=>{i.d(t,{g:()=>s,s:()=>o});var r=i(36567),n=i(60720);async function s(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,i=await(0,n.ME)("esri/t9n/basemaps");return i[e]||i[t]}const o={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return(0,r.V)("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]}}},64573:(e,t,i)=>{i.d(t,{Bj:()=>d,Qs:()=>C,Us:()=>p,iG:()=>l,ql:()=>u,vZ:()=>c});var r=i(41831),n=i(61681),s=i(3466),o=i(60278),a=i(2725);function l(e){return"Web Scene"===e.portalItem?.type||e.referenceLayers.some((e=>"scene"===e.type))}function c(e){return!!e?.portalItem?.tags?.some((e=>"beta"===e.toLowerCase()))}function u(e,t){return!(!e.basemap?.referenceLayers?.some((e=>e.uid===t))&&!e.basemap?.baseLayers?.some((e=>e.uid===t)))}let h;function d(e,t){return e===t||(null!=e?.portalItem?.id&&e.portalItem.id===t?.portalItem?.id||"equal"===b(f(e),f(t),{mustMatchReferences:!0}))}function p(e,t){if(null==t||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===t.loadStatus)return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(0===t.baseLayers.length)return{spatialReference:null,updating:!1};const i=t.baseLayers.at(0);switch(i.loadStatus){case"not-loaded":i.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in i?i.supportedSpatialReferences:null)||["tileInfo"in i?i.tileInfo?.spatialReference:i.spatialReference]).filter(Boolean),n=e.spatialReference;return n?{spatialReference:r.find((e=>n.equals(e)))??r[0]??null,updating:!1}:{spatialReference:r[0],updating:!1}}function f(e){return e?!e.loaded&&e.resourceInfo?_(e.resourceInfo.data):{baseLayers:m(e.baseLayers),referenceLayers:m(e.referenceLayers)}:null}function m(e){return(r.Z.isCollection(e)?e.toArray():e).map(g)}function g(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:T("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||null==e.sublayers?void 0:e.sublayers?.map((e=>({id:e.id,visible:e.visible}))),activeLayerId:"wmts"===e.type?e.activeLayer?.id:void 0}}function y(e){return e.isReference||"ArcGISSceneServiceLayer"===e.layerType}function _(e){return e?{baseLayers:v((e.baseMapLayers??[]).filter((e=>!y(e)))),referenceLayers:v((e.baseMapLayers??[]).filter((e=>y(e))))}:null}function v(e){return e.map((e=>function(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:T(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}(e)))}function b(e,t,i){return null!=e!=(null!=t)?"not-equal":e&&t?w(e.baseLayers,t.baseLayers)?w(e.referenceLayers,t.referenceLayers)?"equal":i.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function w(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!x(e[i],t[i]))return!1;return!0}function x(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(!(0,o.yQ)(e.effect,t.effect))return!1;if(null!=e.activeLayerId||null!=t.activeLayerId)return e.activeLayerId===t.activeLayerId;if(null!=e.sublayers||null!=t.sublayers){if(null==e.sublayers||null==t.sublayers||e.sublayers.length!==t.sublayers.length)return!1;for(let i=0;i<e.sublayers.length;i++){const r=e.sublayers.at(i),n=t.sublayers.at(i);if(r?.id!==n?.id||r?.visible!==n?.visible)return!1}}return!0}function T(e){return e?(0,s.Fv)(e).replace(/^\s*https?:/i,"").toLowerCase():""}function C(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const i=function(e){if(h)return h(e);let t=null;const i=f(e),r=!i?.baseLayers.length;for(const e in a.s){const n=b(i,_(a.s[e]),{mustMatchReferences:r});if("equal"===n){t=e;break}"base-layers-equal"===n&&(t=e)}return t}(e);return i?a.s[i].thumbnailUrl:(0,n.ei)(e.baseLayers,S)}function S(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}},42228:(e,t,i)=>{i.d(t,{O:()=>s,a:()=>n});var r=i(81739);function n(e){return new r.Z({getCollections:()=>[e.tables,e.layers],getChildrenFunction:e=>{const t=[];return"tables"in e&&t.push(e.tables),"layers"in e&&t.push(e.layers),t},itemFilterFunction:e=>{const t=e.parent;return!!t&&"tables"in t&&t.tables.includes(e)}})}function s(e){for(const t of e.values())t?.destroy();e.clear()}},52300:(e,t,i)=>{i.d(t,{A9:()=>u,US:()=>d,bk:()=>h});var r=i(61681),n=i(32646),s=i(17126);const o="HH:mm",a="HH:mm:ss",l="HH:mm:ss.SSS",c=[l,a,o,"TT"];function u(e){if(!e||!(0,n.HD)(e))return null;const t=s.ou.fromFormat(e,"yyyy-MM-dd");return t.isValid?t:null}function h(e){return e&&(0,n.HD)(e)?(0,r.ei)(c,(t=>{const i=s.ou.fromFormat(e,t);return i.isValid?i:null}))??null:null}function d(e){if(!e||!(0,n.HD)(e))return null;const t=s.ou.fromISO(e);return t.isValid?t:null}},83772:(e,t,i)=>{i.d(t,{AA:()=>f,Jn:()=>c,LR:()=>M,Lt:()=>d,O3:()=>w,Ou:()=>_,RL:()=>h,Uy:()=>C,VW:()=>l,W_:()=>T,Wb:()=>S,XH:()=>m,Zz:()=>o,ap:()=>y,fl:()=>p,fm:()=>A,jG:()=>R,kf:()=>E,mF:()=>a,tR:()=>O,tq:()=>x,vQ:()=>v,vu:()=>u,zx:()=>b});var r=i(17321),n=i(91478);function s(e){return e?R:O}function o(e,t){return t?.mode?t.mode:s(e).mode}function a(e,t){return null!=t?t:s(e)}function l(e,t){return o(null==e||(e.hasZ??!1),t)}function c(e,t){return a(null==e||(e.hasZ??!1),t)}function u(e){const t=g(e);return l(e.geometry,t)}function h(e){const t=g(e),i=l(e.geometry,t),r=null!=t&&"on-the-ground"!==i?A(t):0,n=t?.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:n}}function d(e){return m(h(e))}function p(e){return m(e)||f(e)}function f(e){return"0"===e?.featureExpressionInfo?.expression}function m(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function g(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function y(e,t){if(!e?.offset)return 0;const{offset:i,unit:n}=e;if("decimal-degrees"===n)return 0;const s="unknown"!==n&&n?n:"meters",o=(0,r.y)(t);return o?(0,r.En)(i,s,o):0}function _(e,t,i){if(!i?.mode)return;const r=e.hasZ?e.z:0,n=y(i,e.spatialReference);switch(i.mode){case"absolute-height":return r-n;case"on-the-ground":return 0;case"relative-to-ground":return r-((t.elevationProvider.getElevation(e.x,e.y,r,e.spatialReference,"ground")??0)+n);case"relative-to-scene":return r-((t.elevationProvider.getElevation(e.x,e.y,r,e.spatialReference,"scene")??0)+n)}}function v(e,t,i,r=null){return w(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,i,r)}function b(e,t,i,r,n=null){return w(e,t[0],t[1],t.length>2?t[2]:0,i,r,n)}function w(e,t,i,r,n,s,o=null){if(null==s)return;const a=null!=o?o.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=x(t,i,r,n,e,s);return function(e,t,i,r,n,s,o,a){const l=y(o,n);switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-((s.elevationProvider.getElevation(t,i,r,n,"ground")??0)+l);case"relative-to-scene":return e-((s.elevationProvider.getElevation(t,i,r,n,"scene")??0)+l)}}(l,t,i,r,n,e,o,a)}function x(e,t,i,r,n,s){const o=y(s,r);switch(s.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const i=n.elevationProvider.getElevation(e,t,0,r,"ground")??0;return{absoluteZ:i,elevation:i}}case"relative-to-ground":{const s=n.elevationProvider.getElevation(e,t,i,r,"ground")??0;return{absoluteZ:i+s+o,elevation:s}}case"relative-to-scene":{const s=n.elevationProvider.getElevation(e,t,i,r,"scene")??0;return{absoluteZ:i+s+o,elevation:s}}}}function T(e,t){if(null==t)return!1;const{mode:i}=t;return null!=i&&("scene"===e&&"relative-to-scene"===i||"ground"===e&&"absolute-height"!==i)}function C(e,t,i){return i&&i.mode!==t?`${e} only support ${t} elevation mode`:null}function S(e,t,i){return i?.mode===t?`${e} do not support ${t} elevation mode`:null}function E(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function M(e,t){t&&e.warn(".elevationInfo=",t)}function A(e){return(e?.offset??0)*(0,n.Z7)(e?.unit)}const R={mode:"absolute-height",offset:0},O={mode:"on-the-ground",offset:null}},18327:(e,t,i)=>{i.d(t,{R:()=>s});var r=i(17321),n=i(93968);function s(e){const t="metric";if(null==e)return t;const i=e.map,s=(i&&"portalItem"in i?i.portalItem?.portal:null)??n.Z.getDefault();switch(s.user?.units??s.units){case t:return t;case"english":return"imperial"}return(0,r.yT)(e.spatialReference)??t}},32646:(e,t,i)=>{function r(e){return"number"==typeof e}function n(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function s(e){return"boolean"==typeof e}function o(e){return"string"==typeof e||e instanceof String}function a(e){return null==e||o(e)}function l(e){return Array.isArray(e)}function c(e){return"esri.Graphic"===e?.declaredClass}function u(e){return"esri.rest.support.Query"===e?.declaredClass}function h(e){return e instanceof Date}i.d(t,{HD:()=>o,J_:()=>h,Kf:()=>c,U:()=>n,Xh:()=>u,hj:()=>r,jn:()=>s,kJ:()=>l,tM:()=>a})},10171:(e,t,i)=>{i.d(t,{Nr:()=>u,eZ:()=>c});var r=i(80020),n=i(14845),s=i(24834),o=(i(17814),i(15902),i(32776),i(29893)),a=(i(21363),i(83373),i(58106),i(82699),i(78213)),l=i(20878);function c({displayField:e,editFieldsInfo:t,fields:i,objectIdField:a,title:l},c){if(!i)return null;const u=p({editFieldsInfo:t,fields:i,objectIdField:a},c);if(!u.length)return null;const h=function(e){const t=(0,n.O5)(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i??""}({titleBase:l,fields:i,displayField:e}),d=[new o.Z,new s.Z];return new r.Z({title:h,content:d,fieldInfos:u})}function u(e){const{title:t,graphic:i}=e??{},{attributes:r,sourceLayer:n}=i??{},s=n&&"displayField"in n?n.displayField:null,o=s?r?.[s]:null,a=null!=o?JSON.stringify(o):null,l=i?.getObjectId()?.toString();return t||a||l||""}const h=(e,t)=>t.visibleFieldNames?t.visibleFieldNames.has(e.name):(0,n.Fv)(e,t);function d(e,t){return"oid"===e.type?-1:"oid"===t.type?1:m(e)?-1:m(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function p(e,t){const i=t?.visibleFieldNames;return function({fields:e,ignoreFieldTypes:t,sortDisabled:i}){const r=e;return t&&(e=e.filter((e=>!t.includes(e.type)))),e===r&&(e=e.slice()),!0!==i&&e.sort(d),e}({fields:e.fields??[],ignoreFieldTypes:t?.ignoreFieldTypes||g,sortDisabled:t?.sortDisabled}).map((t=>new a.Z({fieldName:t.name,isEditable:(0,n.Hp)(t,e),label:t.alias,format:f(t),visible:h(t,{...e,visibleFieldNames:i})})))}function f(e){switch(e.type){case"small-integer":case"integer":case"single":return new l.Z({digitSeparator:!0,places:0});case"double":return new l.Z({digitSeparator:!0,places:2});case"string":return(0,n.Ec)(e.name)?new l.Z({digitSeparator:!0,places:0}):void 0;default:return}}function m(e){if("name"===(e.name&&e.name.toLowerCase()))return!0;const t=e.alias?.toLowerCase();return"name"===t}const g=["geometry","blob","raster","guid","xml"]},44883:(e,t,i)=>{i.d(t,{t:()=>n});var r=i(66341);async function n(e,t){const{data:i}=await(0,r.Z)(e,{responseType:"image",...t});return i}},73401:(e,t,i)=>{i.d(t,{Hu:()=>d,Tf:()=>u,fY:()=>a,jH:()=>p,jz:()=>f,q4:()=>h});var r=i(51366),n=i(39994),s=i(78668),o=i(3466);function a(e,t,i=!1,r){return new Promise(((o,a)=>{if((0,s.Hc)(r))return void a(l());let c=()=>{d(),a(new Error(`Unable to load ${t}`))},u=()=>{const t=e;d(),o(t)},h=()=>{if(!e)return;const t=e;d(),t.src="",a(l())};const d=()=>{(0,n.Z)("esri-image-decode")||(e.removeEventListener("error",c),e.removeEventListener("load",u)),c=null,u=null,e=null,null!=r&&r.removeEventListener("abort",h),h=null,i&&URL.revokeObjectURL(t)};null!=r&&r.addEventListener("abort",h),(0,n.Z)("esri-image-decode")?e.decode().then(u,c):(e.addEventListener("error",c),e.addEventListener("load",u))}))}function l(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}const c="Timeout exceeded";function u(){return new Error(c)}function h(e){return"object"==typeof e&&!!e&&"message"in e&&e.message===c}function d(e){r.Z.request.crossOriginNoCorsDomains||(r.Z.request.crossOriginNoCorsDomains={});const t=r.Z.request.crossOriginNoCorsDomains;for(let i of e)i=i.toLowerCase(),/^https?:\/\//.test(i)?t[(0,o.P$)(i)??""]=0:(t[(0,o.P$)("http://"+i)??""]=0,t[(0,o.P$)("https://"+i)??""]=0)}function p(e){const t=r.Z.request.crossOriginNoCorsDomains;if(t){let i=(0,o.P$)(e);if(i)return i=i.toLowerCase(),!(0,o.D6)(i,(0,o.TI)())&&t[i]<Date.now()-36e5}return!1}async function f(e){const t=(0,o.mN)(e);e=t.path,"json"===t.query?.f&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}const i=r.Z.request.crossOriginNoCorsDomains,n=(0,o.P$)(e);i&&n&&(i[n.toLowerCase()]=Date.now())}},9870:(e,t,i)=>{i.d(t,{$:()=>n,r:()=>r});const r="20250407",n="04d2b42da93678ca718b23aaf7e216985f10fa8e"},3368:(e,t,i)=>{i.d(t,{$o:()=>n,V$:()=>o,rk:()=>s});const r="calcite-mode-";function n(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"").startsWith("dark")}function s(){return`${r}${n()?"dark":"light"}`}function o(e){a(e),e.classList.add(s())}function a(e){Array.from(e.classList).forEach((t=>{t.startsWith(r)&&e.classList.remove(t)}))}},62589:(e,t,i)=>{i.d(t,{Z:()=>m});var r,n=i(36663),s=i(67134),o=i(21130),a=i(81977),l=(i(39994),i(13802),i(79438)),c=i(34248),u=i(40266),h=i(39835),d=i(14845),p=i(18251);let f=r=class extends p.Z{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){Object.assign(t,e)}async collectRequiredFields(e,t){if("CIMSymbolReference"===this.data?.type){const i=this.data.primitiveOverrides;if(i){const r=i.map((i=>{const r=i.valueExpressionInfo;return r?(0,d.io)(e,t,r.expression):null}));await Promise.all(r)}}}clone(){return new r({data:(0,s.d9)(this.data)})}hash(){return(0,o.hP)(JSON.stringify(this.data)).toString()}};(0,n._)([(0,a.Cb)({json:{write:!1}})],f.prototype,"color",void 0),(0,n._)([(0,a.Cb)({json:{write:!0}})],f.prototype,"data",void 0),(0,n._)([(0,c.r)("data",["symbol"])],f.prototype,"readData",null),(0,n._)([(0,h.c)("data",{})],f.prototype,"writeData",null),(0,n._)([(0,l.J)({CIMSymbolReference:"cim"},{readOnly:!0})],f.prototype,"type",void 0),f=r=(0,n._)([(0,u.j)("esri.symbols.CIMSymbol")],f);const m=f},61914:(e,t,i)=>{i.d(t,{Z:()=>d});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(79438)),a=i(40266),l=i(87560),c=i(44874),u=i(57403);let h=r=class extends l.Z{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new r({edges:this.edges?.clone(),enabled:this.enabled,material:this.material?.clone(),castShadows:this.castShadows,size:this.size})}};(0,n._)([(0,o.J)({Extrude:"extrude"},{readOnly:!0})],h.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],h.prototype,"size",void 0),(0,n._)([(0,s.Cb)({type:u.b,json:{write:!0}})],h.prototype,"material",void 0),(0,n._)([(0,s.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],h.prototype,"castShadows",void 0),(0,n._)([(0,s.Cb)(c.Z)],h.prototype,"edges",void 0),h=r=(0,n._)([(0,a.j)("esri.symbols.ExtrudeSymbol3DLayer")],h);const d=h},7842:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(36663),n=i(81977),s=(i(39994),i(13802),i(4157),i(40266)),o=i(15498),a=i(18251);let l=class extends a.Z{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline?.hash()}`}};(0,r._)([(0,n.Cb)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":o.Z}},json:{default:null,write:!0}})],l.prototype,"outline",void 0),(0,r._)([(0,n.Cb)({type:["simple-fill","picture-fill"],readOnly:!0})],l.prototype,"type",void 0),l=(0,r._)([(0,s.j)("esri.symbols.FillSymbol")],l);const c=l},88283:(e,t,i)=>{i.d(t,{Z:()=>E});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(79438)),a=i(40266),l=i(87560),c=i(44874),u=i(17615),h=i(93935),d=i(42871),p=i(86342),f=(i(70375),i(81095)),m=i(57403);let g=r=class extends m.b{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:this.color?.clone()??null,emissiveFactor:this.emissiveFactor?(0,f.d9)(this.emissiveFactor):null,colorMixMode:this.colorMixMode};return new r(e)}};(0,n._)([(0,o.J)({multiply:"multiply",replace:"replace",tint:"tint"})],g.prototype,"colorMixMode",void 0),g=r=(0,n._)([(0,a.j)("esri.symbols.support.Symbol3DFillMaterial")],g);var y,_=i(30936),v=i(82064),b=i(95550),w=i(50264),x=i(19049);let T=y=class extends v.Z{constructor(e){super(e),this.color=new _.Z([0,0,0,1]),this.size=(0,b.Wz)(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:null!=this.color?this.color.clone():null,size:this.size,pattern:null!=this.pattern?this.pattern.clone():null,patternCap:this.patternCap};return new y(e)}};var C;(0,n._)([(0,s.Cb)((0,w.a)({colorRequiredOnWrite:!0}))],T.prototype,"color",void 0),(0,n._)([(0,s.Cb)({...w.y,json:{write:{isRequired:!0}}})],T.prototype,"size",void 0),(0,n._)([(0,s.Cb)(d.D)],T.prototype,"pattern",void 0),(0,n._)([(0,s.Cb)({type:x.Hc,json:{default:"butt",write:{overridePolicy(){return{enabled:null!=this.pattern}}}}})],T.prototype,"patternCap",void 0),T=y=(0,n._)([(0,a.j)("esri.symbols.support.Symbol3DOutline")],T);let S=C=class extends l.Z{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:null!=this.edges?this.edges.clone():null,enabled:this.enabled,material:null!=this.material?this.material.clone():null,pattern:null!=this.pattern?this.pattern.clone():null,castShadows:this.castShadows,outline:null!=this.outline?this.outline.clone():null};return new C(e)}static fromSimpleFillSymbol(e){const t=e.outline&&e.outline.style&&"solid"!==e.outline.style?new u.Z({style:e.outline.style}):null,i={size:e.outline?.width??0,color:(e.outline?.color??p.ix).clone(),pattern:t};return t&&e.outline?.cap&&(i.patternCap=e.outline.cap),new C({material:new g({color:(e.color??p.l9).clone()}),pattern:e.style&&"solid"!==e.style?new h.Z({style:e.style}):null,outline:i})}};(0,n._)([(0,o.J)({Fill:"fill"},{readOnly:!0})],S.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:g,json:{write:!0}})],S.prototype,"material",void 0),(0,n._)([(0,s.Cb)(d.q)],S.prototype,"pattern",void 0),(0,n._)([(0,s.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],S.prototype,"castShadows",void 0),(0,n._)([(0,s.Cb)({type:T,json:{write:!0}})],S.prototype,"outline",void 0),(0,n._)([(0,s.Cb)(c.Z)],S.prototype,"edges",void 0),S=C=(0,n._)([(0,a.j)("esri.symbols.FillSymbol3DLayer")],S);const E=S},5975:(e,t,i)=>{i.d(t,{Z:()=>d});var r,n=i(36663),s=i(82064),o=i(95550),a=i(81977),l=i(69236),c=(i(39994),i(4157),i(40266)),u=i(63659);let h=r=class extends s.Z{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return(0,o.t_)(e)}clone(){return new r({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};(0,n._)([(0,a.Cb)({type:u.JT,json:{default:"none",write:!0}})],h.prototype,"decoration",void 0),(0,n._)([(0,a.Cb)({type:String,json:{write:!0}})],h.prototype,"family",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],h.prototype,"size",void 0),(0,n._)([(0,l.p)("size")],h.prototype,"castSize",null),(0,n._)([(0,a.Cb)({type:u.g6,json:{default:"normal",write:!0}})],h.prototype,"style",void 0),(0,n._)([(0,a.Cb)({type:u.vC,json:{default:"normal",write:!0}})],h.prototype,"weight",void 0),h=r=(0,n._)([(0,c.j)("esri.symbols.Font")],h);const d=h},80419:(e,t,i)=>{i.d(t,{Z:()=>C});var r,n=i(36663),s=i(67134),o=i(13802),a=i(3466),l=i(81977),c=(i(39994),i(79438)),u=i(40266),h=i(87560),d=i(86342),p=i(52285),f=i(50264),m=i(37939),g=i(30936),y=i(82064),_=i(95550);i(4157);let v=r=class extends y.Z{constructor(e){super(e),this.color=new g.Z([0,0,0,1]),this.size=(0,_.Wz)(1)}clone(){const e={color:null!=this.color?this.color.clone():null,size:this.size};return new r(e)}};(0,n._)([(0,l.Cb)((0,f.a)({colorRequiredOnWrite:!0}))],v.prototype,"color",void 0),(0,n._)([(0,l.Cb)({...f.y,json:{write:{isRequired:!0}}})],v.prototype,"size",void 0),v=r=(0,n._)([(0,u.j)("esri.symbols.support.Symbol3DIconOutline")],v);var b,w=i(57403);const x="esri.symbols.IconSymbol3DLayer";let T=b=class extends h.Z{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null,this.angle=0}clone(){return new b({anchor:this.anchor,anchorPosition:(0,s.d9)(this.anchorPosition),enabled:this.enabled,material:(0,s.d9)(this.material),outline:(0,s.d9)(this.outline),resource:(0,s.d9)(this.resource),angle:this.angle,size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||d.ix,i=S(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||d.ix).clone()}:null;return new b({size:e.size,angle:e.angle,resource:{primitive:A(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||(0,d.rx)(e.color)?d.ix:e.color,i=S(e);return new b({size:e.width<=e.height?e.height:e.width,angle:e.angle,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new b({resource:{href:(0,a._l)({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};(0,n._)([(0,l.Cb)({type:w.b,json:{write:!0}})],T.prototype,"material",void 0),(0,n._)([(0,l.Cb)({type:p.b,json:{write:!0}})],T.prototype,"resource",void 0),(0,n._)([(0,c.J)({Icon:"icon"},{readOnly:!0})],T.prototype,"type",void 0),(0,n._)([(0,l.Cb)({...f.y,json:{write:{isRequired:!0}}})],T.prototype,"size",void 0),(0,n._)([(0,c.J)({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"},{default:"center"})],T.prototype,"anchor",void 0),(0,n._)([(0,l.Cb)({type:m.e,json:{type:[Number],read:{reader:e=>new m.e({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],T.prototype,"anchorPosition",void 0),(0,n._)([(0,l.Cb)({type:v,json:{write:!0}})],T.prototype,"outline",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0,default:0}})],T.prototype,"angle",void 0),T=b=(0,n._)([(0,u.j)(x)],T);const C=T;function S(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=E(e.xoffset),n=E(e.yoffset);return(r||n)&&t&&i?{x:-r/t,y:n/i}:null}function E(e){return isFinite(e)?e:0}const M={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function A(e){return M[e]||(o.Z.getLogger(x).warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}},63295:(e,t,i)=>{i.d(t,{Z:()=>g});var r,n=i(36663),s=i(41831),o=i(67134),a=i(81977),l=(i(39994),i(13802),i(79438)),c=i(40266),u=i(59834),h=i(69996),d=i(94984),p=i(2571);const f=s.Z.ofType({base:null,key:"type",typeMap:{text:h.Z}});let m=r=class extends u.Z{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new f,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return(0,d.gv)(this)}hasVisibleVerticalOffset(){return(0,d.Uy)(this)}clone(){return new r({styleOrigin:(0,o.d9)(this.styleOrigin),symbolLayers:(0,o.d9)(this.symbolLayers),thumbnail:(0,o.d9)(this.thumbnail),callout:(0,o.d9)(this.callout),verticalOffset:(0,o.d9)(this.verticalOffset)})}static fromTextSymbol(e){return new r({symbolLayers:new s.Z([h.Z.fromTextSymbol(e)])})}};(0,n._)([(0,a.Cb)({type:p.Z,json:{write:!0}})],m.prototype,"verticalOffset",void 0),(0,n._)([(0,a.Cb)(d.Y2)],m.prototype,"callout",void 0),(0,n._)([(0,a.Cb)({json:{read:!1,write:!1}})],m.prototype,"styleOrigin",void 0),(0,n._)([(0,a.Cb)({type:f})],m.prototype,"symbolLayers",void 0),(0,n._)([(0,l.J)({LabelSymbol3D:"label-3d"},{readOnly:!0})],m.prototype,"type",void 0),m=r=(0,n._)([(0,c.j)("esri.symbols.LabelSymbol3D")],m);const g=m},62063:(e,t,i)=>{i.d(t,{Z:()=>g});var r,n=i(36663),s=i(41831),o=i(67134),a=i(81977),l=(i(39994),i(13802),i(79438)),c=i(40266),u=i(60076),h=i(22162),d=i(59834);const p=s.Z.ofType({base:null,key:"type",typeMap:{line:u.Z,path:h.Z}}),f=s.Z.ofType({base:null,key:"type",typeMap:{line:u.Z,path:h.Z}});let m=r=class extends d.Z{constructor(e){super(e),this.symbolLayers=new p,this.type="line-3d"}clone(){return new r({styleOrigin:(0,o.d9)(this.styleOrigin),symbolLayers:(0,o.d9)(this.symbolLayers),thumbnail:(0,o.d9)(this.thumbnail)})}static fromSimpleLineSymbol(e){return new r({symbolLayers:new s.Z([u.Z.fromSimpleLineSymbol(e)])})}};(0,n._)([(0,a.Cb)({type:p,json:{type:f}})],m.prototype,"symbolLayers",void 0),(0,n._)([(0,l.J)({LineSymbol3D:"line-3d"},{readOnly:!0})],m.prototype,"type",void 0),m=r=(0,n._)([(0,c.j)("esri.symbols.LineSymbol3D")],m);const g=m},60076:(e,t,i)=>{i.d(t,{Z:()=>C});var r=i(36663),n=i(95550),s=i(81977),o=(i(39994),i(13802),i(4157),i(79438)),a=i(40266),l=i(30936),c=i(41151),u=i(82064),h=i(7283),d=i(4142);let p=class extends(c.Z.ClonableMixin(u.Z)){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return null!=e&&e.placement===this.placement&&e.style===this.style&&(null==this.color&&null==e.color||null!=this.color&&null!=e.color&&this.color.toJSON()===e.color.toJSON())}};(0,r._)([(0,s.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],p.prototype,"type",void 0),(0,r._)([(0,s.Cb)({type:d.J,json:{default:"begin-end",write:!0}})],p.prototype,"placement",void 0),(0,r._)([(0,s.Cb)({type:d.k,json:{default:"arrow",write:!0}})],p.prototype,"style",void 0),(0,r._)([(0,s.Cb)({type:l.Z,json:{type:[h.z8],default:null,write:!0}})],p.prototype,"color",void 0),p=(0,r._)([(0,a.j)("esri.symbols.LineStyleMarker3D")],p);const f=p;var m,g=i(87560),y=i(17615),_=i(42871),v=i(86342),b=i(50264),w=i(57403),x=i(19049);let T=m=class extends g.Z{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=(0,n.Wz)(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:null!=this.material?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:null!=this.pattern?this.pattern.clone():null,marker:null!=this.marker?this.marker.clone():null};return new m(e)}static fromSimpleLineSymbol(e){const t={enabled:!0,size:e.width??(0,n.Wz)(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style?new y.Z({style:e.style}):null,material:new w.b({color:(e.color||v.ix).clone()}),marker:e.marker?new f({placement:e.marker.placement,style:e.marker.style,color:e.marker.color?.clone()??null}):null};return new m(t)}};(0,r._)([(0,s.Cb)({type:w.b,json:{write:!0}})],T.prototype,"material",void 0),(0,r._)([(0,o.J)({Line:"line"},{readOnly:!0})],T.prototype,"type",void 0),(0,r._)([(0,s.Cb)({type:x.w2,json:{write:!0,default:"miter"}})],T.prototype,"join",void 0),(0,r._)([(0,s.Cb)({type:x.Hc,json:{write:!0,default:"butt"}})],T.prototype,"cap",void 0),(0,r._)([(0,s.Cb)({...b.y,json:{write:{isRequired:!0}}})],T.prototype,"size",void 0),(0,r._)([(0,s.Cb)(_.D)],T.prototype,"pattern",void 0),(0,r._)([(0,s.Cb)({types:{key:"type",base:f,typeMap:{style:f}},json:{write:!0}})],T.prototype,"marker",void 0),T=m=(0,r._)([(0,a.j)("esri.symbols.LineSymbol3DLayer")],T);const C=T},54734:(e,t,i)=>{i.d(t,{Z:()=>u});var r=i(36663),n=i(95550),s=i(81977),o=i(7283),a=(i(39994),i(4157),i(40266)),l=i(18251);let c=class extends l.Z{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};(0,r._)([(0,s.Cb)({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],c.prototype,"angle",void 0),(0,r._)([(0,s.Cb)({type:["simple-marker","picture-marker"],readOnly:!0})],c.prototype,"type",void 0),(0,r._)([(0,s.Cb)({type:Number,cast:n.t_,json:{write:!0}})],c.prototype,"xoffset",void 0),(0,r._)([(0,s.Cb)({type:Number,cast:n.t_,json:{write:!0}})],c.prototype,"yoffset",void 0),(0,r._)([(0,s.Cb)({cast:e=>"auto"===e?e:(0,o.q9)((0,n.t_)(e)),json:{write:!0}})],c.prototype,"size",void 0),c=(0,r._)([(0,a.j)("esri.symbols.MarkerSymbol")],c);const u=c},83849:(e,t,i)=>{i.d(t,{Z:()=>f});var r,n=i(36663),s=i(41831),o=i(67134),a=i(81977),l=(i(39994),i(13802),i(79438)),c=i(40266),u=i(88283),h=i(59834);const d=s.Z.ofType({base:null,key:"type",typeMap:{fill:u.Z}});let p=r=class extends h.Z{constructor(e){super(e),this.symbolLayers=new d,this.type="mesh-3d"}clone(){return new r({styleOrigin:(0,o.d9)(this.styleOrigin),symbolLayers:(0,o.d9)(this.symbolLayers),thumbnail:(0,o.d9)(this.thumbnail)})}static fromSimpleFillSymbol(e){return new r({symbolLayers:new s.Z([u.Z.fromSimpleFillSymbol(e)])})}};(0,n._)([(0,a.Cb)({type:d})],p.prototype,"symbolLayers",void 0),(0,n._)([(0,l.J)({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],p.prototype,"type",void 0),p=r=(0,n._)([(0,c.j)("esri.symbols.MeshSymbol3D")],p);const f=p},25463:(e,t,i)=>{i.d(t,{Z:()=>m});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(79438)),a=i(40266),l=i(87560),c=i(4125),u=i(74396);let h=r=class extends u.Z{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new r({x:this.x,y:this.y,z:this.z})}};(0,n._)([(0,s.Cb)({type:Number})],h.prototype,"x",void 0),(0,n._)([(0,s.Cb)({type:Number})],h.prototype,"y",void 0),(0,n._)([(0,s.Cb)({type:Number})],h.prototype,"z",void 0),h=r=(0,n._)([(0,a.j)("esri.symbols.support.Symbol3DAnchorPosition3D")],h);var d,p=i(57403);let f=d=class extends l.Z{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new d({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||"string"!=typeof this.resource.href}};(0,n._)([(0,s.Cb)({type:p.b,json:{write:!0}})],f.prototype,"material",void 0),(0,n._)([(0,s.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],f.prototype,"castShadows",void 0),(0,n._)([(0,s.Cb)({type:c.k,json:{write:!0}})],f.prototype,"resource",void 0),(0,n._)([(0,o.J)({Object:"object"},{readOnly:!0})],f.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,json:{write:!0}})],f.prototype,"width",void 0),(0,n._)([(0,s.Cb)({type:Number,json:{write:!0}})],f.prototype,"height",void 0),(0,n._)([(0,s.Cb)({type:Number,json:{write:!0}})],f.prototype,"depth",void 0),(0,n._)([(0,o.J)({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"},{default:"origin"})],f.prototype,"anchor",void 0),(0,n._)([(0,s.Cb)({type:h,json:{type:[Number],read:{reader:e=>new h({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],f.prototype,"anchorPosition",void 0),(0,n._)([(0,s.Cb)({type:Number,json:{write:!0}})],f.prototype,"heading",void 0),(0,n._)([(0,s.Cb)({type:Number,json:{write:!0}})],f.prototype,"tilt",void 0),(0,n._)([(0,s.Cb)({type:Number,json:{write:!0}})],f.prototype,"roll",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],f.prototype,"isPrimitive",null),f=d=(0,n._)([(0,a.j)("esri.symbols.ObjectSymbol3DLayer")],f);const m=f},22162:(e,t,i)=>{i.d(t,{Z:()=>p});var r,n=i(36663),s=i(81977),o=(i(39994),i(13802),i(4157),i(79438)),a=i(34248),l=i(40266),c=i(87560),u=i(57403),h=i(19049);let d=r=class extends c.Z{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return null!=e?e:null==t.height&&null!=t.size?t.size:void 0}readHeight(e,t){return null!=e?e:null==t.width&&null!=t.size?t.size:void 0}clone(){return new r({enabled:this.enabled,material:null!=this.material?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};(0,n._)([(0,s.Cb)({type:u.b,json:{write:!0}})],d.prototype,"material",void 0),(0,n._)([(0,s.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],d.prototype,"castShadows",void 0),(0,n._)([(0,o.J)({Path:"path"},{readOnly:!0})],d.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:["circle","quad"],json:{write:!0,default:"circle"}})],d.prototype,"profile",void 0),(0,n._)([(0,s.Cb)({type:h.w2,json:{write:!0,default:"miter"}})],d.prototype,"join",void 0),(0,n._)([(0,s.Cb)({type:h.KW,json:{write:!0,default:"butt"}})],d.prototype,"cap",void 0),(0,n._)([(0,s.Cb)({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],d.prototype,"width",void 0),(0,n._)([(0,a.r)("width",["width","size","height"])],d.prototype,"readWidth",null),(0,n._)([(0,s.Cb)({type:Number,json:{write:!0}})],d.prototype,"height",void 0),(0,n._)([(0,a.r)("height",["height","size","width"])],d.prototype,"readHeight",null),(0,n._)([(0,s.Cb)({type:["center","bottom","top"],json:{write:!0,default:"center"}})],d.prototype,"anchor",void 0),(0,n._)([(0,s.Cb)({type:["heading","all"],json:{write:!0,default:"all"}})],d.prototype,"profileRotation",void 0),d=r=(0,n._)([(0,l.j)("esri.symbols.PathSymbol3DLayer")],d);const p=d},86036:(e,t,i)=>{i.d(t,{Z:()=>f});var r,n=i(36663),s=i(67134),o=i(95550),a=i(81977),l=(i(39994),i(13802),i(79438)),c=i(34248),u=i(40266),h=i(54734),d=i(59551);let p=r=class extends h.Z{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&"string"!=typeof e&&null==e.imageData)return e;const r={};return e&&(r.url=e),null!=t&&(r.width=(0,o.t_)(t)),null!=i&&(r.height=(0,o.t_)(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new r({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",(0,s.d9)(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};(0,n._)([(0,a.Cb)({json:{write:!1}})],p.prototype,"color",void 0),(0,n._)([(0,l.J)({esriPMS:"picture-marker"},{readOnly:!0})],p.prototype,"type",void 0),(0,n._)([(0,a.Cb)(d.KA)],p.prototype,"url",void 0),(0,n._)([(0,a.Cb)(d.Ds)],p.prototype,"source",void 0),(0,n._)([(0,a.Cb)({type:Number,cast:o.t_,json:{write:!0}})],p.prototype,"height",void 0),(0,n._)([(0,c.r)("height",["height","size"])],p.prototype,"readHeight",null),(0,n._)([(0,a.Cb)({type:Number,cast:o.t_,json:{write:!0}})],p.prototype,"width",void 0),(0,n._)([(0,a.Cb)({json:{write:!1}})],p.prototype,"size",void 0),p=r=(0,n._)([(0,u.j)("esri.symbols.PictureMarkerSymbol")],p);const f=p},60378:(e,t,i)=>{i.d(t,{Z:()=>b});var r,n=i(36663),s=i(30936),o=i(41831),a=i(67134),l=i(81977),c=(i(39994),i(13802),i(79438)),u=i(40266),h=i(80419),d=i(25463),p=i(59834),f=i(69996),m=i(94984),g=i(62179),y=i(2571);const _=o.Z.ofType({base:null,key:"type",typeMap:{icon:h.Z,object:d.Z,text:f.Z}});let v=r=class extends p.Z{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new _,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return(0,m.gv)(this)}hasVisibleVerticalOffset(){return(0,m.Uy)(this)}clone(){return new r({verticalOffset:(0,a.d9)(this.verticalOffset),callout:(0,a.d9)(this.callout),styleOrigin:(0,a.d9)(this.styleOrigin),symbolLayers:(0,a.d9)(this.symbolLayers),thumbnail:(0,a.d9)(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new r({symbolLayers:new o.Z([h.Z.fromSimpleMarkerSymbol(e)])})}static fromPictureMarkerSymbol(e){return new r({symbolLayers:new o.Z([h.Z.fromPictureMarkerSymbol(e)])})}static fromCIMSymbol(e){const t=e.data?.symbol?.type;if("CIMPointSymbol"!==t)return null;const i=e.data.symbol;return new r(i?.callout?{symbolLayers:new o.Z([h.Z.fromCIMSymbol(e)]),callout:new g.Z({size:.5,color:new s.Z([0,0,0])}),verticalOffset:new y.Z({screenLength:40})}:{symbolLayers:new o.Z([h.Z.fromCIMSymbol(e)])})}static fromTextSymbol(e){return new r({symbolLayers:new o.Z([f.Z.fromTextSymbol(e)])})}};(0,n._)([(0,l.Cb)({type:y.Z,json:{write:!0}})],v.prototype,"verticalOffset",void 0),(0,n._)([(0,l.Cb)(m.Y2)],v.prototype,"callout",void 0),(0,n._)([(0,l.Cb)({type:_,json:{origins:{"web-scene":{write:!0}}}})],v.prototype,"symbolLayers",void 0),(0,n._)([(0,c.J)({PointSymbol3D:"point-3d"},{readOnly:!0})],v.prototype,"type",void 0),v=r=(0,n._)([(0,u.j)("esri.symbols.PointSymbol3D")],v);const b=v},57770:(e,t,i)=>{i.d(t,{Z:()=>T});var r,n=i(36663),s=i(41831),o=i(59801),a=i(67134),l=i(13802),c=i(76868),u=i(81977),h=(i(39994),i(79438)),d=i(40266),p=i(61914),f=i(88283),m=i(80419),g=i(60076),y=i(25463),_=i(59834),v=i(69996),b=i(60171);const w=s.Z.ofType({base:null,key:"type",typeMap:{extrude:p.Z,fill:f.Z,icon:m.Z,line:g.Z,object:y.Z,text:v.Z,water:b.Z}});let x=r=class extends _.Z{constructor(e){super(e),this.symbolLayers=new w,this.type="polygon-3d"}initialize(){const e=e=>{"line"===e.type&&(0,o.x9)(l.Z.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),"text"===e.type&&(0,o.x9)(l.Z.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const t of this.symbolLayers)e(t);this.addHandles((0,c.on)((()=>this.symbolLayers),"after-add",(({item:t})=>e(t)),c.sync))}clone(){return new r({styleOrigin:(0,a.d9)(this.styleOrigin),symbolLayers:(0,a.d9)(this.symbolLayers),thumbnail:(0,a.d9)(this.thumbnail)})}static fromJSON(e){const t=new r;if(t.read(e),2===t.symbolLayers.length&&"fill"===t.symbolLayers.at(0).type&&"line"===t.symbolLayers.at(1).type){const i=t.symbolLayers.at(0),r=t.symbolLayers.at(1);!r.enabled||e.symbolLayers?.[1]&&!1===e.symbolLayers[1].enable||(i.outline={size:r.size,color:null!=r.material?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new r({symbolLayers:new s.Z([f.Z.fromSimpleFillSymbol(e)])})}};(0,n._)([(0,u.Cb)({type:w,json:{write:!0}})],x.prototype,"symbolLayers",void 0),(0,n._)([(0,h.J)({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],x.prototype,"type",void 0),x=r=(0,n._)([(0,d.j)("esri.symbols.PolygonSymbol3D")],x);const T=x},43411:(e,t,i)=>{i.d(t,{Z:()=>m});var r,n=i(36663),s=i(30936),o=i(25709),a=i(67134),l=i(81977),c=(i(39994),i(13802),i(79438)),u=i(40266),h=i(7842),d=i(15498);const p=new o.X({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let f=r=class extends h.Z{constructor(...e){super(...e),this.color=new s.Z([0,0,0,.25]),this.outline=new d.Z,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&"string"!=typeof e)return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new r({color:(0,a.d9)(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};(0,n._)([(0,l.Cb)()],f.prototype,"color",void 0),(0,n._)([(0,l.Cb)()],f.prototype,"outline",void 0),(0,n._)([(0,c.J)({esriSFS:"simple-fill"},{readOnly:!0})],f.prototype,"type",void 0),(0,n._)([(0,l.Cb)({type:p.apiValues,json:{read:p.read,write:p.write}})],f.prototype,"style",void 0),f=r=(0,n._)([(0,u.j)("esri.symbols.SimpleFillSymbol")],f);const m=f},15498:(e,t,i)=>{i.d(t,{Z:()=>C});var r=i(36663),n=i(25709),s=i(67134),o=i(95550),a=i(81977),l=(i(39994),i(13802),i(79438)),c=i(40266),u=(i(4157),i(18251));let h=class extends u.Z{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};(0,r._)([(0,l.J)({esriSLS:"simple-line"},{readOnly:!0})],h.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:Number,cast:o.t_,json:{write:!0}})],h.prototype,"width",void 0),h=(0,r._)([(0,c.j)("esri.symbols.LineSymbol")],h);const d=h;var p,f=i(30936),m=i(82064),g=i(34248),y=i(39835),_=i(4142);let v=p=class extends m.Z{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){t[i]="web-map"===r?.origin?"arrow":e}set color(e){this._set("color",e)}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){"web-map"===r?.origin||(t[i]=e)}clone(){return new p({color:(0,s.d9)(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};(0,r._)([(0,a.Cb)({type:["begin","end","begin-end"],json:{write:!0}})],v.prototype,"placement",void 0),(0,r._)([(0,l.J)({"line-marker":"line-marker"},{readOnly:!0}),(0,a.Cb)({json:{origins:{"web-map":{write:!1}}}})],v.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:_.k})],v.prototype,"style",void 0),(0,r._)([(0,y.c)("style")],v.prototype,"writeStyle",null),(0,r._)([(0,a.Cb)({type:f.Z,value:null,json:{write:{allowNull:!0}}})],v.prototype,"color",null),(0,r._)([(0,g.r)("color")],v.prototype,"readColor",null),(0,r._)([(0,y.c)("color")],v.prototype,"writeColor",null),v=p=(0,r._)([(0,c.j)("esri.symbols.LineSymbolMarker")],v);const b=v;var w;const x=new n.X({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let T=w=class extends d{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,n,s){if(e&&"string"!=typeof e)return e;const a={};return null!=e&&(a.style=e),null!=t&&(a.color=t),null!=i&&(a.width=(0,o.t_)(i)),null!=r&&(a.cap=r),null!=n&&(a.join=n),null!=s&&(a.miterLimit=(0,o.t_)(s)),a}clone(){return new w({color:(0,s.d9)(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};(0,r._)([(0,l.J)({esriSLS:"simple-line"},{readOnly:!0})],T.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:x.apiValues,json:{read:x.read,write:x.write}})],T.prototype,"style",void 0),(0,r._)([(0,a.Cb)({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:"round"!==e&&null==i?.origin})}}})],T.prototype,"cap",void 0),(0,r._)([(0,a.Cb)({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:"round"!==e&&null==i?.origin})}}})],T.prototype,"join",void 0),(0,r._)([(0,a.Cb)({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":b}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],T.prototype,"marker",void 0),(0,r._)([(0,a.Cb)({type:Number,json:{read:!1,write:!1}})],T.prototype,"miterLimit",void 0),T=w=(0,r._)([(0,c.j)("esri.symbols.SimpleLineSymbol")],T);const C=T},1759:(e,t,i)=>{i.d(t,{Z:()=>y});var r,n=i(36663),s=i(30936),o=i(25709),a=i(67134),l=i(95550),c=i(81977),u=(i(39994),i(13802),i(79438)),h=i(40266),d=i(39835),p=i(54734),f=i(15498);const m=new o.X({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let g=r=class extends p.Z{constructor(...e){super(...e),this.color=new s.Z([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new f.Z}normalizeCtorArgs(e,t,i,r){if(e&&"string"!=typeof e)return e;const n={};return e&&(n.style=e),null!=t&&(n.size=(0,l.t_)(t)),i&&(n.outline=i),r&&(n.color=r),n}writeColor(e,t){e&&"x"!==this.style&&"cross"!==this.style&&(t.color=e.toJSON()),null===e&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new r({angle:this.angle,color:(0,a.d9)(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};(0,n._)([(0,c.Cb)()],g.prototype,"color",void 0),(0,n._)([(0,d.c)("color")],g.prototype,"writeColor",null),(0,n._)([(0,u.J)({esriSMS:"simple-marker"},{readOnly:!0})],g.prototype,"type",void 0),(0,n._)([(0,c.Cb)()],g.prototype,"size",void 0),(0,n._)([(0,c.Cb)({type:m.apiValues,json:{read:m.read,write:m.write}})],g.prototype,"style",void 0),(0,n._)([(0,c.Cb)({type:String,json:{write:!0}})],g.prototype,"path",null),(0,n._)([(0,c.Cb)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":f.Z}},json:{default:null,write:!0}})],g.prototype,"outline",void 0),g=r=(0,n._)([(0,h.j)("esri.symbols.SimpleMarkerSymbol")],g);const y=g},18251:(e,t,i)=>{i.d(t,{Z:()=>p});var r=i(36663),n=i(30936),s=i(25709),o=i(82064),a=i(81977),l=(i(39994),i(13802),i(4157),i(34248)),c=i(40266);const u=new s.X({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let h=0,d=class extends o.Z{constructor(e){super(e),this.id="sym"+h++,this.type=null,this.color=new n.Z([0,0,0,1])}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};(0,r._)([(0,a.Cb)({type:u.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:u.write,isRequired:!0}}})],d.prototype,"type",void 0),(0,r._)([(0,a.Cb)({type:n.Z,json:{write:{allowNull:!0}}})],d.prototype,"color",void 0),(0,r._)([(0,l.r)("color")],d.prototype,"readColor",null),d=(0,r._)([(0,c.j)("esri.symbols.Symbol")],d);const p=d},59834:(e,t,i)=>{i.d(t,{Z:()=>P});var r=i(36663),n=i(41831),s=i(58811),o=i(13802),a=i(3466),l=i(96863),c=i(81977),u=i(69236),h=(i(39994),i(4157),i(34248)),d=i(40266),p=i(39835),f=i(93968),m=i(16641),g=i(61914),y=i(88283),_=i(80419),v=i(60076),b=i(25463),w=i(22162),x=i(18251),T=i(87560),C=i(69996),S=i(60171),E=i(85068),M=i(3032);const A={icon:_.Z,object:b.Z,line:v.Z,path:w.Z,fill:y.Z,extrude:g.Z,text:C.Z,water:S.Z},R=n.Z.ofType({base:T.Z,key:"type",typeMap:A,errorContext:"symbol-layer"});let O=class extends x.Z{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=(this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers)?.type,i=t||n.Z;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&o.Z.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){(0,s.Z)(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const t=(0,m.f)(e.styleUrl,i);return new E.Z({styleUrl:t,name:e.name})}if(e.styleName&&e.name)return new E.Z({portal:i?.portal||f.Z.getDefault(),styleName:e.styleName,name:e.name});i?.messages&&i.messages.push(new l.Z("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let i=(0,m.t)(e.styleUrl,r);(0,a.YP)(i)&&(i=(0,a.Fv)(i)),t.styleOrigin={styleUrl:i,name:e.name}}else e.styleName&&e.name&&(e.portal&&r?.portal&&!(0,a.tm)(e.portal.restUrl,r.portal.restUrl)?r?.messages&&r.messages.push(new l.Z("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof T.Z||e&&A[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};(0,r._)([(0,c.Cb)({json:{read:!1,write:!1}})],O.prototype,"color",null),(0,r._)([(0,c.Cb)({type:R,nonNullable:!0,json:{write:!0}}),(0,u.p)(s.R)],O.prototype,"symbolLayers",null),(0,r._)([(0,c.Cb)({type:E.Z})],O.prototype,"styleOrigin",void 0),(0,r._)([(0,h.r)("styleOrigin")],O.prototype,"readStyleOrigin",null),(0,r._)([(0,p.c)("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],O.prototype,"writeStyleOrigin",null),(0,r._)([(0,c.Cb)({type:M.p,json:{read:!1}})],O.prototype,"thumbnail",void 0),(0,r._)([(0,c.Cb)({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],O.prototype,"type",void 0),O=(0,r._)([(0,d.j)("esri.symbols.Symbol3D")],O);const P=O},87560:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(36663),n=i(82064),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(39835);let l=class extends n.Z{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,t,i){e||(t[i]=e)}};(0,r._)([(0,s.Cb)({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],l.prototype,"enabled",void 0),(0,r._)([(0,a.c)("enabled")],l.prototype,"writeEnabled",null),(0,r._)([(0,s.Cb)({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0,json:{write:{isRequired:!0}}})],l.prototype,"type",void 0),l=(0,r._)([(0,o.j)("esri.symbols.Symbol3DLayer")],l);const c=l},27624:(e,t,i)=>{i.d(t,{Z:()=>y});var r,n=i(36663),s=i(30936),o=i(67134),a=i(95550),l=i(81977),c=i(69236),u=i(79438),h=i(40266),d=i(39835),p=i(5975),f=i(18251),m=i(63659);let g=r=class extends f.Z{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new p.Z,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&"string"!=typeof e)return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&"string"!=typeof r?r.origin:t[i]=e}castLineWidth(e){return(0,a.t_)(e)}writeLineHeight(e,t,i,r){r&&"string"!=typeof r?r.origin:t[i]=e}clone(){return new r({angle:this.angle,backgroundColor:(0,o.d9)(this.backgroundColor),borderLineColor:(0,o.d9)(this.borderLineColor),borderLineSize:this.borderLineSize,color:(0,o.d9)(this.color),font:this.font&&this.font.clone(),haloColor:(0,o.d9)(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};(0,n._)([(0,l.Cb)({type:s.Z,json:{write:!0}})],g.prototype,"backgroundColor",void 0),(0,n._)([(0,l.Cb)({type:s.Z,json:{write:!0}})],g.prototype,"borderLineColor",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0},cast:a.t_})],g.prototype,"borderLineSize",void 0),(0,n._)([(0,l.Cb)({type:p.Z,json:{write:!0}})],g.prototype,"font",void 0),(0,n._)([(0,l.Cb)({...m.x0,json:{write:!0}})],g.prototype,"horizontalAlignment",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],g.prototype,"kerning",void 0),(0,n._)([(0,l.Cb)({type:s.Z,json:{write:!0}})],g.prototype,"haloColor",void 0),(0,n._)([(0,l.Cb)({type:Number,cast:a.t_,json:{write:!0}})],g.prototype,"haloSize",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],g.prototype,"rightToLeft",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],g.prototype,"rotated",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],g.prototype,"text",void 0),(0,n._)([(0,u.J)({esriTS:"text"},{readOnly:!0})],g.prototype,"type",void 0),(0,n._)([(0,l.Cb)({...m.Nj,json:{write:!0}})],g.prototype,"verticalAlignment",void 0),(0,n._)([(0,l.Cb)({type:Number,cast:a.t_,json:{write:!0}})],g.prototype,"xoffset",void 0),(0,n._)([(0,l.Cb)({type:Number,cast:a.t_,json:{write:!0}})],g.prototype,"yoffset",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],g.prototype,"angle",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],g.prototype,"width",void 0),(0,n._)([(0,l.Cb)({type:Number})],g.prototype,"lineWidth",void 0),(0,n._)([(0,d.c)("lineWidth")],g.prototype,"writeLineWidth",null),(0,n._)([(0,c.p)("lineWidth")],g.prototype,"castLineWidth",null),(0,n._)([(0,l.Cb)(m.Ck)],g.prototype,"lineHeight",void 0),(0,n._)([(0,d.c)("lineHeight")],g.prototype,"writeLineHeight",null),g=r=(0,n._)([(0,h.j)("esri.symbols.TextSymbol")],g);const y=g},69996:(e,t,i)=>{i.d(t,{Z:()=>T});var r,n=i(36663),s=i(67134),o=i(81977),a=(i(39994),i(13802),i(79438)),l=i(40266),c=i(39835),u=i(5975),h=i(87560),d=i(50264),p=i(30936),f=i(82064);let m=r=class extends f.Z{constructor(){super(...arguments),this.color=new p.Z([0,0,0,1]),this.size=0}clone(){const e={color:(0,s.d9)(this.color),size:this.size};return new r(e)}};(0,n._)([(0,o.Cb)((0,d.a)())],m.prototype,"color",void 0),(0,n._)([(0,o.Cb)(d.y)],m.prototype,"size",void 0),m=r=(0,n._)([(0,l.j)("esri.symbols.support.Symbol3DHalo")],m);var g=i(57403),y=i(41151);i(4157);let _=class extends(y.Z.ClonableMixin(f.Z)){constructor(e){super(e),this.color=null}};(0,n._)([(0,o.Cb)((0,d.a)())],_.prototype,"color",void 0),_=(0,n._)([(0,l.j)("esri.symbols.support.Symbol3DTextBackground")],_);var v,b=i(63659);let w=v=class extends h.Z{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){null!=e&&null!=this._userSize&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const n={...r,textSymbol3D:!0};t.font=e.write({},n),delete t.font.size}get size(){return null!=this._userSize?this._userSize:null!=this.font?.size?this.font.size:9}set size(e){this._userSize=e,null!=this.font&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new v({enabled:this.enabled,font:this.font&&(0,s.d9)(this.font),halo:this.halo&&(0,s.d9)(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:null!=this.material?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:(0,s.d9)(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new v({font:null!=e.font?e.font.clone():new u.Z,halo:x(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new g.b({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new _({color:e.backgroundColor.clone()}):null})}};function x(e,t){return e&&null!=t&&t>0?new m({color:(0,s.d9)(e),size:t}):null}(0,n._)([(0,o.Cb)({type:u.Z,json:{write:!0}})],w.prototype,"font",null),(0,n._)([(0,c.c)("font")],w.prototype,"writeFont",null),(0,n._)([(0,o.Cb)({type:m,json:{write:!0}})],w.prototype,"halo",void 0),(0,n._)([(0,o.Cb)({...b.x0,json:{default:"center",write:!0}})],w.prototype,"horizontalAlignment",void 0),(0,n._)([(0,o.Cb)({...b.Ck,json:{default:1,write:!0}})],w.prototype,"lineHeight",void 0),(0,n._)([(0,o.Cb)({type:g.b,json:{write:!0}})],w.prototype,"material",void 0),(0,n._)([(0,o.Cb)({type:_,json:{write:!0}})],w.prototype,"background",void 0),(0,n._)([(0,o.Cb)(d.y)],w.prototype,"size",null),(0,n._)([(0,o.Cb)({type:String,json:{write:!0}})],w.prototype,"text",void 0),(0,n._)([(0,a.J)({Text:"text"},{readOnly:!0})],w.prototype,"type",void 0),(0,n._)([(0,o.Cb)({...b.Nj,json:{default:"baseline",write:!0}})],w.prototype,"verticalAlignment",void 0),w=v=(0,n._)([(0,l.j)("esri.symbols.TextSymbol3DLayer")],w);const T=w},60171:(e,t,i)=>{i.d(t,{Z:()=>p});var r,n=i(36663),s=i(30936),o=i(67134),a=i(81977),l=i(7283),c=i(79438),u=i(40266),h=i(87560);let d=r=class extends h.Z{constructor(e){super(e),this.color=f.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new r({color:(0,o.d9)(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};(0,n._)([(0,a.Cb)({type:s.Z,nonNullable:!0,json:{type:[l.z8],write:(e,t,i)=>t[i]=e.toArray(s.Z.AlphaMode.UNLESS_OPAQUE),default:()=>f.clone(),defaultEquals:e=>e.toCss(!0)===f.toCss(!0)}})],d.prototype,"color",void 0),(0,n._)([(0,c.J)({Water:"water"},{readOnly:!0})],d.prototype,"type",void 0),(0,n._)([(0,a.Cb)({type:["small","medium","large"],json:{write:!0,default:"medium"}})],d.prototype,"waterbodySize",void 0),(0,n._)([(0,a.Cb)({type:Number,json:{write:!0,default:null}})],d.prototype,"waveDirection",void 0),(0,n._)([(0,a.Cb)({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],d.prototype,"waveStrength",void 0),d=r=(0,n._)([(0,u.j)("esri.symbols.WaterSymbol3DLayer")],d);const p=d,f=new s.Z([0,119,190])},27948:(e,t,i)=>{i.d(t,{Z:()=>g});var r,n=i(36663),s=i(70375),o=i(13802),a=i(78668),l=i(81977),c=(i(39994),i(4157),i(79438)),u=i(40266),h=i(93968),d=i(16641),p=i(18251),f=i(3032);let m=r=class extends p.Z{constructor(e){super(e),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const e=null!=this.portal?this.portal:h.Z.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?.portal,super.read(e,t)}clone(){return new r({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){const t=e&&"acceptedFormats"in e?e.acceptedFormats:["web"];return this._fetchSymbol({...e,acceptedFormats:t})}async fetchCIMSymbol(e){const t=await this.fetchSymbol({...e,acceptedFormats:["cim"]});if("cim"!==t?.type)throw new s.Z("webstylesymbol:fetchCIMSymbol","Resolved web style symbol is not of type 'cim'");return t}async _fetchSymbol(e){const t=null!=e?e.cache:null,r=t?this._fetchCacheKey:null;if(null!=t){const e=r&&t.get(r);if(e)return e.clone()}const{resolveWebStyleSymbol:n}=await i.e(77710).then(i.bind(i,77710));(0,a.k_)(e);const s=n(this,{portal:this.portal},e);s.catch((e=>{o.Z.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",e)}));const l=await s;return null!=t&&t.set(r,l.clone()),l}};(0,n._)([(0,l.Cb)({json:{write:!1}})],m.prototype,"color",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],m.prototype,"styleName",void 0),(0,n._)([(0,l.Cb)({type:h.Z,json:{write:!1}})],m.prototype,"portal",void 0),(0,n._)([(0,l.Cb)({type:String,json:{read:d.r,write:d.w}})],m.prototype,"styleUrl",void 0),(0,n._)([(0,l.Cb)({type:f.p,json:{read:!1}})],m.prototype,"thumbnail",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],m.prototype,"name",void 0),(0,n._)([(0,c.J)({styleSymbolReference:"web-style"},{readOnly:!0})],m.prototype,"type",void 0),(0,n._)([(0,l.Cb)()],m.prototype,"_fetchCacheKey",null),m=r=(0,n._)([(0,u.j)("esri.symbols.WebStyleSymbol")],m);const g=m},56378:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(36663),n=i(82064),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};(0,r._)([(0,s.Cb)({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],a.prototype,"type",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],a.prototype,"visible",void 0),a=(0,r._)([(0,o.j)("esri.symbols.callouts.Callout3D")],a);const l=a},62179:(e,t,i)=>{i.d(t,{Z:()=>m});var r,n=i(36663),s=i(30936),o=i(67134),a=i(95550),l=i(81977),c=(i(39994),i(13802),i(79438)),u=i(40266),h=i(56378),d=i(73159),p=i(50264);let f=r=class extends h.Z{constructor(e){super(e),this.type="line",this.color=new s.Z([0,0,0,1]),this.size=(0,a.Wz)(1),this.border=null}get visible(){return this.size>0&&null!=this.color&&this.color.a>0}clone(){return new r({color:(0,o.d9)(this.color),size:this.size,border:(0,o.d9)(this.border)})}};(0,n._)([(0,c.J)({line:"line"})],f.prototype,"type",void 0),(0,n._)([(0,l.Cb)((0,p.a)({colorRequiredOnWrite:!0}))],f.prototype,"color",void 0),(0,n._)([(0,l.Cb)({...p.y,json:{write:{isRequired:!0}}})],f.prototype,"size",void 0),(0,n._)([(0,l.Cb)({type:d.Z,json:{write:!0}})],f.prototype,"border",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],f.prototype,"visible",null),f=r=(0,n._)([(0,u.j)("esri.symbols.callouts.LineCallout3D")],f);const m=f},73159:(e,t,i)=>{i.d(t,{Z:()=>d});var r,n=i(36663),s=i(30936),o=i(82064),a=i(67134),l=i(81977),c=(i(39994),i(13802),i(40266)),u=i(50264);let h=r=class extends o.Z{constructor(e){super(e),this.color=new s.Z("white")}clone(){return new r({color:(0,a.d9)(this.color)})}};(0,n._)([(0,l.Cb)((0,u.a)({colorRequiredOnWrite:!0}))],h.prototype,"color",void 0),h=r=(0,n._)([(0,c.j)("esri.symbols.callouts.LineCallout3DBorder")],h);const d=h},94984:(e,t,i)=>{i.d(t,{Pd:()=>a,Uy:()=>s,Y2:()=>c,as:()=>l,gv:()=>o});var r=i(56378),n=i(62179);function s(e){if(!e)return!1;const t=e.verticalOffset;return!(!t||t.screenLength<=0||null!=t.maxWorldLength&&t.maxWorldLength<=0)}function o(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;return!!e.callout?.visible&&!!s(e)}function a(e){return"point-3d"===e.type||"label-3d"===e.type}function l(e){return"center"===e.horizontalAlignment}const c={types:{key:"type",base:r.Z,typeMap:{line:n.Z}},json:{write:!0}}},42512:(e,t,i)=>{i.d(t,{E:()=>s,m:()=>n});var r=i(25609);const n={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},s={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1,gradientMethod:"AcrossLine",gradientSize:75,gradientSizeUnits:r.IH.Relative,gradientType:"Discrete",interval:5},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGradientFill:{enable:!0,angle:90,gradientMethod:"Linear",gradientSize:75,gradientSizeUnits:r.IH.Relative,gradientType:"Discrete",interval:5},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:r.of.Loop,repeatdelay:0,easing:r.IB.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0,rotateclockwise:!1},CIMSymbolAnimationOffset:{offsetx:0,offsety:0}}},25609:(e,t,i)=>{var r,n,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,b,w,x,T,C,S,E,M,A,R,O,P,I,L,D,N,F,U,k,z,B,V,H,G,j,Z,q,W,$,Y,J,X,K,Q,ee,te,ie,re,ne,se,oe,ae,le,ce,ue,he;i.d(t,{$y:()=>S,AH:()=>n,CS:()=>X,DD:()=>u,Dd:()=>I,Em:()=>C,IB:()=>f,IH:()=>ne,JS:()=>Y,Ky:()=>h,Lh:()=>K,Qb:()=>ae,RL:()=>r,RS:()=>ce,TF:()=>T,Tx:()=>a,UR:()=>b,UX:()=>oe,bj:()=>J,eZ:()=>c,id:()=>A,kP:()=>B,of:()=>p,r4:()=>j,sj:()=>V,v2:()=>s,zQ:()=>P,zV:()=>v}),function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"}(r||(r={})),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER",e[e.UNKNOWN=4]="UNKNOWN"}(n||(n={})),function(e){e[e.SCREEN=0]="SCREEN",e[e.MAP=1]="MAP"}(s||(s={})),function(e){e[e.Tint=0]="Tint",e[e.Ignore=1]="Ignore",e[e.Multiply=99]="Multiply"}(o||(o={})),function(e){e.Both="Both",e.JustBegin="JustBegin",e.JustEnd="JustEnd",e.None="None"}(a||(a={})),function(e){e[e.Mosaic=0]="Mosaic",e[e.Centered=1]="Centered"}(l||(l={})),function(e){e[e.Normal=0]="Normal",e[e.Superscript=1]="Superscript",e[e.Subscript=2]="Subscript"}(c||(c={})),function(e){e[e.MSSymbol=0]="MSSymbol",e[e.Unicode=1]="Unicode"}(u||(u={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.TrueType=1]="TrueType",e[e.PSOpenType=2]="PSOpenType",e[e.TTOpenType=3]="TTOpenType",e[e.Type1=4]="Type1"}(h||(h={})),function(e){e[e.Display=0]="Display",e[e.Map=1]="Map"}(d||(d={})),function(e){e.None="None",e.Loop="Loop",e.Oscillate="Oscillate"}(p||(p={})),function(e){e.Linear="Linear",e.EaseIn="EaseIn",e.EaseOut="EaseOut",e.EaseInOut="EaseInOut"}(f||(f={})),function(e){e[e.Z=0]="Z",e[e.X=1]="X",e[e.Y=2]="Y"}(m||(m={})),function(e){e[e.XYZ=0]="XYZ",e[e.ZXY=1]="ZXY",e[e.YXZ=2]="YXZ"}(g||(g={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Oval=2]="Oval"}(y||(y={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.Screen=2]="Screen",e[e.Multiply=3]="Multiply",e[e.Add=4]="Add"}(_||(_={})),function(e){e[e.TTB=0]="TTB",e[e.RTL=1]="RTL",e[e.BTT=2]="BTT"}(v||(v={})),function(e){e[e.None=0]="None",e[e.SignPost=1]="SignPost",e[e.FaceNearPlane=2]="FaceNearPlane"}(b||(b={})),function(e){e[e.Float=0]="Float",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}(w||(w={})),function(e){e[e.Intersect=0]="Intersect",e[e.Subtract=1]="Subtract"}(x||(x={})),function(e){e.OpenEnded="OpenEnded",e.Block="Block",e.Crossed="Crossed"}(T||(T={})),function(e){e.FullGeometry="FullGeometry",e.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",e.ReversedFirstSegment="ReversedFirstSegment",e.PerpendicularToSecondSegment="PerpendicularToSecondSegment",e.SecondSegmentWithTicks="SecondSegmentWithTicks",e.DoublePerpendicular="DoublePerpendicular",e.OppositeToFirstSegment="OppositeToFirstSegment",e.TriplePerpendicular="TriplePerpendicular",e.HalfCircleFirstSegment="HalfCircleFirstSegment",e.HalfCircleSecondSegment="HalfCircleSecondSegment",e.HalfCircleExtended="HalfCircleExtended",e.OpenCircle="OpenCircle",e.CoverageEdgesWithTicks="CoverageEdgesWithTicks",e.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",e.GapExtentMidline="GapExtentMidline",e.Chevron="Chevron",e.PerpendicularWithArc="PerpendicularWithArc",e.ClosedHalfCircle="ClosedHalfCircle",e.TripleParallelExtended="TripleParallelExtended",e.ParallelWithTicks="ParallelWithTicks",e.Parallel="Parallel",e.PerpendicularToFirstSegment="PerpendicularToFirstSegment",e.ParallelOffset="ParallelOffset",e.OffsetOpposite="OffsetOpposite",e.OffsetSame="OffsetSame",e.CircleWithArc="CircleWithArc",e.DoubleJog="DoubleJog",e.PerpendicularOffset="PerpendicularOffset",e.LineExcludingLastSegment="LineExcludingLastSegment",e.MultivertexArrow="MultivertexArrow",e.CrossedArrow="CrossedArrow",e.ChevronArrow="ChevronArrow",e.ChevronArrowOffset="ChevronArrowOffset",e.PartialFirstSegment="PartialFirstSegment",e.Arch="Arch",e.CurvedParallelTicks="CurvedParallelTicks",e.Arc90Degrees="Arc90Degrees",e.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",e.ConcentricCircles="ConcentricCircles",e.DoubleJogArrow="DoubleJogArrow",e.LinkedChevrons="LinkedChevrons",e.SegmentThenHalfCircle="SegmentThenHalfCircle",e.LineWithStraightTicks="LineWithStraightTicks",e.DoubleCurve="DoubleCurve",e.ParallelWithTicksByWidth="ParallelWithTicksByWidth",e.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(C||(C={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square",e.TrueBuffer="TrueBuffer"}(S||(S={})),function(e){e.ClosePath="ClosePath",e.ConvexHull="ConvexHull",e.RectangularBox="RectangularBox"}(E||(E={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(M||(M={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square"}(A||(A={})),function(e){e.Fast="Fast",e.Accurate="Accurate"}(R||(R={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(O||(O={})),function(e){e.Sinus="Sinus",e.Square="Square",e.Triangle="Triangle",e.Random="Random"}(P||(P={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Force=2]="Force"}(I||(I={})),function(e){e[e.Buffered=0]="Buffered",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.AlongLine=3]="AlongLine"}(L||(L={})),function(e){e[e.Linear=0]="Linear",e[e.Rectangular=1]="Rectangular",e[e.Circular=2]="Circular",e[e.Buffered=3]="Buffered"}(D||(D={})),function(e){e[e.Discrete=0]="Discrete",e[e.Continuous=1]="Continuous"}(N||(N={})),function(e){e[e.AcrossLine=0]="AcrossLine",e[e.AlongLine=1]="AlongLine"}(F||(F={})),function(e){e[e.Auto=0]="Auto",e[e.Clockwise=1]="Clockwise",e[e.Counterclockwise=2]="Counterclockwise"}(U||(U={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justify=3]="Justify"}(k||(k={})),function(e){e[e.Base=0]="Base",e[e.MidPoint=1]="MidPoint",e[e.ThreePoint=2]="ThreePoint",e[e.FourPoint=3]="FourPoint",e[e.Underline=4]="Underline",e[e.CircularCW=5]="CircularCW",e[e.CircularCCW=6]="CircularCCW"}(z||(z={})),function(e){e.Butt="Butt",e.Round="Round",e.Square="Square"}(B||(B={})),function(e){e.NoConstraint="NoConstraint",e.HalfPattern="HalfPattern",e.HalfGap="HalfGap",e.FullPattern="FullPattern",e.FullGap="FullGap",e.Custom="Custom"}(V||(V={})),function(e){e[e.None=-1]="None",e[e.Custom=0]="Custom",e[e.Circle=1]="Circle",e[e.OpenArrow=2]="OpenArrow",e[e.ClosedArrow=3]="ClosedArrow",e[e.Diamond=4]="Diamond"}(H||(H={})),function(e){e[e.ExtraLeading=0]="ExtraLeading",e[e.Multiple=1]="Multiple",e[e.Exact=2]="Exact"}(G||(G={})),function(e){e.Bevel="Bevel",e.Round="Round",e.Miter="Miter"}(j||(j={})),function(e){e[e.Default=0]="Default",e[e.String=1]="String",e[e.Numeric=2]="Numeric"}(Z||(Z={})),function(e){e[e.InsidePolygon=0]="InsidePolygon",e[e.PolygonCenter=1]="PolygonCenter",e[e.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(q||(q={})),function(e){e[e.Tint=0]="Tint",e[e.Replace=1]="Replace",e[e.Multiply=2]="Multiply"}(W||(W={})),function(e){e[e.ClipAtBoundary=0]="ClipAtBoundary",e[e.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",e[e.DoNotTouchBoundary=2]="DoNotTouchBoundary",e[e.DoNotClip=3]="DoNotClip"}($||($={})),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(Y||(Y={})),function(e){e.Fixed="Fixed",e.Random="Random",e.RandomFixedQuantity="RandomFixedQuantity"}(J||(J={})),function(e){e.LineMiddle="LineMiddle",e.LineBeginning="LineBeginning",e.LineEnd="LineEnd",e.SegmentMidpoint="SegmentMidpoint"}(X||(X={})),function(e){e.OnPolygon="OnPolygon",e.CenterOfMass="CenterOfMass",e.BoundingBoxCenter="BoundingBoxCenter"}(K||(K={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(Q||(Q={})),function(e){e[e.MarkerCenter=0]="MarkerCenter",e[e.MarkerBounds=1]="MarkerBounds"}(ee||(ee={})),function(e){e[e.None=0]="None",e[e.PropUniform=1]="PropUniform",e[e.PropNonuniform=2]="PropNonuniform",e[e.DifUniform=3]="DifUniform",e[e.DifNonuniform=4]="DifNonuniform"}(te||(te={})),function(e){e.Tube="Tube",e.Strip="Strip",e.Wall="Wall"}(ie||(ie={})),function(e){e[e.Random=0]="Random",e[e.Increasing=1]="Increasing",e[e.Decreasing=2]="Decreasing",e[e.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(re||(re={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(ne||(ne={})),function(e){e[e.Normal=0]="Normal",e[e.LowerCase=1]="LowerCase",e[e.Allcaps=2]="Allcaps"}(se||(se={})),function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(oe||(oe={})),function(e){e.Draft="Draft",e.Picture="Picture",e.Text="Text"}(ae||(ae={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Baseline=2]="Baseline",e[e.Bottom=3]="Bottom"}(le||(le={})),function(e){e[e.Right=0]="Right",e[e.Upright=1]="Upright"}(ce||(ce={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(ue||(ue={})),function(e){e[e.Calm=0]="Calm",e[e.Rippled=1]="Rippled",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate"}(he||(he={}))},60789:(e,t,i)=>{i.d(t,{$Z:()=>M,BX:()=>S,Cc:()=>b,E_:()=>l,F:()=>A,FG:()=>O,H1:()=>a,J0:()=>g,JW:()=>L,Lb:()=>Y,Le:()=>D,Lw:()=>$,Mk:()=>F,Ml:()=>j,NA:()=>y,On:()=>T,Qf:()=>P,RI:()=>w,T2:()=>k,TB:()=>I,TT:()=>c,Ts:()=>H,Ul:()=>G,W7:()=>E,X_:()=>R,ap:()=>V,be:()=>h,cO:()=>v,dT:()=>U,e0:()=>B,gJ:()=>m,hU:()=>z,hf:()=>n,k5:()=>f,nn:()=>s,oY:()=>u,pJ:()=>x,vn:()=>_,wi:()=>C,yL:()=>p,yl:()=>N,zL:()=>d});var r=i(42512);function n(e,t,i,r){return function(e){return"function"==typeof e}(e)?e(t,i,r):e}function s(e){return[e.r,e.g,e.b,e.a]}function o(e){let t=e.length;for(;t--;)if(!" /-,\n".includes(e.charAt(t)))return!1;return!0}function a(e,t){const i=[];let r=0,n=-1;do{if(n=e.indexOf("[",r),n>=r){if(n>r){const t=e.slice(r,n);i.push([t,null,o(t)])}if(r=n+1,n=e.indexOf("]",r),n>=r){if(n>r){const s=t[e.slice(r,n)];s&&i.push([null,s,!1])}r=n+1}}}while(-1!==n);if(r<e.length){const t=e.slice(r);i.push([t,null,o(t)])}return i}function l(e,t,i,r){let n="",s=null;for(const r of t){const[t,o,a]=r;if(t)a?s=t:(s&&(n+=s,s=null),n+=t);else{let t=o;null!=i&&(t=H(o,i));const r=e.attributes[t];r&&(s&&(n+=s,s=null),n+=r)}}return function(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}(n,r)}function c(e,t,i,r,n,s,o=!0){const a=t/n,l=i/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let i=0;i<s;i++)for(let h=0;h<n;h++){const d=4*(h+(o?s-i-1:i)*n);let p=0,f=0,m=0,g=0,y=0,_=0,v=0;const b=(i+.5)*l;for(let r=Math.floor(i*l);r<(i+1)*l;r++){const i=Math.abs(b-(r+.5))/u,n=(h+.5)*a,s=i*i;for(let i=Math.floor(h*a);i<(h+1)*a;i++){let o=Math.abs(n-(i+.5))/c;const a=Math.sqrt(s+o*o);a>=-1&&a<=1&&(p=2*a*a*a-3*a*a+1,p>0&&(o=4*(i+r*t),v+=p*e[o+3],m+=p,e[o+3]<255&&(p=p*e[o+3]/250),g+=p*e[o],y+=p*e[o+1],_+=p*e[o+2],f+=p))}}r[d]=g/f,r[d+1]=y/f,r[d+2]=_/f,r[d+3]=v/m}}function u(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function h(e){return e.data?.symbol??null}function d(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function p(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function f(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)}function m(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}const g=(e,t=0)=>null==e||isNaN(e)?t:e,y=(e,t)=>null!=e?e:t,_=(e,t)=>e??t,v=e=>e.tintColor?u(e.tintColor):[255,255,255,1],b=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function w(){return Promise.all([i.e(89067),i.e(36053)]).then(i.bind(i,8923))}function x(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function T(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function C(e){let t="normal",i="normal";if(e){const r=e.toLowerCase();r.includes("italic")?t="italic":r.includes("oblique")&&(t="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:t,weight:i}}function S(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function E(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=E(t);if(null!=e)return e}break;case"CIMTextSymbol":return E(e.symbol);case"CIMSolidFill":return e.color}return null}function M(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const e of t){const t=M(e);if(null!=t)return t}break}case"CIMTextSymbol":return M(e.symbol);case"CIMSolidStroke":return e.color}}function A(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=A(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return A(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function R(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function O(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function P(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}const I=e=>e.includes("data:image/svg+xml");function L(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function D(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}function N(e,t,i,r,n,s,o=!0){const{infos:a}=s;let l=1,c=0,u=0,h=0,d=1;for(const{absoluteAnchorPoint:e,offsetX:t,offsetY:i,rotation:r,size:n,frameHeight:s,rotateClockWise:p,scaleSymbolsProportionally:f}of a)d=e?1:l,u=q(t,i,c,d,u),h=Z(t,i,c,d,h),s&&(f||o)&&(l*=n/s),c=W(r,p,c);const p=q(r,n,c,d,u),f=Z(r,n,c,d,h);return{size:e*l,rotation:W(t,i,c),offsetX:p,offsetY:f}}function F(e){if(null==e)return!1;if(Array.isArray(e))return e.every((e=>F(e)));switch(typeof e){case"string":return!!e;case"number":return!isNaN(e)}}function U(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...r.m[t]];const i=r.E[e];if(!i)throw new Error(`InternalError: default value for type ${e}.`);return i[t]}function k(e){return"string"==typeof e?function(e){return e.split(" ").map((e=>Number(e)))}(e):e}function z(e){return e?.dashTemplate&&(e.dashTemplate=k(e.dashTemplate)),e}function B(e){if(null==e)return"Normal";switch(e.type){case"CIMTextSymbol":return e.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const t=e.symbolLayers;if(!t)return"Normal";for(const e of t)if("CIMVectorMarker"===e.type)return B(e)}break;case"CIMVectorMarker":{const t=e.markerGraphics;if(!t)return"Normal";for(const e of t)if(e.symbol)return B(e.symbol)}}return"Normal"}function V(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const i of e.symbolLayers)if(i)switch(i.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=i.size??r.E.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const i of e.symbolLayers)if(i)switch(i.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=i.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(i.markerPlacement&&m(i.markerPlacement)){const e=i.size??r.E.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=i.height;null!=e&&e>t&&(t=e)}}return t}}}function H(e,t){if(null!==t){const i=t.get(e);return i?i.name:e}return e}function G(e){return e.map((e=>({...e,propertyName:D(e.propertyName)})))}function j(e){const t={};for(const i in e){const r=e[i];t[D(i)]=r}return t}function Z(e,t,i,r,n){const s=i*Math.PI/180;if(s){const i=Math.cos(s);return(Math.sin(s)*e+i*t)*r+n}return t*r+n}function q(e,t,i,r,n){const s=i*Math.PI/180;return s?(Math.cos(s)*e-Math.sin(s)*t)*r+n:e*r+n}function W(e,t,i){return t?i-e:i+e}function $(e,t,i){const r="Color"===i||"TintColor"===i||"ToColor"===i,n="Rotation"===i||"Angle"===i||"ToRotation"===i;let s=t[D(i)];if(null!=s&&(r?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:n&&(s*=Math.PI/180)),null==s&&(s=U(t.type,i.toLowerCase()),null!=s&&(r?s=[s[0]/255,s[1]/255,s[2]/255,s[3]]:n&&(s*=Math.PI/180))),null!=t.primitiveName){const o=e[t.primitiveName];if(null!=o){const e=o[i];null==e||("string"==typeof e||"number"==typeof e||Array.isArray(e)?(s=e,null!=s&&(r?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:n&&(s*=Math.PI/180))):(s={valueExpressionInfo:e,defaultValue:s},null!=s&&(r?s={type:"Process",op:"ArcadeColor",value:s}:n&&(s={type:"Process",op:"Divide",left:s,right:180/Math.PI}))))}}if(null==s)throw new Error(`Failed to derive a value or an expression for "${i}".`);return s}function Y(e,t){return Math.max(Math.min((e??t)/100,1),0)}},81713:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(36663),n=i(30936),s=i(82064),o=i(67134),a=i(95550),l=i(81977),c=(i(39994),i(13802),i(40266)),u=i(50264);let h=class extends s.Z{constructor(e){super(e),this.color=new n.Z([0,0,0,1]),this.extensionLength=0,this.size=(0,a.Wz)(1)}clone(){}cloneProperties(){return{color:(0,o.d9)(this.color),size:this.size,extensionLength:this.extensionLength}}};(0,r._)([(0,l.Cb)({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],h.prototype,"type",void 0),(0,r._)([(0,l.Cb)((0,u.a)({colorRequiredOnWrite:!0}))],h.prototype,"color",void 0),(0,r._)([(0,l.Cb)({...u.y,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],h.prototype,"extensionLength",void 0),(0,r._)([(0,l.Cb)(u.y)],h.prototype,"size",void 0),h=(0,r._)([(0,c.j)("esri.symbols.edges.Edges3D")],h);const d=h},25545:(e,t,i)=>{i.d(t,{Z:()=>c});var r,n=i(36663),s=(i(13802),i(39994),i(4157),i(70375),i(79438)),o=i(40266),a=i(81713);let l=r=class extends a.Z{constructor(e){super(e),this.type="solid"}clone(){return new r(this.cloneProperties())}};(0,n._)([(0,s.J)({solid:"solid"},{readOnly:!0})],l.prototype,"type",void 0),l=r=(0,n._)([(0,o.j)("esri.symbols.edges.SolidEdges3D")],l);const c=l},44874:(e,t,i)=>{i.d(t,{Z:()=>h});var r,n=i(81713),s=i(36663),o=(i(13802),i(39994),i(4157),i(70375),i(79438)),a=i(40266);let l=r=class extends n.Z{constructor(e){super(e),this.type="sketch"}clone(){return new r(this.cloneProperties())}};(0,s._)([(0,o.J)({sketch:"sketch"},{readOnly:!0})],l.prototype,"type",void 0),l=r=(0,s._)([(0,a.j)("esri.symbols.edges.SketchEdges3D")],l);const c=l;var u=i(25545);const h={types:{key:"type",base:n.Z,typeMap:{solid:u.Z,sketch:c}},json:{write:!0}}},32576:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(36663),n=i(82064),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};(0,r._)([(0,s.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.symbols.patterns.LinePattern3D")],a);const l=a},17615:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(36663),n=i(25709),s=i(81977),o=(i(39994),i(13802),i(4157),i(79438)),a=i(40266),l=i(32576);var c;const u=(0,n.w)()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let h=c=class extends l.Z{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new c(e)}};(0,r._)([(0,s.Cb)({type:["style"],json:{write:{isRequired:!0}}})],h.prototype,"type",void 0),(0,r._)([(0,o.J)(u),(0,s.Cb)({type:["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"],json:{write:{isRequired:!0}}})],h.prototype,"style",void 0),h=c=(0,r._)([(0,a.j)("esri.symbols.patterns.LineStylePattern3D")],h);const d=h},50126:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(36663),n=i(82064),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};(0,r._)([(0,s.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.symbols.patterns.Pattern3D")],a);const l=a},93935:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(36663),n=i(81977),s=(i(39994),i(13802),i(4157),i(40266)),o=i(50126);var a;let l=a=class extends o.Z{constructor(e){super(e),this.type="style",this.style="solid"}clone(){return new a({style:this.style})}};(0,r._)([(0,n.Cb)({type:["style"],json:{write:{isRequired:!0}}})],l.prototype,"type",void 0),(0,r._)([(0,n.Cb)({type:["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"],json:{read:!0,write:{isRequired:!0}}})],l.prototype,"style",void 0),l=a=(0,r._)([(0,s.j)("esri.symbols.patterns.StylePattern3D")],l);const c=l},42871:(e,t,i)=>{i.d(t,{D:()=>l,q:()=>a});var r=i(32576),n=i(17615),s=i(50126),o=i(93935);const a={types:{key:"type",base:s.Z,typeMap:{style:o.Z}},json:{write:!0}},l={types:{key:"type",base:r.Z,typeMap:{style:n.Z}},json:{write:!0}}},74710:(e,t,i)=>{i.d(t,{Z:()=>b});var r,n=i(36663),s=i(25709),o=i(82064),a=i(61681),l=i(81977),c=(i(39994),i(13802),i(4157),i(34248)),u=i(40266),h=i(39835),d=i(14845);let p=r=class extends o.Z{constructor(e){super(e)}async collectRequiredFields(e,t){return(0,d.io)(e,t,this.expression)}clone(){return new r({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};(0,n._)([(0,l.Cb)({type:String,json:{write:{isRequired:!0}}})],p.prototype,"expression",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],p.prototype,"title",void 0),p=r=(0,n._)([(0,u.j)("esri.symbols.support.FeatureExpressionInfo")],p);const f=p;var m,g=i(91478);const y=(0,s.w)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),_=new s.X({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let v=m=class extends o.Z{constructor(e){super(e),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):null!=e||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new m({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&(0,a._W)(this.featureExpressionInfo,e.featureExpressionInfo)}};(0,n._)([(0,l.Cb)({type:f,json:{write:!0}})],v.prototype,"featureExpressionInfo",void 0),(0,n._)([(0,c.r)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],v.prototype,"readFeatureExpressionInfo",null),(0,n._)([(0,h.c)("featureExpressionInfo",{featureExpressionInfo:{type:f},"featureExpression.value":{type:[0]}})],v.prototype,"writeFeatureExpressionInfo",null),(0,n._)([(0,l.Cb)({type:y.apiValues,nonNullable:!0,json:{type:y.jsonValues,read:y.read,write:{writer:y.write,isRequired:!0}}})],v.prototype,"mode",null),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],v.prototype,"offset",void 0),(0,n._)([(0,l.Cb)({type:g.f9,json:{type:String,read:_.read,write:_.write}})],v.prototype,"unit",null),v=m=(0,n._)([(0,u.j)("esri.symbols.support.ElevationInfo")],v);const b=v},52285:(e,t,i)=>{i.d(t,{S:()=>g,b:()=>m});var r,n=i(36663),s=i(25709),o=i(82064),a=i(3466),l=i(81977),c=(i(39994),i(13802),i(4157),i(79438)),u=i(34248),h=i(40266),d=i(39835),p=i(16641);const f=(0,s.w)()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let m=r=class extends o.Z{constructor(e){super(e)}readHref(e,t,i){return e?(0,p.f)(e,i):t.dataURI}writeHref(e,t,i,r){e&&((0,a.HK)(e)?t.dataURI=e:(t.href=(0,p.t)(e,r),(0,a.YP)(t.href)&&(t.href=(0,a.Fv)(t.href))))}clone(){return new r({href:this.href,primitive:this.primitive})}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],m.prototype,"href",void 0),(0,n._)([(0,u.r)("href")],m.prototype,"readHref",null),(0,n._)([(0,d.c)("href",{href:{type:String},dataURI:{type:String}})],m.prototype,"writeHref",null),(0,n._)([(0,c.J)(f)],m.prototype,"primitive",void 0),m=r=(0,n._)([(0,h.j)("esri.symbols.support.IconSymbol3DLayerResource")],m);const g="circle"},4125:(e,t,i)=>{i.d(t,{S:()=>p,k:()=>d});var r,n=i(36663),s=i(25709),o=i(82064),a=i(81977),l=(i(39994),i(13802),i(4157),i(79438)),c=i(40266),u=i(16641);const h=(0,s.w)()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let d=r=class extends o.Z{clone(){return new r({href:this.href,primitive:this.primitive})}};(0,n._)([(0,a.Cb)({type:String,json:{read:u.r,write:u.w}})],d.prototype,"href",void 0),(0,n._)([(0,l.J)(h)],d.prototype,"primitive",void 0),d=r=(0,n._)([(0,c.j)("esri.symbols.support.ObjectSymbol3DLayerResource")],d);const p="sphere"},85068:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(74396),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266)),l=i(93968);let c=r=class extends s.Z{constructor(e){super(e),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new r({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};(0,n._)([(0,o.Cb)({type:String})],c.prototype,"name",void 0),(0,n._)([(0,o.Cb)({type:String})],c.prototype,"styleUrl",void 0),(0,n._)([(0,o.Cb)({type:String})],c.prototype,"styleName",void 0),(0,n._)([(0,o.Cb)({type:l.Z})],c.prototype,"portal",void 0),c=r=(0,n._)([(0,a.j)("esri.symbols.support.StyleOrigin")],c);const u=c},37939:(e,t,i)=>{i.d(t,{e:()=>l});var r,n=i(36663),s=i(74396),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266));let l=r=class extends s.Z{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new r({x:this.x,y:this.y})}};(0,n._)([(0,o.Cb)({type:Number})],l.prototype,"x",void 0),(0,n._)([(0,o.Cb)({type:Number})],l.prototype,"y",void 0),l=r=(0,n._)([(0,a.j)("esri.symbols.support.Symbol3DAnchorPosition2D")],l)},57403:(e,t,i)=>{i.d(t,{b:()=>u});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266)),l=i(81095),c=i(50264);let u=r=class extends s.Z{constructor(e){super(e),this.color=null,this.emissiveFactor=null}clone(){const e={color:this.color?.clone()??null,emissiveFactor:this.emissiveFactor?(0,l.d9)(this.emissiveFactor):null};return new r(e)}};(0,n._)([(0,o.Cb)((0,c.a)())],u.prototype,"color",void 0),(0,n._)([(0,o.Cb)({type:[Number],json:{write:!1}})],u.prototype,"emissiveFactor",void 0),u=r=(0,n._)([(0,a.j)("esri.symbols.support.Symbol3DMaterial")],u)},2571:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266)),l=i(50264);let c=r=class extends s.Z{constructor(e){super(e),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new r({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};(0,n._)([(0,o.Cb)({...l.y,json:{write:{isRequired:!0}}})],c.prototype,"screenLength",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,json:{write:!0,default:0}})],c.prototype,"minWorldLength",void 0),(0,n._)([(0,o.Cb)({type:Number,json:{write:!0}})],c.prototype,"maxWorldLength",void 0),c=r=(0,n._)([(0,a.j)("esri.symbols.support.Symbol3DVerticalOffset")],c);const u=c},3032:(e,t,i)=>{i.d(t,{p:()=>l});var r,n=i(36663),s=i(74396),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266));let l=r=class extends s.Z{constructor(){super(...arguments),this.url=""}clone(){return new r({url:this.url})}};(0,n._)([(0,o.Cb)({type:String})],l.prototype,"url",void 0),l=r=(0,n._)([(0,a.j)("esri.symbols.support.Thumbnail")],l)},86342:(e,t,i)=>{i.d(t,{ix:()=>n,l9:()=>s,rx:()=>o});var r=i(30936);const n=new r.Z("white"),s=new r.Z([255,255,255,0]);function o(e){return 0===e.r&&0===e.g&&0===e.b}},5310:(e,t,i)=>{i.d(t,{CJ:()=>c,G:()=>p,Rz:()=>h,js:()=>d,kD:()=>m,mW:()=>f,xA:()=>l,z3:()=>u});i(39994);var r=i(43411),n=i(15498),s=i(1759),o=i(27624),a=i(86094);const l=s.Z.fromJSON(a.I4),c=n.Z.fromJSON(a.ET),u=r.Z.fromJSON(a.lF),h=o.Z.fromJSON(a.qP);function d(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return c;case"polygon":case"extent":return u}return null}const p=s.Z.fromJSON(a.eG),f=n.Z.fromJSON(a.wW),m=r.Z.fromJSON(a.lj)},64266:(e,t,i)=>{i.d(t,{av:()=>b,iZ:()=>v,qN:()=>w});var r=i(30936),n=i(41831),s=(i(39994),i(95550)),o=i(88283),a=i(62063),l=i(60076),c=i(83849),u=i(60378),h=i(57770),d=i(25545),p=i(5310),f=i(86094);const m=u.Z.fromSimpleMarkerSymbol(p.xA),g=a.Z.fromSimpleLineSymbol(p.CJ),y=h.Z.fromSimpleFillSymbol(p.z3),_=new c.Z({symbolLayers:new n.Z([new o.Z({material:{color:f.SQ},edges:new d.Z({size:(0,s.Wz)(1),color:new r.Z(f.X1)})})])}),v=new a.Z({symbolLayers:new n.Z([new l.Z({material:{color:new r.Z([0,0,0])},size:(0,s.Wz)(1)})])}),b=new h.Z({symbolLayers:new n.Z([new o.Z({outline:{color:new r.Z([0,0,0]),size:(0,s.Wz)(1)}})])});function w(e){if(null==e)return null;switch(e.type){case"mesh":return _;case"point":case"multipoint":return m;case"polyline":return g;case"polygon":case"extent":return y}return null}},86094:(e,t,i)=>{i.d(t,{ET:()=>o,I4:()=>s,SQ:()=>r,X1:()=>n,eG:()=>c,lF:()=>a,lj:()=>h,qP:()=>l,wW:()=>u});const r=[252,146,31,255],n=[153,153,153,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:r,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:r},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},c={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},u={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},h={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},83313:(e,t,i)=>{i.d(t,{cW:()=>l,im:()=>d,vX:()=>c});var r=i(70375),n=i(54957),s=i(27948),o=i(37193),a=i(9539);function l(e,t,i,r){const n=h(e,{},{context:r,isLabelSymbol:!1});null!=n&&(t[i]=n)}function c(e,t,i,r){const n=h(e,{},{context:r,isLabelSymbol:!0});null!=n&&(t[i]=n)}function u(e){return(0,a.dU)(e)||e instanceof s.Z}function h(e,t,i){if(null==e)return null;const{context:s,isLabelSymbol:a}=i,l=s?.origin,c=s?.messages;if("web-scene"===l&&!u(e)){const i=(0,o.q)(e,{retainCIM:!0,hasLabelingContext:a});return null!=i.symbol?i.symbol.write(t,s):(c?.push(new r.Z("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:s,error:i.error})),null)}return(0,n.A2)(s?.layer)&&function(e){return"polygon-3d"===e?.type||"line-3d"===e?.type}(e)?(c?.push(new r.Z("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported on layers of type '${s?.layer?.declaredClass}'.`,{symbol:e,context:s})),null):("web-map"===l||"portal-item"===l&&!(0,n.A2)(s?.layer))&&u(e)?(c?.push(new r.Z("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:s})),null):e.write(t,s)}function d(e,t){return(0,a.S9)(e,null,t)}},4142:(e,t,i)=>{i.d(t,{J:()=>r,k:()=>n});const r=["begin","end","begin-end"],n=["arrow","circle","square","diamond","cross","x"]},50264:(e,t,i)=>{i.d(t,{a:()=>c,y:()=>u});var r=i(30936),n=i(95550),s=i(7283),o=i(78621);function a(e,t){const i=null!=t.transparency?(0,o.b)(t.transparency):1,n=t.color;return n&&Array.isArray(n)?new r.Z([n[0]||0,n[1]||0,n[2]||0,i]):null}function l(e,t){t.color=e.toJSON().slice(0,3);const i=(0,o.a)(e.a);0!==i&&(t.transparency=i)}function c(e){return{type:r.Z,nonNullable:e?.nonNullable,json:{type:[s.z8],default:null,read:{source:["color","transparency"],reader:a},write:{target:{color:{type:[s.z8],isRequired:e?.colorRequiredOnWrite},transparency:{type:s.z8}},writer:l}}}}const u={type:Number,cast:n.t_,json:{write:!0}}},97207:(e,t,i)=>{i.d(t,{wm:()=>v,n2:()=>d,KV:()=>p,EJ:()=>g,v9:()=>f});var r=i(66341),n=i(70375),s=i(39994),o=i(78668),a=i(3466),l=i(93968),c=i(58874);const u=new Map;function h(e,t,i){const r=null!=t.portal?t.portal:l.Z.getDefault();let s;const o=`${r.url} - ${r.user?.username} - ${e}`,a=u.get(o);if(a)return a;const h=function(e,t,i){return t.load(i).then((()=>{const r=new c.Z({disableExtraQuery:!0,query:`owner:${y} AND type:${_} AND typekeywords:"${e}"`});return t.queryItems(r,i)})).then((({results:t})=>{let r=null;const s=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t){const t=e.typeKeywords?.some((e=>e.toLowerCase()===s));if(t&&e.type===_&&e.owner===y){r=e;break}}if(!r)throw new n.Z("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return r.load(i)}))}(e,r,i).then((e=>(s=e,e.fetchData()))).then((t=>({data:t,baseUrl:s.itemUrl??"",styleName:e})));return u.set(o,h),h}function d(e,t,i){return null!=e?.styleUrl?async function(e,t){try{return{data:(await g(e,t)).data,baseUrl:(0,a.Yd)(e),styleUrl:e}}catch(e){return(0,o.r9)(e),null}}(e.styleUrl,i):null!=e?.styleName?h(e.styleName,t,i):Promise.reject(new n.Z("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function p(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function f(e,t){for(const i of t)switch(i){case"cim":if(e.cimRef)return{format:i,url:encodeURI(e.cimRef)};break;case"web-gltf-basisu":{const t=m(e,"gltf_basisu");if(t)return{format:i,url:t};break}case"web-gltf":{const t=m(e,"gltf");if(t)return{format:i,url:t};break}case"web":{const t=m(e,"gltf");if(t)return{format:"web-gltf",url:t};if(e.webRef)return{format:i,url:encodeURI(e.webRef)};break}}}function m(e,t){if(!(0,s.Z)("enable-feature:force-wosr"))return e.formatInfos?.find((e=>e.type===t))?.href}function g(e,t){const i={responseType:"json",query:{f:"json"},...t};return(0,r.Z)((0,a.Fv)(e),i)}const y="esri_en",_="Style",v="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},37193:(e,t,i)=>{i.d(t,{K:()=>_,q:()=>v});var r=i(70375),n=i(63295),s=i(62063),o=i(83849),a=i(86036),l=i(60378),c=i(57770),u=i(43411),h=i(15498),d=i(1759),p=i(27624),f=i(27948),m=i(64266),g=i(9539);const y="#useCIMFallbackSymbology()",_={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function v(e,t=_){if(!e)return{symbol:null};const{retainId:i=_.retainId,ignoreDrivers:v=_.ignoreDrivers,hasLabelingContext:b=_.hasLabelingContext,retainCIM:w=_.retainCIM,cimFallbackEnabled:x=_.cimFallbackEnabled}=t;let T=null;if((0,g.dU)(e)||e instanceof f.Z)T=e.clone();else if("cim"===e.type){const i=e.data?.symbol?.type;switch(i){case"CIMPointSymbol":T=w?e.clone():l.Z.fromCIMSymbol(e);break;case"CIMLineSymbol":x&&(T=m.iZ.clone(),t?.logWarning?.(y,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":x&&(T=m.av.clone(),t?.logWarning?.(y,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!T)return{error:new r.Z("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${i||"unknown"}' is unsupported in 3D`,{symbol:e})}}else if(e instanceof h.Z)T=s.Z.fromSimpleLineSymbol(e);else if(e instanceof d.Z)T=l.Z.fromSimpleMarkerSymbol(e);else if(e instanceof a.Z)T=l.Z.fromPictureMarkerSymbol(e);else if(e instanceof u.Z)T=t.geometryType&&"mesh"===t.geometryType?o.Z.fromSimpleFillSymbol(e):c.Z.fromSimpleFillSymbol(e);else{if(!(e instanceof p.Z))return{error:new r.Z("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};T=b?n.Z.fromTextSymbol(e):l.Z.fromTextSymbol(e)}return i&&T&&"cim"!==T.type&&(T.id=e.id),!v||"cim"===T.type||T instanceof f.Z||T.symbolLayers.forEach((e=>e.ignoreDrivers=!0)),{symbol:T}}},19049:(e,t,i)=>{i.d(t,{$K:()=>s,Hc:()=>u,KW:()=>h,Uz:()=>c,w2:()=>d});i(39994);var r=i(81095),n=i(37116);function s(e,{isPrimitive:t,width:i,depth:n,height:s}){const o=t?10:1;if(null==i&&null==s&&null==n)return[o*e[0],o*e[1],o*e[2]];const a=(0,r.al)(i,n,s);let l;for(let t=0;t<3;t++){const i=a[t];if(null!=i){l=i/e[t];break}}for(let t=0;t<3;t++)null==a[t]&&(a[t]=e[t]*l);return a}const o=(0,n.al)(-.5,-.5,-.5,.5,.5,.5),a=(0,n.al)(-.5,-.5,0,.5,.5,1),l=(0,n.al)(-.5,-.5,0,.5,.5,.5);function c(e){switch(e){case"sphere":case"cube":case"diamond":return o;case"cylinder":case"cone":case"inverted-cone":return a;case"tetrahedron":return l;default:return}}const u=["butt","square","round"],h=[...u,"none"],d=["miter","bevel","round"]},63659:(e,t,i)=>{i.d(t,{Ck:()=>l,JT:()=>s,Nj:()=>u,c9:()=>h,g6:()=>o,vC:()=>a,x0:()=>c});var r=i(19431),n=i(7283);const s=["none","underline","line-through"],o=["normal","italic","oblique"],a=["normal","lighter","bold","bolder"],l={type:Number,cast:e=>{const t=(0,n.q9)(e);return 0===t?1:(0,r.uZ)(t,.1,4)},nonNullable:!0},c={type:["left","right","center"],nonNullable:!0},u={type:["baseline","top","middle","bottom"],nonNullable:!0},h=8},9539:(e,t,i)=>{i.d(t,{se:()=>V,cT:()=>R,dU:()=>O,tY:()=>L,jY:()=>I,CR:()=>D,S9:()=>F,LB:()=>P,AH:()=>N,yK:()=>k,S6:()=>B,QT:()=>U,f_:()=>z});var r,n=i(7283),s=i(3593),o=i(62589),a=i(63295),l=i(62063),c=i(83849),u=i(36663),h=i(67134),d=i(95550),p=i(81977),f=(i(39994),i(13802),i(79438)),m=i(40266),g=i(7842),y=i(59551);let _=r=class extends g.Z{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&"string"!=typeof e&&null==e.imageData)return e;const n={};return e&&(n.url=e),t&&(n.outline=t),null!=i&&(n.width=(0,d.t_)(i)),null!=r&&(n.height=(0,d.t_)(r)),n}clone(){const e=new r({color:(0,h.d9)(this.color),height:this.height,outline:(0,h.d9)(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",(0,h.d9)(this.source)),e}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};(0,u._)([(0,f.J)({esriPFS:"picture-fill"},{readOnly:!0})],_.prototype,"type",void 0),(0,u._)([(0,p.Cb)(y.KA)],_.prototype,"url",void 0),(0,u._)([(0,p.Cb)({type:Number,json:{write:!0}})],_.prototype,"xscale",void 0),(0,u._)([(0,p.Cb)({type:Number,json:{write:!0}})],_.prototype,"yscale",void 0),(0,u._)([(0,p.Cb)({type:Number,cast:d.t_,json:{write:!0}})],_.prototype,"width",void 0),(0,u._)([(0,p.Cb)({type:Number,cast:d.t_,json:{write:!0}})],_.prototype,"height",void 0),(0,u._)([(0,p.Cb)({type:Number,cast:d.t_,json:{write:!0}})],_.prototype,"xoffset",void 0),(0,u._)([(0,p.Cb)({type:Number,cast:d.t_,json:{write:!0}})],_.prototype,"yoffset",void 0),(0,u._)([(0,p.Cb)(y.Ds)],_.prototype,"source",void 0),_=r=(0,u._)([(0,m.j)("esri.symbols.PictureFillSymbol")],_);const v=_;var b=i(86036),w=i(60378),x=i(57770),T=i(43411),C=i(15498),S=i(1759),E=i(18251),M=i(27624),A=i(27948);function R(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function O(e){switch(e?.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const P={base:E.Z,key:"type",typeMap:{"simple-fill":T.Z,"picture-fill":v,"picture-marker":b.Z,"simple-line":C.Z,"simple-marker":S.Z,text:M.Z,"label-3d":a.Z,"line-3d":l.Z,"mesh-3d":c.Z,"point-3d":w.Z,"polygon-3d":x.Z,"web-style":A.Z,cim:o.Z},errorContext:"symbol"},I=(E.Z,T.Z,o.Z,{base:E.Z,key:"type",typeMap:{"picture-marker":b.Z,"simple-marker":S.Z,"point-3d":w.Z,cim:o.Z},errorContext:"symbol"}),L={base:E.Z,key:"type",typeMap:{"simple-line":C.Z,"line-3d":l.Z,cim:o.Z},errorContext:"symbol"},D={base:E.Z,key:"type",typeMap:{"simple-fill":T.Z,"picture-fill":v,"polygon-3d":x.Z,cim:o.Z},errorContext:"symbol"},N={base:E.Z,key:"type",typeMap:{"picture-marker":b.Z,"simple-marker":S.Z,text:M.Z,"web-style":A.Z,cim:o.Z},errorContext:"symbol"},F=(0,s.d)({types:P}),U={base:E.Z,key:"type",typeMap:{"simple-fill":T.Z,"picture-fill":v,"picture-marker":b.Z,"simple-line":C.Z,"simple-marker":S.Z,text:M.Z,"line-3d":l.Z,"mesh-3d":c.Z,"point-3d":w.Z,"polygon-3d":x.Z,"web-style":A.Z,cim:o.Z},errorContext:"symbol"},k={base:E.Z,key:"type",typeMap:{text:M.Z,"label-3d":a.Z},errorContext:"symbol"},z=(E.Z,a.Z,l.Z,c.Z,w.Z,x.Z,A.Z,{base:E.Z,key:"type",typeMap:{"line-3d":l.Z,"mesh-3d":c.Z,"point-3d":w.Z,"polygon-3d":x.Z,"web-style":A.Z,cim:o.Z},errorContext:"symbol"}),B={base:E.Z,key:"type",typeMap:{"label-3d":a.Z},errorContext:"symbol"},V=(0,n.N7)(P)},91478:(e,t,i)=>{i.d(t,{Z7:()=>o,f9:()=>a,lt:()=>s});var r=i(7753),n=i(6923);function s(e){return!!e&&null!=n.a[e]}function o(e){return 1/(n.a[e]||1)}const a=function(){const e=Object.keys(n.a);return(0,r.Od)(e,"decimal-degrees"),e.sort(),e}()},59551:(e,t,i)=>{i.d(t,{Ds:()=>a,KA:()=>o});var r=i(3466),n=i(16641);function s(e,t){if(!(0,r.YP)(e)){const i=function(e){if(!e)return null;const{origin:t,layer:i}=e;if("service"!==t&&"portal-item"!==t)return null;const r=i?.type;return"feature"===r||"stream"===r?i.parsedUrl?.path:"map-image"===r||"tile"===r?e.url?.path:null}(t);if(i)return(0,r.v_)(i,"images",e)}return(0,n.f)(e,t)}const o={json:{read:{source:["imageData","url"],reader:function(e,t,i){return t.imageData?(0,r._l)({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):s(t.url,i)}},write:{writer(e,t,i,s){!function(e,t,i,s){if((0,r.HK)(e)){const o=(0,r.sJ)(e);if(!o)return;t.contentType=o.mediaType,t.imageData=o.data,i&&i.imageData===t.imageData&&i.url&&(0,n.w)(i.url,t,"url",s)}else(0,n.w)(e,t,"url",s)}(e,t,this.source,s)}}}},a={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=s(t.url,i)),r}}}}},74063:(e,t,i)=>{i.d(t,{h:()=>r});const r=["web-gltf","web","cim"]},88369:(e,t,i)=>{i.d(t,{Z:()=>L});var r=i(36663),n=i(82064),s=i(67134),o=i(81977),a=i(69236),l=i(34248),c=i(40266),u=i(39835);i(39994),i(13802),i(4157);let h=class extends n.Z{constructor(e){super(e),this.description=null,this.label=null,this.type=null}};(0,r._)([(0,o.Cb)({type:String,json:{write:!0}})],h.prototype,"description",void 0),(0,r._)([(0,o.Cb)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,r._)([(0,o.Cb)()],h.prototype,"type",void 0),h=(0,r._)([(0,c.j)("esri.tables.elements.AttributeTableElement")],h);const d=h;var p;let f=p=class extends d{constructor(e){super(e),this.displayType="auto",this.type="attachment"}clone(){return new p({description:this.description,displayType:this.displayType,label:this.label})}};(0,r._)([(0,o.Cb)({type:["auto"],json:{write:!0}})],f.prototype,"displayType",void 0),(0,r._)([(0,o.Cb)({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],f.prototype,"type",void 0),f=p=(0,r._)([(0,c.j)("esri.tables.elements.AttributeTableAttachmentElement")],f);const m=f;var g;let y=g=class extends d{constructor(e){super(e),this.fieldName=null,this.type="field"}clone(){return new g({description:this.description,fieldName:this.fieldName,label:this.label})}};(0,r._)([(0,o.Cb)({type:String,json:{write:!0}})],y.prototype,"fieldName",void 0),(0,r._)([(0,o.Cb)({type:String,json:{read:!1,write:!0}})],y.prototype,"type",void 0),y=g=(0,r._)([(0,c.j)("esri.tables.elements.AttributeTableFieldElement")],y);const _=y;var v,b=i(7283);let w=v=class extends d{constructor(e){super(e),this.relationshipId=null,this.type="relationship"}clone(){return new v({description:this.description,label:this.label,relationshipId:this.relationshipId})}};(0,r._)([(0,o.Cb)({type:Number,json:{write:!0}})],w.prototype,"relationshipId",void 0),(0,r._)([(0,o.Cb)({type:["relationship"],json:{read:!1,write:!0}})],w.prototype,"type",void 0),w=v=(0,r._)([(0,c.j)("esri.tables.elements.AttributeTableRelationshipElement")],w);const x=w;function T(e){return{typesWithGroup:{base:d,key:"type",typeMap:{attachment:m,field:_,group:e,relationship:x}},typesWithoutGroup:{base:d,key:"type",typeMap:{attachment:m,field:_,relationship:x}}}}function C(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>r[e.type].fromJSON(e)))}function S(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>e.toJSON()))}function E(e,t,i=!0){return e?e.map((e=>(0,b.N7)(i?t.typesWithGroup:t.typesWithoutGroup,e))):null}var M;let A=M=class extends d{constructor(e){super(e),this.elements=null,this.type="group"}castElements(e){return E(e,R,!1)}readElements(e,t){return C(t.attributeTableElements,R,!1)}writeElements(e,t){t.attributeTableElements=S(e,R,!1)}clone(){return new M({description:this.description,elements:(0,s.d9)(this.elements),label:this.label})}};(0,r._)([(0,o.Cb)({json:{write:!0}})],A.prototype,"elements",void 0),(0,r._)([(0,a.p)("elements")],A.prototype,"castElements",null),(0,r._)([(0,l.r)("elements",["attributeTableElements"])],A.prototype,"readElements",null),(0,r._)([(0,u.c)("elements")],A.prototype,"writeElements",null),(0,r._)([(0,o.Cb)({type:String,json:{read:!1,write:!0}})],A.prototype,"type",void 0),A=M=(0,r._)([(0,c.j)("esri.tables.elements.AttributeTableGroupElement")],A);const R=T(A);var O;const P=T(A);let I=O=class extends n.Z{constructor(e){super(e),this.elements=null,this.orderByFields=null}castElements(e){return E(e,P)}readElements(e,t){return C(t.attributeTableElements,P)}writeElements(e,t){t.attributeTableElements=S(e,P)}clone(){return new O({elements:(0,s.d9)(this.elements),orderByFields:this.orderByFields})}};(0,r._)([(0,o.Cb)({json:{write:!0}})],I.prototype,"elements",void 0),(0,r._)([(0,a.p)("elements")],I.prototype,"castElements",null),(0,r._)([(0,l.r)("elements",["attributeTableElements"])],I.prototype,"readElements",null),(0,r._)([(0,u.c)("elements")],I.prototype,"writeElements",null),(0,r._)([(0,o.Cb)({type:[Object],json:{write:!0}})],I.prototype,"orderByFields",void 0),I=O=(0,r._)([(0,c.j)("esri.tables.AttributeTableTemplate")],I);const L=I},49684:(e,t,i)=>{i.d(t,{Z:()=>p});var r,n=i(36663),s=i(82064),o=i(807),a=i(81977),l=(i(39994),i(13802),i(4157),i(34248)),c=i(40266),u=i(39835),h=i(97718);let d=r=class extends s.Z{static get allTime(){return f}static get empty(){return m}static fromArray(e){return new r({start:null!=e[0]?new Date(e[0]):e[0],end:null!=e[1]?new Date(e[1]):e[1]})}constructor(e){super(e),this.end=null,this.start=null}readEnd(e,t){return null!=t.end?new Date(t.end):null}writeEnd(e,t){t.end=e?.getTime()??null}get isAllTime(){return this.equals(r.allTime)}get isEmpty(){return this.equals(r.empty)}readStart(e,t){return null!=t.start?new Date(t.start):null}writeStart(e,t){t.start=e?.getTime()??null}clone(){return new r({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=this.start?.getTime()??this.start,i=this.end?.getTime()??this.end,r=e.start?.getTime()??e.start,n=e.end?.getTime()??e.end;return t===r&&i===n}expandTo(e,t=h.By){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=(0,o.JE)(i,e,t));let n=this.end;if(n){const i=(0,o.JE)(n,e,t);n=n.getTime()===i.getTime()?i:(0,o.Nm)(i,1,e,t)}return new r({start:i,end:n})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return r.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=this.start?.getTime()??-1/0,i=this.end?.getTime()??1/0,n=e.start?.getTime()??-1/0,s=e.end?.getTime()??1/0;let o,a;return n>=t&&n<=i?o=n:t>=n&&t<=s&&(o=t),i>=n&&i<=s?a=i:s>=t&&s<=i&&(a=s),null==o||null==a||isNaN(o)||isNaN(a)?r.empty:new r({start:o===-1/0?null:new Date(o),end:a===1/0?null:new Date(a)})}offset(e,t,i=h.By){if(this.isEmpty||this.isAllTime)return this.clone();const n=new r,{start:s,end:a}=this;return null!=s&&(n.start=(0,o.Nm)(s,e,t,i)),null!=a&&(n.end=(0,o.Nm)(a,e,t,i)),n}toArray(){return this.isEmpty?[void 0,void 0]:[this.start?.getTime()??null,this.end?.getTime()??null]}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return f.clone();const t=null!=this.start&&null!=e.start?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=null!=this.end&&null!=e.end?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new r({start:t,end:i})}};(0,n._)([(0,a.Cb)({type:Date,json:{write:{allowNull:!0}}})],d.prototype,"end",void 0),(0,n._)([(0,l.r)("end")],d.prototype,"readEnd",null),(0,n._)([(0,u.c)("end")],d.prototype,"writeEnd",null),(0,n._)([(0,a.Cb)({readOnly:!0,json:{read:!1}})],d.prototype,"isAllTime",null),(0,n._)([(0,a.Cb)({readOnly:!0,json:{read:!1}})],d.prototype,"isEmpty",null),(0,n._)([(0,a.Cb)({type:Date,json:{write:{allowNull:!0}}})],d.prototype,"start",void 0),(0,n._)([(0,l.r)("start")],d.prototype,"readStart",null),(0,n._)([(0,u.c)("start")],d.prototype,"writeStart",null),d=r=(0,n._)([(0,c.j)("esri.time.TimeExtent")],d);const p=d,f=new d,m=new d({start:void 0,end:void 0})},52193:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(36663),n=i(41151),s=i(82064),o=i(807),a=i(81977),l=(i(39994),i(13802),i(4157),i(79438)),c=i(40266),u=i(80680);let h=class extends(n.Z.ClonableMixin(s.Z)){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return(0,o.rJ)(this.value,this.unit,"milliseconds")}};(0,r._)([(0,l.J)(u.v,{nonNullable:!0})],h.prototype,"unit",void 0),(0,r._)([(0,a.Cb)({type:Number,json:{write:!0},nonNullable:!0})],h.prototype,"value",void 0),h=(0,r._)([(0,c.j)("esri.time.TimeInterval")],h);const d=h},97718:(e,t,i)=>{i.d(t,{By:()=>r,_4:()=>n,o5:()=>o,pt:()=>s});const r="system",n="unknown",s="UTC",o=Intl.DateTimeFormat().resolvedOptions().timeZone},72559:(e,t,i)=>{i.d(t,{Jv:()=>a,Np:()=>l,Do:()=>c,mi:()=>o});var r=i(97718);const n=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);var s=i(17126);function o(e,t=!1){return{json:{read:{source:e,reader:(t,i)=>i[e]?a(i[e]):null},write:!!t&&{allowNull:!0,writer(t,i){i[e]=t?function(e){return{timeZoneIANA:e}}(t):null}}}}}function a(e,t=r.By){return e?function(e){return"timeZoneIANA"in e}(e)?e.timeZoneIANA:function(e,t=r.By){if(!e||!n.has(e.timeZone))return t;const i=n.get(e.timeZone);return function(e){return e.startsWith("UTC")}(e.timeZone)||e.respectsDaylightSaving?i:function(e){const t=s.ou.local().setZone(e),i=Math.min(t.set({month:1,day:1}).offset,t.set({month:5}).offset);return 0===i?"Etc/UTC":`Etc/GMT${s.Qf.instance(-i).formatOffset(0,"narrow")}`}(i)}(e,t):t}function l(e,t,i,n,s){if(t&&"date"===s)return{timeZone:r.pt,timeZoneName:void 0};const o=n.timeStyle||n.hour,a=i===r._4;return{timeZone:a?"timestamp-offset"===s?void 0:e??r.pt:i,timeZoneName:a&&o?"shortOffset":void 0}}function c(e){const t=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map((e=>e.toLowerCase())));return e===r.By||e===r._4||t.has(e.toLowerCase())||i.has(e.toLowerCase())}},43980:(e,t,i)=>{i.d(t,{JV:()=>c,Jp:()=>s,Px:()=>l,U8:()=>n,r9:()=>a});var r=i(66341);const n=(0,i(12173).dG)(),s=new Map,o=new Map;new Map;async function a(e,t,i){if(!e||!i)return!1;if(!t)return!0;const n=new URL(e).host;let o=s.get(n);if(!o){const t=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");o=(await(0,r.Z)(t,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return o===t}async function l(e,t,r=!1){if(!e||!t)return!0;const s=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),a=o.get(s)?.entries();if(a)for(const[e,o]of a)if(o.name===t){const t=!o.stack?.hasForwardEdits();if(!t&&r){const[{deleteForwardEdits:t},{default:r}]=await Promise.all([i.e(35320).then(i.bind(i,35320)),i.e(27124).then(i.bind(i,27124))]),a=await t(s,e,new r({sessionId:n,moment:o.moment}));return a.success&&o.stack?.clearForwardEdits(),a.success}return t}return!0}function c(e,t){if(!e)return!1;const i=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=o.get(i)?.entries();if(r)for(const[e,i]of r)if(i.name===t)return"edit"===i.lockType;return!1}},51118:(e,t,i)=>{i.d(t,{s:()=>o});var r=i(7753),n=i(31355),s=i(95024);class o extends n.Z{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get fadeTransitionEnabled(){return null!==this._fadeTransition}set fadeTransitionEnabled(e){!this._fadeTransition&&e?(this._fadeTransition=new s.n({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!e&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t?.trashDisplayObject(this)}get transforms(){return null==this._transforms&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(e){this._transitionables??=[],this._transitionables.push(e),this.requestRender()}removeTransitionable(e){e.endTransition(),this._transitionables&&(0,r.Od)(this._transitionables,e),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),e}fadeOut(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),e}endTransitions(){if(this._transitionables){for(const e of this._transitionables)e.endTransition();this.requestRender()}}beforeRender(e){this.transitionStep(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&(this._fadeTransition?.computedVisible??this.visible)&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){return this._transitionables?.some((e=>e.transitioning))??!1}transitionStep(e,t){if(this._transitionables)for(const i of this._transitionables)i.transitionStep(e,t)}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}},84342:(e,t,i)=>{var r,n;i.d(t,{H:()=>n,U:()=>r}),function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(n||(n={}))},95024:(e,t,i)=>{i.d(t,{n:()=>c});var r=i(36663),n=i(74396),s=i(39994),o=i(78668),a=i(81977),l=(i(13802),i(4157),i(40266));let c=class extends n.Z{constructor(e){super(e),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,this._fadeOutResolver?.(),this._fadeOutResolver=null,this._fadeInResolver=(0,o.hh)()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver=(0,o.hh)()),this._fadeOutResolver.promise}transitionStep(e,t){const i=(0,s.Z)("mapview-transitions-duration"),r=i?1/i:0;if(0===r)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const t=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===t)this.computedVisible=this.visible;else{const n=e*r;this.computedOpacity=i>t?Math.max(t,i-n):Math.min(t,i+n),this.computedVisible=this.computedOpacity>0}}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};(0,r._)([(0,a.Cb)()],c.prototype,"computedOpacity",void 0),(0,r._)([(0,a.Cb)()],c.prototype,"computedVisible",void 0),(0,r._)([(0,a.Cb)()],c.prototype,"opacity",void 0),(0,r._)([(0,a.Cb)()],c.prototype,"visible",void 0),(0,r._)([(0,a.Cb)()],c.prototype,"transitioning",null),(0,r._)([(0,a.Cb)()],c.prototype,"_fadeOutResolver",void 0),(0,r._)([(0,a.Cb)()],c.prototype,"_fadeInResolver",void 0),c=(0,r._)([(0,l.j)("esri.views.2d.engine.transitions.FadeTransition")],c)},93944:(e,t,i)=>{i.d(t,{DQ:()=>h,FM:()=>s,KU:()=>g,Of:()=>y,Or:()=>d,Px:()=>v,RD:()=>o,Wg:()=>w,Z0:()=>_,k3:()=>f,nF:()=>c,pK:()=>b,s5:()=>p,sX:()=>m,yF:()=>a});var r=i(38028),n=i(82584);const s=Number.POSITIVE_INFINITY,o=Math.PI,a=2*o,l=128/o,c=o/180,u=1/Math.LN2;function h(e,t){return(e%=t)>=0?e:e+t}function d(e){return h(e*l,256)}function p(e){return h(.7111111111111111*e,256)}function f(e){return Math.log(e)*u}function m(e,t,i){return e*(1-i)+t*i}function g(e){return 8+Math.max(16*(e-14),0)}function y(e,t,i){let r,n,s,o=0;for(const a of i){r=a.length;for(let i=1;i<r;++i)n=a[i-1],s=a[i],n.y>t!=s.y>t&&((s.x-n.x)*(t-n.y)-(s.y-n.y)*(e-n.x)>0?o++:o--)}return 0!==o}function _(e,t,i,n){let s,o,a,l;const c=n*n;for(const n of i){const i=n.length;if(!(i<2)){s=n[0].x,o=n[0].y;for(let u=1;u<i;++u){if(a=n[u].x,l=n[u].y,(0,r.Hu)(e,t,s,o,a,l)<c)return!0;s=a,o=l}}}return!1}function v(e,t,i,r,n,s,o){const a=Math.max(r,Math.min(t,s))-t,l=Math.max(n,Math.min(i,o))-i;return a*a+l*l<=e*e}function b(e,t){if(0===t||Number.isNaN(t))return e;const i=[],r=new n.E9(0,0),s=new n.E9(0,0),o=new n.E9(0,0);for(let a=0;a<e.length;a++){const l=e[a],c=[];for(let e=0;e<l.length;e++){const i=l[e-1],a=l[e],u=l[e+1];0===e?r.setCoords(0,0):r.assignSub(a,i).normalize().rightPerpendicular(),e===l.length-1?s.setCoords(0,0):s.assignSub(u,a).normalize().rightPerpendicular(),o.assignAdd(r,s).normalize();const h=o.x*s.x+o.y*s.y;0!==h&&o.scale(1/h),c.push(n.E9.add(a,o.scale(t)))}i.push(c)}return i}function w(e,t,i,r){const s=new n.E9(e[0],e[1]);if(s.scale(r),"viewport"===t){const e=-i*(Math.PI/180),t=Math.cos(e),r=Math.sin(e);s.rotate(t,r)}return s}},42938:(e,t,i)=>{i.d(t,{Z:()=>r});i(39994);class r{constructor(e){this._array=[],this._stride=e}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(e,t){return 65535&e|t<<16}static i8888to32(e,t,i,r){return 255&e|(255&t)<<8|(255&i)<<16|r<<24}static i8816to32(e,t,i){return 255&e|(255&t)<<8|i<<16}}},61741:(e,t,i)=>{i.d(t,{g:()=>s});var r=i(2509);function n(e,t){if(e.priority-t.priority)return e.priority-t.priority;const i=e.tile.key,r=t.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}class s{get running(){return this._running}constructor(e,t,i,r,n,s){this._visibleTiles=e,this._symbolRepository=t,this._createCollisionJob=i,this._assignTileSymbolsOpacity=r,this._symbolLayerSorter=n,this._isLayerVisible=s,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const t=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const t=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let t=0;t<e.length;t++){const i=e[t];for(let e=0;e<i.uniqueSymbols.length;e++){const t=i.uniqueSymbols[e];for(const e of t.tileSymbols)e.selectedForRendering=!1}}const t=[];let i=0,r=0;const s=this._isLayerVisible;const o=this._symbolLayerSorter;return{work:function(o){let a;const l=performance.now();for(;r<e.length;r++,i=0){const n=e[r],c=n.styleLayerUID;if(!s(c)){t[r]||(t[r]={styleLayerUID:c,symbols:[]});continue}t[r]=t[r]||{styleLayerUID:c,symbols:[]};const u=t[r];for(;i<n.uniqueSymbols.length;i++){if(a=n.uniqueSymbols[i],i%100==99&&performance.now()-l>o)return!1;let e=null,t=!1,r=!1;for(const i of a.tileSymbols)if(!r||!t){const n=i.tile;(!e||n.isCoverage||n.neededForCoverage&&!t)&&(e=i,(n.neededForCoverage||n.isCoverage)&&(r=!0),n.isCoverage&&(t=!0))}if(e.selectedForRendering=!0,r){u.symbols.push(e),a.show=!0;for(const e of a.parts)e.show=!0}else a.show=!1}}for(const e of t)e.symbols.sort(n);return!0},get sortedSymbols(){return t.sort(o)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,t=this._visibleTiles;let i=0;function r(t,i){for(const e of t.symbols.values())o(e,i);e(t,i);for(const e of t.childrenTiles)r(e,i)}return{work(e){const n=performance.now();for(;i<t.length;i++){if(performance.now()-n>e)return!1;const s=t[i];null==s.parentTile&&r(s,performance.now())}return!0}}}}function o(e,t){for(const i of e){const e=i.unique;for(const i of e.parts){const n=i.targetOpacity>.5?1:-1;i.startOpacity+=n*((t-i.startTime)/r.v7),i.startOpacity=Math.min(Math.max(i.startOpacity,0),1),i.startTime=t,i.targetOpacity=e.show&&i.show?1:0}}}},19390:(e,t,i)=>{i.d(t,{L:()=>n});var r=i(84099);class n{constructor(e,t,i){this.tileCoordRange=e,this._visibleTiles=t,this._createUnique=i,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,t){this._uniqueSymbolLayerArray=null;let i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));const n=new Map;if(t)for(const e of t)i.symbols.has(e)&&(n.set(e,i.symbols.get(e)),i.symbols.delete(e));else for(const[t,r]of e.layerData)i.symbols.has(t)&&(n.set(t,i.symbols.get(t)),i.symbols.delete(t));this._removeSymbols(n);const s=e.symbols,o=new Map;for(const[e,t]of s){let n=t.length;if(n>=32){let s=this.tileCoordRange;do{s/=2,n/=4}while(n>8&&s>64);const a=new r.HX(this.tileCoordRange,this.tileCoordRange,s);o.set(e,{flat:t,index:a}),i.symbols.set(e,{flat:t,index:a});for(const e of t)a.getCell(e.xTile,e.yTile).push(e)}else o.set(e,{flat:t}),i.symbols.set(e,{flat:t})}this._addSymbols(e.key,s)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[t,i]of this._tiles){const r=new Map;for(const t of e)i.symbols.has(t)&&(r.set(t,i.symbols.get(t)),i.symbols.delete(t));this._removeSymbols(r),0===i.symbols.size&&this._tiles.delete(t)}}removeTile(e){this._uniqueSymbolLayerArray=null;const t=this._tiles.get(e.id);if(!t)return;const i=new Map;for(const[r,n]of e.symbols)t.symbols.has(r)&&(i.set(r,t.symbols.get(r)),t.symbols.delete(r));this._removeSymbols(i),0===t.symbols.size&&this._tiles.delete(e.id)}querySymbols(e,t,i,n){const s=[],o=this.uniqueSymbols;for(const n of o){const o=n.styleLayerUID,a=n.uniqueSymbols;for(const n of a){const a=n.tileSymbols.find((e=>e.selectedForRendering));a&&(0,r.Fe)(a,e,t*(window.devicePixelRatio||1),i)&&s.push({vtlSymbol:a,styleLayerUID:o,tileKey:a.tile.key})}}return s}_removeSymbols(e){for(const[t,{flat:i}]of e)for(const e of i){const i=e.unique,r=i.tileSymbols,n=r.length-1;for(let t=0;t<n;t++)if(r[t]===e){r[t]=r[n];break}if(r.length=n,0===n){const e=this._uniqueSymbolsReferences.get(t);e.delete(i),0===e.size&&this._uniqueSymbolsReferences.delete(t)}e.unique=null}}_addSymbols(e,t){if(0===t.size)return;const i=this._visibleTiles;for(const r of i)r.parentTile||r.key.world!==e.world||r.key.level===e.level&&!r.key.equals(e)||this._matchSymbols(r,e,t);for(const[e,i]of t)for(const t of i)if(null==t.unique){const i=this._createUnique();t.unique=i,i.tileSymbols.push(t);let r=this._uniqueSymbolsReferences.get(e);r||(r=new Set,this._uniqueSymbolsReferences.set(e,r)),r.add(i)}}_matchSymbols(e,t,i){if(e.key.level>t.level){const i=e.key.level-t.level;if(e.key.row>>i!==t.row||e.key.col>>i!==t.col)return}if(t.level>e.key.level){const i=t.level-e.key.level;if(t.row>>i!==e.key.row||t.col>>i!==e.key.col)return}if(t.equals(e.key)){for(const r of e.childrenTiles)this._matchSymbols(r,t,i);return}const n=new Map;for(const[s,o]of i){const i=[];for(const n of o){const s=(0,r.co)(this.tileCoordRange,n.xTile,t.level,t.col,e.key.level,e.key.col),o=(0,r.co)(this.tileCoordRange,n.yTile,t.level,t.row,e.key.level,e.key.row);s>=0&&s<this.tileCoordRange&&o>=0&&o<this.tileCoordRange&&i.push({symbol:n,xTransformed:s,yTransformed:o})}const a=[],l=20+(e.key.level<t.level?1:1<<e.key.level-t.level),c=this._tiles.get(e.id).symbols.get(s);if(c){const e=c.flat;for(const t of i){let i,r=!1;const n=t.xTransformed,s=t.yTransformed;i=null!=c.index?c.index.getCell(n,s):e;const o=t.symbol,u=o.hash;for(const e of i)if(u===e.hash&&Math.abs(n-e.xTile)<=l&&Math.abs(s-e.yTile)<=l){const t=e.unique;o.unique=t,t.tileSymbols.push(o),r=!0;break}r||a.push(o)}}a.length>0&&n.set(s,a)}for(const i of e.childrenTiles)this._matchSymbols(i,t,n)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,t=new Array(e.size);let i,r=0;for(const[n,s]of e){const e=new Array(s.size);i=0;for(const t of s)e[i++]=t;t[r]={styleLayerUID:n,uniqueSymbols:e},r++}return t}}},2509:(e,t,i)=>{i.d(t,{JM:()=>s,R8:()=>r,cn:()=>n,v7:()=>o});const r=!0,n=32,s=1.5,o=200},11069:(e,t,i)=>{i.d(t,{J:()=>n,a:()=>r});class r{constructor(e,t){this.sourceTile=t,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}}class n{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}},1563:(e,t,i)=>{i.d(t,{f:()=>l});var r=i(38642),n=i(2509),s=i(84099),o=i(93712);function a(e,t,i,r,n,s){const{iconRotationAlignment:a,textRotationAlignment:l,iconTranslate:c,iconTranslateAnchor:u,textTranslate:h,textTranslateAnchor:d}=r;let p=0;for(const r of e.colliders){const[e,f]=0===r.partIndex?c:h,m=0===r.partIndex?u:d,g=r.minLod<=s&&s<=r.maxLod;p+=g?0:1,r.enabled=g,r.xScreen=r.xTile*n[0]+r.yTile*n[3]+n[6],r.yScreen=r.xTile*n[1]+r.yTile*n[4]+n[7],m===o.fD.MAP?(r.xScreen+=i*e-t*f,r.yScreen+=t*e+i*f):(r.xScreen+=e,r.yScreen+=f),o.aF.VIEWPORT===(0===r.partIndex?a:l)?(r.dxScreen=r.dxPixels,r.dyScreen=r.dyPixels):(r.dxScreen=i*(r.dxPixels+r.width/2)-t*(r.dyPixels+r.height/2)-r.width/2,r.dyScreen=t*(r.dxPixels+r.width/2)+i*(r.dyPixels+r.height/2)-r.height/2)}e.colliders.length>0&&p===e.colliders.length&&(e.unique.show=!1)}class l{constructor(e,t,i,o,a,l){this._symbols=e,this._styleRepository=o,this._zoom=a,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new s.HX(t,i,n.cn),this._si=Math.sin(Math.PI*l/180),this._co=Math.cos(Math.PI*l/180);for(const t of e)for(const e of t.symbols)this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,(0,r.d9)(e.tile.transforms.tileUnitsToPixels))}work(e){const t=this._gridIndex;function i(e){const i=e.xScreen+e.dxScreen,r=e.yScreen+e.dyScreen,n=i+e.width,s=r+e.height,[o,a,l,c]=t.getCellSpan(i,r,n,s);for(let e=a;e<=c;e++)for(let a=o;a<=l;a++){const o=t.cells[e][a];for(const e of o){const t=e.xScreen+e.dxScreen,o=e.yScreen+e.dyScreen,a=t+e.width,l=o+e.height;if(!(n<t||i>a||s<o||r>l))return!0}}return!1}const r=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const t=this._symbols[this._currentLayerCursor],n=this._getProperties(t.styleLayerUID);for(;this._currentSymbolCursor<t.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-r>e)return!1;const s=t.symbols[this._currentSymbolCursor];if(!s.unique.show)continue;a(s,this._si,this._co,n,this._allNeededMatrices.get(s.tile),this._zoom);const o=s.unique;if(!o.show)continue;const{iconAllowOverlap:l,iconIgnorePlacement:c,textAllowOverlap:u,textIgnorePlacement:h}=n;for(const e of s.colliders){if(!e.enabled)continue;const t=o.parts[e.partIndex];t.show&&(!(e.partIndex?u:l)&&i(e)&&(e.hard?o.show=!1:t.show=!1))}if(o.show)for(const e of s.colliders){if(!e.enabled)continue;if(e.partIndex?h:c)continue;if(!o.parts[e.partIndex].show)continue;const t=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,r=t+e.width,n=i+e.height,[s,a,l,u]=this._gridIndex.getCellSpan(t,i,r,n);for(let t=a;t<=u;t++)for(let i=s;i<=l;i++)this._gridIndex.cells[t][i].push(e)}}}return!0}_getProperties(e){const t=this._styleProps.get(e);if(t)return t;const i=this._zoom,r=this._styleRepository.getStyleLayerByUID(e),n=r.getLayoutValue("symbol-placement",i)!==o.R.POINT;let s=r.getLayoutValue("icon-rotation-alignment",i);s===o.aF.AUTO&&(s=n?o.aF.MAP:o.aF.VIEWPORT);let a=r.getLayoutValue("text-rotation-alignment",i);a===o.aF.AUTO&&(a=n?o.aF.MAP:o.aF.VIEWPORT);const l=r.getPaintValue("icon-translate",i),c=r.getPaintValue("icon-translate-anchor",i),u=r.getPaintValue("text-translate",i),h=r.getPaintValue("text-translate-anchor",i),d={iconAllowOverlap:r.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:r.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:r.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:r.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:s,textRotationAlignment:a,iconTranslateAnchor:c,iconTranslate:l,textTranslateAnchor:h,textTranslate:u};return this._styleProps.set(e,d),d}}},84099:(e,t,i)=>{i.d(t,{C$:()=>c,Fe:()=>h,HX:()=>a,co:()=>o,wB:()=>l});var r=i(43405),n=i(93944),s=i(11069);function o(e,t,i,r,n,s){const o=i-n;if(o>=0)return(t>>o)+(r-(s<<o))*(e>>o);const a=-o;return t-(s-(r<<a))*(e>>a)<<a}class a{constructor(e,t,i){this._rows=Math.ceil(t/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let e=0;e<this._rows;e++){this.cells[e]=new Array(this._columns);for(let t=0;t<this._columns;t++)this.cells[e][t]=[]}}getCell(e,t){const i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][r]||null}getCellSpan(e,t,i,r){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function l(e,t,i,r,n,o,a){const l=t[r++];for(let c=0;c<l;c++){const l=new s.a(o,a);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++],l.featureIndex=t[r++];const c=t[r++];for(let e=0;e<c;e++){const e=t[r++],n=t[r++],s=t[r++],o=t[r++],a=!!t[r++],c=t[r++],u=i[r++],h=i[r++],d=t[r++],p=t[r++];l.colliders.push({xTile:e,yTile:n,dxPixels:s,dyPixels:o,hard:a,partIndex:c,width:d,height:p,minLod:u,maxLod:h})}const u=e[r++];for(let t=0;t<u;t++)l.textVertexRanges.push([e[r++],e[r++]]);const h=e[r++];for(let t=0;t<h;t++)l.iconVertexRanges.push([e[r++],e[r++]]);n.push(l)}return r}function c(e,t,i){for(const[r,n]of e.symbols)u(e,t,i,n,r)}function u(e,t,i,n,s){const o=e.layerData.get(s);if(o.type===r.al.SYMBOL){for(const t of n){const r=t.unique;let n;if(t.selectedForRendering){const t=r.parts[0],s=t.startOpacity,o=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===o;const a=i?Math.floor(127*s)|o<<7:o?255:0;n=a<<24|a<<16|a<<8|a}else n=0;for(const[e,i]of t.iconVertexRanges)for(let t=e;t<e+i;t+=4)o.iconOpacity[t/4]=n;if(t.selectedForRendering){const t=r.parts[1],s=t.startOpacity,o=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===o;const a=i?Math.floor(127*s)|o<<7:o?255:0;n=a<<24|a<<16|a<<8|a}else n=0;for(const[e,i]of t.textVertexRanges)for(let t=e;t<e+i;t+=4)o.textOpacity[t/4]=n}o.lastOpacityUpdate=t,o.opacityChanged=!0}}function h(e,t,i,r){const s=e.colliders;let o,a,l,c;for(const u of s)if(e.unique.show&&e.unique.parts[u.partIndex].show&&(o=u.xScreen-r[0]+u.dxScreen,a=u.yScreen-r[1]+u.dyScreen,l=o+u.width,c=a+u.height,(0,n.Px)(i,t.x,t.y,o,a,l,c)))return!0;return!1}},43405:(e,t,i)=>{var r,n,s;i.d(t,{Fr:()=>s,_K:()=>n,al:()=>r}),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(r||(r={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(n||(n={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(s||(s={}))},93712:(e,t,i)=>{i.d(t,{EE:()=>n,R:()=>s,_5:()=>c,aF:()=>o,f2:()=>p,fD:()=>u,fR:()=>r,nR:()=>l,r1:()=>h,vL:()=>a});var r,n,s,o,a,l,c,u,h,d=i(25609);!function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(r||(r={})),function(e){e[e.VISIBLE=0]="VISIBLE",e[e.NONE=1]="NONE"}(n||(n={})),function(e){e[e.POINT=0]="POINT",e[e.LINE=1]="LINE",e[e.LINE_CENTER=2]="LINE_CENTER"}(s||(s={})),function(e){e[e.MAP=0]="MAP",e[e.VIEWPORT=1]="VIEWPORT",e[e.AUTO=2]="AUTO"}(o||(o={})),function(e){e[e.AUTO=0]="AUTO",e[e.LEFT=1]="LEFT",e[e.CENTER=2]="CENTER",e[e.RIGHT=3]="RIGHT"}(a||(a={})),function(e){e[e.CENTER=0]="CENTER",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM",e[e.TOP_LEFT=5]="TOP_LEFT",e[e.TOP_RIGHT=6]="TOP_RIGHT",e[e.BOTTOM_LEFT=7]="BOTTOM_LEFT",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(l||(l={})),function(e){e[e.NONE=0]="NONE",e[e.UPPERCASE=1]="UPPERCASE",e[e.LOWERCASE=2]="LOWERCASE"}(c||(c={})),function(e){e[e.MAP=0]="MAP",e[e.VIEWPORT=1]="VIEWPORT"}(u||(u={})),function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL"}(h||(h={}));class p{}p.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.VISIBLE}},p.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.VISIBLE}},p.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:d.RL.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:d.AH.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},p.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:s.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:l.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:o.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:l.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:a.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:o.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:c.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[h.HORIZONTAL]}},p.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.VISIBLE}},p.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},p.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP}},p.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP},"line-width":{type:"number",minimum:0,default:1}},p.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP}},p.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},p.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP}}},18897:(e,t,i)=>{i.d(t,{Et:()=>Pe,sj:()=>Ne,Le:()=>Ie,_L:()=>Fe,$L:()=>Re,gf:()=>Le,jG:()=>De,nj:()=>Ue});var r,n,s=i(24568),o=i(43405),a=i(93944),l=i(42938);!function(e){e[e.R8_SIGNED=0]="R8_SIGNED",e[e.R8_UNSIGNED=1]="R8_UNSIGNED",e[e.R16_SIGNED=2]="R16_SIGNED",e[e.R16_UNSIGNED=3]="R16_UNSIGNED",e[e.R8G8_SIGNED=4]="R8G8_SIGNED",e[e.R8G8_UNSIGNED=5]="R8G8_UNSIGNED",e[e.R16G16_SIGNED=6]="R16G16_SIGNED",e[e.R16G16_UNSIGNED=7]="R16G16_UNSIGNED",e[e.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED",e[e.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED",e[e.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR",e[e.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY",e[e.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"}(r||(r={})),function(e){e[e.UNIFORM=0]="UNIFORM",e[e.DATA_DRIVEN=1]="DATA_DRIVEN",e[e.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN",e[e.UNUSED=3]="UNUSED"}(n||(n={}));var c=i(91907),u=i(41163);class h{constructor(e){this._locations=new Map,this._key=e}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._layout||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return 0===this._locations.size&&this._buildAttributesInfo(),this._locations}getLayoutInfo(){return this._layout||this._buildAttributesInfo(),this._layout}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(e,t,i,r,n){const s=this.getUniforms();for(const o of s){const{name:s,type:a,getValue:l}=o,c=l(i,t,r,n);if(null!==c)switch(a){case"float":e.setUniform1f(s,c);break;case"vec2":e.setUniform2fv(s,c);break;case"vec4":e.setUniform4fv(s,c)}}}encodeAttributes(e,t,i,n){const s=this.attributesInfo(),o=this.getEncodingInfos(),a=[];let l=0,c=0;for(const u of Object.keys(o)){const h=o[u],{type:d,precisionFactor:p,isLayout:f}=s[u],m=f?i.getLayoutProperty(u):i.getPaintProperty(u),g=m.interpolator?.getInterpolationRange(t);let y=0;for(const i of h){const{offset:s,bufferElementsToAdd:o}=i;if(o>0){for(let e=0;e<o;e++)a.push(0);l+=c,c=i.bufferElementsToAdd}const u=n??m.getValue(g?g[y]:t,e);switch(d){case r.R8_SIGNED:case r.R8_UNSIGNED:a[l]|=this._encodeByte(u*(p||1),8*s);break;case r.R16_SIGNED:case r.R16_UNSIGNED:a[l]|=this._encodeShort(u*(p||1),8*s);break;case r.R8G8_SIGNED:case r.R8G8_UNSIGNED:a[l]|=this._encodeByte(u*(p||1),8*s),a[l]|=this._encodeByte(u*(p||1),8*s+8);break;case r.R16G16_SIGNED:case r.R16G16_UNSIGNED:a[l]|=this._encodeShort(u*(p||1),8*s),a[l]|=this._encodeShort(u*(p||1),8*s+16);break;case r.R8G8B8A8_SIGNED:case r.R8G8B8A8_UNSIGNED:a[l]|=this._encodeByte(u*(p||1),8*s),a[l]|=this._encodeByte(u*(p||1),8*s+8),a[l]|=this._encodeByte(u*(p||1),8*s+16),a[l]|=this._encodeByte(u*(p||1),8*s+24);break;case r.R8G8B8A8_COLOR:a[l]=this._encodeColor(u);break;case r.R16G16B16A16_DASHARRAY:case r.R16G16B16A16_PATTERN:this._encodePattern(l,a,u);break;default:throw new Error("Unsupported encoding type")}y++}}return a}getAtributeState(e){let t=0;const i=3+2*e;return t|=this._bit(i),t|=this._bit(i+1)<<1,t}_buildAttributesInfo(){const e=[],t={},i={};let r=-1;const s=this.attributesInfo(),o=this.attributes();let a=-1;for(const l of o){a++;const o=this.getAtributeState(a);if(o===n.UNIFORM||o===n.UNUSED)continue;const c=s[l],u=[];t[l]=u;const d=c.type;for(let t=0;t<o;t++){const{dataType:t,bytesPerElement:n,count:s,normalized:o}=h._encodingInfo[d],a=n*s,l=`${t}-${!0===o}`;let c=i[l],p=0;if(!c||c.count+s>4)r++,c={dataIndex:r,count:0,offset:0},4!==s&&(i[l]=c),e.push({location:-1,name:"a_data_"+r,count:s,type:t,normalized:o}),p=Math.ceil(Math.max(a/4,1));else{const t=e[c.dataIndex];t.count+=s,p=Math.ceil(Math.max(t.count*n/4,1))-Math.ceil(Math.max(c.offset/4,1))}u.push({dataIndex:c.dataIndex,offset:c.offset,bufferElementsToAdd:p}),c.offset+=a,c.count+=s}}for(const t of e)switch(t.type){case c.g.BYTE:case c.g.UNSIGNED_BYTE:t.count=4;break;case c.g.SHORT:case c.g.UNSIGNED_SHORT:t.count+=t.count%2}this._buildVertexBufferLayout(e);let l=0;const u=this._layout.get("geometry");for(const e of u)this._locations.set(e.name,l++);const d=this._layout.get("opacity");if(d)for(const e of d)this._locations.set(e.name,l++);this._buildShaderInfo(e,t),this._propertyEncodingInfo=t}_buildVertexBufferLayout(e){const t=new Map,i=this.geometryInfo();let r=i[0].stride;if(0===e.length)t.set("geometry",i);else{const n=[];let s=r;for(const t of e)r+=d(t.type)*t.count;for(const e of i)n.push(new u.G(e.name,e.count,e.type,e.offset,r,e.normalized));for(const t of e)n.push(new u.G(t.name,t.count,t.type,s,r,t.normalized)),s+=d(t.type)*t.count;t.set("geometry",n)}const n=this.opacityInfo();n&&t.set("opacity",n),this._layout=t,this._stride=r}_buildShaderInfo(e,t){let i="\n",s="\n";const o=[];for(const t of e)i+=`attribute ${this._getType(t.count)} ${t.name};\n`;const a=this.attributes(),l=this.attributesInfo();let c=-1;for(const e of a){c++;const{name:a,type:u,precisionFactor:d,isLayout:f}=l[e],m=d&&1!==d?" * "+1/d:"",{bytesPerElement:g,count:y}=h._encodingInfo[u],_=e=>`a_data_${e.dataIndex}${p(y,e.offset,g)}`;switch(this.getAtributeState(c)){case n.UNIFORM:{const t=this._getType(y),n=`u_${a}`;o.push({name:n,type:t,getValue:(t,i,n,s)=>{const o=f?t.getLayoutValue(e,i):t.getPaintValue(e,i);if(u===r.R16G16B16A16_DASHARRAY){const e=t.getDashKey(o,t.getLayoutValue("line-cap",i)),r=s.getMosaicItemPosition(e,!1);if(null==r)return null;const{tl:n,br:a}=r;return[n[0],a[1],a[0],n[1]]}if(u===r.R16G16B16A16_PATTERN){const t=s.getMosaicItemPosition(o,!e.includes("line-"));if(null==t)return null;const{tl:i,br:r}=t;return[i[0],r[1],r[0],i[1]]}if(u===r.R8G8B8A8_COLOR){const e=o[3];return[e*o[0],e*o[1],e*o[2],e]}return o}}),i+=`uniform ${t} ${n};\n`,s+=`${t} ${a} = ${n};\n`}break;case n.DATA_DRIVEN:{const i=_(t[e][0]);s+=`${this._getType(y)} ${a} = ${i}${m};\n`}break;case n.INTERPOLATED_DATA_DRIVEN:{const r=`u_t_${a}`;o.push({name:r,type:"float",getValue:(t,i,r,n)=>(f?t.getLayoutProperty(e):t.getPaintProperty(e)).interpolator.interpolationUniformValue(r,i)}),i+=`uniform float ${r};\n`;const n=_(t[e][0]),l=_(t[e][1]);s+=`${this._getType(y)} ${a} = mix(${n}${m}, ${l}${m}, ${r});\n`}}}this._shaderHeader=i,this._shaderMain=s,this._uniforms=o}_bit(e){return(this._key&1<<e)>>e}_getType(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw new Error("Invalid count")}_encodeColor(e){const t=255*e[3];return l.Z.i8888to32(e[0]*t,e[1]*t,e[2]*t,t)}_encodePattern(e,t,i){if(!i?.rect)return;const r=i.rect,n=i.width,s=i.height;t[e]=this._encodeShort(r.x+2,0),t[e]|=this._encodeShort(r.y+2+s,16),t[e+1]=this._encodeShort(r.x+2+n,0),t[e+1]|=this._encodeShort(r.y+2,16)}_encodeByte(e,t){return(255&e)<<t}_encodeShort(e,t){return(65535&e)<<t}}h._encodingInfo={[r.R8_SIGNED]:{dataType:c.g.BYTE,bytesPerElement:1,count:1,normalized:!1},[r.R8_UNSIGNED]:{dataType:c.g.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[r.R16_SIGNED]:{dataType:c.g.SHORT,bytesPerElement:2,count:1,normalized:!1},[r.R16_UNSIGNED]:{dataType:c.g.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[r.R8G8_SIGNED]:{dataType:c.g.BYTE,bytesPerElement:1,count:2,normalized:!1},[r.R8G8_UNSIGNED]:{dataType:c.g.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[r.R16G16_SIGNED]:{dataType:c.g.SHORT,bytesPerElement:2,count:2,normalized:!1},[r.R16G16_UNSIGNED]:{dataType:c.g.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[r.R8G8B8A8_SIGNED]:{dataType:c.g.BYTE,bytesPerElement:1,count:4,normalized:!1},[r.R8G8B8A8_UNSIGNED]:{dataType:c.g.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[r.R8G8B8A8_COLOR]:{dataType:c.g.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[r.R16G16B16A16_DASHARRAY]:{dataType:c.g.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[r.R16G16B16A16_PATTERN]:{dataType:c.g.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const d=e=>{switch(e){case c.g.FLOAT:case c.g.INT:case c.g.UNSIGNED_INT:return 4;case c.g.SHORT:case c.g.UNSIGNED_SHORT:case c.g.HALF_FLOAT:return 2;case c.g.BYTE:case c.g.UNSIGNED_BYTE:return 1}},p=(e,t,i)=>{const r=t/i;if(1===e)switch(r){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===e)switch(r){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===e)switch(r){case 0:return".xyz";case 1:return".yzw"}return""};class f extends h{constructor(e){super(e)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}f.ATTRIBUTES=[],f.GEOMETRY_LAYOUT=[new u.G("a_pos",2,c.g.BYTE,0,2)],f.ATTRIBUTES_INFO={};class m extends h{constructor(e){super(e)}geometryInfo(){return m.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return m.ATTRIBUTES}attributesInfo(){return m.ATTRIBUTES_INFO}}m.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"],m.GEOMETRY_LAYOUT=[new u.G("a_pos",2,c.g.SHORT,0,4)],m.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:r.R8_UNSIGNED},"circle-color":{name:"color",type:r.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:r.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:r.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:r.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:r.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",type:r.R8_UNSIGNED,precisionFactor:32}};class g extends h{constructor(e){super(e)}geometryInfo(){return g.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return g.ATTRIBUTES}attributesInfo(){return g.ATTRIBUTES_INFO}}g.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"],g.GEOMETRY_LAYOUT=[new u.G("a_pos",2,c.g.SHORT,0,4)],g.ATTRIBUTES_INFO={"fill-color":{name:"color",type:r.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:r.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:r.R16G16B16A16_PATTERN,isOptional:!0}};class y extends h{constructor(e,t){super(e),this._usefillColor=t}geometryInfo(){return y.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?y.ATTRIBUTES_FILL:y.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?y.ATTRIBUTES_INFO_FILL:y.ATTRIBUTES_INFO_OUTLINE}}y.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"],y.ATTRIBUTES_FILL=["fill-color","fill-opacity"],y.GEOMETRY_LAYOUT=[new u.G("a_pos",2,c.g.SHORT,0,8),new u.G("a_offset",2,c.g.BYTE,4,8),new u.G("a_xnormal",2,c.g.BYTE,6,8)],y.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:r.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:r.R8_UNSIGNED,precisionFactor:100}},y.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:r.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:r.R8_UNSIGNED,precisionFactor:100}};class _ extends h{constructor(e){super(e)}geometryInfo(){return _.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return _.ATTRIBUTES}attributesInfo(){return _.ATTRIBUTES_INFO}}_.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width","line-pattern","line-dasharray"],_.GEOMETRY_LAYOUT=[new u.G("a_pos",2,c.g.SHORT,0,16),new u.G("a_extrude_offset",4,c.g.BYTE,4,16),new u.G("a_dir_normal",4,c.g.BYTE,8,16),new u.G("a_accumulatedDistance",2,c.g.UNSIGNED_SHORT,12,16)],_.ATTRIBUTES_INFO={"line-width":{name:"width",type:r.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:r.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:r.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:r.R8G8B8A8_COLOR},"line-opacity":{name:"opacity",type:r.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:r.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:r.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:r.R16G16B16A16_DASHARRAY,isOptional:!0}};const v=[new u.G("a_pos",2,c.g.SHORT,0,16),new u.G("a_vertexOffset",2,c.g.SHORT,4,16),new u.G("a_texAngleRange",4,c.g.UNSIGNED_BYTE,8,16),new u.G("a_levelInfo",4,c.g.UNSIGNED_BYTE,12,16)],b=[new u.G("a_opacityInfo",1,c.g.UNSIGNED_BYTE,0,1)];class w extends h{constructor(e){super(e)}geometryInfo(){return v}opacityInfo(){return b}attributes(){return w.ATTRIBUTES}attributesInfo(){return w.ATTRIBUTES_INFO}}w.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"],w.ATTRIBUTES_INFO={"icon-color":{name:"color",type:r.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:r.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:r.R8G8B8A8_COLOR},"icon-halo-width":{name:"halo_width",type:r.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:r.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:r.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};class x extends h{constructor(e){super(e)}geometryInfo(){return v}opacityInfo(){return b}attributes(){return x.ATTRIBUTES}attributesInfo(){return x.ATTRIBUTES_INFO}}x.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"],x.ATTRIBUTES_INFO={"text-color":{name:"color",type:r.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:r.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:r.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:r.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:r.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:r.R8_UNSIGNED,isLayout:!0}};var T=i(30936),C=i(39043),S=i(82584),E=i(50590);const M={kind:"null"},A={kind:"number"},R={kind:"string"},O={kind:"boolean"},P={kind:"color"},I={kind:"object"},L={kind:"value"};function D(e,t){return{kind:"array",itemType:e,n:t}}const N=[M,A,R,O,P,I,D(L)];function F(e){if("array"===e.kind){const t=F(e.itemType);return"number"==typeof e.n?`array<${t}, ${e.n}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}function U(e){if(null===e)return M;if("string"==typeof e)return R;if("boolean"==typeof e)return O;if("number"==typeof e)return A;if(e instanceof T.Z)return P;if(Array.isArray(e)){let t;for(const i of e){const e=U(i);if(t){if(t!==e){t=L;break}}else t=e}return D(t||L,e.length)}return"object"==typeof e?I:L}function k(e,t){if("array"===t.kind)return"array"===e.kind&&(0===e.n&&"value"===e.itemType.kind||k(e.itemType,t.itemType))&&("number"!=typeof t.n||t.n===e.n);if("value"===t.kind)for(const t of N)if(k(e,t))return!0;return t.kind===e.kind}function z(e){if(null===e)return"";const t=typeof e;return"string"===t?e:"number"===t||"boolean"===t?String(e):e instanceof T.Z?e.toString():JSON.stringify(e)}class B{constructor(e){this._parent=e,this._vars={}}add(e,t){this._vars[e]=t}get(e){return this._vars[e]?this._vars[e]:this._parent?this._parent.get(e):null}}class V{constructor(){this.type=L}static parse(e){if(e.length>1)throw new Error('"id" does not expect arguments');return new V}evaluate(e,t){return e?.id}}class H{constructor(){this.type=R}static parse(e){if(e.length>1)throw new Error('"geometry-type" does not expect arguments');return new H}evaluate(e,t){if(!e)return null;switch(e.type){case S.Vl.Point:return"Point";case S.Vl.LineString:return"LineString";case S.Vl.Polygon:return"Polygon";default:return null}}}class G{constructor(){this.type=I}static parse(e){if(e.length>1)throw new Error('"properties" does not expect arguments');return new G}evaluate(e,t){return e?.values}}class j{constructor(){this.type=A}static parse(e){if(e.length>1)throw new Error('"zoom" does not expect arguments');return new j}evaluate(e,t){return t}}class Z{constructor(e,t,i){this._lhs=e,this._rhs=t,this._compare=i,this.type=O}static parse(e,t,i){if(3!==e.length&&4!==e.length)throw new Error(`"${e[0]}" expects 2 or 3 arguments`);if(4===e.length)throw new Error(`"${e[0]}" collator not supported`);return new Z(xe(e[1],t),xe(e[2],t),i)}evaluate(e,t){return this._compare(this._lhs.evaluate(e,t),this._rhs.evaluate(e,t))}}class q{constructor(e){this._arg=e,this.type=O}static parse(e,t){if(2!==e.length)throw new Error('"!" expects 1 argument');return new q(xe(e[1],t))}evaluate(e,t){return!this._arg.evaluate(e,t)}}class W{constructor(e){this._args=e,this.type=O}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(xe(e[r],t));return new W(i)}evaluate(e,t){for(const i of this._args)if(!i.evaluate(e,t))return!1;return!0}}class ${constructor(e){this._args=e,this.type=O}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(xe(e[r],t));return new $(i)}evaluate(e,t){for(const i of this._args)if(i.evaluate(e,t))return!0;return!1}}class Y{constructor(e){this._args=e,this.type=O}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(xe(e[r],t));return new Y(i)}evaluate(e,t){for(const i of this._args)if(i.evaluate(e,t))return!1;return!0}}class J{constructor(e,t,i){this.type=e,this._args=t,this._fallback=i}static parse(e,t,i){if(e.length<4)throw new Error('"case" expects at least 3 arguments');if(e.length%2==1)throw new Error('"case" expects an odd number of arguments');let r;const n=[];for(let s=1;s<e.length-1;s+=2){const o=xe(e[s],t),a=xe(e[s+1],t,i);r||(r=a.type),n.push({condition:o,output:a})}const s=xe(e[e.length-1],t,i);return r||(r=s.type),new J(r,n,s)}evaluate(e,t){for(const i of this._args)if(i.condition.evaluate(e,t))return i.output.evaluate(e,t);return this._fallback.evaluate(e,t)}}class X{constructor(e,t){this.type=e,this._args=t}static parse(e,t){if(e.length<2)throw new Error('"coalesce" expects at least 1 argument');let i;const r=[];for(let n=1;n<e.length;n++){const s=xe(e[n],t);i||(i=s.type),r.push(s)}return new X(i,r)}evaluate(e,t){for(const i of this._args){const r=i.evaluate(e,t);if(null!==r)return r}return null}}class K{constructor(e,t,i,r,n){this.type=e,this._input=t,this._labels=i,this._outputs=r,this._fallback=n}static parse(e,t){if(e.length<3)throw new Error('"match" expects at least 3 arguments');if(e.length%2==0)throw new Error('"case" expects an even number of arguments');let i;const r=xe(e[1],t),n=[],s={};let o;for(let r=2;r<e.length-1;r+=2){let a=e[r];Array.isArray(a)||(a=[a]);for(const e of a){const t=typeof e;if("string"!==t&&"number"!==t)throw new Error('"match" requires string or number literal as labels');if(o){if(t!==o)throw new Error('"match" requires labels to have the same type')}else o=t;s[e]=n.length}const l=xe(e[r+1],t);i||(i=l.type),n.push(l)}return new K(i,r,s,n,xe(e[e.length-1],t))}evaluate(e,t){const i=this._input.evaluate(e,t);return(this._outputs[this._labels[i]]||this._fallback).evaluate(e,t)}}class Q{constructor(e,t,i,r,n){this._operator=e,this.type=t,this.interpolation=i,this.input=r,this._stops=n}static parse(e,t,i){const r=e[0];if(e.length<5)throw new Error(`"${r}" expects at least 4 arguments`);const n=e[1];if(!Array.isArray(n)||0===n.length)throw new Error(`"${n}" is not a valid interpolation`);switch(n[0]){case"linear":if(1!==n.length)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(2!==n.length||"number"!=typeof n[1])throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(5!==n.length)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(let e=1;e<5;e++){const t=n[e];if("number"!=typeof t||t<0||t>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error(`"${e[0]}" unknown interpolation type "${n[0]}"`)}if(e.length%2!=1)throw new Error(`"${r}" expects an even number of arguments`);const s=xe(e[2],t,A);let o;"interpolate-hcl"===r||"interpolate-lab"===r?o=P:i&&"value"!==i.kind&&(o=i);const a=[];for(let i=3;i<e.length;i+=2){const n=e[i];if("number"!=typeof n)throw new Error(`"${r}" requires stop inputs as literal numbers`);if(a.length&&a[a.length-1][0]>=n)throw new Error(`"${r}" requires strictly ascending stop inputs`);const s=xe(e[i+1],t,o);o||(o=s.type),a.push([n,s])}if(o&&o!==P&&o!==A&&("array"!==o.kind||o.itemType!==A))throw new Error(`"${r}" cannot interpolate type ${F(o)}`);return new Q(r,o,n,s,a)}evaluate(e,t){const i=this._stops;if(1===i.length)return i[0][1].evaluate(e,t);const r=this.input.evaluate(e,t);if(r<=i[0][0])return i[0][1].evaluate(e,t);if(r>=i[i.length-1][0])return i[i.length-1][1].evaluate(e,t);let n=0;for(;++n<i.length&&!(r<i[n][0]););const s=i[n-1][0],o=i[n][0],l=Q.interpolationRatio(this.interpolation,r,s,o),c=i[n-1][1].evaluate(e,t),u=i[n][1].evaluate(e,t);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(c)&&Array.isArray(u))return c.map(((e,t)=>(0,a.sX)(e,u[t],l)));if("color"===this.type.kind&&c instanceof T.Z&&u instanceof T.Z){const e=new T.Z(c),t=new T.Z(u);return new T.Z([(0,a.sX)(e.r,t.r,l),(0,a.sX)(e.g,t.g,l),(0,a.sX)(e.b,t.b,l),(0,a.sX)(e.a,t.a,l)])}if("number"===this.type.kind&&"number"==typeof c&&"number"==typeof u)return(0,a.sX)(c,u,l);throw new Error(`"${this._operator}" cannot interpolate type ${F(this.type)}`)}if("interpolate-hcl"===this._operator){const e=(0,C.sJ)(c),t=(0,C.sJ)(u),i=t.h-e.h,r=(0,C.xr)({h:e.h+l*(i>180||i<-180?i-360*Math.round(i/360):i),c:(0,a.sX)(e.c,t.c,l),l:(0,a.sX)(e.l,t.l,l)});return new T.Z({a:(0,a.sX)(c.a,u.a,l),...r})}if("interpolate-lab"===this._operator){const e=(0,C.Y3)(c),t=(0,C.Y3)(u),i=(0,C.xr)({l:(0,a.sX)(e.l,t.l,l),a:(0,a.sX)(e.a,t.a,l),b:(0,a.sX)(e.b,t.b,l)});return new T.Z({a:(0,a.sX)(c.a,u.a,l),...i})}throw new Error(`Unexpected operator "${this._operator}"`)}interpolationUniformValue(e,t){const i=this._stops;if(1===i.length)return 0;if(e>=i[i.length-1][0])return 0;let r=0;for(;++r<i.length&&!(e<i[r][0]););const n=i[r-1][0],s=i[r][0];return Q.interpolationRatio(this.interpolation,t,n,s)}getInterpolationRange(e){const t=this._stops;if(1===t.length){const e=t[0][0];return[e,e]}const i=t[t.length-1][0];if(e>=i)return[i,i];let r=0;for(;++r<t.length&&!(e<t[r][0]););return[t[r-1][0],t[r][0]]}static interpolationRatio(e,t,i,r){let n=0;return"linear"===e[0]?n=Q._exponentialInterpolationRatio(t,1,i,r):"exponential"===e[0]?n=Q._exponentialInterpolationRatio(t,e[1],i,r):"cubic-bezier"===e[0]&&(n=(0,E.n_)(e[1],e[2],e[3],e[4])(Q._exponentialInterpolationRatio(t,1,i,r),1e-5)),n<0?n=0:n>1&&(n=1),n}static _exponentialInterpolationRatio(e,t,i,r){const n=r-i;if(0===n)return 0;const s=e-i;return 1===t?s/n:(t**s-1)/(t**n-1)}}class ee{constructor(e,t,i){this.type=e,this._input=t,this._stops=i}static parse(e,t){if(e.length<5)throw new Error('"step" expects at least 4 arguments');if(e.length%2!=1)throw new Error('"step" expects an even number of arguments');const i=xe(e[1],t,A);let r;const n=[];n.push([-1/0,xe(e[2],t)]);for(let i=3;i<e.length;i+=2){const s=e[i];if("number"!=typeof s)throw new Error('"step" requires stop inputs as literal numbers');if(n.length&&n[n.length-1][0]>=s)throw new Error('"step" requires strictly ascending stop inputs');const o=xe(e[i+1],t);r||(r=o.type),n.push([s,o])}return new ee(r,i,n)}evaluate(e,t){const i=this._stops;if(1===i.length)return i[0][1].evaluate(e,t);const r=this._input.evaluate(e,t);let n=0;for(;++n<i.length&&!(r<i[n][0]););return this._stops[n-1][1].evaluate(e,t)}}class te{constructor(e,t){this.type=e,this._output=t}static parse(e,t,i){if(e.length<4)throw new Error('"let" expects at least 3 arguments');if(e.length%2==1)throw new Error('"let" expects an odd number of arguments');const r=new B(t);for(let i=1;i<e.length-1;i+=2){const n=e[i];if("string"!=typeof n)throw new Error(`"let" requires a string to define variable names - found ${n}`);r.add(n,xe(e[i+1],t))}const n=xe(e[e.length-1],r,i);return new te(n.type,n)}evaluate(e,t){return this._output.evaluate(e,t)}}class ie{constructor(e,t){this.type=e,this.output=t}static parse(e,t,i){if(2!==e.length||"string"!=typeof e[1])throw new Error('"var" requires just one literal string argument');const r=t.get(e[1]);if(!r)throw new Error(`${e[1]} must be defined before being used in a "var" expression`);return new ie(i||L,r)}evaluate(e,t){return this.output.evaluate(e,t)}}class re{constructor(e,t,i){this.type=e,this._index=t,this._array=i}static parse(e,t){if(3!==e.length)throw new Error('"at" expects 2 arguments');const i=xe(e[1],t,A),r=xe(e[2],t);return new re(r.type.itemType,i,r)}evaluate(e,t){const i=this._index.evaluate(e,t),r=this._array.evaluate(e,t);if(i<0||i>=r.length)throw new Error('"at" index out of bounds');if(i!==Math.floor(i))throw new Error('"at" index must be an integer');return r[i]}}class ne{constructor(e,t){this._key=e,this._obj=t,this.type=L}static parse(e,t){let i,r;switch(e.length){case 2:return i=xe(e[1],t),new ne(i);case 3:return i=xe(e[1],t),r=xe(e[2],t),new ne(i,r);default:throw new Error('"get" expects 1 or 2 arguments')}}evaluate(e,t){const i=this._key.evaluate(e,t);return this._obj?this._obj.evaluate(e,t)[i]:e?.values[i]}}class se{constructor(e,t){this._key=e,this._obj=t,this.type=O}static parse(e,t){let i,r;switch(e.length){case 2:return i=xe(e[1],t),new se(i);case 3:return i=xe(e[1],t),r=xe(e[2],t),new se(i,r);default:throw new Error('"has" expects 1 or 2 arguments')}}evaluate(e,t){const i=this._key.evaluate(e,t);return this._obj?i in this._obj.evaluate(e,t):!!e?.values[i]}}class oe{constructor(e,t){this._key=e,this._vals=t,this.type=O}static parse(e,t){if(3!==e.length)throw new Error('"in" expects 2 arguments');return new oe(xe(e[1],t),xe(e[2],t))}evaluate(e,t){const i=this._key.evaluate(e,t);return this._vals.evaluate(e,t).includes(i)}}class ae{constructor(e,t,i){this._item=e,this._array=t,this._from=i,this.type=A}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"index-of" expects 3 or 4 arguments');const i=xe(e[1],t),r=xe(e[2],t);if(4===e.length){const n=xe(e[3],t,A);return new ae(i,r,n)}return new ae(i,r)}evaluate(e,t){const i=this._item.evaluate(e,t),r=this._array.evaluate(e,t);if(this._from){const n=this._from.evaluate(e,t);if(n!==Math.floor(n))throw new Error('"index-of" index must be an integer');return r.indexOf(i,n)}return r.indexOf(i)}}class le{constructor(e){this._arg=e,this.type=A}static parse(e,t){if(2!==e.length)throw new Error('"length" expects 2 arguments');const i=xe(e[1],t);return new le(i)}evaluate(e,t){const i=this._arg.evaluate(e,t);if("string"==typeof i)return i.length;if(Array.isArray(i))return i.length;throw new Error('"length" expects string or array')}}class ce{constructor(e,t,i,r){this.type=e,this._array=t,this._from=i,this._to=r}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"slice" expects 2 or 3 arguments');const i=xe(e[1],t),r=xe(e[2],t,A);if(r.type!==A)throw new Error('"slice" index must return a number');if(4===e.length){const n=xe(e[3],t,A);if(n.type!==A)throw new Error('"slice" index must return a number');return new ce(i.type,i,r,n)}return new ce(i.type,i,r)}evaluate(e,t){const i=this._array.evaluate(e,t);if(!Array.isArray(i)&&"string"!=typeof i)throw new Error('"slice" input must be an array or a string');const r=this._from.evaluate(e,t);if(r<0||r>=i.length)throw new Error('"slice" index out of bounds');if(r!==Math.floor(r))throw new Error('"slice" index must be an integer');if(this._to){const n=this._to.evaluate(e,t);if(n<0||n>=i.length)throw new Error('"slice" index out of bounds');if(n!==Math.floor(n))throw new Error('"slice" index must be an integer');return i.slice(r,n)}return i.slice(r)}}class ue{constructor(){this.type=O}static parse(e){if(1!==e.length)throw new Error('"has-id" expects no arguments');return new ue}evaluate(e,t){return void 0!==e?.id}}class he{constructor(e,t){this._args=e,this._calculate=t,this.type=A}static parse(e,t,i){const r=e.slice(1).map((e=>xe(e,t)));return new he(r,i)}evaluate(e,t){let i;return this._args&&(i=this._args.map((i=>i.evaluate(e,t)))),this._calculate(i)}}class de{constructor(e,t){this._args=e,this._calculate=t,this.type=A}static parse(e,t){const i=e.slice(1).map((e=>xe(e,t)));return new de(i,de.ops[e[0]])}evaluate(e,t){let i;return this._args&&(i=this._args.map((i=>i.evaluate(e,t)))),this._calculate(i)}}de.ops={abs:e=>Math.abs(e[0]),acos:e=>Math.acos(e[0]),asin:e=>Math.asin(e[0]),atan:e=>Math.atan(e[0]),ceil:e=>Math.ceil(e[0]),cos:e=>Math.cos(e[0]),e:()=>Math.E,floor:e=>Math.floor(e[0]),ln:e=>Math.log(e[0]),ln2:()=>Math.LN2,log10:e=>Math.log(e[0])/Math.LN10,log2:e=>Math.log(e[0])/Math.LN2,max:e=>Math.max(...e),min:e=>Math.min(...e),pi:()=>Math.PI,round:e=>Math.round(e[0]),sin:e=>Math.sin(e[0]),sqrt:e=>Math.sqrt(e[0]),tan:e=>Math.tan(e[0])};class pe{constructor(e){this._args=e,this.type=R}static parse(e,t){return new pe(e.slice(1).map((e=>xe(e,t))))}evaluate(e,t){return this._args.map((i=>i.evaluate(e,t))).join("")}}class fe{constructor(e,t){this._arg=e,this._calculate=t,this.type=R}static parse(e,t){if(2!==e.length)throw new Error(`${e[0]} expects 1 argument`);const i=xe(e[1],t);return new fe(i,fe.ops[e[0]])}evaluate(e,t){return this._calculate(this._arg.evaluate(e,t))}}fe.ops={downcase:e=>e.toLowerCase(),upcase:e=>e.toUpperCase()};class me{constructor(e){this._args=e,this.type=P}static parse(e,t){if(4!==e.length)throw new Error('"rgb" expects 3 arguments');const i=e.slice(1).map((e=>xe(e,t)));return new me(i)}evaluate(e,t){const i=this._validate(this._args[0].evaluate(e,t)),r=this._validate(this._args[1].evaluate(e,t)),n=this._validate(this._args[2].evaluate(e,t));return new T.Z({r:i,g:r,b:n})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}}class ge{constructor(e){this._args=e,this.type=P}static parse(e,t){if(5!==e.length)throw new Error('"rgba" expects 4 arguments');const i=e.slice(1).map((e=>xe(e,t)));return new ge(i)}evaluate(e,t){const i=this._validate(this._args[0].evaluate(e,t)),r=this._validate(this._args[1].evaluate(e,t)),n=this._validate(this._args[2].evaluate(e,t)),s=this._validateAlpha(this._args[3].evaluate(e,t));return new T.Z({r:i,g:r,b:n,a:s})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}_validateAlpha(e){if("number"!=typeof e||e<0||e>1)throw new Error(`${e}: invalid alpha color component`);return e}}class ye{constructor(e){this._color=e,this.type=D(A,4)}static parse(e,t){if(2!==e.length)throw new Error('"to-rgba" expects 1 argument');const i=xe(e[1],t);return new ye(i)}evaluate(e,t){return new T.Z(this._color.evaluate(e,t)).toRgba()}}class _e{constructor(e,t){this.type=e,this._args=t}static parse(e,t){const i=e[0];if(e.length<2)throw new Error(`${i} expects at least one argument`);let r,n=1;if("array"===i){if(e.length>2){switch(e[1]){case"string":r=R;break;case"number":r=A;break;case"boolean":r=O;break;default:throw new Error('"array" type argument must be string, number or boolean')}n++}else r=L;let t;if(e.length>3){if(t=e[2],null!==t&&("number"!=typeof t||t<0||t!==Math.floor(t)))throw new Error('"array" length argument must be a positive integer literal');n++}r=D(r,t)}else switch(i){case"string":r=R;break;case"number":r=A;break;case"boolean":r=O;break;case"object":r=I}const s=[];for(;n<e.length;n++){const i=xe(e[n],t);s.push(i)}return new _e(r,s)}evaluate(e,t){let i;for(const r of this._args){const n=r.evaluate(e,t);if(i=U(n),k(i,this.type))return n}throw new Error(`Expected ${F(this.type)} but got ${F(i)}`)}}class ve{constructor(e,t){this.type=e,this._args=t}static parse(e,t){const i=e[0],r=ve.types[i];if(r===O||r===R){if(2!==e.length)throw new Error(`${i} expects one argument`)}else if(e.length<2)throw new Error(`${i} expects at least one argument`);const n=[];for(let i=1;i<e.length;i++){const r=xe(e[i],t);n.push(r)}return new ve(r,n)}evaluate(e,t){if(this.type===O)return Boolean(this._args[0].evaluate(e,t));if(this.type===R)return z(this._args[0].evaluate(e,t));if(this.type===A){for(const i of this._args){const r=Number(i.evaluate(e,t));if(!isNaN(r))return r}return null}if(this.type===P){for(const i of this._args)try{const r=ve.toColor(i.evaluate(e,t));if(r instanceof T.Z)return r}catch{}return null}}static toBoolean(e){return Boolean(e)}static toString(e){return z(e)}static toNumber(e){const t=Number(e);if(isNaN(t))throw new Error(`"${e}" is not a number`);return t}static toColor(e){if(e instanceof T.Z)return e;if("string"==typeof e){const t=T.Z.fromString(e);if(t)return t;throw new Error(`"${e}" is not a color`)}if(Array.isArray(e))return T.Z.fromArray(e);throw new Error(`"${e}" is not a color`)}}ve.types={"to-boolean":O,"to-color":P,"to-number":A,"to-string":R};class be{constructor(e){this._val=e,this.type=U(e)}static parse(e){if(2!==e.length)throw new Error('"literal" expects 1 argument');return new be(e[1])}evaluate(e,t){return this._val}}class we{constructor(e){this._arg=e,this.type=R}static parse(e,t){if(2!==e.length)throw new Error('"typeof" expects 1 argument');return new we(xe(e[1],t))}evaluate(e,t){return F(U(this._arg.evaluate(e,t)))}}function xe(e,t,i){const r=typeof e;if("string"===r||"boolean"===r||"number"===r||null===e){if(i)switch(i.kind){case"string":"string"!==r&&(e=ve.toString(e));break;case"number":"number"!==r&&(e=ve.toNumber(e));break;case"color":e=ve.toColor(e)}e=["literal",e]}if(!Array.isArray(e)||0===e.length)throw new Error("Expression must be a non empty array");const n=e[0];if("string"!=typeof n)throw new Error("First element of expression must be a string");const s=Te[n];if(void 0===s)throw new Error(`Invalid expression operator "${n}"`);if(!s)throw new Error(`Unimplemented expression operator "${n}"`);return s.parse(e,t,i)}const Te={array:_e,boolean:_e,collator:null,format:null,image:null,literal:be,number:_e,"number-format":null,object:_e,string:_e,"to-boolean":ve,"to-color":ve,"to-number":ve,"to-string":ve,typeof:we,accumulated:null,"feature-state":null,"geometry-type":H,id:V,"line-progress":null,properties:G,at:re,get:ne,has:se,in:oe,"index-of":ae,length:le,slice:ce,"!":q,"!=":class extends Z{static parse(e,t){return Z.parse(e,t,((e,t)=>e!==t))}},"<":class extends Z{static parse(e,t){return Z.parse(e,t,((e,t)=>e<t))}},"<=":class extends Z{static parse(e,t){return Z.parse(e,t,((e,t)=>e<=t))}},"==":class extends Z{static parse(e,t){return Z.parse(e,t,((e,t)=>e===t))}},">":class extends Z{static parse(e,t){return Z.parse(e,t,((e,t)=>e>t))}},">=":class extends Z{static parse(e,t){return Z.parse(e,t,((e,t)=>e>=t))}},all:W,any:$,case:J,coalesce:X,match:K,within:null,interpolate:Q,"interpolate-hcl":Q,"interpolate-lab":Q,step:ee,let:te,var:ie,concat:pe,downcase:fe,"is-supported-script":null,"resolved-locale":null,upcase:fe,rgb:me,rgba:ge,"to-rgba":ye,"-":class extends he{static parse(e,t){switch(e.length){case 2:return he.parse(e,t,(e=>-e[0]));case 3:return he.parse(e,t,(e=>e[0]-e[1]));default:throw new Error('"-" expects 1 or 2 arguments')}}},"*":class extends he{static parse(e,t){return he.parse(e,t,(e=>{let t=1;for(const i of e)t*=i;return t}))}},"/":class extends he{static parse(e,t){if(3===e.length)return he.parse(e,t,(e=>e[0]/e[1]));throw new Error('"/" expects 2 arguments')}},"%":class extends he{static parse(e,t){if(3===e.length)return he.parse(e,t,(e=>e[0]%e[1]));throw new Error('"%" expects 2 arguments')}},"^":class extends he{static parse(e,t){if(3===e.length)return he.parse(e,t,(e=>e[0]**e[1]));throw new Error('"^" expects 1 or 2 arguments')}},"+":class extends he{static parse(e,t){return he.parse(e,t,(e=>{let t=0;for(const i of e)t+=i;return t}))}},abs:de,acos:de,asin:de,atan:de,ceil:de,cos:de,e:de,floor:de,ln:de,ln2:de,log10:de,log2:de,max:de,min:de,pi:de,round:de,sin:de,sqrt:de,tan:de,zoom:j,"heatmap-density":null,"has-id":ue,none:Y};class Ce{constructor(e){this._expression=e}filter(e,t){if(!this._expression)return!0;try{return this._expression.evaluate(e,t)}catch(e){return console.log(e.message),!0}}static createFilter(e){if(!e)return null;this.isLegacyFilter(e)&&(e=this.convertLegacyFilter(e));try{const t=xe(e,null,O);return new Ce(t)}catch(e){return console.log(e.message),null}}static isLegacyFilter(e){if(!Array.isArray(e))return!0;if(0===e.length)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===e.length&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"in":return e.length>=3&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"!in":case"none":case"!has":return!0;case"any":case"all":for(let t=1;t<e.length;t++)if(this.isLegacyFilter(e[t]))return!0;return!1;case"has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);default:return!1}}static convertLegacyFilter(e){if(!Array.isArray(e)||0===e.length)return!0;const t=e[0];if(1===e.length)return"any"!==t;switch(t){case"==":return Ce.convertComparison("==",e[1],e[2]);case"!=":return Ce.negate(Ce.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return Ce.convertComparison(t,e[1],e[2]);case"in":return Ce.convertIn(e[1],e.slice(2));case"!in":return Ce.negate(Ce.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return Ce.convertCombining(t,e.slice(1));case"has":return Ce.convertHas(e[1]);case"!has":return Ce.negate(Ce.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}}static convertComparison(e,t,i){switch(t){case"$type":return[e,["geometry-type"],i];case"$id":return[e,["id"],i];default:return[e,["get",t],i]}}static convertIn(e,t){switch(e){case"$type":return["in",["geometry-type"],["literal",t]];case"$id":return["in",["id"],["literal",t]];default:return["in",["get",e],["literal",t]]}}static convertHas(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}}static convertCombining(e,t){return[e].concat(t.map(this.convertLegacyFilter))}static negate(e){return["!",e]}}var Se=i(93712);class Ee{constructor(e,t){let i;switch(this.isDataDriven=!1,this.interpolator=null,e.type){case"number":case"color":i=!0;break;case"array":i="number"===e.value;break;default:i=!1}if(null==t&&(t=e.default),Array.isArray(t)&&t.length>0&&Te[t[0]]){const i={number:A,color:P,string:R,boolean:O,enum:R};try{const r=xe(t,null,"array"===e.type?D(i[e.value]||L,e.length):i[e.type]);this.getValue=this._buildExpression(r,e),this.isDataDriven=!0,r instanceof Q&&r.input instanceof j&&(this.interpolator=r)}catch(t){console.log(t.message),this.getValue=this._buildSimple(e.default)}return}i&&"interval"===t.type&&(i=!1);const r=t?.stops&&t.stops.length>0;if(r)for(const i of t.stops)i[1]=this._validate(i[1],e);if(this.isDataDriven=!!t&&!!t.property,this.isDataDriven)if(void 0!==t.default&&(t.default=this._validate(t.default,e)),r)switch(t.type){case"identity":this.getValue=this._buildIdentity(t,e);break;case"categorical":this.getValue=this._buildCategorical(t,e);break;default:this.getValue=i?this._buildInterpolate(t,e):this._buildInterval(t,e)}else this.getValue=this._buildIdentity(t,e);else r?this.getValue=i?this._buildZoomInterpolate(t):this._buildZoomInterval(t):(t=this._validate(t,e),this.getValue=this._buildSimple(t))}_validate(e,t){if("number"===t.type){if(null!=t.minimum&&e<t.minimum)return t.minimum;if(null!=t.maximum&&e>t.maximum)return t.maximum}else"color"===t.type?e=Ee._parseColor(e):"enum"===t.type?"string"==typeof e&&(e=t.values.indexOf(e)):"array"===t.type&&"enum"===t.value?e=e.map((e=>"string"==typeof e?t.values.indexOf(e):e)):"string"===t.type&&(e=z(e));return e}_buildSimple(e){return()=>e}_buildExpression(e,t){return(i,r)=>{try{const n=e.evaluate(r,i);return void 0===n?t.default:this._validate(n,t)}catch(e){return console.log(e.message),t.default}}}_buildIdentity(e,t){return(i,r)=>{let n;return r&&(n=r.values[e.property]),void 0!==n&&(n=this._validate(n,t)),null!=n?n:void 0!==e.default?e.default:t.default}}_buildCategorical(e,t){return(i,r)=>{let n;return r&&(n=r.values[e.property]),n=this._categorical(n,e.stops),void 0!==n?n:void 0!==e.default?e.default:t.default}}_buildInterval(e,t){return(i,r)=>{let n;return r&&(n=r.values[e.property]),"number"==typeof n?this._interval(n,e.stops):void 0!==e.default?e.default:t.default}}_buildInterpolate(e,t){return(i,r)=>{let n;return r&&(n=r.values[e.property]),"number"==typeof n?this._interpolate(n,e.stops,e.base||1):void 0!==e.default?e.default:t.default}}_buildZoomInterpolate(e){return t=>this._interpolate(t,e.stops,e.base||1)}_buildZoomInterval(e){return t=>this._interval(t,e.stops)}_categorical(e,t){const i=t.length;for(let r=0;r<i;r++)if(t[r][0]===e)return t[r][1]}_interval(e,t){const i=t.length;let r=0;for(let n=0;n<i&&t[n][0]<=e;n++)r=n;return t[r][1]}_interpolate(e,t,i){let r,n;const s=t.length;for(let i=0;i<s;i++){const s=t[i];if(!(s[0]<=e)){n=s;break}r=s}if(r&&n){const t=n[0]-r[0],s=e-r[0],o=1===i?s/t:(i**s-1)/(i**t-1);if(Array.isArray(r[1])){const e=r[1],t=n[1],i=[];for(let r=0;r<e.length;r++)i.push((0,a.sX)(e[r],t[r],o));return i}return(0,a.sX)(r[1],n[1],o)}return r?r[1]:n?n[1]:void 0}static _isEmpty(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}static _parseColor(e){return Array.isArray(e)?e:("string"==typeof e&&(e=new T.Z(e)),e instanceof T.Z&&!this._isEmpty(e)?T.Z.toUnitRGBA(e):void 0)}}var Me=i(14266);var Ae;!function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"}(Ae||(Ae={}));class Re{constructor(e,t,i,r,n,s){this.layer=e,this.feature=t,this.bounds=i,this.normalizationRatio=r,this.normalizationOffsetX=n,this.normalizationOffsetY=s}}class Oe{constructor(e,t,i,r){switch(this.type=e,this.typeName=t.type,this.id=t.id,this.source=t.source,this.sourceLayer=t["source-layer"],this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.filter=t.filter,this.layout=t.layout,this.paint=t.paint,this.z=i,this.uid=r,e){case Se.fR.BACKGROUND:this._layoutDefinition=Se.f2.backgroundLayoutDefinition,this._paintDefinition=Se.f2.backgroundPaintDefinition;break;case Se.fR.FILL:this._layoutDefinition=Se.f2.fillLayoutDefinition,this._paintDefinition=Se.f2.fillPaintDefinition;break;case Se.fR.LINE:this._layoutDefinition=Se.f2.lineLayoutDefinition,this._paintDefinition=Se.f2.linePaintDefinition;break;case Se.fR.SYMBOL:this._layoutDefinition=Se.f2.symbolLayoutDefinition,this._paintDefinition=Se.f2.symbolPaintDefinition;break;case Se.fR.CIRCLE:this._layoutDefinition=Se.f2.circleLayoutDefinition,this._paintDefinition=Se.f2.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=Ce.createFilter(this.filter)}getLayoutProperty(e){return this._layoutProperties[e]}getPaintProperty(e){return this._paintProperties[e]}getLayoutValue(e,t,i){let r;const n=this._layoutProperties[e];return n&&(r=n.getValue(t,i)),void 0===r&&(r=this._layoutDefinition[e].default),r}getPaintValue(e,t,i){let r;const n=this._paintProperties[e];return n&&(r=n.getValue(t,i)),void 0===r&&(r=this._paintDefinition[e].default),r}isPainterDataDriven(){const e=this._paintProperties;if(e)for(const t in e)if(e[t].isDataDriven)return!0;return!1}isIntersectingFeature(e,t,i,r,n,s,o){return!1}getFeatureInflatedBounds(e,t,i,r){return null}_parseLayout(e){const t={};for(const i in e){const r=this._layoutDefinition[i];r&&(t[i]=new Ee(r,e[i]))}return t}_parsePaint(e){const t={};for(const i in e){const r=this._paintDefinition[i];r&&(t[i]=new Ee(r,e[i]))}return t}computeAttributesKey(e,t,i,r){let n=0,s=0;for(const e of t){let t=3;if(!e||e!==r){const r=i[e],{isLayout:n,isOptional:s}=r,o=n?this.getLayoutProperty(e):this.getPaintProperty(e);t=o?.interpolator?2:o?.isDataDriven?1:s&&!o?3:0}s|=t<<n,n+=2}return s<<3|e}}class Pe extends Oe{constructor(e,t,i,r){super(e,t,i,r),this.backgroundMaterial=new f(this.computeAttributesKey(o._K.BACKGROUND,f.ATTRIBUTES,f.ATTRIBUTES_INFO))}}class Ie extends Oe{constructor(e,t,i,r){super(e,t,i,r);const n=this.getPaintProperty("fill-color"),s=this.getPaintProperty("fill-opacity"),a=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=n?.isDataDriven,this.hasDataDrivenOpacity=s?.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||a?.isDataDriven;const l=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!l,this.hasDataDrivenOutlineColor=l?.isDataDriven,this.hasDataDrivenOutline=l?l.isDataDriven:!!n&&n.isDataDriven,this.hasDataDrivenOutline=(l?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new g(this.computeAttributesKey(o._K.FILL,g.ATTRIBUTES,g.ATTRIBUTES_INFO)),this.outlineMaterial=new y(this.computeAttributesKey(o._K.OUTLINE,this.outlineUsesFillColor?y.ATTRIBUTES_FILL:y.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?y.ATTRIBUTES_INFO_FILL:y.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(e,t,i,r){const n=ke(e);if(!n)return null;const s=this.getPaintValue("fill-translate",t,e),o=r*Math.max(s[0],s[1]);return n[0]-=o,n[2]-=o,n[1]+=o,n[3]+=o,n}isIntersectingFeature(e,t,i,r,n,s,o){const l=r.getGeometry();if(!l)return!1;const c=8/o.normalizationRatio;e=e/o.normalizationRatio+o.normalizationOffsetX,t=t/o.normalizationRatio+o.normalizationOffsetY;const u=(0,a.Wg)(this.getPaintValue("fill-translate",n,r),this.getPaintValue("fill-translate-anchor",n,r),s,8);return e-=c*u.x,t-=c*u.y,!!(0,a.Of)(e,t,l)||(0,a.Z0)(e,t,l,c*i)}}class Le extends Oe{constructor(e,t,i,r){super(e,t,i,r);const n=this.getPaintProperty("line-pattern");if(this.lineMaterial=new _(this.computeAttributesKey(o._K.LINE,_.ATTRIBUTES,_.ATTRIBUTES_INFO,n?"line-dasharray":"")),this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven,this.canUseThinTessellation=!1,!this.hasDataDrivenLine){const e=this.getPaintProperty("line-width");if(!e||"number"==typeof e&&.5*e<Me.do){const e=this.getPaintProperty("line-offset");(!e||"number"==typeof e&&0===e)&&(this.canUseThinTessellation=!0)}}}getDashKey(e,t){let i;switch(t){case Ae.BUTT:i="Butt";break;case Ae.ROUND:i="Round";break;case Ae.SQUARE:i="Square";break;default:i="Butt"}return`dasharray-[${e.toString()}]-${i}`}getFeatureInflatedBounds(e,t,i,r){const n=ke(e);if(!n)return null;const s=this.getPaintValue("line-translate",t,e),o=r*Math.max(s[0],s[1]);n[0]-=o,n[2]-=o,n[1]+=o,n[3]+=o;const a=r*Math.abs(this.getPaintValue("line-offset",t,e)||0),l=r*(this.getPaintValue("line-width",t,e)/2);return n[0]-=a+l,n[1]-=a+l,n[2]+=a+l,n[3]+=a+l,n}isIntersectingFeature(e,t,i,r,n,s,o){let l=r.getGeometry();if(!l)return!1;const c=8/o.normalizationRatio;e=e/o.normalizationRatio+o.normalizationOffsetX,t=t/o.normalizationRatio+o.normalizationOffsetY;const u=(0,a.Wg)(this.getPaintValue("line-translate",n,r),this.getPaintValue("line-translate-anchor",n,r),s,8);e-=c*u.x,t-=c*u.y;const h=c*this.getPaintValue("line-offset",n,r)||0;0!==h&&(l=(0,a.pK)(l,-h));const d=this.getPaintValue("line-width",n,r);return(0,a.Z0)(e,t,l,c*(i+d/2))}}class De extends Oe{constructor(e,t,i,r){super(e,t,i,r),this.iconMaterial=new w(this.computeAttributesKey(o._K.ICON,w.ATTRIBUTES,w.ATTRIBUTES_INFO)),this.textMaterial=new x(this.computeAttributesKey(o._K.TEXT,x.ATTRIBUTES,x.ATTRIBUTES_INFO)),this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven,this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}}class Ne extends Oe{constructor(e,t,i,r){super(e,t,i,r),this.circleMaterial=new m(this.computeAttributesKey(o._K.CIRCLE,m.ATTRIBUTES,m.ATTRIBUTES_INFO))}getFeatureInflatedBounds(e,t,i,r){const n=ke(e);if(!n)return null;const s=this.getPaintValue("circle-translate",t,e),o=Math.max(s[0],s[1]);n[0]-=o,n[2]-=o,n[1]+=o,n[3]+=o;const a=r*(8*(this.getPaintValue("circle-radius",t,e)+this.getPaintValue("circle-stroke-width",t,e))/2);return n[0]-=a,n[1]-=a,n[2]+=a,n[3]+=a,n}isIntersectingFeature(e,t,i,r,n,s,o){const l=r.getGeometry();if(!l)return!1;const c=8/o.normalizationRatio;e=e/o.normalizationRatio+o.normalizationOffsetX,t=t/o.normalizationRatio+o.normalizationOffsetY,i*=c;const u=(0,a.Wg)(this.getPaintValue("circle-translate",n,r),this.getPaintValue("circle-translate-anchor",n,r),s,c),h=c*(this.getPaintValue("circle-radius",n,r)+this.getPaintValue("circle-stroke-width",n,r));let d,p;for(const r of l)if(r)for(const n of r)if(d=n.x+u.x,p=n.y+u.y,Math.sqrt((e-d)*(e-d)+(t-p)*(t-p))-i<=h)return!0;return!1}}class Fe{constructor(e,t,i){let r;this.allowOverlap=e.getLayoutValue("icon-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("icon-ignore-placement",t),this.keepUpright=e.getLayoutValue("icon-keep-upright",t),this.optional=e.getLayoutValue("icon-optional",t),this.rotationAlignment=e.getLayoutValue("icon-rotation-alignment",t),this.rotationAlignment===Se.aF.AUTO&&(this.rotationAlignment=i?Se.aF.MAP:Se.aF.VIEWPORT),r=e.getLayoutProperty("icon-anchor"),r?.isDataDriven?this._anchorProp=r:this.anchor=e.getLayoutValue("icon-anchor",t),r=e.getLayoutProperty("icon-offset"),r?.isDataDriven?this._offsetProp=r:this.offset=e.getLayoutValue("icon-offset",t),r=e.getLayoutProperty("icon-padding"),r?.isDataDriven?this._paddingProp=r:this.padding=e.getLayoutValue("icon-padding",t),r=e.getLayoutProperty("icon-rotate"),r?.isDataDriven?this._rotateProp=r:this.rotate=e.getLayoutValue("icon-rotate",t),r=e.getLayoutProperty("icon-size"),r?.isDataDriven?this._sizeProp=r:this.size=e.getLayoutValue("icon-size",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t))}}class Ue{constructor(e,t,i){let r;this.allowOverlap=e.getLayoutValue("text-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("text-ignore-placement",t),this.keepUpright=e.getLayoutValue("text-keep-upright",t),this.optional=e.getLayoutValue("text-optional",t),this.rotationAlignment=e.getLayoutValue("text-rotation-alignment",t),this.rotationAlignment===Se.aF.AUTO&&(this.rotationAlignment=i?Se.aF.MAP:Se.aF.VIEWPORT),r=e.getLayoutProperty("text-anchor"),r?.isDataDriven?this._anchorProp=r:this.anchor=e.getLayoutValue("text-anchor",t),r=e.getLayoutProperty("text-justify"),r?.isDataDriven?this._justifyProp=r:this.justify=e.getLayoutValue("text-justify",t),r=e.getLayoutProperty("text-letter-spacing"),r?.isDataDriven?this._letterSpacingProp=r:this.letterSpacing=e.getLayoutValue("text-letter-spacing",t),r=e.getLayoutProperty("text-line-height"),r?.isDataDriven?this._lineHeightProp=r:this.lineHeight=e.getLayoutValue("text-line-height",t),r=e.getLayoutProperty("text-max-angle"),r?.isDataDriven?this._maxAngleProp=r:this.maxAngle=e.getLayoutValue("text-max-angle",t),r=e.getLayoutProperty("text-max-width"),r?.isDataDriven?this._maxWidthProp=r:this.maxWidth=e.getLayoutValue("text-max-width",t),r=e.getLayoutProperty("text-offset"),r?.isDataDriven?this._offsetProp=r:this.offset=e.getLayoutValue("text-offset",t),r=e.getLayoutProperty("text-padding"),r?.isDataDriven?this._paddingProp=r:this.padding=e.getLayoutValue("text-padding",t),r=e.getLayoutProperty("text-rotate"),r?.isDataDriven?this._rotateProp=r:this.rotate=e.getLayoutValue("text-rotate",t),r=e.getLayoutProperty("text-size"),r?.isDataDriven?this._sizeProp=r:this.size=e.getLayoutValue("text-size",t),r=e.getLayoutProperty("text-writing-mode"),r?.isDataDriven?this._writingModeProp=r:this.writingMode=e.getLayoutValue("text-writing-mode",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,t)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,t)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,t)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,t)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,t))}}function ke(e){const t=e?.getGeometry();if(null==t)return null;let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const e of t)if(e)for(const t of e)i=Math.min(i,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y);return(0,s.al)(i,r,n,o)}},63043:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(93712),n=i(18897);class s{constructor(e){if(this._style=e,this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,e.layers||(e.layers=[]),this.version=parseFloat(e.version),this.layers=e.layers.map(((e,t,i)=>this._create(e,t,i))).filter((e=>!!e)),this.layers)for(let e=0;e<this.layers.length;e++){const t=this.layers[e];this._layerByName[t.id]=t,this._uidToLayer.set(t.uid,t),t.type===r.fR.BACKGROUND&&this.backgroundBucketIds.push(t.id)}this._identifyRefLayers()}isPainterDataDriven(e){const t=this._layerByName[e];return!!t&&t.isPainterDataDriven()}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){return this._uidToLayer.get(e)??null}getStyleLayerIndex(e){const t=this._layerByName[e];return t?this.layers.indexOf(t):-1}setStyleLayer(e,t){if(!e?.id)return;const i=this._style;null!=t&&t>=this.layers.length&&(t=this.layers.length-1);let r,n=!0;const o=this._layerByName[e.id];if(o){const a=this.layers.indexOf(o);t||(t=a),t===a?(n=!1,r=s._recreateLayer(e,o),this.layers[t]=r,i.layers[t]=e):(this.layers.splice(a,1),i.layers.splice(a,1),r=this._create(e,t,this.layers),this.layers.splice(t,0,r),i.layers.splice(t,0,e))}else r=this._create(e,t,this.layers),!t||t>=this.layers.length?(this.layers.push(r),i.layers.push(e)):(this.layers.splice(t,0,r),i.layers.splice(t,0,e));this._layerByName[e.id]=r,this._uidToLayer.set(r.uid,r),n&&this._recomputeZValues(),this._identifyRefLayers()}getStyleLayer(e){const t=this._layerByName[e];return t?{type:t.typeName,id:t.id,source:t.source,"source-layer":t.sourceLayer,minzoom:t.minzoom,maxzoom:t.maxzoom,filter:t.filter,layout:t.layout,paint:t.paint}:null}deleteStyleLayer(e){const t=this._layerByName[e];if(t){delete this._layerByName[e],this._uidToLayer.delete(t.uid);const i=this.layers.indexOf(t);this.layers.splice(i,1),this._style.layers.splice(i,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(e){return this._layerByName[e]}getLayoutProperties(e){const t=this._layerByName[e];return t?t.layout:null}getPaintProperties(e){const t=this._layerByName[e];return t?t.paint:null}setPaintProperties(e,t){const i=this._layerByName[e];if(!i)return;const r={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:i.layout,paint:t},n=s._recreateLayer(r,i),o=this.layers.indexOf(i);this.layers[o]=n,this._style.layers[o].paint=t,this._layerByName[i.id]=n,this._uidToLayer.set(i.uid,n)}setLayoutProperties(e,t){const i=this._layerByName[e];if(!i)return;const r={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:t,paint:i.paint},n=s._recreateLayer(r,i),o=this.layers.indexOf(i);this.layers[o]=n,this._style.layers[o].layout=t,this._layerByName[i.id]=n,this._uidToLayer.set(i.uid,n)}setStyleLayerVisibility(e,t){const i=this._layerByName[e];if(!i)return;const r=i.layout||{};r.visibility=t;const n={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:r,paint:i.paint},o=s._recreateLayer(n,i),a=this.layers.indexOf(i);this.layers[a]=o,this._style.layers[a].layout=r,this._layerByName[i.id]=o,this._uidToLayer.set(i.uid,o)}getStyleLayerVisibility(e){const t=this._layerByName[e];if(!t)return"none";return t.layout?.visibility??"visible"}_recomputeZValues(){const e=this.layers,t=1/(e.length+1);for(let i=0;i<e.length;i++)e[i].z=1-(1+i)*t}_identifyRefLayers(){const e=[],t=[];let i=0;for(const n of this.layers){const s=n.layout;if(n.type===r.fR.FILL){const t=n;let r=n.source+"|"+n.sourceLayer;r+="|"+(s?.visibility??""),r+="|"+n.minzoom,r+="|"+n.maxzoom,r+="|"+JSON.stringify(n.filter),(t.hasDataDrivenFill||t.hasDataDrivenOutline)&&(r+="|"+i),e.push({key:r,layer:n})}else if(n.type===r.fR.LINE){const e=n,r=n.paint,o=null!=r&&(null!=r["line-pattern"]||null!=r["line-dasharray"]);let a=n.source+"|"+n.sourceLayer;a+="|"+(s?.visibility??""),a+="|"+n.minzoom,a+="|"+n.maxzoom,a+="|"+JSON.stringify(n.filter),a+="|"+(void 0!==s?s["line-cap"]:""),a+="|"+(void 0!==s?s["line-join"]:""),(e.hasDataDrivenLine||o)&&(a+="|"+i),t.push({key:a,layer:n})}++i}this._assignRefLayers(e),this._assignRefLayers(t)}_assignRefLayers(e){let t,i;e.sort(((e,t)=>e.key<t.key?-1:e.key>t.key?1:0));const n=e.length;for(let s=0;s<n;s++){const o=e[s];if(o.key===t)o.layer.refLayerId=i;else if(t=o.key,i=o.layer.id,o.layer.type===r.fR.FILL){if(!o.layer.getPaintProperty("fill-outline-color"))for(let r=s+1;r<n;r++){const n=e[r];if(n.key!==t)break;if(n.layer.getPaintProperty("fill-outline-color")){e[s]=n,e[r]=o,i=n.layer.id;break}}}else if(o.layer.type===r.fR.LINE){let r=o.layer;for(let a=s+1;a<n;a++){const n=e[a];if(n.key!==t)break;const l=n.layer;(r.canUseThinTessellation&&!l.canUseThinTessellation||!r.canUseThinTessellation&&(l.getPaintProperty("line-pattern")||l.getPaintProperty("line-dasharray")))&&(r=l,e[s]=n,e[a]=o,i=n.layer.id)}}}}_create(e,t,i){const s=1-(1+t)*(1/(i.length+1)),o=this._runningId++;switch(e.type){case"background":return new n.Et(r.fR.BACKGROUND,e,s,o);case"fill":return new n.Le(r.fR.FILL,e,s,o);case"line":return new n.gf(r.fR.LINE,e,s,o);case"symbol":return new n.jG(r.fR.SYMBOL,e,s,o);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new n.sj(r.fR.CIRCLE,e,s,o)}return null}static _recreateLayer(e,t){switch(e.type){case"background":return new n.Et(r.fR.BACKGROUND,e,t.z,t.uid);case"fill":return new n.Le(r.fR.FILL,e,t.z,t.uid);case"line":return new n.gf(r.fR.LINE,e,t.z,t.uid);case"symbol":return new n.jG(r.fR.SYMBOL,e,t.z,t.uid);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new n.sj(r.fR.CIRCLE,e,t.z,t.uid)}return null}}},27894:(e,t,i)=>{i.d(t,{As:()=>o,cD:()=>a,sy:()=>s});var r=i(91907),n=i(41163);const s=new Map([["geometry",[new n.G("a_pos",2,r.g.BYTE,0,2)]]]),o=new Map([["geometry",[new n.G("a_pos",2,r.g.BYTE,0,4),new n.G("a_tex",2,r.g.BYTE,2,4)]]]),a=new Map([["geometry",[new n.G("a_pos",2,r.g.UNSIGNED_SHORT,0,4)]]])},8556:(e,t,i)=>{i.d(t,{H:()=>s});var r=i(38642),n=i(27954);class s extends n.I{_createTransforms(){return{displayViewScreenMat3:(0,r.Ue)(),tileMat3:(0,r.Ue)()}}}},38779:(e,t,i)=>{i.d(t,{y:()=>r});class r{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const t=[];for(const i of this._candidateTiles)e>0?(i.reshuffle(),e--):t.push(i);this._candidateTiles=t}}},27954:(e,t,i)=>{i.d(t,{I:()=>o});var r=i(46332),n=i(51118),s=i(87241);class o extends n.s{constructor(e,t,i,r,n,o,a=n,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new s.Z(e),this.resolution=t,this.x=i,this.y=r,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const t=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*t,a=this.height/this.rangeY*t;(0,r.t8)(i,o,0,0,0,a,0,n,s,1),(0,r.Jp)(this.transforms.displayViewScreenMat3,e.displayViewMat3,i)}get destroyed(){return this._destroyed}}},14266:(e,t,i)=>{i.d(t,{$0:()=>z,A5:()=>Q,BZ:()=>W,FM:()=>B,GV:()=>X,IZ:()=>E,Ib:()=>d,J1:()=>Y,JS:()=>G,KA:()=>j,Kt:()=>u,Ly:()=>y,NG:()=>q,NT:()=>ee,NY:()=>p,Of:()=>T,Pp:()=>o,S3:()=>P,Sf:()=>x,Uz:()=>Z,Vo:()=>F,Vy:()=>b,Xn:()=>V,Zt:()=>w,_8:()=>K,_E:()=>N,aV:()=>H,ad:()=>s,bm:()=>m,ce:()=>_,cz:()=>v,dD:()=>D,do:()=>R,fG:()=>L,g3:()=>M,gj:()=>c,i9:()=>n,iA:()=>k,iD:()=>l,iG:()=>te,j1:()=>g,k9:()=>r,kU:()=>A,l3:()=>J,nn:()=>$,pd:()=>I,s4:()=>U,uk:()=>a,vk:()=>C,wJ:()=>h,wN:()=>O,wi:()=>S,wv:()=>ie,zZ:()=>f});const r=1e-30,n=512,s=16777216,o=8,a=29,l=24,c=4,u=0,h=0,d=0,p=1,f=2,m=3,g=4,y=5,_=6,v=12,b=13,w=5,x=6,T=5,C=6;var S;!function(e){e[e.FilterFlags=0]="FilterFlags",e[e.Animation=1]="Animation",e[e.GPGPU=2]="GPGPU",e[e.VV=3]="VV",e[e.DD0=4]="DD0",e[e.DD1=5]="DD1",e[e.DD2=6]="DD2",e[e.LocalTimeOrigin=7]="LocalTimeOrigin"}(S||(S={}));const E=6,M=1<<E,A=M<<1,R=1.05,O=3,P=1,I=3,L=3,D=5,N=6,F=1.15,U=4,k=128,z=256-2*U,B=2,V=128,H=1,G=10,j=1024,Z=128,q=4,W=1,$=1<<20,Y=.75,J=10,X=.75,K=256,Q=32,ee=512,te=0,ie=1},28434:(e,t,i)=>{i.d(t,{bM:()=>n,dl:()=>s,iq:()=>o,pW:()=>r});const r=1,n=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=256},38716:(e,t,i)=>{var r,n,s,o,a,l,c,u,h;i.d(t,{CU:()=>s,Un:()=>a,Xq:()=>c,gl:()=>u,jx:()=>n,mH:()=>h}),function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT",e[e.LABEL=4]="LABEL"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.MAP=1]="MAP",e[e.LABEL=2]="LABEL",e[e.LABEL_ALPHA=4]="LABEL_ALPHA",e[e.HITTEST=8]="HITTEST",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.CLIP=32]="CLIP",e[e.DEBUG=64]="DEBUG",e[e.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(n||(n={})),function(e){e[e.SIZE=0]="SIZE",e[e.COLOR=1]="COLOR",e[e.OPACITY=2]="OPACITY",e[e.ROTATION=3]="ROTATION"}(s||(s={})),function(e){e[e.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",e[e.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",e[e.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",e[e.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(o||(o={})),function(e){e[e.SPRITE=0]="SPRITE",e[e.GLYPH=1]="GLYPH"}(a||(a={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SIMPLE=1]="SIMPLE",e[e.DOT_DENSITY=2]="DOT_DENSITY",e[e.OUTLINE_FILL=3]="OUTLINE_FILL",e[e.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",e[e.HEATMAP=5]="HEATMAP",e[e.PIE_CHART=6]="PIE_CHART"}(l||(l={})),function(e){e[e.All=0]="All",e[e.Highlight=1]="Highlight",e[e.InsideEffect=2]="InsideEffect",e[e.OutsideEffect=3]="OutsideEffect"}(c||(c={})),function(e){e[e.BATCHING=0]="BATCHING",e[e.STRICT_ORDER=1]="STRICT_ORDER",e[e.STRICT_MARKERS_AND_TEXT=2]="STRICT_MARKERS_AND_TEXT"}(u||(u={})),function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT"}(h||(h={}))},32676:(e,t,i)=>{i.d(t,{H6:()=>_,VF:()=>d,il:()=>h,l5:()=>g,rO:()=>y,vY:()=>m,wb:()=>v,yF:()=>u});var r=i(17321),n=i(14266),s=i(38716),o=i(91907);const a={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:e=>e.stencilRef,compare:o.wb.EQUAL,mask:255,op:{fail:o.xS.KEEP,zFail:o.xS.KEEP,zPass:o.xS.REPLACE}}}},l={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},c={...a,color:{write:[!0,!0,!0,!0],blendMode:"delete"}};function u({pixelRatio:e,state:t,displayLevel:i,requiredLevel:n},s){const o=1/2**(i-s.key.level),a=1/2**(n-s.key.level);return{displayMat3:t.displayMat3,displayViewMat3:t.displayViewMat3,displayViewScreenMat3:s.transforms.displayViewScreenMat3,viewMat3:t.viewMat3,tileMat3:s.transforms.tileMat3,displayZoomFactor:o,requiredZoomFactor:a,tileOffset:[s.x,s.y],currentScale:t.scale,currentZoom:i,metersPerSRUnit:(0,r.c9)(t.spatialReference),rotation:t.rotation,pixelRatio:e}}function h(e){return"highlight"===e.passOptions?.type}function d(e){return"hittest"===e.passOptions?.type}function p(e){if(!d(e))return null;const{position:t,distance:i,smallSymbolDistance:r,smallSymbolSizeThreshold:n}=e.passOptions;return{position:t,distance:i,smallSymbolDistance:r,smallSymbolSizeThreshold:n}}function f(e){if(!h(e))return null;const{activeReasons:t,highlightAll:i}=e.passOptions;return{activeReasons:t,highlightAll:i?1:0}}function m(e,t,i){const r={};for(const n in i)i[n]instanceof Function?r[n]=i[n](e,t):r[n]=i[n];return r}function g(e,t){const{attributeView:i,context:r}=e;return{storage:i.getUniforms(r),view:u(e,t),hittestRequest:p(e),highlight:f(e)}}function y(e){return{inside:e.selection===s.Xq.InsideEffect,outside:e.selection===s.Xq.OutsideEffect}}function _(e){return d(e)?l:h(e)&&"clear"===e.passOptions.stepType?c:a}function v(e){const{row:t,col:i}=e.key,r=i*n.i9,s=t*n.i9;return{tileOffsetFromLocalOrigin:[r%n.ad,s%n.ad],maxIntsToLocalOrigin:[Math.floor(r/n.ad),Math.floor(s/n.ad)]}}},2290:(e,t,i)=>{i.d(t,{n:()=>l});var r=i(50904),n=i(24568),s=i(56836),o=i(31895),a=i(87241);class l{constructor(e,t){this.key=new a.Z(0,0,0,0),this.bounds=(0,n.Ue)(),this.objectIds=new Set,this.key.set(t);const i=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=i.resolution,this.level=i.level,this.scale=i.scale,this.minScale=e.zoomToScale(i.level-1),this.maxScale=e.zoomToScale(i.level+1)}get lod(){return this.tileInfoView.getLODInfoAt(this.key)}get id(){return this.key.id}get extent(){return(0,n.HH)(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createArcadeEvaluationOptions(e){return(0,o.o)(this.scale,e)}createChildTiles(){const e=this.key.getChildKeys(),t=r.Z.acquire();for(let i=0;i<e.length;i++)t[i]=new l(this.tileInfoView,e[i]);return t}getQuantizationParameters(){return s.Z.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}},31895:(e,t,i)=>{function r(e,{timeZone:t,timeExtent:i}){return{$view:{scale:e,timeZone:t,timeProperties:{currentStart:i?.start,currentEnd:i?.end}}}}i.d(t,{o:()=>r})},5709:(e,t,i)=>{i.d(t,{JF:()=>o,T7:()=>n,v4:()=>a,wj:()=>s});var r=i(39994);function n(){return(0,r.Z)("curve-densification-coarse-segments")}function s(){return(0,r.Z)("curve-densification-max-segments")}function o(){return(0,r.Z)("curve-densification-min-segments")}function a(){return(0,r.Z)("curve-densification-pixels-per-segment")}},41214:(e,t,i)=>{i.d(t,{JV:()=>w,GK:()=>x,EH:()=>C,P9:()=>T,oq:()=>b});var r=i(7753),n=i(41831),s=i(25709),o=i(32646),a=i(13802),l=i(14266),c=i(28434),u=i(57761),h=i(91907),d=i(43487),p=i(80479);const f=()=>a.Z.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");const m=[0,0,0,0];class g{constructor(){this.type="single",this._highlightOptions=new u.Z,this._convertedHighlightOptions={fillColor:[0,0,0,0],outlineColor:[0,0,0,0],outlinePosition:0,outlineWidth:0,innerHaloWidth:0,outerHaloWidth:0},this._optionsShadeTexKey="",this._texelData=new Uint8Array(4*c.iq),this._minMaxDistance=[0,0]}setHighlightOptions(e){this._highlightOptions=e}applyHighlightOptions(e,t){this._updateGradientTexture(e),e.bindTexture(this._shadeTex,l.Sf),t.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose(),this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<l.IZ)-1,activeGradient:this}]}_updateGradientTexture(e){const t=function(e){return`${e.color};${e.haloColor};${e.haloOpacity};${e.fillOpacity};${e.haloWidth};${e.haloBlur}`}(this._highlightOptions);if(t===this._optionsShadeTexKey)return;this._optionsShadeTexKey=t,function(e,t){t.fillColor[0]=e.color.r/255,t.fillColor[1]=e.color.g/255,t.fillColor[2]=e.color.b/255,t.fillColor[3]=e.color.a,e.haloColor?(t.outlineColor[0]=e.haloColor.r/255,t.outlineColor[1]=e.haloColor.g/255,t.outlineColor[2]=e.haloColor.b/255,t.outlineColor[3]=e.haloColor.a):(t.outlineColor[0]=t.fillColor[0],t.outlineColor[1]=t.fillColor[1],t.outlineColor[2]=t.fillColor[2],t.outlineColor[3]=t.fillColor[3]),t.fillColor[3]*=e.fillOpacity,t.outlineColor[3]*=e.haloOpacity,t.fillColor[0]*=t.fillColor[3],t.fillColor[1]*=t.fillColor[3],t.fillColor[2]*=t.fillColor[3],t.outlineColor[0]*=t.outlineColor[3],t.outlineColor[1]*=t.outlineColor[3],t.outlineColor[2]*=t.outlineColor[3],t.outlineWidth=(1-e.haloBlur)*e.haloWidth,t.outerHaloWidth=e.haloBlur*e.haloWidth/2,t.innerHaloWidth=e.haloBlur*e.haloWidth/2,t.outlinePosition=0}(this._highlightOptions,this._convertedHighlightOptions);const i=this._convertedHighlightOptions,r=i.outlinePosition-i.outlineWidth/2-i.outerHaloWidth,n=i.outlinePosition-i.outlineWidth/2,s=i.outlinePosition+i.outlineWidth/2,o=i.outlinePosition+i.outlineWidth/2+i.innerHaloWidth,a=Math.sqrt(Math.PI/2)*c.pW,l=Math.abs(r)>a?Math.round(10*(Math.abs(r)-a))/10:0,u=Math.abs(o)>a?Math.round(10*(Math.abs(o)-a))/10:0;let g;l&&!u?f().error("The outer rim of the highlight is "+l+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!l&&u?f().error("The inner rim of the highlight is "+u+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):l&&u&&f().error("The highlight is "+Math.max(l,u)+"px away from the edge of the feature; consider reducing some width values.");const y=[void 0,void 0,void 0,void 0];function _(e,t,i){y[0]=(1-i)*e[0]+i*t[0],y[1]=(1-i)*e[1]+i*t[1],y[2]=(1-i)*e[2]+i*t[2],y[3]=(1-i)*e[3]+i*t[3]}const{_texelData:v}=this;for(let e=0;e<c.iq;++e)g=r+e/(c.iq-1)*(o-r),g<r?(y[0]=0,y[1]=0,y[2]=0,y[3]=0):g<n?_(m,i.outlineColor,(g-r)/(n-r)):g<s?[y[0],y[1],y[2],y[3]]=i.outlineColor:g<o?_(i.outlineColor,i.fillColor,(g-s)/(o-s)):[y[0],y[1],y[2],y[3]]=i.fillColor,v[4*e]=255*y[0],v[4*e+1]=255*y[1],v[4*e+2]=255*y[2],v[4*e+3]=255*y[3];if(this._minMaxDistance[0]=r,this._minMaxDistance[1]=o,!this._shadeTex){const t=new p.X;t.wrapMode=h.e8.CLAMP_TO_EDGE,t.width=c.iq,t.height=1,this._shadeTex=new d.x(e,t)}this._shadeTex.updateData(0,0,0,c.iq,1,this._texelData)}}class y{constructor(){this.type="multi",this.gradients=[]}setHighlightOptions(e){for(let t=0;t<e.length;t++)this.gradients[t]||(this.gradients[t]=new g),this.gradients[t].setHighlightOptions(e[t]);for(let t=e.length+1;t<this.gradients.length;t++)this.gradients[t].destroy();this.gradients.length=e.length}destroy(){for(const e of this.gradients)e.destroy()}getReasonsWithGradients(){let e=1;const t=[];for(let i=0;i<this.gradients.length;i++){const r=this.gradients[i];t.push({activeReasons:e,activeGradient:r}),e<<=1}return t}}var _=i(32676);const v=new s.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function b(e){return v.toJSON(e)}function w(e){const{bandCount:t,attributeTable:i,colormap:r,pixelType:n}=e.raster.rasterInfo;return 1===t&&(null!=i||null!=r||"u8"===n||"s8"===n)}function x(e,t){return null==t?(e?.destroy(),null):("single"===e?.type&&Array.isArray(t)&&(e.destroy(),e=null),"multi"!==e?.type||Array.isArray(t)||(e.destroy(),e=null),e||(e=Array.isArray(t)?new y:new g),Array.isArray(t)?"multi"===e.type&&e.setHighlightOptions(t):"single"===e.type&&e.setHighlightOptions(t),e)}function T(e,t,i,r){const{painter:n,highlightGradient:s}=e,{highlight:o}=n.effects;if(!s)return;const a=e.passOptions,l=s.getReasonsWithGradients();for(let s=0;s<l.length;s++){const a={...e,passOptions:{type:"highlight",activeGradient:null!=r?l[r].activeGradient:l[s].activeGradient,activeReasons:l[s].activeReasons,stepType:"burn",highlightAll:t}};if(o.bind(a),i(a),s<l.length-1){let n=0;for(let e=s+1;e<l.length;e++)n|=l[e].activeReasons;i({...e,passOptions:{type:"highlight",activeGradient:null!=r?l[r].activeGradient:l[s].activeGradient,activeReasons:n,stepType:"clear",highlightAll:t}})}const c={...e,passOptions:{type:"highlight",activeGradient:null!=r?l[r].activeGradient:l[s].activeGradient,activeReasons:l[s].activeReasons,stepType:"draw",highlightAll:t}};n.setPipelineState((0,_.H6)(e)),n.updatePipelineState(e.context),o.draw(c),o.unbind()}e.passOptions=a}function C(e){if(!e)return[];let t=(0,o.Kf)(e)?[e]:n.Z.isCollection(e)?e.toArray():Array.isArray(e)?e:[];return t=t?.filter(r.pC),0===(t?.length??0)?[]:t}},9391:(e,t,i)=>{i.d(t,{O:()=>s});var r=i(39994),n=i(12928);function s(){const e=(0,r.Z)("mapview-essential-goto-duration");return null==e?e:(0,n.HA)(e)}},45479:(e,t,i)=>{i.d(t,{T:()=>r});class r{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),(e=>e.includes("Brush"))(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}}},44158:(e,t,i)=>{i.d(t,{A:()=>o,z:()=>s});var r=i(27127);const n=e=>parseFloat(e)/100;function s(e,t,i){const r="string"==typeof e.left?n(e.left)*t:e.left,s="string"==typeof e.right?n(e.right)*t:e.right,o="string"==typeof e.top?n(e.top)*i:e.top,a="string"==typeof e.bottom?n(e.bottom)*i:e.bottom,l=o;return{xmin:r,xmax:Math.max(t-s,r),ymin:l,ymax:Math.max(i-a,o)}}function o(e,t,i,n){switch(t.type){case"rect":{const{width:r,height:n}=e,{xmin:o,xmax:a,ymin:l,ymax:c}=s(t,r,n),{x:u,y:h}=i;return u>o&&u<a&&h>l&&h<c}case"path":return 0===t.path.length||!Array.isArray(t.path[0][0])||(0,r.wP)(t.path,[i.x,i.y]);case"geometry":return null==t.geometry||("polygon"===t.geometry.type?(0,r.CI)(t.geometry,n):(0,r.aV)(t.geometry,n))}}},88808:(e,t,i)=>{i.d(t,{A:()=>s,g:()=>o});var r=i(41831),n=i(57761);function s(e){if(!e.highlights)return null;const t=e.highlights.findIndex((e=>"default"===e.name));return-1===t?null:e.highlights.items[t]}function o(e,t){if(!e.highlights){if(!t)return;e.highlights=new r.Z([new n.Z])}const i=e.highlights.findIndex((e=>"default"===e.name));t?e.highlights.items[i].assignFrom(t):(e.highlights.removeAt(i),0===e.highlights.length&&(e.highlights=null))}},88782:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(34596),n=i(87241);class s{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:t,colFrom:i,colTo:r}of this.spans)for(let s=i;s<=r;s++){const i=e.getWorldForColumn(s);yield new n.Z(e.level,t,e.normalizeCol(s),i)}}forEach(e,t){const{spans:i,lodInfo:r}=this,{level:n}=r;if(0!==i.length)for(const{row:s,colFrom:o,colTo:a}of i)for(let i=o;i<=a;i++)e.call(t,n,s,r.normalizeCol(i),r.getWorldForColumn(i))}}s.pool=new r.Z(s)},64970:(e,t,i)=>{i.d(t,{Z:()=>f});var r=i(35925),n=i(87241);function s(e,t){return[e,t]}function o(e,t,i){return e[0]=t,e[1]=i,e}const a=new n.Z("0/0/0/0");class l{static create(e,t,i=null){const n=(0,r.C5)(e.spatialReference),a=t.origin||s(e.origin.x,e.origin.y),c=s(e.size[0]*t.resolution,e.size[1]*t.resolution),u=s(-1/0,-1/0),h=s(1/0,1/0),d=s(1/0,1/0);null!=i&&(o(u,Math.max(0,Math.floor((i.xmin-a[0])/c[0])),Math.max(0,Math.floor((a[1]-i.ymax)/c[1]))),o(h,Math.max(0,Math.floor((i.xmax-a[0])/c[0])),Math.max(0,Math.floor((a[1]-i.ymin)/c[1]))),o(d,h[0]-u[0]+1,h[1]-u[1]+1));const{cols:p,rows:f}=t;let m,g,y,_;return!i&&p&&f&&(o(u,p[0],f[0]),o(h,p[1],f[1]),o(d,p[1]-p[0]+1,f[1]-f[0]+1)),e.isWrappable?(m=s(Math.ceil(Math.round((n.valid[1]-n.valid[0])/t.resolution)/e.size[0]),d[1]),g=!0,y=n.origin,_=n.valid):(m=d,g=!1),new l(t.level,t.resolution,t.scale,a,u,h,d,c,m,g,y,_)}constructor(e,t,i,r,n,s,o,a,l,c,u,h){this.level=e,this.resolution=t,this.scale=i,this.origin=r,this.first=n,this.last=s,this.size=o,this.norm=a,this.worldSize=l,this.wrap=c,this._spatialReferenceOrigin=u,this._spatialReferenceValid=h}normalizeCol(e){if(!this.wrap)return e;const t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t}normalizeKey(e){if(!this.wrap)return;const t=this.worldSize[0],i=e.col;i<0?(e.col=i+t,e.world-=1):i>=t&&(e.col=i-t,e.world+=1)}denormalizeCol(e,t){return this.wrap?this.worldSize[0]*t+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){const t=this.origin[0]+e*this.norm[0],i=this._spatialReferenceOrigin,r=this._spatialReferenceValid;return this.wrap&&i&&r?t===i[0]?r[0]:this.origin[0]===i[0]&&e===this.worldSize[0]?r[1]:t:t}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,t,i=!1){a.set(t);const r=i?a.col:this.denormalizeCol(a.col,a.world),n=a.row;return function(e,t,i,r,n){e[0]=t,e[1]=i,e[2]=r,e[3]=n}(e,this.getXForColumn(r),this.getYForRow(n+1),this.getXForColumn(r+1),this.getYForRow(n)),e}getTileCoords(e,t,i=!1){a.set(t);const r=i?a.col:this.denormalizeCol(a.col,a.world);return Array.isArray(e)?o(e,this.getXForColumn(r),this.getYForRow(a.row)):(e.x=this.getXForColumn(r),e.y=this.getYForRow(a.row)),e}}var c=i(88782);class u{constructor(e,t,i){this.row=e,this.colFrom=t,this.colTo=i}}const h=new n.Z("0/0/0/0");class d{static create(e,t){e[1]>t[1]&&([e,t]=[t,e]);const[i,r]=e,[n,s]=t,o=n-i,a=s-r,l=0!==a?o/a:0,c=(Math.ceil(r)-r)*l,u=(Math.floor(r)-r)*l;return new d(i,Math.floor(r),Math.ceil(s),l,o<0?c:u,o<0?u:c,o<0?n:i,o<0?i:n)}constructor(e,t,i,r,n,s,o,a){this.x=e,this.ymin=t,this.ymax=i,this.invM=r,this.leftAdjust=n,this.rightAdjust=s,this.leftBound=o,this.rightBound=a}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const p=[[0,0],[0,0],[0,0],[0,0]];class f{constructor(e,t=null,i=e.lods[0].level,r=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=t,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter((e=>e.level>=i&&e.level<=r));this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const s=this._lodInfos=n.map((i=>l.create(e,i,t)));n.forEach(((e,t)=>{this._infoByLevel[e.level]=s[t],this._infoByScale[e.scale]=s[t],this.scales[t]=e.scale}),this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"==typeof e?e:e.level]}getTileBounds(e,t,i=!1){h.set(t);const r=this._infoByLevel[h.level];return r?r.getTileBounds(e,h,i):e}getTileCoords(e,t,i=!1){h.set(t);const r=this._infoByLevel[h.level];return r?r.getTileCoords(e,h,i):e}getTileCoverage(e,t=192,i=!0,r="closest"){if(!i&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n="closest"===r?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),s=c.Z.pool.acquire(n),o=this._wrap;let a,l,h,f=1/0,m=-1/0;const g=s.spans;p[0][0]=p[0][1]=p[1][1]=p[3][0]=-t,p[1][0]=p[2][0]=e.size[0]+t,p[2][1]=p[3][1]=e.size[1]+t;for(const t of p)e.toMap(t,t),t[0]=n.getColumnForX(t[0]),t[1]=n.getRowForY(t[1]);const y=[];let _=3;for(let e=0;e<4;e++){if(p[e][1]===p[_][1]){_=e;continue}const t=d.create(p[e],p[_]);f=Math.min(t.ymin,f),m=Math.max(t.ymax,m),void 0===y[t.ymin]&&(y[t.ymin]=[]),y[t.ymin].push(t),_=e}if(null==f||null==m||m-f>100)return null;let v=[];for(a=f;a<m;){null!=y[a]&&(v=v.concat(y[a])),l=1/0,h=-1/0;for(let e=v.length-1;e>=0;e--){const t=v[e];l=Math.min(l,t.getLeftCol()),h=Math.max(h,t.getRightCol())}if(l=Math.floor(l),h=Math.floor(h),a>=n.first[1]&&a<=n.last[1])if(o)if(n.size[0]<n.worldSize[0]){const e=Math.floor(h/n.worldSize[0]);for(let t=Math.floor(l/n.worldSize[0]);t<=e;t++)g.push(new u(a,Math.max(n.getFirstColumnForWorld(t),l),Math.min(n.getLastColumnForWorld(t),h)))}else g.push(new u(a,l,h));else l>n.last[0]||h<n.first[0]||(l=Math.max(l,n.first[0]),h=Math.min(h,n.last[0]),g.push(new u(a,l,h)));a+=1;for(let e=v.length-1;e>=0;e--){const t=v[e];t.ymax>=a?t.incrRow():v.splice(e,1)}}return s}getTileParentId(e){h.set(e);const t=this._infoByLevel[h.level],i=this._lodInfos.indexOf(t)-1;return i<0?null:(this._getTileIdAtLOD(h,this._lodInfos[i],h),h.id)}getTileResolution(e){const t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1}getTileScale(e){const t=this._infoByLevel[e.level];return t?t.scale:-1}intersects(e,t){h.set(t);const i=this._infoByLevel[h.level],r=e.lodInfo;if(r.resolution>i.resolution){this._getTileIdAtLOD(h,r,h);const t=r.denormalizeCol(h.col,h.world);for(const i of e.spans)if(i.row===h.row&&i.colFrom<=t&&i.colTo>=t)return!0}if(r.resolution<i.resolution){const[t,n,s,o]=e.spans.reduce(((e,t)=>(e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e)),[1/0,-1/0,1/0,-1/0]),a=i.denormalizeCol(h.col,h.world),l=r.getColumnForX(i.getXForColumn(a)),c=r.getRowForY(i.getYForRow(h.row)),u=r.getColumnForX(i.getXForColumn(a+1))-1,d=r.getRowForY(i.getYForRow(h.row+1))-1;return!(l>o||u<s||c>n||d<t)}const n=r.denormalizeCol(h.col,h.world);return e.spans.some((e=>e.row===h.row&&e.colFrom<=n&&e.colTo>=n))}normalizeBounds(e,t,i){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){const t=(0,r.C5)(this.tileInfo.spatialReference),n=-i*(t.valid[1]-t.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(let i=1;i<t.length-1;i++)if(e>t[i]+1e-6)return this._infoByScale[t[i-1]];return this._infoByScale[t[t.length-1]]}getClosestInfoForScale(e){const t=this.scales;return this._infoByScale[e]||(e=t.reduce(((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t),t[0])),this._infoByScale[e]}scaleToLevel(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let i=t.length-1;i>=0;i--)if(e<t[i])return i===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[i]].level+(t[i]-e)/(t[i]-t[i+1]);return this._infoByScale[t[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,t,i){const r=this._infoByLevel[i.level];return e.set(i),t.resolution<r.resolution?null:(t.resolution===r.resolution||(e.level=t.level,e.col=Math.floor(i.col*r.resolution/t.resolution+.01),e.row=Math.floor(i.row*r.resolution/t.resolution+.01)),e)}}},87241:(e,t,i)=>{i.d(t,{Z:()=>n});var r=i(34596);class n{static getId(e,t,i,r){return"object"==typeof e?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${t}/${i}/${r}`}constructor(e,t,i,r){this.set(e,t,i,r)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,t=4095&this.col,i=63&this.level;return(3&this.world)<<30|t<<22|e<<8|i}acquire(e,t,i,r){this.set(e,t,i,r)}contains(e){const t=e.level-this.level;return t>=0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}containsChild(e){const t=e.level-this.level;return t>0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new n(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,t,i,r){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){const[t,i,r,n]=e.split("/");this.level=parseFloat(t),this.row=parseFloat(i),this.col=parseFloat(r),this.world=parseFloat(n)}else this.level=+e,this.row=+t,this.col=+i,this.world=+r||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new n(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(e,t,i){const r=this.clone();return r.col+=e,r.row+=t,i.normalizeKey(r),r}getChildKeys(){const e=this.level+1,t=this.row<<1,i=this.col<<1,r=this.world;return[new n(e,t,i,r),new n(e,t,i+1,r),new n(e,t+1,i,r),new n(e,t+1,i+1,r)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}n.pool=new r.Z(n,null,null,25,50)},17224:(e,t,i)=>{i.d(t,{Z:()=>f});var r=i(36663),n=i(74396),s=i(86114),o=i(61681),a=i(19784),l=i(81977),c=(i(39994),i(13802),i(4157),i(40266)),u=i(36531),h=i(86111);const d=[0,0];let p=class extends n.Z{constructor(e){super(e),this._keyToItem=new Map,this._tilesByScale=new Map,this.concurrency=6}initialize(){const{concurrency:e,process:t,scheduler:i,priority:r}=this;this._queue=new h.c({concurrency:e,scheduler:i,priority:r,process:(e,i)=>{const r=this._keyToItem.get(e);return t(r,{signal:i})},peeker:e=>this._peek(e)})}destroy(){this.clear(),this._queue=(0,o.SC)(this._queue)}get length(){return this._queue?this._queue.length:0}abort(e){const t="string"==typeof e?e:e.id;this._queue.abort(t)}clear(){this._queue.clear(),this._keyToItem.clear(),this._tilesByScale.clear()}has(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}pause(){this._queue.pause()}push(e){const t=e.key.id;if(this._queue.has(t))return this._queue.get(t);const i=this._queue.push(t),r=this.tileInfoView.getTileScale(e.key),n=(0,s.s1)(this._tilesByScale,r,(()=>new Set)),o=()=>{n.delete(e.key),0===n.size&&this._tilesByScale.delete(r),this._keyToItem.delete(t)};return n.add(e.key),this._keyToItem.set(t,e),i.then(o,o),i}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(e){if(!this.state)return e.values().next().value;const t=new Set;for(const i of e)t.add(this._keyToItem.get(i).key);const i=this.state.scale;let r,n=Number.POSITIVE_INFINITY;for(const[e,s]of this._tilesByScale)if((0,a.fn)(s,(e=>t.has(e)))){const t=Math.abs(e-i);t<n&&(r=s,n=t)}return this._getClosestTileKey(r,e).id}_getClosestTileKey(e,t){const i=this.tileInfoView,r=this.state.center;let n,s=Number.POSITIVE_INFINITY;for(const o of e)if(t.has(o.id)){i.getTileCoords(d,o);const e=(0,u.TE)(d,r);e<s&&(s=e,n=o)}return n}};(0,r._)([(0,l.Cb)({constructOnly:!0})],p.prototype,"concurrency",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],p.prototype,"priority",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],p.prototype,"process",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],p.prototype,"scheduler",void 0),(0,r._)([(0,l.Cb)()],p.prototype,"state",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],p.prototype,"tileInfoView",void 0),p=(0,r._)([(0,c.j)("esri.views.2d.tiling.TileQueue")],p);const f=p},23656:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(24568),n=i(36531);class s{constructor(e,t,i){this.maxSize=e,this._tileInfoView=t,this._removedFunc=i,this._tilePerId=new Map,this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear(),this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const t=this._tilePerId.get(e);if(!t)return;const i=t.key.level,r=this._tileKeysPerLevel[i];o(this._tilePerId,e);for(let t=0;t<r.length;t++)if(r[t].id===e){r.splice(t,1);break}return t.visible=!0,t}add(e){e.visible=!1;const t=e.key,i=t.id;if(this._tilePerId.has(i))return;this._tilePerId.set(i,e);const r=t.level;this._tileKeysPerLevel[r]||(this._tileKeysPerLevel[r]=[]),this._tileKeysPerLevel[r].push(t)}prune(e,t,i){let r=this._tilePerId.size;if(r<=this.maxSize)return;let n=this._tileKeysPerLevel.length-1;for(;r>this.maxSize&&n>=0;)n!==e&&(r=this._pruneAroundCenterTile(r,t,i,n)),n--;r>this.maxSize&&(r=this._pruneAroundCenterTile(r,t,i,e))}_pruneAroundCenterTile(e,t,i,r){const s=this._tileKeysPerLevel[r];if(!s||0===s.length)return e;const{size:o,origin:a}=this._tileInfoView.tileInfo,l=i*o[0],c=i*o[1],u=[0,0],h=[0,0];for(s.sort(((e,i)=>(u[0]=a.x+l*(e.col+.5),u[1]=a.y-c*(e.row+.5),h[0]=a.x+l*(i.col+.5),h[1]=a.y-c*(i.row+.5),(0,n.bI)(u,t)-(0,n.bI)(h,t))));s.length>0;){const t=s.pop();if(this._removeTile(t.id),--e===this.maxSize)break}return e}_removeTile(e){const t=this._tilePerId.get(e);this._removedFunc&&t&&this._removedFunc(t),o(this._tilePerId,e)}}function o(e,t){e.delete(t)}var a=i(88782);const l=new(i(87241).Z)(0,0,0,0),c=new Map,u=[],h=[];class d{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,null!=e.resampling&&(this.resampling=e.resampling),e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),null!=e.buffer&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new s(e.cacheSize,this.tileInfoView,(e=>{this.releaseTile(e)})))}destroy(){this.tileIndex.clear()}update(e){const{resampling:t,tileIndex:i}=this,{scale:r,center:n,resolution:s}=e.state,{minScale:o,maxScale:d}=this.tileInfoView,p=!e.stationary&&r>this._previousScale;if(this._previousScale=r,!t&&(r>o||r<d))return this.tiles.length=0,void this.clear();const f=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,this.coveragePolicy);if(!f)return this.tiles.length=0,void this.clear();const{spans:m,lodInfo:g}=f,{level:y}=g;this.tiles.length=0,i.forEach((e=>e.visible=!0));let _=0,v=0;if(m.length>0)for(const{row:e,colFrom:t,colTo:r}of m)for(let n=t;n<=r;n++){_++;const t=l.set(y,e,g.normalizeCol(n),g.getWorldForColumn(n)).id;let r=i.get(t);if(r)r.isReady?(c.set(t,r),v++):p||this._addParentTile(t,c);else{if(this._tileCache?.has(t)){if(r=this._tileCache.pop(t),this.tileIndex.set(t,r),r.isReady){c.set(t,r),v++;continue}}else r=this.acquireTile(l),this.tileIndex.set(t,r);p||this._addParentTile(t,c)}}const b=v===_;for(const[e,t]of i){if(c.has(e))continue;l.set(e);const i=this.tileInfoView.intersects(f,l),r="purge"===this.cachePolicy?l.level!==y:l.level>y;!i||!p&&b?!r&&i||u.push(t):t.isReady?r&&"purge"===this.cachePolicy&&this._hasReadyAncestor(l,y)?u.push(t):h.push(t):r&&u.push(t)}for(const e of h)e.isReady&&c.set(e.key.id,e);for(const e of u)this._tileCache?this._tileCache.add(e):this.releaseTile(e),i.delete(e.key.id);for(const e of c.values())this.tiles.push(e);for(const e of i.values())c.has(e.key.id)||(e.visible=!1);this._tileCache?.prune(y,n,s),a.Z.pool.release(f),h.length=0,u.length=0,c.clear()}clear(){const{tileIndex:e}=this;for(const t of e.values())this.releaseTile(t);e.clear()}refresh(e){for(const t of this.tileIndex.values())e(t);this._tileCache?.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,t){let i=e,r=null;for(;i=this.tileInfoView.getTileParentId(i),i;)if(this.tileIndex.has(i)){if(r=this.tileIndex.get(i),r?.isReady){t.has(r.key.id)||t.set(r.key.id,r);break}}else if(this._tileCache?.has(i)&&(r=this._tileCache.pop(i),this.tileIndex.set(i,r),r?.isReady)){t.has(r.key.id)||t.set(r.key.id,r);break}}_hasReadyAncestor(e,t){const i=(0,r.Ue)();this.tileInfoView.getTileBounds(i,e,!0);for(const n of this.tileIndex.values())if(n.isReady&&n.key.level>=t&&n.key.level<e.level){const e=(0,r.Ue)();if(this.tileInfoView.getTileBounds(e,n.key,!0),(0,r.r3)(e,i))return!0}return!1}}},50590:(e,t,i)=>{function r(e,t,i,r){const n=3*e,s=3*(i-e)-n,o=1-n-s,a=3*t,l=3*(r-t)-a,c=1-a-l;function u(e){return((o*e+s)*e+n)*e}function h(e){return(3*o*e+2*s)*e+n}return function(e,t=1e-6){return function(e){return((c*e+l)*e+a)*e}(function(e,t){let i,r,n,s,o,a;for(n=e,a=0;a<8;a++){if(s=u(n)-e,Math.abs(s)<t)return n;if(o=h(n),Math.abs(o)<1e-6)break;n-=s/o}if(i=0,r=1,n=e,n<i)return i;if(n>r)return r;for(;i<r;){if(s=u(n),Math.abs(s-e)<t)return n;e>s?i=n:r=n,n=.5*(r-i)+i}return n}(e,t))}}i.d(t,{LI:()=>n,n_:()=>r});const n={};n.ease=r(.25,.1,.25,1),n.linear=r(0,0,1,1),n.easeIn=n["ease-in"]=r(.42,0,1,1),n.easeOut=n["ease-out"]=r(0,0,.58,1),n.easeInOut=n["ease-in-out"]=r(.42,0,.58,1)},69050:(e,t,i)=>{i.d(t,{$H:()=>q,Ck:()=>k,Dq:()=>I,EK:()=>C,H4:()=>G,Hy:()=>Y,JG:()=>A,Jp:()=>z,L2:()=>V,Rb:()=>U,Rx:()=>ee,SI:()=>Z,UZ:()=>J,Ue:()=>M,YQ:()=>W,bk:()=>O,dI:()=>H,gG:()=>X,j6:()=>N,ni:()=>R,o2:()=>j,qf:()=>P,uG:()=>D,ut:()=>B});var r=i(19812),n=i(41831),s=i(19431),o=i(17321),a=i(40201),l=i(76231),c=i(71508),u=i(36531),h=i(84164),d=i(91772),p=i(20031),f=i(10186),m=i(90472),g=i(14685),y=i(29927),_=i(35925);const v=39.37,b=180/Math.PI;function w(e){return e.wkid?e:e.spatialReference||g.Z.WGS84}function x(e,t){return t.type?(0,u.t8)(e,t.x,t.y):(0,u.JG)(e,t)}function T(e){return(0,o.c9)(e)}function C(e,t,i=0){let r=e.width,n=e.height;if(0!==i){const t=(0,s.Vl)(i),o=Math.abs(Math.cos(t)),a=Math.abs(Math.sin(t));r=e.width*o+e.height*a,n=e.width*a+e.height*o}const o=Math.max(1,t[0]),a=Math.max(1,t[1]);return Math.max(r/o,n/a)*function(e){return(0,_.JY)(e)?T(e)*v*96:1}(e.spatialReference)}async function S(e,t,i,r){let s,o;if(!e)return null;if(Array.isArray(e)&&!e.length)return null;if(n.Z.isCollection(e)&&(e=e.toArray()),Array.isArray(e)&&e.length&&"object"==typeof e[0]){const n=e.every((e=>"attributes"in e)),s=e.some((e=>!e.geometry));let o=e;if(n&&s&&t&&t.allLayerViews){const i=new Map;for(const t of e){const e=t.layer,r=i.get(e)||[],n=t.attributes[e.objectIdField];null!=n&&r.push(n),i.set(e,r)}const r=[];i.forEach(((e,i)=>{const n=t.allLayerViews?.find((e=>e.layer.id===i.id));if(n&&"queryFeatures"in n){const t=i.createQuery();t.objectIds=e,t.returnGeometry=!0,r.push(n.queryFeatures(t))}}));const n=await Promise.all(r),s=[];for(const e of n)if(e&&e.features&&e.features.length)for(const t of e.features)null!=t.geometry&&s.push(t.geometry);o=s}for(const e of o)r=await S(e,t,i,r);return r}if(Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1])s=new f.Z(e);else if(e instanceof p.Z)s=e;else if("geometry"in e)if(e.geometry)s=e.geometry;else if(e.layer){const i=e.layer,r=t.allLayerViews?.find((e=>e.layer.id===i.id));if(r&&"queryFeatures"in r){const t=i.createQuery();t.objectIds=[e.attributes[i.objectIdField]],t.returnGeometry=!0;s=(await r.queryFeatures(t))?.features?.[0]?.geometry}}if(null==s)return null;switch(s.type){case"point":o=new d.Z({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":o=(0,y.wK)(s);break;default:o=s.extent}if(!o)return null;(0,m.isLoaded)()||(0,m.canProjectWithoutEngine)(o.spatialReference,i)||await(0,m.load)();const a=(0,m.project)(o,i);if(!a)return null;if(r){const e=a.center,t=e.clone();t.x=(0,y.it)(e.x,r.center.x,i),t.x!==e.x&&a.centerAt(t),r=r.union(a)}else r=a;return r}function E(e,t){const i=w(e);return(0,_.fS)(i,t)||i.imageCoordinateSystem||t.imageCoordinateSystem?e:(0,m.project)(e,t)}async function M(e,t){if(!e||!t)return new r.Z({targetGeometry:new f.Z,scale:0,rotation:0});let i=t.spatialReference;const{constraints:n,padding:s,viewpoint:o,size:a}=t,l=[s?a[0]-s.left-s.right:a[0],s?a[1]-s.top-s.bottom:a[1]];let c=null;e instanceof r.Z?c=e:e.viewpoint?c=e.viewpoint:e.target&&"esri.Viewpoint"===e.target.declaredClass&&(c=e.target);let u=null;c?.targetGeometry?u=c.targetGeometry:e instanceof d.Z?u=e:e instanceof p.Z?u=await S(e,t,i):e&&(u=await S(e.center,t,i)||await S(e.target,t,i)||await S(e,t,i)),!u&&o?.targetGeometry?u=o.targetGeometry:!u&&t.extent&&(u=t.extent),i||(i=w(t.spatialReference||t.extent||u)),(0,m.isLoaded)()||(0,_.fS)(u.spatialReference,i)||(0,m.canProjectWithoutEngine)(u.spatialReference,i)||await(0,m.load)();const h=E(u,i),g="center"in h?h.center:h;!1!==t.pickClosestTarget&&"point"===g.type&&"point"===o.targetGeometry?.type&&(g.x=(0,y.it)(g.x,o.targetGeometry.x,g.spatialReference));let v=0;c?v=c.rotation:e.hasOwnProperty("rotation")?v=e.rotation:o&&(v=o.rotation);let b=0;b=null!=c?.targetGeometry&&"point"===c.targetGeometry.type?c.scale:"scale"in e&&e.scale?e.scale:"zoom"in e&&-1!==e.zoom&&n&&n.effectiveLODs?n.zoomToScale(e.zoom):Array.isArray(u)||"point"===u.type||"extent"===u.type&&0===u.width&&0===u.height?o.scale:C(E(u.extent,i),l,v);const x=function(e){if(e&&(!Array.isArray(e)||"number"!=typeof e[0])&&("object"==typeof e||Array.isArray(e)&&"object"==typeof e[0])){if("layer"in e&&null!=e.layer?.minScale&&null!=e.layer.maxScale){const t=e.layer;return{min:t.minScale,max:t.maxScale}}if(Array.isArray(e)&&e.length&&e.every((e=>"layer"in e))){let t=0,i=0;for(const r of e){const e=r.layer;e?.minScale&&e.maxScale&&(t=e.minScale<t?e.minScale:t,i=e.maxScale>i?e.maxScale:i)}return t&&i?{min:t,max:i}:null}}}(e.target??e);x&&(x.min&&x.min<b?b=x.min:x.max&&x.max>b&&(b=x.max));let T=new r.Z({targetGeometry:g,scale:b,rotation:v});return n&&(T=n.fit(T),n.constrainByGeometry(T),n.rotationEnabled||(T.rotation=o.rotation)),T}function A(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}function R(e,t,i){return i?(0,u.t8)(e,.5*(t[0]-i.right+i.left),.5*(t[1]-i.bottom+i.top)):(0,u.bA)(e,t,.5)}const O=function(){const e=(0,h.Ue)();return function(t,i,r){const n=i.targetGeometry;x(e,n);const s=.5*D(i);return t.xmin=e[0]-s*r[0],t.ymin=e[1]-s*r[1],t.xmax=e[0]+s*r[0],t.ymax=e[1]+s*r[1],t.spatialReference=n.spatialReference,t}}();function P(e,t,i,r,n){return j(e,t,i.center),e.scale=C(i,r),n?.constraints?.constrain(e),e}const I=function(){const e=(0,h.Ue)();return function(t,i,r){return(0,u.lu)(t,function(e,t){return(0,u.bA)(e,t,.5)}(t,i),R(e,i,r))}}(),L=function(){const e=(0,c.Ue)(),t=(0,h.Ue)();return function(i,r,n,s){const o=D(r),a=F(r);return(0,u.t8)(t,o,o),(0,l.xJ)(e,t),(0,l.U1)(e,e,a),(0,l.Iu)(e,e,I(t,n,s)),(0,l.Iu)(e,e,[0,s.top-s.bottom]),(0,u.t8)(i,e[4],e[5])}}();function D(e){return e.scale*N(e.targetGeometry?.spatialReference)}function N(e){return(0,_.JY)(e)?1/(T(e)*v*96):1}function F(e){return(0,a.c$)(e.rotation)||0}const U=function(){const e=(0,h.Ue)(),t=(0,h.Ue)(),i=(0,h.Ue)();return function(r,n,s,o,a,c){return(0,u.tk)(e,n),(0,u.bA)(t,s,.5*c),(0,u.t8)(i,1/o*c,-1/o*c),(0,l.vc)(r,t),a&&(0,l.U1)(r,r,a),(0,l.bA)(r,r,i),(0,l.Iu)(r,r,e),r}}(),k=function(){const e=(0,h.Ue)();return function(t,i,r,n){const s=D(i),o=F(i);return x(e,i.targetGeometry),U(t,e,r,s,o,n)}}(),z=function(){const e=(0,h.Ue)();return function(t,i,r,n){const s=D(i);return x(e,i.targetGeometry),U(t,e,r,s,0,n)}}();function B(e){const t=(0,_.C5)(e);return t?t.valid[1]-t.valid[0]:0}function V(e,t){return Math.round(B(e)/t)}const H=function(){const e=(0,h.Ue)(),t=(0,h.Ue)(),i=[0,0,0];return function(r,n,s){(0,u.$X)(e,r,n),(0,u.Fv)(e,e),(0,u.$X)(t,r,s),(0,u.Fv)(t,t),(0,u.kC)(i,e,t);let o=Math.acos((0,u.AK)(e,t)/((0,u.kE)(e)*(0,u.kE)(t)))*b;return i[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),G=function(){const e=(0,h.Ue)();return function(t,i,r,n){const s=t.targetGeometry;return A(t,i),L(e,i,r,n),s.x+=e[0],s.y+=e[1],t}}(),j=function(e,t,i){A(e,t);const r=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,e},Z=function(){const e=(0,h.Ue)();return function(t,i,r,n,s){s||(s="center"),(0,u.lu)(e,r,n),(0,u.bA)(e,e,.5);const o=e[0],a=e[1];switch(s){case"center":(0,u.t8)(e,0,0);break;case"left":(0,u.t8)(e,-o,0);break;case"top":(0,u.t8)(e,0,a);break;case"right":(0,u.t8)(e,o,0);break;case"bottom":(0,u.t8)(e,0,-a);break;case"top-left":(0,u.t8)(e,-o,a);break;case"bottom-left":(0,u.t8)(e,-o,-a);break;case"top-right":(0,u.t8)(e,o,a);break;case"bottom-right":(0,u.t8)(e,o,-a)}return ee(t,i,e),t}}();function q(e,t,i){return A(e,t),e.rotation+=i,e}function W(e,t,i){return A(e,t),e.rotation=i,e}const $=function(){const e=(0,h.Ue)();return function(t,i,r,n,s){return A(t,i),isNaN(r)||0===r||(K(e,n,i,s),t.scale=i.scale*r,Q(e,e,t,s),ee(t,t,(0,u.t8)(e,e[0]-n[0],n[1]-e[1]))),t}}();function Y(e,t,i){return A(e,t),e.scale=i,e}const J=function(){const e=(0,h.Ue)();return function(t,i,r,n,s,o){return A(t,i),isNaN(r)||0===r||(K(e,s,i,o),t.scale=i.scale*r,t.rotation+=n,Q(e,e,t,o),ee(t,t,(0,u.t8)(e,e[0]-s[0],s[1]-e[1]))),t}}(),X=function(){const e=(0,h.Ue)(),t=(0,h.Ue)();return function(i,r,n,s,o,a,l){return I(t,a,l),(0,u.IH)(e,o,t),s?J(i,r,n,s,e,a):$(i,r,n,e,a)}}(),K=function(){const e=(0,c.Ue)();return function(t,i,r,n){return(0,u.iu)(t,i,function(e,t,i,r){return k(e,t,i,r),(0,l.U_)(e,e)}(e,r,n,1))}}(),Q=function(){const e=(0,c.Ue)();return function(t,i,r,n){return(0,u.iu)(t,i,k(e,r,n,1))}}(),ee=function(){const e=(0,h.Ue)(),t=(0,c.Ue)();return function(i,r,n){A(i,r);const s=D(r),o=i.targetGeometry;return(0,l.Us)(t,F(r)),(0,l.bA)(t,t,(0,h.al)(s,s)),(0,u.iu)(e,n,t),o.x+=e[0],o.y+=e[1],i}}()},64666:(e,t,i)=>{i.d(t,{dP:()=>u,lM:()=>l,wH:()=>c});var r=i(86717),n=i(81095),s=i(69442),o=i(24568),a=i(8927);function l(e,t,i,r){return null!=e.renderCoordsHelper.fromRenderCoords(t.eye,p,r)&&(0,o.BD)(i,p)}function c(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function u(e,t,i,n){const o=e.state.camera.clone();t&&i&&n&&(o.eye=t,o.center=i,o.up=n),function(e,t,i){let n=d[e.viewingMode];n||(n=(0,a.Z8)(e.state.viewingMode),n.options.backfacesTerrain=!e.state.isGlobal,n.options.invisibleTerrain=!0,d[e.viewingMode]=n);const{isGlobal:o}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,n,i)||h(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||h(e,t.origin,i))||!!o&&function(e,t,i){const n=(0,r.f)(e.origin,e.origin)-i*i,s=n>0?Math.sqrt(n)/3:1;return(0,r.h)(t,e.direction,s/(0,r.l)(e.direction)),(0,r.g)(t,t,e.origin),!0}(t,i,(0,s.Iu)(e.spatialReference).radius)}(e,o.ray,f)||(0,r.c)(f,o.center);const l=e.state.constraints,c=l.minimumPoiDistance;if((0,r.s)(o.eye,f)<c){const t=l.collision.enabled;(0,r.c)(m,o.viewForward),(0,r.h)(m,m,c),t?o.eye=(0,r.d)(p,f,m):(0,r.g)(f,o.eye,m);const i=e.renderCoordsHelper,n=i.getAltitude(o.eye),s=l.collision.elevationMargin;t&&n<s&&((0,r.d)(m,f,o.eye),o.eye=i.setAltitude(p,s,o.eye),(0,r.g)(f,o.eye,m))}return o.center=f,o}function h(e,t,i){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const n=c(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:o}=s.compute(t,i,e.renderDataExtent,n,g),a=o*o;return(0,r.s)(t,i)>a}const d={},p=(0,n.Ue)(),f=(0,n.Ue)(),m=(0,n.Ue)(),g={near:0,far:0}},56011:(e,t,i)=>{i.d(t,{G:()=>h,o:()=>u});var r=i(84164),n=i(52721),s=i(14260),o=i(93072),a=i(63371),l=i(20200),c=i(86765);class u extends c.K{constructor(){super(...arguments),this.radii=(0,r.Ue)(),this.heightParameters=(0,n.Ue)()}}function h(e){e.uniforms.add(new o.A("radii",(e=>e.radii)),new a.N("heightParameters",(e=>e.heightParameters))),e.constants.add("scaleHeight","float",s.sv.scaleHeight*s.sv.atmosphereHeight),e.code.add(l.H`float chapmanApproximation(float thickness, float height, float cosZenith) {
float c = sqrt(thickness + height);
float cExpH = c * exp(-height);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (thickness + height);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(thickness - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),e.code.add(l.H`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),e.code.add(l.H`vec4 planetIntersect(vec3 cameraPos, vec3 rayDir) {
float reducedPlanetRadius = radii[0] - 20000.0;
float rayPlanetDistance = heightParameters[1] - reducedPlanetRadius * reducedPlanetRadius;
vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, rayPlanetDistance);
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, heightParameters[2]);
bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
bool insideAtmosphere = heightParameters[0] < radii[1];
if (!(hitsAtmosphere || insideAtmosphere)) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;
float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;
if (heightParameters[0] < reducedPlanetRadius) {
if (dot(rayDir, normalize(cameraPos)) < -0.025) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
start = rayPlanetIntersect.y;
}
float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
return vec4(0.0, hitsPlanet ? 1.0 : 0.0, start, end);
}`)}},6600:(e,t,i)=>{i.d(t,{t:()=>a});var r=i(99741),n=i(56011),s=i(20998),o=i(20200);function a(e,t){e.include(n.G);e.uniforms.add(new s.d("cameraPosition",(e=>e.camera.eye))),e.constants.add("betaRayleigh","vec3",r.aM),e.constants.add("betaCombined","vec3",r.nB),e.constants.add("betaMie","float",r.th),e.code.add(o.H`
    vec3 raymarchAtmosphere(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      vec4 ray = planetIntersect(cameraPos, rayDir);
      if(ray.x == 1.0) {
        return vec3(0);
      }
      ${(0,o.If)(t,"if (terrainDepth != -1.0) { ray.w = terrainDepth; }")}

      vec3 samplePoint = cameraPos + rayDir * ray.w;
      float multiplier = ray.y == 1.0 ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (ray.w - ray.z) / ${o.H.float(6)};

      for (int i = 0; i < ${o.H.int(6)}; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
          ${(0,o.If)(!t,"scattering *= mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0))")};
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {
          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);
          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${(0,o.If)(!t,"scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);")}
        }
        lastOpticalDepth = opticalDepth;
      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;
      ${t?"return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;":o.H`const float g = 0.8;
             const float gg = g * g;
             float phaseMie = 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg));
             phaseMie = clamp(phaseMie, 0.0, 128.0);
             return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }`)}},62700:(e,t,i)=>{var r,n;function s(e){return null!=e&&!e.running}i.d(t,{TH:()=>r,WU:()=>s,uz:()=>n}),function(e){e[e.Idle=0]="Idle",e[e.Rendering=1]="Rendering",e[e.Ready=2]="Ready",e[e.Fading=3]="Fading"}(r||(r={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA",e[e.COUNT=2]="COUNT"}(n||(n={}))},76076:(e,t,i)=>{i.d(t,{K:()=>m,e:()=>r});var r,n=i(27755),s=i(19431),o=i(18809),a=i(32114),l=i(3308),c=i(86717),u=i(81095),h=i(34218),d=i(14260),p=i(62700),f=i(87698);class m{constructor(){this.startTime=0,this._data=(0,o.t)(null),this._readChannels=p.uz.RG,this.parallax=new g,this.parallaxNew=new g,this._anchorPoint=(0,u.Ue)(),this._fadeState=(0,o.t)(r.HIDE),this._fadeFactor=(0,o.t)(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case r.HIDE:return 0;case r.FADE_OUT:return 1-this.fadeFactor;case r.FADE_IN:return this.fadeFactor;case r.SHOW:case r.CROSS_FADE:return 1}}fade(e,t,i){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=i?(0,s.uZ)((t-this.startTime)/(b*i),0,1):1,1===this.fadeFactor&&this._endFade()),this._evaluateState(e,t),this._updateParallax(e)}_evaluateState(e,t){const i=e.relativeElevation,n=this._updateAnchorPoint(e);(i>1.7*f.rm||i<-1e4||n>x)&&this.opacity>0?this._startFade(r.HIDE,t):this.isFading||(i>f.rm||i<-.35*f.rm||n>w*x?this.opacity>0&&this._startFade(r.FADE_OUT,t):(0,p.WU)(this.data)&&(0===this.opacity?this._startFade(r.FADE_IN,t):this.data.state===p.TH.Ready&&(this.fadeState===r.SHOW?this._startFade(r.CROSS_FADE,t):this._startFade(r.SHOW,t))))}_updateParallax(e){const t=(0,c.k)(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(t-d.sv.radius*d.sv.radius,0))/Math.sqrt(t),(0,h.zk)(y,this.parallax.anchorPoint,_),(0,a.U1)(this.parallax.transform,l.Wd,_[3],(0,h.ZZ)(_)),(0,h.zk)(y,this.parallaxNew.anchorPoint,_),(0,a.U1)(this.parallaxNew.transform,l.Wd,_[3],(0,h.ZZ)(_))}_updateAnchorPoint(e){return(0,c.n)(this._anchorPoint,e.eye),(0,c.h)(this._anchorPoint,this._anchorPoint,d.sv.radius),this.fadeState===r.HIDE&&this.data?.state===p.TH.Ready?((0,c.c)(this.parallax.anchorPoint,this._anchorPoint),0):(0,c.l)((0,c.d)(v,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,t){switch(this._fadeState.value=e,this.startTime=t,e){case r.CROSS_FADE:this.requestFade(),this._switchReadChannels(),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case r.FADE_IN:this.requestFade(),this._switchReadChannels(),(0,c.c)(this.parallax.anchorPoint,this._anchorPoint),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case r.FADE_OUT:this.requestFade();break;case r.SHOW:this._switchReadChannels(),(0,c.c)(this.parallax.anchorPoint,this._anchorPoint),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case r.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==p.TH.Ready&&(this.data.state=p.TH.Idle),this.fadeState){case r.CROSS_FADE:(0,c.c)(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=r.SHOW;break;case r.FADE_IN:this._fadeState.value=r.SHOW;break;case r.FADE_OUT:this._fadeState.value=r.HIDE;break;case r.SHOW:case r.HIDE:break;default:(0,n.Bg)(this.fadeState)}}_switchReadChannels(){this.data?.state===p.TH.Ready&&(this._readChannels=1-this._readChannels,this.data.state=p.TH.Fading)}get isFading(){return this.fadeState===r.FADE_OUT||this.fadeState===r.FADE_IN||this.fadeState===r.CROSS_FADE}}!function(e){e[e.HIDE=0]="HIDE",e[e.FADE_IN=1]="FADE_IN",e[e.SHOW=2]="SHOW",e[e.CROSS_FADE=3]="CROSS_FADE",e[e.FADE_OUT=4]="FADE_OUT"}(r||(r={}));class g{constructor(){this.anchorPoint=(0,u.Ue)(),this.radiusCurvatureCorrection=0,this.transform=(0,l.Ue)()}}const y=(0,u.al)(0,0,1),_=(0,h.Ue)(),v=(0,u.Ue)(),b=1.25,w=.5,x=2e5},25853:(e,t,i)=>{i.d(t,{p:()=>r,t:()=>a});var r,n=i(36663),s=i(62700),o=i(12907);!function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"}(r||(r={}));class a extends o.m{constructor(){super(...arguments),this.steps=r.SIXTEEN,this.writeTextureChannels=s.uz.RG}}(0,n._)([(0,o.o)({count:r.COUNT})],a.prototype,"steps",void 0),(0,n._)([(0,o.o)({count:s.uz.COUNT})],a.prototype,"writeTextureChannels",void 0)},13696:(e,t,i)=>{i.d(t,{i:()=>o,u:()=>r});var r,n=i(36663),s=i(12907);!function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"}(r||(r={}));class o extends s.m{constructor(){super(...arguments),this.mode=r.Full}}(0,n._)([(0,s.o)({count:r.COUNT})],o.prototype,"mode",void 0)},43175:(e,t,i)=>{i.d(t,{CB:()=>s,H6:()=>c,JK:()=>l,Mw:()=>n,a5:()=>o,i9:()=>r,r7:()=>a});const r=(0,i(39994).Z)("esri-mobile")?64:128,n=r/128,s=Math.ceil(Math.sqrt(r)),o=(r+2)*s,a=1e5,l=128,c=o/1560},15396:(e,t,i)=>{i.d(t,{H:()=>r,Y:()=>o});var r,n=i(36663),s=i(12907);!function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"}(r||(r={}));class o extends s.m{constructor(){super(...arguments),this.type=r.Rain}}(0,n._)([(0,s.o)({count:r.COUNT})],o.prototype,"type",void 0)},28876:(e,t,i)=>{i.d(t,{f:()=>a,n:()=>r});var r,n=i(36663),s=i(12907),o=i(22957);!function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"}(r||(r={}));class a extends o.W{constructor(){super(...arguments),this.geometry=r.Cone}}(0,n._)([(0,s.o)({count:r.COUNT})],a.prototype,"geometry",void 0)},64089:(e,t,i)=>{i.d(t,{Z:()=>u});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(79438)),l=i(40266);let c=r=class extends s.Z{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new r({cloudCover:this.cloudCover})}};(0,n._)([(0,a.J)({sunny:"sunny"}),(0,o.Cb)({json:{write:{isRequired:!0}}})],c.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=r=(0,n._)([(0,l.j)("esri.views.3d.environment.SunnyWeather")],c);const u=c},99741:(e,t,i)=>{i.d(t,{Tk:()=>o,aM:()=>a,nB:()=>u,th:()=>c,yx:()=>s});var r=i(19431),n=i(81095);function s(e){const t=1e5;return(0,r.uZ)((e-t)/9e5,0,1)}const o=1e4,a=(0,n.al)(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),l=(0,n.al)(3*parseFloat(Number(65e-8).toFixed(6)),3*parseFloat(Number(1881e-9).toFixed(6)),3*parseFloat(Number(85e-9).toFixed(6))),c=3996e-9,u=(0,n.al)(parseFloat(Number(a[0]+l[0]).toFixed(6)),parseFloat(Number(a[1]+l[1]).toFixed(6)),parseFloat(Number(a[2]+l[2]).toFixed(6)))},87698:(e,t,i)=>{i.d(t,{$T:()=>S,rm:()=>C,b8:()=>T,Hr:()=>w});var r,n=i(36663),s=i(82064),o=i(81977),a=(i(39994),i(13802),i(4157),i(79438)),l=i(40266);let c=r=class extends s.Z{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new r({cloudCover:this.cloudCover})}};(0,n._)([(0,a.J)({cloudy:"cloudy"}),(0,o.Cb)({json:{write:{isRequired:!0}}})],c.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=r=(0,n._)([(0,l.j)("esri.views.3d.environment.CloudyWeather")],c);const u=c;var h;let d=h=class extends s.Z{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new h({fogStrength:this.fogStrength})}};(0,n._)([(0,a.J)({foggy:"foggy"}),(0,o.Cb)({json:{write:{isRequired:!0}}})],d.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"fogStrength",void 0),d=h=(0,n._)([(0,l.j)("esri.views.3d.environment.FoggyWeather")],d);const p=d;var f;let m=f=class extends s.Z{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,n._)([(0,a.J)({rainy:"rainy"}),(0,o.Cb)({json:{write:{isRequired:!0}}})],m.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"cloudCover",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"precipitation",void 0),m=f=(0,n._)([(0,l.j)("esri.views.3d.environment.RainyWeather")],m);const g=m;var y;let _=y=class extends s.Z{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new y({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,n._)([(0,a.J)({snowy:"snowy"}),(0,o.Cb)({json:{write:{isRequired:!0}}})],_.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"cloudCover",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"precipitation",void 0),(0,n._)([(0,o.Cb)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],_.prototype,"snowCover",void 0),_=y=(0,n._)([(0,l.j)("esri.views.3d.environment.SnowyWeather")],_);const v=_;var b=i(64089);const w={key:"type",base:b.Z,typeMap:{sunny:b.Z,cloudy:u,rainy:g,snowy:v,foggy:p}},x=Object.keys(w.typeMap);function T(e,t){return!!x.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const C=1e4,S=1e5},91420:(e,t,i)=>{i.d(t,{C:()=>l});var r=i(66341),n=i(67979),s=i(70375),o=i(78668),a=i(3466);class l{constructor(e){this._streamDataRequester=e}async loadJSON(e,t){return this._load("json",e,t)}async loadBinary(e,t){return(0,a.HK)(e)?((0,o.k_)(t),(0,a.AH)(e)):this._load("binary",e,t)}async loadImage(e,t){return this._load("image",e,t)}async _load(e,t,i){if(null==this._streamDataRequester)return(await(0,r.Z)(t,{responseType:c[e]})).data;const a=await(0,n.q6)(this._streamDataRequester.request(t,e,i));if(!0===a.ok)return a.value;throw(0,o.r9)(a.error),new s.Z("glt-loader-request-error",`Request for resource failed: ${a.error}`)}}const c={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},24567:(e,t,i)=>{i.d(t,{O:()=>n,h:()=>r});var r;i(39994);function n(e){switch(e){case r.SUPPORTED:break;case r.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case r.GEOMETRY_MISSING:return"no geometry";case r.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case r.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case r.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}!function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"}(r||(r={}))},71271:(e,t,i)=>{i.d(t,{Y:()=>s});i(39994);var r=i(83772),n=i(24567);function s(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return n.h.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return n.h.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return n.h.GEOMETRY_TYPE_UNSUPPORTED}const i=e.elevationInfo;return(0,r.XH)(i)?n.h.ELEVATION_MODE_UNSUPPORTED:n.h.SUPPORTED}},6533:(e,t,i)=>{i.d(t,{C:()=>l,R:()=>c});var r=i(95550),n=i(36531),s=i(86717),o=i(81095),a=i(83772);function l(e,t,i,r){i.projectToRenderScreen(e,h),i.projectToRenderScreen(t,d),(0,n.$X)(r,d,h),(0,n.Fv)(r,r)}function c(e,t,i,r,n=(0,o.Ue)()){const l=(0,s.c)(u,e);return l[2]=(0,a.zx)(r,l,t,i)||0,r.renderCoordsHelper.toRenderCoords(l,t,n),n}const u=(0,o.Ue)(),h=(0,r.gX)(),d=(0,r.gX)()},23229:(e,t,i)=>{i.d(t,{JF:()=>o,WM:()=>a,mq:()=>l});let r,n=null;const s=new Map;async function o(e){null==n&&(null==r&&(r=i.e(91161).then(i.bind(i,91161))),n=await r);const t=e.view;let o=s.get(t);o||(o=new n.default({view:t}),s.set(t,o));const a=!!t._stage.renderView.renderingContext.capabilities.compressedTextureS3TC,l=!!t._stage.renderView.renderingContext.capabilities.compressedTextureETC;return await o.initializeWasm(a,l),o.add3DTilesLayerView(e)}function a(e){return s.get(e)}function l(e){const t=e.view,i=s.get(t);i&&i.remove3DTilesLayerView(e)<1&&(s.delete(t),0===s.size&&(r=null,n=null))}},71961:(e,t,i)=>{i.d(t,{$L:()=>a,JF:()=>o,mq:()=>l});let r,n=null;const s=new Map;async function o(e){null==n&&(null==r&&(r=i.e(64999).then(i.bind(i,64999))),n=await r);const t=e.view;let o=s.get(t);return o||(o=new n.default({view:t}),s.set(t,o)),o.addVoxelLayer(e)}function a(e){return s.get(e)}function l(e){const t=e.view,i=s.get(t);i&&i.removeVoxelLayer(e)<1&&(s.delete(t),0===s.size&&(r=null,n=null))}},87076:(e,t,i)=>{i.d(t,{Lz:()=>_,RX:()=>y,Wf:()=>f,j3:()=>m});var r=i(32114),n=i(3308),s=i(86717),o=i(81095),a=i(7845),l=i(22349),c=i(63669),u=i(3289),h=i(66143),d=i(11715),p=i(21414);function f(e,t,i,r,n){const s=e.stageObject,o=s.geometries;let a=0;for(const e of o){if(!(0,d.T)(e))continue;const{update:o,averageGeometrySampledElevation:l}=E(e,t,i,r,n);a+=l,o&&s.geometryVertexAttributeUpdated(e,p.T.POSITION)}return a/o.length}function m(e,t,i,n,o,l){const h=e.stageObject,d=t.centerPointInElevationSR;let p=0;h.usesVerticalDistanceToGround?(n(d,S),(0,c.ub)(h,S.verticalDistanceToGround),p=S.sampledElevation):(n(d,S),"absolute-height"!==t.mode&&(p=S.sampledElevation));const f=(0,r.JG)(g,l??h.transformation),m=(0,s.i)(C,f[12],f[13],f[14]);u.h.TESTS_DISABLE_OPTIMIZATIONS?(b[0]=d.x,b[1]=d.y,b[2]=S.z,(0,a.B)(d.spatialReference,b,f,o.spatialReference)&&(l?(0,r.JG)(l,f):h.transformation=f)):o.setAltitudeOfTransformation(S.z,f);const y=v/o.unitInMeters;return(Math.abs(f[12]-m[0])>=y||Math.abs(f[13]-m[1])>=y||Math.abs(f[14]-m[2])>=y)&&(l?(0,r.JG)(l,f):h.transformation=f),p}const g=(0,n.Ue)();function y(e,t,i,r,n){const o=e.graphics3DSymbolLayer.lodRenderer;if(null==o)return 0;const l=t.centerPointInElevationSR;r(l,S);const c="absolute-height"!==t.mode?S.sampledElevation:0,h=o.instanceData,d=e.instanceIndex,p=T;h.getGlobalTransform(d,p);const f=(0,s.i)(C,p[12],p[13],p[14]);u.h.TESTS_DISABLE_OPTIMIZATIONS?(b[0]=l.x,b[1]=l.y,b[2]=S.z,(0,a.B)(l.spatialReference,b,p,n.spatialReference)&&h.setGlobalTransform(d,p)):n.setAltitudeOfTransformation(S.z,p);const m=v/n.unitInMeters;return(u.h.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(p[12]-f[0])>=m||Math.abs(p[13]-f[1])>=m||Math.abs(p[14]-f[2])>=m)&&h.setGlobalTransform(d,p),c}function _(e,t,i,r,n){const s=e.stageObject,o=s.geometries;if(0===o.length)return 0;let a=0,l=null,c=0,u=!1;for(const e of o){if(!(0,d.T)(e))continue;const o=e.attributes.get(p.T.POSITION);if(o!==l){const{update:s,averageGeometrySampledElevation:a}=E(e,t,i,r,n);c=a,l=o,u=s}u&&s.geometryVertexAttributeUpdated(e,p.T.POSITION),a+=c}return a/o.length}const v=.01,b=(0,o.Ue)(),w=(0,o.Ue)(),x=(0,o.Ue)(),T=(0,n.Ue)(),C=(0,o.Ue)(),S=new c.Lm;function E(e,t,i,r,n){let s=!1;const o=e.transformation,a=t.requiresSampledElevationInfo;w[0]=o[12],w[1]=o[13],w[2]=o[14],e.invalidateBoundingInfo();const c=e.getMutableAttribute(p.T.POSITION),d=c.data,f=c.size,m=d.length/f,g=new h.sb(e.mapPositions,i);let y=0,_=0;for(let e=0;e<m;e++){if(x[0]=d[y],x[1]=d[y+1],x[2]=d[y+2],r(g,S),a&&(_+=S.sampledElevation),u.h.TESTS_DISABLE_OPTIMIZATIONS)d[y]=g.array[g.offset],d[y+1]=g.array[g.offset+1],d[y+2]=S.z,(0,l.projectBuffer)(d,i,y,d,n.spatialReference,y,1),d[y]-=w[0],d[y+1]-=w[1],d[y+2]-=w[2],s=!0;else{b[0]=d[y]+w[0],b[1]=d[y+1]+w[1],b[2]=d[y+2]+w[2],n.setAltitude(b,S.z),d[y]=b[0]-w[0],d[y+1]=b[1]-w[1],d[y+2]=b[2]-w[2];const e=v/n.unitInMeters;(Math.abs(x[0]-d[y])>=e||Math.abs(x[1]-d[y+1])>=e||Math.abs(x[2]-d[y+2])>=e)&&(s=!0)}y+=f,g.offset+=3}return _/=m,{update:s,averageGeometrySampledElevation:_}}},29642:(e,t,i)=>{i.d(t,{o:()=>s});var r=i(91478),n=i(64487);class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,r.Z7)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=(0,n.ht)(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,r.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,t,i){if(null==e)return void(this._featureExpressionInfoContext=null);const r=e?.arcade;r&&null!=t&&null!=i?(this._featureExpressionInfoContext=(0,n.d9)(e),(0,n.aO)(this._featureExpressionInfoContext,(0,n.Tz)(r.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return null!=e&&t.setFromElevationInfo(e),t}}},89301:(e,t,i)=>{i.d(t,{K:()=>l,Y:()=>a});var r=i(7753),n=(i(39994),i(78668)),s=i(74304),o=i(22167);class a{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,i){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,i)}async queryElevation(e,t,i,r,n){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,i,r)}}class l{constructor(e,t,i,r){this.spatialReference=t,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...r,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(o.T8.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(o.G5);else for(const e of this._queries)e.result.reject((0,n.zE)())}queryElevation(e,t,i,s=0){const o=(0,n.hh)(),a={x:e,y:t,minDemResolution:s,result:o,signal:i};return this._queries.push(a),(0,n.fu)(i,(()=>{(0,r.Od)(this._queries,a),o.reject((0,n.zE)())})),o.promise}get running(){return this._queries.length>0}runTask(e){const t=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return t.forEach((e=>e.result.reject())),void e.madeProgress();const r=t.map((e=>[e.x,e.y])),o=t.reduce(((e,t)=>Math.min(e,t.minDemResolution)),1/0),a=new s.Z({points:r,spatialReference:this.spatialReference}),l=t.length>1&&t.some((e=>!!e.signal))?new AbortController:null,c=null!=l?l.signal:t[0].signal;if(null!=l){let e=0;t.forEach((i=>(0,n.fu)(i.signal,(()=>{e++,i.result.reject((0,n.zE)()),e===t.length&&l.abort()}))))}const u={...this._queryOptions,minDemResolution:o,signal:c};i.queryElevation(a,u).then((e=>{t.forEach(((t,i)=>{null!=t.signal&&t.signal.aborted?t.result.reject((0,n.zE)()):t.result.resolve(e.geometry.points[i][2])}))})).catch((e=>{t.forEach((t=>t.result.reject(e)))})),e.madeProgress()}get test(){}}},18831:(e,t,i)=>{i.d(t,{S:()=>a});var r=i(13802),n=i(94984),s=i(14287);const o=()=>r.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function a(e,t){if(!(0,n.Pd)(e))return o().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=l[e.callout.type];return i?new i(e,t):(o().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const l={line:s.YT}},92740:(e,t,i)=>{i.d(t,{A:()=>j,m:()=>H});i(39994);var r=i(70375),n=i(67134),s=i(17321),o=i(5992),a=i(46332),l=i(3965),c=i(32114),u=i(3308),h=i(86717),d=i(81095),p=i(7845),f=i(37116),m=i(92570),g=i(35914),y=i(6766),_=i(96457),v=i(67905),b=i(65684),w=i(63669),x=i(85274),T=i(17905),C=i(14923),S=i(4357),E=i(9575),M=i(57180),A=i(3289),R=i(66143),O=i(82844),P=i(7792),I=i(85799),L=i(70984),D=i(95399),N=i(63885),F=i(11715),U=i(59633),k=i(49394),z=i(21414),B=i(46151);const V=["polygon","extent"];class H extends T.k{constructor(e,t,i,r){super(e,t,i,r),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,C.bh)(this._getSymbolSize());if(e)throw new r.Z("graphics3dextrudesymbollayer:invalid-size",e)}const e=this.symbolLayer?.material?.color,t=this._getCombinedOpacityAndColor(e),i=(0,d.nI)(t),n=t[3],s=n<1||this.needsDrivenTransparentPass,o=this.symbolLayer?.material?.emissiveFactor,a=o?(0,h.F)((0,d.d9)(o)):d.AG,l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:n,transparent:s,cullFace:s?L.Vr.None:L.Vr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,emissiveFactor:a,offsetTransparentBackfaces:!0,normalType:P.r.Compressed};this._materials[de.Main]=new B.Gp(l,this._context),this._materials[de.Bottom]=new B.Gp({...l,cullFace:L.Vr.Back},this._context),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,V,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),r=this.setGraphicElevationContext(t);return this._createAs3DShape(t,e.renderingInfo,i,r,t.uid)}layerOpacityChanged(e,t){const i=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(i),n=r<1||this.needsDrivenTransparentPass;this._materials[de.Main]?.setParameters({opacity:r,transparent:n}),this._materials[de.Bottom]?.setParameters({opacity:r,transparent:n});const s=this._getLayerOpacity();e.forEach((e=>t(e)?.layerOpacityChanged(s,this._context.isAsync)))}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,w.B5)}slicePlaneEnabledChanged(e,t){return this._materials[de.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[de.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach((e=>{const i=t(e);null!=i&&i.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[de.Main]?.setParameters(e),this._materials[de.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let t;return t=e.size&&this._drivenProperties.size?(0,v.sV)(e.size,2)??0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(e,t){return this._drivenPropertiesChanged(t)?S.W.RecreateSymbol:S.W.RecreateGraphics}async queryForSnapping(e,t,i,r){const o=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/(0,s._R)(t),{objectId:a,target:l}=e,c=(0,n.d9)(l);switch(c.z=(c.z??0)+o,e.type){case"edge":{const{start:t,end:i}=e,r=(0,n.d9)(t),s=(0,n.d9)(i);return r.z=(r.z??0)+o,s.z=(s.z??0)+o,[(0,_.p)(a,c,1/0,r,s)]}case"vertex":return[(0,_.u)(a,c,1/0),(0,_.p)(a,l,1/0,l,c)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,t,i,r,n){const s=(0,E.Nu)(e.geometry);if(null==s)return null;if(0===s.rings.length||!s.rings.some((e=>e.length>0)))return this._logGeometryValidationWarnings(s.rings,"rings","ExtrudeSymbol3DLayer"),null;const _=(0,O.VP)(s,this._context.elevationProvider,this._context.renderCoordsHelper,r);this._logGeometryCreationWarnings(_,s.rings,"rings","ExtrudeSymbol3DLayer");const v=(0,C.zE)(s);if(null==v)return null;const T=new Array,S=new Array,P=(0,f.Ue)(),I=(0,u.Ue)(),L=(0,d.Ue)(),D=this._context.renderCoordsHelper.viewingMode===b.JY.Global;D||this._context.renderCoordsHelper.worldUpAtPosition(null,L),(0,p.B)(s.spatialReference,[v.x,v.y,0],I,this._context.renderCoordsHelper.spatialReference);const N=(0,u.Ue)();(0,c.U_)(N,I);const B=(0,l.Ue)();(0,a.XL)(B,N);const{polygons:V,mapPositions:H,position:Z}=_,q=new Map,W=this._materials[de.Main];for(const e of V){const r=e.count;if(this._context.clippingExtent&&((0,f.FY)(e.mapPositions,P),!(0,f.Zp)(P,this._context.clippingExtent)))continue;const s=(0,o.e)(e.mapPositions,e.holeIndices,3);if(0===s.length)continue;const a=s.length,l=6*r,c=(0,g.$z)(l+a),u=(0,g.$z)(a),h=(0,m.bg)(3*l),d=(0,m.bg)(3*l),p=(0,m.bg)(3*l),_=(0,m.bg)(l);j(Z,H,s,e,h,p,d,_,c,u,this._getExtrusionSize(t),L,D),(0,y.t)(h,h,N);const v=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),b=new pe(h,p,(0,U.nG)(d),_),w=G(W,c,c.length-u.length,b,i,v),x=r,C=r,E=2*e.count,M=new fe(x,C,E,a/3);te(w,M,I),q.set(w,M),T.push(w,G(this._materials[de.Bottom],u,0,b,i,v)),S.push(b.heights)}if(0===T.length)return null;const $=new k.T({geometries:T,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});$.transformation=I;const Y=(0,M.hM)(this.symbolLayer,{opacity:this._getLayerOpacity()}),J=Y?new x.n(this._materials[de.Main],Y,this._context.slicePlaneEnabled):null,X=new x.z(this,$,T,null,null,((e,t,i,r,n)=>function(e,t,i,r,n,s,o){const a=e.stageObject,l=a.geometries,d=l.length,p="absolute-height"!==t.mode;let f=0;const m=a.transformation,g=(0,c.iS)((0,u.Ue)(),m);for(let e=0;e<d;e+=2){const t=l[e];if(!(0,F.T)(t))continue;const c=t.getMutableAttribute(z.T.POSITION).data,u=s[e/2],d=new R.sb(t.mapPositions),y=c.length/3;let _=!1,v=0;{let e=0;for(let t=0;t<y;t++){ee[0]=c[e],ee[1]=c[e+1],ee[2]=c[e+2],r(d,ne),p&&(v+=ne.sampledElevation),A.h.TESTS_DISABLE_OPTIMIZATIONS?((0,h.i)(ie,d.array[d.offset],d.array[d.offset+1],ne.z+u[e/3]),null!=i&&n.toRenderCoords(ie,i,ie),(0,h.t)(ie,ie,g)):((0,h.i)(ie,c[e],c[e+1],c[e+2]),(0,h.t)(ie,ie,m),n.setAltitude(ie,ne.z+u[e/3]),(0,h.t)(ie,ie,g)),c[e]=ie[0],c[e+1]=ie[1],c[e+2]=ie[2];const t=ae/n.unitInMeters;(Math.abs(ee[0]-c[e])>=t||Math.abs(ee[1]-c[e+1])>=t||Math.abs(ee[2]-c[e+2])>=t)&&(_=!0),d.offset+=3,e+=3}}if(_){const i=o.get(t);i&&te(t,i,m),a.geometryVertexAttributeUpdated(l[e],z.T.NORMALCOMPRESSED),t.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[e],z.T.POSITION),l[e+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[e+1],z.T.POSITION)}f+=v/y}return f/d}(e,t,i,r,n,S,q)),r,J);return X.alignedSampledElevation=_.sampledElevation,X.needsElevationUpdates=(0,w.B5)(r.mode),X}}function G(e,t,i,r,n,s){const o=(0,g.LE)(t.length),a=[[z.T.POSITION,new I.a(r.positions,t,3,!0)],[z.T.NORMALCOMPRESSED,new I.a(r.normals,t,2,!0)],[z.T.COLOR,new I.a(n,o,4,!0)]];return new N.Z(e,a,r.elevation,D.U.Mesh,s,i)}function j(e,t,i,r,n,s,o,a,l,c,u,d,p){{const f=i.length/3,m=2*r.count;!function(e,t,i,r,n,s,o,a,l,c,u,d,p,f,m,g,y){(0,h.c)(re,g);{const n=m>0?1:-1;let s=3*i,o=0,d=3*o,p=r,f=3*p;for(let i=0;i<r;++i){const i=e[s],r=e[s+1],g=e[s+2];y&&(re[0]=i,re[1]=r,re[2]=g,(0,h.n)(re,re)),a[d+0]=i,a[d+1]=r,a[d+2]=g;const _=t[s+0],v=t[s+1],b=t[s+2];l[d+0]=_,l[d+1]=v,l[d+2]=b,c[d+0]=-n*re[0],c[d+1]=-n*re[1],c[d+2]=-n*re[2],u[o]=0,a[f+0]=i+m*re[0],a[f+1]=r+m*re[1],a[f+2]=g+m*re[2],l[f+0]=_,l[f+1]=v,l[f+2]=b,u[p]=m,d+=3,f+=3,s+=3,o+=1,p+=1}}{let e=3*s,t=0,i=3*f;const a=m<0?oe:se,l=m<0?se:oe;for(let s=0;s<o;++s)p[t]=n[e+a[0]],p[t+1]=n[e+a[1]],p[t+2]=n[e+a[2]],d[i]=n[e+l[0]]+r,d[i+1]=n[e+l[1]]+r,d[i+2]=n[e+l[2]]+r,t+=3,i+=3,e+=3}}(e,t,r.index,r.count,i,0,f,n,s,o,a,l,c,m,u,d,p)}{let e=0,t=2*r.count,i=0;const c=r.pathLengths[0];W(n,s,a,o,e,c,r.count,t,l,i,u),t+=4*c,i+=2*c,e+=c;for(let c=1;c<r.pathLengths.length;++c){const h=r.pathLengths[c];W(n,s,a,o,e,h,r.count,t,l,i,u),t+=4*h,i+=2*h,e+=h}}}function Z(e,t,i,r,n,s,o){r[s]=r[o],o*=3,e[s*=3]=e[o],e[s+1]=e[o+1],e[s+2]=e[o+2],t[s]=t[o],t[s+1]=t[o+1],t[s+2]=t[o+2],i[s]=n[0],i[s+1]=n[1],i[s+2]=n[2]}const q=(0,d.Ue)();function W(e,t,i,r,n,s,o,a,l,c,u){let h=n,d=n+1,p=n+o,f=n+o+1,m=a,g=a+1,y=a+2*s,_=a+2*s+1;u<0&&(h=n+o+1,f=n);let v=3*c;for(let a=0;a<s;++a)a===s-1&&(d=n,u>0?f=n+o:h=n+o),Q(e,h,d,p,q),Z(e,t,r,i,q,m,h),Z(e,t,r,i,q,g,d),Z(e,t,r,i,q,y,p),Z(e,t,r,i,q,_,f),l[v]=m,l[v+1]=y,l[v+2]=_,l[v+3]=m,l[v+4]=_,l[v+5]=g,v+=6,h++,d++,p++,f++,m+=2,g+=2,y+=2,_+=2}const $=(0,d.Ue)(),Y=(0,d.Ue)(),J=(0,d.Ue)(),X=(0,d.Ue)(),K=(0,d.Ue)();function Q(e,t,i,r,n){t*=3,i*=3,r*=3,(0,h.i)($,e[t++],e[t++],e[t++]),(0,h.i)(Y,e[i++],e[i++],e[i++]),(0,h.i)(J,e[r++],e[r++],e[r++]),(0,h.d)(X,Y,$),(0,h.d)(K,J,$),(0,h.e)(n,K,X),(0,h.n)(n,n)}const ee=(0,d.Ue)();function te(e,t,i){const r=e.getMutableAttribute(z.T.POSITION),n=e.getMutableAttribute(z.T.NORMALCOMPRESSED).data,{topVertexStart:s,topVertexCount:o,topFaceStart:a,topFaceCount:l}=t,c=r.data,u=o,d=e.attributes.get(z.T.POSITION).indices,p=a+l,f=s+o,g=(0,m.bg)(3*u);for(let e=0;e<u;++e){const t=3*e;g[t+0]=0,g[t+1]=0,g[t+2]=0}const y=le,_=ce,v=ue,b=he,w=re;for(let e=a;e<p;++e){const t=3*e;for(let e=0;e<3;++e){const r=d[t+e];b[e]=r;const n=3*r;(0,h.i)(ie,c[n+0],c[n+1],c[n+2]),(0,h.t)(y[e],ie,i)}(0,h.a)(_,y[1],y[0]),(0,h.a)(v,y[2],y[0]),(0,h.e)(w,_,v),(0,h.n)(w,w);for(let e=0;e<3;++e){const t=3*(b[e]-s);g[t+0]+=w[0],g[t+1]+=w[1],g[t+2]+=w[2]}}for(let e=s;e<f;++e){const t=3*(e-s),i=g[t+0],r=g[t+1],o=g[t+2],a=Math.sqrt(i*i+r*r+o*o);(0,U.hd)(n,e,i/a,r/a,o/a)}}const ie=(0,d.Ue)(),re=(0,d.Ue)(),ne=new w.Lm,se=[0,2,1],oe=[0,1,2],ae=.01,le=[(0,d.Ue)(),(0,d.Ue)(),(0,d.Ue)()],ce=(0,d.Ue)(),ue=(0,d.Ue)(),he=[0,0,0];var de;!function(e){e[e.Main=0]="Main",e[e.Bottom=1]="Bottom"}(de||(de={}));class pe{constructor(e,t,i,r){this.positions=e,this.elevation=t,this.normals=i,this.heights=r}}class fe{constructor(e,t,i,r){this.topVertexStart=e,this.topVertexCount=t,this.topFaceStart=i,this.topFaceCount=r}}},51555:(e,t,i)=>{i.d(t,{z:()=>r});class r{constructor(e,t,i){this.graphic=e,this.renderingInfo=t,this.layer=i}}},14287:(e,t,i)=>{i.d(t,{YT:()=>J,_D:()=>te,Ly:()=>ee});var r=i(30936),n=i(39994),s=i(95550),o=i(81095),a=i(52721),l=i(3330),c=i(94984),u=i(87076),h=i(63669),d=i(29642),p=i(51555),f=i(85274),m=i(64705),g=i(17905),y=i(14923),_=i(63593),v=i(57877),b=i(85799),w=i(95399),x=i(63885),T=i(21414),C=i(21130),S=i(45867),E=i(44685),M=i(35031),A=i(5079),R=i(7358),O=i(46378),P=i(21123),I=i(9969),L=i(62575),D=i(1485),N=i(91907),F=i(17346);class U extends L.A{constructor(e,t){super(e,t,new I.J(D.L,(()=>i.e(23003).then(i.bind(i,23003)))))}initializePipeline(e){const{hudDepth:t,terrainDepthTest:i}=e,r={func:i?N.wb.ALWAYS:N.wb.LESS};return(0,F.sm)(t?{depthTest:r,depthWrite:F.ck}:{blending:(0,F.wK)(N.zi.ONE,N.zi.SRC_ALPHA,N.zi.ONE_MINUS_SRC_ALPHA,N.zi.ONE_MINUS_SRC_ALPHA),depthTest:r,colorWrite:F.gf})}}var k=i(36663),z=i(12907),B=i(22957);class V extends B.W{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}}(0,k._)([(0,z.o)()],V.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,k._)([(0,z.o)()],V.prototype,"occlusionTestEnabled",void 0),(0,k._)([(0,z.o)()],V.prototype,"hasVerticalOffset",void 0),(0,k._)([(0,z.o)()],V.prototype,"hasScreenSizePerspective",void 0),(0,k._)([(0,z.o)()],V.prototype,"hudDepth",void 0),(0,k._)([(0,z.o)()],V.prototype,"hudDepthAlignStart",void 0),(0,k._)([(0,z.o)()],V.prototype,"terrainDepthTest",void 0);var H=i(5226);class G extends R.F5{constructor(e,t){super(e,q),this.produces=new Map([[O.r.LINE_CALLOUTS,e=>(0,M.c1)(e)],[O.r.LINE_CALLOUTS_HUD_DEPTH,e=>(0,M.c1)(e)]]),this._configuration=new V(t),this._uniqueMaterialIdentifier=j(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){const i=t.slot===O.r.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.hudDepth=i,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration}get visible(){return this.parameters.color[3]>=H.e||(this.parameters.borderColor?.[3]??0)>=H.e}intersect(){}createGLMaterial(e){return new Z(e)}createBufferWriter(){return new Y}validateParameters(e){this._uniqueMaterialIdentifier=j(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}}function j({renderOccluded:e,isDecoration:t,horizontalScreenOffset:i,color:r,size:n,occlusionTest:s,shaderPolygonOffset:o,hudDepthAlignStart:a,centerOffsetUnits:l,hasSlicePlane:c,screenSizePerspective:u,verticalOffset:h,borderColor:d}){return C.pv`${e}:${t}:${i}:[${r}]:${n}:${s}:${o}:${a}:${l}:${c}:${null!=u}:{${h.screenLength}:${h.minWorldLength}:${h.maxWorldLength}}:[${d}]`}class Z extends A.Z{beginSlot(e){return this.getTechnique(U,e)}}class q extends R.Mt{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=(0,a.al)(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const W=(0,E.U$)().vec3f(T.T.POSITION).vec3f(T.T.NORMAL).vec2f(T.T.UV0).vec4f(T.T.CENTEROFFSETANDDISTANCE),$=[(0,S.al)(0,0),(0,S.al)(1,0),(0,S.al)(0,1),(0,S.al)(1,0),(0,S.al)(1,1),(0,S.al)(0,1)];class Y{constructor(){this.vertexBufferLayout=W}elementCount(e){return 6*e.get(T.T.POSITION).indices.length}write(e,t,i,r,n,s){(0,P.ho)(i.get(T.T.POSITION),e,n.position,s,6),(0,P.s5)(i.get(T.T.NORMAL),t,n.normal,s,6),(0,P.SW)(i.get(T.T.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,s,6);for(let e=0;e<$.length;++e)n.uv0.setVec(s+e,$[e])}}class J extends g.k{constructor(e,t){super(e,null,t,Q),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new G(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){const e=new q,t=this.symbol,i=t.callout;if(i.color){const t=r.Z.toUnitRGBA(i.color);t[3]*=this._getLayerOpacity(),e.color=t}else e.color=a.AG;if(e.size=(0,s.F2)(i.size||0),t.verticalOffset){const{screenLength:i,minWorldLength:r,maxWorldLength:n}=t.verticalOffset;e.verticalOffset={screenLength:(0,s.F2)(i),minWorldLength:r||0,maxWorldLength:null!=n?n:1/0}}e.borderColor=null!=i.border?.color?r.Z.toUnitRGBA(i.border.color):null;const o="object"===t.symbolLayers.at(0).type,l="label-3d"===t.type;return e.occlusionTest=!o&&!(0,n.Z)("enable-feature:non-occluded-hud"),o&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=l,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return K}createGraphics3DGraphic(e){const t=e.renderingInfo,i=e.graphic,r=this.setGraphicElevationContext(i,new d.o,t.elevationOffset||0),n=t.symbol,s="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some((e=>"object"===e.type||"text"===e.type)));if("label-3d"!==n.type&&s)return null;if("point-3d"===n.type&&n.symbolLayers.every((e=>"text"===e.type&&!(0,c.as)(e))))return null;const o=(0,y.zE)(i.geometry);return null==o?null:this._createAs3DShape(o,r,t,i.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,n=(0,h.GC)(J.elevationModeChangeTypes,i,r);return n!==h.lO.UPDATE||e.forEach((e=>{const i=t(e);null!=i&&this.updateGraphicElevationContext(e.graphic,i)})),n}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t,i=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(i),t}updateGraphicElevationContext(e,t){const{elevationContext:i,metadata:r}=t;this.setGraphicElevationContext(e,i,r?.elevationOffset??0),t.needsElevationUpdates=(0,h.Xf)(i.mode)}computeComplexity(){return new v.eH({verticesPerFeature:6})}_getOrCreateMaterial(e){const t=this._perInstanceMaterialParameters(e),i=j(t);if(i===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=e.materialCollection){let r=e.materialCollection.get(i);return null==r&&(r=new G(t,this._context.spherical),e.materialCollection.add(i,r)),{material:r,isUnique:!1}}return{material:new G(t,this._context.spherical),isUnique:!0}}_createAs3DShape(e,t,i,r){const n=this._context.layer.uid,s=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:n}),o=this._getOrCreateMaterial(i),a=new x.Z(o.material,function(e){const{translation:t,centerOffset:i}=e,r=new b.a(t?[t[0],t[1],t[2]]:[0,0,0],X,3,!0),n=new b.a(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],X,4,!0);return[[T.T.POSITION,r],[T.T.NORMAL,new b.a([0,0,1],X,3,!0)],[T.T.CENTEROFFSETANDDISTANCE,n]]}(i),null,w.U.Point,s),l=(0,_.ZC)(this._context,e,a,t,r);if(null==l)return null;const c=new f.z(this,l.object,[a],o.isUnique?[o.material]:null,null,u.j3,t);return c.metadata=new m.n(i.elevationOffset),c.alignedSampledElevation=l.sampledElevation,c.needsElevationUpdates=(0,h.Xf)(t.mode),(0,_.dO)(c,e,this._context.elevationProvider),c}}J.elevationModeChangeTypes={definedChanged:h.lO.UPDATE,staysOnTheGround:h.lO.UPDATE,onTheGroundChanged:h.lO.RECREATE};const X=[0],K={mode:"relative-to-ground",offset:0},Q={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class ee extends l.E{constructor(e,t,i=(0,o.Ue)(),r=(0,a.Ue)(),n=0,s="world",l=0,c=null){super(e,t),this.translation=i,this.centerOffset=r,this.horizontalScreenOffset=n,this.centerOffsetUnits=s,this.elevationOffset=l,this.materialCollection=c}}class te extends p.z{}},85274:(e,t,i)=>{i.d(t,{n:()=>d,z:()=>p});var r=i(86717),n=i(81095),s=i(37116),o=i(73687),a=i(63669),l=i(64487),c=i(14923),u=i(70984),h=i(75427);class d{constructor(e,t,i){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=i}}class p{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,i,r,n,s,o,a=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=i,this._uniqueMaterials=r,this._sharedResource=n,this.elevationAligner=s,this.elevationContext=o,this._edgeState=a,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const t=e.stage;t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,t){const{stageObject:i,_edgeState:r,_stageLayer:n}=this;if(null==r)return;const s=f(r.baseMaterial);r.edgeMaterial.objectTransparency!==s&&(r.edgeMaterial.objectTransparency=s,this.resetEdgeObject(t)),n.stage.renderer.withEdgeView((t=>t.updateAllComponentOpacities(i,[e])))}updateHighlights(e){}slicePlaneEnabledChanged(e,t){const{stageObject:i,_edgeState:r,_stageLayer:n}=this;null!=r&&n.stage.renderer.withEdgeView((n=>{n.updateAllComponentMaterials(i,r.edgeMaterial,e,!t),r.hasSlicePlane=e}))}setVisibility(e){const{_edgeState:t,stageObject:i,_stageLayer:r}=this;null!=r&&this.visible!==e&&(this._visible=e,i.visible=e,e&&!this._addedToStage&&(r.add(i),this._addedToStage=!0),null!=t&&r.stage.renderer.withEdgeView((r=>{r.hasObject(i)?r.updateObjectVisibility(i,e):e&&this._addOrUpdateEdgeObject(t,r,!1)})))}get visible(){return this._visible}alignWithElevation(e,t,i,r){if(null==this.elevationAligner)return;null!=i&&(0,l.aO)(this.elevationContext.featureExpressionInfoContext,i);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,((i,r)=>(0,a.qZ)(i,e,this.elevationContext,t,r)),t),this.resetEdgeObject(r)}alignWithAbsoluteElevation(e,t,i){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,((t,i)=>{i.sampledElevation=e,i.verticalDistanceToGround=0,i.z=e}),t),this.resetEdgeObject(i)}getCenterObjectSpace(e=(0,n.Ue)()){return(0,r.c)(e,(0,o.a)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=(0,s.Ue)()){const t=this.stageObject.boundingVolumeObjectSpace;return(0,s.op)(e,t.min),(0,s.Tn)(e,t.max),e}computeAttachmentOrigin(e){const t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(y)&&((0,r.t)(y,y,t),(0,r.g)(e.render.origin,e.render.origin,y),e.render.num++)}async getProjectedBoundingBox(e,t,i,n,o){const a=this.getBoundingBoxObjectSpace(o),l=_,u=(0,s.wp)(a)?1:l.length;for(let e=0;e<u;e++){const t=l[e];g[0]=a[t[0]],g[1]=a[t[1]],g[2]=a[t[2]],(0,r.t)(g,g,this.stageObject.transformation),m[3*e]=g[0],m[3*e+1]=g[1],m[3*e+2]=g[2]}if(!e(m,0,u))return null;(0,s.cS)(a);let h=null;this.calculateRelativeScreenBounds&&(h=this.calculateRelativeScreenBounds());for(let e=0;e<3*u;e+=3){for(let t=0;t<3;t++)a[t]=Math.min(a[t],m[e+t]),a[t+3]=Math.max(a[t+3],m[e+t]);h&&i.push({location:m.slice(e,e+3),screenSpaceBoundingRect:h})}if(t?.service&&"absolute-height"!==this.elevationContext.mode){(0,s.be)(a,y);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let i=0;if(t.useViewElevation)i=t.service.getElevation(y[0],y[1],e)??0;else try{const r=(0,c.Si)(a,t.service.spatialReference,t);i=await t.service.queryElevation(y[0],y[1],n,r,e)??0}catch(e){}(0,s.cv)(a,0,0,-this.alignedSampledElevation+i)}return a}addObjectState(e){e.stateType===u.V_.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===u.V_.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:t,stageObject:i,_stageLayer:r,_visible:n}=this;null!=t&&r.stage.renderer.withEdgeView((r=>{n?this._addOrUpdateEdgeObject(t,r,e):r.removeObject(i)}))}_addOrUpdateEdgeObject(e,t,i){const r=f(e.baseMaterial);e.edgeMaterial.objectTransparency=r,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!i).then((()=>this._stageLayer?.sync()))}}function f(e){return e.parameters.transparent?h.i.TRANSPARENT:h.i.OPAQUE}const m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=(0,n.Ue)(),y=(0,n.Ue)(),_=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},64705:(e,t,i)=>{i.d(t,{n:()=>r});class r{constructor(e,t=null){this.labelText=t,this.elevationOffset=e??0}}},53187:(e,t,i)=>{i.d(t,{JK:()=>s,t7:()=>r,wg:()=>n});const r=3,n=3,s=10},39171:(e,t,i)=>{i.d(t,{q:()=>O});var r=i(7753),n=i(67979),s=(i(39994),i(78668)),o=i(11259),a=i(99235),l=i(34596),c=i(36531),u=i(84164),h=i(86717),d=i(81095),p=i(89542),f=i(72884),m=i(37116),g=i(24568),y=i(35925),_=i(48358),v=i(12065),b=i(12391),w=i(64487);const x=new l.Z(Array,(e=>(0,m.t8)(e,m.bM)),null,10,5),T=(0,g.Ue)();class C{get labelLayers(){return this._labelLayers||r.ow}get extent(){return this._extent}get isElevationSource(){return this.layers.some((e=>e?.isElevationSource))}constructor(e,t,i,r,n){this.graphic=e,this.graphics3DSymbol=t,this.layers=i,this._visibleFlags=b.P.ALL_LABEL,this.deconflictionPriority=0,++t.referenced,this._featureExpressionFeature=n?(0,w.Tz)(n,e,r):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic((t=>{t.initialize(e),t.setVisibility(this.isVisible())}))}destroy(){this._forEachSymbolLayerGraphic((e=>e.destroy())),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic((e=>e.destroy())),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(b.E.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic((t=>{"draped"===t.type&&(e=!0)})),e}isVisible(e=b.E.GRAPHIC,t){const i=t?this._visibleFlags|t|b.E.LABEL*t:this._visibleFlags;return e===b.E.GRAPHIC?(i&b.P.ALL_GRAPHIC)===b.P.ALL_GRAPHIC:(i&b.P.ALL_LABEL)===b.P.ALL_LABEL}setVisibilityFlag(e,t,i){const r=this.isVisible(e);i?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);const n=this.isVisible(e);if(r===n)return!1;if(e===b.E.LABEL)this._forEachLabelGraphic((e=>e.setVisibility(n)));else{this._forEachSymbolLayerGraphic((e=>e.setVisibility(n)));const e=this.isVisible(b.E.LABEL);this._forEachLabelGraphic((t=>t.setVisibility(e)))}return!0}getVisibilityFlag(e,t){return!!(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(null==t)return!1;this._extent=(0,g.Ue)(),(0,_.TF)(t,this._extent);const i=t.spatialReference;if(!(0,y.fS)(i,e)&&!(0,f.d)(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,i){let r=e.geometry;return"mesh"!==r.type&&"extent"!==r.type||(r=p.Z.fromExtent("mesh"===r.type?r.extent:r)),(0,v.GH)(r,t,i)}get usedMemory(){let e=(0,a.F$)(this.graphic.attributes);return this._forEachSymbolLayerGraphic((t=>e+=t.graphics3DSymbolLayer.usedMemory)),e}computeAttachmentOrigin(){const e={render:{origin:(0,d.Ue)(),num:0},draped:{origin:(0,u.Ue)(),num:0}};for(const t of this.layers)null!=t&&t.computeAttachmentOrigin(e);return e.render.num>1&&(0,h.h)(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&(0,c.bA)(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,i,r,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?(0,m.cS)(s.boundingBox):s.boundingBox=(0,m.cS)(),s.requiresDrapedElevation=!1,await(0,n.Ed)(this.layers,(async n=>{if(null==n)return;const o="draped"===n.type?t:e,a=x.acquire(),l=await n.getProjectedBoundingBox(o,i,s.screenSpaceObjects,r,a);isFinite(l[2])&&isFinite(l[5])||(s.requiresDrapedElevation=!0),l&&(0,m.TC)(s.boundingBox,a),x.release(a)})),(0,m.sU)(s.boundingBox)||(0,g.sU)((0,m.y8)(s.boundingBox,T))?s:null}needsElevationUpdates(){for(const e of this.layers)if(null!=e&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;return this._labelLayers?.some((e=>e?.needsElevationUpdates??!1))??!1}alignWithElevation(e,t,i){this._forEachRenderedGraphic((r=>{"object3d"!==r.type&&"lod-instance"!==r.type||r.alignWithElevation(e,t,this._featureExpressionFeature,i)}))}alignWithAbsoluteElevation(e,t,i){this._forEachRenderedGraphic((r=>{"object3d"===r.type&&r.alignWithAbsoluteElevation(e,t,i)}))}addObjectStateSet(e){this._forEachSymbolLayerGraphic((t=>t.addObjectState(e)))}removeObjectState(e){this._forEachSymbolLayerGraphic((t=>t.removeObjectState(e)))}updateHighlights(e){this._forEachSymbolLayerGraphic((t=>t.updateHighlights(e)))}_forEachGraphicList(e,t){e?.forEach((e=>e&&t(e)))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}}var S=i(85274),E=i(26355),M=i(4357),A=i(53266),R=i(2011);class O extends A.w{set symbol(e){this._symbol=e,e.symbolLayers.forEach(((t,i)=>{const r=this.symbolLayers[i];null!=r&&(r.symbol=e,r.symbolLayer=t)}))}get symbol(){return this._symbol}constructor(e,t,i){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const o=[],{make:a}=await Promise.all([i.e(95215),i.e(93911),i.e(30838),i.e(4136)]).then(i.bind(i,84191));for(let i=0;i<r;i++){const n=t.at(i);if(!1===n.enabled)continue;P.renderPriority=1-(1+i)/r,P.renderPriorityStep=1/r,P.ignoreDrivers=n.ignoreDrivers;const l=a(this.symbol,n,this._context,P),c=(0,s.$F)(e,(()=>{this.symbolLayers[i]=null,l.destroy()}));c&&o.push(c),this.symbolLayers[i]=l}if(await(0,n.Ed)(this.symbolLayers,(async(e,t)=>{if(null!=e)try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}})),o.forEach((e=>e.remove())),(0,s.k_)(e),this.symbolLayers.length&&!this.symbolLayers.some((e=>!!e)))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return null!=t?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some((e=>e?.queryForSnapping))}updateFocus(e,t){this.symbolLayers.forEach((i=>i?.updateFocus(e,t)))}createGraphics3DGraphic(e,t){const i=e.graphic,r=this.symbolLayers.map((t=>t?.createGraphics3DGraphic(e)??null)),n=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new C(i,t||this,r,e.layer,n)}get complexity(){return(0,o.IQ)(this.symbolLayers.map((e=>null!=e?e.complexity:null)))}globalPropertyChanged(e,t){const i=this.symbolLayers.length;for(let r=0;r<i;r++){const i=this.symbolLayers[r],n=e=>{const t=e.layers[r];return t instanceof S.z?t:null};if(null!=i&&!i.globalPropertyChanged(e,t,n))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==A.P.LOADED?M.W.RecreateSymbol:this.symbolLayers.reduce(((i,r)=>i!==M.W.RecreateSymbol&&null!=r?Math.min(i,r.applyRendererDiff(e,t)):i),M.W.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===A.P.FAILED)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const i=t.symbolLayers.diff;this.symbolLayers.forEach(((t,r)=>{if(null==t)return;const n=i[r];if(n){const i={diff:n,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(i),e.symbolStatePatches.push(...i.symbolLayerStatePatches),i.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push(((e,t)=>{const n=e.layers[r];null!=n&&i.graphics3DGraphicPatches.forEach((e=>e(n,t)))}))}}))}updateGeometry(e,t){return this._updateGeometryOrTransform(e,((e,i)=>e.updateGeometry(i,t)))}updateTransform(e,t,i,r){return this._updateGeometryOrTransform(e,((e,n)=>e.updateTransform(n,t,i,r)))}_updateGeometryOrTransform(e,t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(null==r)continue;const n=e.layers[i];if(!n||!t(r,n))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const i=this.symbolLayers[t];if(null==i)continue;const r=e.layers[t];null!=r&&i.onRemoveGraphic(r)}}getFastUpdateStatus(){let e=!1,t=!1;for(const i of this.symbolLayers)if(null!=i){if(i.loadStatus===A.P.LOADING)return M.X.Loading;i.isFastUpdatesEnabled()?t=!0:e=!0}return t?e?M.X.Mixed:M.X.Fast:e?M.X.Slow:M.X.Undefined}async queryForSnapping(e,t,i,n){const o=this.symbolLayers.filter(r.pC).filter((e=>null!=e.queryForSnapping)).map((r=>r.queryForSnapping(e,t,i,n))),a=await Promise.all(o);return(0,s.k_)(n),a.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)null!=e&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get cachedMemory(){return(0,R.n)(this)}}const P=new E.W},26355:(e,t,i)=>{i.d(t,{U:()=>n,W:()=>s});var r=i(65684);class n{constructor(e,t){this.scheduler=e,this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===r.JY.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}}class s{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}}},17905:(e,t,i)=>{i.d(t,{k:()=>y});var r=i(30936),n=(i(39994),i(13802)),s=i(81095),o=i(52721),a=i(38028),l=i(11259),c=i(63669),u=i(29642),h=i(64487),d=i(14923),p=i(4357),f=i(53266),m=i(85132);const g=()=>n.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class y extends f.w{constructor(e,t,i,r){super(i.schedule),this.symbol=e,this.symbolLayer=t,this._context=i,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=g(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=r.renderPriority,this._renderPriorityStep=r.renderPriorityStep,this._elevationContext=new u.o,this.complexity=this.computeComplexity(),this.ignoreDrivers=r.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=_(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get usedMemory(){const e=this.complexity;return null==e?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const t=this._drivenProperties,i=_(e);return i.color!==t.color||i.opacity!==t.opacity||i.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||i.size!==t.size||i.rotation!==t.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,i,r){const n=e.projectionSuccess,s="polygons"in e?e.polygons:null,o=`${r} geometry failed to be created`;n?!this._logGeometryValidationWarnings(t,i,r)&&s&&0===s.length&&"rings"===i&&t.length>0&&t[0].length>2&&g().warnOncePerTick(`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):g().warnOncePerTick(`${o} (failed to project geometry to view spatial reference)`)}updateFocus(e,t){}_logGeometryValidationWarnings(e,t,i){const r=`${i} geometry failed to be created`;return!e.length||1===e.length&&!e[0].length?(g().warnOncePerTick(`${r} (no ${t} were defined)`),!0):!(Array.isArray(e)&&Array.isArray(e[0])||(g().warnOncePerTick(`${r} (${t} should be defined as a 2D array)`),0))}_validateGeometry(e,t=null,i=null){if(null!=t&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const t=e;if(!isFinite(t.x)||!isFinite(t.y))return g().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":(0,a.Zy)(e)&&g().warnOnce("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return v}_defaultElevationInfoZ(){return b}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t=new u.o){const i=e.geometry,r=this.getDefaultElevationInfo(i);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:r.unit,t.mode=this.getGeometryElevationMode(i,r),t.offsetMeters=this._elevationContext.meterUnitOffset??r.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;n&&(t.mode="relative-to-ground",t.offsetMeters=0);const s=n?h.O$:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(s,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}updateTransform(e,t,i,r){return!1}onRemoveGraphic(e){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;return this._context.layer.opacity??1}_getCombinedOpacity(e,t=w){const i=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?i:e?i*e.a:t.hasIntrinsicColor?i:0}_getCombinedOpacityAndColor(e,t=w){const i=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return(0,d.Uu)(null,i);const n=null!=e?r.Z.toUnitRGB(e):s.hq;return(0,d.Uu)(n,i)}_getVertexOpacityAndColor(e,t=null){const i=this._drivenProperties.color?e.color:null,r=this._drivenProperties.opacity?e.opacity:null,n=(0,d.Uu)(i,r);return t&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return(0,l.u)(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,i){switch(e){case"opacity":return this.layerOpacityChanged(t,i),!0;case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,i,e)!==c.lO.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,i){let r=c.lO.UPDATE;return e.forEach((e=>{const n=t(e);if(null!=n){const t=e.graphic;this.setGraphicElevationContext(t,n.elevationContext),n.needsElevationUpdates=i(n.elevationContext.mode)}else r=c.lO.RECREATE})),r}applyRendererDiff(e,t){return p.W.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const t=this._fastUpdates.visualVariables,i=t.size?(0,m.kD)(t.size.field,e):0,r=t.color?(0,m.kD)(t.color.field,e):0,n=t.opacity?(0,m.kD)(t.opacity.field,e):0;return(0,o.al)(i,r,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&g().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}}}function _(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach((e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let i=0;i<e.stops.length;i++){const r=e.stops[i].color;r&&(t.opacity=!0,r.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0;break;case"rotation":t.rotation=!0}})),t}const v={mode:"on-the-ground",offset:0,unit:"meters"},b={mode:"absolute-height",offset:0,unit:"meters"},w={hasIntrinsicColor:!1}},27437:(e,t,i)=>{i.d(t,{l:()=>l});var r=i(74063),n=i(11259),s=i(4357),o=i(53266),a=i(2011);class l extends o.w{constructor(e,t,i){super(t),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e,acceptedFormats:r.h});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:n.WU}globalPropertyChanged(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(e,t):s.W.RecreateSymbol}prepareSymbolPatch(e){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,i,r){return this.graphics3DSymbol?.updateTransform(e,t,i,r)??!1}onRemoveGraphic(){}updateFocus(e,t){}getFastUpdateStatus(){return this.graphics3DSymbol?.getFastUpdateStatus()??s.X.Loading}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}get cachedMemory(){return(0,a.n)(this)}}},39142:(e,t,i)=>{i.d(t,{U:()=>a,a:()=>o});var r=i(84164),n=i(81095),s=i(52721);class o{constructor(e,t="center",i=!1,o=(0,r.Ue)(),a=(0,s.al)(0,0,0,-1),l="world",c=(0,n.Ue)(),u=0){this.verticalOffset=e,this.anchor=t,this.hasLabelVerticalOffset=i,this.screenOffset=o,this.centerOffset=a,this.centerOffsetUnits=l,this.translation=c,this.elevationOffset=u}}class a{constructor(e,t="center",i="center",n=null,s=(0,r.Ue)(),o=!0){this.placement=e,this.horizontalPlacement=t,this.verticalPlacement=i,this.text=n,this.displaySize=s,this.isFocused=o}}},77485:(e,t,i)=>{i.d(t,{S:()=>$,C:()=>ee});var r=i(36663),n=i(74396),s=i(67979),o=(i(39994),i(13802)),a=i(61681),l=i(78668),c=i(76868),u=i(81977),h=(i(4157),i(40266)),d=i(84164),p=i(45043),f=i(13667),m=i(94984),g=i(12391),y=i(18831),_=i(14287),v=i(39171),b=i(27437);function w(e){return e instanceof b.l?e.graphics3DSymbol:e instanceof v.q?e:null}var x=i(86717),T=i(81095),C=i(37116),S=i(9423),E=i(39142),M=i(90670),A=i(98166);const R=()=>o.Z.getLogger("esri.views.3d.layers.graphics.labelPlacement");class O{constructor(e,t,i,r=null){this._graphic=e,this._symbol=t,this._class=i,this._disablePlacement=r}get placement(){const e=this._verticalOffsetPlacement;if(null==e)return null;const t=this._getPlacementInfo(e);if(null==t)return null;const i=t.anchor,r=!!e.hasLabelVerticalOffset,n=e.verticalOffset,s=new E.a(n,i,r);return this._calculatePlacementOffsets(s,t)}get _verticalOffsetPlacement(){const e=this._class.labelPlacement,{_symbol:t,_graphic:i}=this,r=w(i.graphics3DSymbol),n="point-3d"===r?.symbol.type?r.symbol:null,s=L[e]||this._defaultPlacementInfo;return n?.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:n.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!t?.hasVisibleVerticalOffset()||null!=n&&n.supportsCallout()&&n.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:s&&function(e){return"above-center"===e}(s.placement)?{placement:"above-center",verticalOffset:t.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,s.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(R().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}_getPlacementInfo(e){if(e.anchor)return e;const t=this._class.labelPlacement,i=L[t],r=i||this._defaultPlacementInfo;return t&&!i&&R().warnOncePerTick(`the requested label placement '${t}' is currently unsupported in SceneView.`),this._validatePlacementInfo(r)}_calculatePlacementOffsets(e,t){const i=this._graphic.graphic.geometry;if(null==i)return null;switch(i.type){case"point":this._setPointSpecificPlacement(e,t);break;case"mesh":this._setMeshSpecificPlacement(e,t);break;case"polygon":this._setPolygonSpecificPlacement(e,t)}const r=S.aT-M.Wg;return e.screenOffset[0]+=r*t.normalizedOffset[0],e.screenOffset[1]+=r*t.normalizedOffset[1],e}get _defaultPlacementInfo(){const e=this._graphic.graphic.geometry;if(null==e)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:T.AG,anchor:"center"};case"polygon":return"extrude"===this._firstSymbolLayer?.type?L["above-center"]:{placement:"center-center",normalizedOffset:T.AG,anchor:"center"};case"point":case"mesh":return L["above-center"];default:return}}_validatePlacementInfo(e){const t=this._graphic.graphic.geometry;if(null==t)return null;if(null!=this._disablePlacement)return this._class.labelPlacement?(R().warnOncePerTick(P(e?.placement,this._disablePlacement.logEntityDescription)),this._defaultPlacementInfo):e;const i=t.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(this._class.labelPlacement)return R().warnOncePerTick(P(e?.placement,`'${i}' geometries`)),this._defaultPlacementInfo;break;case"point":case"mesh":return e}return e}_setPointSpecificPlacement(e,t){const i=this._firstSymbolLayer;if(null==i)return;const r=this._graphic.layers[0];switch(null!=r?r.getCenterObjectSpace(e.translation):(0,x.i)(e.translation,0,0,0),i.type){case"icon":case"text":this._setHUDSpecificPlacement(e,t,r);break;case"object":I(e,t,r)}}_setMeshSpecificPlacement(e,t){const i=this._firstSymbolLayer;null!=i&&"fill"===i.type&&I(e,t,this._graphic.layers[0])}_setPolygonSpecificPlacement(e,t){const i=this._firstSymbolLayer;if(null!=i)switch(i.type){case"extrude":{const i=this._graphic.layers[0];null!=i?(i.getBoundingBoxObjectSpace(F),(0,C.be)(F,e.translation),e.translation[2]=(0,C.Cb)(F)/2):(0,x.i)(e.translation,0,0,0),I(e,t,i);break}}}_setHUDSpecificPlacement(e,t,i){const{_graphic:r}=this,n=null!=i?i.getScreenSize():null;if(r.isDraped||null==n)e.hasLabelVerticalOffset||"center"===e.anchor||(L[this._class.labelPlacement]&&R().warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center");else{const i=this._normalizedSymbolAnchorPos;e.screenOffset[0]=n[0]/2*(t.normalizedOffset[0]-i[0]);const r=n[1]/2*(t.normalizedOffset[1]-i[1]);e.hasLabelVerticalOffset?(e.centerOffset[1]=r,e.centerOffsetUnits="screen"):e.screenOffset[1]=r}}get _firstSymbolLayer(){const e=w(this._graphic.graphics3DSymbol);return null!=e?e.symbol.symbolLayers.at(0):null}get _normalizedSymbolAnchorPos(){const e=this._graphic.layers[0]?.stageObject.geometries[0].material??null;if(e&&e instanceof A.A){const t=e.parameters.anchorPosition;N[0]=2*(t[0]-.5),N[1]=2*(t[1]-.5)}else N[0]=0,N[1]=0;return N}}function P(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function I(e,t,i){const r=null!=i?i.getBoundingBoxObjectSpace(F):F,n=(0,T.al)(r[3]-r[0],r[4]-r[1],r[5]-r[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);e.centerOffset[0]=s/2*t.normalizedOffset[0];const o=e.translation[2],a=n[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=(0,x.l)(n);e.centerOffset[2]=l/2*t.normalizedOffset[2]}const L={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},D={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in D){const t=D[e],i=L[e];t.forEach((e=>{L[e]=i}))}Object.freeze&&(Object.freeze(L),Object.keys(L).forEach((e=>{Object.freeze(L[e]),Object.freeze(L[e]?.normalizedOffset)})));const N=[0,0],F=(0,C.Ue)();var U=i(89160);class k{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,t){this._materials.set(e,t),this._stage.add(t)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}var z=i(71667),B=i(82400),V=i(21414),H=i(26982),G=i(22167),j=i(14169);class Z{constructor(e,t){this.labelingContext=e,this.graphics3DGraphic=t,this.hasGraphics3DResources=!1,this.visible=!1,this.textureAtlasHandles=[],this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}}class q{constructor(e,t,i,r,n){this.labelClass=e,this.graphics3DSymbol=t,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=r,this.labelFunction=n,this.calloutSymbolLayerIndex=0}}class W{constructor(e,t,i,r,n,s,o,a){this.layer=t,this.graphics3DCore=i,this.scaleVisibility=r,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=s,this.disablePlacement=o,this.active=a,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new H.F(e,{pickable:!0,disableOctree:!0},t.uid)}destroy(){this.stageLayer.destroy()}}let $=class extends n.Z{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([(0,c.watch)((()=>this.view.state?.camera),(()=>this.setDirty())),(0,c.watch)((()=>this.view.state?.rasterPixelRatio),(()=>this._resetAllLabels())),this.view.resourceController.scheduler.registerTask(G.T8.LABELER,this)]),this._textTextureAtlas=new B.U({view:this.view}),this._hudMaterialCollection=new k(this.view._stage),this._calloutMaterialCollection=new k(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=(0,a.M2)(this._textTextureAtlas),this._hudMaterialCollection=(0,a.M2)(this._hudMaterialCollection),this._calloutMaterialCollection=(0,a.M2)(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),te.graphic=null,te.renderingInfo=null,te.layer=null}_activateLabelingContext(e){e.graphics.forEach(((t,i)=>{const r=new Z(e,t);this._labels.set(i,r),e.labelsToInitialize.set(i,r),t.setVisibilityFlag(g.E.LABEL,g.P.USER,!0)})),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach(((e,t)=>{e.setVisibilityFlag(g.E.LABEL,g.P.USER,!1),this.setLabelGraphicVisibility(e,!1),e.clearLabelGraphics(),this._labels.delete(t)})),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const i=e.textRenderers[t._labelIndex];i&&(e.textureAtlasHandles.push(this._textTextureAtlas.addText(i,(e=>J(t.stageObject,e)))),Y(t.stageObject,i))}}_removeLabelTextureFromAtlas(e){e.textureAtlasHandles.forEach((e=>e.remove())),e.textureAtlasHandles.length=0}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),j.J}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(t.active)if(X(t))this._dirty=!0;else if(K(t.labelClassContexts)){if(null===t.labelClassContexts){this._deactivateLabelingContext(t);continue}this._createLabelClassContext(t),this._dirty=!0}else for(const[i,r]of t.labelsToInitialize)if(this._ensureGraphics3DResources(r)&&(this._labels.set(i,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(t.labelsToInitialize.delete(i),e.madeProgress()),e.done){this._dirty=!0;break}this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController?.signal;e.layer.when&&await e.layer.when(),(0,l.k_)(t),e.scaleVisibility?.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer.labelingInfo?.filter((e=>!!e.symbol));if(!r||0===r.length)return;let n=!1;await(0,s.Ed)(r,(async(r,a)=>{const c=r.symbol,u=w(i.getOrCreateGraphics3DSymbol(c));if(null==u)return void o.Z.getLogger(this).error("Failed to create Graphics3DSymbol for label");await u.load(),(0,l.k_)(t);let h=null;(0,m.Pd)(c)&&c.hasVisibleCallout()&&(h=(0,y.S)(c,i.symbolCreationContext),await h.load(),(0,l.k_)(t));const d=await(0,s.q6)((0,f.J)(r,e.layer.fieldsIndex,this.view.spatialReference));if((0,l.k_)(t),!0===d.ok){const i=await this._createTextRenderParameters(u.symbol);(0,l.k_)(t),e.labelClassContexts[a]=new q(r,u,h,i,d.value)}else o.Z.getLogger(this).error(`Label expression failed to evaluate: ${d.error}`),n=!0})),(0,l.k_)(t)}async _createLabelClassContext(e){return null==e.labelClassPromise&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch((t=>{if((0,l.D_)(t))throw t;e.labelClassContexts.length=0})).then((()=>{e.labelClassAbortController=null,this.notifyChange("updating")})).catch((()=>{})),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.at(0);return"text"!==t?.type?null:z.V.fromSymbol(t,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const t of e.labelClassContexts)--t.graphics3DSymbol.referenced;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,(0,a.IM)(t),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,n,s){const o=new E.U(i,(0,U.zi)(i.anchor),(0,U.EP)(i.anchor),e.text,(0,d.al)(e.displayWidth,e.displayHeight));return te.graphic=t,te.layer=r,te.renderingInfo=null,n.createLabel(te,o,this._hudMaterialCollection,this._textTextureAtlas,(()=>s.placement?.elevationOffset??null))}_createLineCalloutGraphic(e,t,i,r,n){te.graphic=e,te.layer=n;const s=r.screenOffset[0];return te.renderingInfo=new _.Ly(null,t,r.translation,r.centerOffset,s,r.centerOffsetUnits,r.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(te)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,r=i.labelClassContexts;if(K(r)||!i.emptySymbolLabelSupported&&0===t.layers.length)return!1;let n=!1;const s=t.graphic,o=i.layer,a=ee(i.layer);for(let l=0;l<r.length;l++){const c=e.textRenderers[l],u=e.textLabelPlacements[l];if(null==c||null==u)continue;const h=r[l],d=h.graphics3DSymbol,p=Q(d),f=d.symbolLayers[0];if(!f)continue;f.setElevationInfoOverride(i.elevationInfoOverride);const m=new O(t,p,h.labelClass),y=this._createTextSymbolGraphic(c,s,u,o,f,m);if(null==y)return!1;y._labelClass=h.labelClass,y._labelIndex=l,t.addLabelGraphic(y,i.stageLayer),t.deconflictionPriority=h.textRenderParameters?.definition.size??0,t.setVisibilityFlag(g.E.LABEL,g.P.USER,a),t.setVisibilityFlag(g.E.LABEL,g.P.SCALE_RANGE,!0),t.setVisibilityFlag(g.E.LABEL,g.P.DECONFLICTION,!1),n=!0;const _=h.graphics3DCalloutSymbolLayer;if(_&&u.hasLabelVerticalOffset){_.setElevationInfoOverride(i.elevationInfoOverride);const e=this._createLineCalloutGraphic(s,p,_,u,o);null!=e&&(h.calloutSymbolLayerIndex=t.labelLayers.length,t.addLabelGraphic(e,i.stageLayer))}break}return n&&i.scaleVisibility?.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(null==i._labelClass)continue;t[i._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const t=e.labelingContext,i=t.labelClassContexts;if(K(i))return;const r=e.graphics3DGraphic.graphic;for(let n=0;n<i.length;n++){const s=i[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,null==s?.textRenderParameters)continue;const o=s.labelFunction;let a;if("arcade"===o.type)try{const e=o.needsHydrationToEvaluate()?(0,p.mW)(r,t.layer):r;a=o.evaluate(e)}catch(e){a=null}else a=o.evaluate(r);if(null==a||""===a||/^\s+$/.test(a))continue;const l=s.graphics3DSymbol;if(!l.symbolLayers[0])continue;const c=e.graphics3DGraphic,u="label-3d"===l.symbol?.type?l.symbol:null,h=s.labelClass,d=t.disablePlacement,f=new O(c,u,h,d).placement;if(null==f)continue;const m=(0,U.zi)(f.anchor),g=(0,U.mq)(m);e.textRenderers[n]=new M.tV(a,g,s.textRenderParameters,B.U.maxSize),e.textLabelPlacements[n]=f}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,t){const i=t.graphic.uid;if(e.graphics.set(i,t),e.active){const r=new Z(e,t);this._labels.set(i,r),e.labelsToInitialize.set(i,r)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,t){const i=t.graphic.uid,r=this._labels.get(i);if(!r)return!0;for(const i of r.graphics3DGraphic.labelLayers)if(null!=i._labelClass&&!e.labelClassContexts[i._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(i,t.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,t){const i=t.graphic.uid,r=this._labels.get(i);e.graphics.delete(i),r&&(this._destroyGraphic(r,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.delete(t),e.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const t=e.graphics.get(i);t&&(this._removeGraphic(e,t),this._addGraphic(e,t))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.graphics.forEach((e=>r.set(e.graphic.uid,e)));const n=e=>e.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,r,n),i.graphics3DCalloutSymbolLayer){const t=e=>e.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,t)}}}_visibilityInfoChange(e){const t=ee(e.layer);t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach(((t,i)=>{const r=this._labels.get(i);r&&(this._destroyGraphic(r,i),r.visible=!1,e.labelsToInitialize.set(i,r))})),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i?.emptySymbolLabelSupported||!1,n=i?.elevationInfoOverride||null,s=i?.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a=new W(this.view._stage,o,e,t,r,n,s,ee(o));return this._labelingContexts.push(a),this.setDirty(),{addGraphic:e=>this._addGraphic(a,e),removeGraphic:e=>this._removeGraphic(a,e),updateGraphicGeometry:e=>this._updateGraphicGeometry(a,e),layerLabelsEnabled:()=>ee(a.layer),labelingInfoChange:e=>this._labelingInfoChange(a,e),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.graphics.forEach((e=>this._removeGraphic(t,e))),t.destroy(),this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.textureAtlasHandles.length?(this._addLabelTextureToAtlas(r),r.textInitialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(r),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some((e=>X(e)))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce(((e,t)=>e+(X(t)?0:1)),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){}};function Y(e,t){e.geometries[0].setAttributeData(V.T.SIZE,[t.displayWidth,t.displayHeight]),e.geometryVertexAttributeUpdated(e.geometries[0],V.T.SIZE)}function J(e,t){e.geometries[0].setAttributeData(V.T.UV0,t),e.geometryVertexAttributeUpdated(e.geometries[0],V.T.UV0,!0)}function X(e){return!!e.labelClassPromise&&!!e.labelClassAbortController}function K(e){return!e||0===e.length}function Q(e){return"label-3d"===e.symbol?.type?e.symbol:null}function ee(e){return!0===e.labelsVisible&&!!e.labelingInfo?.some((e=>!!e.symbol))}(0,r._)([(0,u.Cb)({constructOnly:!0})],$.prototype,"view",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],$.prototype,"deconflictor",void 0),(0,r._)([(0,u.Cb)()],$.prototype,"_textTextureAtlas",void 0),(0,r._)([(0,u.Cb)({type:Boolean,readOnly:!0})],$.prototype,"updating",null),$=(0,r._)([(0,h.j)("esri.views.3d.layers.graphics.Labeler")],$);const te=new _._D(null,null,null)},53266:(e,t,i)=>{i.d(t,{P:()=>r,w:()=>o});var r,n=i(61681),s=i(78668);class o{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=r.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===r.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===r.FAILED?(t&&t(this._loadError),this._loader??Promise.resolve()):(null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then((()=>{this._abortController=null,this._loadStatus=r.LOADED}),(e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=r.FAILED,!(0,s.D_)(e)&&this.logger&&e.message&&this.logger.warn(e.message),e}))),this._loader.then(e,t).catch((()=>{})),this._loader)}abortLoad(){null!=this._abortController?this._abortController=(0,n.IM)(this._abortController):this._loadStatus===r.LOADING&&(this._loadStatus=r.FAILED),this._loader=null}}!function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"}(r||(r={}))},57877:(e,t,i)=>{i.d(t,{SX:()=>a,VT:()=>o,Y6:()=>n,eH:()=>r,ti:()=>s});class r{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new a}}class n extends r{constructor(e){super(e),this.estimated=!0}}class s extends r{constructor(e,t){super(t),this.numComplexities=e}}class o extends n{constructor(e,t){super(t),this.numComplexities=e}}class a{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}},9423:(e,t,i)=>{i.d(t,{Cj:()=>s,PY:()=>n,aT:()=>o});var r=i(52721);const n=1.2,s=r.AG,o=4},11259:(e,t,i)=>{i.d(t,{BN:()=>g,IQ:()=>d,V9:()=>h,WU:()=>u,bz:()=>p,iu:()=>_,u:()=>m});var r=i(27755),n=i(4125),s=i(53187),o=i(60910),a=i(57877),l=i(57180),c=i(46151);const u=new a.Y6({});function h(e){return"web-style"===e.type?u:d(e.symbolLayers.toArray().map((t=>m(e,t))))}function d(e){let t=0,i=0,r=0,n=!1,s=0;const o=new a.SX;for(const a of e)null!=a&&(t+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,n=n||a.estimated,++s);return n?new a.VT(s,{verticesPerFeature:t,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new a.ti(s,{verticesPerFeature:t,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function p(e){const t=d(e);return t.numComplexities>0&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities),t}const f={};function m(e,t){const i=g(e,t),o=(0,l.eU)(t)?2:0;switch(t.type){case"extrude":return new a.eH({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:o,memory:i});case"fill":if("mesh-3d"===e.type)return new a.eH({drawCallsPerFeature:o,memory:i});if(null!=t.outline&&t.outline.size>0)return new a.eH({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new a.eH({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new a.eH({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return t.resource?.href?new a.Y6({verticesPerFeature:100,memory:i}):{...y(t.resource?.primitive??n.S),memory:i};case"path":{let e=0,n=0;switch(t.profile){case"circle":e=s.JK;break;case"quad":e=4;break;default:return void(0,r.Bg)(t.profile)}switch(t.join){case"round":n=s.t7;break;case"miter":case"bevel":n=1;break;default:return}const o=2*e,l=e*n*2,c=l+o;let u=-2*l-o;switch(t.cap){case"none":break;case"butt":case"square":u+=2*(e-1);break;case"round":u+=2*(e*(s.wg-1)*2+e);break;default:return}return new a.eH({verticesPerFeature:u,verticesPerCoordinate:c,memory:i})}case"text":case"icon":return new a.eH({verticesPerFeature:6,memory:i});default:return}}function g(e,t){const i="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?v.EXTRUDE_EDGES:v.EXTRUDE;case"fill":return null!=t.outline&&t.outline.size>0?v.FILL_OUTLINE:v.FILL;case"water":return v.FILL;case"line":return"round"===t.join?v.LINE_ROUND:v.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return v.PATH_ROUND_CIRCLE;case"quad":return v.PATH_ROUND_QUAD;default:return void(0,r.Bg)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return v.PATH_MITER_CIRCLE;case"quad":return v.PATH_MITER_QUAD;default:return void(0,r.Bg)(t.profile)}default:return}case"object":return i?v.OBJECT_POINT:v.OBJECT_POLYGON;case"icon":case"text":return i?v.ICON_POINT:v.ICON_POLYGON;default:return}}function y(e){const t=f[e];if(t)return t;const i=_((0,o.t)(e,new c.Gp({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})).levels);return f[e]=new a.eH({verticesPerFeature:i}),f[e]}function _(e){return e.reduce(((e,t,i)=>e+t.numVertices*(1/10**i)),0)/e.reduce(((e,t,i)=>e+1/10**i),0)}const v={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}}},63669:(e,t,i)=>{i.d(t,{B5:()=>y,GC:()=>m,Lm:()=>b,Xf:()=>g,bD:()=>_,lO:()=>r,qZ:()=>p,rR:()=>d,ub:()=>v,w7:()=>f});var r,n=i(32114),s=i(3308),o=i(81095),a=i(7845),l=i(22349),c=i(94486),u=i(66143),h=i(21414);function d(e,t,i,r,n,s,o,a,c,u,h){const d=w[h.mode];let p,f,m=0;if((0,l.projectBuffer)(e,t,i,r,c.spatialReference,n,a))return d?.requiresAlignment(h)?(m=d.applyElevationAlignmentBuffer(r,n,s,o,a,c,u,h),p=s,f=o):(p=r,f=n),(0,l.projectBuffer)(p,c.spatialReference,f,s,u.spatialReference,o,a)?m:void 0}function p(e,t,i,r,n){const s=((0,c.f)(e)?e.z:(0,u.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const i=(0,u.KO)(t,e,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=i,void(n.z=i)}case"relative-to-ground":{const o=(0,u.KO)(t,e,"ground")??0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=(0,u.KO)(t,e,"scene")??0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(s,r),a=(0,u.KO)(t,e,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function f(e,t,i,r){return p(e,t,i,r,T),T.z}function m(e,t,i){return"on-the-ground"===t&&"on-the-ground"===i?e.staysOnTheGround:t===i||"on-the-ground"!==t&&"on-the-ground"!==i?null==t||null==i?e.definedChanged:r.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function y(e){return"absolute-height"!==e}function _(e,t,i,r,s){p(t,i,s,r,T),v(e,T.verticalDistanceToGround);const o=T.sampledElevation,l=(0,n.JG)(x,e.transformation);return C[0]=t.x,C[1]=t.y,C[2]=T.z,(0,a.B)(t.spatialReference,C,l,r.spatialReference)?e.transformation=l:console.warn("Could not locate symbol object properly, it might be misplaced"),o}function v(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(h.T.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[i],h.T.CENTEROFFSETANDDISTANCE))}}class b{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(r||(r={}));const w={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,i,r,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let s=0;s<n;++s){const n=e[t],s=e[t+1],o=e[t+2];i[r]=n,i[r+1]=s,i[r+2]=null==c?o+l:l,t+=3,r+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,n,s){let o=0;const a=s.spatialReference;t*=3,r*=3;for(let l=0;l<n;++l){const n=e[t],l=e[t+1],c=e[t+2],u=s.getElevation(n,l,c,a,"ground")??0;o+=u,i[r]=n,i[r+1]=l,i[r+2]=u,t+=3,r+=3}return o/n},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;t*=3,r*=3;for(let o=0;o<n;++o){const n=e[t],o=e[t+1],a=e[t+2],d=s.getElevation(n,o,a,h,"ground")??0;l+=d,i[r]=n,i[r+1]=o,i[r+2]=null==u?a+d+c:d+c,t+=3,r+=3}return l/n},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;t*=3,r*=3;for(let o=0;o<n;++o){const n=e[t],o=e[t+1],a=e[t+2],d=s.getElevation(n,o,a,h,"scene")??0;l+=d,i[r]=n,i[r+1]=o,i[r+2]=null==u?a+d+c:d+c,t+=3,r+=3}return l/n},requiresAlignment:()=>!0}},x=(0,s.Ue)(),T=new b,C=(0,o.Ue)()},12391:(e,t,i)=>{var r,n;i.d(t,{E:()=>n,P:()=>r}),function(e){e[e.USER=1]="USER",e[e.SCALE_RANGE=2]="SCALE_RANGE",e[e.FILTER=4]="FILTER",e[e.DECONFLICTION=8]="DECONFLICTION",e[e.ALL_GRAPHIC=15]="ALL_GRAPHIC",e[e.ALL_LABEL=255]="ALL_LABEL"}(r||(r={})),function(e){e[e.GRAPHIC=1]="GRAPHIC",e[e.LABEL=16]="LABEL"}(n||(n={}))},64487:(e,t,i)=>{i.d(t,{O$:()=>f,Tz:()=>u,WI:()=>p,aO:()=>h,bw:()=>l,d9:()=>a,ht:()=>d,kr:()=>c});var r=i(13802),n=i(78668),s=i(45043),o=i(30879);function a(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function l(e){const t=e?.expression;if("string"==typeof t){const e=g(t);if(null!=e)return{cachedResult:e}}return null}async function c(e,t,i,r){const s=e?.expression;if("string"!=typeof s)return null;const a=g(s);if(null!=a)return{cachedResult:a};const l=await(0,o.LC)();(0,n.k_)(i);const c=l.arcadeUtils,u=c.createSyntaxTree(s);return c.dependsOnView(u)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:l}}}function u(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function h(e,t){if(null!=e&&!m(e)){if(!t||!e.arcade)return void r.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils").errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=(0,s.kB)(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function d(e){if(null!=e){if(m(e))return e.cachedResult;const t=e.arcade;let i=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}function p(e,t=!1){let i=e?.featureExpressionInfo;const r=i?.expression;return t||"0"===r||(i=null),i??null}const f={cachedResult:0};function m(e){return null!=e.cachedResult}function g(e){return"0"===e?0:null}},14923:(e,t,i)=>{i.d(t,{$o:()=>T,Go:()=>w,Si:()=>A,Uu:()=>x,WR:()=>b,ZL:()=>E,_Z:()=>M,bD:()=>C,bh:()=>S,zE:()=>y});var r=i(17321),n=i(32114),s=i(3308),o=i(81095),a=i(56999),l=i(52721),c=i(90472),u=i(37116),h=i(24568),d=i(18449),p=i(38028),f=i(50442),m=i(98196),g=i(45043);function y(e,t){if("point"===e.type)return v(e,t,!1);if((0,g.Ou)(e))switch(e.type){case"extent":return v(e.center,t,!1);case"polygon":return v(e.centroid,t,!1);case"polyline":return v(_(e),t,!0);case"mesh":return v((0,f.rU)(e.vertexSpace,e.spatialReference)??e.extent.center,t,!1);case"multipoint":return}else switch(e.type){case"extent":return v(function(e){return(0,m.T)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return v(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=(0,d.a)(e.rings,!!e.hasZ);return(0,m.T)(i[0],i[1],i[2],e.spatialReference)}(e),t,!0);case"polyline":return v(_(e),t,!0);case"multipoint":return}}function _(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=(0,p.n8)(t,(0,p.ok)(t)/2);return(0,m.T)(i[0],i[1],i[2],e.spatialReference)}function v(e,t,i){const r=i?e:(0,g.WG)(e);return t&&e?(0,c.projectPoint)(e,r,t)?r:null:r}function b(e){if(!e)return 0;switch(e.type){case"point":return e.z;case"extent":return e.zmax;case"polygon":return e.hasZ?e.rings.reduce(((e,t)=>t.reduce(((e,t)=>Math.max(e,t[2])),e)),-1/0):void 0;case"polyline":return e.hasZ?e.paths.reduce(((e,t)=>t.reduce(((e,t)=>Math.max(e,t[2])),e)),-1/0):void 0;case"mesh":return e.extent.zmax;case"multipoint":return}}function w(e,t,i,r=0){if(e){t||(t=(0,h.Ue)());const n=e;let s=.5*n.width*(i-1),o=.5*n.height*(i-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),(0,a.s)(t,n.xmin-s-r,n.ymin-o-r,n.xmax+s+r,n.ymax+o+r),t}return null}function x(e,t,i=null){const r=(0,l.d9)(l.hq);return null!=e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),null!=t?r[3]=t:null!=e&&e.length>3&&(r[3]=e[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function T(e,t,i,r,n,s){for(let t=0;t<3;++t)s[t]=null!=e?.[t]?e[t]:null!=i?.[t]?i[t]:n[t];return s[3]=null!=t?t:null!=r?r:n[3],s}function C(e=o.hq,t,i,r=1){const n=new Array(3);if(null==t||null==i)n[0]=1,n[1]=1,n[2]=1;else{let r,s=0;for(let o=2;o>=0;o--){const a=e[o],l=null!=a,c=0===o&&!r&&!l,u=i[o];let h;"symbol-value"===a||c?h=0!==u?t[o]/u:1:l&&"proportional"!==a&&isFinite(a)&&(h=0!==u?a/u:1),null!=h&&(n[o]=h,r=h,s=Math.max(s,Math.abs(h)))}for(let e=2;e>=0;e--)null==n[e]?n[e]=r:0===n[e]&&(n[e]=.001*s)}for(let e=2;e>=0;e--)n[e]/=r;return(0,o.nI)(n)}function S(e){return E(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function E(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}function M(e,t,i,r=(0,s.Ue)()){return e&&(0,n.jI)(r,r,-e/180*Math.PI),t&&(0,n.lM)(r,r,t/180*Math.PI),i&&(0,n.uD)(r,r,i/180*Math.PI),r}function A(e,t,i){if(null!=i.minDemResolution)return i.minDemResolution;const n=(0,r.c9)(t),s=(0,u.bf)(e)*n,o=(0,u.Ye)(e)*n,a=(0,u.Cb)(e)*(t.isGeographic?1:n);return 0===s&&0===o&&0===a?i.minDemResolutionForPoints:.01*Math.max(s,o,a)}},4357:(e,t,i)=>{var r,n;i.d(t,{W:()=>r,X:()=>n}),function(e){e[e.RecreateSymbol=0]="RecreateSymbol",e[e.RecreateGraphics=1]="RecreateGraphics",e[e.FastUpdate=2]="FastUpdate"}(r||(r={})),function(e){e[e.Slow=0]="Slow",e[e.Fast=1]="Fast",e[e.Mixed=2]="Mixed",e[e.Loading=3]="Loading",e[e.Undefined=4]="Undefined"}(n||(n={}))},89160:(e,t,i)=>{i.d(t,{$A:()=>o,EP:()=>u,QW:()=>h,c4:()=>p,j1:()=>d,mq:()=>l,yY:()=>a,zi:()=>c});var r=i(36531),n=i(84164),s=i(90670);const o=Object.freeze({left:0,center:.5,right:1}),a=Object.freeze({"bottom-left":(0,n.al)(0,0),bottom:(0,n.al)(.5,0),"bottom-right":(0,n.al)(1,0),left:(0,n.al)(0,.5),center:(0,n.al)(.5,.5),right:(0,n.al)(1,.5),"top-left":(0,n.al)(0,1),top:(0,n.al)(.5,1),"top-right":(0,n.al)(1,1)});function l(e){switch(e){case"left":return s.vU.Left;case"right":return s.vU.Right;default:return s.vU.Center}}function c(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function u(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function h(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}}function d(e){return"middle"===e?"center":e}function p(e,t){switch(e){case"top":return(0,r.t8)(t,0,s.Wg);case"bottom":return(0,r.t8)(t,0,-1);default:return(0,r.JG)(t,n.AG)}}},63593:(e,t,i)=>{i.d(t,{Cd:()=>d,S9:()=>g,S_:()=>m,ZC:()=>h,dO:()=>f});var r=i(81095),n=i(57022),s=i(37116),o=i(38028),a=i(98196),l=i(63669),c=i(14923),u=i(49394);function h(e,t,i,r,n){if(p(e,t))return null;i.localOrigin=g(e,t);const s=new u.T({geometries:[i],castShadow:!1,layerUid:e.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:s,sampledElevation:(0,l.bD)(s,t,e.elevationProvider,e.renderCoordsHelper,r)}}function d(e,t,i,r){return p(t,i)?null:(0,l.bD)(e,i,t.elevationProvider,t.renderCoordsHelper,r)}function p(e,t){const i=e.clippingExtent;return!!i&&((0,n.K)(t,y,e.elevationProvider.spatialReference),!(0,s.BD)(i,y))}function f(e,t,i){const r=e.elevationContext,s=i.spatialReference;(0,n.K)(t,y,s),r.centerPointInElevationSR=(0,a.T)(y[0],y[1],t.hasZ?y[2]:0,null!=s?s:null)}function m(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,c.zE)(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const i=(0,o.n8)(t,(0,o.ok)(t)/2);return(0,a.T)(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.extent.center}return null}function g(e,t){return(0,n.K)(t,y,e.renderCoordsHelper.spatialReference),e.localOriginFactory.getOrigin(y)}const y=(0,r.Ue)()},9575:(e,t,i)=>{i.d(t,{JJ:()=>y,LN:()=>p,Nu:()=>g,dd:()=>m,z:()=>f});var r=i(5992),n=i(91772),s=i(89542),o=i(19546),a=i(35914),l=i(39393),c=i(85799),u=i(95399),h=i(63885),d=i(21414);function p(e,t,i){const n=(t.length>0?t[0]:e.length/3)-1,s=(0,l.i)(e,n,i);if(s!==o.R.Z){e=e.slice();for(let t=0;t<e.length;t+=3)e[t+s]=e[t+2]}return(0,r.e)(e,t,3)}function f(e){const t=[[d.T.POSITION,new c.a(e.attributeData.position,e.indices,3,!0)]],i=(0,a.LE)(e.indices.length);return null!=e.attributeData.colorFeature?t.push([d.T.COLORFEATUREATTRIBUTE,new c.a([e.attributeData.colorFeature],i,1,!0)]):e.attributeData.color&&t.push([d.T.COLOR,new c.a(e.attributeData.color,i,4,!0)]),e.attributeData.uvMapSpace&&t.push([d.T.UVMAPSPACE,new c.a(e.attributeData.uvMapSpace,e.indices,4,!0)]),e.attributeData.boundingRect&&t.push([d.T.BOUNDINGRECT,new c.a(e.attributeData.boundingRect,e.indices,9,!0)]),new h.Z(e.material,t,e.mapPositions,u.U.Mesh,e.attributeData.objectAndLayerIdColor)}function m(e,t=null){const i=[[d.T.POSITION,new c.a(e.attributeData.position,e.indices,3,!0)],[d.T.UV0,new c.a(e.attributeData.uv0,e.indices,2,!0)]];return new h.Z(e.material,i,e.mapPositions,u.U.Mesh,t)}function g(e){switch(e.type){case"extent":if(e instanceof n.Z)return s.Z.fromExtent(e);break;case"polygon":return e}return null}class y{constructor(e,t,i){this.renderData=e,this.layerUid=t,this.graphicUid=i,this.outGeometries=new Array}}},60910:(e,t,i)=>{i.d(t,{F:()=>s,t:()=>o});i(39994);var r=i(6087),n=i(3248);function s(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function o(e,t){const i=(e,t,i=!1)=>new n.hO(e.map((e=>{const s=t(e.tesselation);return i&&(0,r.Cr)(s),new n.T6([new n.QD(new n.pT(s))],e.minScreenSpaceRadius)})));switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(e=>(0,r.mj)(t,.5,e,!0)));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,r.IG)(t,1)));case"cone":return i(a,(e=>(0,r.QL)(t,1,.5,e,!1)),!0);case"inverted-cone":return i(a,(e=>(0,r.QL)(t,1,.5,e,!0)),!0);case"cylinder":return i(a,(e=>(0,r.nb)(t,1,.5,e,[0,0,1],[0,0,.5])));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,r.AW)(t,1)),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,r.B2)(t,1)),!0);default:return}}const a=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},2011:(e,t,i)=>{i.d(t,{n:()=>r});function r(e){return 2216+4096*e.symbolLayers.length+e.complexity.memory.resourceBytes}},1305:(e,t,i)=>{i.d(t,{p2:()=>M,zD:()=>C});var r=i(66341),n=i(67979),s=i(70375),o=i(13802),a=i(99235),l=i(22445),c=i(78668),u=i(26139),h=i(81095),d=i(37116),p=i(35914),f=i(44883),m=i(85799),g=i(70984),y=i(63885),_=i(44101),v=i(21414),b=i(46151),w=i(91907);const x=()=>o.Z.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");class T{constructor(e,t,i){this.resource=e,this.textures=t,this.cachedMemory=i}}async function C(e,t){const i=await async function(e,t){const i=t?.streamDataRequester;if(i)return async function(e,t,i){const r=await(0,n.q6)(t.request(e,"json",i));if(!0===r.ok)return r.value;(0,c.r9)(r.error),S(r.error.details.url)}(e,i,t);const s=await(0,n.q6)((0,r.Z)(e,t));if(!0===s.ok)return s.value.data;(0,c.r9)(s.error),S(s.error)}(e,t),s=await async function(e,t){const i=new Array;for(const r in e){const n=e[r],s=n.images[0].data;if(!s){x().warn("Externally referenced texture data is not yet supported");continue}const o=n.encoding+";base64,"+s,a="/textureDefinitions/"+r,l="rgba"===n.channels?n.alphaChannelUsage||"transparency":"none",c={noUnpackFlip:!0,wrap:{s:w.e8.REPEAT,t:w.e8.REPEAT},preMultiplyAlpha:R(l)!==g.JJ.Opaque},u=t?.disableTextures?Promise.resolve(null):(0,f.t)(o,t);i.push(u.then((e=>({refId:a,image:e,parameters:c,alphaChannelUsage:l}))))}const r=await Promise.all(i),n={};for(const e of r)n[e.refId]=e;return n}(i.textureDefinitions??{},t);let o=0;for(const e in s)if(s.hasOwnProperty(e)){const t=s[e];o+=t?.image?t.image.width*t.image.height*4:0}return new T(i,s,o+(0,a.kk)(i))}function S(e){throw new s.Z("",`Request for object resource failed: ${e}`)}function E(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(x().warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const i in t.vertexAttributes){const t=e[i];t?.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(x().warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),r=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(x().warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),r=!1)):(x().warn(`Indexed geometry does not specify face indices for '${i}' attribute`),r=!1)}}else x().warn("Indexed geometries must specify faces"),r=!1;break}default:x().warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(x().warn("Geometry requires material"),r=!1);const n=e.params.vertexAttributes;for(const e in n)n[e].values||(x().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function M(e,t){const i=new Array,r=new Array,n=new Array,s=new l.r,o=e.resource,a=u.G.parse(o.version||"1.0","wosr");P.validate(a);const c=o.model.name,d=o.model.geometries,f=o.materialDefinitions??{},w=e.textures;let x=0;const T=new Map;for(let e=0;e<d.length;e++){const o=d[e];if(!E(o))continue;const a=O(o),l=o.params.vertexAttributes,c=[],u=e=>{if("PerAttributeArray"===o.params.topology)return null;const t=o.params.faces;for(const i in t)if(i===e)return t[i].values;return null},C=l[v.T.POSITION],S=C.values.length/C.valuesPerElement;for(const e in l){const t=l[e],i=t.values,r=u(e)??(0,p.KF)(S);c.push([e,new m.a(i,r,t.valuesPerElement,!0)])}const M=a.texture,A=w&&w[M];if(A&&!T.has(M)){const{image:e,parameters:t}=A,i=new _.x(e,t);r.push(i),T.set(M,i)}const P=T.get(M),I=P?P.id:void 0,L=a.material;let D=s.get(L,M);if(null==D){const e=f[L.slice(L.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const i=A&&A.alphaChannelUsage,r=e.transparency>0||"transparency"===i||"maskAndTransparency"===i,n=A?R(A.alphaChannelUsage):void 0,o={ambient:(0,h.nI)(e.diffuse),diffuse:(0,h.nI)(e.diffuse),opacity:1-(e.transparency||0),transparent:r,textureAlphaMode:n,textureAlphaCutoff:.33,textureId:I,doubleSided:!0,cullFace:g.Vr.None,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:A?.parameters.preMultiplyAlpha??!1};t?.materialParameters&&Object.assign(o,t.materialParameters),D=new b.Gp(o,t),s.set(L,M,D)}n.push(D);const N=new y.Z(D,c);x+=c.find((e=>e[0]===v.T.POSITION))?.[1]?.indices.length??0,i.push(N)}return{engineResources:[{name:c,stageResources:{textures:r,materials:n,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:x,lodThreshold:null}],referenceBoundingBox:A(i)}}function A(e){const t=(0,d.cS)();return e.forEach((e=>{const i=e.boundingInfo;null!=i&&((0,d.pp)(t,i.bbMin),(0,d.pp)(t,i.bbMax))})),t}function R(e){switch(e){case"mask":return g.JJ.Mask;case"maskAndTransparency":return g.JJ.MaskBlend;case"none":return g.JJ.Opaque;default:return g.JJ.Blend}}function O(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const P=new u.G(1,2,"wosr")},9512:(e,t,i)=>{i.d(t,{Es:()=>g,I_:()=>d,W7:()=>m,qM:()=>_});var r=i(70375),n=i(67134),s=i(13802),o=i(52485),a=i(21414);const l=()=>s.Z.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function c(e,t,i){let n="",s=0;for(;s<i;){const o=e[t+s];if(o<128)n+=String.fromCharCode(o),s++;else if(o>=192&&o<224){if(s+1>=i)throw new r.Z("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const a=(31&o)<<6|63&e[t+s+1];n+=String.fromCharCode(a),s+=2}else if(o>=224&&o<240){if(s+2>=i)throw new r.Z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const a=(15&o)<<12|(63&e[t+s+1])<<6|63&e[t+s+2];n+=String.fromCharCode(a),s+=3}else{if(!(o>=240&&o<248))throw new r.Z("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=i)throw new r.Z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const a=(7&o)<<18|(63&e[t+s+1])<<12|(63&e[t+s+2])<<6|63&e[t+s+3];if(a>=65536){const e=55296+(a-65536>>10),t=56320+(1023&a);n+=String.fromCharCode(e,t)}else n+=String.fromCharCode(a);s+=4}}}return n}function u(e,t){const i={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let n=0;n<t.length;n++){const s=t[n],o=s.valueType||s.type,a=b[o];i.fields[s.property]=a(e,r),r+=v[o].BYTES_PER_ELEMENT}return i.byteCount=r,i}function h(e,t,i){const n=[];let s,o,a=0;for(o=0;o<e;o+=1){if(s=t[o],s>0){if(n.push(c(i,a,s-1)),0!==i[a+s-1])throw new r.Z("string-array-error","Invalid string array: missing null termination.")}else n.push(null);a+=s}return n}function d(e,t){return new(0,v[t.valueType])(e,t.byteOffset,t.count*t.valuesPerElement)}function p(e,t,i){const s=null!=t.header?u(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},o={header:s,byteOffset:s.byteCount,byteCount:0,entries:Object.create(null)};let a=s.byteCount;for(let e=0;e<t.ordering.length;e++){const i=t.ordering[e],l=(0,n.d9)(t[i]);if(l.count=s.fields.count??0,"String"===l.valueType){if(l.byteOffset=a,l.byteCount=s.fields[i+"ByteCount"],"UTF-8"!==l.encoding)throw new r.Z("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding});if(l.timeEncoding&&"ECMA_ISO8601"!==l.timeEncoding)throw new r.Z("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:l.timeEncoding})}else{if(!w(l.valueType))throw new r.Z("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const e=x(l.valueType);a+=a%e!=0?e-a%e:0,l.byteOffset=a,l.byteCount=e*l.valuesPerElement*l.count}}a+=l.byteCount??0,o.entries[i]=l}return o.byteCount=a-o.byteOffset,o}function f(e,t,i){if(t!==e&&l().error(`Invalid ${i} buffer size\n expected: ${e}, actual: ${t})`),t<e)throw new r.Z("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function m(e,t){const i=u(e,t&&t.header);let r=i.byteCount;const n={isDraco:!1,header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:{}},s=i.fields,o=null!=s.vertexCount?s.vertexCount:s.count;for(const e of t.ordering){if(!t.vertexAttributes[e])continue;const i={...t.vertexAttributes[e],byteOffset:r,count:o},s=y[e]||"_"+e;n.vertexAttributes[s]=i,r+=x(i.valueType)*i.valuesPerElement*o}const a=s.faceCount;if(t.faces&&a){n.faces={};for(const e of t.ordering){if(!t.faces[e])continue;const i={...t.faces[e],byteOffset:r,count:a};n.faces[e]=i,r+=x(i.valueType)*i.valuesPerElement*a}}const l=s.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){n.featureAttributes={};for(const e of t.featureAttributeOrder){if(!t.featureAttributes[e])continue;const i={...t.featureAttributes[e],byteOffset:r,count:l};n.featureAttributes[e]=i,r+=("UInt64"===i.valueType?8:x(i.valueType))*i.valuesPerElement*l}}return f(r,e.byteLength,"geometry"),n.byteCount=r-n.byteOffset,n}function g(e,t){return e&&e.compressedAttributes&&"draco"===e.compressedAttributes.encoding?function(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e)switch(i){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}(e.compressedAttributes.attributes):e?function(e){return{isDraco:!1,isLegacy:!1,color:null!=e.color,normal:null!=e.normal,uv0:null!=e.uv0,uvRegion:null!=e.uvRegion,featureIndex:null!=e.faceRange&&null!=e.featureId}}(e):function(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e.ordering)if(e.vertexAttributes[i])switch(i){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}(t)}const y={position:a.T.POSITION,normal:a.T.NORMAL,color:a.T.COLOR,uv0:a.T.UV0,region:a.T.UVREGION};function _(e,t,i){if("lepcc-rgb"===e.encoding)return(0,o.IT)(t);if("lepcc-intensity"===e.encoding)return(0,o.ti)(t);if(null!=e.encoding&&""!==e.encoding)throw new r.Z("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(l().warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(l().warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const n=p(t,e,i);f(n.byteOffset+n.byteCount,t.byteLength,"attribute");const s=n.entries.attributeValues||n.entries.objectIds;if(s){if("String"===s.valueType){const e=n.entries.attributeByteCounts,i=d(t,e),r=function(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}(t,s);return s.timeEncoding?function(e,t,i){return h(e,t,i).map((e=>{const t=e?Date.parse(e):null;return null==t||Number.isNaN(t)?null:t}))}(e.count,i,r):h(e.count,i,r)}return d(t,s)}throw new r.Z("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const v={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},b={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function w(e){return v.hasOwnProperty(e)}function x(e){return w(e)?v[e].BYTES_PER_ELEMENT:0}},49979:(e,t,i)=>{i.d(t,{c:()=>a});var r=i(3308),n=i(81095),s=i(69442),o=i(7845);function a(e,t,i,s,a){const c="east-north-up"===i?(0,n.d9)(e):l(e,t,s),u=(0,r.Ue)();return(0,o.B)(s,c,u,a),u}function l(e,t,i){const r=(0,n.Ue)(),o=e[3],a=2**(4*Math.ceil(Math.log(o)*Math.LOG2E/4)+1);if(i.isGeographic){const t=a/(0,s.Iu)(i).radius*180/Math.PI,n=Math.round(e[1]/t),o=Math.max(-90,Math.min(90,n*t)),l=t/Math.cos((Math.abs(o)-t/2)/180*Math.PI),c=Math.round(e[0]/l)*l;r[0]=c,r[1]=o}else{const t=Math.round(e[0]/a),i=Math.round(e[1]/a);r[0]=t*a,r[1]=i*a}const l=e[2]+t,c=Math.round(l/a);return r[2]=c*a,r}},78565:(e,t,i)=>{i.d(t,{Cx:()=>Q,HV:()=>K,Jf:()=>B,Jx:()=>U,OJ:()=>H,T2:()=>z,WD:()=>te,X5:()=>S,Yb:()=>A,a7:()=>$,bf:()=>D,c$:()=>ee,cr:()=>I,e8:()=>L,gn:()=>j,hv:()=>M,ix:()=>X,ns:()=>R,p8:()=>G,pD:()=>P,tS:()=>E,tp:()=>k,tq:()=>V,uC:()=>Y,xe:()=>F,yS:()=>q,zW:()=>Z});var r=i(66341),n=i(7753),s=i(70375),o=i(39994),a=i(86098),l=i(32114),c=i(3308),u=i(86717),h=i(81095),d=i(90472),p=i(14685),f=i(49757),m=i(24568),g=i(73687),y=i(14626),_=i(9512),v=i(49979),b=i(57180),w=i(66352),x=i(47850),T=i(42780);function C(e){return e?parseInt(e.slice(e.lastIndexOf("/")+1),10):void 0}function S(e){if((0,o.Z)("disable-feature:i3s-draco")||!e)return!1;for(const t of e)for(const e of t.geometryBuffers)if("draco"===e.compressedAttributes?.encoding)return!0;return!1}function E(e,t,i,r){i.traverse(t,(t=>{const i=t.serviceMbsInIndexSR;return(null!=i&&I(e,i))!==P.OUTSIDE&&(r(t),!0)}))}function M(e,t,i){let r=0,n=0;for(let s=0;s<t.length&&r<e.length;s++)e[r]===t[s]&&(i(s)&&(e[n]=e[r],n++),r++);e.length=n}function A(e,t,i){let r=0,s=0;for(;r<i.length;)(0,n.$A)(e,i[r])>=0===t&&(i[s]=i[r],s++),r++;i.length=s}function R(e,t){if(0===t.rotationScale[1]&&0===t.rotationScale[2]&&0===t.rotationScale[3]&&0===t.rotationScale[5]&&0===t.rotationScale[6]&&0===t.rotationScale[7])return O[0]=(e[0]-t.position[0])/t.rotationScale[0],O[1]=(e[1]-t.position[1])/t.rotationScale[4],O[2]=(e[2]-t.position[0])/t.rotationScale[0],O[3]=(e[3]-t.position[1])/t.rotationScale[4],O}const O=(0,m.Ue)();var P;function I(e,t){const i=t[0],r=t[1],n=t[3],s=e[0]-i,o=i-e[2],a=e[1]-r,l=r-e[3],c=Math.max(s,o,0),u=Math.max(a,l,0),h=c*c+u*u;return h>n*n?P.OUTSIDE:h>0?P.INTERSECTS_CENTER_OUTSIDE:-Math.max(s,o,a,l)>n?P.INSIDE:P.INTERSECTS_CENTER_INSIDE}function L(e,t,i){const r=[],n=i?.missingFields,s=i?.originalFields;for(const i of e){const e=i.toLowerCase();let o=!1;for(const n of t)if(e===n.name.toLowerCase()){r.push(n.name),o=!0,s&&s.push(i);break}!o&&n&&n.push(i)}return r}async function D(e,t,i,r,n,o){if(0===t.length)return[];const a=e.attributeStorageInfo;if(null!=e.associatedLayer)try{return await async function(e,t,i,r,n){t.sort(((e,t)=>e.attributes[i]-t.attributes[i]));const s=t.map((e=>e.attributes[i])),o=[],a=L(r,e.fields,{originalFields:o}),l=await N(e,s,a,n);for(let e=0;e<t.length;e++){const i=t[e],r=l[e],n={};if(i.attributes)for(const e in i.attributes)n[e]=i.attributes[e];for(let e=0;e<o.length;e++)n[o[e]]=r[a[e]];i.attributes=n}return t}(e.associatedLayer,t,i,r,o)}catch(t){if(e.associatedLayer.loaded)throw t}if(a){const l=function(e,t,i){const r=new Map,n=[],s=i();for(const i of e){const e=i.attributes[t];for(let t=0;t<s.length;t++){const o=s[t],a=o.featureIds.indexOf(e);if(a>=0){let e=r.get(o.node);e||(e={node:o.node,indices:[],graphics:[]},n.push(e),r.set(o.node,e)),e.indices.push(a),e.graphics.push(i);for(let e=t;e>0;e--)s[e]=s[e-1];s[0]=o;break}}}return n}(t,i,n);if(null==l)throw new s.Z("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const c=e.parsedUrl.path;return(await Promise.all(l.map((t=>function(e,t,i,r,n,s,o,a){return F(e,t,i.resources.attributes,r,n,s,o,a)}(c,a,t.node,t.indices,r,e.apiKey,e.customParameters,o).then((e=>{for(let i=0;i<t.graphics.length;i++){const r=t.graphics[i],n=e[i];if(r.attributes)for(const e in r.attributes)e in n||(n[e]=r.attributes[e]);r.attributes=n}return t.graphics})))))).flat()}throw new s.Z("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function N(e,t,i,r){const o=e.capabilities.query.maxRecordCount;if(null!=o&&t.length>o){const s=(0,n.vr)(t,o);return Promise.all(s.map((t=>N(e,t,i,r)))).then((e=>e.flat()))}const a=new y.Z({objectIds:t,outFields:i,orderByFields:[e.objectIdField]});return e.queryFeatures(a,r).then((e=>{if(e&&e.features&&e.features.length===t.length)return e.features.map((e=>e.attributes));throw new s.Z("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")}))}async function F(e,t,i,n,s,o,a,l){const c=[];for(const r of t)if(r&&s.includes(r.name)){const t=`${e}/nodes/${i}/attributes/${r.key}/0`;c.push({url:t,storageInfo:r})}const u=await Promise.allSettled(c.map((e=>(0,r.Z)(e.url,{responseType:"array-buffer",query:{...a,token:o},signal:l?.signal}).then((t=>(0,_.qM)(e.storageInfo,t.data)))))),h=[];for(const e of n){const t={};for(let i=0;i<u.length;i++){const r=u[i];if("fulfilled"===r.status){const n=r.value;t[c[i].storageInfo.name]=U(n,e)}}h.push(t)}return h}!function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"}(P||(P={}));function U(e,t){if(!e)return null;const i=e[t];return(0,a.z3)(e)?-32768===i?null:i:(0,a.Hx)(e)?-2147483648===i?null:i:i!=i?null:i}function k(e){const t=e.store,i=t.indexCRS||t.geographicCRS,r=void 0===i?t.indexWKT:void 0;if(r){if(!e.spatialReference)throw new s.Z("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indexWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new s.Z("layerview:store-spatial-reference-wkt-index-incompatible","The indexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=i?new p.Z(C(i)):e.spatialReference;return n.equals(e.spatialReference)?e.spatialReference:n}function z(e){const t=e.store,i=t.vertexCRS||t.projectedCRS,r=void 0===i?t.vertexWKT:void 0;if(r){if(!e.spatialReference)throw new s.Z("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new s.Z("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=i?new p.Z(C(i)):e.spatialReference;return n.equals(e.spatialReference)?e.spatialReference:n}function B(e,t,i){if(!(0,d.canProjectWithoutEngine)(e,t))throw(0,T.lE)("scene layer",e?.wkid,t?.wkid);if("local"===i&&!function(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}(e,t))throw(0,T.lE)("scene layer",e?.wkid,t?.wkid)}function V(e,t,i){if(e.serviceUpdateTimeStamp?.lastUpdate!==t.serviceUpdateTimeStamp?.lastUpdate||!i.isEmpty||e.associatedLayer?.url!==t.associatedLayer?.url)throw new s.Z("layerview:recycle-failed")}function H(e,t,i){const r=k(e),n=z(e);B(r,t,i),B(n,t,i)}function G(e){if(null==e.store?.defaultGeometrySchema||!function(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes?.position)}(e.store.defaultGeometrySchema))throw new s.Z("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function j(e,t){H(e,t.spatialReference,t.viewingMode)}function Z(e){if(null==e.store?.defaultGeometrySchema||!function(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes?.position)}(e.store.defaultGeometrySchema))throw new s.Z("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function q(e,t){B(e.spatialReference,t.spatialReference,t.viewingMode)}function W(e){return"mesh-3d"===e.type}function $(e){if(null==e||!function(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;const t=e.symbols;if(0===t.length)return!0;for(const e of t){if(!W(e)||0===e.symbolLayers.length)return!0;for(const t of e.symbolLayers.items)if("fill"!==t.type||null==t.material?.color||"replace"!==t.material.colorMixMode)return!0}return!1}const Y=(0,b.$s)({color:[0,0,0,0],opacity:0});class J{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function X(e){const t=new J;let i=!1,r=!1;for(const n of e.symbolLayers.items)if("fill"===n.type&&n.enabled){const e=n.material,s=n.edges;if(null!=e&&!i){const r=e.color,s=(0,w.F5)(e.colorMixMode);t.material=null!=r?{color:[r.r/255,r.g/255,r.b/255],alpha:r.a,colorMixMode:s}:{color:[1,1,1],alpha:1,colorMixMode:w.a9.Multiply},t.castShadows=n.castShadows,i=!0}null==s||r||(t.edgeMaterial=(0,b.C8)(s,{}),r=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:w.a9.Multiply}),t}function K(e,t){return(0|e)+(0|t)|0}function Q(e,t,i,r,n,s,o){if(!s||0===s.length||null==t||!e.serviceMbsInIndexSR)return null;const a=(0,v.c)(e.serviceMbsInIndexSR,n,"none",i,t);(0,l.U_)(le,a);let c=null;const h=()=>{if(!c)if(c=ie,(0,m.cS)(ne),null!=e.serviceObbInIndexSR){e.serviceObbInIndexSR.transform(se,i,t,n,o),se.getCorners(c);for(const e of c)(0,u.t)(e,e,le),(0,m.Ho)(ne,e)}else{const r=e.serviceMbsInIndexSR;if(!r)return;const s=r[3];(0,f.S)((0,g.a)(r),i,oe,t),(0,u.t)(oe,oe,le),oe[2]+=n;for(let e=0;e<8;++e){const t=1&e?s:-s,i=2&e?s:-s,r=4&e?s:-s,n=c[e];(0,u.c)(n,[oe[0]+t,oe[1]+i,oe[2]+r]),(0,m.Ho)(ne,n)}}};let d=1/0,p=-1/0;if(s.forEach((e=>(e=>{if("replace"!==e.type)return;const i=e.geometry;if(!i?.hasZ)return;(0,m.cS)(re);const n=i.spatialReference||r,s=i.rings.reduce(((e,i)=>i.reduce(((e,i)=>((0,u.i)(oe,i[0],i[1],i[2]),(0,f.S)(oe,n,oe,t),(0,u.t)(oe,oe,le),(0,m.Ho)(re,oe),Math.min(oe[2],e))),e)),1/0);h(),(0,m.kK)(ne,re)&&(d=Math.min(d,s),p=Math.max(p,s))})(e))),d===1/0)return null;const y=(e,t,i)=>{(0,u.t)(oe,i,a),e[t]=oe[0],e[t+1]=oe[1],e[t+2]=oe[2],t+=24,i[2]=d,(0,u.t)(oe,i,a),e[t]=oe[0],e[t+1]=oe[1],e[t+2]=oe[2],t+=24,i[2]=p,(0,u.t)(oe,i,a),e[t]=oe[0],e[t+1]=oe[1],e[t+2]=oe[2]};for(let e=0;e<8;++e)y(ae.data,3*e,c[e]);return(0,x.Qb)(ae)}function ee(e){return e[3]>=0}function te(e){null!=e&&(e[3]=-1)}const ie=[(0,h.Ue)(),(0,h.Ue)(),(0,h.Ue)(),(0,h.Ue)(),(0,h.Ue)(),(0,h.Ue)(),(0,h.Ue)(),(0,h.Ue)()],re=(0,m.Ue)(),ne=(0,m.Ue)(),se=new x.Oo,oe=(0,h.Ue)(),ae={data:new Array(72),size:3,exclusive:!0,stride:3},le=(0,c.Ue)()},94576:(e,t,i)=>{i.d(t,{A8:()=>d,AK:()=>o,BF:()=>p,DI:()=>c,GS:()=>h,a8:()=>a,f9:()=>l,lt:()=>u});var r=i(20757),n=i(10774),s=i(66218);class o extends n.Dx{constructor(e,t,i,r){super(t,i),this.point=e,this.createGraphic=r}}function a(e){return(0,s.nn)(e)&&e.intersector===r.q7.PCL&&!!e.target}class l extends n.Zh{constructor(e,t,i,r,n){super(e),this.layerUid=e,this.sublayerUid=t,this.nodeIndex=i,this.componentIndex=r,this.triangleNr=n}}class c extends n.Dx{constructor(e,t,i){super(t,null),this.point=e,this.createVoxelGraphic=i}}class u extends n.Dx{constructor(e,t){super(e,null),this.createTiles3DGraphic=t}}function h(e){return(0,s.nn)(e)&&e.intersector===r.q7.I3S&&!!e.target}function d(e){return(0,s.nn)(e)&&e.intersector===r.q7.VOXEL&&!!e.target}function p(e){return(0,s.nn)(e)&&e.intersector===r.q7.TILES3D&&!!e.target}},52485:(e,t,i)=>{i.d(t,{Gi:()=>E,IT:()=>U,ti:()=>q});var r=i(70375);const n=!0,s=0,o=10,a=10,l=12,c=16;function u(e,t,i){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,i+s,o)),version:t.getUint16(i+a,n),checksum:t.getUint32(i+l,n)}}const h=0,d=4,p=8,f=16,m=24,g=32,y=40,_=48,v=56,b=64,w=72,x=80,T=84,C=88;function S(e,t){return{sizeLo:e.getUint32(t+h,n),sizeHi:e.getUint32(t+d,n),minX:e.getFloat64(t+p,n),minY:e.getFloat64(t+f,n),minZ:e.getFloat64(t+m,n),maxX:e.getFloat64(t+g,n),maxY:e.getFloat64(t+y,n),maxZ:e.getFloat64(t+_,n),errorX:e.getFloat64(t+v,n),errorY:e.getFloat64(t+b,n),errorZ:e.getFloat64(t+w,n),count:e.getUint32(t+x,n),reserved:e.getUint32(t+T,n)}}function E(e){const t=new DataView(e,0);let i=0;const{identifier:n,version:s}=u(e,t,i);if(i+=c,"LEPCC     "!==n)throw new r.Z("lepcc-decode-error","Bad identifier");if(s>1)throw new r.Z("lepcc-decode-error","Unknown version");const o=S(t,i);if(i+=C,o.sizeHi*2**32+o.sizeLo!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");const a=new Float64Array(3*o.count),l=[],h=[],d=[],p=[];if(i=M(e,i,l),i=M(e,i,h),i=M(e,i,d),i=M(e,i,p),i!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad length");let f=0,m=0;for(let e=0;e<l.length;e++){m+=l[e];let t=0;for(let i=0;i<h[e];i++){t+=d[f];const e=p[f];a[3*f]=Math.min(o.maxX,o.minX+2*o.errorX*t),a[3*f+1]=Math.min(o.maxY,o.minY+2*o.errorY*m),a[3*f+2]=Math.min(o.maxZ,o.minZ+2*o.errorZ*e),f++}}return{errorX:o.errorX,errorY:o.errorY,errorZ:o.errorZ,result:a}}function M(e,t,i){const r=[];t=A(e,t,r);const n=[];for(let s=0;s<r.length;s++){n.length=0,t=A(e,t,n);for(let e=0;e<n.length;e++)i.push(n[e]+r[s])}return t}function A(e,t,i){const s=new DataView(e,t),o=s.getUint8(0),a=31&o,l=!!(32&o),c=(192&o)>>6;let u=0;if(0===c)u=s.getUint32(1,n),t+=5;else if(1===c)u=s.getUint16(1,n),t+=3;else{if(2!==c)throw new r.Z("lepcc-decode-error","Bad count type");u=s.getUint8(1),t+=2}if(l)throw new r.Z("lepcc-decode-error","LUT not implemented");const h=Math.ceil(u*a/8),d=new Uint8Array(e,t,h);let p=0,f=0,m=0;const g=-1>>>32-a;for(let e=0;e<u;e++){for(;f<a;)p|=d[m]<<f,f+=8,m+=1;i[e]=p&g,p>>>=a,f-=a,f+a>32&&(p|=d[m-1]>>8-f)}return t+m}const R=0,O=4,P=8,I=12,L=14,D=15,N=16;function F(e,t){return{sizeLo:e.getUint32(t+R,n),sizeHi:e.getUint32(t+O,n),count:e.getUint32(t+P,n),colorMapCount:e.getUint16(t+I,n),lookupMethod:e.getUint8(t+L),compressionMethod:e.getUint8(t+D)}}function U(e){const t=new DataView(e,0);let i=0;const{identifier:n,version:s}=u(e,t,i);if(i+=c,"ClusterRGB"!==n)throw new r.Z("lepcc-decode-error","Bad identifier");if(s>1)throw new r.Z("lepcc-decode-error","Unknown version");const o=F(t,i);if(i+=N,o.sizeHi*2**32+o.sizeLo!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");if((2===o.lookupMethod||1===o.lookupMethod)&&0===o.compressionMethod){if(3*o.colorMapCount+o.count+i!==e.byteLength||o.colorMapCount>256)throw new r.Z("lepcc-decode-error","Bad count");const t=new Uint8Array(e,i,3*o.colorMapCount),n=new Uint8Array(e,i+3*o.colorMapCount,o.count),s=new Uint8Array(3*o.count);for(let e=0;e<o.count;e++){const i=n[e];s[3*e]=t[3*i],s[3*e+1]=t[3*i+1],s[3*e+2]=t[3*i+2]}return s}if(0===o.lookupMethod&&0===o.compressionMethod){if(3*o.count+i!==e.byteLength||0!==o.colorMapCount)throw new r.Z("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(o.lookupMethod<=2&&1===o.compressionMethod){if(i+3!==e.byteLength||1!==o.colorMapCount)throw new r.Z("lepcc-decode-error","Bad count");const n=t.getUint8(i),s=t.getUint8(i+1),a=t.getUint8(i+2),l=new Uint8Array(3*o.count);for(let e=0;e<o.count;e++)l[3*e]=n,l[3*e+1]=s,l[3*e+2]=a;return l}throw new r.Z("lepcc-decode-error","Bad method "+o.lookupMethod+","+o.compressionMethod)}const k=0,z=4,B=8,V=12,H=14,G=15,j=16;function Z(e,t){return{sizeLo:e.getUint32(t+k,n),sizeHi:e.getUint32(t+z,n),count:e.getUint32(t+B,n),scaleFactor:e.getUint16(t+V,n),bitsPerPoint:e.getUint8(t+H),reserved:e.getUint8(t+G)}}function q(e){const t=new DataView(e,0);let i=0;const{identifier:n,version:s}=u(e,t,i);if(i+=c,"Intensity "!==n)throw new r.Z("lepcc-decode-error","Bad identifier");if(s>1)throw new r.Z("lepcc-decode-error","Unknown version");const o=Z(t,i);if(i+=j,o.sizeHi*2**32+o.sizeLo!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");const a=new Uint16Array(o.count);if(8===o.bitsPerPoint){if(o.count+i!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");const t=new Uint8Array(e,i,o.count);for(let e=0;e<o.count;e++)a[e]=t[e]*o.scaleFactor}else if(16===o.bitsPerPoint){if(2*o.count+i!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");const t=new Uint16Array(e,i,o.count);for(let e=0;e<o.count;e++)a[e]=t[e]*o.scaleFactor}else{const t=[];if(A(e,i,t)!==e.byteLength)throw new r.Z("lepcc-decode-error","Bad size");for(let e=0;e<o.count;e++)a[e]=t[e]*o.scaleFactor}return a}},43977:(e,t,i)=>{var r,n,s;i.d(t,{Lw:()=>r,al:()=>s,eZ:()=>n}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(n||(n={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(s||(s={}))},85132:(e,t,i)=>{i.d(t,{FE:()=>F,Tc:()=>P,Ve:()=>L,Z3:()=>M,kD:()=>U,vT:()=>O,z2:()=>N});i(39994);var r,n,s=i(19431),o=i(46332),a=i(3965),l=i(32114),c=i(3308),u=i(86717),h=i(81095),d=i(6923),p=i(32646),f=i(3289),m=i(86765);!function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"}(r||(r={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(n||(n={}));class g{constructor(e){this.field=e}}class y extends g{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[r.Undefined,r.Undefined,r.Undefined]}}class _ extends g{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}}class v extends g{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class b{}function w(e){return null!=e}function x(e,t){e&&e.push(t)}function T(e,t,i,n,s){const o=e.minSize,a=e.maxSize;if(e.useSymbolValue){const e=n.symbolSize[i];return t.minSize[i]=e,t.maxSize[i]=e,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=r.DefinedSize,!0}if(w(e.field))return w(e.stops)?2===e.stops.length&&(0,p.hj)(e.stops[0].size)&&(0,p.hj)(e.stops[1].size)?(C(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=r.DefinedSize,!0):(x(s,"Could not convert size info: stops only supported with 2 elements"),!1):(0,p.hj)(o)&&(0,p.hj)(a)&&w(e.minDataValue)&&w(e.maxDataValue)?(C(o,a,e.minDataValue,e.maxDataValue,t,i),t.type[i]=r.DefinedSize,!0):"unknown"===e.valueUnit?(x(s,"Could not convert size info: proportional size not supported"),!1):null!=d.a[e.valueUnit]?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/d.a[e.valueUnit],t.type[i]=r.DefinedSize,!0):(x(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!w(e.field)){if(e.stops?.[0]&&(0,p.hj)(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=r.DefinedSize,!0;if((0,p.hj)(o))return t.minSize[i]=o,t.maxSize[i]=o,t.offset[i]=o,t.factor[i]=0,t.type[i]=r.DefinedSize,!0}return x(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function C(e,t,i,r,n,s){const o=Math.abs(r-i)>0?(t-e)/(r-i):0;n.minSize[s]=o>0?e:t,n.maxSize[s]=o>0?t:e,n.offset[s]=e-i*o,n.factor[s]=o}function S(e,t,i){e[4*t]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function E(e,t,i){const r=2===i&&"arithmetic"===e.rotationType;t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}class M{constructor(e,t=[1,1,1],i=[1,1,1],r=1,n=[0,0,0],s=[1,1,1],o=[0,0,0]){this.supports=e,this.modelSize=t,this.symbolSize=i,this.unitInMeters=r,this.anchor=n,this.scale=s,this.rotation=o}}function A(e,t,i){if(!e)return null;const n=e.reduce(((e,r)=>{if(!e)return e;if(r.valueExpression)return x(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(r.type){case"size":return t.supports.size?function(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return x(r,"Could not convert size info: unsupported property"),null;if(!(0,p.tM)(e.field))return x(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return x(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new y(e.field);let n;switch(e.axis){case"width":return n=T(e,t.size,0,i,r),n?t:null;case"height":return n=T(e,t.size,2,i,r),n?t:null;case"depth":return n=T(e,t.size,1,i,r),n?t:null;case"width-and-depth":return n=T(e,t.size,0,i,r),n&&T(e,t.size,1,i,r),n?t:null;case null:case void 0:case"all":return n=T(e,t.size,0,i,r),n=n&&T(e,t.size,1,i,r),n=n&&T(e,t.size,2,i,r),n?t:null;default:return x(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}(r,e,t,i):e;case"color":return t.supports.color?function(e,t,i){if(e.normalizationField)return x(i,"Could not convert color info: unsupported property"),null;if((0,p.HD)(e.field)){if(!e.stops)return x(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return x(i,"Could not convert color info: too many color stops"),null;t.color=new _(e.field);const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.color.values[e]=i.value,S(t.color.colors,e,i.color)}}}else{if(!(e.stops&&e.stops.length>=0))return x(i,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,S(t.color.colors,e,i)}}return t}(r,e,i):e;case"opacity":return t.supports.opacity?function(e,t,i){if(e.normalizationField)return x(i,"Could not convert opacity info: unsupported property"),null;if((0,p.HD)(e.field)){if(!e.stops)return x(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return x(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new v(e.field);const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.opacity.values[e]=i.value,t.opacity.opacityValues[e]=i.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return x(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=i}}return t}(r,e,i):null;case"rotation":return t.supports.rotation?function(e,t,i){if(!(0,p.HD)(e.field))return x(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return x(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return E(e,t.rotation,0),t;case"roll":return E(e,t.rotation,1),t;case null:case void 0:case"heading":return E(e,t.rotation,2),t;default:return x(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(r,e,i):e;default:return null}}),new b);return!(e.length>0&&n)||n.size||n.color||n.opacity||n.rotation?n?.size&&!function(e,t,i){for(let i=0;i<3;++i){let n=t.unitInMeters;e.type[i]===r.DefinedSize&&(n*=t.modelSize[i],e.type[i]=r.DefinedScale),e.minSize[i]=e.minSize[i]/n,e.maxSize[i]=e.maxSize[i]/n,e.offset[i]=e.offset[i]/n,e.factor[i]=e.factor[i]/n}let n;if(e.type[0]!==r.Undefined)n=0;else if(e.type[1]!==r.Undefined)n=1;else{if(e.type[2]===r.Undefined)return x(i,"No size axis contains a valid size or scale"),!1;n=2}for(let t=0;t<3;++t)e.type[t]===r.Undefined&&(e.minSize[t]=e.minSize[n],e.maxSize[t]=e.maxSize[n],e.offset[t]=e.offset[n],e.factor[t]=e.factor[n],e.type[t]=e.type[n]);return!0}(n.size,t,i)?null:n:null}class R{constructor(e,t,i){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=i}}function O(e,t){if(!e)return null;if(f.h.TESTS_DISABLE_FAST_UPDATES)return null;const i=A(e.visualVariables,t);return i?new R(i,D(i,t),!!i.size):null}function P(e,t,i){if(!t||!e)return!1;const r=e.visualVariables,n=A(t.visualVariables,i);return!!n&&!!(I(r.size,n.size,"size")&&I(r.color,n.color,"color")&&I(r.rotation,n.rotation,"rotation")&&I(r.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=D(n,i),e.requiresShaderTransformation=!!n.size,!0)}function I(e,t,i){if(!!e!=!!t)return!1;if(e&&e.field!==t?.field)return!1;if(e&&"rotation"===i){const i=e,r=t;for(let e=0;e<3;e++)if(i.type[e]!==r.type[e]||i.offset[e]!==r.offset[e]||i.factor[e]!==r.factor[e])return!1}return!0}class L extends m.K{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}}function D(e,t){const i=new L(e);return i.vvSize&&(i.vvSymbolAnchor=t.anchor,(0,l.yR)(B),function(e,t,i,r=(0,c.Ue)()){const n=e||0,s=t||0,o=i||0;0!==n&&(0,l.jI)(r,r,-n/180*Math.PI),0!==s&&(0,l.lM)(r,r,s/180*Math.PI),0!==o&&(0,l.uD)(r,r,o/180*Math.PI)}(t.rotation[2],t.rotation[0],t.rotation[1],B),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||(0,a.Ue)(),(0,o.xO)(i.vvSymbolRotationMatrix,B)),i}function N(e,t,i){if(!e.vvSize)return i;(0,l.JG)(k,i);const r=e.vvSymbolRotationMatrix;(0,l.t8)(B,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),(0,l.Jp)(k,k,B);for(let i=0;i<3;++i){const r=e.vvSize.offset[i]+t[0]*e.vvSize.factor[i];z[i]=(0,s.uZ)(r,e.vvSize.minSize[i],e.vvSize.maxSize[i])}return(0,l.bA)(k,k,z),(0,l.Iu)(k,k,e.vvSymbolAnchor),k}function F(e,t,i){if(!t.vvSize)return(0,u.i)(e,1,1,1),e;for(let r=0;r<3;++r){const n=t.vvSize.offset[r]+i[0]*t.vvSize.factor[r];e[r]=(0,s.uZ)(n,t.vvSize.minSize[r],t.vvSize.maxSize[r])}return e}function U(e,t){const i=null==e?0:t.attributes[e];return"number"==typeof i&&isFinite(i)?i:0}const k=(0,c.Ue)(),z=(0,h.Ue)(),B=(0,c.Ue)()},49931:(e,t,i)=>{i.d(t,{J:()=>a,Q:()=>s});var r=i(69442),n=i(24568);class s{constructor(e,t,i,r,s=a(e,t,i)){this._tilingScheme=r,this.id=s,this.lij=[0,0,0],this.extent=(0,n.Ue)(),this.measures=new o,this.loadPriority=0,this.used=!1,this.lij[0]=this.measures.lodLevel=e,this.lij[1]=t,this.lij[2]=i,r.getExtent(e,t,i,this.extent)}get planetRadius(){return(0,r.Iu)(this.spatialReference).radius}get spatialReference(){return this._tilingScheme.spatialReference}get resolution(){return this._tilingScheme.resolutionAtLevel(this.measures.lodLevel)}get level(){return this.lij[0]}get lodLevelDelta(){return this.measures.lodLevel-this.level}createChildren(){const e=this.lij[0]+1,t=2*this.lij[1],i=2*this.lij[2];return[new s(e,t,i,this._tilingScheme),new s(e,t+1,i,this._tilingScheme),new s(e,t,i+1,this._tilingScheme),new s(e,t+1,i+1,this._tilingScheme)]}}class o{constructor(){this.visible=!0,this.distance=0,this.lodLevel=0,this.splitPriority=0,this.mergeable=!0}}function a(e,t,i){return`${e}/${t}/${i}`}},70633:(e,t,i)=>{i.d(t,{W:()=>r,l:()=>n});class r{constructor(e,t=0,i=0,r=0,n=0,s=null){this.usedMemory=e,this.displayedFeatures=t,this.totalFeatures=i,this.maximumFeatures=r,this.nodes=n,this.core=s}}function n(e){return"performanceInfo"in e}},57180:(e,t,i)=>{i.d(t,{hM:()=>c,C8:()=>u,$s:()=>h,eU:()=>l});var r=i(30936),n=(i(39994),i(95550)),s=i(52721);var o=i(75427),a=i(37630);function l(e){return e&&e.enabled&&(function(e){return"extrude"===e.type}(e)||function(e){return"fill"===e.type}(e))&&null!=e.edges}function c(e,t){return u(function(e){return e&&e.enabled&&e.edges||null}(e),t)}function u(e,t){if(null==e)return null;const i=null!=e.color?(0,s.nI)(r.Z.toUnitRGBA(e.color)):(0,s.al)(0,0,0,0),o=(0,n.F2)(e.size),l=(0,n.F2)(e.extensionLength);switch(e.type){case"solid":return h({color:i,size:o,extensionLength:l,...t});case"sketch":return function(e){return{...p,...e,type:a.Pb.Sketch}}({color:i,size:o,extensionLength:l,...t});default:return}}function h(e){return{...d,...e,type:a.Pb.Solid}}const d={color:(0,s.al)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:o.i.OPAQUE,hasSlicePlane:!1},p={color:(0,s.al)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:o.i.OPAQUE,hasSlicePlane:!1}},39346:(e,t,i)=>{function r(e){return t=>{if(e.immediate)return e.immediate.schedule(t);const i="No immediate scheduler";throw console.error(i),new Error(i)}}i.d(t,{H:()=>r})},66352:(e,t,i)=>{i.d(t,{F5:()=>s,HB:()=>o,a9:()=>r});var r,n=i(19431);function s(e){switch(e){case"multiply":default:return r.Multiply;case"ignore":return r.Ignore;case"replace":return r.Replace;case"tint":return r.Tint}}function o(e,t,i){if(null==e||t===r.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const s=(0,n.uZ)(Math.round(e[3]*l),0,l),o=0===s||t===r.Tint?0:t===r.Replace?c:u;i[0]=(0,n.uZ)(Math.round(e[0]*a),0,a),i[1]=(0,n.uZ)(Math.round(e[1]*a),0,a),i[2]=(0,n.uZ)(Math.round(e[2]*a),0,a),i[3]=s+o}!function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"}(r||(r={}));const a=255,l=85,c=l,u=2*l},62884:(e,t,i)=>{i.d(t,{i:()=>a,p:()=>r});var r,n=i(86717),s=i(81095),o=i(59934);class a{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=(0,o.Ue)(),this._points=(0,o.Hf)(),this.lines=new Array(12),this._origin=(0,s.Ue)(),this._direction=(0,s.Ue)(),this._altitude=null;for(let e=0;e<12;e++)this.lines[e]={origin:null,direction:(0,s.Ue)(),endpoint:null}}update(e){(0,o.q_)(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),(0,n.c)(this._origin,e.eye),(0,n.c)(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let t=0;t<this._points.length;t++)(0,n.c)(this._points[t],e[t]);(0,o.Jp)(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return(0,o.hr)(this.frustum,e)}intersectsRay(e){return(0,o.Zr)(this.frustum,e)}intersectsLineSegment(e,t){return(0,o.rN)(this.frustum,e,t)}intersectsPoint(e){return(0,o.g8)(this.frustum,e)}_updateLines(){const e=this._points;for(let t=0;t<4;t++){const i=t+4;l(this.lines[t],e[t],e[i]),l(this.lines[t+4],e[t],3===t?e[0]:e[t+1]),l(this.lines[t+8],e[i],3===t?e[4]:e[i+1])}}}function l(e,t,i){e.origin=t,e.endpoint=i,(0,n.o)(e.direction,t,i)}a.planePointIndices=o.xu,a.nearFarLineIndices=[[o.NQ.NEAR_BOTTOM_LEFT,o.NQ.FAR_BOTTOM_LEFT],[o.NQ.NEAR_BOTTOM_RIGHT,o.NQ.FAR_BOTTOM_RIGHT],[o.NQ.NEAR_TOP_RIGHT,o.NQ.FAR_TOP_RIGHT],[o.NQ.NEAR_TOP_LEFT,o.NQ.FAR_TOP_LEFT]],function(e){e[e.NEAR_FAR_BOTTOM_LEFT=0]="NEAR_FAR_BOTTOM_LEFT",e[e.NEAR_FAR_BOTTOM_RIGHT=1]="NEAR_FAR_BOTTOM_RIGHT",e[e.NEAR_FAR_TOP_RIGHT=2]="NEAR_FAR_TOP_RIGHT",e[e.NEAR_FAR_TOP_LEFT=3]="NEAR_FAR_TOP_LEFT",e[e.NEAR_BOTTOM=4]="NEAR_BOTTOM",e[e.NEAR_RIGHT=5]="NEAR_RIGHT",e[e.NEAR_TOP=6]="NEAR_TOP",e[e.NEAR_LEFT=7]="NEAR_LEFT",e[e.FAR_BOTTOM=8]="FAR_BOTTOM",e[e.FAR_RIGHT=9]="FAR_RIGHT",e[e.FAR_TOP=10]="FAR_TOP",e[e.FAR_LEFT=11]="FAR_LEFT"}(r||(r={}))},98872:(e,t,i)=>{i.d(t,{L:()=>o});var r=i(19431),n=i(86717),s=i(81095);function o(e,t,i){e.worldUpAtPosition(t,a),(0,n.d)(l,i,t);const s=(0,n.l)(l);return 0===s?0:(0,r.ZF)((0,n.f)(l,a)/s)}const a=(0,s.Ue)(),l=(0,s.Ue)()},66143:(e,t,i)=>{i.d(t,{Fb:()=>s,KO:()=>o,sb:()=>n});var r=i(94486);class n{constructor(e,t=null,i=0){this.array=e,this.spatialReference=t,this.offset=i}}function s(e){return"array"in e}function o(e,t,i="ground"){if((0,r.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(s(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,t.spatialReference??e.spatialReference,i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},88038:(e,t,i)=>{i.d(t,{r:()=>r});class r{constructor(e=1/0,t=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=t}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,t){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,t)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}}},92324:(e,t,i)=>{i.d(t,{c:()=>n});var r=i(24568);class n{constructor(e="scene"){this.context=e,this.extent=(0,r.cS)()}}},8864:(e,t,i)=>{i.d(t,{d:()=>h,c:()=>u});var r=i(36663),n=i(74396),s=(i(39994),i(13802)),o=i(40366),a=i(17262),l=i(81977),c=(i(4157),i(40266));function u(e){return new d({view:e})}const h=.1;let d=class extends n.Z{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new o.WJ,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles((0,a.A)({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){null==e||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(1),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){null!=e&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,t,i){return new o.Xq(e,this._cacheStorage,t,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<.6&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(1);else if(e)(this._memoryPredicted>1.1||this._usedMemory>1)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>h&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>1)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<.75&&this._quality<1){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,h),1))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some((e=>!!e.updating))}_updateMemory(){if(!this.view)return;this.view._stage?.renderer?.tick();const e=this.view._stage?.renderer?.usedMemory;let t=(this.view.basemapTerrain?.usedMemory??0)+(e?e.fbos+e.edges+e.plugins:0),i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach((e=>{if(function(e){return"usedMemory"in e&&"unloadedMemory"in e&&"ignoresMemoryFactor"in e}(e)){const r=e.ignoresMemoryFactor?this._quality:1;t+=e.usedMemory*r,i+=e.unloadedMemory*r}}));const r=null==this._warnMemoryUsage||Math.round(10*t)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(t>n&&r){this._warnMemoryUsage=t;const e=e=>(e/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",r=Math.round(100*this._quality);s.Z.getLogger(this).warn(`Memory Limit exceeded! Limit: ${e(n)} Current: ${e(t)} Projected: ${e(t+i)} Quality: ${r}%`)}this._usedMemory=t/n,this._memoryPredicted=(t+i)/n;const o=n-t;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){}};(0,r._)([(0,l.Cb)({constructOnly:!0})],d.prototype,"view",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"maxMemory",null),(0,r._)([(0,l.Cb)()],d.prototype,"additionalCacheMemory",null),(0,r._)([(0,l.Cb)({readOnly:!0})],d.prototype,"memoryFactor",null),(0,r._)([(0,l.Cb)({readOnly:!0})],d.prototype,"updating",null),(0,r._)([(0,l.Cb)({readOnly:!0})],d.prototype,"usedMemory",null),(0,r._)([(0,l.Cb)({readOnly:!0})],d.prototype,"usedCacheMemory",null),(0,r._)([(0,l.Cb)()],d.prototype,"_quality",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"_usedMemory",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"_updating",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"_stableQuality",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"_maxMemory",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"_additionalCacheMemory",void 0),d=(0,r._)([(0,c.j)("esri.views.3d.support.MemoryController")],d)},43180:(e,t,i)=>{i.d(t,{Z:()=>b});var r=i(19431),n=i(17321),s=i(32114),o=i(86717),a=i(69442),l=i(61170),c=i(57022),u=i(10369),h=i(49757),d=i(24568),p=i(19546),f=i(47190),m=i(69430),g=i(5700),y=i(68817),_=i(94486),v=i(65684);class b{constructor(e,t,i,r){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=i,this._coordinateSystem=r,this._tmpCoordinateSystem=(0,f.Ue)(r),this.referenceEllipsoid=(0,a.Iu)(t),this.sphericalPCPF=(0,l.rS)(t)}set extent(e){e&&(0,f.qf)(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return(0,f.bk)(this._coordinateSystem,(0,d.Ue)())}getAltitude(e){return(0,f.id)(this._coordinateSystem,e)}setAltitude(e,t,i=e){return(0,f.Is)(this._coordinateSystem,i,t,e)}setAltitudeOfTransformation(e,t){(0,f.rF)(this._coordinateSystem,t,e,t)}worldUpAtPosition(e,t){return(0,f.P0)(this._coordinateSystem,e,t)}worldBasisAtPosition(e,t,i){return(0,f.Kf)(this._coordinateSystem,e,t,i)}basisMatrixAtPosition(e,t){const i=this.worldBasisAtPosition(e,p.R.X,y.WM.get()),r=this.worldBasisAtPosition(e,p.R.Y,y.WM.get()),n=this.worldBasisAtPosition(e,p.R.Z,y.WM.get());return(0,s.t8)(t,i[0],i[1],i[2],0,r[0],r[1],r[2],0,n[0],n[1],n[2],0,0,0,0,1),t}headingAtPosition(e,t){const i=this.worldUpAtPosition(e,y.WM.get()),n=this.worldBasisAtPosition(e,p.R.Y,y.WM.get()),s=(0,g.cp)(t,n,i);return(0,r.BV)(s)}intersectManifoldClosestSilhouette(e,t,i){return(0,f.NE)(this._coordinateSystem,t,this._tmpCoordinateSystem),(0,f.ej)(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,t,i){(0,f.NE)(this._coordinateSystem,t,this._tmpCoordinateSystem);const r=y.WM.get();return(0,f.BR)(this._tmpCoordinateSystem,e,r)?(0,o.c)(i,r):null}intersectInfiniteManifold(e,t,i){if(this.viewingMode===v.JY.Global)return this.intersectManifold(e,t,i);(0,f.NE)(this._coordinateSystem,t,this._tmpCoordinateSystem);const r=this._tmpCoordinateSystem.value,n=y.WM.get();return(0,m.BR)(r.plane,e,n)?(0,o.c)(i,n):null}toRenderCoords(e,t,i){return(0,_.f)(e)?(0,c.K)(e,t,this.spatialReference):(0,h.S)(e,t,i,this.spatialReference)}fromRenderCoords(e,t,i=null){return(0,_.f)(t)?(null!=i&&(t.spatialReference=i),(0,u.f)(e,this.spatialReference,t)?t:null):(0,h.S)(e,this.spatialReference,t,i)?t:null}static create(e,t){switch(e){case v.JY.Local:return new b(v.JY.Local,t,(0,n.c9)(t),(0,f.pb)());case v.JY.Global:return new b(v.JY.Global,t,1,(0,f.pt)(t))}}static renderUnitScaleFactor(e,t){return(0,n.r6)(e)/(0,n.r6)(t)}}},44685:(e,t,i)=>{i.d(t,{Gw:()=>c,U$:()=>l,pV:()=>a});var r=i(81936),n=i(90331),s=i(15095);class o{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const t of e.fields.keys()){const i=e.fields.get(t);this[t]=new i.constructor(this.buffer,i.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const i=this[e];return i&&i.elementCount===t.ElementCount&&i.elementType===t.ElementType?i:null}slice(e,t){return new o(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t=0,i=0,r=e.count){const n=this.stride;if(n%4==0){const s=new Uint32Array(e.buffer,t*n,r*n/4);new Uint32Array(this.buffer,i*n,r*n/4).set(s)}else{const s=new Uint8Array(e.buffer,t*n,r*n);new Uint8Array(this.buffer,i*n,r*n).set(s)}return this}get cachedMemory(){return this.byteLength}dispose(){}}class a{constructor(e){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach((e=>this._fields.set(e[0],{...e[1],constructor:d(e[1].constructor)}))))}freeze(){return this}vec2f(e,t){return this._appendField(e,r.Eu,t),this}vec2f64(e,t){return this._appendField(e,r.q6,t),this}vec3f(e,t){return this._appendField(e,r.ct,t),this}vec3f64(e,t){return this._appendField(e,r.fP,t),this}vec4f(e,t){return this._appendField(e,r.ek,t),this}vec4f64(e,t){return this._appendField(e,r.Cd,t),this}mat3f(e,t){return this._appendField(e,r.gK,t),this}mat3f64(e,t){return this._appendField(e,r.ey,t),this}mat4f(e,t){return this._appendField(e,r.bj,t),this}mat4f64(e,t){return this._appendField(e,r.O1,t),this}vec4u8(e,t){return this._appendField(e,r.mc,t),this}f32(e,t){return this._appendField(e,r.ly,t),this}f64(e,t){return this._appendField(e,r.oS,t),this}u8(e,t){return this._appendField(e,r.D_,t),this}u16(e,t){return this._appendField(e,r.av,t),this}i8(e,t){return this._appendField(e,r.Hz,t),this}vec2i8(e,t){return this._appendField(e,r.Vs,t),this}vec2i16(e,t){return this._appendField(e,r.or,t),this}vec2u8(e,t){return this._appendField(e,r.xA,t),this}vec4u16(e,t){return this._appendField(e,r.v6,t),this}u32(e,t){return this._appendField(e,r.Nu,t),this}_appendField(e,t,i){if(this._fields.has(e))return void(0,s.hu)(!1,`${e} already added to vertex buffer layout`);const r=t.ElementCount*(0,n.n1)(t.ElementType),o=this._stride;this._stride+=r,this._fields.set(e,{size:r,constructor:t,offset:o,optional:i})}createBuffer(e){return new o(this,e)}createView(e){return new o(this,e)}clone(){const e=new a;return e._stride=this._stride,e._fields=new Map,this._fields.forEach(((t,i)=>e._fields.set(i,t))),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach((t=>e=Math.max(e,(0,n.n1)(t.constructor.ElementType)))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}function l(){return new a}class c{constructor(e){this.fields=new Array,e.fields.forEach(((e,t)=>{const i={...e,constructor:h(e.constructor)};this.fields.push([t,i])})),this.stride=e.stride}}const u=[r.ly,r.Eu,r.ct,r.ek,r.gK,r.bj,r.oS,r.q6,r.fP,r.Cd,r.ey,r.O1,r.D_,r.xA,r.ne,r.mc,r.av,r.TS,r.mw,r.v6,r.Nu,r.qt,r.G5,r.hu,r.Hz,r.Vs,r.P_,r.ir,r.o7,r.or,r.n1,r.zO,r.Jj,r.wA,r.PP,r.TN];function h(e){return`${e.ElementType}_${e.ElementCount}`}function d(e){return p.get(e)}const p=new Map;u.forEach((e=>p.set(h(e),e)))},95397:(e,t,i)=>{i.d(t,{K:()=>s});var r=i(91907),n=i(41163);function s(e,t=0){const i=e.stride;return Array.from(e.fields.keys()).map((r=>{const s=e.fields.get(r),a=s.constructor.ElementCount,l=o(s.constructor.ElementType),c=s.offset,u=s.optional?.glNormalized??!1;return new n.G(r,a,l,c,i,u,t)}))}function o(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:r.g.UNSIGNED_BYTE,u16:r.g.UNSIGNED_SHORT,u32:r.g.UNSIGNED_INT,i8:r.g.BYTE,i16:r.g.SHORT,i32:r.g.INT,f32:r.g.FLOAT}},28521:(e,t,i)=>{i.d(t,{Q8:()=>Pe,Br:()=>Be,t_:()=>$e,Xt:()=>ze,n3:()=>Ne,gL:()=>We,Hm:()=>qe,UI:()=>Ze,Ic:()=>ot,S9:()=>at,P$:()=>Je,h5:()=>Ie,kE:()=>De,l0:()=>Ue,_U:()=>ke,sO:()=>mt,ao:()=>ct,HH:()=>lt,cb:()=>je,EO:()=>gt});var r,n,s,o=i(33098),a=i(16068),l=i(13802),c=i(19431),u=i(78668),h=i(86717),d=i(81095),p=i(69442),f=i(10186),m=i(90472),g=i(14685),y=i(57022),_=i(10369),v=i(49757),b=i(65684),w=i(64666),x=i(32114),T=i(3308),C=i(84164),S=i(91772),E=i(89542),M=i(38028),A=i(59934),R=i(36531);function O(e,t){const i=[],r=[];return P(i,e,t,s.LEFT),P(r,i,t,s.BOTTOM),P(i,r,t,s.RIGHT),P(r,i,t,s.TOP),r}function P(e,t,i,r){const s=L(i,r);if(e.length=0,t.length){s(D,t[0],t[0])===n.INSIDE&&I(e,t[0]);for(let i=0;i<t.length;i++){const r=t[i===t.length-1?0:i+1];switch(s(D,t[i],r)){case n.INSIDE:I(e,r);break;case n.INSIDE_OUT:I(e,(0,C.d9)(D));break;case n.OUTSIDE_IN:I(e,(0,C.d9)(D)),I(e,r);case n.OUTSIDE:}}}}function I(e,t){0!==e.length&&(0,R.fS)(e.at(-1),t)||e.push(t)}function L(e,t){const i=t===s.LEFT||t===s.RIGHT?0:1,o=e[t],a=t===s.LEFT||t===s.BOTTOM?r.MIN:r.MAX,l=0===i?1:0;return(e,t,s)=>{if(t[i]<o&&s[i]<o)return a===r.MIN?n.OUTSIDE:n.INSIDE;if(t[i]>o&&s[i]>o)return a===r.MIN?n.INSIDE:n.OUTSIDE;const c=(s[l]-t[l])/(s[i]-t[i]),u=t[l]+c*(o-t[i]);return e[i]=o,e[l]=u,(t[i]<o?1:-1)*a>0?n.OUTSIDE_IN:n.INSIDE_OUT}}!function(e){e[e.MIN=1]="MIN",e[e.MAX=-1]="MAX"}(r||(r={})),function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE_IN=2]="OUTSIDE_IN",e[e.INSIDE_OUT=3]="INSIDE_OUT"}(n||(n={})),function(e){e[e.LEFT=0]="LEFT",e[e.BOTTOM=1]="BOTTOM",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP"}(s||(s={}));const D=(0,C.Ue)();var N=i(97537),F=i(62884),U=i(20101);const k=(0,d.al)(0,1,0),z=(0,d.al)(0,0,1),B=(0,T.Ue)(),V=(0,d.Ue)(),H=(0,d.Ue)();function G(e,t,i,r=(0,U.dp)()){const{direction:n,up:s}=r;return(0,x.QO)(B,-(0,c.Vl)(t)),(0,x.lM)(B,B,(0,c.Vl)(i)),(0,h.t)(n,z,B),(0,h.h)(n,n,-1),(0,h.t)(s,k,B),r}function j(e,t,i,r,n){const s=t.lines[F.p.FAR_LEFT].direction,o=(n-i.getAltitude(r))/s[2];(0,h.b)(e,r,s,o)}const Z=(0,d.Ue)(),q=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(e,t,i,r){return(0,U.t_)(t,i,r,z,k)},eyeForCenterWithHeadingTilt:function(e,t,i,r){const n=G(0,i,r),s=(0,d.Ue)();return(0,h.h)(s,n.direction,-t),(0,h.g)(s,s,e),{up:n.up,eye:s,heading:i,tilt:r}},eyeTiltToLookAtTilt:function(e){return(0,c.Vl)(e)},headingTiltToDirectionUp:G,lookAtTiltToEyeTilt:function(e){return(0,c.BV)(e)},toArea:function(e,t){const i=e.frustum,{renderCoordsHelper:r}=e,n=r.getAltitude(t),s=e.spatialReference,o=e.state.camera.eye,a=[],l=i.planes[A.Nu.FAR];for(let e=0;e<4;e++){const t=i.lines[e];r.intersectInfiniteManifold((0,N.re)(t.origin,t.direction),n,Z)||j(Z,i,r,t.endpoint,n),(0,U.H2)(Z,o,Z,l),a.push((0,C.al)(Z[0],Z[1]))}return function(e,t,i){const r=e.map((e=>((0,h.i)(Z,e[0],e[1],0),t.fromRenderCoords(Z,Z,i),[Z[0],Z[1]])));return r.length<=2?new E.Z({spatialReference:i}):(r.push(r[0].slice()),(0,M.bu)(r)||r.reverse(),new E.Z({rings:[r],spatialReference:i}))}(O(a,r.extent),r,s)},toExtent:function(e,t,i,r,n){const s=e.renderSpatialReference,o=e.spatialReference??t.spatialReference;return(0,y.K)(t,V,s),(0,y.K)(t,H,s),V[0]-=i/2,H[0]+=i/2,V[1]-=r/2,H[1]+=r/2,(0,v.S)(V,s,V,o),(0,v.S)(H,s,H,o),n?(n.xmin=V[0],n.ymin=V[1],n.xmax=H[0],n.ymax=H[1],n.spatialReference=o):n=new S.Z(V[0],V[1],H[0],H[1],o),n}},Symbol.toStringTag,{value:"Module"}));var W=i(56999),$=i(52721),Y=i(40201),J=i(56215),X=i(69430),K=i(73687),Q=i(39536),ee=i(98872),te=i(20401),ie=i(35369);const re=(0,d.al)(0,0,1),ne=(0,h.n)((0,d.Ue)(),(0,d.al)(1,1,1)),se=new a.pE(-180,180),oe=(0,T.Ue)(),ae=(0,d.Ue)(),le=(0,d.Ue)();function ce(e,t,i,r=(0,U.dp)()){(0,h.e)(ae,e,re),0===(0,h.f)(ae,ae)&&(0,h.e)(ae,e,ne),(0,x.Us)(oe,-(0,c.Vl)(t),e),(0,x.U1)(oe,oe,-(0,c.Vl)(i),ae);const{up:n,direction:s}=r;return(0,h.e)(n,ae,e),(0,h.n)(n,n),(0,h.t)(n,n,oe),(0,h.n)(s,e),(0,h.v)(s,s),(0,h.t)(s,s,oe),r}function ue(e){const t=e[1];e[1]=-e[2],e[2]=t}function he(e,t){const i=ce(t,e.heading,e.tilt);return e.up=i.up,e}function de(e,t){const i=[],r=[],n=(0,Y.bn)();for(let s=0;s<e.length;s++){const o=e[s],a=s===e.length-1?e[0]:e[s+1],l=(0,J.zk)(o,a,be),c=(0,X.Qi)(t,l.origin,l.vector,X.oy.NONE,_e);switch(c){case X.Kt.INSIDE:i.push(o);break;case X.Kt.OUTSIDE:r.push(o);break;case X.Kt.INTERSECTS_INSIDE_OUT:case X.Kt.INTERSECTS_OUTSIDE_IN:{const[e,s,a]=c===X.Kt.INTERSECTS_INSIDE_OUT?[1,i,r]:[-1,r,i],l=(0,X.st)(t),u=(0,h.b)((0,d.Ue)(),_e,l,e*n),p=(0,h.b)((0,d.Ue)(),_e,l,e*-n);s.push(o),s.push(u),a.push(p)}}}const s=[];return i.length&&s.push(i),r.length&&s.push(r),s}const pe={minCurvature:(0,c.Vl)(5),maxCurvature:(0,c.Vl)(50),minSamples:1,maxSamples:6},fe=(0,d.al)(1,0,0),me=(0,d.al)(0,1,0),ge=(0,d.Ue)(),ye=(0,d.Ue)(),_e=(0,d.Ue)(),ve=(0,K.c)(),be=(0,J.Ue)(),we=(0,$.Ue)(),xe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(e,t,i,r){const n=ae,s=le;return(0,h.n)(n,e),(0,h.e)(le,n,re),0===(0,h.f)(le,le)&&(0,h.e)(le,n,ne),(0,h.e)(s,le,n),(0,U.t_)(t,i,r,n,s)},eyeForCenterWithHeadingTilt:function(e,t,i,r){const n={eye:(0,d.Ue)(),up:null,tilt:r,heading:i},s=ae;s[0]=e[0],s[1]=e[2],s[2]=-e[1];const o=t,a=(0,c.Vl)(i),l=(0,c.Vl)(r),u=Math.sin(a),p=Math.cos(a),f=Math.sin(l),m=Math.cos(l),g=(0,h.l)(s);let y;if(Math.abs(l)<1e-8)y=o+g;else{const e=g/f,t=(0,c.Kt)(o/e),i=Math.PI-l-t;y=e*Math.sin(i)}const _=m*o,v=o*o*(f*f),b=p*p*v,w=y-_,x=w*w,T=b*(b+x-s[1]*s[1]);if(T<0)return(0,h.h)(n.eye,s,y/g),n.tilt=0,he(n,e);const C=Math.sqrt(T),S=s[1]*w,E=b+x;let M;if(M=p>0?-C+S:C+S,Math.abs(E)<1e-8)return g<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):(0,h.h)(n.eye,s,y/g),n.tilt=0,ue(n.eye),he(n,e);n.eye[1]=M/E;const A=u*u*v,R=f*o,O=p*R*n.eye[1],P=n.eye[1]*n.eye[1],I=1-P,L=Math.sqrt(I),D=b*P+A-2*O*L*w+I*x;return Math.abs(D)<1e-8?((0,h.h)(n.eye,s,y/g),n.tilt=0,ue(n.eye),he(n,e)):(n.eye[0]=(I*(y*s[0]-_*s[0])-R*L*(s[0]*n.eye[1]*p+s[2]*u))/D,n.eye[2]=(I*(y*s[2]-_*s[2])-R*L*(s[2]*n.eye[1]*p-s[0]*u))/D,(0,h.h)(n.eye,n.eye,y),ue(n.eye),he(n,e))},eyeTiltToLookAtTilt:function(e,t,i){const r=(0,c.Vl)(e),n=(0,h.l)(t);return(0,c.Kt)(i/(n/Math.sin(r)))+r},headingTiltToDirectionUp:ce,lookAtTiltToEyeTilt:function(e,t,i){const r=(0,h.l)(t),n=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),s=(0,c.Kt)(i/(n/Math.sin(e)));return(0,c.BV)(e-s)},toArea:function(e,t){const i=e.frustum,{renderCoordsHelper:r}=e,n=r.getAltitude(t),s=e.spatialReference,o=r.referenceEllipsoid.radius,a=e.state.camera,l=a.eye,u=1+(0,h.j)(l,t)/(o+n),p=Math.sqrt(u*u-1),{minCurvature:f,maxCurvature:m,minSamples:g,maxSamples:y}=pe,_=function(e){const{renderCoordsHelper:t,state:{camera:i}}=e,{center:r,eye:n}=i,s=Math.abs(t.getAltitude(r)),o=Math.abs(Math.PI/2-(0,ee.L)(t,r,n));return(0,K.b)(ve,t.referenceEllipsoid.radius+s),(0,K.d)(ve,o,i.distance,i.fovY)}(e),v=(0,c.uZ)((p-f)/(m-f),0,1),b=Math.round((0,c.t7)(g,y,v)),w=a.aboveGround,x=i.planes[A.Nu.FAR],T=[],C=(0,X.Yq)(d.AG,fe,(0,X.Ue)()),S=(0,X.Yq)(d.AG,me,(0,X.Ue)());(0,W.s)(we,0,0,0,0);for(let e=0;e<4;e++){const t=e===F.p.NEAR_FAR_BOTTOM_RIGHT&&!w||e===F.p.NEAR_FAR_TOP_LEFT&&w?1-_:0,s=e===F.p.NEAR_FAR_BOTTOM_RIGHT&&w||e===F.p.NEAR_FAR_TOP_LEFT&&!w?_:1,o=i.lines[e],a=i.lines[3===e?0:e+1];for(let i=0;i<b;i++){const u=i/b,p=e===F.p.NEAR_FAR_BOTTOM_RIGHT?1-(1-u)**2:e===F.p.NEAR_FAR_TOP_LEFT?u**2:u,f=0===i?0:(0,c.t7)(t,s,p),m=(0,h.m)(ye,o.origin,a.origin,f),g=(0,ie.ZA)(o.direction,a.direction,f,ge);r.intersectManifoldClosestSilhouette((0,N.re)(m,g),n,_e),(0,U.H2)(_e,l,_e,x),T.push((0,d.d9)(_e)),0!==T.length&&(0,h.y)(T.at(-1),_e);const y=((0,X.Ac)(C,_e)?1:0)|((0,X.Ac)(S,_e)?2:0);we[y]=1}}T.length>2&&(0,h.y)(T[0],T.at(-1));const R=function(e,t,i){const r=2*(0,Y.bn)();return e.map((e=>{const n=[];let s=!1;for(const o of e)t.fromRenderCoords(o,_e,i),Math.abs(o[0])<r&&Math.abs(o[1])<r?(n.push([null,_e[1]]),n.push([null,_e[1]]),s=!0):n.push([_e[0],_e[1]]);if(s)for(let e=0;e<n.length;e++){const t=n[e];if(null!=t[0])continue;const i=n[e+1],r=n.at(0===e?-1:e-1);t[0]=r[0],e++;const s=n.at(e===n.length-1?0:e+1);i[0]=s[0]}return n.push(n[0]),(0,M.bu)(n)||n.reverse(),n}))}((0,W.f)(we)>1?function(e,t){const i=[];for(const r of e)i.push(...de(r,t));return i}(de(T,C),S):[T],r,s);return new E.Z({rings:R,spatialReference:s})},toExtent:function(e,t,i,r,n){let s,o,l,u;const h=t.latitude,d=(0,p.Iu)(e.spatialReference).radius,f=t.longitude,m=(0,te.Be)(h,i,d)/2;s=f-m,o=f+m;const y=(0,c.Vl)(h),_=(1+Math.sin(y))/(1-Math.sin(y)),v=(_+1)*Math.tan(r/d/2),b=v*v;function w(e){const t=Math.PI/2;return(e=a.c5.normalize(e,-t))>t&&(e=Math.PI-e),e}if(l=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*_+b))),u=l+r/d,l=w(l),u=w(u),u<l){const e=u;u=l,l=e}if(l=Math.max((0,c.BV)(l),-90),u=Math.min((0,c.BV)(u),90),o=se.monotonic(s,o),o-s>180){const e=(o-s-180)/2;s+=e,o-=e}const x=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:g.Z.WGS84;return n?(n.xmin=s,n.ymin=l,n.xmax=o,n.ymax=u,n.spatialReference=x):n=new S.Z(s,l,o,u,x),e.spatialReference&&e.spatialReference.isWebMercator&&(0,Q.$)(n,!1,n),n}},Symbol.toStringTag,{value:"Module"}));var Te=i(66143),Ce=i(14029);const Se=()=>l.Z.getLogger("esri.views.3d.support.cameraUtils"),Ee=96*39.37,Me={heading:0,tilt:0},Ae=(0,d.Ue)(),Re=new a.pE(-20037508.342788905,20037508.342788905),Oe=new a.pE(-180,180);var Pe;function Ie(e){return e.spatialReference??g.Z.WGS84}function Le({state:e}){return e.isGlobal?xe:q}function De(e,t,i,r,n){return Le(e).headingTiltToDirectionUp(t,i,r,n)}function Ne(e,t){if(null==t)return null;const i=e.renderSpatialReference,r=Le(e).headingTiltToDirectionUp,n=(0,d.Ue)();if(!(0,y.K)(t.position,n,i))return null;const s=r(n,t.heading,t.tilt);(0,h.h)(s.direction,s.direction,e.state.camera.distance),(0,h.g)(s.direction,s.direction,n);const o=(0,w.dP)(e,n,s.direction,s.up);return o.fov=(0,c.Vl)(t.fov),o.row=t.layout.row,o.rows=t.layout.rows,o.column=t.layout.column,o.columns=t.layout.columns,o}!function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"}(Pe||(Pe={}));const Fe=(0,d.Ue)();function Ue(e,t,i){const r=e.renderSpatialReference,n=$e(e,t.eye,t.viewForward,t.up,Me);let s=Ie(e);return(0,v.S)(t.eye,r,Fe,s)||(s=g.Z.WGS84,(0,v.S)(t.eye,r,Fe,s)),null==i?i=new o.Z(new f.Z(Fe,s),n.heading,n.tilt,(0,c.BV)(t.fov)):(i.position.x=Fe[0],i.position.y=Fe[1],i.position.z=Fe[2],i.position.spatialReference=s,i.heading=n.heading,i.tilt=n.tilt,i.fov=(0,c.BV)(t.fov)),i.layout.row=t.row,i.layout.rows=t.rows,i.layout.column=t.column,i.layout.columns=t.columns,i}function ke(e,t){const{camera:i}=e.state,{unitInMeters:r}=e.renderCoordsHelper;return t/=r,i.width/2/i.pixelRatio/(Ee/t)/Math.tan(i.fovX/2)}function ze(e,t){const{camera:i}=e.state,{unitInMeters:r}=e.renderCoordsHelper,n=t*Math.tan(i.fovX/2),s=i.width/2/i.pixelRatio;return Ee/(s/n)*r}function Be(e,t,i,r){const n=r.levelAtScale(t),s=He($e(e,i.eye,i.viewForward,i.up).tilt),o=Math.max(n-s,0);return r.scaleAtLevel(o)}function Ve(e,t,i){const r=i.levelAtScale(e),n=He(t);return i.scaleAtLevel(r+n)}function He(e){return 2*((e>90?180-e:e)/90)**2}function Ge(e,t,i=0){const r=Ne(e,t);return r?function(e,t,i=0){const r=e.basemapTerrain?.tilingScheme;if(!r)return 0;const n=(0,p.Iu)(e.spatialReference).radius,s=e.state.viewingMode===b.JY.Local?t.eye[2]:(0,h.l)(t.eye)-n;return Be(e,ze(e,Math.abs(s-i)),t,r)}(e,r,i):0}function je(e,t,i,r,n){if(0===t)return 0;const s=(0,h.j)(i.eye,r),o=e.basemapTerrain?.tilingScheme;if(!o)return Se().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),s;let a=s;const l=$e(e,i.eye,i.viewForward,i.up),u=l.tilt>90;if(e.state.isLocal){const r=(ke(e,Ve(t,l.tilt,o))-Math.abs(i.eye[2]-n[2]))/Math.cos((0,c.Vl)(l.tilt));return a=u?a-r:a+r,a}let d=1/0,f=0,m=Je(e,l.heading,l.tilt,r,s,Pe.ADJUST);if(!m)return a;const g=(0,h.l)(n);for(;d>1&&f<100;){const n=(0,h.l)(m.eye),s=u?180-m.tilt:m.tilt,y=(0,c.Vl)(s),_=Math.sin(y)*n,v=Math.cos(y)*n,b=ke(e,Ve(t,m.tilt,o)),w=u?g-b:g+b,x=(0,c.Kt)(_/w),T=Math.cos(x)*w-v,C=(0,h.j)(m.eye,r);a=u?C-T:C+T,m=Je(e,l.heading,l.tilt,r,a,Pe.ADJUST);const S=pt(e,m,(0,c.BV)(i.fov));if(!m||!S)return a;const E=Ge(e,S,g-(0,p.Iu)(e.spatialReference).radius);d=Math.abs(t-E),++f}return a}async function Ze(e,t,i,r,n,s){return We(e,t,ke(e,i),r,n,s)}function qe(e,t,i,r,n,s){return pt(e,Je(e,r.heading,r.tilt,t,i,n),r.fov,s)}async function We(e,t,i,r,n,s){const o=await Xe(e,r.heading,r.tilt,t,i,n,s);return(0,u.k_)(s),ft(e,o,r.fov,s)}function $e(e,t,i,r,n){return Le(e).directionToHeadingTilt(t,i,r,n)}function Ye(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Ae,e.spatialReference)&&e.elevationProvider&&((0,Te.KO)(e.elevationProvider,Ae)??0)>Ae[2]-1)}function Je(e,t,i,r,n,s){return Ke(e,t,i,r instanceof f.Z?r:null,function(e,t){const i=(0,d.Ue)();if(null==t)return(0,h.c)(i,e.state.camera.center);if(t instanceof f.Z){if(!(0,y.K)(t,i,e.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:n}=e;if(null==t.z&&null!=r&&null!=n){const r=(0,Te.KO)(n,t);null!=r&&e.renderCoordsHelper.setAltitude(i,r)}return i}return(0,h.c)(i,t)}(e,r),n,s)}async function Xe(e,t,i,r,n,s,o){const a=r instanceof f.Z?r:null,l=await async function(e,t,i){const r=(0,d.Ue)();if(null==t)return(0,h.c)(r,e.state.camera.center);if(t instanceof f.Z){const{renderSpatialReference:n,basemapTerrain:s,elevationProvider:o}=e,a=t.spatialReference;if(await(0,y.U)(t,r,n,0,{signal:i}),(0,u.k_)(i),null==t.z&&null!=s&&null!=o){const n=await o.queryElevation(t.x,t.y,t.z??0,a,"ground",i);(0,u.k_)(i),null!=n&&e.renderCoordsHelper.setAltitude(r,n)}return r}return(0,h.c)(r,t)}(e,r,o);return(0,u.k_)(o),Qe(e,t,i,a,l,n,s,o)}function Ke(e,t,i,r,n,s,o){if(null==n)return null;if(!r&&(r=new f.Z({spatialReference:Ie(e)}),!(0,_.f)(n,e.renderSpatialReference,r)))return null;const a=et(e,t,i,n,s,o);if(tt(e,i,o)&&Ye(e,a.eye)){const{tilt:o,mode:a}=it(e,i,n,s);return Ke(e,t,o,r,n,s,a)}return rt(a,n)}async function Qe(e,t,i,r,n,s,o,a){r||(r=new f.Z({spatialReference:Ie(e)}),await(0,_.A)(n,e.renderSpatialReference,r,{signal:a})||(r=null)),(0,u.k_)(a);const l=et(e,t,i,n,s,o);if(tt(e,i,o)&&await async function(e,t,i){if(Ye(e,t))return!0;const{elevationProvider:r,spatialReference:n,renderCoordsHelper:s}=e;if(null==r||!s.fromRenderCoords(t,Ae,n))return!1;const[o,a,l]=Ae,c=await r.queryElevation(o,a,l,n,"ground",i)??0;return(0,u.k_)(i),c>l-1}(e,l.eye,a)){(0,u.k_)(a);const{tilt:o,mode:l}=it(e,i,n,s);return Qe(e,t,o,r,n,s,l,a)}return rt(l,n)}function et(e,t,i,r,n,s){const o=function(e,t,i,r,n,s){let o=0;return s===Pe.ADJUST&&function(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>8)return!0;const n=t,s=e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return(0,h.j)(n,s)/(Math.tan(.5*e.state.camera.fov)*r)>5}(e,r,n)?(t=0,o=function(e,t,i,r){const n=dt(e,r,t,i);if(!e.state.constraints.tilt)return n;const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-ut)+s.max*ut;return Math.min(n,o)}(e,n,i,r)):o=dt(e,r,n,i),o=e.state.constraints.clampTilt(n,o),{heading:t,tilt:i=ht(e,r,n,o)}}(e,t,i,r,n=Math.max(n,e.state.constraints.minimumPoiDistance),s);return(0,Le(e).eyeForCenterWithHeadingTilt)(r,n,o.heading,o.tilt)}function tt(e,t,i){const r=e.map.ground.navigationConstraint;return i===Pe.ADJUST&&e.state.isGlobal&&t>0&&(null==r||"stay-above"===r.type)}function it(e,t,i,r){const n=ht(e,i,r,function(e,t,i,r){let n=dt(e,r,t,i);if(!e.state.constraints.tilt)return n;const s=e.state.constraints.tilt(t);return n=Math.min(n,.5*Math.PI),s.min*(1-ut)+n*ut}(e,r,t,i));return{tilt:n,mode:t-n<1?Pe.LOCKED:Pe.ADJUST}}function rt(e,t){return{...e,center:(0,d.d9)(t)}}function nt(e,t){const{state:i,spatialReference:r}=e,n=t.spatialReference;return i.isGlobal&&(0,Ce.D)(n,b.JY.Global)||i.isLocal&&r.equals(n)}function st(e,t){let i,r,n;if(e.state.isGlobal){const e=new f.Z(t.xmin,t.ymin,t.spatialReference),s=new f.Z(t.xmax,t.ymax,t.spatialReference),o=t.spatialReference.isGeographic?Oe:Re;i=new f.Z({x:o.center(e.x,s.x),y:(s.y+e.y)/2,z:null!=t.zmax&&null!=t.zmin?(t.zmax+t.zmin)/2:void 0,spatialReference:t.spatialReference});const a=(0,p.Iu)(t.spatialReference),l=(0,te.Nf)(i,e,s);r=l.lon,n=l.lat,o.diff(e.x,s.x)>o.range/2&&(r+=a.halfCircumference),r=Math.min(r,a.halfCircumference),n=Math.min(n,a.halfCircumference)}else{const s=e.renderSpatialReference??t.spatialReference;s.equals(t.spatialReference)||(t=(0,m.project)(t,s)),r=t.xmax-t.xmin,n=t.ymax-t.ymin;const o=null!=t.zmax&&null!=t.zmin?(t.zmax+t.zmin)/2:void 0;i=new f.Z({x:t.xmin+.5*r,y:t.ymin+.5*n,z:o,spatialReference:s})}const s=null!=t.zmax&&null!=t.zmin?t.zmax-t.zmin:0,o=e.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*n*l,.5*s*c)/1}}async function ot(e,t,i,r,n,s){const o=nt(e,t)?t:await(0,m.projectWithZConversion)(t,e.spatialReference,{signal:s});(0,u.k_)(s);const{center:a,distance:l}=st(e,o),c=await Xe(e,i,r,a,l,n,s);return(0,u.k_)(s),ft(e,c,e.camera.fov,s)}function at(e,t,i,r,n,s){let o;try{o=nt(e,t)?t:(0,m.project)(t,e.spatialReference)}catch(e){return null}const{center:a,distance:l}=st(e,o),c=Je(e,i,r,a,l,n);return null==c?null:pt(e,c,e.camera.fov,s)}function lt(e,t,i){const r=e.renderSpatialReference,n=new f.Z({spatialReference:Ie(e)});if(!(0,_.f)(i,r,n))return null;const s=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=(0,h.G)(t.eye,i),l=2*a*s*1,c=2*a*o*1;return Le(e).toExtent(e,n,l,c)}function ct(e,t){return Le(e).toArea(e,t)}const ut=.7;function ht(e,t,i,r){return Le(e).lookAtTiltToEyeTilt(r,t,i)}function dt(e,t,i,r){return Le(e).eyeTiltToLookAtTilt(r,t,i)}function pt(e,t,i,r){if(null==t)return null;const n=e.renderSpatialReference,s=new f.Z({spatialReference:Ie(e)});return(0,_.f)(t.eye,n,s)?(r??=new o.Z,r.position=s,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):null}async function ft(e,t,i,r){const n=e.renderSpatialReference,s=new f.Z({spatialReference:Ie(e)});return await(0,_.A)(t.eye,n,s,{signal:r}),(0,u.k_)(r),new o.Z(s,t.heading,t.tilt,i)}function mt(e,t){const i=e.basemapTerrain?.tilingScheme;if(i)return i.levelAtScale(t);Se().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function gt(e,t){const i=e.basemapTerrain?.tilingScheme;if(i)return i.scaleAtLevel(t);Se().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}},20101:(e,t,i)=>{i.d(t,{H2:()=>d,dp:()=>u,t_:()=>h});var r=i(19431),n=i(86717),s=i(81095),o=i(56215),a=i(69430);const l=(0,s.Ue)(),c=(0,s.Ue)();function u(){return{direction:(0,s.Ue)(),up:(0,s.Ue)()}}function h(e,t,i,s,o){let a=(0,n.n)(l,e),u=(0,n.f)(a,s);const h=u>0;u=Math.abs(u),u>.99&&(u=Math.abs((0,n.f)(t,s)),u<.99?((0,n.c)(a,t),h&&(0,n.h)(a,a,-1)):a=null);let d=0;if(a){(0,n.h)(c,s,(0,n.f)(s,a)),(0,n.d)(a,a,c);const e=(0,n.f)(a,o)/((0,n.l)(a)*(0,n.l)(o));(0,n.e)(c,a,o),d=((0,n.f)(c,s)>0?1:-1)*(0,r.BV)((0,r.ZF)(e))}const p=(0,r.BV)((0,r.ZF)(-(0,n.f)(s,e)/(0,n.l)(e)));return i?(i.heading=d,i.tilt=p,i):{heading:d,tilt:p}}function d(e,t,i,r){(0,n.d)(p,i,t),(0,a.rx)(r,(0,o.re)(t,p),e)||e===i||(0,n.c)(e,i)}const p=(0,s.Ue)()},3289:(e,t,i)=>{i.d(t,{h:()=>l});var r=i(36663),n=i(74396),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,r._)([(0,s.Cb)()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"LABELS_SHOW_BORDER",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"TEXT_SHOW_BASELINE",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"TEXT_SHOW_BORDER",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"SHOW_POI",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"LINE_WIREFRAMES",void 0),a=(0,r._)([(0,o.j)("esri.views.3d.support.debugFlags")],a);const l=new a},20401:(e,t,i)=>{i.d(t,{Be:()=>l,Nf:()=>a,dF:()=>c});var r=i(19431),n=i(69442),s=i(10186);function o(e,t,i){if(null==t.longitude||null==t.latitude||null==i.longitude||null==i.latitude)throw new Error("Invalid points: no lon/lat");return function(e,t,i,n,s){const o=(0,r.Vl)(i),a=(0,r.Vl)(s),l=o-a,c=(0,r.Vl)(t)-(0,r.Vl)(n),u=Math.sin(l/2),h=Math.sin(c/2),d=2*(0,r.Kt)(Math.sqrt(u*u+Math.cos(o)*Math.cos(a)*h*h))*e;return Math.round(1e4*d)/1e4}(e,t.longitude,t.latitude,i.longitude,i.latitude)}function a(e,t,i){const r=t.spatialReference,a=(0,n.Iu)(r),l=new s.Z(t.x,e.y,r),c=new s.Z(i.x,e.y,r),u=new s.Z(e.x,t.y,r),h=new s.Z(e.x,i.y,r);return{lon:o(a.radius,l,c),lat:o(a.radius,u,h)}}function l(e,t,i){const n=t/i,s=(0,r.Vl)(e),o=Math.sin(n/2),a=Math.cos(s),l=2*(0,r.Kt)(Math.sqrt(o*o/(a*a)));return(0,r.BV)(l)}function c(e,t){const i=e?.[0];if(null==i)return null;t||(t={hours:0,minutes:0,seconds:0}),t.hours=function(e,t){let i=e/15;return t||(i=Math.round(i)),i}(i,!0);const r=t.hours%1;t.hours-=r,t.minutes=60*r;const n=t.minutes%1;return t.minutes-=n,t.seconds=Math.round(60*n),t}},6411:(e,t,i)=>{i.d(t,{LM:()=>d,M_:()=>u,OJ:()=>a,qO:()=>l,zA:()=>h});var r=i(48807),n=i(91907),s=i(43487),o=i(80479);const a=64,l=a/2,c=l/5,u=a/c,h=.25;function d(e,t){const i=(0,r.aJ)(e,a,l,c),u=new o.X;return u.internalFormat=n.VI.RGBA,u.width=a,u.height=a,u.wrapMode=n.e8.CLAMP_TO_EDGE,new s.x(t,u,i)}},48807:(e,t,i)=>{i.d(t,{ER:()=>c,Rg:()=>u,aJ:()=>d,cU:()=>h,hy:()=>l,wm:()=>a});i(39994);var r=i(73534),n=i(52721),s=i(44101),o=i(91907);const a=128,l=.5,c=(0,n.vV)(l/2,l/2,1-l/2,1-l/2);function u(e){return"cross"===e||"x"===e}function h(e,t=a,i=t*l,r=0){const n=d(e,t,i,r);return new s.x(n,{mipmap:!1,wrap:{s:o.e8.CLAMP_TO_EDGE,t:o.e8.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function d(e,t=a,i=t*l,r=0){switch(e){case"circle":default:return function(e,t){const i=e/2-.5;return y(e,m(i,i,t/2))}(t,i);case"square":return function(e,t){return p(e,t,!1)}(t,i);case"cross":return function(e,t,i=0){return f(e,t,!1,i)}(t,i,r);case"x":return function(e,t,i=0){return f(e,t,!0,i)}(t,i,r);case"kite":return function(e,t){return p(e,t,!0)}(t,i);case"triangle":return function(e,t){return y(e,g(e/2,t,t/2))}(t,i);case"arrow":return function(e,t){const i=t,r=t/2,n=e/2,s=.8*i,o=m(n,(e-t)/2-s,Math.sqrt(s*s+r*r)),a=g(n,i,r);return y(e,((e,t)=>Math.max(a(e,t),-o(e,t))))}(t,i)}}function p(e,t,i){return i&&(t/=Math.SQRT2),y(e,((r,n)=>{let s=r-.5*e+.25,o=.5*e-n-.75;if(i){const e=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=e}return Math.max(Math.abs(s),Math.abs(o))-.5*t}))}function f(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const n=.5*t;return y(e,((t,s)=>{let o,a=t-.5*e,l=.5*e-s-1;if(i){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),o=a>l?a>n?Math.sqrt((a-n)*(a-n)+l*l):l:l>n?Math.sqrt(a*a+(l-n)*(l-n)):a,o-=r/2,o}))}function m(e,t,i){return(r,n)=>{const s=r-e,o=n-t;return Math.sqrt(s*s+o*o)-i}}function g(e,t,i){const r=Math.sqrt(t*t+i*i);return(n,s)=>{const o=Math.abs(n-e)-i,a=s-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function y(e,t){const i=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let s=0;s<e;s++){const o=s+e*n;let a=t(s,n);a=a/e+.5,(0,r.I)(a,i,4*o)}return i}},76557:(e,t,i)=>{i.d(t,{G:()=>o,O:()=>s});var r=i(81095),n=i(22349);function s(e,t,i){if(null==e||null==i)return!1;let r=!0;return a[0]=null!=e.xmin?e.xmin:0,a[1]=null!=e.ymin?e.ymin:0,a[2]=null!=e.zmin?e.zmin:0,r=r&&(0,n.projectBuffer)(a,e.spatialReference,0,t,i,0),a[0]=null!=e.xmax?e.xmax:0,a[1]=null!=e.ymax?e.ymax:0,a[2]=null!=e.zmax?e.zmax:0,r=r&&(0,n.projectBuffer)(a,e.spatialReference,0,t,i,3),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),r}function o(e,t,i){if(null==e||null==i)return!1;let r=!0;return a[0]=null!=e.xmin?e.xmin:0,a[1]=null!=e.ymin?e.ymin:0,a[2]=null!=e.zmin?e.zmin:0,r=r&&(0,n.projectBuffer)(a,e.spatialReference,0,a,i,0),t[0]=a[0],t[1]=a[1],a[0]=null!=e.xmax?e.xmax:0,a[1]=null!=e.ymax?e.ymax:0,a[2]=null!=e.zmax?e.zmax:0,r=r&&(0,n.projectBuffer)(a,e.spatialReference,0,a,i,0),t[2]=a[0],t[3]=a[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),r}const a=(0,r.Ue)()},40460:(e,t,i)=>{i.d(t,{Bh:()=>u,eW:()=>d,iE:()=>h,j$:()=>l,u4:()=>c});var r=i(95550),n=i(36531),s=i(86717),o=i(97537),a=i(68817);function l(e,t,i=(0,o.Ue)()){return c(e,(0,r.md)(t),i),(0,s.n)(i.direction,i.direction),i}function c(e,t,i){return u(e,e.screenToRender(t,(0,r.Wv)(a.WM.get())),i)}function u(e,t,i){const o=(0,r.Wv)((0,n.JG)(a.WM.get(),t));if(o[2]=0,!e.unprojectFromRenderScreen(o,i.origin))return null;const l=(0,r.Wv)((0,n.JG)(a.WM.get(),t));l[2]=1;const c=e.unprojectFromRenderScreen(l,a.WM.get());return null==c?null:((0,s.d)(i.direction,c,i.origin),i)}function h(e,t,i){return d(e,e.screenToRender(t,(0,r.Wv)(a.WM.get())),i)}function d(e,t,i){(0,s.c)(i.origin,e.eye);const r=(0,s.i)(a.WM.get(),t[0],t[1],1),n=e.unprojectFromRenderScreen(r,a.WM.get());return null==n?null:((0,s.d)(i.direction,n,i.origin),i)}},51809:(e,t,i)=>{i.d(t,{K0:()=>S,qL:()=>b,us:()=>E,wX:()=>v});var r=i(80085),n=i(99118),s=i(95550),o=i(81095),a=i(10186),l=i(14685),c=i(49757),u=i(20375),h=i(54957),d=i(3289),p=i(66143),f=i(8927),m=i(20757),g=i(66218),y=i(84523),_=i(5073);async function v(e,t,i,r){const n=i?E(e,i):r,o=(0,s.s1)(t.x,t.y);n.requiresGroundFeedback=!0,n.enableDraped=!0;const a=(0,f.Z8)(e.state.viewingMode);a.options.selectionMode=!0,a.options.store=m.eC.ALL,e.sceneIntersectionHelper.intersectIntersectorScreen(o,a,n);const l=function(e,t,i){const r=new Array;let n=null;for(let s=0;s<t.length;s++){const o=t[s],a=(0,y.J4)(o,e);if(null!=a&&(a===e.map.ground||"type"in a&&(0,h.nx)(a.type)))break;const l=(0,y.bK)(o,e);if(null==l)continue;if("graphic"===l.type){if(null==n&&s!==t.length-1&&(n=new Set),null!=n){const e=x(l.graphic);if(n.has(e))continue;n.add(e)}if(!T(i,l.graphic))continue}const c=w(e,o),u=o.distanceInRenderSpace;if("media"===l.type){const e=l.element.toSource(c);r.push({...l,mapPoint:c,distance:u,sourcePoint:e})}else r.push({...l,mapPoint:c,distance:u})}return r}(e,a.results.all,n.graphics),c=a.results.ground,u=(0,y.J4)(c,e),p=null!=u&&"type"in u&&(0,h.nx)(u.type)?u:null,_={screenPoint:t,results:l,ground:{mapPoint:w(e,c),distance:(0,g.nn)(c)?c.distanceInRenderSpace:0,layer:p}};return d.h.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(_.intersector=a),_}function b(e,t,i,r){const n=i?E(e,i):r,o=!(!n.graphics?.include&&!n.graphics?.exclude),a=!(!n.mediaElements?.include&&!n.mediaElements?.exclude),l=(0,s.md)(t);n.enableDraped=n.include&&!n.include.has(_.xX)||n.exclude?.has(_.xX);const c=e.sceneIntersectionHelper,u=(0,f.Z8)(e.state.viewingMode);if(u.options.selectionMode=!0,u.options.store=o||a?m.eC.ALL:m.eC.MIN,u.options.excludeLabels=i?.excludeLabels??!1,c.intersectIntersectorScreen(l,u,n),o||a){for(const t of u.results.all){const i=(0,y.bK)(t,e);if(null==i)return w(e,t);if(o&&("graphic"!==i.type||T(n.graphics,i.graphic)))return w(e,t);if(a&&("media"!==i.type||C(n.mediaElements,i.element)))return w(e,t)}return null}return w(e,u.results.min)}function w(e,t,i){return t.getIntersectionPoint(R)?(i=S(e,R,i),t.intersector===m.q7.TERRAIN&&e.basemapTerrain&&(i.z=(0,p.KO)(e.basemapTerrain,i)??0),i):null}function x(e){const t=e.sourceLayer,i=e.layer,r=t&&"objectIdField"in t?t:i&&"objectIdField"in i?i:t;if(r){const t=r.objectIdField??u.d,i=e.attributes?.[t];if(i)return`o-${r.id}-${i}`}return`u-${e.uid}`}function T(e,t){return C(e,x(t))}function C(e,t){return null==e||(null==e.include||e.include.has(t))&&(null==e.exclude||!e.exclude.has(t))}function S(e,t,i){let r=e.spatialReference||l.Z.WGS84;return(0,c.S)(t,e.renderSpatialReference,R,r)?t=R:(r=l.Z.WGS84,(0,c.S)(t,e.renderSpatialReference,R,r)&&(t=R)),i?(i.x=t[0],i.y=t[1],i.z=t[2],i.spatialReference=r):i=new a.Z(t,r),i}function E(e,t){const i=M(e,t.include,O.INCLUDE),r=M(e,t.exclude,O.EXCLUDE);return{include:i.layerUids,exclude:r.layerUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function M(e,t,i,s={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!t)return s;if(t instanceof r.Z)(function(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)})(s,x(t)),i===O.INCLUDE&&(null!=e.graphicsView&&t.layer===e?A(s,e.graphicsView.processor.layer.id):t.layer&&A(s,t.layer.uid));else if("layer"in t&&"element"in t)(function(e,t){e.mediaElements||(e.mediaElements=new Set),e.mediaElements.add(t)})(s,t.element),i===O.INCLUDE&&A(s,t.layer.uid);else if((0,n.TW)(t))for(const r of t)r===e.graphics&&null!=e.graphicsView?A(s,e.graphicsView.processor.layer.id):r===e.map.ground?A(s,_.xX):M(e,r,i,s);else"uid"in t&&A(s,t.uid);return s}function A(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}const R=(0,o.Ue)();var O;!function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(O||(O={}))},25024:(e,t,i)=>{var r;i.d(t,{Bh:()=>r,NT:()=>s,Ty:()=>n}),function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"}(r||(r={}));const n=(()=>{const e=new Array;return e[r.ELEVATION]=10,e[r.BASEMAP]=10,e[r.I3S_INDEX]=10,e[r.I3S_DATA]=10,e[r.SYMBOLOGY]=5,e})(),s=30},18979:(e,t,i)=>{i.d(t,{W8:()=>l,kD:()=>a});var r=i(84164),n=i(86717),s=i(81095),o=i(69430);function a(e,t,i,r){return d(e,t,i,u(r,t,i,!0))}function l(e,t,i,r){const s=(0,n.f)(i,(0,n.d)(e,r,t));return(0,n.g)(e,t,(0,n.h)(e,i,s))}const c={dir:(0,s.Ue)(),len:0,clip:(0,r.Ue)()};function u(e,t,i,r){const s=c;return e?(i&&r&&(s.len=(0,n.j)(t,i)),(0,n.c)(s.dir,e)):r?(s.len=(0,n.j)(t,i),(0,n.d)(s.dir,i,t),(0,n.h)(s.dir,s.dir,1/s.len)):((0,n.d)(s.dir,i,t),(0,n.n)(s.dir,s.dir)),s}function h(e,t,i){const r=(0,n.f)((0,o.st)(e),i.dir),s=-(0,o.jH)(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const a=s/r;return r>0?a<i.clip[1]&&(i.clip[1]=a):a>i.clip[0]&&(i.clip[0]=a),i.clip[0]<=i.clip[1]}function d(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let i=0;i<e.length;i++)if(!h(e[i],t,r))return!1;return!0}},35369:(e,t,i)=>{i.d(t,{$U:()=>g,EU:()=>p,T:()=>l,ZA:()=>h,_F:()=>c,bX:()=>u,ek:()=>d,mw:()=>a,pG:()=>m,u1:()=>o,uV:()=>f});var r=i(19431),n=i(86717),s=i(81095);function o(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function a(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return(0,n.i)(e,i,r,s),e}function l(e,t,i){i=i||e;const r=(0,n.f)(e,t);(0,n.i)(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),(0,n.n)(i,i)}function c(e,t,i){Math.abs(e[0])>Math.abs(e[1])?(0,n.i)(t,0,1,0):(0,n.i)(t,1,0,0),(0,n.e)(i,e,t),(0,n.e)(t,i,e),(0,n.n)(i,i),(0,n.n)(t,t)}function u(e,t,i,r,n,s){const o=e+(t-e)*n;return o+(i+(r-i)*n-o)*s}function h(e,t,i,r=(0,s.Ue)()){const o=(0,n.l)(e),a=(0,n.l)(t),l=(0,n.f)(e,t)/(o*a);if(l<.9999999999999999){const s=Math.acos(l),c=((1-i)*o+i*a)/Math.sin(s),u=c/o*Math.sin((1-i)*s),h=c/a*Math.sin(i*s);return(0,n.h)(b,e,u),(0,n.h)(w,t,h),(0,n.g)(r,b,w)}return(0,n.m)(r,e,t,i)}function d(e,t,i,r=(0,s.Ue)(),o=(0,s.Ue)()){const a=(0,n.l)(e),l=(0,n.l)(t),c=(0,n.f)(e,t)/(a*l);if(c<.9999999999999999){const s=Math.acos(c),u=Math.sin(s),h=Math.sin(i*s),d=Math.sin((1-i)*s),p=(1-i)*a+i*l;{const i=p/u,s=i/l*h;(0,n.h)(b,e,i/a*d),(0,n.h)(w,t,s),(0,n.g)(r,b,w)}{const r=1/a*(-Math.cos((1-i)*s)*s*p+d*(-a+l));(0,n.h)(b,e,r);const c=1/l*(Math.cos(i*s)*s*p+h*(-a+l));(0,n.h)(w,t,c),(0,n.g)(o,b,w),(0,n.h)(o,o,1/u)}return o}return(0,n.m)(r,e,t,i),(0,n.d)(o,t,e),(0,n.n)(o,o),o}function p(e,t,i){e=(0,n.n)(b,e),t=(0,n.n)(w,t);const s=(0,r.ZF)((0,n.f)(e,t));if(i){const r=(0,n.e)(v,e,t);if((0,n.f)(r,i)<0)return-s}return s}function f(e){const t=e.length;return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const n=e[r-1][0],s=e[r][0],o=(s-i)/(s-n);return o*e[r-1][1]+(1-o)*e[r][1]}}function m(e,t,i,r){(0,n.d)(y,t,e),(0,n.d)(_,i,e),(0,n.e)(r,y,_),(0,n.n)(r,r),r[3]=-(0,n.f)(e,r)}function g(e,t){if((0,n.i)(t,0,0,0),e.length>0){for(let i=0;i<e.length;++i)(0,n.g)(t,t,e[i]);(0,n.h)(t,t,1/e.length)}}const y=(0,s.Ue)(),_=(0,s.Ue)(),v=(0,s.Ue)(),b=(0,s.Ue)(),w=(0,s.Ue)()},47850:(e,t,i)=>{i.d(t,{Oo:()=>be,Qb:()=>Me,gI:()=>Oe});var r=i(46332),n=i(3965),s=i(3308),o=i(1845),a=i(96303),l=i(86717),c=i(81095),u=i(56999),h=i(52721),d=i(69442),p=i(61170),f=i(7845),m=i(22349),g=i(12487),y=i(69430),_=i(35925),v=i(68817),b=i(65684),w=i(84164),x=i(85799);const T=1e-6,C=(0,c.Ue)(),S=(0,c.Ue)();function E(e,t,i,r,n,s,o,a,l,c){return function(e,t,i){let r=_e(e.maxVert[0],e.minVert[0]),n=0;for(let t=1;t<7;++t){const i=_e(e.maxVert[t],e.minVert[t]);i>r&&(r=i,n=t)}fe(t,e.minVert[n]),fe(i,e.maxVert[n])}(e,r,n),_e(r,n)<T?1:(de(o,r,n),ge(o,o),function(e,t,i,r){const{data:n,size:s}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let e=0;e<n.length;e+=s){F[0]=n[e]-t[0],F[1]=n[e+1]-t[1],F[2]=n[e+2]-t[2];const r=i[0]*F[0]+i[1]*F[1]+i[2]*F[2],s=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=F[0]*F[0]+F[1]*F[1]+F[2]*F[2]-r*r/s;l>o&&(o=l,a=e)}return fe(r,n,a),o}(t,r,o,s)<T?2:(de(a,n,s),ge(a,a),de(l,s,r),ge(l,l),me(i,a,o),ge(i,i),j(t,i,o,a,l,c),0))}const M=(0,c.Ue)(),A=(0,c.Ue)(),R=(0,c.Ue)(),O=(0,c.Ue)(),P=(0,c.Ue)(),I=(0,c.Ue)(),L=(0,c.Ue)(),D=(0,c.Ue)();function N(e,t,i,r,n,s,o,a,l){(function(e,t,i,r,n){!function(e,t,i,r,n){const{data:s,size:o}=e;fe(r,s),fe(n,r),i[0]=ve(Z,t),i[1]=i[0];for(let e=o;e<s.length;e+=o){const o=s[e]*t[0]+s[e+1]*t[1]+s[e+2]*t[2];o<i[0]&&(i[0]=o,fe(r,s,e)),o>i[1]&&(i[1]=o,fe(n,s,e))}}(e,t,U,n,r);const s=ve(i,t);U[1]-T<=s&&(r[0]=void 0),U[0]+T>=s&&(n[0]=void 0)})(e,t,i,M,A),void 0!==M[0]&&(de(R,M,i),ge(R,R),de(O,M,r),ge(O,O),de(P,M,n),ge(P,P),me(I,O,s),ge(I,I),me(L,P,o),ge(L,L),me(D,R,a),ge(D,D),j(e,I,s,O,R,l),j(e,L,o,P,O,l),j(e,D,a,R,P,l)),void 0!==A[0]&&(de(R,A,i),ge(R,R),de(O,A,r),ge(O,O),de(P,A,n),ge(P,P),me(I,O,s),ge(I,I),me(L,P,o),ge(L,L),me(D,R,a),ge(D,D),j(e,I,s,O,R,l),j(e,L,o,P,O,l),j(e,D,a,R,P,l))}const F=[0,0,0];const U=(0,w.Ue)();const k=(0,c.Ue)(),z=(0,c.Ue)(),B=(0,c.Ue)(),V=(0,c.Ue)(),H=(0,c.Ue)(),G=(0,c.Ue)();function j(e,t,i,r,n,s){if(ye(t)<T)return;me(k,i,t),me(z,r,t),me(B,n,t),q(e,t,U),H[1]=U[0],V[1]=U[1],G[1]=V[1]-H[1];const o=[i,r,n],a=[k,z,B];for(let i=0;i<3;++i){q(e,o[i],U),H[0]=U[0],V[0]=U[1],q(e,a[i],U),H[2]=U[0],V[2]=U[1],G[0]=V[0]-H[0],G[2]=V[2]-H[2];const r=ue(G);r<s.quality&&(fe(s.b0,o[i]),fe(s.b1,t),fe(s.b2,a[i]),s.quality=r)}}const Z=(0,c.Ue)();function q(e,t,i){const{data:r,size:n}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<r.length;e+=n){const n=r[e]*t[0]+r[e+1]*t[1]+r[e+2]*t[2];i[0]=Math.min(i[0],n),i[1]=Math.max(i[1],n)}}function W(e,t,i){i.center=e,i.halfSize=(0,l.h)(t,t,.5),i.quaternion=a.Wd}const $=(0,c.Ue)(),Y=(0,c.Ue)(),J=(0,c.Ue)(),X=(0,c.Ue)(),K=(0,c.Ue)(),Q=(0,c.Ue)();function ee(e,t,i){fe($,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?$[0]=0:Math.abs(t[1])>Math.abs(t[2])?$[1]=0:$[2]=0,ye($)<T&&($[0]=$[1]=$[2]=1),me(Y,t,$),ge(Y,Y),me(J,t,Y),ge(J,J),te(e,t,Y,J,X,K),de(Q,K,X),ae(t,Y,J,X,K,Q,i)}function te(e,t,i,r,n,s){q(e,t,U),n[0]=U[0],s[0]=U[1],q(e,i,U),n[1]=U[0],s[1]=U[1],q(e,r,U),n[2]=U[0],s[2]=U[1]}const ie=(0,c.Ue)(),re=(0,c.Ue)(),ne=(0,c.Ue)(),se=(0,n.al)(1,0,0,0,1,0,0,0,1),oe=(0,a.Ue)();function ae(e,t,i,r,n,s,o){se[0]=e[0],se[1]=e[1],se[2]=e[2],se[3]=t[0],se[4]=t[1],se[5]=t[2],se[6]=i[0],se[7]=i[1],se[8]=i[2],o.quaternion=function(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const r=(i+1)%3,n=(i+2)%3;let s=Math.sqrt(t[3*i+i]-t[3*r+r]-t[3*n+n]+1);e[i]=.5*s,s=.5/s,e[3]=(t[3*r+n]-t[3*n+r])*s,e[r]=(t[3*r+i]+t[3*i+r])*s,e[n]=(t[3*n+i]+t[3*i+n])*s}return e}(oe,se),he(ie,r,n),pe(ie,ie,.5),pe(re,e,ie[0]),pe(ne,t,ie[1]),he(re,re,ne),pe(ne,i,ie[2]),o.center=(0,l.g)(re,re,ne),o.halfSize=(0,l.h)(ie,s,.5)}class le{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7);this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let e=0;e<7;++e)this.minVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.maxVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.minProj[e]=Number.POSITIVE_INFINITY,this.maxProj[e]=Number.NEGATIVE_INFINITY;const i=new Array(7),r=new Array(7),{data:n,size:s}=e;for(let e=0;e<n.length;e+=s){let t=n[e];t<this.minProj[0]&&(this.minProj[0]=t,i[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,r[0]=e),t=n[e+1],t<this.minProj[1]&&(this.minProj[1]=t,i[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,r[1]=e),t=n[e+2],t<this.minProj[2]&&(this.minProj[2]=t,i[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,r[2]=e),t=n[e]+n[e+1]+n[e+2],t<this.minProj[3]&&(this.minProj[3]=t,i[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,r[3]=e),t=n[e]+n[e+1]-n[e+2],t<this.minProj[4]&&(this.minProj[4]=t,i[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,r[4]=e),t=n[e]-n[e+1]+n[e+2],t<this.minProj[5]&&(this.minProj[5]=t,i[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,r[5]=e),t=n[e]-n[e+1]-n[e+2],t<this.minProj[6]&&(this.minProj[6]=t,i[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,r[6]=e)}for(let e=0;e<7;++e){let t=i[e];fe(this.minVert[e],n,t),t=r[e],fe(this.maxVert[e],n,t)}}}class ce{constructor(){this.b0=(0,c.al)(1,0,0),this.b1=(0,c.al)(0,1,0),this.b2=(0,c.al)(0,0,1),this.quality=0}}function ue(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function he(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function de(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function pe(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function fe(e,t,i=0){e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2]}function me(e,t,i){const r=t[0],n=t[1],s=t[2],o=i[0],a=i[1],l=i[2];e[0]=n*l-s*a,e[1]=s*o-r*l,e[2]=r*a-n*o}function ge(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function ye(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function _e(e,t){const i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n}function ve(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}class be{constructor(e=c.AG,t=je,i=a.Wd){this._data=[e[0],e[1],e[2],t[0],t[1],t[2],i[0],i[1],i[2],i[3]]}clone(){const e=new be;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const t=new be;return t._data=e.slice(),t}static fromJSON(e){return new be(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return(0,l.i)(v.WM.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,i){this._data[0]=e,this._data[1]=t,this._data[2]=i}get halfSize(){return(0,l.i)(v.WM.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return(0,o.t8)(v.vD.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const t=we,i=this._data;t[0]=i[6],t[1]=i[7],t[2]=i[8],t[3]=i[9];for(let r=0;r<8;++r){const n=e[r];n[0]=(1&r?-1:1)*i[3],n[1]=(2&r?-1:1)*i[4],n[2]=(4&r?-1:1)*i[5],(0,l.w)(n,n,t),n[0]+=i[0],n[1]+=i[1],n[2]+=i[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],t=this._data[4],i=this._data[5];return Math.sqrt(e*e+t*t+i*i)}intersectSphere(e){Ce[0]=this._data[0]-e[0],Ce[1]=this._data[1]-e[1],Ce[2]=this._data[2]-e[2];const t=this.getQuaternion(xe);return(0,o.Kx)(we,t),(0,l.w)(Ce,Ce,we),(0,l.x)(Ce,Ce),Se[0]=Math.min(Ce[0],this._data[3]),Se[1]=Math.min(Ce[1],this._data[4]),Se[2]=Math.min(Ce[2],this._data[5]),(0,l.y)(Se,Ce)<e[3]*e[3]}intersectSphereWithMBS(e,t=this.radius){const i=this._data;Ce[0]=i[0]-e[0],Ce[1]=i[1]-e[1],Ce[2]=i[2]-e[2];const r=e[3],n=r+t;return!((0,l.z)(Ce)>n*n)&&(we[0]=-i[6],we[1]=-i[7],we[2]=-i[8],we[3]=i[9],(0,l.w)(Ce,Ce,we),(0,l.x)(Ce,Ce),Se[0]=Math.min(Ce[0],i[3]),Se[1]=Math.min(Ce[1],i[4]),Se[2]=Math.min(Ce[2],i[5]),(0,l.y)(Se,Ce)<r*r)}intersectPlane(e){const t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],i=this.projectedRadius((0,y.st)(e));return t>i?1:t<-i?-1:0}intersectRay(e,t,i=0){const r=this._data,n=we;n[0]=-r[6],n[1]=-r[7],n[2]=-r[8],n[3]=r[9],Ce[0]=e[0]-r[0],Ce[1]=e[1]-r[1],Ce[2]=e[2]-r[2];const s=(0,l.w)(Ce,Ce,we),o=(0,l.w)(Se,t,we);let a=-1/0,c=1/0;const u=this.getHalfSize(Ue);for(let e=0;e<3;e++){const t=s[e],r=o[e],n=u[e]+i;if(Math.abs(r)>1e-6){const e=(n-t)/r,i=(-n-t)/r;a=Math.max(a,Math.min(e,i)),c=Math.min(c,Math.max(e,i))}else if(t>n||t<-n)return!1}return a<=c}projectedArea(e,t,i,n){const s=this.getQuaternion(xe);(0,o.Kx)(we,s),Ce[0]=e[0]-this._data[0],Ce[1]=e[1]-this._data[1],Ce[2]=e[2]-this._data[2],(0,l.w)(Ce,Ce,we);const a=this.getHalfSize(Ue),c=Ce[0]<-a[0]?-1:Ce[0]>a[0]?1:0,h=Ce[1]<-a[1]?-1:Ce[1]>a[1]?1:0,d=Ce[2]<-a[2]?-1:Ce[2]>a[2]?1:0,p=Math.abs(c)+Math.abs(h)+Math.abs(d);if(0===p)return 1/0;const f=1===p?4:6,m=6*(c+3*h+9*d+13);(0,r.en)(ke,s),(0,r.bA)(ke,ke,a);const g=this.getCenter(Ne);for(let e=0;e<f;e++){const i=Re[m+e];(0,l.i)(Ce,((1&i)<<1)-1,(2&i)-1,((4&i)>>1)-1),(0,l.q)(Ce,Ce,ke),(0,l.g)(Ee,g,Ce),Ee[3]=1,(0,u.t)(Ee,Ee,t);const r=1/Math.max(1e-6,Ee[3]);Ae[2*e]=Ee[0]*r,Ae[2*e+1]=Ee[1]*r}const y=2*f-2;let _=Ae[0]*(Ae[3]-Ae[y+1])+Ae[y]*(Ae[1]-Ae[y-1]);for(let e=2;e<y;e+=2)_+=Ae[e]*(Ae[e+3]-Ae[e-1]);return Math.abs(_)*i*n*.125}projectedRadius(e){const t=this.getQuaternion(xe);return(0,o.Kx)(we,t),(0,l.w)(Ce,e,we),Math.abs(Ce[0]*this._data[3])+Math.abs(Ce[1]*this._data[4])+Math.abs(Ce[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius((0,y.st)(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius((0,y.st)(e))}toAaBoundingBox(e){const t=this.getQuaternion(xe),i=(0,r.en)(ke,t),n=this._data[3]*Math.abs(i[0])+this._data[4]*Math.abs(i[3])+this._data[5]*Math.abs(i[6]),s=this._data[3]*Math.abs(i[1])+this._data[4]*Math.abs(i[4])+this._data[5]*Math.abs(i[7]),o=this._data[3]*Math.abs(i[2])+this._data[4]*Math.abs(i[5])+this._data[5]*Math.abs(i[8]);e[0]=this._data[0]-n,e[1]=this._data[1]-s,e[2]=this._data[2]-o,e[3]=this._data[0]+n,e[4]=this._data[1]+s,e[5]=this._data[2]+o}transform(e,t,i,r=0,n=(0,p.rS)(i),s=(0,p.rS)(t),a=(0,g.R8)(t,s)){if(i===n)t.isGeographic?function(e,t,i,r,n=(0,p.rS)(i)){const s=(0,d.Iu)(i),a=1+Math.max(0,r)/(s.radius+e.centerZ);e.getCenter(De),De[2]+=r,(0,m.projectBuffer)(De,i,0,De,n,0),t.center=De;const c=e.getQuaternion(xe);t.quaternion=c,(0,o.Kx)(we,c),(0,l.i)(Ve,0,0,1),(0,l.w)(Ve,Ve,we);const u=e.getHalfSize(Ue);(0,l.i)(Ve,u[0]*Math.abs(Ve[0]),u[1]*Math.abs(Ve[1]),u[2]*Math.abs(Ve[2])),(0,l.h)(Ve,Ve,s.inverseFlattening),(0,l.g)(Ve,u,Ve),t.halfSize=(0,l.h)(Ve,Ve,a)}(this,e,t,r,s):function(e,t,i,r,n=(0,p.rS)(i),s=(0,g.R8)(i,n)){e.getCorners(Be),e.getCenter(De),De[2]+=r,(0,f.B)(i,De,ze,n),t.setCenter(ze[12],ze[13],ze[14]);const a=2*Math.sqrt(1+ze[0]+ze[5]+ze[10]);we[0]=(ze[6]-ze[9])/a,we[1]=(ze[8]-ze[2])/a,we[2]=(ze[1]-ze[4])/a,we[3]=.25*a;const c=e.getQuaternion(xe);t.quaternion=(0,o.Jp)(we,we,c),(0,o.Kx)(we,we),(0,l.i)(He,0,0,0);const u=t.getCenter(Fe);for(const e of Be)e[2]+=r,s(e,0,e,0),(0,l.a)(Ve,e,u),(0,l.w)(Ve,Ve,we),(0,l.x)(Ve,Ve),(0,l.D)(He,He,Ve);t.halfSize=He}(this,e,t,r,s,a);else if(t.isWGS84&&(i.isWebMercator||(0,_.QM)(i)))!function(e,t,i,r,n){t.getCenter(Ne),Ne[2]+=n;const s=(0,p.rS)(i);(0,m.projectBuffer)(Ne,e,0,Ne,s,0),Pe(s,t,Ne,i,r)}(t,this,i,e,r);else if(t.isWebMercator&&(0,_.QM)(i))!function(e,t,i,r,n){t.getCenter(Ne),Ne[2]+=n,Pe(e,t,Ne,i,r)}(t,this,i,e,r);else{const n=this.getCenter(Ne);n[2]+=r,(0,m.projectBuffer)(n,t,0,n,i,0),e.center=n,this!==e&&(e.quaternion=this.getQuaternion(xe),e.halfSize=this.getHalfSize(Ue))}}}const we=(0,a.Ue)(),xe=(0,a.Ue)(),Te=(0,a.Ue)(),Ce=(0,c.Ue)(),Se=(0,c.Ue)(),Ee=(0,h.Ue)();function Me(e,t=new be){return function(e,t){const{data:i,size:r}=e,n=i.length/r;if(n<=0)return;const s=new le(e);he(C,s.minProj,s.maxProj),pe(C,C,.5),de(S,s.maxProj,s.minProj);const o=ue(S),a=new ce;a.quality=o,n<14&&(e=new x.U(new Float64Array(s.buffer,112,42),3));const l=(0,c.Ue)(),u=(0,c.Ue)(),h=(0,c.Ue)(),d=(0,c.Ue)(),p=(0,c.Ue)(),f=(0,c.Ue)(),m=(0,c.Ue)();switch(E(s,e,m,l,u,h,d,p,f,a)){case 1:return void W(C,S,t);case 2:return void ee(e,d,t)}N(e,m,l,u,h,d,p,f,a),te(e,a.b0,a.b1,a.b2,X,K);const g=(0,c.Ue)();de(g,K,X),a.quality=ue(g),a.quality<o?ae(a.b0,a.b1,a.b2,X,K,g,t):W(C,S,t)}(e,t),t}const Ae=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],Re=(()=>{const e=new Int8Array(162);let t=0;const i=i=>{for(let r=0;r<i.length;r++)e[t+r]=i[r];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function Oe(e,t,i,r,n){const s=e.getQuaternion(xe);n.quaternion=s,(0,o.Kx)(we,s);const a=e.getCenter(Ne),u=e.getHalfSize(Ue);if(r===b.JY.Global){(0,l.w)(Ve,a,we),(0,l.x)(He,Ve),(0,l.A)(Ge,He,u),(0,l.a)(Ge,He,Ge);const r=(0,l.l)(Ge);(0,l.g)(Ge,He,u);const s=(0,l.l)(Ge);if(r<i)n.center=a,(0,l.i)(Ve,i,i,i),n.halfSize=(0,l.g)(Ve,u,Ve);else{const o=s>0?1+t/s:1,a=r>0?1+i/r:1,c=(a+o)/2,h=(a-o)/2;(0,l.h)(Ge,He,h),n.halfSize=(0,l.b)(Ge,Ge,u,c),(0,l.h)(Ge,He,c),(0,l.b)(Ge,Ge,u,h),(0,l.B)(Ve,Ve),(0,l.C)(Ve,Ge,Ve);const d=e.getQuaternion(Te);n.center=(0,l.w)(Ve,Ve,d)}}else{n.center=(0,l.b)(Ve,a,c.eG,(i+t)/2);const e=(0,l.w)(Ve,c.eG,we);(0,l.x)(e,e),n.halfSize=(0,l.b)(He,u,e,(i-t)/2)}return n}function Pe(e,t,i,n,s){const o=t.getQuaternion(xe),a=(0,r.en)(ke,o),l=t.getHalfSize(Ue);for(let e=0;e<8;++e){for(let t=0;t<3;++t)De[t]=l[t]*(e&1<<t?-1:1);for(let t=0;t<3;++t){let r=i[t];for(let e=0;e<3;++e)r+=De[e]*a[3*e+t];Ie[3*e+t]=r}}(0,m.projectBuffer)(Ie,e,0,Ie,n,0,8),Me(Le,s)}const Ie=new Array(24),Le=new x.U(Ie,3),De=(0,c.Ue)(),Ne=(0,c.Ue)(),Fe=(0,c.Ue)(),Ue=(0,c.Ue)(),ke=(0,n.Ue)(),ze=(0,s.Ue)(),Be=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Ve=(0,c.Ue)(),He=(0,c.Ue)(),Ge=(0,c.Ue)(),je=(0,c.vV)(-1,-1,-1)},82844:(e,t,i)=>{i.d(t,{VP:()=>l,rm:()=>c});var r=i(22349),n=i(92570),s=i(35413),o=i(63669),a=i(26646);function l(e,t,i,r){const a=(0,s.Ni)(e.rings,!!e.hasZ&&"on-the-ground"!==r.mode,s.ZI.CCW_IS_HOLE,e.spatialReference),l=(0,n.bg)(a.position.length),c=(0,o.rR)(a.position,e.spatialReference,0,l,0,a.position,0,a.position.length/3,t,i,r),d=null!=c;return new g(a.position,l,h(a.polygons,a.position,l),u(a.outlines,a.position,l),d,c)}function c(e,t){const i=(0,s.Ni)(e.rings,!1,s.ZI.CCW_IS_HOLE),n=(0,r.projectBuffer)(i.position,e.spatialReference,0,i.position,t,0);for(let e=2;e<i.position.length;e+=3)i.position[e]=a.gi;return{position:i.position,polygons:h(i.polygons,i.position),outlines:u(i.outlines,i.position),projectionSuccess:n}}function u(e,t,i=null){return e.filter((({count:e})=>e>1)).map((({index:e,count:r})=>{const s=3*e,o=3*r;return null!=i?new p(e,r,(0,n.Rq)(t,s,o),(0,n.Rq)(i,s,o)):new d(e,r,(0,n.Rq)(t,s,o))}))}function h(e,t,i=null){const r=new Array;for(const{index:s,count:o,holeIndices:a,pathLengths:l}of e){if(o<=1)continue;const e=3*s,c=3*o,u=a.map((e=>e-s)),h=null!=i?new f(s,o,(0,n.Rq)(t,3*s,3*o),(0,n.Rq)(i,e,c),u,l):new m(s,o,(0,n.Rq)(t,3*s,3*o),u,l);r.push(h)}return r}class d{constructor(e,t,i){this.index=e,this.count=t,this.position=i}}class p extends d{constructor(e,t,i,r){super(e,t,i),this.mapPositions=r}}class f extends p{constructor(e,t,i,r,n,s){super(e,t,i,r),this.holeIndices=n,this.pathLengths=s}}class m extends d{constructor(e,t,i,r,n){super(e,t,i),this.holeIndices=r,this.pathLengths=n}}class g{constructor(e,t,i,r,n,s){this.position=e,this.mapPositions=t,this.polygons=i,this.outlines=r,this.projectionSuccess=n,this.sampledElevation=s}}},65401:(e,t,i)=>{i.d(t,{M:()=>n,O:()=>s});var r=i(35925);function n(e){return s(e)||(0,r.BZ)(e)||(0,r.V2)(e)}function s(e){return(0,r.oR)(e)||(0,r.yW)(e)}},57686:(e,t,i)=>{i.d(t,{V:()=>r,q:()=>n});const r={value:.5,readOnly:!0},n={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}}},87564:(e,t,i)=>{i.d(t,{T6:()=>a,TX:()=>o,j9:()=>l});var r=i(20757),n=i(10774),s=i(66218);function o(e){return(0,s.nn)(e)&&e.intersector===r.q7.TERRAIN&&!!e.target}class a extends n.Dx{constructor(e,t,i){super(e,t),this.triangleNr=i}}function l(e){return(0,s.nn)(e)&&e.intersector===r.q7.OVERLAY&&!!e.target}},23147:(e,t,i)=>{var r;i.d(t,{X:()=>r}),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(r||(r={}))},33401:(e,t,i)=>{var r;i.d(t,{D:()=>r}),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(r||(r={}))},26646:(e,t,i)=>{i.d(t,{CB:()=>re,gi:()=>oe,Qi:()=>ae});var r=i(36663),n=i(31355),s=(i(39994),i(86114)),o=i(61681),a=i(17135),l=i(76868),c=i(19784),u=i(81977),h=(i(13802),i(4157),i(40266)),d=i(32114),p=i(86717),f=i(81095),m=i(43977),g=i(3289),y=i(9812),_=i(24568),v=i(58781);class b{constructor(){this._extent=(0,_.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,v.a)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new w}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryView();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,_.cv)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,_.cv)(this._extent,-e.range,0,t)}}setupGeometryView(){this.canvasGeometries.numViews=1,(0,_.JG)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class w{constructor(){this.extents=[(0,_.Ue)(),(0,_.Ue)(),(0,_.Ue)()],this.numViews=0}}var x=i(33401);class T{constructor(e,t,i){this._fbos=e,this._format=t,this._name=i}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=(0,o.RY)(this._handle)}get texture(){return this._handle?.getTexture()}bind(e,t,i){this._handle&&this._handle.fbo?.width===t&&this._handle.fbo?.height===i||(this._handle?.release(),this._handle=this._fbos.acquire(t,i,this._name,this._format)),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}}var C=i(37503),S=i(35031),E=i(43338);class M{constructor(e,t,i,r,n=C.q.RGBA_MIPMAP){this.output=i,this.content=r,this.fbo=new T(e,n,t)}get valid(){return this.fbo.valid}}class A{constructor(e){this.targets=[new M(e,"overlay color",S.H_.Color,x.D.Color),new M(e,"overlay IM color",S.H_.Color,x.D.ColorNoRasterImage),new M(e,"overlay highlight",S.H_.Highlight,x.D.Highlight,C.q.RG),new M(e,"overlay water",S.H_.Normal,x.D.WaterNormal),new M(e,"overlay occluded",S.H_.Color,x.D.Occluded)],(0,E.B)()&&this.targets.push(new M(e,"overlay olid",S.H_.ObjectAndLayerIdColor,x.D.ObjectAndLayerIdColor,C.q.RGBA))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,i)=>t.valid?e|=1<<i:e),0)}}var R=i(5512),O=i(97582),P=i(86243),I=i(36935),L=i(2914),D=i(70984),N=i(55982),F=i(53464),U=i(7358),k=i(97994),z=i(4051),B=i(46378),V=i(95524),H=i(9969),G=i(62575),j=i(17346);class Z extends G.A{constructor(e,t){super(e,t,new H.J(P.a,(()=>i.e(44587).then(i.bind(i,44587)))))}initializePipeline(e){return e.hasAlpha?(0,j.sm)({blending:j.Dh,colorWrite:j.gf}):(0,j.sm)({colorWrite:j.gf})}}var q=i(12907);class W extends q.m{constructor(){super(...arguments),this.hasAlpha=!1}}(0,r._)([(0,q.o)()],W.prototype,"hasAlpha",void 0);var $=i(11722),Y=i(53448),J=i(23627),X=i(30915);class K extends G.A{constructor(e,t){super(e,t,new H.J(X.a,(()=>i.e(37438).then(i.bind(i,37438)))))}}var Q=i(22167),ee=i(91907),te=i(43487),ie=i(80479);let re=class extends I.tY{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new X.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new a.Z,this._passParameters=new P.T,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new R.Z,this.events=new n.Z,this.longitudeCyclical=null,this.produces=new Map([[B.r.DRAPED_MATERIAL,e=>e!==S.H_.Highlight||this.hasHighlights],[B.r.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this._view,t=e._stage,i=t.renderer.fboCache,{waterTextures:r,textures:n}=t.renderView;this._renderContext=new z.Yh(this._rctx,new V.l(i,e.state.viewingMode)),this.addHandles([(0,l.watch)((()=>r.updating),(()=>this.events.emit("content-changed")),l.syncAndInitial),(0,l.watch)((()=>this.spatialReference),(e=>this._localOriginFactory=new F.C(e)),l.syncAndInitial),(0,l.on)((()=>e.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0)),(0,l.watch)((()=>(0,L.yp)(e.state.highlights)),(()=>this._sortedDrapeSourceRenderersDirty=!0),l.initial),(0,l.watch)((()=>e.state.highlights),(t=>{this._bindParameters.highlights=t,this._bindParameters.highlightOrderMap=e.state.highlightOrderMap,this._updateHighlights()}),l.initial),e.resourceController.scheduler.registerTask(Q.T8.STAGE,this)]),this._materials=new N.h(n,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed")));const{_bindParameters:s,_camera:o}=this;o.near=1,o.far=1e4,o.relativeElevation=null,s.slot=B.r.DRAPED_MATERIAL,s.mainDepth=null,s.camera=o,s.oitPass=k.M.NONE,s.updateLighting([new J.Mi((0,f.iU)())],0,0,$.B.Immediate)}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._passParameters.texture=(0,o.M2)(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view._stage}get spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){this._pluginContext=e,this._techniques.precompile(K)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,s.oE)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(e){for(const t of this._renderers.values()){const i=t.getMaterialRenderer(e);if(i)return i}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}_updateHighlights(){const e=this._view.state;this._renderers.forEach((t=>t.updateHighlights(e.highlightOrderMap)))}createDrapeSourceRenderer(e,t,i){const r=this._renderers.get(e);null!=r&&r.destroy();const n=new t({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,l.watch)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),n}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,c.fn)(e,(e=>e.drapeTargetType===m.al.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,c.fn)(e,(e=>e.drapeSourceType===m.Lw.Features)),this._hasDrapedRasterSource=(0,c.fn)(e,(e=>e.drapeSourceType===m.Lw.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t,i=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new A(this._stage.renderer.fboCache),this._overlays=[new b,new b]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=i}disposeOverlays(){this._overlays=null,this._renderTargets=(0,o.M2)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(null!=e)return e===x.D.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(x.D.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let i=!1;for(const[r,n]of this._renderers){if(e.done)break;(r.destroyed||t(r))&&n.commitChanges(this._view.state.highlightOrderMap)&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,s.oE)(this._renderers,(e=>e.hasHighlights)),this.notifyChange("rendersOccludedDraped"))}hasHighlightOptions(e){return(0,s.oE)(this._renderers,(t=>t.hasHighlightOptions(e)))}processSyncDrapeSources(){this._processDrapeSources(Q.G5,(e=>e.updatePolicy===Y.j.SYNC))}get isEmpty(){return!g.h.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,s.oE)(this._renderers,(e=>!e.isEmpty))}get hasWater(){const e=(0,s.oE)(this._renderers,(e=>e.hasWater));return e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water")),this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=ae,++this._techniques.precompiling;const t=this._sortedRenderers.some((({renderer:e})=>e.precompile(this._renderContext)));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,t}renders(e){if(g.h.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==x.D.Occluded&&e!==x.D.Highlight)return!0;++this._techniques.precompiling;const t=this._sortedRenderers.some((({renderer:e})=>e.precompile(this._renderContext)));return--this._techniques.precompiling,t}get mode(){return this.isEmpty?O.gT.Disabled:this.hasWater&&this.renders(x.D.WaterNormal)?O.gT.EnabledWithWater:this._renderTargets?.getTexture(x.D.Color)?O.gT.Enabled:O.gT.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((i=>t=i.updateAnimation(e)||t)),t&&this.parent.requestRender(D.Xx.BACKGROUND),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(this._renderTargets){this._bindParameters.alignPixelEnabled=e.alignPixelEnabled,++this._techniques.precompiling;for(const e of this._renderTargets.targets){if(e.content===x.D.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const t=e.output;this._renderContext.output=t,this._bindParameters.slot=t===S.H_.Normal?B.r.DRAPED_WATER:B.r.DRAPED_MATERIAL,e.content===x.D.Occluded&&(this._renderContext.renderOccludedMask=ae),this._sortedRenderers.forAll((({drapeSource:t,renderer:i})=>{e.content===x.D.ColorNoRasterImage&&t.drapeSourceType===m.Lw.RasterImage||i.precompile(this._renderContext)})),this._renderContext.renderOccludedMask=z.C9}--this._techniques.precompiling}}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryView();this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const e of this._renderTargets.targets){if(e.content===x.D.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const t=this._drawTarget(y.fu.INNER,e),i=this._drawTarget(y.fu.OUTER,e);(t||i)&&e.fbo.generateMipMap()}}}_drawTarget(e,t){const i=this._overlays[e],r=i.canvasGeometries;if(0===r.numViews)return!1;const n=this._view.state.contentPixelRatio;this._screenToWorldRatio=n*i.mapUnitsPerPixel/this._bindParameters.overlayStretch;const s=t.output;if(this.isEmpty||s===S.H_.Normal&&!this.hasWater||!i.hasSomeSizedView())return!1;const{_rctx:o,_camera:a,_renderContext:l,_bindParameters:c}=this;if(a.pixelRatio=i.pixelRatio*n,l.output=s,c.screenToWorldRatio=this._screenToWorldRatio,c.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,c.slot=s===S.H_.Normal?B.r.DRAPED_WATER:B.r.DRAPED_MATERIAL,t.content===x.D.Occluded&&(l.renderOccludedMask=ae),!this.renders(t.content))return l.renderOccludedMask=z.C9,!1;const{resolution:u}=i,h=e===y.fu.INNER?0:u;if(o.setViewport(h,0,u,u),this._bindTargetFBO(t),e===y.fu.INNER&&(o.setClearColor(0,0,0,0),o.clear(ee.Hf.COLOR)),g.h.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==x.D.Occluded&&t.content!==x.D.Highlight){this._techniques.precompile(Z,le);const t=this._techniques.get(Z,le);for(let n=0;n<r.numViews;n++)this._setViewParameters(r.extents[n],i),this._ensureDebugPatternResources(i.resolution,se[e]),o.bindTechnique(t,c,this._passParameters),o.screen.draw()}if(t.output===S.H_.Highlight){const{fboCache:i}=this._stage.renderer,r=this._resolution;this._bindTargetFBO(t),(0,L.m7)(o,i,{width:r,height:r},c,(()=>this._renderAllGeometry(e,t)),h)}else this._renderAllGeometry(e,t);return o.bindFramebuffer(null),l.renderOccludedMask=z.C9,!0}_renderAllGeometry(e,t){const i=this._overlays[e],r=i.canvasGeometries;this._sortedRenderers.forAll((({drapeSource:n,renderer:s})=>{if(t.content===x.D.ColorNoRasterImage&&n.drapeSourceType===m.Lw.RasterImage)return;const{fullOpacity:o}=n,a=null!=o&&o<1&&t.output===S.H_.Color&&this._bindTemporaryFBO();for(let e=0;e<r.numViews;e++)this._setViewParameters(r.extents[e],i),s.render(this._renderContext);if(a){this._bindTargetFBO(t),this._overlayParameters.texture=a.getTexture(),this._overlayParameters.opacity=o,this._overlayParameters.overlayIndex=e;const i=this._techniques.get(K);this._rctx.bindTechnique(i,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),a.release()}}))}_bindTargetFBO(e){const t=this._resolution,i=2*t;e.fbo.bind(this._rctx,i,t)}_bindTemporaryFBO(){const e=this._resolution,t=2*e,i=this._stage.renderer.fboCache,r=i.acquire(t,e,"overlay tmp");return i.rctx.bindFramebuffer(r.fbo),i.rctx.clear(ee.Hf.COLOR),r}get _resolution(){return this._overlays?.[y.fu.INNER].resolution??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:s}of this._sortedRenderers)n=s.intersect?.(e,t,i,r,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this._view.map.allLayers,t=e.length;this._renderers.forEach(((i,r)=>{const n=e.indexOf(r.layer),s=n>=0,o=r.renderGroup??(s?m.eZ.MapLayer:m.eZ.ViewLayer),a=t*o+(s?n:0);this._sortedRenderers.push(new ne(r,i,a))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const i=this._camera;i.viewport=[0,0,t.resolution,t.resolution],(0,d.M5)(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),(0,d.vc)(i.viewMatrix,[-e[0],-e[1],0])}_ensureDebugPatternResources(e,t){if((0,p.i)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let r=0;for(let t=0;t<e;t++)for(let n=0;n<e;n++){const s=Math.floor(n/10),o=Math.floor(t/10);s<2||o<2||10*s>e-20||10*o>e-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&s&&1&o?1&n^1&t?0:255:1&s^1&o?0:128)}const n=new ie.X(e);n.samplingMode=ee.cw.NEAREST,this._passParameters.texture=new te.x(this._rctx,n,i)}get test(){}};(0,r._)([(0,u.Cb)()],re.prototype,"hasHighlights",void 0),(0,r._)([(0,u.Cb)()],re.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],re.prototype,"parent",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],re.prototype,"_techniques",null),(0,r._)([(0,u.Cb)({type:Boolean,readOnly:!0})],re.prototype,"updating",null),(0,r._)([(0,u.Cb)()],re.prototype,"isEmpty",null),(0,r._)([(0,u.Cb)({readOnly:!0})],re.prototype,"rendersOccludedDraped",null),re=(0,r._)([(0,h.j)("esri.views.3d.terrain.OverlayRenderer")],re);class ne{constructor(e,t,i){this.drapeSource=e,this.renderer=t,this.index=i}}const se=[[1,.5,.5],[.5,.5,1]],oe=-2,ae=U.yD.OccludeAndTransparent,le=new W;le.hasAlpha=!0},57410:(e,t,i)=>{var r;i.d(t,{z:()=>r}),function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"}(r||(r={}))},54565:(e,t,i)=>{i.d(t,{$X:()=>o,C5:()=>p,Cf:()=>a,GZ:()=>u,JR:()=>d,if:()=>l,p1:()=>f,qC:()=>m,uU:()=>h,zl:()=>c});var r=i(19431),n=i(24568),s=i(56545);const o=64,a=512,l=2.5,c=(0,r.oK)(r.F3/10),u=2,h=(0,n.Ue)();s.t.WebMercatorAuxiliarySphere.getExtent(0,0,0,h);const d=(0,n.Ue)([-180,-90,180,90]),p="Cannot extend surface to encompass all layers because it would result in too many root tiles.",f="Surface extent is too large for tile resolution at level 0.",m=4},11107:(e,t,i)=>{function r(e){return null!=e&&"type"in e&&"vector-tile"===e.type}function n(e){return null!=e&&"type"in e&&"raster-tile"===e.type}function s(e){return null!=e&&"type"in e&&"tile-texture"===e.type}function o(e){return null!=e&&"type"in e&&"image+type"===e.type}i.d(t,{AK:()=>r,Cm:()=>o,Q_:()=>s,yd:()=>n})},56545:(e,t,i)=>{i.d(t,{_:()=>m,t:()=>f});var r=i(70375),n=(i(39994),i(19431)),s=i(17321),o=i(91772),a=i(10186),l=i(14685),c=i(24568),u=i(35925),h=i(39536),d=i(13054),p=i(81590);class f{constructor(e){const t=f.checkUnsupported(e);if(null!=t)throw t;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=(0,u.sT)(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const r=i.lods.reduce(((e,t)=>(t.level<e.minLod.level&&(e.minLod=t),e.max=Math.max(e.max,t.level),e)),{minLod:i.lods[0],max:-1/0}),n=r.minLod,s=2**n.level;let o=n.resolution*s,a=n.scale*s;this.levels=new Array(r.max+1);for(let e=0;e<this.levels.length;e++)this.levels[e]={resolution:o,scale:a,tileSize:[o*i.size[0],o*i.size[1]]},o/=2,a/=2}clone(){return new f(this.toTileInfo())}toTileInfo(){return new p.Z({dpi:this.dpi,origin:new a.Z({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((e,t)=>new d.Z({level:t,scale:e.scale,resolution:e.resolution})))})}getExtent(e,t,i,r){const n=this.levels[e],s=n.tileSize[0],o=n.tileSize[1];r[0]=this.origin[0]+i*s,r[2]=this.origin[0]+(i+1)*s,r[3]=this.origin[1]-t*o,r[1]=this.origin[1]-(t+1)*o}convertExtentToRadians(e,t){this._isWebMercator?(t[0]=(0,h.tp)(e[0]),t[1]=(0,h.mZ)(e[1]),t[2]=(0,h.tp)(e[2]),t[3]=(0,h.mZ)(e[3])):this._isGCS&&(t[0]=(0,n.Vl)(e[0]),t[1]=(0,n.Vl)(e[1]),t[2]=(0,n.Vl)(e[2]),t[3]=(0,n.Vl)(e[3]))}getExtentGeometry(e,t,i,r=new o.Z){return this.getExtent(e,t,i,g),r.spatialReference=this.spatialReference,r.xmin=g[0],r.ymin=g[1],r.xmax=g[2],r.ymax=g[3],r.zmin=void 0,r.zmax=void 0,r}ensureMaxLod(e){if(null==e)return!1;let t=!1;for(;this.levels.length<=e;){const{resolution:e,scale:i}=this.levels[this.levels.length-1],r=e/2*this.pixelSize;this.levels.push({resolution:e/2,scale:i/2,tileSize:[r,r]}),t=!0}return t}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,t=1/0){if(f.checkUnsupported(e))return!1;const i=new f(e);if(!i.spatialReference.equals(this.spatialReference))return!1;if(i.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length-1,i.levels.length-1,t),s=this.levels[r].resolution;let o=.5*s;return!(!(0,n.W8)(i.origin[0],this.origin[0],o)||!(0,n.W8)(i.origin[1],this.origin[1],o))&&(o=.5*s/2**r/this.pixelSize*12,(0,n.W8)(s,i.levels[r].resolution,o))}rootTilesInExtent(e,t=null,i=1/0){const r=new Array,n=this.levels[0].tileSize;if(null==e||0===n[0]||0===n[1])return r;f.computeRowColExtent(e,n,this.origin,g);let s=g[1],o=g[3],a=g[0],l=g[2];const c=l-a,u=o-s;if(c*u>i){const e=Math.floor(Math.sqrt(i));u>e&&(s=s+Math.floor(.5*u)-Math.floor(.5*e),o=s+e),c>e&&(a=a+Math.floor(.5*c)-Math.floor(.5*e),l=a+e)}for(let e=s;e<o;e++)for(let t=a;t<l;t++)r.push([0,e,t]);return null!=t&&(t[0]=this.origin[0]+a*n[0],t[1]=this.origin[1]-o*n[1],t[2]=this.origin[0]+l*n[0],t[3]=this.origin[1]-s*n[1]),r}static computeRowColExtent(e,t,i,r){const n=.001*(e[2]-e[0]+(e[3]-e[1]));r[0]=Math.max(0,Math.floor((e[0]+n-i[0])/t[0])),r[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/t[0])),r[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/t[1])),r[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/t[1]))}static isPowerOfTwo(e){const t=e.lods,i=t[0].resolution*2**t[0].level;return!t.some((e=>!(0,n.Y8)(e.resolution,i/2**e.level)))}static hasGapInLevels(e){const t=e.lods.map((e=>e.level));t.sort(((e,t)=>e-t));for(let e=1;e<t.length;e++)if(t[e]!==t[0]+e)return!0;return!1}static tileSizeSupported(e){const t=e.size[1];return t===e.size[0]&&!(t&t-1)&&t>=128&&t<=512}static hasOriginPerLODs(e){const t=e.origin;return e.lods.some((e=>null!=e.origin&&(e.origin[0]!==t.x||e.origin[1]!==t.y)))}static getMissingTileInfoError(){return new r.Z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return null==e?m():e.lods.length<1?new r.Z("tilingscheme:generic","Tiling scheme must have at least one level"):f.isPowerOfTwo(e)?f.hasGapInLevels(e)?new r.Z("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):f.tileSizeSupported(e)?f.hasOriginPerLODs(e)?new r.Z("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new r.Z("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new r.Z("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,t){const i=e[2]-e[0],r=e[3]-e[1],n=(0,s.c9)(t),o=1.2*Math.max(i,r),l=o/256,c=l*n*(96/.0254),u=new f(new p.Z({size:[256,256],origin:new a.Z({x:e[0]-.5*(o-i),y:e[3]+.5*(o-r)}),lods:[new d.Z({level:0,resolution:l,scale:c})],spatialReference:t}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const t=new f(f.WebMercatorAuxiliarySphereTileInfo);return t.ensureMaxLod(e),t}static makeGCSWithTileSize(e,t=256,i=16){const r=256/t,n=new f(new p.Z({size:[t,t],origin:new a.Z({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new d.Z({level:0,resolution:.703125*r,scale:295497598.570834*r})]}));return n.ensureMaxLod(i),n}get test(){}}function m(){return new r.Z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}f.WebMercatorAuxiliarySphereTileInfo=new p.Z({size:[256,256],origin:new a.Z({x:-20037508.342787,y:20037508.342787,spatialReference:l.Z.WebMercator}),spatialReference:l.Z.WebMercator,lods:[new d.Z({level:0,resolution:156543.03392800014,scale:591657527.591555})]}),f.WebMercatorAuxiliarySphere=f.makeWebMercatorAuxiliarySphere(19);const g=(0,c.Ue)()},51428:(e,t,i)=>{var r;i.d(t,{w:()=>r}),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.InvisibleWithDraped=2]="InvisibleWithDraped",e[e.Invisible=3]="Invisible",e[e.COUNT=4]="COUNT"}(r||(r={}))},9812:(e,t,i)=>{var r,n,s;i.d(t,{Ns:()=>s,fu:()=>r,tk:()=>n}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(r||(r={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(n||(n={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(s||(s={}))},13809:(e,t,i)=>{i.d(t,{Wq:()=>W,er:()=>B,qA:()=>w,T9:()=>_,HK:()=>b,V0:()=>v,O1:()=>H,E_:()=>V,Fp:()=>x,TK:()=>O,Eu:()=>Q,_1:()=>A,a_:()=>R,S3:()=>F,sR:()=>C,Ay:()=>L,GL:()=>P,Mw:()=>te,wt:()=>X,x4:()=>T,uv:()=>ee,wP:()=>I,z7:()=>N,Q:()=>E,B9:()=>U,Ke:()=>D,OD:()=>K,_0:()=>J,sP:()=>Z,cA:()=>re,OC:()=>ie,$v:()=>$,_F:()=>Y,ep:()=>k,Bu:()=>j,FZ:()=>z,zT:()=>q,jO:()=>G,wu:()=>y});var r=i(41831),n=i(35925),s=i(54957),o=i(65684),a=i(23147),l=i(11107),c=i(70375),u=i(24568),h=i(65401),d=i(54565),p=i(56545);const f=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function(e,t,i,r){if(null==e)return(0,p._)();const n=e.spatialReference;if(n.isGeographic&&!(0,h.O)(n))return new c.Z("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const s=p.t.checkUnsupported(e);if(null!=s)return s;if(null==i)return new c.Z("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const o=function(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,n=[r*e.size[0],r*e.size[1]],s=[e.origin.x,e.origin.y],o=(0,u.oJ)(t),a=(0,u.Ue)();p.t.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>d.$X){const t=i[0].scale*2**i[0].level;let n=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*t/r;const s=Math.floor(Math.log(n)/Math.log(10));return n=Math.ceil(n/10**s)*10**s,new c.Z("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(t).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+n.toLocaleString()+".",{level0Scale:t,suggestedLevel0Scale:n,requiredNumRootTiles:l,allowedNumRootTiles:d.$X})}return null}(e,i);return o||(null==t||n.equals(t)||t.isWGS84&&n.isWebMercator?null:new c.Z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"))}},Symbol.toStringTag,{value:"Module"}));const m=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function(e,t,i,r){if(null==e)return(0,p._)();const n=e?.lods.length-1,s=e.spatialReference;if(s.isWebMercator){if(!p.t.makeWebMercatorAuxiliarySphere(n).compatibleWith(e,r))return new c.Z("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!(0,h.M)(s))return new c.Z("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!p.t.makeGCSWithTileSize(e.spatialReference,e.size[0],n).compatibleWith(e,r))return e.spatialReference.isWGS84?new c.Z("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new c.Z("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return null==t||e.spatialReference.equals(t)?null:new c.Z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}},Symbol.toStringTag,{value:"Module"})),g={[o.JY.Global]:m,[o.JY.Local]:f};function y(e,t){e||console.warn("Terrain: "+t)}let _=!1,v=!1;function b(e){v=e,_=_||e}function w(e){_=e}function x(e,t){if(_&&!e){const e=(new Error).stack?.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+e),new Error("Assertion failed"+(t?": "+t:""))}}function T(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function C(e){return"imagery-tile-3d"===e?.type}function S(e){return"tile-3d"===e?.type}function E(e){return"vector-tile-3d"===e?.type}function M(e){return"wmts-3d"===e?.type}function A(e){return"elevation-3d"===e?.type}function R(e){return"group"===e?.type}function O(e){return e&&(S(e)||M(e)||C(e)||E(e))}function P(e){return e&&(S(e)||C(e)||E(e)||M(e))}function I(e){return P(e)||A(e)}function L(e){return(0,l.yd)(e?.sourceLayerInfo?.data)}function D(e){return U(e?.sourceLayerInfo)||!!e?.isVTLBackground}function N(e){return(0,l.Q_)(e?.sourceLayerInfo?.data)}function F(e){const t=e?.sourceLayerInfo?.data;return(0,l.Cm)(t)||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData}function U(e){return(0,l.AK)(e?.data)}function k(e){return null!=e&&"release"in e&&e.release(),null}function z(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function B(e,t,i,r,n){return g[r].checkIfTileInfoSupportedForViewSR(e,i,t,n)}function V(e,t,i){let r=null,n=null;if("wmts"===e?.type){const s=H(e,t,i);r=s.tileInfo,n=s.fullExtent}else{n=T(e)?e.getCompatibleFullExtent(t):e.fullExtent;const s=i===o.JY.Local;r=T(e)?e.getCompatibleTileInfo(t,n,s):"vector-tile"===e?.type?s&&!G(t)||j.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):e.tileInfo}const s="tilemapCache"in e?e.tilemapCache?.effectiveMaxLOD:void 0;return null!=r&&null!=n&&null==B(r,n,t,i,s)?{tileInfo:r,fullExtent:n}:null}function H(e,t,i){const n=(0,s.mt)(e);if(null!=n){if(!r.Z.isCollection(n))return{tileInfo:n.tileInfo,fullExtent:n.fullExtent};{const e=n.find((e=>null==B(e.tileInfo,e.fullExtent,t,i)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}function G(e){return e.isWGS84||e.isWebMercator||(0,n.yW)(e)||!(0,n.N$)(e)}const j={force512VTL:!1};function Z(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function q(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function W(e,t,i=ne){return Math.abs(e-t)<i}function $(e){return e===a.X.NORTH_EAST?a.X.SOUTH_WEST:e===a.X.NORTH_WEST?a.X.SOUTH_EAST:e===a.X.SOUTH_WEST?a.X.NORTH_EAST:a.X.NORTH_WEST}function Y(e){return e===a.X.NORTH?a.X.SOUTH:e===a.X.EAST?a.X.WEST:e===a.X.SOUTH?a.X.NORTH:a.X.EAST}function J(e){return e===a.X.NORTH_WEST||e===a.X.SOUTH_WEST}function X(e){return e===a.X.NORTH_WEST||e===a.X.NORTH_EAST}function K(e){return e===a.X.NORTH_WEST||e===a.X.WEST||e===a.X.SOUTH_WEST}function Q(e){return e===a.X.NORTH_EAST||e===a.X.EAST||e===a.X.SOUTH_EAST}function ee(e){return e===a.X.SOUTH_EAST||e===a.X.SOUTH||e===a.X.SOUTH_WEST}function te(e){return e===a.X.NORTH_EAST||e===a.X.NORTH||e===a.X.NORTH_WEST}const ie=[a.X.NORTH,a.X.EAST,a.X.SOUTH,a.X.WEST],re=[a.X.NORTH_EAST,a.X.SOUTH_EAST,a.X.SOUTH_WEST,a.X.NORTH_WEST],ne=1e-5},30220:(e,t,i)=>{i.d(t,{AA:()=>o,Ay:()=>c,E9:()=>b,QT:()=>_,W4:()=>l,b:()=>y,dF:()=>f,gl:()=>u,rv:()=>a,t8:()=>v,zW:()=>h});var r=i(17135),n=i(57410),s=i(13809);class o{constructor(){this._queue=new r.Z,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.leaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),null!=e&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}}class a{constructor(){this._q=new r.Z}get done(){return 0===this._q.length}reset(e){if(this._q.clear(),null!=e){this._q.pushArray(e);for(let e=0;e<this._q.length;++e){const t=this._q.data[e];t.leaf||this._q.pushArray(t.children)}}}next(){return this._q.pop()}}function l(e,t){if(null==t)return!1;const i=function(e){return(0,s.sR)(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale}:e.layer}(t);if(null==i?.fullExtent)return!1;const r=i.fullExtent,n=e.extent;if(r.xmin>n[2]||r.ymin>n[3]||r.xmax<n[0]||r.ymax<n[1])return!1;const o=e.surface.tilingScheme.levels[e.level].scale,a=i.minScale;if(a>0&&o>1.00000001*a)return!1;const l=i.maxScale;return!(l>0&&o<.99999999*l)}function c(e){return!(0,s.sR)(e)&&e.layer&&"tilemapCache"in e.layer?e.layer.tilemapCache:null}function u(e,t){const i=e.lij,r=t.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function h(e,t,i=null){null==i||0===i.length?e===n.z.BACK_TO_FRONT?t.sort(d):t.sort(p):t.sort(((t,r)=>function(e,t,i,r){return m(e,r)===m(t,r)?f(e,t,i):e?i:-i}(t,r,e,i)))}function d(e,t){const i=t.screenDepth-e.screenDepth;if(0!==i)return i;const r=e.lij,n=t.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function p(e,t){const i=e.screenDepth-t.screenDepth;if(0!==i)return i;const r=e.lij,n=t.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function f(e,t,i){const r=e.screenDepth,n=t.screenDepth;return r<n?-i:r>n?i:u(e,t)}function m(e,t){for(const i of t)if(e.intersectsExtent(i))return!0;return!1}function g(e,t){const i=e.distanceToPOI-t.distanceToPOI;if(0!==i)return i;const r=e.lij,n=t.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function y(e,t){const i=e.length;for(let r=0;r<i;++r)e.at(r).updateDistanceToPOI(t);e.sort(g)}function _(e,t,i){let r=1,n=0,s=0;for(;e!==t;)if(r*=.5,n*=.5,s*=.5,1&e.lij[2]&&(n+=.5),1&e.lij[1]||(s+=.5),null==(e=e.parent))throw new Error("tile was not a descendant of upsampleTile");i.init(t,n,s,r)}function v(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let e=0;e<4;e++){const t=r.children[e];if(t&&t!==i)return!0}}return!1}function b(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,n=i?t:e,s=1<<n[0]-r[0];return Math.floor(n[1]/s)===r[1]&&Math.floor(n[2]/s)===r[2]}},95944:(e,t,i)=>{i.d(t,{Un:()=>F,ws:()=>x,zO:()=>k,Qu:()=>z});var r=i(36663),n=i(46332),s=i(3965),o=i(86717),a=i(81095),l=i(56999),c=i(52721),u=i(66352),h=i(33401),d=i(24174),p=i(68848),f=i(22919),m=i(39590),g=i(86765);class y extends g.K{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,null!=this._parameterBlocks)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==this._parameterBlocks)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}}class _{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function v(e={}){return(t,i)=>{const r=t._parameterCount??0;if(t._parameterCount=r+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,i,{get(){return this[r]},set(e){const t=this[r];if(null==t)this[r]=[...e];else{if(n.equals(t,e))return;n.copy(t,e)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[r]},set(t){this[r]!==t&&(e.dispose&&this[r]&&this[r].dispose(),this[r]=t,this._setDirty())}})}}function b(){return(e,t)=>{const i=e._parameterCount??0;e._parameterCount=i+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(i),Object.defineProperty(e,t,{get(){return this[i]},set(e){this[i]!==e&&(this[i]=e,this._setDirty())}})}}var w,x,T=i(34790),C=i(35031),S=i(7792),E=i(57583),M=i(2833),A=i(3864),R=i(94283),O=i(2653),P=i(70984),I=i(97994),L=i(19765),D=i(67235),N=i(5226);class F extends y{constructor(e,t){super(),this.toMapSpace=t,this.baseColor=(0,c.vV)(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=L.xq,this.emissiveFactor=(0,a.vV)(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.commonMaterialParameters=new U,this.componentParameters=new k,this.objectOpacity=1,this.textureAlphaCutoff=N.e,this.alphaDiscardMode=P.JJ.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=R.U.Earth,this.hasOccludees=!1;const i=new O.I(e.position),r=(0,s.d9)(e.rotationScale);(0,n.U_)(r,r),(0,n.p4)(r,r),this.transformNormalGlobalFromModel=r,this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture?.glTexture}get textureMetallicRoughness(){return this.metallicRoughnessTexture?.glTexture}get textureEmissive(){return this.emissionTexture?.glTexture}get hasEmissions(){return null!=this.emissionTexture||!(0,o.p)(this.emissiveFactor,a.AG)}get textureOcclusion(){return this.occlusionTexture?.glTexture}get textureNormal(){return this.normalTexture?.glTexture}acquireTechnique(e,t,i,r){const n=new p._(e.context.spherical,e.context.doublePrecisionRequiresObfuscation);n.hasVertexColors=r.colors,n.hasNormals=r.hasNormals,n.textureCoordinateType=r.textureCoordinates,n.hasMetallicRoughnessTexture=null!=this.metallicRoughnessTexture,n.hasOcclusionTexture=null!=this.occlusionTexture,n.hasNormalTexture=null!=this.normalTexture,n.oitPass=t.identifier===T.o.Material&&null!=i.oitPass?i.oitPass:I.M.NONE,n.terrainDepthTest=t.identifier===T.o.Material&&i.terrainDepthTest,n.cullAboveTerrain=t.identifier===T.o.Material&&i.cullAboveTerrain,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?M.q.View:M.q.None,n.hasColorTexture=null!=this.baseColorTexture;const s=this._computeWhichMaterialPass();if(n.blendingEnabled=s===w.Transparent||s===w.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?function(e){return null!=e.overlay?.getTexture(h.D.ColorNoRasterImage)}(i)?function(e){return null!=e.overlay?.getTexture(h.D.WaterNormal)}(i)?p.O.ColorOverlayWithWater:p.O.ColorOverlay:p.O.NoOverlay:p.O.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===p.O.ColorOverlayWithWater?A.f7.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?r.shadeNormals&&this.isIntegratedMesh?A.f7.Disabled:A.f7.Schematic:A.f7.Normal:A.f7.Disabled,n.emissionSource=null!=this.emissionTexture?E.jo.Texture:n.pbrMode===A.f7.Normal?E.jo.Value:E.jo.None,n.shadeNormals=r.shadeNormals,n.normalType=n.hasNormals?S.r.Compressed:S.r.ScreenDerivative,n.hasSlicePlane=null!=i.slicePlane&&this.commonMaterialParameters.hasSlicePlane,t.identifier===T.o.ShadowMap)n.output=C.H_.Shadow,n.vertexDiscardMode=m.a.None;else if(t.identifier===T.o.ViewshedShadowMap)n.output=C.H_.ViewshedShadow,n.vertexDiscardMode=m.a.None;else if(t.identifier===T.o.Highlight)n.output=C.H_.Highlight,n.vertexDiscardMode=m.a.None;else{switch(s===w.OpaqueAndTransparent?n.vertexDiscardMode=t.transparent?m.a.Opaque:m.a.Transparent:n.vertexDiscardMode=m.a.None,n.output=t.output,n.receiveAmbientOcclusion=n.receiveShadows=!1,t.output){case C.H_.Color:case C.H_.ColorEmission:n.receiveAmbientOcclusion=r.applySSAO&&null!=i.ssao,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.screenSpaceReflections=null!=i.ssr.lastFrameColor,n.cloudReflections=null!=i.clouds.data;break;case C.H_.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}const o=e.get(d.h,n);return this._setClean(),o}hasSnowCover(e){return null!=e.weather&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}submit(e,t,i){if(this.objectOpacity<=0)return;const{componentData:r,renderable:n}=i,{geometry:s}=n,o=n.meta.cameraDepthSquared;r.updateHighlights(t.highlights);const{geometryRanges:a,highlightRangesMap:l,shadowmapRanges:c}=r;switch(this._computeWhichMaterialPass()){case w.Opaque:e.opaque.submitDraw(this,s,a,o);break;case w.Transparent:e.transparent.submitDraw(this,s,a,o);break;case w.OpaqueAndTransparent:e.opaque.submitDraw(this,s,a,o),e.transparent.submitDraw(this,s,a,o);break;case w.IntegratedMesh:e.integratedMesh.submitDraw(this,s,a,o),function(e){return null!=e.overlay?.getTexture(h.D.Highlight)}(t)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}if(this.componentParameters.castShadows!==x.None){if(null!=l)for(const t of l)t[0]===D.b&&e.highlightShadowMap.submitDraw(this,s,t[1],o,t[0]);null!=c&&e.nonHighlightShadowMap.submitDraw(this,s,c,o),e.shadowMap.submitDraw(this,s,a,o)}if(null!=l)for(const t of l)e.highlight.submitDraw(this,s,t[1],o,t[0]);t.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,s,a,o)}_computeWhichMaterialPass(){if(this.isIntegratedMesh)return w.IntegratedMesh;if(this.objectOpacity<1)return w.Transparent;if(this.componentParameters.opaqueOverride===x.All)return w.Opaque;if(this.baseColor[3]<1||this.alphaDiscardMode===P.JJ.Blend||this.alphaDiscardMode===P.JJ.MaskBlend)return w.Transparent;switch(this.componentParameters.transparent){case x.None:return w.Opaque;case x.All:return w.Transparent;case x.Some:return w.OpaqueAndTransparent}}}(0,r._)([v({vectorOps:l.v})],F.prototype,"baseColor",void 0),(0,r._)([v()],F.prototype,"usePBR",void 0),(0,r._)([v()],F.prototype,"hasParametersFromSource",void 0),(0,r._)([v({vectorOps:o.J})],F.prototype,"mrrFactors",void 0),(0,r._)([v({vectorOps:o.J})],F.prototype,"emissiveFactor",void 0),(0,r._)([v({dispose:!0})],F.prototype,"baseColorTexture",void 0),(0,r._)([v({dispose:!0})],F.prototype,"metallicRoughnessTexture",void 0),(0,r._)([v({dispose:!0})],F.prototype,"emissionTexture",void 0),(0,r._)([v({dispose:!0})],F.prototype,"occlusionTexture",void 0),(0,r._)([v({dispose:!0})],F.prototype,"normalTexture",void 0),(0,r._)([b()],F.prototype,"commonMaterialParameters",void 0),(0,r._)([b()],F.prototype,"componentParameters",void 0),(0,r._)([v()],F.prototype,"objectOpacity",void 0),(0,r._)([v()],F.prototype,"textureAlphaCutoff",void 0),(0,r._)([v()],F.prototype,"alphaDiscardMode",void 0),(0,r._)([v()],F.prototype,"isIntegratedMesh",void 0),(0,r._)([v()],F.prototype,"polygonOffsetEnabled",void 0),(0,r._)([v()],F.prototype,"ellipsoidMode",void 0),(0,r._)([v()],F.prototype,"hasOccludees",void 0),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(w||(w={}));class U extends _{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=P.Vr.Back,this.hasSlicePlane=!0}}(0,r._)([v()],U.prototype,"doubleSided",void 0),(0,r._)([v()],U.prototype,"cullFace",void 0),(0,r._)([v()],U.prototype,"hasSlicePlane",void 0);class k extends _{constructor(){super(...arguments),this.externalColor=(0,c.al)(1,1,1,1),this.externalColorMixMode=u.a9.Multiply,this.castShadows=x.All}get transparent(){return this.externalColor[3]<1?x.All:x.None}get opaqueOverride(){return this.externalColorMixMode===u.a9.Replace&&1===this.externalColor[3]?x.All:x.None}get visible(){return this.externalColor[3]>0?x.All:x.None}get type(){return f._N.Uniform}}(0,r._)([v({vectorOps:l.v})],k.prototype,"externalColor",void 0),(0,r._)([v()],k.prototype,"externalColorMixMode",void 0),(0,r._)([v()],k.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(x||(x={}));class z extends _{constructor(){super(...arguments),this.texture=null,this.transparent=x.None,this.opaqueOverride=x.None,this.castShadows=x.None}get type(){return f._N.Varying}}(0,r._)([v()],z.prototype,"texture",void 0),(0,r._)([v()],z.prototype,"transparent",void 0),(0,r._)([v()],z.prototype,"opaqueOverride",void 0),(0,r._)([v()],z.prototype,"castShadows",void 0)},24174:(e,t,i)=>{i.d(t,{h:()=>m,k:()=>g});var r=i(68848),n=i(9004),s=i(35031),o=i(9969),a=i(62575),l=i(70984),c=i(97994),u=i(12045),h=i(79040),d=i(21414),p=i(91907),f=i(17346);class m extends a.A{constructor(e,t){super(e,t,new o.J(n.C,(()=>i.e(35736).then(i.bind(i,35736)))),g)}initializePipeline(e){const{integratedMeshMode:t,output:i,blendingEnabled:n,cullFace:o,hasOccludees:a,hasPolygonOffset:d,oitPass:m}=e,g=t!==r.O.None,y=m===c.M.NONE,_=m===c.M.FrontFace;return(0,f.sm)({blending:(0,s.c1)(i)&&n?(0,u.Wo)(m):null,culling:(0,f.zp)(o),depthTest:{func:(0,u.Bh)(m)},depthWrite:y||_?f.ck:null,drawBuffers:i===s.H_.Depth?{buffers:[p.Xg.NONE]}:(0,u.u_)(m,i),colorWrite:f.gf,stencilWrite:g||a?h.s3:null,stencilTest:g?(0,h.ec)(l.hU.IntegratedMeshMaskExcluded):a?h.RY:null,polygonOffset:y||_?d?{factor:2,units:2}:null:u.E0})}}const g=new Map([[d.T.POSITION,0],[d.T.NORMAL,1],[d.T.NORMALCOMPRESSED,1],[d.T.COLOR,2],[d.T.UV0,3],[d.T.UVREGION,4],[d.T.COMPONENTINDEX,5]])},68848:(e,t,i)=>{i.d(t,{O:()=>r,_:()=>_});var r,n=i(36663),s=i(22919),o=i(39590),a=i(35031),l=i(7792),c=i(82082),u=i(57583),h=i(2833),d=i(3864),p=i(94283),f=i(12907),m=i(70984),g=i(97994),y=i(5224);!function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(r||(r={}));class _ extends f.m{constructor(e,t){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=t,this.output=a.H_.Color,this.textureCoordinateType=c.I.None,this.componentData=s._N.Uniform,this.cullFace=m.Vr.Back,this.vertexDiscardMode=o.a.None,this.doubleSidedMode=h.q.WindingOrder,this.alphaDiscardMode=m.JJ.Opaque,this.integratedMeshMode=r.None,this.oitPass=g.M.NONE,this.ellipsoidMode=p.U.Earth,this.pbrMode=d.f7.Disabled,this.normalType=l.r.Attribute,this.emissionSource=u.jo.None,this.hasVertexColors=!1,this.hasNormals=!1,this.shadeNormals=!0,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.screenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.hasNormalTextureTransform=!1,this.cloudReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.discardInvisibleFragments=!1,this.occlusionPass=!1,this.bindType=y.P.Draw,this.useCustomDTRExponentForWater=!1,this.hasVertexTangents=!1,this.highStepCount=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.useFillLights=!0,this.objectAndLayerIdColorInstanced=!1,this.canHaveOverlay=!0}}(0,n._)([(0,f.o)({count:a.H_.COUNT})],_.prototype,"output",void 0),(0,n._)([(0,f.o)({count:c.I.COUNT})],_.prototype,"textureCoordinateType",void 0),(0,n._)([(0,f.o)({count:s._N.COUNT})],_.prototype,"componentData",void 0),(0,n._)([(0,f.o)({count:m.Vr.COUNT})],_.prototype,"cullFace",void 0),(0,n._)([(0,f.o)({count:o.a.COUNT})],_.prototype,"vertexDiscardMode",void 0),(0,n._)([(0,f.o)({count:h.q.COUNT})],_.prototype,"doubleSidedMode",void 0),(0,n._)([(0,f.o)({count:m.JJ.COUNT})],_.prototype,"alphaDiscardMode",void 0),(0,n._)([(0,f.o)({count:r.COUNT})],_.prototype,"integratedMeshMode",void 0),(0,n._)([(0,f.o)({count:g.M.COUNT})],_.prototype,"oitPass",void 0),(0,n._)([(0,f.o)({count:p.U.COUNT})],_.prototype,"ellipsoidMode",void 0),(0,n._)([(0,f.o)({count:d.f7.COUNT})],_.prototype,"pbrMode",void 0),(0,n._)([(0,f.o)({count:l.r.COUNT})],_.prototype,"normalType",void 0),(0,n._)([(0,f.o)({count:u.jo.COUNT})],_.prototype,"emissionSource",void 0),(0,n._)([(0,f.o)()],_.prototype,"hasVertexColors",void 0),(0,n._)([(0,f.o)()],_.prototype,"hasNormals",void 0),(0,n._)([(0,f.o)()],_.prototype,"shadeNormals",void 0),(0,n._)([(0,f.o)()],_.prototype,"hasSlicePlane",void 0),(0,n._)([(0,f.o)()],_.prototype,"hasColorTexture",void 0),(0,n._)([(0,f.o)()],_.prototype,"receiveAmbientOcclusion",void 0),(0,n._)([(0,f.o)()],_.prototype,"receiveShadows",void 0),(0,n._)([(0,f.o)()],_.prototype,"blendingEnabled",void 0),(0,n._)([(0,f.o)()],_.prototype,"screenSpaceReflections",void 0),(0,n._)([(0,f.o)()],_.prototype,"hasPolygonOffset",void 0),(0,n._)([(0,f.o)()],_.prototype,"hasMetallicRoughnessTexture",void 0),(0,n._)([(0,f.o)()],_.prototype,"hasOcclusionTexture",void 0),(0,n._)([(0,f.o)()],_.prototype,"hasNormalTexture",void 0),(0,n._)([(0,f.o)()],_.prototype,"hasOccludees",void 0),(0,n._)([(0,f.o)()],_.prototype,"terrainDepthTest",void 0),(0,n._)([(0,f.o)()],_.prototype,"cullAboveTerrain",void 0),(0,n._)([(0,f.o)()],_.prototype,"hasNormalTextureTransform",void 0),(0,n._)([(0,f.o)()],_.prototype,"cloudReflections",void 0),(0,n._)([(0,f.o)()],_.prototype,"snowCover",void 0),(0,n._)([(0,f.o)()],_.prototype,"objectAndLayerIdColor",void 0)},22919:(e,t,i)=>{i.d(t,{AD:()=>v,_N:()=>p,nO:()=>_,Hz:()=>y});var r=i(27755),n=i(73534),s=i(78804),o=i(35031),a=i(9794),l=i(40622),c=i(20200),u=i(5224),h=i(23474);class d extends h.x{constructor(e,t){super(e,"int",u.P.Draw,((i,r,n)=>i.setUniform1i(e,t(r,n))))}}var p,f=i(37649),m=i(43338),g=i(21414);!function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"}(p||(p={}));const y=429496.7296;function _(e,t){(0,n.I)(e/y*.5+.5,t)}function v(e,t){switch(t.componentData){case p.Varying:return function(e,t){const{vertex:i,fragment:r}=e;i.include(a.n),i.uniforms.add(new f.R("componentColorTex",(e=>e.componentParameters.texture.texture))),e.attributes.add(g.T.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4");const n=t.output===o.H_.ObjectAndLayerIdColor;n&&e.varyings.add("vObjectAndLayerIdColor","vec4"),e.include(s.A),i.constants.add("stride","float",(0,m.B)()?3:2),i.code.add(c.H`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(c.H`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);
    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

  float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);
    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return uninterpolatedRGBAToFloat(encodedElevation) * ${c.H.float(y)};
  }

  ${n?c.H`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);
            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:c.H`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(c.H`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?c.H`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}(e,t);case p.Uniform:return function(e,t){const{vertex:i,fragment:r}=e;e.varyings.add("vExternalColor","vec4"),i.uniforms.add(new l.$("externalColor",(e=>e.componentParameters.externalColor))).code.add(c.H`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const n=t.output===o.H_.ObjectAndLayerIdColor;r.uniforms.add(new d("externalColorMixMode",(e=>e.componentParameters.externalColorMixMode))).code.add(c.H`
    void readExternalColor(out vec4 color, out int colorMixMode) {
      color = vExternalColor;
      colorMixMode = externalColorMixMode;
    }

    void outputObjectAndLayerIdColor() {
      ${(0,c.If)(n,"fragColor = vec4(0, 0, 0, 0);")}
    }
  `)}(e,t);case p.COUNT:return;default:(0,r.Bg)(t.componentData)}}},78804:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(66352),n=i(20200);function s(e){e.vertex.code.add(n.H`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${n.H.int(r.a9.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${n.H.int(r.a9.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${n.H.int(r.a9.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${n.H.int(r.a9.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}},39590:(e,t,i)=>{var r;i.d(t,{a:()=>r}),function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"}(r||(r={}))},67920:(e,t,i)=>{i.d(t,{N:()=>l,h:()=>a});var r=i(44685),n=i(82082),s=i(21414),o=i(86765);class a extends o.K{constructor(e,t,i,r,n){super(),this.colors=e,this.textureCoordinates=t,this.hasNormals=i,this.shadeNormals=r,this.applySSAO=n}}function l({hasNormals:e,textureCoordinates:t,colors:i}){const o=(0,r.U$)().vec3f(s.T.POSITION);return e&&o.vec2i16(s.T.NORMALCOMPRESSED,{glNormalized:!0}),t===n.I.Default?o.vec2f(s.T.UV0):t===n.I.Atlas&&(o.vec2f(s.T.UV0),o.vec4u16(s.T.UVREGION,{glNormalized:!0})),i&&o.vec4u8(s.T.COLOR,{glNormalized:!0}),o}},34790:(e,t,i)=>{var r;i.d(t,{o:()=>r}),function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight",e[e.ViewshedShadowMap=3]="ViewshedShadowMap"}(r||(r={}))},95650:(e,t,i)=>{i.d(t,{Lm:()=>a,Zu:()=>l,bA:()=>c,qj:()=>u});var r=i(35031),n=i(62295),s=i(80670),o=i(20200);function a(e){e.varyings.add("linearDepth","float")}function l(e){e.vertex.uniforms.add(new s.$("nearFar",(e=>e.camera.nearFar)))}function c(e){e.vertex.code.add(o.H`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function u(e,t){const{vertex:i}=e;switch(t.output){case r.H_.Color:case r.H_.ColorEmission:if(t.receiveShadows)return a(e),void i.code.add(o.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case r.H_.Shadow:case r.H_.ShadowHighlight:case r.H_.ShadowExcludeHighlight:case r.H_.ViewshedShadow:return e.include(n.up,t),a(e),l(e),c(e),void i.code.add(o.H`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(o.H`void forwardLinearDepth() {}`)}},91567:(e,t,i)=>{i.d(t,{y:()=>d});var r=i(36531),n=i(84164),s=i(20200),o=i(5224),a=i(23474);class l extends a.x{constructor(e,t){super(e,"ivec2",o.P.Pass,((i,r,n)=>i.setUniform2iv(e,t(r,n))))}}var c=i(59842),u=i(15176),h=i(37738);function d(e){const{vertex:t}=e;t.uniforms.add(new u.A("coverageTexture",(e=>e.coverageTexture)),new l("highlightRenderCellCount",(e=>(0,r.t8)(p,e.horizontalCellCount,e.verticalCellCount))),new l("highlightTextureResolution",(({highlightTexture:e})=>(0,r.t8)(p,e.descriptor.width,e.descriptor.height))),new c._("highlightLevel",(e=>e.highlightLevel))).constants.add("cellSize","int",h.g),e.varyings.add("sUV","vec2"),e.varyings.add("vOutlinePossible","float"),t.code.add(s.H`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`).main.add(s.H`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
uvec2 covTexel = uvec2(texelFetch(coverageTexture, cellPos, 0).rg * 255.0);
int channelIndex = (highlightLevel >> 2) & 3;
uint channelValue = covTexel[channelIndex];
int highlightIndex = (highlightLevel & 3) << 1;
bool covered = ((channelValue >> highlightIndex) & 1u) == 1u;
if (!covered) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}const p=(0,n.Ue)()},46368:(e,t,i)=>{i.d(t,{D:()=>n});var r=i(20200);function n(e){const{fragment:t}=e;t.code.add(r.H`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}},67783:(e,t,i)=>{i.d(t,{R:()=>o});var r=i(31227),n=i(77334),s=i(20200);function o(e){const t=e.fragment;e.include(n.GZ),t.include(r.K),t.code.add(s.H`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}},57218:(e,t,i)=>{i.d(t,{w:()=>n});var r=i(20200);function n(e){e.vertex.code.add(r.H`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},55208:(e,t,i)=>{i.d(t,{k:()=>s});var r=i(20200),n=i(21414);function s(e,t=!0){e.attributes.add(n.T.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.main.add(r.H`
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?r.H`uv = position * 0.5 + vec2(0.5);`:""}
  `)}},35031:(e,t,i)=>{var r;function n(e){return e===r.Shadow||e===r.ShadowHighlight||e===r.ShadowExcludeHighlight||e===r.ViewshedShadow}function s(e){return function(e){return m(e)||_(e)}(e)||e===r.Normal}function o(e){return y(e)||e===r.Normal}function a(e){return e===r.Highlight||e===r.ObjectAndLayerIdColor}function l(e){return c(e)||a(e)}function c(e){return e===r.Color}function u(e){return c(e)||v(e)}function h(e){return c(e)||e===r.ObjectAndLayerIdColor}function d(e){return u(e)||e===r.ObjectAndLayerIdColor}function p(e){return c(e)||e===r.Highlight}function f(e){return p(e)||_(e)}function m(e){return c(e)||a(e)}function g(e){return u(e)||a(e)}function y(e){return g(e)||_(e)}function _(e){return e===r.Depth}function v(e){return e===r.ColorEmission}i.d(t,{BX:()=>_,CQ:()=>h,D5:()=>c,ED:()=>o,Gy:()=>a,H_:()=>r,Jb:()=>s,Kr:()=>n,L_:()=>m,Lk:()=>d,Qo:()=>g,Xo:()=>f,c1:()=>u,f_:()=>y,qC:()=>v,xs:()=>l}),function(e){e[e.Color=0]="Color",e[e.ColorEmission=1]="ColorEmission",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal",e[e.Shadow=4]="Shadow",e[e.ShadowHighlight=5]="ShadowHighlight",e[e.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",e[e.ViewshedShadow=7]="ViewshedShadow",e[e.Highlight=8]="Highlight",e[e.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",e[e.COUNT=10]="COUNT"}(r||(r={}))},5885:(e,t,i)=>{i.d(t,{$S:()=>f,P_:()=>d,UT:()=>h,f5:()=>p});var r=i(32114),n=i(3308),s=i(86717),o=i(81095),a=i(32006),l=i(43036),c=i(20200),u=i(86765);class h extends u.K{constructor(e){super(),this.slicePlaneLocalOrigin=e}}function d(e,t){y(e,t,new l.J("slicePlaneOrigin",((e,i)=>w(t,e,i))),new l.J("slicePlaneBasis1",((e,i)=>x(t,e,i,i.slicePlane?.basis1))),new l.J("slicePlaneBasis2",((e,i)=>x(t,e,i,i.slicePlane?.basis2))))}function p(e,t){y(e,t,new a.B("slicePlaneOrigin",((e,i)=>w(t,e,i))),new a.B("slicePlaneBasis1",((e,i)=>x(t,e,i,i.slicePlane?.basis1))),new a.B("slicePlaneBasis2",((e,i)=>x(t,e,i,i.slicePlane?.basis2))))}function f(e,t){g(e,t,new a.B("slicePlaneOrigin",((e,i)=>w(t,e,i))),new a.B("slicePlaneBasis1",((e,i)=>x(t,e,i,i.slicePlane?.basis1))),new a.B("slicePlaneBasis2",((e,i)=>x(t,e,i,i.slicePlane?.basis2))))}const m=c.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
bool rejectBySlice(vec3 pos) {
return sliceByPlane(pos);
}`;function g(e,t,...i){t.hasSlicePlane?(e.uniforms.add(...i),e.code.add(m)):e.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function y(e,t,...i){g(e,t,...i),t.hasSlicePlane?e.code.add("\n    void discardBySlice(vec3 pos) {\n      if (sliceByPlane(pos)) {\n        discard;\n      }\n    }\n\n    vec4 applySliceOutline(vec4 color, vec3 pos) {\n      SliceFactors factors = calculateSliceFactors(pos);\n\n      factors.front /= 2.0 * fwidth(factors.front);\n      factors.side0 /= 2.0 * fwidth(factors.side0);\n      factors.side1 /= 2.0 * fwidth(factors.side1);\n      factors.side2 /= 2.0 * fwidth(factors.side2);\n      factors.side3 /= 2.0 * fwidth(factors.side3);\n\n      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth\n      if (sliceByFactors(factors)) {\n        return color;\n      }\n\n      float outlineFactor = (1.0 - step(0.5, factors.front))\n        * (1.0 - step(0.5, factors.side0))\n        * (1.0 - step(0.5, factors.side1))\n        * (1.0 - step(0.5, factors.side2))\n        * (1.0 - step(0.5, factors.side3));\n\n      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);\n    }\n\n    vec4 applySlice(vec4 color, vec3 pos) {\n      return sliceEnabled() ? applySliceOutline(color, pos) : color;\n    }\n  "):e.code.add(c.H`void discardBySlice(vec3 pos) { }
vec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function _(e,t,i){return e.instancedDoublePrecision?(0,s.i)(T,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function v(e,t){return null!=e?(0,s.d)(C,t.origin,e):t.origin}function b(e,t,i){return e.hasSliceTranslatedView?null!=t?(0,r.Iu)(E,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function w(e,t,i){if(null==i.slicePlane)return o.AG;const r=_(e,t,i),n=v(r,i.slicePlane),a=b(e,r,i);return null!=a?(0,s.t)(C,n,a):n}function x(e,t,i,r){if(null==r||null==i.slicePlane)return o.AG;const n=_(e,t,i),a=v(n,i.slicePlane),l=b(e,n,i);return null!=l?((0,s.g)(S,r,a),(0,s.t)(C,a,l),(0,s.t)(S,S,l),(0,s.d)(S,S,C)):r}const T=(0,o.Ue)(),C=(0,o.Ue)(),S=(0,o.Ue)(),E=(0,n.Ue)()},4731:(e,t,i)=>{i.d(t,{w:()=>s});var r=i(95650),n=i(20200);function s(e){(0,r.bA)(e),e.vertex.code.add(n.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(n.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},99163:(e,t,i)=>{i.d(t,{f:()=>_});var r=i(46332),n=i(3965),s=i(3308),o=i(86717),a=i(81095),l=i(35031),c=i(5331),u=i(84614),h=i(20998),d=i(20200),p=i(11125),f=i(87621),m=i(21414),g=i(30560);i(86765);const y=(0,n.Ue)();function _(e,t){const i=t.hasModelTransformation,n=t.instancedDoublePrecision;i&&(e.vertex.uniforms.add(new f.g("model",(e=>e.modelTransformation??s.Wd))),e.vertex.uniforms.add(new p.c("normalLocalOriginFromModel",(e=>((0,r.XL)(y,e.modelTransformation??s.Wd),y))))),t.instanced&&n&&(e.attributes.add(m.T.INSTANCEMODELORIGINHI,"vec3"),e.attributes.add(m.T.INSTANCEMODELORIGINLO,"vec3"),e.attributes.add(m.T.INSTANCEMODEL,"mat3"),e.attributes.add(m.T.INSTANCEMODELNORMAL,"mat3"));const a=e.vertex;n&&(a.include(c.$,t),a.uniforms.add(new h.d("viewOriginHi",(e=>(0,g.U8)((0,o.i)(v,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]),v))),new h.d("viewOriginLo",(e=>(0,g.GB)((0,o.i)(v,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]),v))))),a.code.add(d.H`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?n?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":n?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${n?d.H`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),a.code.add(d.H`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?n?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":n?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),t.output===l.H_.Normal&&((0,u._8)(a),a.code.add(d.H`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?n?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":n?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),t.hasVertexTangents&&a.code.add(d.H`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?n?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":n?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const v=(0,a.Ue)()},7792:(e,t,i)=>{i.d(t,{O:()=>a,r:()=>r});var r,n=i(27755),s=i(20200),o=i(21414);function a(e,t){switch(t.normalType){case r.Compressed:e.attributes.add(o.T.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(s.H`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case r.Attribute:e.attributes.add(o.T.NORMAL,"vec3"),e.vertex.code.add(s.H`vec3 normalModel() {
return normal;
}`);break;case r.ScreenDerivative:e.fragment.code.add(s.H`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:(0,n.Bg)(t.normalType);case r.COUNT:}}!function(e){e[e.Attribute=0]="Attribute",e[e.Compressed=1]="Compressed",e[e.ScreenDerivative=2]="ScreenDerivative",e[e.COUNT=3]="COUNT"}(r||(r={}))},78950:(e,t,i)=>{i.d(t,{R:()=>o});var r=i(35031),n=i(20200),s=i(21414);function o(e,t){if(t.output!==r.H_.ObjectAndLayerIdColor)return e.vertex.code.add(n.H`void forwardObjectAndLayerIdColor() {}`),void e.fragment.code.add(n.H`void outputObjectAndLayerIdColor() {}`);const i=t.objectAndLayerIdColorInstanced;e.varyings.add("objectAndLayerIdColorVarying","vec4"),e.attributes.add(i?s.T.INSTANCEOBJECTANDLAYERIDCOLOR:s.T.OBJECTANDLAYERIDCOLOR,"vec4"),e.vertex.code.add(n.H`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${i?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor"} * 0.003921568627451;
    }`),e.fragment.code.add(n.H`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}},91636:(e,t,i)=>{i.d(t,{f:()=>s});var r=i(20200),n=i(21414);function s(e){e.attributes.add(n.T.POSITION,"vec3"),e.vertex.code.add(r.H`vec3 positionModel() { return position; }`)}},65915:(e,t,i)=>{i.d(t,{U:()=>c});var r=i(12664),n=i(43036),s=i(24603),o=i(40335),a=i(20200),l=i(21414);function c(e,t){const i=e.vertex;i.uniforms.add(new s.p("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(l.T.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new n.J("vvSizeMinSize",(e=>e.vvSize.minSize)),new n.J("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new n.J("vvSizeOffset",(e=>e.vvSize.offset)),new n.J("vvSizeFactor",(e=>e.vvSize.factor))),i.code.add(a.H`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(l.T.SIZE,"float"),i.code.add(a.H`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(l.T.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new o.O("vvOpacityValues",(e=>e.vvOpacity.values),8),new o.O("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),8)),i.code.add(a.H`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(a.H`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.include(r.k,t),e.attributes.add(l.T.COLORFEATUREATTRIBUTE,"float"),i.code.add(a.H`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(e.attributes.add(l.T.COLOR,"vec4"),i.code.add(a.H`vec4 getColor(){
return applyOpacity(color);
}`))}},92835:(e,t,i)=>{i.d(t,{R:()=>l});var r=i(78804),n=i(20200),s=i(59842),o=i(21414),a=i(25584);function l(e,t){t.hasSymbolColors?(e.include(r.A),e.attributes.add(o.T.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(n.H`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new s._("colorMixMode",(e=>a.FZ[e.colorMixMode]))),e.vertex.code.add(n.H`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}},82082:(e,t,i)=>{i.d(t,{D:()=>a,I:()=>r});var r,n=i(27755),s=i(20200),o=i(21414);function a(e,t){switch(t.textureCoordinateType){case r.Default:return e.attributes.add(o.T.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(s.H`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case r.Compressed:return e.attributes.add(o.T.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(s.H`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case r.Atlas:return e.attributes.add(o.T.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(o.T.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(s.H`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:(0,n.Bg)(t.textureCoordinateType);case r.None:return void e.vertex.code.add(s.H`void forwardTextureCoordinates() {}`);case r.COUNT:return}}!function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.Compressed=3]="Compressed",e[e.COUNT=4]="COUNT"}(r||(r={}))},6502:(e,t,i)=>{i.d(t,{c:()=>s});var r=i(20200),n=i(21414);function s(e,t){t.hasVertexColors?(e.attributes.add(n.T.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(r.H`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(r.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(r.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},78549:(e,t,i)=>{i.d(t,{Bb:()=>h,Pf:()=>p,d4:()=>d});var r=i(27755),n=i(3965),s=i(52721),o=i(7792),a=i(62295),l=i(20200),c=i(55784),u=i(11125);function h(e,t){switch(t.normalType){case o.r.Attribute:case o.r.Compressed:e.include(o.O,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add(new c.j("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel)),new u.c("transformNormalViewFromGlobal",(e=>e.transformNormalViewFromGlobal))),e.vertex.code.add(l.H`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case o.r.ScreenDerivative:e.vertex.code.add(l.H`void forwardNormal() {}`);break;default:(0,r.Bg)(t.normalType);case o.r.COUNT:}}class d extends a.su{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,n.Ue)()}}class p extends a.OU{constructor(){super(...arguments),this.transformNormalGlobalFromModel=(0,n.Ue)(),this.toMapSpace=(0,s.Ue)()}}},62295:(e,t,i)=>{i.d(t,{OU:()=>y,su:()=>g,up:()=>m});var r=i(3965),n=i(3308),s=i(81095),o=i(91636),a=i(5331),l=i(32006),c=i(43036),u=i(20200),h=i(55784),d=i(11125),p=i(87621),f=i(86765);function m(e,t){e.include(o.f);const i=e.vertex;i.include(a.$,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add(new c.J("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new c.J("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new d.c("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new p.g("transformProjFromView",(e=>e.transformProjFromView)),new h.j("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new l.B("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new l.B("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))),i.code.add(u.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(u.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?u.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:u.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new c.J("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),i.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class g extends f.K{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,s.Ue)(),this.transformWorldFromViewTL=(0,s.Ue)(),this.transformViewFromCameraRelativeRS=(0,r.Ue)(),this.transformProjFromView=(0,n.Ue)()}}class y extends f.K{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,r.Ue)(),this.transformWorldFromModelTH=(0,s.Ue)(),this.transformWorldFromModelTL=(0,s.Ue)()}}},14140:(e,t,i)=>{i.d(t,{M:()=>n});var r=i(20200);function n(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(r.H`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(r.H`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(r.H`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}},94352:(e,t,i)=>{i.d(t,{i:()=>o});var r=i(82082),n=i(88862),s=i(20200);function o(e,t){const{textureCoordinateType:i}=t;if(i===r.I.None||i===r.I.COUNT)return;e.include(r.D,t);const o=i===r.I.Atlas;o&&e.include(n.r),e.fragment.code.add(s.H`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${o?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}},77700:(e,t,i)=>{i.d(t,{L:()=>c,V:()=>h});var r=i(56999),n=i(52721),s=i(76774),o=i(84614),a=i(63371),l=i(20200);function c(e,t){const i=e.vertex;t.hasVerticalOffset?(h(i),t.hasScreenSizePerspective&&(e.include(s.cK),(0,s.m8)(i),(0,o.hY)(e.vertex,t)),i.code.add(l.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?l.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:l.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?l.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:l.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(l.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u=(0,n.Ue)();function h(e){e.uniforms.add(new a.N("verticalOffset",((e,t)=>{const{minWorldLength:i,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return(0,r.s)(u,s*a,o,i,n)})))}},77546:(e,t,i)=>{i.d(t,{s:()=>v});var r=i(95650),n=i(35031),s=i(5885),o=i(4731),a=i(7792),l=i(78950),c=i(82082),u=i(78549),h=i(59004),d=i(32560),p=i(12664),f=i(44866),m=i(84614),g=i(20200),y=i(15176),_=i(70984);function v(e,t){const{vertex:i,fragment:v}=e,b=t.hasColorTexture&&t.alphaDiscardMode!==_.JJ.Opaque,{output:w,normalType:x,hasColorTextureTransform:T}=t;switch(w){case n.H_.Depth:(0,m.Sv)(i,t),e.include(o.w,t),e.fragment.include(s.f5,t),e.include(c.D,t),b&&v.uniforms.add(new y.A("tex",(e=>e.texture))),i.main.add(g.H`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),e.include(f.z,t),v.main.add(g.H`
        discardBySlice(vpos);
        ${(0,g.If)(b,g.H`vec4 texColor = texture(tex, ${T?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}`);break;case n.H_.Shadow:case n.H_.ShadowHighlight:case n.H_.ShadowExcludeHighlight:case n.H_.ViewshedShadow:case n.H_.ObjectAndLayerIdColor:(0,m.Sv)(i,t),e.include(o.w,t),e.include(c.D,t),e.include(p.k,t),e.include(h.F,t),e.fragment.include(s.f5,t),e.include(l.R,t),(0,r.Zu)(e),e.varyings.add("depth","float"),b&&v.uniforms.add(new y.A("tex",(e=>e.texture))),i.main.add(g.H`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();`),e.include(f.z,t),v.main.add(g.H`
        discardBySlice(vpos);
        ${(0,g.If)(b,g.H`vec4 texColor = texture(tex, ${T?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        ${w===n.H_.ObjectAndLayerIdColor?g.H`outputObjectAndLayerIdColor();`:g.H`outputDepth(depth);`}`);break;case n.H_.Normal:{(0,m.Sv)(i,t),e.include(o.w,t),e.include(a.O,t),e.include(u.Bb,t),e.include(c.D,t),e.include(p.k,t),b&&v.uniforms.add(new y.A("tex",(e=>e.texture))),x===a.r.ScreenDerivative&&e.varyings.add("vPositionView","vec3");const r=x===a.r.Attribute||x===a.r.Compressed;i.main.add(g.H`
        vpos = getVertexInLocalOriginSpace();
        ${r?g.H`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:g.H`vPositionView = (view * vec4(vpos, 1.0)).xyz;`}
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();`),e.fragment.include(s.f5,t),e.include(f.z,t),v.main.add(g.H`
        discardBySlice(vpos);
        ${(0,g.If)(b,g.H`vec4 texColor = texture(tex, ${T?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}

        ${x===a.r.ScreenDerivative?g.H`vec3 normal = screenDerivativeNormal(vPositionView);`:g.H`vec3 normal = normalize(vNormalWorld);
                    if (gl_FrontFacing == false){
                      normal = -normal;
                    }`}
        fragColor = vec4(0.5 + 0.5 * normal, 1.0);`);break}case n.H_.Highlight:(0,m.Sv)(i,t),e.include(o.w,t),e.include(c.D,t),e.include(p.k,t),b&&v.uniforms.add(new y.A("tex",(e=>e.texture))),i.main.add(g.H`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),e.fragment.include(s.f5,t),e.include(f.z,t),e.include(d.b,t),v.main.add(g.H`
        discardBySlice(vpos);
        ${(0,g.If)(b,g.H`vec4 texColor = texture(tex, ${T?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        calculateOcclusionAndOutputHighlight();`)}}},94728:(e,t,i)=>{i.d(t,{H:()=>s});var r=i(90381),n=i(20200);function s(e){e.uniforms.add(new r.U("alignPixelEnabled",(e=>e.alignPixelEnabled))),e.code.add(n.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(n.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},21737:(e,t,i)=>{i.d(t,{R:()=>d,c:()=>h});var r=i(77700),n=i(76774),s=i(84614),o=i(80967),a=i(49016),l=i(24603),c=i(20200),u=i(21414);const h=.5;function d(e,t){e.include(n.cK),e.attributes.add(u.T.POSITION,"vec3"),e.attributes.add(u.T.NORMAL,"vec3"),e.attributes.add(u.T.CENTEROFFSETANDDISTANCE,"vec4");const i=e.vertex;(0,s.Sv)(i,t),(0,s.hY)(i,t),i.uniforms.add(new o.$("viewport",(e=>e.camera.fullViewport)),new l.p("polygonOffset",(e=>e.shaderPolygonOffset)),new a.z("cameraGroundRelative",(e=>e.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,r.V)(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(c.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(c.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.terrainDepthTest?c.H.float(0):c.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,s._8)(i),t.draped||(i.uniforms.add(new a.z("perDistancePixelRatio",(e=>Math.tan(e.camera.fovY/2)/(e.camera.fullViewport[2]/2)))),i.code.add(c.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${c.H.float(h)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,s.ZI)(i),t.hasScreenSizePerspective&&(0,n.m8)(i),i.code.add(c.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?c.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":c.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},74319:(e,t,i)=>{i.d(t,{R:()=>o});var r=i(94728),n=i(94880),s=i(20200);function o(e,t){const{vertex:i,fragment:o}=e;e.include(n.H,t),i.include(r.H),i.main.add(s.H`vec4 posProjCenter;
if (dot(position, position) > 0.0) {
ProjectHUDAux projectAux;
vec4 posProj = projectPositionHUD(projectAux);
posProjCenter = alignToPixelCenter(posProj, viewport.zw);
forwardViewPosDepth(projectAux.posView);
vec3 vpos = projectAux.posModel;
if (rejectBySlice(vpos)) {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
} else {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
gl_Position = posProjCenter;
gl_PointSize = 1.0;`),o.main.add(s.H`fragColor = vec4(1);
if(discardByTerrainDepth()) {
fragColor.g = 0.5;
}`)}},55803:(e,t,i)=>{var r;i.d(t,{U:()=>r}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}))},95067:(e,t,i)=>{i.d(t,{P:()=>c});var r=i(94728),n=i(55803),s=i(80967),o=i(49016),a=i(20200),l=i(99126);function c(e){e.vertex.uniforms.add(new o.z("renderTransparentlyOccludedHUD",(e=>e.hudRenderStyle===n.U.Occluded?1:e.hudRenderStyle===n.U.NotOccluded?0:.75)),new s.$("viewport",(e=>e.camera.fullViewport)),new l.e("hudVisibilityTexture",(e=>e.hudVisibility?.getTexture()))),e.vertex.include(r.H),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},23998:(e,t,i)=>{var r;i.d(t,{MV:()=>s,iM:()=>r,pU:()=>n}),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(r||(r={}));const n={normal:r.Normal,average:r.Average,lighten:r.Lighten,lighter:r.Lighter,screen:r.Screen,plus:r.Plus,"color-dodge":r.ColorDodge,darken:r.Darken,multiply:r.Multiply,"color-burn":r.ColorBurn,overlay:r.Overlay,"soft-light":r.SoftLight,"hard-light":r.HardLight,"vivid-light":r.VividLight,hue:r.Hue,saturation:r.Saturation,luminosity:r.Luminosity,color:r.Color,difference:r.Difference,exclusion:r.Exclusion,minus:r.Minus,invert:r.Invert,reflect:r.Reflect,"destination-over":r.DestinationOver,"destination-atop":r.DestinationAtop,"destination-in":r.DestinationIn,"destination-out":r.DestinationOut,"source-atop":r.SourceAtop,"source-in":r.SourceIn,"source-out":r.SourceOut,xor:r.Xor};function s(e){return e===r.DestinationOver||e===r.DestinationAtop||e===r.DestinationIn||e===r.DestinationOut||e===r.SourceAtop||e===r.SourceIn||e===r.SourceOut||e===r.Xor}},57583:(e,t,i)=>{i.d(t,{Ok:()=>d,jo:()=>r});var r,n=i(35031),s=i(94352),o=i(32006),a=i(43036),l=i(20200),c=i(37649),u=i(15176),h=(i(80776),i(5224));!function(e){e[e.None=0]="None",e[e.Value=1]="Value",e[e.Texture=2]="Texture",e[e.COUNT=3]="COUNT"}(r||(r={}));function d(e,t){if(!(0,n.c1)(t.output))return;const{emissionSource:i,hasEmissiveTextureTransform:d,bindType:p}=t,f=i===r.Texture;f&&(e.include(s.i,t),e.fragment.uniforms.add(p===h.P.Pass?new u.A("texEmission",(e=>e.textureEmissive)):new c.R("texEmission",(e=>e.textureEmissive))));const m=i===r.Value||f;m&&e.fragment.uniforms.add(p===h.P.Pass?new a.J("emissionFactor",(e=>e.emissiveFactor)):new o.B("emissionFactor",(e=>e.emissiveFactor))),e.fragment.code.add(l.H`
    vec4 getEmissions() {
      vec4 emissions = ${m?"vec4(emissionFactor, 1.0)":"vec4(0.0)"};
      ${(0,l.If)(f,`emissions *= textureLookup(texEmission, ${d?"emissiveUV":"vuv0"});\n         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)}
      return emissions;
    }
  `)}},59004:(e,t,i)=>{i.d(t,{F:()=>o});var r=i(35031),n=i(52446),s=i(20200);function o(e,t){switch(t.output){case r.H_.Shadow:case r.H_.ShadowHighlight:case r.H_.ShadowExcludeHighlight:case r.H_.ViewshedShadow:e.fragment.include(n.f),e.fragment.code.add(s.H`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}},32560:(e,t,i)=>{i.d(t,{b:()=>h});var r=i(46368),n=i(35031),s=i(20200),o=i(5224),a=i(23474);class l extends a.x{constructor(e,t){super(e,"ivec2",o.P.Bind,((i,r)=>i.setUniform2iv(e,t(r))))}}var c=i(97704),u=i(99126);function h(e,t){const{fragment:i}=e;t.output===n.H_.Highlight?(i.uniforms.add(new u.e("depthTexture",(e=>e.mainDepth)),new u.e("highlightTexture",(e=>e.highlightMixTexture)),new c.Y("highlightLevel",(e=>e.highlightLevel??0)),new l("highlightMixOrigin",(e=>e.highlightMixOrigin))),e.outputs.add("fragHighlight","vec2",0),e.include(r.D),i.code.add(s.H`vec2 getAccumulatedHighlight() {
return texelFetch(highlightTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = vec2(float(bits) / 255.0, 0.0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
vec2 combinedHighlight = getAccumulatedHighlight();
uint accumulatedI = uint(combinedHighlight[li] * 255.0);
combinedHighlight[li] = float(bits | accumulatedI) / 255.0;
fragHighlight = combinedHighlight;
}
}
bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}
void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`),t.canHaveOverlay&&i.code.add(s.H`void calculateOcclusionAndOutputHighlightOverlay(vec2 highlightToAdd) {
uint levelBits = readLevelBits(highlightToAdd, highlightLevel);
if ((levelBits & 1u) == 0u) { discard; }
outputHighlight(isHighlightOccluded());
}`)):i.code.add(s.H`void calculateOcclusionAndOutputHighlight() {}`)}},31227:(e,t,i)=>{i.d(t,{K:()=>a});var r=i(36531),n=i(84164),s=i(80670),o=i(20200);function a(e){e.uniforms.add(new s.$("zProjectionMap",(e=>function(e){const t=e.projectionMatrix;return(0,r.t8)(l,t[14],t[10])}(e.camera)))),e.code.add(o.H`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),e.code.add(o.H`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),e.code.add(o.H`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}const l=(0,n.Ue)()},35434:(e,t,i)=>{i.d(t,{i:()=>o});var r=i(24603),n=i(20200),s=i(15176);function o(e){e.fragment.uniforms.add(new s.A("u_colormap",(e=>e.u_colormap)),new r.p("u_colormapOffset",(e=>e.colormap.u_colormapOffset)),new r.p("u_colormapMaxIndex",(e=>e.colormap.u_colormapMaxIndex)),new r.p("u_opacity",(e=>e.common.u_opacity))),e.fragment.code.add(n.H`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}},45979:(e,t,i)=>{i.d(t,{G:()=>u,J:()=>c});var r=i(93072),n=i(20200),s=i(15176);function o(e){e.fragment.uniforms.add(new s.A("u_transformGrid",(e=>e.u_transformGrid)),new r.A("u_transformSpacing",(e=>e.common.u_transformSpacing)),new r.A("u_targetImageSize",(e=>e.common.u_targetImageSize))),e.fragment.code.add(n.H`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}var a=i(73721),l=i(71278);class c extends a.R{constructor(e,t,i){super(),this.common=e,this.u_image=t,this.u_transformGrid=i}}function u(e,t){e.include(o),e.fragment.uniforms.add(new s.A("u_image",(e=>e.u_image)),new l.U("u_flipY",(e=>e.common.u_flipY)),new l.U("u_applyTransform",(e=>e.common.u_applyTransform)));const{requireBilinearWithNN:i}=t;i&&e.fragment.uniforms.add(new r.A("u_srcImageSize",(e=>e.common.u_srcImageSize))),e.fragment.code.add(n.H`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?e.fragment.code.add(n.H`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):e.fragment.code.add(n.H`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}},94118:(e,t,i)=>{i.d(t,{K:()=>c});var r=i(27755),n=i(7792),s=i(78549),o=i(62295),a=i(2833),l=i(20200);function c(e,t){const i=e.fragment;switch(t.doubleSidedMode){case a.q.None:i.code.add(l.H`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case a.q.View:e.include(o.up,t),i.code.add(l.H`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case a.q.WindingOrder:i.code.add(l.H`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:(0,r.Bg)(t.doubleSidedMode);case a.q.COUNT:}switch(t.normalType){case n.r.Attribute:case n.r.Compressed:e.include(s.Bb,t),i.main.add(l.H`vec3 fragmentFaceNormal = _adjustDoublesided(normalize(vNormalWorld));
vec3 fragmentFaceNormalView = gl_FrontFacing ? normalize(vNormalView) : -normalize(vNormalView);`);break;case n.r.ScreenDerivative:e.include(o.up,t),i.main.add(l.H`vec3 fragmentFaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
vec3 fragmentFaceNormalView = normalize(cross(dFdx(vPosition_view), dFdy(vPosition_view)));`);default:case n.r.COUNT:}t.shadeNormals?i.main.add(l.H`vec3 fragmentShadingNormal = fragmentFaceNormal;`):t.spherical?(e.include(o.up,t),i.main.add(l.H`vec3 fragmentShadingNormal = normalize(positionWorld());`)):i.main.add(l.H`vec3 fragmentShadingNormal = vec3(0.0, 0.0, 1.0);`)}},16220:(e,t,i)=>{i.d(t,{P:()=>l});var r=i(6502),n=i(27452),s=i(40622),o=i(90261),a=i(20200);function l(e,t){e.include(r.c,t),e.fragment.include(n.y);const i=e.fragment;i.uniforms.add(new s.$("baseColor",(e=>e.baseColor))),i.uniforms.add(new o.p("objectOpacity",(e=>e.objectOpacity))),t.hasVertexColors?i.code.add(a.H`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(a.H`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(a.H`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}},3417:(e,t,i)=>{i.d(t,{Q:()=>m});var r=i(3965),n=i(84164),s=i(82082),o=i(94352),a=i(2833),l=i(93072),c=i(20200),u=i(11125),h=i(37649),d=i(15176),p=i(21414),f=i(5224);function m(e,t){const i=e.fragment;t.hasVertexTangents?(e.attributes.add(p.T.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===a.q.WindingOrder?i.code.add(c.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(c.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(c.H`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),t.textureCoordinateType!==s.I.None&&(e.include(o.i,t),i.uniforms.add(t.bindType===f.P.Pass?new d.A("normalTexture",(e=>e.textureNormal)):new h.R("normalTexture",(e=>e.textureNormal))),t.hasNormalTextureTransform&&(i.uniforms.add(new l.A("scale",(e=>e.scale??n.hq))),i.uniforms.add(new u.c("normalTextureTransformMatrix",(e=>e.normalTextureTransformMatrix??r.Wd)))),i.code.add(c.H`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),t.hasNormalTextureTransform&&i.code.add(c.H`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(c.H`return tangentSpace * rawNormal;
}`))}},77787:(e,t,i)=>{i.d(t,{_:()=>h});var r=i(86717),n=i(81095),s=i(56999),o=i(52721),a=i(3864),l=i(20998),c=i(80967),u=i(20200);function h(e,t){const i=e.fragment,n=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===n?(i.uniforms.add(new l.d("lightingAmbientSH0",(({lighting:e})=>(0,r.i)(d,e.sh.r[0],e.sh.g[0],e.sh.b[0])))),i.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===n?(i.uniforms.add(new c.$("lightingAmbientSH_R",(({lighting:e})=>(0,s.s)(p,e.sh.r[0],e.sh.r[1],e.sh.r[2],e.sh.r[3]))),new c.$("lightingAmbientSH_G",(({lighting:e})=>(0,s.s)(p,e.sh.g[0],e.sh.g[1],e.sh.g[2],e.sh.g[3]))),new c.$("lightingAmbientSH_B",(({lighting:e})=>(0,s.s)(p,e.sh.b[0],e.sh.b[1],e.sh.b[2],e.sh.b[3])))),i.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===n&&(i.uniforms.add(new l.d("lightingAmbientSH0",(({lighting:e})=>(0,r.i)(d,e.sh.r[0],e.sh.g[0],e.sh.b[0]))),new c.$("lightingAmbientSH_R1",(({lighting:e})=>(0,s.s)(p,e.sh.r[1],e.sh.r[2],e.sh.r[3],e.sh.r[4]))),new c.$("lightingAmbientSH_G1",(({lighting:e})=>(0,s.s)(p,e.sh.g[1],e.sh.g[2],e.sh.g[3],e.sh.g[4]))),new c.$("lightingAmbientSH_B1",(({lighting:e})=>(0,s.s)(p,e.sh.b[1],e.sh.b[2],e.sh.b[3],e.sh.b[4]))),new c.$("lightingAmbientSH_R2",(({lighting:e})=>(0,s.s)(p,e.sh.r[5],e.sh.r[6],e.sh.r[7],e.sh.r[8]))),new c.$("lightingAmbientSH_G2",(({lighting:e})=>(0,s.s)(p,e.sh.g[5],e.sh.g[6],e.sh.g[7],e.sh.g[8]))),new c.$("lightingAmbientSH_B2",(({lighting:e})=>(0,s.s)(p,e.sh.b[5],e.sh.b[6],e.sh.b[7],e.sh.b[8])))),i.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==a.f7.Normal&&t.pbrMode!==a.f7.Schematic||i.code.add(u.H`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const d=(0,n.Ue)(),p=(0,o.Ue)()},30786:(e,t,i)=>{i.d(t,{K:()=>o});var r=i(20200),n=i(99126),s=i(77738);function o(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add(new n.e("ssaoTex",(e=>e.ssao?.getTexture()))),i.constants.add("blurSizePixelsInverse","float",1/s.s),i.code.add(r.H`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(r.H`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}},24623:(e,t,i)=>{i.d(t,{PN:()=>m,XP:()=>y,sC:()=>g});var r=i(86875),n=i(27755),s=i(77787),o=i(30786),a=i(58749),l=i(89585),c=i(3864),u=i(95509),h=i(90381),d=i(49016),p=i(20200),f=i(39501);function m(e){e.constants.add("ambientBoostFactor","float",f.Vt)}function g(e){e.uniforms.add(new d.z("lightingGlobalFactor",(e=>e.lighting.globalFactor)))}function y(e,t){const i=e.fragment;switch(e.include(o.K,t),t.pbrMode!==c.f7.Disabled&&e.include(l.T,t),e.include(s._,t),e.include(u.e),i.code.add(p.H`
    const float GAMMA_SRGB = ${p.H.float(r.jm)};
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===c.f7.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),m(i),g(i),(0,a.Pe)(i),i.code.add(p.H`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?p.H`normalize(vPosWorld)`:p.H`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),(0,a.F1)(i),i.code.add(p.H`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),t.pbrMode){case c.f7.Disabled:case c.f7.WaterOnIntegratedMesh:case c.f7.Water:e.include(a.gz),i.code.add(p.H`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
vec3 mainLighting = applyShading(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case c.f7.Normal:case c.f7.Schematic:i.code.add(p.H`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec4 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(p.H`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new h.U("hasFillLights",(e=>e.enableFillLights))):i.constants.add("hasFillLights","bool",!1),i.code.add(p.H`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
float NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
vec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new d.z("lightingSpecularStrength",(e=>e.lighting.mainLight.specularStrength)),new d.z("lightingEnvironmentStrength",(e=>e.lighting.mainLight.environmentStrength))).code.add(p.H`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
float NdotH = clamp(dot(normal, h), 0.0, 1.0);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(p.H`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission.rgb == vec3(0.0) ? _emission.rgb : pow(_emission.rgb, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode!==c.f7.Schematic||t.hasColorTexture?p.H`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:p.H`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case c.f7.Simplified:case c.f7.TerrainWithWater:(0,a.Pe)(i),(0,a.F1)(i),i.code.add(p.H`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:(0,n.Bg)(t.pbrMode);case c.f7.COUNT:}}},98016:(e,t,i)=>{i.d(t,{E:()=>s,K:()=>n});var r=i(20200);function n(e){e.fragment.code.add(r.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function s(e){e.fragment.code.add(r.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},76203:(e,t,i)=>{i.d(t,{D:()=>s});var r=i(86875),n=i(20200);function s(e){e.fragment.code.add(n.H`
    const float GAMMA = ${n.H.float(r.jm)};
    const float INV_GAMMA = ${n.H.float(1/r.jm)};

    vec4 delinearizeGamma(vec4 color) {
      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.a);
    }

    vec3 linearizeGamma(vec3 color) {
      return pow(color, vec3(GAMMA));
    }
  `)}},37009:(e,t,i)=>{i.d(t,{q:()=>f,C:()=>m});var r=i(9794),n=i(84614),s=i(63371),o=i(49016),a=i(24603),l=i(20200),c=i(15176),u=i(33195),h=i(56999),d=i(52721);const p=(0,d.Ue)();function f(e,t){if(!t.stippleEnabled)return void e.fragment.code.add(l.H`float getStippleAlpha() { return 1.0; }
void discardByStippleAlpha(float stippleAlpha, float threshold) {}
vec4 blendStipple(vec4 color, float stippleAlpha) { return color; }`);const i=!(t.draped&&t.stipplePreferContinuous),{vertex:f,fragment:y}=e;y.include(r.n),t.draped||((0,n.hY)(f,t),f.uniforms.add(new o.z("worldToScreenPerDistanceRatio",(({camera:e})=>1/e.perScreenPixelRatio))).code.add(l.H`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),f.code.add(l.H`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${l.H.float(g)};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),f.code.add(l.H`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),f.code.add(l.H`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),(0,n.ZI)(f),f.code.add(l.H`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),y.uniforms.add(new c.A("stipplePatternTexture",(e=>e.stippleTexture)),new a.p("stipplePatternSDFNormalizer",(e=>function(e){return e?(Math.floor(.5*((0,u.kj)(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new a.p("stipplePatternPixelSizeInv",(e=>1/m(e)))),t.stippleOffColorEnabled&&y.uniforms.add(new s.N("stippleOffColor",(e=>function(e){return null==e?d.AG:4===e.length?e:(0,h.s)(p,e[0],e[1],e[2],1)}(e.stippleOffColor)))),y.code.add(l.H`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgbaTofloat(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),y.code.add(l.H`
    void discardByStippleAlpha(float stippleAlpha, float threshold) {
     ${(0,l.If)(!t.stippleOffColorEnabled,"if (stippleAlpha < threshold) { discard; }")}
    }

    vec4 blendStipple(vec4 color, float stippleAlpha) {
      return ${t.stippleOffColorEnabled?"mix(color, stippleOffColor, stippleAlpha)":"vec4(color.rgb, color.a * stippleAlpha)"};
    }
  `)}function m(e){const t=e.stipplePattern;return t?(0,u.$A)(e.stipplePattern)/t.pixelRatio:1}const g=.4},58749:(e,t,i)=>{i.d(t,{F1:()=>o,Pe:()=>s,gz:()=>a});var r=i(20998),n=i(20200);function s(e){e.uniforms.add(new r.d("mainLightDirection",(e=>e.lighting.mainLight.direction)))}function o(e){e.uniforms.add(new r.d("mainLightIntensity",(e=>e.lighting.mainLight.intensity)))}function a(e){s(e.fragment),o(e.fragment),e.fragment.code.add(n.H`vec3 applyShading(vec3 shadingNormalWorld, float shadow) {
float dotVal = clamp(dot(shadingNormalWorld, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)}},27988:(e,t,i)=>{i.d(t,{Q:()=>l});var r=i(6411),n=i(84614),s=i(49016),o=i(20200),a=i(60997);function l(e,t){const i=e.vertex;(0,n.ZI)(i),null==i.uniforms.get("markerScale")&&i.constants.add("markerScale","float",1),i.constants.add("markerSizePerLineWidth","float",r.M_).code.add(o.H`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),t.space===a.I9.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new s.z("perRenderPixelRatio",(e=>e.camera.perRenderPixelRatio))),i.code.add(o.H`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}},32078:(e,t,i)=>{i.d(t,{S:()=>o});var r=i(31227),n=i(20200),s=i(99126);function o(e){e.include(r.K),e.uniforms.add(new s.e("geometryDepthTexture",(e=>e.geometryDepth?.attachment))),e.code.add(n.H`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}},37451:(e,t,i)=>{i.d(t,{n:()=>n});var r=i(20200);function n(e,t){t.spherical?e.vertex.code.add(r.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(r.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(r.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(r.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},2833:(e,t,i)=>{i.d(t,{k:()=>o,q:()=>r});var r,n=i(27755),s=i(20200);function o(e,t){const i=e.fragment;switch(i.code.add(s.H`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case r.None:i.code.add(s.H`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case r.View:i.code.add(s.H`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case r.WindingOrder:i.code.add(s.H`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:(0,n.Bg)(t.doubleSidedMode);case r.COUNT:}}!function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"}(r||(r={}))},89585:(e,t,i)=>{i.d(t,{T:()=>a,g:()=>l});var r=i(20200);function n(e){const t=e.fragment.code;t.add(r.H`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(r.H`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(r.H`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var s=i(3864),o=i(95509);function a(e,t){const i=e.fragment.code;e.include(o.e),t.pbrMode!==s.f7.Normal&&t.pbrMode!==s.f7.Schematic&&t.pbrMode!==s.f7.Simplified&&t.pbrMode!==s.f7.TerrainWithWater||(i.add(r.H`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(r.H`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),t.pbrMode!==s.f7.Normal&&t.pbrMode!==s.f7.Schematic||(e.include(n),i.add(r.H`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(r.H`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(r.H`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(r.H`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function l(e,t){const i=e.fragment.code;e.include(o.e),i.add(r.H`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(r.H`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(r.H`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(r.H`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(r.H`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)}},3864:(e,t,i)=>{i.d(t,{f7:()=>r,jV:()=>h});var r,n=i(94352),s=i(32006),o=i(43036),a=i(20200),l=i(37649),c=i(15176),u=(i(80776),i(19765),i(5224));!function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.Simplified=5]="Simplified",e[e.TerrainWithWater=6]="TerrainWithWater",e[e.COUNT=7]="COUNT"}(r||(r={}));function h(e,t){const i=t.pbrMode,h=e.fragment;if(i!==r.Schematic&&i!==r.Disabled&&i!==r.Normal)return void h.code.add(a.H`void applyPBRFactors() {}`);if(i===r.Disabled)return void h.code.add(a.H`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(i===r.Schematic)return void h.code.add(a.H`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);const{hasMetallicRoughnessTexture:d,hasMetallicRoughnessTextureTransform:p,hasOcclusionTexture:f,hasOcclusionTextureTransform:m,bindType:g}=t;(d||f)&&e.include(n.i,t),h.code.add(a.H`vec3 mrr;
float occlusion;`),d&&h.uniforms.add(g===u.P.Pass?new c.A("texMetallicRoughness",(e=>e.textureMetallicRoughness)):new l.R("texMetallicRoughness",(e=>e.textureMetallicRoughness))),f&&h.uniforms.add(g===u.P.Pass?new c.A("texOcclusion",(e=>e.textureOcclusion)):new l.R("texOcclusion",(e=>e.textureOcclusion))),h.uniforms.add(g===u.P.Pass?new o.J("mrrFactors",(e=>e.mrrFactors)):new s.B("mrrFactors",(e=>e.mrrFactors))),h.code.add(a.H`
    ${(0,a.If)(d,a.H`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${(0,a.If)(f,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${f?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${(0,a.If)(d,`applyMetallicRoughness(${p?"metallicRoughnessUV":"vuv0"});`)}
      ${(0,a.If)(f,`applyOcclusion(${m?"occlusionUV":"vuv0"});`)}
    }
  `)}},95509:(e,t,i)=>{function r(e){const t=3.141592653589793,i=.3183098861837907;e.vertex.constants.add("PI","float",t),e.fragment.constants.add("PI","float",t),e.fragment.constants.add("LIGHT_NORMALIZATION","float",i),e.fragment.constants.add("INV_PI","float",i),e.fragment.constants.add("HALF_PI","float",1.570796326794897),e.fragment.constants.add("TWO_PI","float",6.28318530717958)}i.d(t,{e:()=>r})},14351:(e,t,i)=>{i.d(t,{s:()=>l});var r=i(35031),n=i(94352),s=i(20200),o=i(37649),a=i(70984);function l(e,t){const i=t.hasColorTexture&&((0,r.c1)(t.output)||t.alphaDiscardMode!==a.JJ.Opaque);i&&(e.include(n.i,t),e.fragment.uniforms.add(new o.R("baseColorTexture",(e=>e.texture)))),e.fragment.code.add(s.H`
    vec4 readBaseColorTexture() {
      return ${i?"textureLookup(baseColorTexture, vuv0)":"vec4(1.0)"};
    }
  `)}},60532:(e,t,i)=>{i.d(t,{XE:()=>_,hb:()=>y,nj:()=>g});var r=i(3308),n=i(81095),s=i(52446),o=i(80967),a=i(20200),l=i(97704),c=i(5224),u=i(23474);class h extends u.x{constructor(e,t,i){super(e,"mat4",c.P.Draw,((i,r,n,s)=>i.setUniformMatrix4fv(e,t(r,n,s))),i)}}var d=i(49618),p=i(99126),f=i(86765);class m extends f.K{constructor(){super(...arguments),this.modelTransformation=r.Wd}}class g extends m{constructor(){super(...arguments),this.origin=(0,n.Ue)()}}function y(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new d.G("shadowMapMatrix",((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),v(e))}function _(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new h("shadowMapMatrix",((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),v(e))}function v(e){const t=e.fragment;t.include(s.f),t.uniforms.add(new p.e("shadowMap",(e=>e.shadowMap.depthTexture)),new l.Y("numCascades",(e=>e.shadowMap.numCascades)),new o.$("cascadeDistances",(e=>e.shadowMap.cascadeDistances))).code.add(a.H`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}},37414:(e,t,i)=>{i.d(t,{o:()=>n,s:()=>r});const r=3e5,n=5e5},94880:(e,t,i)=>{i.d(t,{H:()=>o});var r=i(31227),n=i(20200),s=i(99126);function o(e,{occlusionPass:t,terrainDepthTest:i,cullAboveTerrain:o}){const a=e.vertex,l=e.fragment;if(!i)return a.code.add("void forwardViewPosDepth(vec3 pos) {}"),void l.code.add(`${t?"bool":"void"} discardByTerrainDepth() { ${(0,n.If)(t,"return false;")}}`);e.varyings.add("viewPosDepth","float"),a.code.add("void forwardViewPosDepth(vec3 pos) {\n    viewPosDepth = pos.z;\n  }"),l.include(r.K),l.uniforms.add(new s.e("terrainDepthTexture",(e=>e.terrainDepth?.attachment))).code.add(n.H`
    ${t?"bool":"void"} discardByTerrainDepth() {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${t?"return viewPosDepth < linearDepth && depth < 1.0;":`if(viewPosDepth ${o?">":"<="} linearDepth) discard;`}
    }`)}},30228:(e,t,i)=>{i.d(t,{DT:()=>h,NI:()=>l,R5:()=>c,av:()=>a,jF:()=>u});var r=i(3965),n=i(82082),s=i(20200),o=i(11125);function a(e,t){t.hasColorTextureTransform?(e.varyings.add("colorUV","vec2"),e.vertex.uniforms.add(new o.c("colorTextureTransformMatrix",(e=>e.colorTextureTransformMatrix??r.Wd))).code.add(s.H`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardColorUV(){}`)}function l(e,t){t.hasNormalTextureTransform&&t.textureCoordinateType!==n.I.None?(e.varyings.add("normalUV","vec2"),e.vertex.uniforms.add(new o.c("normalTextureTransformMatrix",(e=>e.normalTextureTransformMatrix??r.Wd))).code.add(s.H`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardNormalUV(){}`)}function c(e,t){t.hasEmissionTextureTransform&&t.textureCoordinateType!==n.I.None?(e.varyings.add("emissiveUV","vec2"),e.vertex.uniforms.add(new o.c("emissiveTextureTransformMatrix",(e=>e.emissiveTextureTransformMatrix??r.Wd))).code.add(s.H`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardEmissiveUV(){}`)}function u(e,t){t.hasOcclusionTextureTransform&&t.textureCoordinateType!==n.I.None?(e.varyings.add("occlusionUV","vec2"),e.vertex.uniforms.add(new o.c("occlusionTextureTransformMatrix",(e=>e.occlusionTextureTransformMatrix??r.Wd))).code.add(s.H`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardOcclusionUV(){}`)}function h(e,t){t.hasMetallicRoughnessTextureTransform&&t.textureCoordinateType!==n.I.None?(e.varyings.add("metallicRoughnessUV","vec2"),e.vertex.uniforms.add(new o.c("metallicRoughnessTextureTransformMatrix",(e=>e.metallicRoughnessTextureTransformMatrix??r.Wd))).code.add(s.H`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardMetallicRoughnessUV(){}`)}},12664:(e,t,i)=>{i.d(t,{k:()=>u});var r=i(43036),n=i(36444),s=i(40335),o=i(20200),a=i(11125),l=i(21414),c=i(67874);function u(e,t){const{vertex:i,attributes:u}=e;t.hasVvInstancing&&(t.vvSize||t.vvColor)&&u.add(l.T.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(i.uniforms.add(new r.J("vvSizeMinSize",(e=>e.vvSize.minSize))),i.uniforms.add(new r.J("vvSizeMaxSize",(e=>e.vvSize.maxSize))),i.uniforms.add(new r.J("vvSizeOffset",(e=>e.vvSize.offset))),i.uniforms.add(new r.J("vvSizeFactor",(e=>e.vvSize.factor))),i.uniforms.add(new a.c("vvSymbolRotationMatrix",(e=>e.vvSymbolRotationMatrix))),i.uniforms.add(new r.J("vvSymbolAnchor",(e=>e.vvSymbolAnchor))),i.code.add(o.H`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(o.H`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?o.H`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(o.H`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",c.x),i.uniforms.add(new s.O("vvColorValues",(e=>e.vvColor.values),c.x),new n.b("vvColorColors",(e=>e.vvColor.colors),c.x)),i.code.add(o.H`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${t.hasVvInstancing?o.H`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(o.H`vec4 vvColor() { return vec4(1.0); }`)}},16159:(e,t,i)=>{i.d(t,{B:()=>g});var r=i(98016),n=i(76203),s=i(89585),o=i(37414),a=i(31227),l=i(80670),c=i(49016),u=i(20200),h=i(61002),d=i(99126);function p(e,t){if(!t.screenSpaceReflections)return;const i=e.fragment;i.include(a.K),i.uniforms.add(new l.$("nearFar",(e=>e.camera.nearFar)),new d.e("depthMap",(e=>e.depth?.attachment)),new h.C("proj",(e=>e.camera.projectionMatrix)),new c.z("invResolutionHeight",(e=>1/e.camera.height)),new h.C("reprojectionMatrix",(e=>e.ssr.reprojectionMatrix))).code.add(u.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);
    float dDepthBefore = 0.0;

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        float weight = dDepth / (dDepth - dDepthBefore);
        vec2 Pf = mix(P - dP, P, 1.0 - weight);
        if (abs(Pf.y - projectedCoordStart.y) > invResolutionHeight) {
          return vec3(Pf, depth);
        }
        else {
          return vec3(P, depth);
        }
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
      dDepthBefore = dDepth;
    }
    return vec3(P, 0.0);
  }
  `)}var f=i(57758),m=i(81809);function g(e,t){e.include(s.g,t),e.include(n.D),e.include(r.E),t.cloudReflections&&e.include(f.j),e.include(p,t);const i=e.fragment;i.include(m.l),i.constants.add("fresnelSky","vec3",[.02,1,15]),i.constants.add("fresnelMaterial","vec2",[.02,.1]),i.constants.add("roughness","float",.015),i.constants.add("foamIntensityExternal","float",1.7),i.constants.add("ssrIntensity","float",.65),i.constants.add("ssrHeightFadeStart","float",o.s),i.constants.add("ssrHeightFadeEnd","float",o.o),i.constants.add("waterDiffusion","float",.92),i.constants.add("waterSeaColorMod","float",.8),i.constants.add("correctionViewingPowerFactor","float",.4),i.constants.add("skyZenitColor","vec3",[.52,.68,.9]),i.constants.add("skyColor","vec3",[.67,.79,.9]),i.constants.add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(u.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new c.z("lightingSpecularStrength",(e=>e.lighting.mainLight.specularStrength)),new c.z("lightingEnvironmentStrength",(e=>e.lighting.mainLight.environmentStrength))),i.code.add(u.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
float NdotL = clamp(dot(n, l), 0.0, 1.0);
specular = lightingSpecularStrength * NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.cloudReflections&&i.uniforms.add(new c.z("cloudsOpacity",(e=>e.clouds.opacity))).code.add(u.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;`),t.screenSpaceReflections?i.uniforms.add(new h.C("view",(e=>e.camera.viewMatrix)),new d.e("lastFrameColorTexture",(e=>e.ssr.lastFrameColor?.getTexture())),new c.z("fadeFactorSSR",(e=>e.ssr.fadeFactor))).code.add(u.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`):i.code.add(u.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.cloudReflections?t.screenSpaceReflections?i.code.add(u.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(u.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(u.H`return waterRenderedColor;
}`)}},61296:(e,t,i)=>{i.d(t,{H:()=>n});var r=i(20200);function n(e){e.code.add(r.H`
    float lineFactorAtPosition(float value) {
      float pos = value * ${r.H.float(257)};
      if(pos < 0.5 || pos > ${r.H.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}},66818:(e,t,i)=>{var r;i.d(t,{I:()=>r}),function(e){e[e.NotRequired=0]="NotRequired",e[e.Required=1]="Required",e[e.COUNT=2]="COUNT"}(r||(r={}))},91238:(e,t,i)=>{var r;i.d(t,{l:()=>r}),function(e){e[e.Composite=0]="Composite",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.GroupBackgroundComposite=3]="GroupBackgroundComposite",e[e.COUNT=4]="COUNT"}(r||(r={}))},97582:(e,t,i)=>{i.d(t,{WB:()=>_,WE:()=>w,gT:()=>r,yl:()=>v});var r,n=i(52721),s=i(24568),o=i(9812),a=i(33401),l=i(34790),c=i(35031),u=i(58749),h=i(3864),d=i(16159),p=i(40622),f=i(24603),m=i(20200),g=i(15176),y=i(23474);function _(e,t){const{vertex:i,fragment:r}=e;i.uniforms.add(new p.$("overlayTexOffset",((e,t)=>function(e,t){const i=t.overlay?.overlays[o.fu.INNER]?.extent;(0,s.py)(i)&&(x[0]=e.toMapSpace[0]/(0,s.d_)(i)-i[0]/(0,s.d_)(i),x[1]=e.toMapSpace[1]/(0,s.Cb)(i)-i[1]/(0,s.Cb)(i));const r=t.overlay?.overlays[o.fu.OUTER]?.extent;return(0,s.py)(r)&&(x[2]=e.toMapSpace[0]/(0,s.d_)(r)-r[0]/(0,s.d_)(r),x[3]=e.toMapSpace[1]/(0,s.Cb)(r)-r[1]/(0,s.Cb)(r)),x}(e,t))),new p.$("overlayTexScale",((e,t)=>function(e,t){const i=t.overlay?.overlays[o.fu.INNER]?.extent;(0,s.py)(i)&&(x[0]=e.toMapSpace[2]/(0,s.d_)(i),x[1]=e.toMapSpace[3]/(0,s.Cb)(i));const r=t.overlay?.overlays[o.fu.OUTER]?.extent;return(0,s.py)(r)&&(x[2]=e.toMapSpace[2]/(0,s.d_)(r),x[3]=e.toMapSpace[3]/(0,s.Cb)(r)),x}(e,t)))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new g.A("ovColorTex",((e,t)=>w(e,t)))),b(e,t)}function v(e,t){const{vertex:i,fragment:r}=e;i.uniforms.add(new T("overlayTexOffset"),new T("overlayTexScale")),r.uniforms.add(new f.p("overlayOpacity",(e=>e.overlayOpacity)),new g.A("ovColorTex",((e,t)=>t.overlay?.getTexture(e.overlayContent)))),b(e,t)}function b(e,t){const i=t.pbrMode===h.f7.Water||t.pbrMode===h.f7.WaterOnIntegratedMesh||t.pbrMode===h.f7.TerrainWithWater;i&&e.include(d.B,t);const{vertex:r,fragment:n}=e;e.varyings.add("vtcOverlay","vec4"),r.code.add(m.H`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),n.code.add(m.H`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),n.code.add(m.H`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),n.code.add(m.H`vec4 getOverlayColorTexel() {
vec4 texCoords = vtcOverlay;
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),n.code.add(m.H`vec2 getAllOverlayHighlightValuesEncoded() {
vec4 texCoords = vtcOverlay;
vec2 uvInner = texCoords.xy;
vec2 uvOuter = texCoords.zw;
bool isValidInner = isValid(uvInner, fwidth(uvInner));
bool isValidOuter = isValid(uvOuter, vec2(0.0, 0.0));
vec2 texelCoordInner = uvInner * vec2(0.5, 1.0);
vec2 texelCoordOuter = uvOuter * vec2(0.5, 1.0) + vec2(0.5,0.0);
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec2 texelValueInner = texelFetch(ovColorTex, ivec2(texelCoordInner * texDim), 0).rg;
vec2 texelValueOuter = texelFetch(ovColorTex, ivec2(texelCoordOuter * texDim), 0).rg;
return
isValidInner ? texelValueInner :
isValidOuter ? texelValueOuter :
vec2(0.0);
}`),i&&((0,u.Pe)(n),(0,u.F1)(n),n.code.add(m.H`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function w(e,t){return e.identifier===l.o.Material&&(0,c.c1)(e.output)?t.overlay?.getTexture(a.D.ColorNoRasterImage):e.identifier===l.o.Material&&e.output===c.H_.ObjectAndLayerIdColor?t.overlay?.getTexture(a.D.ObjectAndLayerIdColor):e.identifier===l.o.Highlight?t.overlay?.getTexture(a.D.Highlight):null}!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"}(r||(r={}));const x=(0,n.Ue)();class T extends y.x{constructor(e){super(e,"vec4")}}},58343:(e,t,i)=>{var r;i.d(t,{m:()=>r}),function(e){e[e.Off=0]="Off",e[e.On=1]="On",e[e.COUNT=2]="COUNT"}(r||(r={}))},47096:(e,t,i)=>{i.d(t,{EK:()=>c,uS:()=>l});var r=i(60532),n=i(61296),s=i(52191),o=i(20200),a=i(23474);class l extends r.nj{constructor(){super(...arguments),this.overlayOpacity=1}}function c(e,t){const{vertex:i,fragment:r,varyings:a}=e;a.add("vtc","vec2"),i.uniforms.add(new d("texOffsetAndScale")),r.uniforms.add(new p("tex")),r.uniforms.add(new h("textureOpacities"));const l=t.textureFadingEnabled&&!t.renderOccluded;l&&(i.uniforms.add(new d("nextTexOffsetAndScale")),a.add("nvtc","vec2"),r.uniforms.add(new p("texNext")),r.uniforms.add(new h("nextTexOpacities")),r.uniforms.add(new u("fadeFactor")));const c=t.tileBlendInput===s.R.ColorComposite,f=t.tileBlendInput===s.R.GridComposite;f&&r.include(n.H),c&&r.uniforms.add(new h("backgroundColor")),i.code.add(o.H`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = texOffsetAndScale.xy + uv * texOffsetAndScale.zw;
    ${(0,o.If)(l,"nvtc = nextTexOffsetAndScale.xy + uv * nextTexOffsetAndScale.zw;")}
  }`),r.code.add(o.H`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${(0,o.If)(f||c,o.H`if (opacities.y <= 0.0) {
           return color * opacities.z * opacities.x;
         }
         vec4 bg = vec4(${c?o.H`backgroundColor`:o.H`gridColor(uv)`} * opacities.y, opacities.y);
         vec4 layer = color * opacities.z;
         return (bg * (1.0 - layer.a) + layer) * opacities.x;`,"return color;")}
    }`),l?r.code.add(o.H`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(o.H`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}class u extends a.x{constructor(e){super(e,"float")}}class h extends a.x{constructor(e){super(e,"vec3")}}class d extends a.x{constructor(e){super(e,"vec4")}}class p extends a.x{constructor(e){super(e,"sampler2D")}}},76763:(e,t,i)=>{i.d(t,{J:()=>p});i(81095);var r=i(23998),n=i(61296),s=i(66818),o=i(91238),a=i(58343),l=i(20200);function c(e,t){const i=t.blendMode;i!==r.iM.Normal&&(i===r.iM.Reflect&&e.code.add(l.H`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==r.iM.ColorDodge&&i!==r.iM.VividLight||e.code.add(l.H`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==r.iM.ColorBurn&&i!==r.iM.VividLight||e.code.add(l.H`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===r.iM.Overlay&&e.code.add(l.H`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===r.iM.HardLight&&e.code.add(l.H`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===r.iM.SoftLight&&e.code.add(l.H`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===r.iM.VividLight&&e.code.add(l.H`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==r.iM.Hue&&i!==r.iM.Saturation&&i!==r.iM.Color&&i!==r.iM.Luminosity||(e.code.add(l.H`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==r.iM.Hue&&i!==r.iM.Saturation||e.code.add(l.H`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(l.H`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===r.iM.Multiply?l.H`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Average?l.H`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Lighten?l.H`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Darken?l.H`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Lighter?l.H`return vec4(cl * ol + cb * ob, ol + ob);`:i===r.iM.Plus?l.H`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===r.iM.Minus?l.H`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===r.iM.Screen?l.H`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Difference?l.H`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Invert?l.H`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===r.iM.DestinationOver?l.H`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===r.iM.DestinationAtop?l.H`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===r.iM.DestinationOut?l.H`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===r.iM.SourceAtop?l.H`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===r.iM.SourceOut?l.H`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===r.iM.Xor?l.H`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===r.iM.DestinationIn?l.H`return vec4(cb * ob * ol, ol * ob);`:i===r.iM.SourceIn?l.H`return vec4(cl * ol * ob, ol * ob);`:i===r.iM.Hue?l.H`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Saturation?l.H`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Color?l.H`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Luminosity?l.H`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Exclusion?l.H`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Reflect?l.H`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.ColorDodge?l.H`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.ColorBurn?l.H`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.Overlay?l.H`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.SoftLight?l.H`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.HardLight?l.H`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===r.iM.VividLight?l.H`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l.H``}
    }
  `))}var u=i(43036),h=i(24603),d=i(15176);i(86765);function p(e,t){const i=t.output===o.l.GridComposite,p=t.output===o.l.ColorComposite,f=t.output===o.l.GroupBackgroundComposite,m=t.output===o.l.Composite,g=t.baseOpacityMode===s.I.Required,y=e.fragment;g&&y.uniforms.add(new h.p("baseOpacity",(e=>e.baseOpacity))),i?y.include(n.H):p?y.uniforms.add(new u.J("backgroundColor",(e=>e.backgroundColor))):m&&y.uniforms.add(new d.A("fboColor",(e=>e.fboTexture)));const _=t.blendMode!==r.iM.Normal,v=t.premultipliedSource===a.m.On,b=!_&&!v&&(m&&!g||f);y.include(c,t),y.code.add(l.H`
    vec4 getBackground(vec2 uv) {
      return ${g?l.H`baseOpacity *`:""} ${f?l.H`vec4(0.0, 0.0, 0.0, 0.0)`:p?l.H`vec4(backgroundColor, 1.0)`:i?l.H`vec4(gridColor(uv), 1.0)`:l.H`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${_?l.H`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:l.H`
          float composeAlpha = colorLayer.a * opacity;
          ${b?l.H`return colorLayer * opacity;`:l.H`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}},52191:(e,t,i)=>{var r;i.d(t,{R:()=>r}),function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"}(r||(r={}))},73721:(e,t,i)=>{i.d(t,{R:()=>c,T:()=>u});var r=i(84164),n=i(93072),s=i(24603),o=i(20200),a=i(21414),l=i(86765);class c extends l.K{constructor(){super(...arguments),this.scale=1,this.offset=r.AG}}function u(e){e.attributes.add(a.T.POSITION,"vec2"),e.attributes.add(a.T.UV0,"vec2"),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.uniforms.add(new s.p("scale",(e=>e.scale)),new n.A("offset",(e=>e.offset))),e.vertex.main.add(o.H`gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;`)}},77334:(e,t,i)=>{i.d(t,{GZ:()=>u});var r=i(36531),n=i(84164),s=i(56999),o=i(52721),a=i(80670),l=i(80967),c=i(20200);function u(e){e.fragment.uniforms.add(new l.$("projInfo",(e=>function(e){const t=e.projectionMatrix;return 0===t[11]?(0,s.s)(h,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):(0,s.s)(h,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}(e.camera)))),e.fragment.uniforms.add(new a.$("zScale",(e=>function(e){return 0===e.projectionMatrix[11]?(0,r.t8)(d,0,1):(0,r.t8)(d,1,0)}(e.camera)))),e.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const h=(0,o.Ue)();const d=(0,n.Ue)()},57758:(e,t,i)=>{i.d(t,{j:()=>y});var r=i(81095),n=i(14260),s=i(62700),o=i(76076),a=i(87698),l=i(58749),c=i(90381),u=i(20998),h=i(49016),d=i(20200),p=i(61002),f=i(5224),m=i(23474);class g extends m.x{constructor(e,t){super(e,"samplerCube",f.P.Bind,((i,r)=>i.bindTexture(e,t(r))))}}function y(e){const t=e.fragment;t.constants.add("radiusCloudsSquared","float",_).code.add(d.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),t.uniforms.add(new h.z("radiusCurvatureCorrection",(({clouds:e})=>e.parallax.radiusCurvatureCorrection))).code.add(d.H`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),t.code.add(d.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),(0,l.Pe)(t),(0,l.F1)(t);const i=(0,r.al)(.28,.175,.035);t.constants.add("RIM_COLOR","vec3",i);t.code.add(d.H`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${d.H.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${d.H.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${d.H.float(.2)} * pow(dirDotLight, ${d.H.float(10)}) * (1. - pow(sunsetTransition, ${d.H.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),t.uniforms.add(new c.U("readChannelsRG",(e=>e.clouds.readChannels===s.uz.RG)),new g("cubeMap",(e=>e.clouds.data?.cubeMap?.colorTexture??null))).code.add(d.H`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),t.uniforms.add(new u.d("anchorPoint",(e=>e.clouds.parallax.anchorPoint)),new u.d("anchorPointNew",(e=>e.clouds.parallaxNew.anchorPoint)),new p.C("rotationClouds",(e=>e.clouds.parallax.transform)),new p.C("rotationCloudsNew",(e=>e.clouds.parallaxNew.transform)),new h.z("cloudsOpacity",(e=>e.clouds.opacity)),new h.z("fadeFactor",(e=>e.clouds.fadeFactor)),new c.U("crossFade",(e=>e.clouds.fadeState===o.e.CROSS_FADE))).code.add(d.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const _=(n.sv.radius+a.$T)**2},32394:(e,t,i)=>{i.d(t,{Y:()=>n});var r=i(20200);function n(e){e.code.add(r.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},44866:(e,t,i)=>{i.d(t,{o:()=>c,z:()=>l});var r=i(90261),n=i(24603),s=i(20200),o=i(70984),a=i(5226);function l(e,t){u(e,t,new n.p("textureAlphaCutoff",(e=>e.textureAlphaCutoff)))}function c(e,t){u(e,t,new r.p("textureAlphaCutoff",(e=>e.textureAlphaCutoff)))}function u(e,t,i){const r=e.fragment,n=t.alphaDiscardMode,l=n===o.JJ.Blend;n!==o.JJ.Mask&&n!==o.JJ.MaskBlend||r.uniforms.add(i),r.code.add(s.H`
    void discardOrAdjustAlpha(inout vec4 color) {
      ${n===o.JJ.Opaque?"color.a = 1.0;":`if (color.a < ${l?s.H.float(a.e):"textureAlphaCutoff"}) {\n              discard;\n             } ${(0,s.If)(n===o.JJ.Mask,"else { color.a = 1.0; }")}`}
    }
  `)}},5331:(e,t,i)=>{i.d(t,{$:()=>n});var r=i(20200);function n({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(r.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(r.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}},94283:(e,t,i)=>{i.d(t,{U:()=>r,j:()=>s});var r,n=i(35925);function s(e){return e&&(0,n.BZ)(e)?r.Mars:e&&(0,n.V2)(e)?r.Moon:r.Earth}!function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"}(r||(r={}))},27452:(e,t,i)=>{i.d(t,{y:()=>o});var r=i(66352),n=i(32394),s=i(20200);function o(e){e.include(n.Y),e.code.add(s.H`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${s.H.int(r.a9.Multiply)}) {
        return allMixed;
      }
      if (mode == ${s.H.int(r.a9.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${s.H.int(r.a9.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${s.H.int(r.a9.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${s.H.int(r.a9.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}},52446:(e,t,i)=>{i.d(t,{f:()=>n});var r=i(20200);function n(e){e.code.add(r.H`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}},9794:(e,t,i)=>{i.d(t,{n:()=>n});var r=i(20200);function n(e){e.code.add(r.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),e.code.add(r.H`const vec4 RGBA_TO_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgbaTofloat(vec4 rgba) {
return dot(rgba, RGBA_TO_FLOAT_FACTORS);
}`),e.code.add(r.H`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)}},76774:(e,t,i)=>{i.d(t,{cK:()=>a,m8:()=>c,ww:()=>l});var r=i(86717),n=i(81095),s=i(43036),o=i(20200);function a(e){e.vertex.code.add(o.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(o.H`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(o.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(o.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function l(e){e.uniforms.add(new s.J("screenSizePerspective",(e=>u(e.screenSizePerspective))))}function c(e){e.uniforms.add(new s.J("screenSizePerspectiveAlignment",(e=>u(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function u(e){return(0,r.i)(h,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const h=(0,n.Ue)()},88862:(e,t,i)=>{i.d(t,{r:()=>n});var r=i(20200);function n(e){e.fragment.code.add(r.H`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}},84614:(e,t,i)=>{i.d(t,{Sv:()=>p,ZI:()=>y,_8:()=>g,hY:()=>d});var r=i(32114),n=i(3308),s=i(86717),o=i(81095),a=i(20998),l=i(32006),c=i(49016),u=i(61002),h=i(3875);function d(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",o.AG):e.uniforms.add(new l.B("cameraPosition",((e,t)=>(0,s.i)(m,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2]))))}function p(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add(new u.C("proj",(e=>e.camera.projectionMatrix)),new h.K("view",((e,t)=>(0,r.Iu)(f,t.camera.viewMatrix,e.origin))),new l.B("localOrigin",(e=>e.origin)));const i=({camera:e})=>(0,s.i)(m,e.viewInverseTransposeMatrix[3],e.viewInverseTransposeMatrix[7],e.viewInverseTransposeMatrix[11]);e.uniforms.add(new u.C("proj",(e=>e.camera.projectionMatrix)),new u.C("view",(e=>(0,r.Iu)(f,e.camera.viewMatrix,i(e)))),new a.d("localOrigin",(e=>i(e))))}const f=(0,n.Ue)(),m=(0,o.Ue)();function g(e){e.uniforms.add(new u.C("viewNormal",(e=>e.camera.viewInverseTransposeMatrix)))}function y(e){e.uniforms.add(new c.z("pixelRatio",(e=>e.camera.pixelRatio/e.overlayStretch)))}},90381:(e,t,i)=>{i.d(t,{U:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"bool",r.P.Bind,((i,r)=>i.setUniform1b(e,t(r))))}}},71278:(e,t,i)=>{i.d(t,{U:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"bool",r.P.Pass,((i,r,n)=>i.setUniform1b(e,t(r,n))))}}},80670:(e,t,i)=>{i.d(t,{$:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"vec2",r.P.Bind,((i,r)=>i.setUniform2fv(e,t(r))))}}},26482:(e,t,i)=>{i.d(t,{q:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"vec2",r.P.Draw,((i,r,n,s)=>i.setUniform2fv(e,t(r,n,s))))}}},93072:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"vec2",r.P.Pass,((i,r,n)=>i.setUniform2fv(e,t(r,n))))}}},20998:(e,t,i)=>{i.d(t,{d:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"vec3",r.P.Bind,((i,r)=>i.setUniform3fv(e,t(r))))}}},32006:(e,t,i)=>{i.d(t,{B:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"vec3",r.P.Draw,((i,r,n,s)=>i.setUniform3fv(e,t(r,n,s))))}}},43036:(e,t,i)=>{i.d(t,{J:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"vec3",r.P.Pass,((i,r,n)=>i.setUniform3fv(e,t(r,n))))}}},80967:(e,t,i)=>{i.d(t,{$:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"vec4",r.P.Bind,((i,r)=>i.setUniform4fv(e,t(r))))}}},40622:(e,t,i)=>{i.d(t,{$:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"vec4",r.P.Draw,((i,r,n)=>i.setUniform4fv(e,t(r,n))))}}},63371:(e,t,i)=>{i.d(t,{N:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"vec4",r.P.Pass,((i,r,n)=>i.setUniform4fv(e,t(r,n))))}}},36444:(e,t,i)=>{i.d(t,{b:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t,i){super(e,"vec4",r.P.Pass,((i,r,n)=>i.setUniform4fv(e,t(r,n))),i)}}},49016:(e,t,i)=>{i.d(t,{z:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"float",r.P.Bind,((i,r)=>i.setUniform1f(e,t(r))))}}},90261:(e,t,i)=>{i.d(t,{p:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"float",r.P.Draw,((i,r,n)=>i.setUniform1f(e,t(r,n))))}}},24603:(e,t,i)=>{i.d(t,{p:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"float",r.P.Pass,((i,r,n)=>i.setUniform1f(e,t(r,n))))}}},40335:(e,t,i)=>{i.d(t,{O:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t,i){super(e,"float",r.P.Pass,((i,r,n)=>i.setUniform1fv(e,t(r,n))),i)}}},97704:(e,t,i)=>{i.d(t,{Y:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"int",r.P.Bind,((i,r)=>i.setUniform1i(e,t(r))))}}},59842:(e,t,i)=>{i.d(t,{_:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"int",r.P.Pass,((i,r,n)=>i.setUniform1i(e,t(r,n))))}}},55784:(e,t,i)=>{i.d(t,{j:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"mat3",r.P.Draw,((i,r,n)=>i.setUniformMatrix3fv(e,t(r,n))))}}},11125:(e,t,i)=>{i.d(t,{c:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"mat3",r.P.Pass,((i,r,n)=>i.setUniformMatrix3fv(e,t(r,n))))}}},61002:(e,t,i)=>{i.d(t,{C:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"mat4",r.P.Bind,((i,r)=>i.setUniformMatrix4fv(e,t(r))))}}},3875:(e,t,i)=>{i.d(t,{K:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"mat4",r.P.Draw,((i,r,n)=>i.setUniformMatrix4fv(e,t(r,n))))}}},87621:(e,t,i)=>{i.d(t,{g:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"mat4",r.P.Pass,((i,r,n)=>i.setUniformMatrix4fv(e,t(r,n))))}}},49618:(e,t,i)=>{i.d(t,{G:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t,i){super(e,"mat4",r.P.Pass,((i,r,n)=>i.setUniformMatrix4fv(e,t(r,n))),i)}}},99126:(e,t,i)=>{i.d(t,{e:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"sampler2D",r.P.Bind,((i,r)=>i.bindTexture(e,t(r))))}}},37649:(e,t,i)=>{i.d(t,{R:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"sampler2D",r.P.Draw,((i,r,n)=>i.bindTexture(e,t(r,n))))}}},15176:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(5224),n=i(23474);class s extends n.x{constructor(e,t){super(e,"sampler2D",r.P.Pass,((i,r,n)=>i.bindTexture(e,t(r,n))))}}},20200:(e,t,i)=>{function r(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}function n(e,t,i=""){return e?t:i}i.d(t,{H:()=>r,If:()=>n}),function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(r)},9969:(e,t,i)=>{i.d(t,{J:()=>r});class r{constructor(e,t){this._module=e,this._load=t}get(){return this._module}async reload(){return this._module=await this._load(),this._module}}},62575:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(13802),n=i(61681),s=i(5474),o=i(17135),a=i(6174);class l{constructor(e,t,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new o.Z({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex",!0),t.generate("fragment",!0),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=t.generateBind(this),this.bindPass=t.generateBindPass(this),this.bindDraw=t.generateBindDraw(this),this._fragmentUniforms=(0,a.hZ)()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform2iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(null==t?.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let i=this._textures.get(e);return null==i?(i=this._allocTextureUnit(t),this._textures.set(e,i)):i.texture=t,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(t,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),this._fragmentUniforms?.forEach((e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}var c=i(91907),u=i(17346);class h{constructor(e,t,i,o=s.i){this.locations=o,this.primitiveType=c.MX.TRIANGLES,this.key=t.key,this._program=new l(e.rctx,i.get().build(t),o),this._pipeline=this.initializePipeline(t),this.reload=async s=>{s&&await i.reload(),this.key.equals(t.key)||r.Z.getLogger("esri.views.3d.webgl.ShaderTechnique").warn("Configuration was changed after construction, cannot reload shader.",i),(0,n.M2)(this._program),this._program=new l(e.rctx,i.get().build(t),o),this._pipeline=this.initializePipeline(t)}}destroy(){this._program=(0,n.M2)(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,t){return this._pipeline}initializePipeline(e){return(0,u.sm)({blending:u.xW,colorWrite:u.gf})}}},12907:(e,t,i)=>{i.d(t,{m:()=>a,o:()=>l});var r=i(70375),n=i(7753);class s{constructor(e){this._bits=[...e]}equals(e){return(0,n.fS)(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}}var o=i(86765);class a extends o.K{constructor(){super(),this._parameterBits=this._parameterBits?.map((()=>0))??[],this._parameterNames??=[]}get key(){return this._key??=new s(this._parameterBits),this._key}decode(e=this.key){const t=this._parameterBits;this._parameterBits=[...e.bits];const i=this._parameterNames.map((e=>`    ${e}: ${this[e]}`)).join("\n");return this._parameterBits=t,i}}function l(e={}){return(t,i)=>{t.hasOwnProperty("_parameterNames")||Object.defineProperty(t,"_parameterNames",{value:t._parameterNames?.slice()??[],configurable:!0,writable:!0}),t.hasOwnProperty("_parameterBits")||Object.defineProperty(t,"_parameterBits",{value:t._parameterBits?.slice()??[0],configurable:!0,writable:!0}),t._parameterNames.push(i);const n=e.count||2,s=Math.ceil(Math.log2(n)),o=t._parameterBits;let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);const l=o[a],c=(1<<s)-1<<l;o[a]+=s,e.count?Object.defineProperty(t,i,{get(){return(this._parameterBits[a]&c)>>l},set(t){if(this[i]!==t){if(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~c|+t<<l&c,"number"!=typeof t)throw new r.Z(`Configuration value for ${i} must be a number, got ${typeof t}`);if(null==e.count)throw new r.Z(`Configuration value for ${i} must provide a count option`)}}}):Object.defineProperty(t,i,{get(){return!!((this._parameterBits[a]&c)>>l)},set(e){if(this[i]!==e&&(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~c|+e<<l&c,"boolean"!=typeof e))throw new r.Z(`Configuration value for ${i} must be boolean, got ${typeof e}`)}})}}},18841:(e,t,i)=>{i.d(t,{D:()=>a,M:()=>o});var r=i(70375),n=(i(39994),i(22445)),s=i(12907);class o{constructor(e){this.context=e,this._debug=!1,this._precompiling=this._debug?0:1,this._cache=new n.r}get precompiling(){return this._precompiling}set precompiling(e){this._precompiling=e,0===e&&this.context.rctx.gl.flush()}get viewingMode(){return this.context.viewingMode}destroy(){this._cache.forAll((e=>e.destroy())),this._cache.clear()}precompile(e,t=a){++this.precompiling,this.get(e,t),--this.precompiling}get(e,t=a){const i=t.key.code;let n=this._cache.get(e,i);if(null==n){if(0===this._precompiling){let i=`Uncached shader compile in ${(new Error).stack}\n  for configuration\n${t.decode()}`;const n=this._cache.getInner(e);throw n?.size&&(i+="\n\n  cached configurations:\n",i+=Array.from(n.values()).map((e=>t.decode(e.key))).sort().join("\n\n")),console.log(i),new r.Z(i)}n=new e(this.context,t),this._cache.set(e,i,n)}return n}async reloadAll(){const e=new Array;this._cache.forEach((t=>e.push(async function(e){let t=!0;e.forEach((async e=>{await e.reload(t),t=!1}))}(t)))),await Promise.all(e)}}const a=new s.m},2653:(e,t,i)=>{i.d(t,{I:()=>o});var r=i(86717),n=i(17703),s=i(81095);class o{constructor(e){this._low=(0,s.Ue)(),this._high=(0,s.Ue)(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){(0,r.c)(this._low,(0,r.c)(a,e));const t=(0,r.a)(a,e,this._low);(0,r.c)(this._high,t)}get(e){return(0,r.g)(e,this._low,this._high)}getLowScaled(e){return(0,r.h)(e,this._low,1)}}const a=(0,n.Ue)()},36935:(e,t,i)=>{i.d(t,{hr:()=>c,jt:()=>s,of:()=>o,tY:()=>l});var r=i(74396),n=i(35031);const s={required:[]},o={required:[n.H_.Depth]};class a extends r.Z{precompile(e){return!!this.acquireTechniques(e)}consumes(){return s}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}}class l extends a{}class c extends a{}},62058:(e,t,i)=>{i.d(t,{N:()=>a});var r=i(73487),n=i(3995),s=i(42199),o=i(91907);class a{constructor(e,t=s.J.None){this._techniques=e,this._parameters=new r.C,this._configuration=new s.Z,this._configuration.blitMode=t,e.precompile(n.l,this._configuration)}blit(e,t,i,r){e.bindFramebuffer(i.fbo),e.setClearColor(0,0,0,1),e.clear(o.Hf.COLOR),this._parameters.texture=t.getTexture();const s=this._techniques.get(n.l,this._configuration);e.bindTechnique(s,r,this._parameters),e.screen.draw()}blend(e,t,i,r,s=1){this._configuration.hasOpacityFactor=s<1;const o=this._techniques.get(n.l,this._configuration);return!!o.compiled&&(e.bindFramebuffer(i.fbo),this._parameters.texture=t.getTexture(),this._parameters.opacity=s,e.bindTechnique(o,r,this._parameters),e.screen.draw(),!0)}}},43338:(e,t,i)=>{i.d(t,{B:()=>n});var r=i(39994);function n(){return!!(0,r.Z)("enable-feature:objectAndLayerId-rendering")}},2914:(e,t,i)=>{i.d(t,{y$:()=>U,m7:()=>H,yp:()=>B});var r=i(36663),n=(i(39994),i(61681)),s=i(76868),o=i(81977),a=(i(13802),i(4157),i(40266)),l=i(36531),c=i(52721),u=i(7590),h=i(37503),d=i(25534),p=i(9969),f=i(62575),m=i(64183),g=i(17346);class y extends f.A{constructor(e,t){super(e,t,new p.J(m.H,(()=>i.e(39175).then(i.bind(i,39175)))))}initializePipeline(){return(0,g.sm)({blending:g.Dh,colorWrite:g.gf})}}var _=i(37738);class v extends f.A{constructor(e,t){super(e,t,new p.J(_.a,(()=>i.e(23290).then(i.bind(i,23290)))))}initializePipeline(){return(0,g.sm)({colorWrite:g.gf})}}var b=i(67235),w=i(86765);class x extends w.K{constructor(){super(...arguments),this.occludedFactor=b.En,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}}var T=i(48658);class C extends f.A{constructor(e,t){super(e,t,new p.J(T.H,(()=>i.e(8834).then(i.bind(i,8834)))))}initializePipeline(){return(0,g.sm)({colorWrite:g.gf})}}var S=i(61008);class E extends f.A{constructor(e,t){super(e,t,new p.J(S.S,(()=>i.e(24474).then(i.bind(i,24474)))))}initializePipeline(){return(0,g.sm)({blending:g.Dh,colorWrite:g.gf})}}var M=i(95466);class A extends f.A{constructor(e,t){super(e,t,new p.J(M.a,(()=>i.e(76916).then(i.bind(i,76916)))))}initializePipeline(){return(0,g.sm)({colorWrite:g.gf})}}var R=i(70984),O=i(5474),P=i(71299),I=i(44125),L=i(78951),D=i(91907),N=i(43487),F=i(80479);let U=class extends d.Z{constructor(){super(...arguments),this.produces=u.CM.HIGHLIGHTS,this.consumes={required:[u.CM.HIGHLIGHTS,"highlights"]},this._useMultipleHighlights=!1,this._downsampleDrawParameters=new _.H,this._passParameters=new x,this._singleHighlightBlurDrawParameters=new M.S,this._grid=new k}initialize(){this.addHandles([(0,s.watch)((()=>this._updateOptionsTexture()),(()=>{}),s.initial)])}destroy(){this._grid.coverage=(0,n.RY)(this._grid.coverage),this._grid.vao=(0,n.M2)(this._grid.vao),this._passParameters.highlightOptionsTexture=(0,n.RY)(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(null==this._passParameters.highlightOptionsTexture){const e=new F.X(16,2);e.internalFormat=D.VI.RGBA,e.samplingMode=D.cw.NEAREST,this._passParameters.highlightOptionsTexture=new N.x(this.renderingContext,e,null)}this._passParameters.highlightOptionsTexture.setData(function(e){const t=new Uint8Array(128);let i=0;for(const r of e){const e=4*i,n=4*i+64;++i;const{color:s}=r,o=r.haloColor??s;t[e+0]=s.r,t[e+1]=s.g,t[e+2]=s.b,t[e+3]=r.fillOpacity*s.a*255,t[n+0]=o.r,t[n+1]=o.g,t[n+2]=o.b,t[n+3]=r.haloOpacity*o.a*255}return t}(this.view.state.highlights)),this.requestRender(R.Xx.UPDATE)}precompile(){this.techniques.precompile(v),this._useMultipleHighlights?this.techniques.precompile(y):(this.techniques.precompile(C),this.techniques.precompile(A),this.techniques.precompile(E))}render(e){const t=e.find((({name:e})=>e===u.CM.HIGHLIGHTS)),{techniques:i,bindParameters:r,_passParameters:n,renderingContext:s}=this;if(!r.decorations)return t;const o=i.get(v);if(!o.compiled)return this.requestRender(R.Xx.UPDATE),t;const a=e.find((({name:e})=>"highlights"===e)).getTexture(),l=()=>{this._gridUpdateResources(a);const e=this._gridComputeCoverage(o,a,r),{horizontalCellCount:t,verticalCellCount:i}=e;return n.horizontalCellCount=t,n.verticalCellCount=i,n.coverageTexture=e.coverage?.getTexture(),e},c=e=>{const t=e.verticalCellCount*e.horizontalCellCount;s.bindVAO(e.vao),s.drawElementsInstanced(D.MX.TRIANGLES,6,D.g.UNSIGNED_BYTE,0,t)},{camera:h}=r,d=()=>{s.bindFramebuffer(t.fbo),s.setViewport4fv(h.fullViewport)};return this._useMultipleHighlights?this._renderMultiple(a,l,c,d):this._renderSingle(a,l,c,d),n.highlightTexture=null,n.coverageTexture=null,t}_renderMultiple(e,t,i,r){const{techniques:n,bindParameters:s,_passParameters:o,renderingContext:a}=this,l=n.get(y);if(!l.compiled)return void this.requestRender(R.Xx.UPDATE);const c=t();o.highlightTexture=e,o.pixelRatio=s.camera.pixelRatio,a.bindTechnique(l,s,o),r(),i(c)}_renderSingle(e,t,i,r){const{fboCache:n,techniques:s,bindParameters:o,_passParameters:a,renderingContext:c}=this,u=s.get(C),d=s.get(A),p=s.get(E);if(!p.compiled||!d.compiled||!u.compiled)return void this.requestRender(R.Xx.UPDATE);const f=t(),{width:m,height:g}=e.descriptor;a.highlightTexture=e;const{camera:y}=o,{fullWidth:_,fullHeight:v,pixelRatio:b}=y,w=Math.ceil(_/b),x=Math.ceil(v/b),{_singleHighlightBlurDrawParameters:T}=this,S=this.view._stage.renderView.renderer,{highlights:M}=o;for(let e=0;e<M.length;++e){const{name:t}=M[e];if(!S.hasHighlightOptions(t))continue;a.highlightLevel=e,c.setClearColor(0,0,0,0);const s=n.acquire(m,g,"single highlight",h.q.RG);c.bindFramebuffer(s.fbo),c.setViewport(0,0,m,g),c.clear(D.Hf.COLOR),c.bindTechnique(u,o,a),i(f),T.blurInput=s.getTexture(),(0,l.t8)(T.blurSize,1/w,0);const y=n.acquire(w,x,"single highlight blur h",h.q.RG);c.unbindTexture(y.fbo?.colorTexture),c.bindFramebuffer(y.fbo),c.setViewport(0,0,w,x),c.clear(D.Hf.COLOR),c.bindTechnique(d,o,a,T),i(f),s.release(),(0,l.t8)(T.blurSize,0,1/x),a.singleHighlightBlurTexture=y.getTexture(),r(),c.bindTechnique(p,o,a,T),i(f),y.release()}}_gridUpdateResources(e){const t=this._grid,{width:i,height:r}=e.descriptor;if(t.horizontalCellCount=Math.ceil(i/_.g),t.verticalCellCount=Math.ceil(r/_.g),t.vao)return;const n=this.renderingContext,s=L.f.createIndex(n,D.l1.STATIC_DRAW,V);t.vao=new I.U(n,O.i,new Map([["geometry",P.gg]]),new Map([["geometry",L.f.createVertex(n,D.l1.STATIC_DRAW)]]),s)}_gridComputeCoverage(e,t,i){const r=this.renderingContext,n=this._grid,s=t.descriptor,o=Math.ceil(s.width/_.g),a=Math.ceil(s.height/_.g);this._downsampleDrawParameters.input=t,n.coverage?.release();const l=this.fboCache.acquire(o,a,"highlight coverage",h.q.RG);return n.coverage=l,r.bindFramebuffer(l.fbo),r.bindTechnique(e,i,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,o,a),r.screen.draw(),n}get test(){}};(0,r._)([(0,o.Cb)()],U.prototype,"produces",void 0),(0,r._)([(0,o.Cb)()],U.prototype,"consumes",void 0),U=(0,r._)([(0,a.j)("esri.views.3d.webgl-engine.effects.highlight.Highlight")],U);class k{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}}let z=0;function B(e){let t=0;for(const i of e){const{name:e}=i;t+=e.length;const{color:r,fillOpacity:n,haloColor:s,haloOpacity:o}=i;t+=r.r+r.g+r.b+r.a+n,t+=s?s.r+s.g+s.b+s.a+o:0}const i=e.at(0);if(i){const{shadowOpacity:e,shadowDifference:r,shadowColor:n}=i;t+=e+r+n.r+n.g+n.b+n.a}return z+++(t>=0?0:1)}const V=new Uint8Array([0,1,2,2,1,3]);function H(e,t,i,r,n,s=0){const o=r.highlights,a=o.length>1?t.acquire(i.width,i.height,"highlight mix",h.q.RG):null;if(a){const t=e.getBoundFramebufferObject();e.bindFramebuffer(a.fbo),e.clearFramebuffer(c.AG),e.bindFramebuffer(t)}const u=a?.getTexture();r.highlightMixTexture=u,(0,l.t8)(r.highlightMixOrigin,s,0),o.forEach(((t,o)=>{o>0&&(e.bindTexture(u,N.x.TEXTURE_UNIT_FOR_UPDATES),e.gl.copyTexSubImage2D(D.No.TEXTURE_2D,0,0,0,s,0,i.width,i.height),e.bindTexture(null,N.x.TEXTURE_UNIT_FOR_UPDATES)),e.clear(D.Hf.DEPTH),r.highlightLevel=o,n()})),r.highlightLevel=null,r.highlightMixTexture=null,a?.release()}},77738:(e,t,i)=>{i.d(t,{K:()=>L,s:()=>I});var r=i(36663),n=i(19431),s=i(61681),o=i(76868),a=i(12928),l=i(81977),c=(i(39994),i(13802),i(4157),i(40266)),u=i(36531),h=i(7590),d=i(37503),p=i(25534),f=i(37414),m=i(9969),g=i(62575),y=i(24756),_=i(17346);class v extends g.A{constructor(e,t){super(e,t,new m.J(y.S,(()=>i.e(99018).then(i.bind(i,99018)))))}initializePipeline(){return(0,_.sm)({colorWrite:_.gf})}}var b=i(84164),w=i(86765);class x extends w.K{constructor(){super(...arguments),this.projScale=1}}class T extends x{constructor(){super(...arguments),this.intensity=1}}class C extends w.K{}class S extends C{constructor(){super(...arguments),this.blurSize=(0,b.Ue)()}}var E=i(91800);class M extends g.A{constructor(e,t){super(e,t,new m.J(E.S,(()=>i.e(4168).then(i.bind(i,4168)))))}initializePipeline(){return(0,_.sm)({colorWrite:_.gf})}}var A=i(70984),R=i(91907),O=i(43487),P=i(80479);const I=2;let L=class extends p.Z{constructor(e){super(e),this.consumes={required:["normals"]},this.produces=h.CM.SSAO,this.isEnabled=()=>!1,this._enableTime=(0,a.HA)(0),this._passParameters=new T,this._drawParameters=new S}initialize(){const e=Uint8Array.from(atob("eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM"),(e=>e.charCodeAt(0))),t=new P.X;t.wrapMode=R.e8.CLAMP_TO_EDGE,t.pixelFormat=R.VI.RGB,t.wrapMode=R.e8.REPEAT,t.hasMipmap=!0,t.width=32,t.height=32,this._passParameters.noiseTexture=new O.x(this.renderingContext,t,e),this.techniques.precompile(M),this.techniques.precompile(v),this.addHandles((0,o.watch)((()=>this.isEnabled()),(()=>this._enableTime=(0,a.HA)(0))))}destroy(){this._passParameters.noiseTexture=(0,s.M2)(this._passParameters.noiseTexture)}render(e){const t=this.bindParameters,i=e.find((({name:e})=>"normals"===e)),r=i?.getTexture(),s=i?.getTexture(R.Lu),o=this.fboCache,l=t.camera,c=l.fullViewport[2],p=l.fullViewport[3],m=Math.round(c/I),g=Math.round(p/I),y=this.techniques.get(M),_=this.techniques.get(v);if(!y.compiled||!_.compiled)return this._enableTime=(0,a.HA)(performance.now()),this.requestRender(A.Xx.UPDATE),o.acquire(m,g,h.CM.SSAO,d.q.RED);0===this._enableTime&&(this._enableTime=(0,a.HA)(performance.now()));const b=this.renderingContext,w=this.view.qualitySettings.fadeDuration,x=l.relativeElevation,T=(0,n.uZ)((f.o-x)/(f.o-f.s),0,1),C=w>0?Math.min(w,performance.now()-this._enableTime)/w:1,S=C*T;this._passParameters.normalTexture=r,this._passParameters.depthTexture=s,this._passParameters.projScale=1/l.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*D/(0,E.g)(l)**6*S;const O=o.acquire(c,p,"ssao input",d.q.RG);b.bindFramebuffer(O.fbo),b.setViewport(0,0,c,p),b.bindTechnique(y,t,this._passParameters,this._drawParameters),b.screen.draw();const P=o.acquire(m,g,"ssao blur",d.q.RED);b.bindFramebuffer(P.fbo),this._drawParameters.colorTexture=O.getTexture(),(0,u.t8)(this._drawParameters.blurSize,0,I/p),b.bindTechnique(_,t,this._passParameters,this._drawParameters),b.setViewport(0,0,m,g),b.screen.draw(),O.release();const L=o.acquire(m,g,h.CM.SSAO,d.q.RED);return b.bindFramebuffer(L.fbo),b.setViewport(0,0,c,p),b.setClearColor(1,1,1,0),b.clear(R.Hf.COLOR),this._drawParameters.colorTexture=P.getTexture(),(0,u.t8)(this._drawParameters.blurSize,I/c,0),b.bindTechnique(_,t,this._passParameters,this._drawParameters),b.setViewport(0,0,m,g),b.screen.draw(),b.setViewport4fv(l.fullViewport),P.release(),C<1&&this.requestRender(A.Xx.UPDATE),L}};(0,r._)([(0,l.Cb)()],L.prototype,"consumes",void 0),(0,r._)([(0,l.Cb)()],L.prototype,"produces",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],L.prototype,"isEnabled",void 0),L=(0,r._)([(0,c.j)("esri.views.3d.webgl-engine.effects.ssao.SSAO")],L);const D=.5},85799:(e,t,i)=>{i.d(t,{U:()=>r,a:()=>n});class r{constructor(e,t,i=t){this.data=e,this.size=t,this.stride=i}}class n extends r{constructor(e,t,i,r=!1,n=i){super(e,i,n),this.indices=t,this.exclusive=r}}},42985:(e,t,i)=>{i.d(t,{C:()=>n});var r=i(86098);function n(e){if(e.length<r.c8)return Array.from(e);if(Array.isArray(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return(0,r.Uc)(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}},77416:(e,t,i)=>{i.d(t,{fX:()=>y,pk:()=>_,$u:()=>d,_h:()=>p,rv:()=>h});var r=i(36567);let n;var s=i(26503),o=i(91907),a=i(43487),l=i(62486);let c=null,u=null;async function h(){return null==u&&(n??=(async()=>{const e=await i.e(21681).then(i.bind(i,21681)),t=await e.default({locateFile:e=>(0,r.V)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})(),u=n,c=await u),u}function d(e,t){if(null==c)return e.byteLength;const i=new c.BasisFile(new Uint8Array(e)),r=m(i)?f(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function p(e,t){if(null==c)return e.byteLength;const i=new c.KTX2File(new Uint8Array(e)),r=g(i)?f(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function f(e,t,i,r,n){const s=(0,l.RG)(t?o.q_.COMPRESSED_RGBA8_ETC2_EAC:o.q_.COMPRESSED_RGB8_ETC2),a=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*s*a)}function m(e){return e.getNumImages()>=1&&!e.isUASTC()}function g(e){return e.getFaces()>=1&&e.isETC1S()}async function y(e,t,i){null==c&&(c=await h());const r=new c.BasisFile(new Uint8Array(i));if(!m(r))return null;r.startTranscoding();const n=v(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),((e,t)=>r.getImageTranscodedSizeInBytes(0,e,t)),((e,t,i)=>r.transcodeImage(i,0,e,t,0,0)));return r.close(),r.delete(),n}async function _(e,t,i){null==c&&(c=await h());const r=new c.KTX2File(new Uint8Array(i));if(!g(r))return null;r.startTranscoding();const n=v(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),((e,t)=>r.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,i)=>r.transcodeImage(i,e,0,0,t,0,-1,-1)));return r.close(),r.delete(),n}function v(e,t,i,r,n,l,c,u){const{compressedTextureETC:h,compressedTextureS3TC:d}=e.capabilities,[p,f]=h?r?[s.E.ETC2_RGBA,o.q_.COMPRESSED_RGBA8_ETC2_EAC]:[s.E.ETC1_RGB,o.q_.COMPRESSED_RGB8_ETC2]:d?r?[s.E.BC3_RGBA,o.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[s.E.BC1_RGB,o.q_.COMPRESSED_RGB_S3TC_DXT1_EXT]:[s.E.RGBA32,o.VI.RGBA],m=t.hasMipmap?i:Math.min(1,i),g=[];for(let e=0;e<m;e++)g.push(new Uint8Array(c(e,p))),u(e,p,g[e]);return t.internalFormat=f,t.hasMipmap=g.length>1,t.samplingMode=t.hasMipmap?o.cw.LINEAR_MIPMAP_LINEAR:o.cw.LINEAR,t.width=n,t.height=l,new a.x(e,t,{type:"compressed",levels:g})}},85211:(e,t,i)=>{i.d(t,{Z:()=>d,p:()=>p});var r=i(3308),n=i(84164),s=i(76076),o=i(5512),a=i(55803),l=i(97994),c=i(46378),u=i(11722),h=i(39501);class d{constructor(e,t){this.width=e,this.height=t}}class p{constructor(e){this.shadowMap=e,this.slot=c.r.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=l.M.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new o.Z,this._inverseViewport=(0,n.Ue)(),this._oldLighting=new h.cI,this._newLighting=new h.cI,this._fadedLighting=new h.cI,this._lighting=this._newLighting,this.ssr=new f,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=(0,n.Ue)(),this.highlightMixTexture=null,this.hudRenderStyle=a.U.Occluded,this.hudOccludedFragmentOpacity=1,this.clouds=new s.K,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,t,i,r){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=t,this._newLighting.globalFactor=i,this._newLighting.set(e),r===u.B.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return null==this.highlightLevel?null:this.highlights[this.highlightLevel]}}class f{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,r.Ue)()}}},34106:(e,t,i)=>{i.d(t,{j:()=>a});var r=i(17135),n=i(86717),s=i(81095),o=i(15095);class a{constructor(e,t,i){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=i,this._children=void 0,(0,o.hu)(e.length>=1),(0,o.hu)(3===i.size||4===i.size);const{data:r,size:a,indices:c}=i;(0,o.hu)(c.length%this._numIndexPerPrimitive==0),(0,o.hu)(c.length>=e.length*this._numIndexPerPrimitive);const u=e.length;let h=a*c[this._numIndexPerPrimitive*e[0]];l.clear(),l.push(h);const d=(0,s.al)(r[h],r[h+1],r[h+2]),p=(0,s.d9)(d);for(let t=0;t<u;++t){const i=this._numIndexPerPrimitive*e[t];for(let e=0;e<this._numIndexPerPrimitive;++e){h=a*c[i+e],l.push(h);let t=r[h];d[0]=Math.min(t,d[0]),p[0]=Math.max(t,p[0]),t=r[h+1],d[1]=Math.min(t,d[1]),p[1]=Math.max(t,p[1]),t=r[h+2],d[2]=Math.min(t,d[2]),p[2]=Math.max(t,p[2])}}this.bbMin=d,this.bbMax=p;const f=(0,n.m)((0,s.Ue)(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(p[0]-d[0],p[1]-d[1]),p[2]-d[2]);let m=this.radius*this.radius;for(let e=0;e<l.length;++e){h=l.at(e);const t=r[h]-f[0],i=r[h+1]-f[1],n=r[h+2]-f[2],s=t*t+i*i+n*n;if(s<=m)continue;const o=Math.sqrt(s),a=.5*(o-this.radius);this.radius=this.radius+a,m=this.radius*this.radius;const c=a/o;f[0]+=t*c,f[1]+=i*c,f[2]+=n*c}this.center=f,l.clear()}getChildren(){if(this._children||(0,n.s)(this.bbMin,this.bbMax)<=1)return this._children;const e=(0,n.m)((0,s.Ue)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,i=new Uint8Array(t),r=new Array(8);for(let e=0;e<8;++e)r[e]=0;const{data:o,size:l,indices:c}=this.position;for(let n=0;n<t;++n){let t=0;const s=this._numIndexPerPrimitive*this.primitiveIndices[n];let a=l*c[s],u=o[a],h=o[a+1],d=o[a+2];for(let e=1;e<this._numIndexPerPrimitive;++e){a=l*c[s+e];const t=o[a],i=o[a+1],r=o[a+2];t<u&&(u=t),i<h&&(h=i),r<d&&(d=r)}u<e[0]&&(t|=1),h<e[1]&&(t|=2),d<e[2]&&(t|=4),i[n]=t,++r[t]}let u=0;for(let e=0;e<8;++e)r[e]>0&&++u;if(u<2)return;const h=new Array(8);for(let e=0;e<8;++e)h[e]=r[e]>0?new Uint32Array(r[e]):void 0;for(let e=0;e<8;++e)r[e]=0;for(let e=0;e<t;++e){const t=i[e];h[t][r[t]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)void 0!==h[e]&&this._children.push(new a(h[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){l.prune()}}const l=new r.Z({deallocator:null})},2236:(e,t,i)=>{i.d(t,{as:()=>n,t9:()=>o});var r=i(17135);class n{constructor(){this.adds=new r.Z,this.removes=new r.Z,this.updates=new r.Z({allocator:e=>e||new s,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class s{}class o{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},10107:(e,t,i)=>{i.d(t,{c:()=>n});var r=i(7958);class n{constructor(){this.id=(0,r.D)()}}},95399:(e,t,i)=>{var r;i.d(t,{U:()=>r}),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"}(r||(r={}))},5474:(e,t,i)=>{i.d(t,{i:()=>n});var r=i(21414);const n=new Map([[r.T.POSITION,0],[r.T.NORMAL,1],[r.T.NORMALCOMPRESSED,1],[r.T.UV0,2],[r.T.COLOR,3],[r.T.COLORFEATUREATTRIBUTE,3],[r.T.SIZE,4],[r.T.TANGENT,4],[r.T.CENTEROFFSETANDDISTANCE,5],[r.T.SYMBOLCOLOR,5],[r.T.FEATUREATTRIBUTE,6],[r.T.INSTANCEFEATUREATTRIBUTE,6],[r.T.INSTANCECOLOR,7],[r.T.OBJECTANDLAYERIDCOLOR,7],[r.T.INSTANCEOBJECTANDLAYERIDCOLOR,7],[r.T.ROTATION,8],[r.T.INSTANCEMODEL,8],[r.T.INSTANCEMODELNORMAL,12],[r.T.INSTANCEMODELORIGINHI,11],[r.T.INSTANCEMODELORIGINLO,15]])},71299:(e,t,i)=>{i.d(t,{Bn:()=>c,QI:()=>l,ap:()=>a,gg:()=>o});var r=i(21414),n=i(91907),s=i(41163);const o=[],a=[new s.G(r.T.POSITION,3,n.g.FLOAT,0,12)],l=[new s.G(r.T.POSITION,2,n.g.FLOAT,0,8)],c=[new s.G(r.T.POSITION,2,n.g.FLOAT,0,16),new s.G(r.T.UV0,2,n.g.FLOAT,8,16)]},19453:(e,t,i)=>{i.d(t,{P:()=>r});class r{constructor(e=1/0,t=-1/0){this.near=e,this.far=t}set(e,t){this.near=e,this.far=t}union(e){null!=e&&(this.near=Math.min(this.near,e.near),this.far=Math.max(this.far,e.far))}within(e){return this.near<=e&&e<=this.far}}r.zero=new r(0,0)},39803:(e,t,i)=>{i.d(t,{U:()=>n});var r=i(15334);function n(e){const{size:t}=e.definition,i=e.fontString(t);let n=s.get(i);if(!n){const c=(0,r.G)(a,0,0).getContext("2d");e.setFontProperties(c,t);const u=c.measureText(l);n=new o(u.actualBoundingBoxAscent,u.actualBoundingBoxDescent),s.set(i,n)}return n}const s=new Map;class o{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,t){this.maxAscent=e,this.maxDescent=t}}const a={canvas:null},l=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})()},5079:(e,t,i)=>{i.d(t,{Z:()=>n});var r=i(70984);class n{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}getTechnique(e,t){return this._techniques.get(e,this._material.getConfiguration(this._output,t))}ensureResources(e){return r.Rw.LOADED}}},55982:(e,t,i)=>{i.d(t,{h:()=>a});var r=i(13802),n=i(61681),s=i(22445),o=i(15095);class a{constructor(e,t,i,r){this._textures=e,this._techniques=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new s.r}dispose(){this._textures.destroy()}acquire(e,t,i){this._ownMaterial(e);if(!e.produces.get(t)?.(i))return null;let r=this._id2glMaterialRef.get(i,e.id);if(null==r){const t=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:i});r=new l(t),this._id2glMaterialRef.set(i,e.id,r)}return r.ref(),r.glMaterial}release(e,t){const i=this._id2glMaterialRef.get(t,e.id);null!=i&&(i.unref(),i.referenced||((0,n.M2)(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&r.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class l{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,o.hu)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}},71399:(e,t,i)=>{i.d(t,{p:()=>n});var r=i(70984);class n{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,i){if(!this._material.produces.get(t)?.(i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,t,i));const n=this._map.get(i);if(null!=n){if(n.ensureResources(e)===r.Rw.LOADED)return n;this._repository.requestRender()}return null}}},80776:(e,t,i)=>{i.d(t,{EY:()=>u,Fj:()=>l});var r=i(61681),n=i(78668),s=i(70984),o=i(5079),a=i(86765);class l extends o.Z{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this.updateTexture(e.textureId),this._acquire(e.normalTextureId,(e=>this._textureNormal=e)),this._acquire(e.emissiveTextureId,(e=>this._textureEmissive=e)),this._acquire(e.occlusionTextureId,(e=>this._textureOcclusion=e)),this._acquire(e.metallicRoughnessTextureId,(e=>this._textureMetallicRoughness=e))}dispose(){super.dispose(),this._texture=(0,r.RY)(this._texture),this._textureNormal=(0,r.RY)(this._textureNormal),this._textureEmissive=(0,r.RY)(this._textureEmissive),this._textureOcclusion=(0,r.RY)(this._textureOcclusion),this._textureMetallicRoughness=(0,r.RY)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?s.Rw.LOADED:s.Rw.LOADING}get textureBindParameters(){return new u(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){null!=this._texture&&e===this._texture.id||(this._texture=(0,r.RY)(this._texture),this._textureId=e,this._acquire(this._textureId,(e=>this._texture=e)))}_acquire(e,t){if(null==e)return void t(null);const i=this._textures.acquire(e);if((0,n.y8)(i))return++this._numLoading,void i.then((e=>{if(this._disposed)return(0,r.RY)(e),void t(null);t(e)})).finally((()=>--this._numLoading));t(i)}}class c extends a.K{constructor(e=null){super(),this.textureEmissive=e}}class u extends c{constructor(e=null,t=null,i=null,r=null,n=null,s,o){super(i),this.texture=e,this.textureNormal=t,this.textureOcclusion=r,this.textureMetallicRoughness=n,this.scale=s,this.normalTextureTransformMatrix=o}}},63885:(e,t,i)=>{i.d(t,{Z:()=>v});var r=i(3308),n=i(86717),s=i(35914),o=i(42985),a=i(34106),l=i(10107),c=i(95399),u=i(81095),h=i(42772);const d=(0,u.Ue)(),p=(0,u.Ue)(),f=(0,u.Ue)(),m=(0,u.Ue)();var g=i(31248),y=i(15095),_=i(21414);class v extends l.c{constructor(e,t,i=null,r=c.U.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=i,this.type=r,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.highlights=new Set,this._highlightOptionsCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[e,i]of t)this._attributes.set(e,{...i,indices:(0,s.mi)(i.indices)}),e===_.T.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(e).indices.length:this.edgeIndicesLength)}instantiate(e={}){const t=new v(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach(((e,i)=>{e.exclusive=!1,t._attributes.set(i,e)})),t._boundingInfo=this._boundingInfo,t.transformation=e.transformation||this.transformation,t}get attributes(){return this._attributes}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:(0,o.C)(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){const i=this._attributes.get(e);i&&this._attributes.set(e,{...i,exclusive:!0,data:t})}get indexCount(){const e=this._attributes.values().next().value?.indices;return e?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===c.U.Mesh?this._computeAttachmentOriginTriangles(e):this.type===c.U.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(null!=this._transformation&&(0,n.t)(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){return function(e,t){if(!e)return!1;const{size:i,data:r,indices:s}=e;(0,n.i)(t,0,0,0),(0,n.i)(m,0,0,0);let o=0,a=0;for(let e=0;e<s.length-2;e+=3){const l=s[e]*i,c=s[e+1]*i,u=s[e+2]*i;(0,n.i)(d,r[l],r[l+1],r[l+2]),(0,n.i)(p,r[c],r[c+1],r[c+2]),(0,n.i)(f,r[u],r[u+1],r[u+2]);const g=(0,h.bE)(d,p,f);g?((0,n.g)(d,d,p),(0,n.g)(d,d,f),(0,n.h)(d,d,1/3*g),(0,n.g)(t,t,d),o+=g):((0,n.g)(m,m,d),(0,n.g)(m,m,p),(0,n.g)(m,m,f),a+=3)}return!(0===a&&0===o||(0!==o?((0,n.h)(t,t,1/o),0):0===a||((0,n.h)(t,m,1/a),0)))}(this.attributes.get(_.T.POSITION),e)}_computeAttachmentOriginLines(e){const t=this.attributes.get(_.T.POSITION);return function(e,t,i){if(!e)return!1;(0,n.i)(i,0,0,0),(0,n.i)(m,0,0,0);let r=0,s=0;const{size:o,data:a,indices:l}=e,c=l.length-1,u=c+(t?2:0);for(let e=0;e<u;e+=2){const t=e<c?e+1:0,u=l[e<c?e:c]*o,h=l[t]*o;d[0]=a[u],d[1]=a[u+1],d[2]=a[u+2],p[0]=a[h],p[1]=a[h+1],p[2]=a[h+2],(0,n.h)(d,(0,n.g)(d,d,p),.5);const f=(0,n.G)(d,p);f>0?((0,n.g)(i,i,(0,n.h)(d,d,f)),r+=f):0===r&&((0,n.g)(m,m,d),s++)}return 0!==r?((0,n.h)(i,i,1/r),!0):0!==s&&((0,n.h)(i,m,1/s),!0)}(t,function(e,t){return!(!("isClosed"in e)||!e.isClosed)&&t.indices.length>2}(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){return function(e,t){if(!e)return!1;const{size:i,data:r,indices:s}=e;(0,n.i)(t,0,0,0);let o=-1,a=0;for(let e=0;e<s.length;e++){const n=s[e]*i;o!==n&&(t[0]+=r[n],t[1]+=r[n+1],t[2]+=r[n+2],a++),o=n}return a>1&&(0,n.h)(t,t,1/a),a>0}(this.attributes.get(_.T.POSITION),e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(_.T.POSITION);if(!e||0===e.indices.length)return null;const t=this.type===c.U.Mesh?3:1;(0,y.hu)(e.indices.length%t==0,"Indexing error: "+e.indices.length+" not divisible by "+t);const i=(0,s.KF)(e.indices.length/t);return new a.j(i,t,e)}get transformation(){return this._transformation??r.Wd}set transformation(e){this._transformation=e&&e!==r.Wd?(0,r.d9)(e):null}get highlightNames(){return this._highlightOptionsCounts}get hasHighlights(){return this._highlightOptionsCounts.size>0}foreachHighlightOptions(e){this._highlightOptionsCounts.forEach(((t,i)=>e(i)))}allocateIdAndHighlight(e){const t=new g.j(e);return this.addHighlight(t)}addHighlight(e){this.highlights.add(e);const{highlightName:t}=e,i=(this._highlightOptionsCounts.get(t)??0)+1;return this._highlightOptionsCounts.set(t,i),e}removeHighlight(e){if(this.highlights.delete(e)){const{highlightName:t}=e,i=this._highlightOptionsCounts.get(t)??0;i<=1?this._highlightOptionsCounts.delete(t):this._highlightOptionsCounts.set(t,i-1)}}}},6087:(e,t,i)=>{i.d(t,{Cr:()=>ne,IG:()=>C,QL:()=>X,ns:()=>J,nb:()=>K,B2:()=>R,DA:()=>ie,x2:()=>ee,dV:()=>W,xu:()=>q,mj:()=>Z,rh:()=>te,PI:()=>j,g7:()=>Y,AW:()=>G,PD:()=>Q,Ay:()=>oe,mx:()=>re});var r,n=i(86717),s=i(17703),o=i(81095),a=i(92570),l=i(31725),c=i(35914),u=i(69430),h=i(97537),d=i(85799);!function(e){e.length=function(e,t){const i=e[t],r=e[t+1],n=e[t+2];return Math.sqrt(i*i+r*r+n*n)},e.normalize=function(e,t){const i=e[t],r=e[t+1],n=e[t+2],s=1/Math.sqrt(i*i+r*r+n*n);e[t]*=s,e[t+1]*=s,e[t+2]*=s},e.scale=function(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i},e.add=function(e,t,i,r,n,s=t){(n=n||e)[s]=e[t]+i[r],n[s+1]=e[t+1]+i[r+1],n[s+2]=e[t+2]+i[r+2]},e.subtract=function(e,t,i,r,n,s=t){(n=n||e)[s]=e[t]-i[r],n[s+1]=e[t+1]-i[r+1],n[s+2]=e[t+2]-i[r+2]}}(r||(r={}));var p=i(95399),f=i(63885),m=i(15095),g=i(21414);const y=r,_=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],v=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],b=[0,0,1,0,1,1,0,1],w=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],x=new Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)x[6*e+t]=e;const T=new Array(36);for(let e=0;e<6;e++)T[6*e]=0,T[6*e+1]=1,T[6*e+2]=2,T[6*e+3]=2,T[6*e+4]=3,T[6*e+5]=0;function C(e,t){Array.isArray(t)||(t=[t,t,t]);const i=new Array(24);for(let e=0;e<8;e++)i[3*e]=_[e][0]*t[0],i[3*e+1]=_[e][1]*t[1],i[3*e+2]=_[e][2]*t[2];return new f.Z(e,[[g.T.POSITION,new d.a(i,w,3,!0)],[g.T.NORMAL,new d.a(v,x,3)],[g.T.UV0,new d.a(b,T,2)]])}const S=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],E=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],M=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],A=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function R(e,t){Array.isArray(t)||(t=[t,t,t]);const i=new Array(18);for(let e=0;e<6;e++)i[3*e]=S[e][0]*t[0],i[3*e+1]=S[e][1]*t[1],i[3*e+2]=S[e][2]*t[2];return new f.Z(e,[[g.T.POSITION,new d.a(i,M,3,!0)],[g.T.NORMAL,new d.a(E,A,3)]])}const O=(0,s.al)(-.5,0,-.5),P=(0,s.al)(.5,0,-.5),I=(0,s.al)(0,0,.5),L=(0,s.al)(0,.5,0),D=(0,s.Ue)(),N=(0,s.Ue)(),F=(0,s.Ue)(),U=(0,s.Ue)(),k=(0,s.Ue)();(0,n.d)(D,O,L),(0,n.d)(N,O,P),(0,n.e)(F,D,N),(0,n.n)(F,F),(0,n.d)(D,P,L),(0,n.d)(N,P,I),(0,n.e)(U,D,N),(0,n.n)(U,U),(0,n.d)(D,I,L),(0,n.d)(N,I,O),(0,n.e)(k,D,N),(0,n.n)(k,k);const z=[O,P,I,L],B=[0,-1,0,F[0],F[1],F[2],U[0],U[1],U[2],k[0],k[1],k[2]],V=[0,1,2,3,1,0,3,2,1,3,0,2],H=[0,0,0,1,1,1,2,2,2,3,3,3];function G(e,t){Array.isArray(t)||(t=[t,t,t]);const i=new Array(12);for(let e=0;e<4;e++)i[3*e]=z[e][0]*t[0],i[3*e+1]=z[e][1]*t[1],i[3*e+2]=z[e][2]*t[2];return new f.Z(e,[[g.T.POSITION,new d.a(i,V,3,!0)],[g.T.NORMAL,new d.a(B,H,3)]])}function j(e,t,i,r,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,u=Math.PI,h=Math.max(3,Math.floor(i)),p=Math.max(2,Math.floor(r)),m=(h+1)*(p+1),y=(0,l.xx)(3*m),_=(0,l.xx)(3*m),v=(0,l.xx)(2*m),b=[];let w=0;for(let e=0;e<=p;e++){const i=[],r=e/p,n=a+r*u,l=Math.cos(n);for(let e=0;e<=h;e++){const a=e/h,c=s+a*o,u=Math.cos(c)*l,d=Math.sin(n),p=-Math.sin(c)*l;y[3*w]=u*t,y[3*w+1]=d*t,y[3*w+2]=p*t,_[3*w]=u,_[3*w+1]=d,_[3*w+2]=p,v[2*w]=a,v[2*w+1]=r,i.push(w),++w}b.push(i)}const x=new Array;for(let e=0;e<p;e++)for(let t=0;t<h;t++){const i=b[e][t],r=b[e][t+1],n=b[e+1][t+1],s=b[e+1][t];0===e?(x.push(i),x.push(n),x.push(s)):e===p-1?(x.push(i),x.push(r),x.push(n)):(x.push(i),x.push(r),x.push(n),x.push(n),x.push(s),x.push(i))}const T=[[g.T.POSITION,new d.a(y,x,3,!0)],[g.T.NORMAL,new d.a(_,x,3,!0)]];return n.uv&&T.push([g.T.UV0,new d.a(v,x,2,!0)]),n.offset&&(T[0][0]=g.T.OFFSET,T.push([g.T.POSITION,new d.a(Float64Array.from(n.offset),(0,c.LE)(x.length),3,!0)])),new f.Z(e,T)}function Z(e,t,i,r){const n=q(t,i,r);return new f.Z(e,n)}function q(e,t,i){const r=e;let n,s;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=r*(1+Math.sqrt(5))/2;n=[-r,e,0,r,e,0,-r,-e,0,r,-e,0,0,-r,e,0,r,e,0,-r,-e,0,r,-e,e,0,-r,e,0,r,-e,0,-r,-e,0,r],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let t=0;t<n.length;t+=3)y.scale(n,t,e/y.length(n,t));let o={};function a(t,i){t>i&&([t,i]=[i,t]);const r=t.toString()+"."+i.toString();if(o[r])return o[r];let s=n.length;return n.length+=3,y.add(n,3*t,n,3*i,n,s),y.scale(n,s,e/y.length(n,s)),s/=3,o[r]=s,s}for(let e=0;e<t;e++){const e=s.length,t=new Array(4*e);for(let i=0;i<e;i+=3){const e=s[i],r=s[i+1],n=s[i+2],o=a(e,r),l=a(r,n),c=a(n,e),u=4*i;t[u]=e,t[u+1]=o,t[u+2]=c,t[u+3]=r,t[u+4]=l,t[u+5]=o,t[u+6]=n,t[u+7]=c,t[u+8]=l,t[u+9]=o,t[u+10]=l,t[u+11]=c}s=t,o={}}const c=(0,l.XO)(n);for(let e=0;e<c.length;e+=3)y.normalize(c,e);return[[g.T.POSITION,new d.a((0,l.XO)(n),s,3,!0)],[g.T.NORMAL,new d.a(c,s,3,!0)]]}function W(e,t={}){const{normal:i,position:r,color:n,rotation:s,size:a,centerOffsetAndDistance:l,uvs:u,featureAttribute:h,objectAndLayerIdColor:m=null}=t,y=r?(0,o.d9)(r):(0,o.Ue)(),_=i?(0,o.d9)(i):(0,o.al)(0,0,1),v=n?[255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]:[255,255,255,255],b=null!=a&&2===a.length?a:[1,1],w=null!=s?[s]:[0],x=(0,c.LE)(1),T=[[g.T.POSITION,new d.a(y,x,3,!0)],[g.T.NORMAL,new d.a(_,x,3,!0)],[g.T.COLOR,new d.a(v,x,4,!0)],[g.T.SIZE,new d.a(b,x,2)],[g.T.ROTATION,new d.a(w,x,1,!0)]];if(u&&T.push([g.T.UV0,new d.a(u,x,u.length)]),null!=l){const e=[l[0],l[1],l[2],l[3]];T.push([g.T.CENTEROFFSETANDDISTANCE,new d.a(e,x,4)])}if(h){const e=[h[0],h[1],h[2],h[3]];T.push([g.T.FEATUREATTRIBUTE,new d.a(e,x,4)])}return new f.Z(e,T,null,p.U.Point,m)}const $=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Y(e,t=$){const i=new Array(12);for(let e=0;e<4;e++)for(let r=0;r<3;r++)i[3*e+r]=t[e][r];const r=[0,1,2,2,3,0],n=[0,0,0,0,0,0],s=[[g.T.POSITION,new d.a(i,r,3,!0)],[g.T.NORMAL,new d.a([0,0,1],n,3,!0)],[g.T.UV0,new d.a([0,0,1,0,1,1,0,1],r,2,!0)],[g.T.COLOR,new d.a([255,255,255,255],n,4,!0)]];return new f.Z(e,s)}function J(e,t,i,r,n=!0,o=!0){let a=0;const c=t,u=e;let h=(0,s.al)(0,a,0),p=(0,s.al)(0,a+u,0),f=(0,s.al)(0,-1,0),m=(0,s.al)(0,1,0);r&&(a=u,p=(0,s.al)(0,0,0),h=(0,s.al)(0,a,0),f=(0,s.al)(0,1,0),m=(0,s.al)(0,-1,0));const y=[p,h],_=[f,m],v=i+2,b=Math.sqrt(u*u+c*c);if(r)for(let e=i-1;e>=0;e--){const t=e*(2*Math.PI/i),r=(0,s.al)(Math.cos(t)*c,a,Math.sin(t)*c);y.push(r);const n=(0,s.al)(u*Math.cos(t)/b,-c/b,u*Math.sin(t)/b);_.push(n)}else for(let e=0;e<i;e++){const t=e*(2*Math.PI/i),r=(0,s.al)(Math.cos(t)*c,a,Math.sin(t)*c);y.push(r);const n=(0,s.al)(u*Math.cos(t)/b,c/b,u*Math.sin(t)/b);_.push(n)}const w=new Array,x=new Array;if(n){for(let e=3;e<y.length;e++)w.push(1),w.push(e-1),w.push(e),x.push(0),x.push(0),x.push(0);w.push(y.length-1),w.push(2),w.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let e=3;e<y.length;e++)w.push(e),w.push(e-1),w.push(0),x.push(e),x.push(e-1),x.push(1);w.push(0),w.push(2),w.push(y.length-1),x.push(1),x.push(2),x.push(_.length-1)}const T=(0,l.xx)(3*v);for(let e=0;e<v;e++)T[3*e]=y[e][0],T[3*e+1]=y[e][1],T[3*e+2]=y[e][2];const C=(0,l.xx)(3*v);for(let e=0;e<v;e++)C[3*e]=_[e][0],C[3*e+1]=_[e][1],C[3*e+2]=_[e][2];return[[g.T.POSITION,new d.a(T,w,3,!0)],[g.T.NORMAL,new d.a(C,x,3,!0)]]}function X(e,t,i,r,n,s=!0,o=!0){return new f.Z(e,J(t,i,r,n,s,o))}function K(e,t,i,r,o,a,c){const u=o?(0,s.d9)(o):(0,s.al)(1,0,0),h=a?(0,s.d9)(a):(0,s.al)(0,0,0);c??=!0;const p=(0,s.Ue)();(0,n.n)(p,u);const m=(0,s.Ue)();(0,n.h)(m,p,Math.abs(t));const y=(0,s.Ue)();(0,n.h)(y,m,-.5),(0,n.g)(y,y,h);const _=(0,s.al)(0,1,0);Math.abs(1-(0,n.f)(p,_))<.2&&(0,n.i)(_,0,0,1);const v=(0,s.Ue)();(0,n.e)(v,p,_),(0,n.n)(v,v),(0,n.e)(_,v,p);const b=2*r+(c?2:0),w=r+(c?2:0),x=(0,l.xx)(3*b),T=(0,l.xx)(3*w),C=(0,l.xx)(2*b),S=new Array(3*r*(c?4:2)),E=new Array(3*r*(c?4:2));c&&(x[3*(b-2)]=y[0],x[3*(b-2)+1]=y[1],x[3*(b-2)+2]=y[2],C[2*(b-2)]=0,C[2*(b-2)+1]=0,x[3*(b-1)]=x[3*(b-2)]+m[0],x[3*(b-1)+1]=x[3*(b-2)+1]+m[1],x[3*(b-1)+2]=x[3*(b-2)+2]+m[2],C[2*(b-1)]=1,C[2*(b-1)+1]=1,T[3*(w-2)]=-p[0],T[3*(w-2)+1]=-p[1],T[3*(w-2)+2]=-p[2],T[3*(w-1)]=p[0],T[3*(w-1)+1]=p[1],T[3*(w-1)+2]=p[2]);const M=(e,t,i)=>{S[e]=t,E[e]=i};let A=0;const R=(0,s.Ue)(),O=(0,s.Ue)();for(let e=0;e<r;e++){const t=e*(2*Math.PI/r);(0,n.h)(R,_,Math.sin(t)),(0,n.h)(O,v,Math.cos(t)),(0,n.g)(R,R,O),T[3*e]=R[0],T[3*e+1]=R[1],T[3*e+2]=R[2],(0,n.h)(R,R,i),(0,n.g)(R,R,y),x[3*e]=R[0],x[3*e+1]=R[1],x[3*e+2]=R[2],C[2*e]=e/r,C[2*e+1]=0,x[3*(e+r)]=x[3*e]+m[0],x[3*(e+r)+1]=x[3*e+1]+m[1],x[3*(e+r)+2]=x[3*e+2]+m[2],C[2*(e+r)]=e/r,C[2*e+1]=1;const s=(e+1)%r;M(A++,e,e),M(A++,e+r,e),M(A++,s,s),M(A++,s,s),M(A++,e+r,e),M(A++,s+r,s)}if(c){for(let e=0;e<r;e++){const t=(e+1)%r;M(A++,b-2,w-2),M(A++,e,w-2),M(A++,t,w-2)}for(let e=0;e<r;e++){const t=(e+1)%r;M(A++,e+r,w-1),M(A++,b-1,w-1),M(A++,t+r,w-1)}}const P=[[g.T.POSITION,new d.a(x,S,3,!0)],[g.T.NORMAL,new d.a(T,E,3,!0)],[g.T.UV0,new d.a(C,S,2,!0)]];return new f.Z(e,P)}function Q(e,t,i,r,n,s){r=r||10,n=null==n||n,(0,m.hu)(t.length>1);const o=[],a=[];for(let e=0;e<r;e++){o.push([0,-e-1,-(e+1)%r-1]);const t=e/r*2*Math.PI;a.push([Math.cos(t)*i,Math.sin(t)*i])}return ee(e,a,t,[[0,0,0]],o,n,s)}function ee(e,t,i,r,a,c,p=(0,s.al)(0,0,0)){const m=t.length,y=(0,l.xx)(i.length*m*3+(6*r.length||0)),_=(0,l.xx)(i.length*m*3+(r?6:0)),v=new Array,b=new Array;let w=0,x=0;const T=(0,o.Ue)(),C=(0,o.Ue)(),S=(0,o.Ue)(),E=(0,o.Ue)(),M=(0,o.Ue)(),A=(0,o.Ue)(),R=(0,o.Ue)(),O=(0,o.Ue)(),P=(0,o.Ue)(),I=(0,o.Ue)(),L=(0,o.Ue)(),D=(0,o.Ue)(),N=(0,o.Ue)(),F=(0,u.Ue)();(0,n.i)(P,0,1,0),(0,n.d)(C,i[1],i[0]),(0,n.n)(C,C),c?((0,n.g)(O,i[0],p),(0,n.n)(S,O)):(0,n.i)(S,0,0,1),oe(C,S,P,P,M,S,ae),(0,n.c)(E,S),(0,n.c)(D,M);for(let e=0;e<r.length;e++)(0,n.h)(A,M,r[e][0]),(0,n.h)(O,S,r[e][2]),(0,n.g)(A,A,O),(0,n.g)(A,A,i[0]),y[w++]=A[0],y[w++]=A[1],y[w++]=A[2];_[x++]=-C[0],_[x++]=-C[1],_[x++]=-C[2];for(let e=0;e<a.length;e++)v.push(a[e][0]>0?a[e][0]:-a[e][0]-1+r.length),v.push(a[e][1]>0?a[e][1]:-a[e][1]-1+r.length),v.push(a[e][2]>0?a[e][2]:-a[e][2]-1+r.length),b.push(0),b.push(0),b.push(0);let U=r.length;const k=r.length-1;for(let e=0;e<i.length;e++){let r=!1;e>0&&((0,n.c)(T,C),e<i.length-1?((0,n.d)(C,i[e+1],i[e]),(0,n.n)(C,C)):r=!0,(0,n.g)(I,T,C),(0,n.n)(I,I),(0,n.g)(L,i[e-1],E),(0,u.Yq)(i[e],I,F),(0,u.BR)(F,(0,h.re)(L,T),O)?((0,n.d)(O,O,i[e]),(0,n.n)(S,O),(0,n.e)(M,I,S),(0,n.n)(M,M)):oe(I,E,D,P,M,S,ae),(0,n.c)(E,S),(0,n.c)(D,M)),c&&((0,n.g)(O,i[e],p),(0,n.n)(N,O));for(let s=0;s<m;s++)if((0,n.h)(A,M,t[s][0]),(0,n.h)(O,S,t[s][1]),(0,n.g)(A,A,O),(0,n.n)(R,A),_[x++]=R[0],_[x++]=R[1],_[x++]=R[2],(0,n.g)(A,A,i[e]),y[w++]=A[0],y[w++]=A[1],y[w++]=A[2],!r){const e=(s+1)%m;v.push(U+s),v.push(U+m+s),v.push(U+e),v.push(U+e),v.push(U+m+s),v.push(U+m+e);for(let e=0;e<6;e++){const t=v.length-6;b.push(v[t+e]-k)}}U+=m}const z=i[i.length-1];for(let e=0;e<r.length;e++)(0,n.h)(A,M,r[e][0]),(0,n.h)(O,S,r[e][1]),(0,n.g)(A,A,O),(0,n.g)(A,A,z),y[w++]=A[0],y[w++]=A[1],y[w++]=A[2];const B=x/3;_[x++]=C[0],_[x++]=C[1],_[x++]=C[2];const V=U-m;for(let e=0;e<a.length;e++)v.push(a[e][0]>=0?U+a[e][0]:-a[e][0]-1+V),v.push(a[e][2]>=0?U+a[e][2]:-a[e][2]-1+V),v.push(a[e][1]>=0?U+a[e][1]:-a[e][1]-1+V),b.push(B),b.push(B),b.push(B);const H=[[g.T.POSITION,new d.a(y,v,3,!0)],[g.T.NORMAL,new d.a(_,b,3,!0)]];return new f.Z(e,H)}function te(e,t,i,r){(0,m.hu)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,m.hu)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,m.hu)(null==i||i.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,m.hu)(null==i||3===i[0].length,"createPolylineGeometry(): malformed normal");const n=(0,a.bg)(3*t.length),s=new Array(2*(t.length-1));let o=0,u=0;for(let e=0;e<t.length;e++){for(let i=0;i<3;i++)n[o++]=t[e][i];e>0&&(s[u++]=e-1,s[u++]=e)}const h=[[g.T.POSITION,new d.a(n,s,3,!0)]];if(i){const e=(0,l.xx)(3*i.length);let r=0;for(let n=0;n<t.length;n++)for(let t=0;t<3;t++)e[r++]=i[n][t];h.push([g.T.NORMAL,new d.a(e,s,3,!0)])}return r&&h.push([g.T.COLOR,new d.a(r,(0,c.KF)(r.length/4),4)]),new f.Z(e,h,null,p.U.Line)}function ie(e,t,i,r,n,s=0){const o=new Array(18),a=[[-i,s,n/2],[r,s,n/2],[0,t+s,n/2],[-i,s,-n/2],[r,s,-n/2],[0,t+s,-n/2]];for(let e=0;e<6;e++)o[3*e]=a[e][0],o[3*e+1]=a[e][1],o[3*e+2]=a[e][2];return new f.Z(e,[[g.T.POSITION,new d.a(o,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function re(e,t){const i=e.getMutableAttribute(g.T.POSITION).data;for(let e=0;e<i.length;e+=3){const r=i[e],s=i[e+1],o=i[e+2];(0,n.i)(le,r,s,o),(0,n.t)(le,le,t),i[e]=le[0],i[e+1]=le[1],i[e+2]=le[2]}}function ne(e,t=e){const i=e.attributes,r=i.get(g.T.POSITION).data,n=i.get(g.T.NORMAL).data;if(n){const e=t.getMutableAttribute(g.T.NORMAL).data;for(let t=0;t<n.length;t+=3){const i=n[t+1];e[t+1]=-n[t+2],e[t+2]=i}}if(r){const e=t.getMutableAttribute(g.T.POSITION).data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}}function se(e,t,i,r,s){return!(Math.abs((0,n.f)(t,e))>s||((0,n.e)(i,e,t),(0,n.n)(i,i),(0,n.e)(r,i,e),(0,n.n)(r,r),0))}function oe(e,t,i,r,n,s,o){return se(e,t,n,s,o)||se(e,i,n,s,o)||se(e,r,n,s,o)}const ae=.99619469809,le=(0,o.Ue)()},11715:(e,t,i)=>{i.d(t,{T:()=>r});i(63885);function r(e){return null!=e.mapPositions}},53464:(e,t,i)=>{i.d(t,{C:()=>y});i(39994);var r=i(7958),n=i(86717),s=i(81095),o=i(52721),a=i(22349),l=i(85799),c=i(95399),u=i(63885),h=i(58781),d=i(49394),p=i(39169),f=i(21414),m=i(26982),g=i(65392);class y{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,r.D)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=p.p.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,h.a)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const i=(0,h.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}const i=this._gridSize,r=Math.round(e[0]/i),s=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${r}/${s}/${o}`;let l=this._origins.get(a);const c=.5*i;if((0,n.d)(_,e,t.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),_[0]<c&&_[1]<c&&_[2]<c){if(l){const t=Math.max(..._);if((0,n.d)(_,e,l.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),Math.max(..._)<t)return l}return t}return l||(l=(0,h.a)(r*i,s*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,t=(0,o.al)(1,1,0,1)){const i=window.view,r=i._stage,n=t.toString();if(!this._objects.has(n)){this._material=new g.U({width:2,color:t}),r.add(this._material);const e=new m.F(r,{pickable:!1}),i=new d.T({castShadow:!1});r.add(i),e.add(i),this._objects.set(n,i)}const s=this._objects.get(n),h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=h.length,y=new Array(3*p),_=new Array,v=.5*this._gridSize;for(let t=0;t<p;t++)y[3*t]=e[0]+(1&h[t]?v:-v),y[3*t+1]=e[1]+(2&h[t]?v:-v),y[3*t+2]=e[2]+(4&h[t]?v:-v),t>0&&_.push(t-1,t);(0,a.projectBuffer)(y,this._originSR,0,y,i.renderSpatialReference,0,p);const b=new u.Z(this._material,[[f.T.POSITION,new l.a(y,_,3,!0)]],null,c.U.Line);r.add(b),s.addGeometry(b)}get test(){}}const _=(0,s.Ue)()},8927:(e,t,i)=>{i.d(t,{LP:()=>x,Z8:()=>_,jb:()=>m});var r=i(32114),n=i(3308),s=i(86717),o=i(81095),a=i(56999),l=i(52721),c=i(97537),u=i(65684),h=i(20757),d=i(10774),p=i(66218),f=i(5073);const m=1e-5;class g{constructor(e){this.options=new h.om,this._results=new v,this.transform=new f.yn,this.tolerance=m,this.verticalOffset=null,this._ray=(0,c.Ue)(),this._rayEnd=(0,o.Ue)(),this._rayBeginTransformed=(0,o.Ue)(),this._rayEndTransformed=(0,o.Ue)(),this.viewingMode=e??u.JY.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,i){this.resetWithRay((0,c.zk)(e,t,this._ray),i)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,c.JG)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===u.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,s.g)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,i,r,n){this.point=t,this.filterPredicate=r,this.tolerance=i??m;const s=(0,f.W9)(this.verticalOffset);if(e&&e.length>0){const t=n?e=>{n(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const i of e){const e=i.getSpatialQueryAccelerator?.();null!=e?(null!=s?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):i.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const i=e.effectiveTransformation,r=(0,f.W9)(this.verticalOffset);for(const o of t){if(!o.visible)continue;const{material:t,id:a}=o;if(!t.visible)continue;this.transform.setAndInvalidateLazyTransforms(i,o.transformation),(0,s.t)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,s.t)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;null!=r&&(r.objectTransform=this.transform),t.intersect(o,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,i,r,s,o,c)=>{if(t>=0){if(null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const u=s?this._results.hud:this._results,p=s?s=>{const l=new d.RA(e,a,r,c);s.set(h.q7.HUD,l,t,i,n.Wd,o)}:n=>n.set(h.q7.OBJECT,{object:e,geometryId:a,triangleNr:r},t,i,l,o);if((null==u.min.drapedLayerOrder||o>=u.min.drapedLayerOrder)&&(null==u.min.dist||t<u.min.dist)&&p(u.min),this.options.store!==h.eC.MIN&&(null==u.max.drapedLayerOrder||o<u.max.drapedLayerOrder)&&(null==u.max.dist||t>u.max.dist)&&p(u.max),this.options.store===h.eC.ALL)if(s){const e=new w(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new b(this._ray);p(e),this._results.all.push(e)}}}))}}sortResults(e=this._results.all){e.sort(((e,t)=>e.dist!==t.dist?(e.dist??0)-(t.dist??0):e.drapedLayerOrder!==t.drapedLayerOrder?y(e.drapedLayerOrder,t.drapedLayerOrder):y(e.drapedLayerGraphicOrder,t.drapedLayerGraphicOrder)))}}function y(e,t){return(t??-Number.MAX_VALUE)-(e??-Number.MAX_VALUE)}function _(e){return new g(e)}class v{constructor(){this.min=new b((0,c.Ue)()),this.max=new b((0,c.Ue)()),this.hud={min:new w((0,c.Ue)()),max:new w((0,c.Ue)()),all:new Array},this.ground=new b((0,c.Ue)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class b{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,s.h)(T,this.ray.direction,this.dist),(0,s.l)(T)):null}withinDistance(e){return!!(0,p.nn)(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!(0,p.nn)(this)&&((0,s.h)(T,this.ray.direction,this.dist),(0,s.g)(e,this.ray.origin,T),!0)}getTransformedNormal(e){return(0,s.c)(C,this.normal),C[3]=0,(0,a.t)(C,C,this.transformation),(0,s.c)(e,C),(0,s.n)(e,e)}constructor(e){this.intersector=h.q7.OBJECT,this.normal=(0,o.Ue)(),this.transformation=(0,n.Ue)(),this._ray=(0,c.Ue)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=h.q7.OBJECT,(0,c.JG)(e,this._ray)}set(e,t,i,a,l,c,u){this.intersector=e,this.dist=i,(0,s.c)(this.normal,a??o.eG),(0,r.JG)(this.transformation,l??n.Wd),this.target=t,this.drapedLayerOrder=c,this.drapedLayerGraphicOrder=u}copy(e){(0,c.JG)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,s.c)(this.normal,e.normal),(0,r.JG)(this.transformation,e.transformation)}}class w extends b{constructor(){super(...arguments),this.intersector=h.q7.HUD}}function x(e){return new b(e)}const T=(0,o.Ue)(),C=(0,l.Ue)()},20757:(e,t,i)=>{var r,n;i.d(t,{eC:()=>n,om:()=>s,q7:()=>r}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL",e[e.TILES3D=8]="TILES3D"}(r||(r={}));class s{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=n.ALL,this.normalRequired=!0,this.excludeLabels=!1}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(n||(n={}))},10774:(e,t,i)=>{i.d(t,{Dx:()=>a,RA:()=>s,Zh:()=>o});var r=i(81095);class n{constructor(e,t,i){this.object=e,this.geometryId=t,this.triangleNr=i}}class s extends n{constructor(e,t,i,n){super(e,t,i),this.center=null!=n?(0,r.d9)(n):null}}class o{constructor(e){this.layerUid=e}}class a extends o{constructor(e,t){super(e),this.graphicUid=t}}},58781:(e,t,i)=>{i.d(t,{a:()=>s});var r=i(81095);class n{constructor(e,t){this.vec3=e,this.id=t}}function s(e,t,i,s){return new n((0,r.al)(e,t,i),s)}},7358:(e,t,i)=>{i.d(t,{F5:()=>u,Mt:()=>h,yD:()=>r});var r,n=i(81095),s=i(10107),o=i(95399),a=i(5474),l=i(25584),c=i(86765);class u extends s.c{constructor(e,t){super(),this.type=o.U.Material,this.supportsEdges=!1,this._renderPriority=0,this.vertexAttributeLocations=a.i,this._pp0=(0,n.al)(0,0,1),this._pp1=(0,n.al)(0,0,0),this._parameters=new t,(0,l.LO)(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){(0,l.LO)(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.visible&&this.parameters.renderOccluded===e}get hasEmissions(){return!1}intersectDraped(e,t,i,r,n,s){return this._pp0[0]=this._pp1[0]=r[0],this._pp0[1]=this._pp1[1]=r[1],this.intersect(e,t,i,this._pp0,this._pp1,n)}}!function(e){e[e.None=0]="None",e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"}(r||(r={}));class h extends c.K{constructor(){super(...arguments),this.renderOccluded=r.Occlude,this.isDecoration=!1}}},79341:(e,t,i)=>{var r,n;i.d(t,{$:()=>n,T:()=>r}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(n||(n={}))},59633:(e,t,i)=>{i.d(t,{Pj:()=>l,hd:()=>o,nG:()=>a,rc:()=>c});var r=i(19431),n=i(86717),s=i(81095);i(31725);function o(e,t,i,r,n,s=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(n)),a=i*o,l=r*o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=n<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=t*s;e[d]=u(c),e[d+1]=u(h)}function a(e){const t=e.length/3,i=new Int16Array(2*t);let r=0;for(let n=0;n<t;++n)o(i,n,e[r++],e[r++],e[r++]);return i}function l(e,t){const i=e.length/3,r=new Int16Array(2*i);let a=0;const l=(0,s.Ue)();for(let s=0;s<i;++s)l[0]=e[a++],l[1]=e[a++],l[2]=e[a++],(0,n.q)(l,l,t),o(r,s,l[0],l[1],l[2]);return r}function c(e,t,i,r=2){const s=i*r,o=h(t[s]),a=h(t[s+1]),l=1-Math.abs(o)-Math.abs(a);e[2]=l,l<0?(e[0]=(o>=0?1:-1)*(1-Math.abs(a)),e[1]=(a>=0?1:-1)*(1-Math.abs(o))):(e[0]=o,e[1]=a),(0,n.n)(e,e)}function u(e){return(0,r.uZ)(Math.round(32767*e),-32767,32767)}function h(e){return(0,r.uZ)(e/32767,-1,1)}},97994:(e,t,i)=>{var r;i.d(t,{M:()=>r}),function(e){e[e.NONE=0]="NONE",e[e.ColorAlpha=1]="ColorAlpha",e[e.FrontFace=2]="FrontFace",e[e.COUNT=3]="COUNT"}(r||(r={}))},49394:(e,t,i)=>{i.d(t,{T:()=>g});i(39994);var r=i(32114),n=i(3308),s=i(86717),o=i(81095),a=i(73687),l=i(35369),c=i(70984),u=i(10107),h=i(95399),d=i(31248),p=i(15095),f=i(21414),m=i(73622);class g extends u.c{get geometries(){return this._geometries}get transformation(){return this._transformation??n.Wd}set transformation(e){this._transformation=(0,r.JG)(this._transformation??(0,n.Ue)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?(0,r.JG)(this._shaderTransformation??(0,n.Ue)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=h.U.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new y),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,p.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t,i=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:i}),(0,f.j)(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new d.Y;for(const t of this._geometries)t.occludees=(0,m.lr)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,m.U_)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(e){const t=new d.j(e);for(const e of this._geometries)e.addHighlight(t);return this._emit("highlightChanged",this),t}removeHighlight(e){for(const t of this._geometries)t.removeHighlight(e);this._emit("highlightChanged",this)}removeStateID(e){e.channel===c.V_.Highlight?this.removeHighlight(e):this.removeOcclude(e)}getCombinedStaticTransformation(e,t){return(0,r.Jp)(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e,t=(0,n.Ue)()){return(0,r.Jp)(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new _,this._validateBoundingVolume(this._bvWorldSpace,C.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new _,this._validateBoundingVolume(this._bvObjectSpace,C.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){const i=t===C.ObjectSpace;for(const t of this._geometries){const r=t.boundingInfo;r&&v(r,e,i?t.transformation:this.getCombinedShaderTransformation(t))}(0,s.m)((0,a.a)(e.bounds),e.min,e.max,.5);for(const t of this._geometries){const r=t.boundingInfo;if(null==r)continue;const n=i?t.transformation:this.getCombinedShaderTransformation(t),o=(0,l.u1)(n);(0,s.t)(T,r.center,n);const c=(0,s.j)(T,(0,a.a)(e.bounds)),u=r.radius*o;e.bounds[3]=Math.max(e.bounds[3],c+u)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){}}class y{constructor(){this.min=(0,o.al)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,o.al)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class _ extends y{constructor(){super(...arguments),this.bounds=(0,a.c)()}}function v(e,t,i){const n=e.bbMin,o=e.bbMax;if((0,r.lv)(i)){const e=(0,s.i)(b,i[12],i[13],i[14]);(0,s.g)(w,n,e),(0,s.g)(x,o,e);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],w[e]),t.max[e]=Math.max(t.max[e],x[e])}else if((0,s.t)(w,n,i),(0,s.p)(n,o))for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],w[e]),t.max[e]=Math.max(t.max[e],w[e]);else{(0,s.t)(x,o,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],w[e],x[e]),t.max[e]=Math.max(t.max[e],w[e],x[e]);for(let e=0;e<3;++e){(0,s.c)(w,n),(0,s.c)(x,o),w[e]=o[e],x[e]=n[e],(0,s.t)(w,w,i),(0,s.t)(x,x,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],w[e],x[e]),t.max[e]=Math.max(t.max[e],w[e],x[e])}}}const b=(0,o.Ue)(),w=(0,o.Ue)(),x=(0,o.Ue)(),T=(0,o.Ue)();var C;!function(e){e[e.WorldSpace=0]="WorldSpace",e[e.ObjectSpace=1]="ObjectSpace"}(C||(C={}))},31248:(e,t,i)=>{i.d(t,{Y:()=>a,j:()=>o});var r=i(7958),n=i(70984);class s{constructor(){this.uid=(0,r.D)()}}class o extends s{constructor(e){super(),this.highlightName=e,this.channel=n.V_.Highlight}}class a extends s{constructor(){super(...arguments),this.channel=n.V_.MaskOccludee}}},20766:(e,t,i)=>{i.d(t,{Z:()=>h});var r=i(34596),n=i(17135),s=i(86717),o=i(81095),a=i(59934),l=i(97537),c=i(73687),u=i(15095);class h{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,t){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new d,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}destroy(){this._degenerateObjects.clear(),d.clearPool(),A[0]=null,L.prune(),z.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=d.acquire();for(let r=0;r<t;r++){const t=e[r];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}d.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=d.acquire();for(const r of e){const e=t??(0,c.e)(this.objectToBoundingSphere(r),D);C(e[3])?(i.init(this._root),m(r,e,i)):this._degenerateObjects.delete(r)}d.release(i),this._shrink()}update(e,t){if(!C(t[3])&&this._isDegenerate(e))return;const i=function(e){return A[0]=e,A}(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const r=(0,l.re)(e,t);p(this._root,(e=>{if(!function(e,t){return b((0,c.a)(t.bounds),2*-t.halfSize,P),b((0,c.a)(t.bounds),2*t.halfSize,I),(0,u.yK)(e.origin,e.direction,P,I)}(r,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,i,r){const n=(0,l.re)(e,t);p(this._root,(e=>{if(!function(e,t,i){return b((0,c.a)(t.bounds),2*-t.halfSize,P),b((0,c.a)(t.bounds),2*t.halfSize,I),i.applyToMinMax(P,I),(0,u.yK)(e.origin,e.direction,P,I)}(n,e,r))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)})),!0}))}forEach(e){p(this._root,(t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,r=(()=>!0),n=1/0){let o=1/0,l=1/0,u=null;const h=x(e,t),d=s=>{if(--n,!r(s))return;const h=this.objectToBoundingSphere(s);if(!(0,a.hr)(i,h))return;const d=T(e,t,(0,c.a)(h)),p=d-h[3],f=d+h[3];p<o&&(o=p,l=f,u=s)};return f(this._root,(r=>{if(n<=0||!(0,a.hr)(i,r.bounds))return!1;if((0,s.h)(O,h,r.halfSize),(0,s.g)(O,O,(0,c.a)(r.bounds)),T(e,t,O)>l)return!1;const o=r.node;return o.terminals.forAll((e=>d(e))),null!==o.residents&&o.residents.forAll((e=>d(e))),!0}),e,t),u}forEachInDepthRange(e,t,i,r,n,o,l){let u=-1/0,d=1/0;const p={setRange:e=>{i===h.DepthOrder.FRONT_TO_BACK?(u=Math.max(u,e.near),d=Math.min(d,e.far)):(u=Math.max(u,-e.far),d=Math.min(d,-e.near))}};p.setRange(r);const m=T(t,i,e),g=x(t,i),y=x(t,-i),_=e=>{if(!l(e))return;const r=this.objectToBoundingSphere(e),s=(0,c.a)(r),h=T(t,i,s)-m,f=h-r[3],g=h+r[3];f>d||g<u||!(0,a.hr)(o,r)||n(e,p)};f(this._root,(e=>{if(!(0,a.hr)(o,e.bounds))return!1;if((0,s.h)(O,g,e.halfSize),(0,s.g)(O,O,(0,c.a)(e.bounds)),T(t,i,O)-m>d)return!1;if((0,s.h)(O,y,e.halfSize),(0,s.g)(O,O,(0,c.a)(e.bounds)),T(t,i,O)-m<u)return!1;const r=e.node;return r.terminals.forAll((e=>_(e))),null!==r.residents&&r.residents.forAll((e=>_(e))),!0}),t,i)}forEachNode(e){p(this._root,(t=>e(t.node,t.bounds,t.halfSize,t.depth)))}forEachNeighbor(e,t){const i=(0,c.g)(t),r=(0,c.a)(t),n=t=>{const n=this.objectToBoundingSphere(t),o=(0,c.g)(n),a=i+o;return!((0,s.s)((0,c.a)(n),r)-a*a<=0)||e(t)};let o=!0;const a=e=>{o&&(o=n(e))};p(this._root,(e=>{const t=(0,c.g)(e.bounds),n=i+t;if((0,s.s)((0,c.a)(e.bounds),r)-n*n>0)return!1;const l=e.node;return l.terminals.forAll(a),o&&null!==l.residents&&l.residents.forAll(a),o})),o&&this.forEachDegenerateObject(a)}_intersectsObject(e,t){const i=this.objectToBoundingSphere(t);return!(i[3]>0)||(0,c.i)(i,e)}_intersectsObjectWithOffset(e,t,i){const r=this.objectToBoundingSphere(t);return!(r[3]>0)||(0,c.i)(i.applyToBoundingSphere(r),e)}_add(e,t){t.advanceTo(this.objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const r=d.acquire().init(e);this._add(t.at(i),r),d.release(r)}}_grow(e,t){if(0!==t&&(w(e,t,(e=>this.objectToBoundingSphere(e)),N),C(N[3])&&!this._fitsInsideTree(N)))if(y(this._root.node))(0,c.e)(N,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const e=this._rootBoundsForRootAsSubNode(N);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(N,e):this._growRootAsSubNode(e),d.release(e)}}_rebuildTree(e,t){(0,s.c)((0,c.a)(F),(0,c.a)(t.bounds)),F[3]=t.halfSize,w([e,F],2,(e=>e),U);const i=d.acquire().init(this._root);this._root.initFrom(null,U,U[3]),this._root.increaseHalfSize(1.25),p(i,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),d.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return p(this._root,(e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth))),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let r=-1/0;const n=this._root.bounds,s=this._root.halfSize;for(let e=0;e<3;e++){const o=n[e]-s-(i[e]-t),a=i[e]+t-(n[e]+s),l=Math.max(0,Math.ceil(o/(2*s))),c=Math.max(0,Math.ceil(a/(2*s)))+1,u=2**Math.ceil(Math.log(l+c)*Math.LOG2E);r=Math.max(r,u),k[e].min=l,k[e].max=c}for(let e=0;e<3;e++){let t=k[e].min,i=k[e].max;const o=(r-(t+i))/2;t+=Math.ceil(o),i+=Math.floor(o);const a=n[e]-s-t*s*2;R[e]=a+(i+t)*s}const o=r*s;return R[3]=o*M,d.acquire().initFrom(null,R,o,0)}_growRootAsSubNode(e){const t=this._root.node;(0,s.c)((0,c.a)(N),(0,c.a)(this._root.bounds)),N[3]=this._root.halfSize,this._root.init(e),e.advanceTo(N,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,r=0;for(;r<t.length&&null==e;)i=r++,e=t[i];for(;r<t.length;)if(t[r++])return-1;return i}_isDegenerate(e){return!C(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:t,_objectCount:i}=this,r=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:t,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:r}}}_nodeToJSON(e){const t=e.children.map((e=>e?this._nodeToJSON(e):null)),i=e.residents?.map((e=>this.objectToBoundingSphere(e))),r=e.terminals?.map((e=>this.objectToBoundingSphere(e)));return{children:t,residents:i,terminals:r}}static fromJSON(e){const t=new h((e=>e),{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return t._objectCount=e.objectCount,t._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),t}}class d{constructor(){this.bounds=(0,c.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,r=this.depth){return this.node=null!=e?e:d.createEmptyNode(),t&&(0,c.e)(t,this.bounds),this.halfSize=i,this.depth=r,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*M}advance(e){let t=this.node.children[e];t||(t=d.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=S[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const r=this._childIndex(e);t&&t(this,r),this.advance(r)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new n.Z({shrink:!0}),residents:new n.Z({shrink:!0})}}static acquire(){return d._pool.acquire()}static release(e){d._pool.release(e)}static clearPool(){d._pool.prune()}}function p(e,t){let i=d.acquire().init(e);const r=[i];for(;0!==r.length;){if(i=r.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&r.push(d.acquire().init(i).advance(e));d.release(i)}}function f(e,t,i,r=h.DepthOrder.FRONT_TO_BACK){let n=d.acquire().init(e);const s=[n];for(function(e,t,i){if(!z.length)for(let e=0;e<8;++e)z.push({index:0,distance:0});for(let i=0;i<8;++i){const r=S[i];z.data[i].index=i,z.data[i].distance=T(e,t,r)}z.sort(((e,t)=>e.distance-t.distance));for(let e=0;e<8;++e)i[e]=z.data[e].index}(i,r,B);0!==s.length;){if(n=s.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=B[e];n.node.children[t]&&s.push(d.acquire().init(n).advance(t))}d.release(n)}}function m(e,t,i){L.clear();const r=i.advanceTo(t,((e,t)=>{L.push(e.node),L.push(t)}))?i.node.terminals:i.node.residents;if(r.removeUnordered(e),0===r.length)for(let e=L.length-2;e>=0&&g(L.data[e],L.data[e+1]);e-=2);}function g(e,t){return t>=0&&(e.children[t]=null),!!y(e)&&(null===e.residents&&(e.residents=new n.Z({shrink:!0})),!0)}function y(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}function _(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function v(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function b(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function w(e,t,i,r){if(1===t){const t=i(e[0]);(0,c.e)(t,r)}else{P[0]=1/0,P[1]=1/0,P[2]=1/0,I[0]=-1/0,I[1]=-1/0,I[2]=-1/0;for(let r=0;r<t;r++){const t=i(e[r]);C(t[3])&&(_(P,t),v(I,t))}(0,s.m)((0,c.a)(r),P,I,.5),r[3]=Math.max(I[0]-P[0],I[1]-P[1],I[2]-P[2])/2}}function x(e,t){let i,r=1/0;for(let n=0;n<8;++n){const s=T(e,t,E[n]);s<r&&(r=s,i=E[n])}return i}function T(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function C(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}d._pool=new r.Z(d),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(h);const S=[(0,o.al)(-1,-1,-1),(0,o.al)(1,-1,-1),(0,o.al)(-1,1,-1),(0,o.al)(1,1,-1),(0,o.al)(-1,-1,1),(0,o.al)(1,-1,1),(0,o.al)(-1,1,1),(0,o.al)(1,1,1)],E=[(0,o.al)(-1,-1,-1),(0,o.al)(-1,-1,1),(0,o.al)(-1,1,-1),(0,o.al)(-1,1,1),(0,o.al)(1,-1,-1),(0,o.al)(1,-1,1),(0,o.al)(1,1,-1),(0,o.al)(1,1,1)],M=Math.sqrt(3),A=[null];const R=(0,c.c)(),O=(0,o.Ue)(),P=(0,o.Ue)(),I=(0,o.Ue)(),L=new n.Z,D=(0,c.c)(),N=(0,c.c)(),F=(0,c.c)(),U=(0,c.c)(),k=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],z=new n.Z,B=[0,0,0,0,0,0,0,0]},12045:(e,t,i)=>{i.d(t,{Bh:()=>f,E0:()=>d,W$:()=>u,Wo:()=>c,j7:()=>l,je:()=>p,u_:()=>m,ve:()=>h});var r=i(35031),n=i(97994),s=i(91907),o=i(17346);const a=(0,o.wK)(s.zi.ONE,s.zi.ZERO,s.zi.ONE,s.zi.ONE_MINUS_SRC_ALPHA);function l(e){return e===n.M.FrontFace?null:a}function c(e){switch(e){case n.M.NONE:return o.Dh;case n.M.ColorAlpha:return a;case n.M.FrontFace:case n.M.COUNT:return null}}function u(e){if(e.draped)return null;switch(e.oitPass){case n.M.NONE:case n.M.FrontFace:return e.writeDepth?o.ck:null;case n.M.ColorAlpha:case n.M.COUNT:return null}}const h=5e5,d={factor:-1,units:-2};function p(e){return e?d:null}function f(e,t=s.wb.LESS){return e===n.M.NONE||e===n.M.FrontFace?t:s.wb.LEQUAL}function m(e,t){const i=(0,r.qC)(t);return e===n.M.ColorAlpha?i?{buffers:[s.VY.COLOR_ATTACHMENT0,s.VY.COLOR_ATTACHMENT1,s.VY.COLOR_ATTACHMENT2]}:{buffers:[s.VY.COLOR_ATTACHMENT0,s.VY.COLOR_ATTACHMENT1]}:i?{buffers:[s.VY.COLOR_ATTACHMENT0,s.VY.COLOR_ATTACHMENT1]}:null}},85906:(e,t,i)=>{i.d(t,{Bw:()=>h,CN:()=>m,ET:()=>g,Fw:()=>R,IG:()=>y,Tw:()=>A,Ue:()=>M,ko:()=>_,sT:()=>c});var r=i(86717),n=i(81095),s=i(37116),o=i(95399),a=i(15095),l=i(21414);class c{constructor(e=!1,t=!0){this.isVerticalRay=e,this.normalRequired=t}}const u=(0,s.Ue)();function h(e,t,i,n,s,u){if(!e.visible)return;const h=(0,r.a)(I,n,i),d=(e,t,i)=>{u(e,i,t,!1)},f=new c(!1,t.options.normalRequired);if(e.boundingInfo){(0,a.hu)(e.type===o.U.Mesh);const r=t.tolerance;p(e.boundingInfo,i,h,r,s,f,d)}else{const t=e.attributes.get(l.T.POSITION),r=t.indices;v(i,h,0,r.length/3,r,t.data,t.stride,s,f,d)}}const d=(0,n.Ue)();function p(e,t,i,n,o,a,l){if(null==e)return;const c=function(e,t){return(0,r.i)(t,1/e[0],1/e[1],1/e[2])}(i,d);if((0,s.op)(u,e.bbMin),(0,s.Tn)(u,e.bbMax),null!=o&&o.applyToAabb(u),A(u,t,c,n)){const{primitiveIndices:r,position:s}=e,c=r?r.length:s.indices.length/3;if(c>O){const r=e.getChildren();if(void 0!==r){for(const e of r)p(e,t,i,n,o,a,l);return}}!function(e,t,i,r,n,s,o,a,l,c,u){const h=e[0],d=e[1],p=e[2],m=t[0],g=t[1],y=t[2],{normalRequired:_}=c;for(let e=i;e<r;++e){const t=a[e],i=3*t,r=o*n[i];let c=s[r],v=s[r+1],b=s[r+2];const w=o*n[i+1];let x=s[w],C=s[w+1],S=s[w+2];const E=o*n[i+2];let M=s[E],A=s[E+1],R=s[E+2];null!=l&&([c,v,b]=l.applyToVertex(c,v,b,e),[x,C,S]=l.applyToVertex(x,C,S,e),[M,A,R]=l.applyToVertex(M,A,R,e));const O=x-c,I=C-v,L=S-b,D=M-c,N=A-v,F=R-b,U=g*F-N*y,k=y*D-F*m,z=m*N-D*g,B=O*U+I*k+L*z;if(Math.abs(B)<=P)continue;const V=h-c,H=d-v,G=p-b,j=V*U+H*k+G*z;if(B>0){if(j<0||j>B)continue}else if(j>0||j<B)continue;const Z=H*L-I*G,q=G*O-L*V,W=V*I-O*H,$=m*Z+g*q+y*W;if(B>0){if($<0||j+$>B)continue}else if($>0||j+$<B)continue;const Y=(D*Z+N*q+F*W)/B;Y>=0&&u(Y,t,_?T(O,I,L,D,N,F,f):null)}}(t,i,0,c,s.indices,s.data,s.stride,r,o,a,l)}}const f=(0,n.Ue)();function m(e,t,i,n,s,o,a,l,c){const{data:u,stride:h}=o;v(e,(0,r.a)(I,t,e),i,n,s,u,h,a,l,c)}function g(e,t,i,r,n,s,o,a,l,c=null,u=0){const h=e[0],d=e[1],p=e[2],m=t[0],g=t[1],y=t[2];for(let e=i;e<r;++e){const t=u+(c?c[e]:e),i=3*t,r=o*n[i],_=s[r],v=s[r+1],b=s[r+2],w=o*n[i+1],x=s[w],C=s[w+1],S=s[w+2],E=o*n[i+2],M=x-_,A=C-v,R=S-b,O=s[E]-_,I=s[E+1]-v,L=s[E+2]-b,D=g*L-I*y,N=y*O-L*m,F=m*I-O*g,U=M*D+A*N+R*F;if(Math.abs(U)<=P)continue;const k=h-_,z=d-v,B=p-b,V=k*D+z*N+B*F;if(U>0){if(V<0||V>U)continue}else if(V>0||V<U)continue;const H=z*R-A*B,G=B*M-R*k,j=k*A-M*z,Z=m*H+g*G+y*j;if(U>0){if(Z<0||V+Z>U)continue}else if(Z>0||V+Z<U)continue;const q=(O*H+I*G+L*j)/U;q>=0&&l(q,t,a?T(M,A,R,O,I,L,f):null)}}function y(e,t,i,r,n,s,o,a){const l=e[0],c=e[1],u=e[2],h=t[0],d=t[1],p=t[2];for(let e=i;e<r;++e){const t=3*e,i=t+1,r=t+2,m=s*t,g=n[m],y=n[m+1],_=n[m+2],v=s*i,b=s*r,w=n[v]-g,x=n[v+1]-y,C=n[v+2]-_,S=n[b]-g,E=n[b+1]-y,M=n[b+2]-_,A=d*M-E*p,R=p*S-M*h,O=h*E-S*d,I=w*A+x*R+C*O;if(Math.abs(I)<=P)continue;const L=l-g,D=c-y,N=u-_,F=L*A+D*R+N*O;if(I>0){if(F<0||F>I)continue}else if(F>0||F<I)continue;const U=D*C-x*N,k=N*w-C*L,z=L*x-w*D,B=h*U+d*k+p*z;if(I>0){if(B<0||F+B>I)continue}else if(B>0||F+B<I)continue;const V=(S*U+E*k+M*z)/I;V>=0&&a(V,e,o?T(w,x,C,S,E,M,f):null)}}function _(e,t,i,r,n,s,o,a,l,c,u,h=null,d=0){const p=e[0],m=e[1],g=e[2],y=t[0],_=t[1],v=t[2];for(let e=i;e<r;++e){const t=d+(h?h[e]:e),i=3*t,r=o*n[i],b=s[r],w=s[r+1],x=s[r+2],C=o*n[i+1],S=s[C],E=s[C+1],M=s[C+2],A=o*n[i+2],R=s[A],O=s[A+1],I=s[A+2],L=x-l,D=a/Math.sqrt(b*b+w*w+L*L),N=b+b*D,F=w+w*D,U=x+L*D,k=M-l,z=a/Math.sqrt(S*S+E*E+k*k),B=S+S*z,V=E+E*z,H=M+k*z,G=I-l,j=a/Math.sqrt(R*R+O*O+G*G),Z=B-N,q=V-F,W=H-U,$=R+R*j-N,Y=O+O*j-F,J=I+G*j-U,X=_*J-Y*v,K=v*$-J*y,Q=y*Y-$*_,ee=Z*X+q*K+W*Q;if(Math.abs(ee)<=P)continue;const te=p-N,ie=m-F,re=g-U,ne=te*X+ie*K+re*Q;if(ee>0){if(ne<0||ne>ee)continue}else if(ne>0||ne<ee)continue;const se=ie*W-q*re,oe=re*Z-W*te,ae=te*q-Z*ie,le=y*se+_*oe+v*ae;if(ee>0){if(le<0||ne+le>ee)continue}else if(le>0||ne+le<ee)continue;const ce=($*se+Y*oe+J*ae)/ee;ce>=0&&u(ce,t,c?T(Z,q,W,$,Y,J,f):null)}}function v(e,t,i,n,s,o,a,l,c,u){const h=t,d=L,p=Math.abs(h[0]),f=Math.abs(h[1]),m=Math.abs(h[2]),g=p>=f?p>=m?0:2:f>=m?1:2,y=g,_=h[y]<0?2:1,v=(g+_)%3,T=(g+(3-_))%3,S=h[v]/h[y],E=h[T]/h[y],M=1/h[y],A=b,R=w,O=x,{normalRequired:P}=c;for(let t=i;t<n;++t){const i=3*t,n=a*s[i];(0,r.i)(d[0],o[n+0],o[n+1],o[n+2]);const c=a*s[i+1];(0,r.i)(d[1],o[c+0],o[c+1],o[c+2]);const h=a*s[i+2];(0,r.i)(d[2],o[h+0],o[h+1],o[h+2]),l&&((0,r.c)(d[0],l.applyToVertex(d[0][0],d[0][1],d[0][2],t)),(0,r.c)(d[1],l.applyToVertex(d[1][0],d[1][1],d[1][2],t)),(0,r.c)(d[2],l.applyToVertex(d[2][0],d[2][1],d[2][2],t))),(0,r.a)(A,d[0],e),(0,r.a)(R,d[1],e),(0,r.a)(O,d[2],e);const p=A[v]-S*A[y],f=A[T]-E*A[y],m=R[v]-S*R[y],g=R[T]-E*R[y],_=O[v]-S*O[y],b=O[T]-E*O[y],w=_*g-b*m,x=p*b-f*_,I=m*f-g*p;if((w<0||x<0||I<0)&&(w>0||x>0||I>0))continue;const L=w+x+I;if(0===L)continue;const D=w*(M*A[y])+x*(M*R[y])+I*(M*O[y]);if(D*Math.sign(L)<0)continue;const N=D/L;N>=0&&u(N,t,P?C(d):null)}}const b=(0,n.Ue)(),w=(0,n.Ue)(),x=(0,n.Ue)();function T(e,t,i,n,s,o,a){return(0,r.i)(S,e,t,i),(0,r.i)(E,n,s,o),(0,r.e)(a,S,E),(0,r.n)(a,a),a}function C(e){return(0,r.a)(S,e[1],e[0]),(0,r.a)(E,e[2],e[0]),(0,r.e)(f,S,E),(0,r.n)(f,f),f}const S=(0,n.Ue)(),E=(0,n.Ue)();function M(e,t,i){return(0,r.i)(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function A(e,t,i,r){return R(e,t,i,r,1/0)}function R(e,t,i,r,n){const s=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(e[1]-r-t[1])*i[1],u=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(c,u)),l<0)return!1;if(a=Math.max(a,Math.min(c,u)),a>l)return!1;const h=(e[2]-r-t[2])*i[2],d=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(h,d)),!(l<0)&&(a=Math.max(a,Math.min(h,d)),!(a>l)&&a<n)}const O=1e3,P=1e-7,I=(0,n.Ue)(),L=[(0,n.Ue)(),(0,n.Ue)(),(0,n.Ue)()]},4051:(e,t,i)=>{i.d(t,{C9:()=>u,V1:()=>c,Yh:()=>l});var r=i(12928),n=i(5512),s=i(35031),o=i(85211),a=i(7358);class l{constructor(e,t){this.rctx=e,this.lastFrameCamera=new n.Z,this.output=s.H_.Color,this.renderOccludedMask=u,this.bind=new o.p(t),this.bind.alignPixelEnabled=!0}}class c extends l{constructor(e,t,i){super(e,t),this.techniques=i,this.time=(0,r.HA)(0)}}const u=a.yD.Occlude|a.yD.OccludeAndTransparent|a.yD.OccludeAndTransparentStencil},92238:(e,t,i)=>{i.d(t,{Y:()=>r,n:()=>a});var r,n=i(39994),s=i(22445),o=i(22855);function a(e=!(0,n.Z)("disable-feature:high-quality-idle"),t=null){const i=new s.r;return e?(i.set(o.n.IDLE,r.Antialiasing,"low"!==t),i.set(o.n.IDLE,r.HighResolutionAtmosphere,"low"!==t),i.set(o.n.IDLE,r.HighQualityTransparency,!0),i.set(o.n.IDLE,r.SSAO,!0),i.set(o.n.IDLE,r.WaterReflection,!0),i.set(o.n.IDLE,r.PhysicalPixelRendering,!0)):(i.set(o.n.ANIMATING,r.HighResolutionShadows,!0),i.set(o.n.ANIMATING,r.HighResolutionViewshed,!0),i.set(o.n.INTERACTING,r.HighResolutionShadows,!0),i.set(o.n.INTERACTING,r.HighResolutionViewshed,!0)),i.set(o.n.IDLE,r.HighResolutionShadows,!0),i.set(o.n.IDLE,r.HighResolutionViewshed,!0),i.set(o.n.IDLE,r.HighResolutionVoxel,!0),i}!function(e){e[e.Antialiasing=0]="Antialiasing",e[e.HighQualityTransparency=1]="HighQualityTransparency",e[e.HighResolutionVoxel=2]="HighResolutionVoxel",e[e.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",e[e.SSAO=4]="SSAO",e[e.WaterReflection=5]="WaterReflection",e[e.HighResolutionShadows=6]="HighResolutionShadows",e[e.HighResolutionViewshed=7]="HighResolutionViewshed",e[e.PhysicalPixelRendering=8]="PhysicalPixelRendering"}(r||(r={}))},13304:(e,t,i)=>{i.d(t,{z:()=>c});var r=i(7958),n=i(32114),s=i(3308),o=i(86717),a=i(73687),l=i(35369);class c{constructor(e,t={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,s.Ue)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,r.D)(),this.layerUid=t.layerUid,this.graphicUid=t.graphicUid,this.castShadow=t.castShadow??!1,t.objectShaderTransformation&&this.objectShaderTransformationChanged(t.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,n.JG)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){null==e?this._shaderTransformation=null:(this._shaderTransformation??=(0,s.Ue)(),(0,n.Jp)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(null==this._boundingSphere&&(this._boundingSphere??=(0,a.c)(),(0,o.t)((0,a.a)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.u1)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightOptions(e){this.geometry.foreachHighlightOptions(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},46378:(e,t,i)=>{var r;i.d(t,{r:()=>r}),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.HUD_MATERIAL=12]="HUD_MATERIAL",e[e.LABEL_MATERIAL=13]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=14]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",e[e.OVERLAY=16]="OVERLAY",e[e.DRAPED_MATERIAL=17]="DRAPED_MATERIAL",e[e.DRAPED_WATER=18]="DRAPED_WATER",e[e.VOXEL=19]="VOXEL",e[e.MAX_SLOTS=20]="MAX_SLOTS"}(r||(r={}))},95524:(e,t,i)=>{i.d(t,{l:()=>R,i:()=>x});var r=i(39994),n=i(19431),s=i(61681),o=i(3965),a=i(32114),l=i(3308),c=i(36531),u=i(84164),h=i(86717),d=i(81095),p=i(56999),f=i(52721),m=i(65684),g=i(37503),y=i(36663),_=i(81977),v=(i(13802),i(4157),i(40266)),b=i(5512);let w=class extends b.Z{constructor(){super(...arguments),this._projectionMatrix=(0,l.Ue)()}get projectionMatrix(){return this._projectionMatrix}};(0,y._)([(0,_.Cb)()],w.prototype,"_projectionMatrix",void 0),(0,y._)([(0,_.Cb)({readOnly:!0})],w.prototype,"projectionMatrix",null),w=(0,y._)([(0,v.j)("esri.views.3d.webgl-engine.lib.CascadeCamera")],w);var x,T=i(42142),C=i(15095),S=i(91907),E=i(43487);!function(e){e[e.Highlight=0]="Highlight",e[e.ExcludeHighlight=1]="ExcludeHighlight"}(x||(x={}));class M{constructor(){this.camera=new w,this.lightMat=(0,l.Ue)()}}class A{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class R{constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new A,this._projectionView=(0,l.Ue)(),this._projectionViewInverse=(0,l.Ue)(),this._modelViewLight=(0,l.Ue)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,f.Ue)(),this._cascades=[new M,new M,new M,new M],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,r.Z)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,p.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,s.RY)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,n.uZ)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)z[e]=this._cascades[e];return z.length=this._numCascades,z}start(e,t,i,r,n){(0,C.hu)(this.enabled);const{near:s,far:o}=function(e){let{near:t,far:i}=e;return t<2&&(t=2),i<2&&(i=2),t>=i&&(t=2,i=4),{near:t,far:i}}(i);this._computeCascadeDistances(s,o,r),this._textureHeight=this._computeTextureHeight(e,n,r),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let e=0;e<this._numCascades;++e)this._constructCascade(e,l,a,t);this._lastOrigin=null,this.clear()}finish(){(0,C.hu)(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,h.p)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,d.Ue)(),(0,h.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,a.Iu)(B,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)V[16*t+e]=B[e]}}return V}moveSnapshot(e){(0,C.hu)(this.enabled),this._handle?.detachDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){const t=this._handle?.getTexture()?.descriptor;if(!this.enabled||!t)return;this._snapshots[e]?.release();const{width:i,height:r}=t,n=e===x.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(i,r,n,g.q.RGBA4);const s=this._fbos.rctx;this._bindFbo();const o=s.bindTexture(this._snapshots[e]?.getTexture(),E.x.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(S.No.TEXTURE_2D,0,0,0,0,0,i,r),s.bindTexture(o,E.x.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(S.Hf.COLOR|S.Hf.DEPTH)}_computeTextureHeight(e,t,i){const r=Math.min(window.devicePixelRatio,t)/e.pixelRatio,n=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,s=(0,T.nq)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*r*n)),o=Math.min(this._maxTextureWidth,this._numCascades*s);return(0,T.pf)(o/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",g.q.RGBA4)),this._handle?.acquireDepth(g.m.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,s.RY)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){this._fbos.rctx.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,t,i,r){const s=this._cascades[e],o=-this._cascadeDistances[e],l=-this._cascadeDistances[e+1],u=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]),d=(t[10]*l+t[14])/Math.abs(t[11]*l+t[15]);(0,C.hu)(u<d);for(let e=0;e<8;++e){(0,p.s)(P,e%4==0||e%4==3?-1:1,e%4==0||e%4==1?-1:1,e<4?u:d,1);const t=I[e];(0,p.t)(t,P,this._projectionViewInverse),t[0]/=t[3],t[1]/=t[3],t[2]/=t[3]}(0,h.v)(k,I[0]),s.camera.viewMatrix=(0,a.Iu)(O,this._modelViewLight,k);for(let e=0;e<8;++e)(0,h.t)(I[e],I[e],s.camera.viewMatrix);let f=I[0][2],m=I[0][2];for(let e=1;e<8;++e)f=Math.min(f,I[e][2]),m=Math.max(m,I[e][2]);f-=200,m+=200,s.camera.near=-m,s.camera.far=-f,function(e,t,i,r,s){const o=1/I[0][3],a=1/I[4][3];(0,C.hu)(o<a);let l=o+Math.sqrt(o*a);const u=Math.sin((0,n.ZF)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));l/=u,function(e,t,i,r,n,s,o,a){(0,c.t8)(H,0,0);for(let t=0;t<4;++t)(0,c.IH)(H,H,e[t]);(0,c.bA)(H,H,.25),(0,c.t8)(G,0,0);for(let t=4;t<8;++t)(0,c.IH)(G,G,e[t]);(0,c.bA)(G,G,.25),(0,c.t7)(j[0],e[4],e[5],.5),(0,c.t7)(j[1],e[5],e[6],.5),(0,c.t7)(j[2],e[6],e[7],.5),(0,c.t7)(j[3],e[7],e[4],.5);let l=0,u=(0,c.bI)(j[0],H);for(let e=1;e<4;++e){const t=(0,c.bI)(j[e],H);t<u&&(u=t,l=e)}(0,c.$X)(Z,j[l],e[l+4]);const h=Z[0];let d,p;Z[0]=-Z[1],Z[1]=h,(0,c.$X)(q,G,H),(0,c.AK)(q,Z)<0&&(0,c.tk)(Z,Z),(0,c.t7)(Z,Z,q,i),(0,c.Fv)(Z,Z),d=p=(0,c.AK)((0,c.$X)(W,e[0],H),Z);for(let t=1;t<8;++t){const i=(0,c.AK)((0,c.$X)(W,e[t],H),Z);i<d?d=i:i>p&&(p=i)}(0,c.JG)(r,H),(0,c.bA)(W,Z,d-t),(0,c.IH)(r,r,W);let f=-1,m=1,g=0,y=0;for(let t=0;t<8;++t){(0,c.$X)($,e[t],r),(0,c.Fv)($,$);const i=Z[0]*$[1]-Z[1]*$[0];i>0?i>f&&(f=i,g=t):i<m&&(m=i,y=t)}(0,C.T)(f>0,"leftArea"),(0,C.T)(m<0,"rightArea"),(0,c.bA)(Y,Z,d),(0,c.IH)(Y,Y,H),(0,c.bA)(J,Z,p),(0,c.IH)(J,J,H),X[0]=-Z[1],X[1]=Z[0];const _=(0,C.ep)(r,e[y],J,(0,c.IH)(W,J,X),1,n),v=(0,C.ep)(r,e[g],J,W,1,s),b=(0,C.ep)(r,e[g],Y,(0,c.IH)(W,Y,X),1,o),w=(0,C.ep)(r,e[y],Y,W,1,a);(0,C.T)(_,"rayRay"),(0,C.T)(v,"rayRay"),(0,C.T)(b,"rayRay"),(0,C.T)(w,"rayRay")}(I,l,u,L,D,N,F,U),function(e,t,i,r,n){(0,c.$X)(te,i,r),(0,c.bA)(te,te,.5),ie[0]=te[0],ie[1]=te[1],ie[2]=0,ie[3]=te[1],ie[4]=-te[0],ie[5]=0,ie[6]=te[0]*te[0]+te[1]*te[1],ie[7]=te[0]*te[1]-te[1]*te[0],ie[8]=1,ie[K(0,2)]=-(0,c.AK)(ee(ie,0),e),ie[K(1,2)]=-(0,c.AK)(ee(ie,1),e);let s=(0,c.AK)(ee(ie,0),i)+ie[K(0,2)],o=(0,c.AK)(ee(ie,1),i)+ie[K(1,2)],a=(0,c.AK)(ee(ie,0),r)+ie[K(0,2)],l=(0,c.AK)(ee(ie,1),r)+ie[K(1,2)];s=-(s+a)/(o+l),ie[K(0,0)]+=ie[K(1,0)]*s,ie[K(0,1)]+=ie[K(1,1)]*s,ie[K(0,2)]+=ie[K(1,2)]*s,s=1/((0,c.AK)(ee(ie,0),i)+ie[K(0,2)]),o=1/((0,c.AK)(ee(ie,1),i)+ie[K(1,2)]),ie[K(0,0)]*=s,ie[K(0,1)]*=s,ie[K(0,2)]*=s,ie[K(1,0)]*=o,ie[K(1,1)]*=o,ie[K(1,2)]*=o,ie[K(2,0)]=ie[K(1,0)],ie[K(2,1)]=ie[K(1,1)],ie[K(2,2)]=ie[K(1,2)],ie[K(1,2)]+=1,s=(0,c.AK)(ee(ie,1),t)+ie[K(1,2)],o=(0,c.AK)(ee(ie,2),t)+ie[K(2,2)],a=(0,c.AK)(ee(ie,1),i)+ie[K(1,2)],l=(0,c.AK)(ee(ie,2),i)+ie[K(2,2)],s=-.5*(s/o+a/l),ie[K(1,0)]+=ie[K(2,0)]*s,ie[K(1,1)]+=ie[K(2,1)]*s,ie[K(1,2)]+=ie[K(2,2)]*s,s=(0,c.AK)(ee(ie,1),t)+ie[K(1,2)],o=(0,c.AK)(ee(ie,2),t)+ie[K(2,2)],a=-o/s,ie[K(1,0)]*=a,ie[K(1,1)]*=a,ie[K(1,2)]*=a,n[0]=ie[0],n[1]=ie[1],n[2]=0,n[3]=ie[2],n[4]=ie[3],n[5]=ie[4],n[6]=0,n[7]=ie[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=ie[6],n[13]=ie[7],n[14]=0,n[15]=ie[8]}(L,D,F,U,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}(i,r,f,m,s.camera),(0,a.Jp)(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const g=this._textureHeight;s.camera.viewport=[e*g,0,g,g]}_setupMatrices(e,t){(0,a.Jp)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,a.U_)(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===m.JY.Global?e.eye:(0,h.i)(k,0,0,1);(0,a.zB)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],i)}_computeCascadeDistances(e,t,i){const r=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,C.E6)(t/e,4)),r);const s=(t-e)/this._numCascades,o=(t/e)**(1/this._numCascades);let a=e,l=e;for(let e=0;e<this._numCascades+1;++e)this._cascadeDistances[e]=(0,n.t7)(a,l,this.settings.splitSchemeLambda),a*=o,l+=s}get test(){}}const O=(0,l.Ue)(),P=(0,f.Ue)(),I=[];for(let e=0;e<8;++e)I.push((0,f.Ue)());const L=(0,u.Ue)(),D=(0,u.Ue)(),N=(0,u.Ue)(),F=(0,u.Ue)(),U=(0,u.Ue)(),k=(0,d.Ue)(),z=[],B=(0,l.Ue)(),V=l.Wd.concat(l.Wd,l.Wd,l.Wd,l.Wd),H=(0,u.Ue)(),G=(0,u.Ue)(),j=[(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)(),(0,u.Ue)()],Z=(0,u.Ue)(),q=(0,u.Ue)(),W=(0,u.Ue)(),$=(0,u.Ue)(),Y=(0,u.Ue)(),J=(0,u.Ue)(),X=(0,u.Ue)();function K(e,t){return 3*t+e}const Q=(0,u.Ue)();function ee(e,t){return(0,c.t8)(Q,e[t],e[t+3]),Q}const te=(0,u.Ue)(),ie=(0,o.Ue)()},65075:(e,t,i)=>{i.d(t,{S:()=>w});var r=i(36663),n=i(74396),s=(i(39994),i(86114)),o=i(17135),a=i(81977),l=(i(13802),i(4157),i(40266)),c=i(84164),u=i(73687),h=i(87564),d=i(35031),p=i(2236),f=i(8927),m=i(20757),g=i(7358),y=i(79341),_=i(74533),v=i(46378),b=i(40846);let w=class extends n.Z{constructor(e){super(e),this._pending=new x,this._changes=new p.as,this._renderers=new Map,this._sortedRenderers=new o.Z,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._sortedRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}hasHighlightOptions(e){return(0,s.oE)(this._renderers,(t=>t.hasHighlightOptions(e)))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){for(const e of this._renderers.values())if(0!==e.numGeometries&&!e.queryRenderOccludedState(g.yD.Occlude))return!0;return!1}get isEmpty(){return!this.updating&&0===this._renderers.size&&0===this._geometries.size}getMaterialRenderer(e){return this._renderers.get(e)}get sortedRenderers(){return this._sortedRenderers}commitChanges(e){if(!this.updating)return!1;this._processAddsRemoves();const t=(0,_.q9)(this._changes);let i=!1;return t.forEach(((t,r)=>{let n=this._renderers.get(r);!n&&t.adds.length>0&&(n=new b.A({material:r,highlightOrderMap:e}),n.initializeRenderContext(this.rendererContext.pluginContext,this._materials),this._renderers.set(r,n),i=!0),n&&(n.modify(t),n.updateHighlights(e),0===n.numGeometries&&(this._renderers.delete(r),n.destroy(),i=!0))})),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),this._hasHighlights=(0,s.oE)(this._renderers,(e=>{const t=e.produces.get(v.r.DRAPED_MATERIAL);return!!t&&t(d.H_.Highlight)})),this._hasWater=(0,s.oE)(this._renderers,(e=>{const t=e.produces.get(v.r.DRAPED_WATER);return!!t&&t(d.H_.Normal)})),this.notifyChange("updating"),!0}updateHighlights(e){this._renderers.forEach((t=>t.updateHighlights(e)))}addGeometries(e,t){if(0===e.length)return;const i=this._validateRenderGeometries(e);for(const e of i)this._geometries.set(e.id,e);const r=this._pending.empty;for(const e of i)this._pending.adds.add(e);r&&this.notifyChange("updating"),t===y.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const t of e)r.has(t)?(this._pending.removed.add(t),r.delete(t)):this._pending.removed.has(t)||this._pending.removes.add(t),this._geometries.delete(t.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===y.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=0===this._changes.updates.length;for(const i of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(i),e.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case y.$.TRANSFORMATION:case y.$.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case y.$.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedRenderers.forAll((i=>t=!!i.updateAnimation&&i.updateAnimation(e)||t)),t}precompile(e){return this._sortedRenderers.reduce(((t,i)=>i.precompile(e)||t),!1)}render(e){this._sortedRenderers.forAll((t=>{const i=t.acquireTechniques(e);i&&t.render(e,i)}))}intersect(e,t,i,r,n){for(const s of this._geometries.values()){if(!r(s))continue;this._intersectRenderGeometry(s,i,t,0,e,n);const o=this.rendererContext.longitudeCyclical;o&&(s.boundingSphere[0]-s.boundingSphere[3]<o.min&&this._intersectRenderGeometry(s,i,t,o.range,e,n),s.boundingSphere[0]+s.boundingSphere[3]>o.max&&this._intersectRenderGeometry(s,i,t,-o.range,e,n)),n++}return n}_updateSortedMaterialRenderers(){this._sortedRenderers.clear();let e=0;for(const t of this._renderers.values())t.drapedPriority=e++,this._sortedRenderers.push(t);this._sortedRenderers.sort(((e,t)=>t.material?.renderPriority===e.material?.renderPriority?e.drapedPriority-t.drapedPriority:(t.material?.renderPriority||0)-(e.material?.renderPriority||0)))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes)),this._changes.updates.filterInPlace((({renderGeometry:e})=>!this._pending.has(e))),this._pending.clear()}_intersectRenderGeometry(e,t,i,r,n,s){if(!e.visible||!e.material.visible)return;let o=0;r+=e.transformation[12],o=e.transformation[13],T[0]=i[0]-r,T[1]=i[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,T,((i,r,o)=>{!function(e,t,i,r,n,s,o){const a=new h.T6(s,o,t),l=t=>{t.set(m.q7.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((null==n.results.min.drapedLayerOrder||i>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==m.eC.MIN&&(null==n.results.max.drapedLayerOrder||i<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===m.eC.ALL){const e=(0,f.LP)(n.ray);l(e),n.results.all.push(e)}}(t,o,s,e.material.renderPriority,n,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const{graphicUid:i}of e)null!=i&&i!==t&&(this.drapeSource.notifyGraphicGeometryChanged(i),t=i)}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const{graphicUid:i}of e)null!=i&&i!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(i),t=i)}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin((0,u.a)(e.boundingSphere))),e}get test(){}};(0,r._)([(0,a.Cb)()],w.prototype,"drapeSource",void 0),(0,r._)([(0,a.Cb)()],w.prototype,"updating",null),(0,r._)([(0,a.Cb)()],w.prototype,"rctx",null),(0,r._)([(0,a.Cb)({constructOnly:!0})],w.prototype,"rendererContext",void 0),(0,r._)([(0,a.Cb)()],w.prototype,"_materials",null),(0,r._)([(0,a.Cb)()],w.prototype,"_localOriginFactory",null),(0,r._)([(0,a.Cb)({readOnly:!0})],w.prototype,"isEmpty",null),(0,r._)([(0,a.Cb)()],w.prototype,"_renderers",void 0),(0,r._)([(0,a.Cb)()],w.prototype,"_geometries",void 0),w=(0,r._)([(0,l.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],w);class x{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const T=(0,c.Ue)()},79040:(e,t,i)=>{i.d(t,{JN:()=>s,P7:()=>l,RY:()=>h,YD:()=>f,eD:()=>d,ec:()=>u,iV:()=>c,ii:()=>p,s3:()=>a,zV:()=>o});var r=i(70984),n=i(91907);const s={func:n.wb.LESS},o={func:n.wb.ALWAYS},a={mask:255},l={mask:0},c=e=>({function:{func:n.wb.NOTEQUAL,ref:e,mask:e},operation:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.KEEP}}),u=e=>({function:{func:n.wb.ALWAYS,ref:e,mask:e},operation:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.REPLACE}}),h={function:{func:n.wb.ALWAYS,ref:r.hU.OutlineVisualElementMask,mask:r.hU.OutlineVisualElementMask},operation:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.ZERO}},d={function:{func:n.wb.ALWAYS,ref:r.hU.OutlineVisualElementMask,mask:r.hU.OutlineVisualElementMask},operation:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.REPLACE}},p={function:{func:n.wb.EQUAL,ref:r.hU.OutlineVisualElementMask,mask:r.hU.OutlineVisualElementMask},operation:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.KEEP}},f={function:{func:n.wb.NOTEQUAL,ref:r.hU.OutlineVisualElementMask,mask:r.hU.OutlineVisualElementMask},operation:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.KEEP}}},15334:(e,t,i)=>{function r(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}i.d(t,{G:()=>r})},71667:(e,t,i)=>{i.d(t,{V:()=>l});var r=i(30936),n=i(69079),s=i(13802),o=i(95550),a=i(52721);class l{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=c(e.color),this.haloStyle=function(e){return`rgb(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()})`}(e.halo.color),this.backgroundStyle=0!==e.background.color[3]?c(e.background.color):null}fontString(e){const t=this.definition.font;return`${t.style} ${t.weight} ${e}px ${t.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,t){e.font=this.fontString(t),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,t){const i=e?.material?.color,c=r.Z.toUnitRGBA(i)??a.AG,h=null!=e.size?(0,o.F2)(e.size):12,d=e.lineHeight,p=null!=e.background?r.Z.toUnitRGBA(e.background.color):a.AG,f={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},m=e.halo,g=null!=m?.color&&m.size>0?{size:(0,o.F2)(m.size),color:r.Z.toUnitRGBA(m.color)}:{size:0,color:a.AG},y=new l({color:c,size:h,background:{color:p,padding:null!=e.background?[.65*h,.5*h]:[0,0],borderRadius:null!=e.background?h*(6/16):0},lineSpacingFactor:d,font:f,halo:g,pixelRatio:t});if(e.font){let t=!1;const i=y.fontString(h);try{t=(await document.fonts.load(i)).some((e=>!(0,n.hZ)(e)))}catch(e){s.Z.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${i}'. Some text symbology may be rendered using the default browser font.`)}if(!t&&!u.has(e.font.family))try{await(0,n.mx)(e.font)}catch(e){}}return y}}function c(e){return`rgba(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()},${e[3]})`}const u=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"])},90670:(e,t,i)=>{i.d(t,{Wg:()=>a,tV:()=>l,vU:()=>u});var r=i(19431),n=i(3289),s=i(39803),o=i(15334);const a=1;class l{constructor(e,t,i,r){this.text=e,this._alignment=t,this._parameters=i,this._maxSize=r,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" ","").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let t=0;t<this._lines.length-1;t++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const e=(0,o.G)(h,p,p).getContext("2d"),t=this._parameters.definition.pixelRatio,i=this._fontSize*t;this._parameters.setFontProperties(e,i);let r=2*this._haloSize;const n=this._parameters.definition.font;"italic"!==n.style&&"oblique"!==n.style&&"bold"!==n.weight&&"bolder"!==n.weight||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let a=0,l=0,c=0,u=0,d=0;this._lines.forEach(((i,n)=>{const s=e.measureText(i),o=s.width/t,h=o+r;this._textWidths.push(o),this._lineWidths.push(h),a=Math.max(a,h),u=Math.max(u,s.actualBoundingBoxAscent/t),d=Math.max(d,s.actualBoundingBoxDescent/t),0===n&&(l=s.actualBoundingBoxAscent/t),n===this._lines.length-1&&(c=s.actualBoundingBoxDescent/t)}));const f=(0,s.U)(this._parameters),g=Math.max(u,f.maxAscent),y=Math.max(d,f.maxDescent),_=l,v="underline"===this._parameters.definition.font.decoration?y:c,b=a;this._metricsCached=new m(_,v,g,y,b)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*d}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,a)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case u.Left:return this._horizontalPadding;case u.Center:return(this.displayWidth-this._lineWidths[e])/2;case u.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,t,i){e.save();const r=t/=this.renderPixelRatio,s=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;t+=o,i+=a;const l=this._haloSize>0;l&&this._renderHalo(e,r,s,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let r=0;r<this._lines.length;++r){const n=this._lines[r],s=this._getLineXOffset(r);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,n,t+s,i),this._renderLineDecoration(e,t+s,i,this._textWidths[r])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,n,t+this._getLineXOffset(r),i),this._renderLineDecoration(e,t+s,i,this._textWidths[r]),i+=this._lineSpacing}if(n.h.TEXT_SHOW_BASELINE){e.strokeStyle=f,e.setLineDash([2,2]),e.lineWidth=1;let t=s+a;for(let i=0;i<this._lines.length;++i)this._drawLine(e,[r,t],[r+this.displayWidth,t]),t+=this._lineSpacing}if(n.h.TEXT_SHOW_BORDER&&(e.strokeStyle=f,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[r,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const t=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,r,s,t),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,t,i,r,n=!1){if("none"===this._parameters.definition.font.decoration||0===r)return;const s=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":i+=2*s;break;case"line-through":i-=.33*this._midLineAscent}const o=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(s+2*o),e.beginPath(),e.moveTo(this._toRenderUnit(t-o),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(t+r+o),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,t,i,n){t=this._toRenderUnit(t),i=this._toRenderUnit(i);const s=this.renderedWidth,o=this.renderedHeight;0!==n?(n=(0,r.uZ)(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(t,i+n),e.arcTo(t,i,t+n,i,n),e.lineTo(t+s-n,i),e.arcTo(t+s,i,t+s,i+n,n),e.lineTo(t+s,i+o-n),e.arcTo(t+s,i+o,t+s-n,i+o,n),e.lineTo(t+n,i+o),e.arcTo(t,i+o,t,i+o-n,n),e.closePath()):e.rect(t,i,s,o)}_renderHalo(e,t,i,r,n){const s=this.renderedWidth,a=this.renderedHeight,l=(0,o.G)(h,Math.max(s,p),Math.max(a,p)),c=l.getContext("2d");c.clearRect(0,0,s,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,r,n):this._renderHaloNative(c,r,n);let d=n;for(let e=0;e<this._lines.length;++e){const t=this._getLineXOffset(e);this._renderLineDecoration(c,r+t,d,this._textWidths[e],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,s,a,this._toRenderUnit(t),this._toRenderUnit(i),s,a),e.globalAlpha=1}_renderHaloEmulated(e,t,i){for(let r=0;r<this._lines.length;++r){const n=this._lines[r],s=this._getLineXOffset(r);for(const[r,o]of c)this._fillText(e,n,t+s+this._haloSize*r,i+this._haloSize*o);i+=this._lineSpacing}}_renderHaloNative(e,t,i){const r=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n),a=5,l=.1;for(let n=0;n<a;n++){const c=1-(a-1)*l+n*l;e.lineWidth=this._toRenderUnit(c*r),this._strokeText(e,s,t+o,i)}i+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,t,i,r){e.fillText(t,this._toRenderUnit(i),this._toRenderUnit(r))}_strokeText(e,t,i,r){e.strokeText(t,this._toRenderUnit(i),this._toRenderUnit(r))}_drawLine(e,t,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,t,i){const r=this._toRenderUnit(t[0]),n=this._toRenderUnit(t[1]),s=this._toRenderUnit(i[0]),o=this._toRenderUnit(i[1]),a=Math.floor(r)+.5,l=Math.ceil(r+s)-.5,c=Math.floor(n)+.5,u=Math.ceil(n+o)-.5;e.beginPath(),e.moveTo(a,c),e.lineTo(l,c),e.lineTo(l,u),e.lineTo(a,u),e.lineTo(a,c),e.stroke()}}const c=[];{const e=16;for(let t=0;t<360;t+=360/e)c.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var u;!function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"}(u||(u={}));const h={canvas:null},d=.2,p=512,f="rgb(255, 0, 255, 0.5)";class m{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,t,i,r,n){this.firstLineAscent=e,this.lastLineDescent=t,this.maxLineAscent=i,this.maxLineDescent=r,this.displayWidth=n}}},82400:(e,t,i)=>{i.d(t,{U:()=>w});var r=i(36663),n=i(74396),s=i(31355),o=(i(39994),i(61681)),a=i(7958),l=i(81977),c=(i(13802),i(4157),i(40266)),u=i(56999),h=i(52721),d=i(95399),p=i(39169),f=i(42142),m=i(22167),g=i(14169),y=i(91907),_=i(43487),v=i(80479);const b=4096;let w=class extends n.Z{constructor(e){super(e),this.type=d.U.Texture,this.id=(0,a.D)(),this.events=new s.Z,this._glTexture=null,this._atlas=new S(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._uvCallbacks=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=(0,o.M2)(this._glTexture),this._frameWorker=(0,o.hw)(this._frameWorker),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return M=p.y.stableRendering?x:0,[b-x-M,b-x-M-T]}load(e){if(this._glTexture)return this._glTexture;const t=new v.X;return t.wrapMode=y.e8.CLAMP_TO_EDGE,t.samplingMode=y.cw.LINEAR_MIPMAP_LINEAR,t.hasMipmap=!0,t.preMultiplyAlpha=!0,t.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new _.x(e,t,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(m.T8.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=(0,o.hw)(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=(0,o.M2)(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.width=e.width,this._canvas.height=e.height}_resizeAtlas(e,t){const{width:i,height:r}=this._atlas;i===e&&r===t||(this._atlas.width=e,this._atlas.height=t,this._glTexture?.resize(e,t),this._glTexture?.updateData(0,0,0,i,r,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach((e=>this._uvCallbacks.get(e.textRenderer.key)?.forEach((t=>t(e.uv))))),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,t,i,r){const n=this._atlas;if(n.width<i||n.height<r)return!1;let s=n.cursors.get(r);if(!s){if(n.height<n.nextY+r)return!1;s=[new E(n.nextY)],n.cursors.set(r,s),n.nextY+=r}let o=s.find((e=>n.width>=e.x+i));if(null==o){if(n.height<n.nextY+r)return!1;o=new E(n.nextY),n.nextY+=r,s.push(o)}return e.setNewPosition(o),this._elements.set(t,e),this._elementsToRender.set(t,e),o.x+=i,!0}_ensureCallbacks(e){const t=this._uvCallbacks.get(e);if(t)return t;const i=new Set;return this._uvCallbacks.set(e,i),i}_addCallback(e,t){this._ensureCallbacks(e).add(t)}_removeCallback(e,t){const i=this._uvCallbacks.get(e);return!(!i?.delete(t)||0!==i.size||(this._uvCallbacks.delete(e),0))}_processAddition(e){const t=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(t,e);const i=this._atlas,r=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,s=r+x,o=n+x+T;if(!this._addAtlasElement(e,t,s,o)){if(this._canRepack)this._reset();else if(i.width<s){const e=Math.min((0,f.nq)(Math.max(s,1.5*i.width)),b);this._resizeAtlas(e,i.height)}else{const e=i.nextY+o,t=Math.min((0,f.nq)(Math.max(e,1.5*i.height)),b);if(t>i.height)this._resizeAtlas(i.width,t);else if(i.width<b){const e=Math.min((0,f.nq)(1.5*i.width),b);this._resizeAtlas(e,i.height)}}this._elements.set(t,e)}}_renderElement(e){const t=e.commitNewPosition(),i=e.textRenderer;this._ctx.clearRect(t[0]-x,t[1]-x,i.renderedWidth+2*x,i.renderedHeight+2*x),i.render(this._ctx,t[0],t[1]),this._uvCallbacks.get(i.key)?.forEach((t=>t(e.uv)))}get running(){return this.updating}runTask(e){if(null==this._glTexture)return g.J;for(;this._needsRepack&&(this._canRepack||this._atlas.height<b&&this._atlas.height<b);){this._canRepack=this._needsRepack=!1;const t=this._elements;this._elements=new Map,t.forEach((e=>this._processAddition(e))),e.madeProgress()}if(this._elementsToRender.size>0){for(const[t,i]of this._elementsToRender){if(e.done)break;this._renderElement(i),this._elementsToRender.delete(t),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addText(e,t){const i=e.key;this._addCallback(i,t);let r=this._elements.get(i);return r?(0,u.a)(r.uv,h.AG)||t(r.uv):(r=new C(this._atlas,e),this._processAddition(r),this.setDirty()),{remove:()=>this._removeText(e,t)}}_removeText(e,t){const i=e.key;this._elements.get(i)&&this._removeCallback(i,t)&&(this._elements.delete(i),this._elementsToRender.delete(i),this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};(0,r._)([(0,l.Cb)({constructOnly:!0})],w.prototype,"view",void 0),(0,r._)([(0,l.Cb)({type:Boolean})],w.prototype,"updating",void 0),w=(0,r._)([(0,c.j)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],w);const x=2,T=2;class C{constructor(e,t){this._atlas=e,this.textRenderer=t,this._uv=(0,h.Ue)(),this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return h.AG;const{renderedWidth:e,renderedHeight:t}=this.textRenderer;return(0,u.s)(this._uv,this._xOffset/this._atlas.width,(this._yOffset+t)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class S{constructor(e,t){this.width=e,this.height=t,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=M}}class E{constructor(e){this.y=e,this.x=M}}let M=0},44101:(e,t,i)=>{i.d(t,{x:()=>A});i(39994);var r=i(70375),n=i(31355),s=i(61681),o=i(78668),a=i(86098),l=i(3466),c=i(44883),u=i(73401),h=i(70984),d=i(77416),p=i(10107),f=i(95399),m=i(13802),g=i(91907),y=i(43487);const _=()=>m.Z.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function v(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const b=v("DXT1"),w=v("DXT3"),x=v("DXT5");function T(e,t){const i=new Int32Array(e.buffer,e.byteOffset,31);if(542327876!==i[0])return _().error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return _().error("Unsupported format, must contain a FourCC code"),null;const r=i[21];let n,s;switch(r){case b:n=8,s=g.q_.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case w:n=16,s=g.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case x:n=16,s=g.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return _().error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(r)),null}let o=1,a=i[4],l=i[3];(3&a||3&l)&&(_().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,d;131072&i[2]&&!1!==t&&(o=Math.max(1,i[7]));let p=e.byteOffset+i[1]+4;const f=[];for(let t=0;t<o;++t)d=(a+3>>2)*(l+3>>2)*n,h=new Uint8Array(e.buffer,p,d),f.push(h),p+=d,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:f},internalFormat:s,width:c,height:u}}var C,S=i(42142),E=i(15095),M=i(80479);class A extends p.c{constructor(e,t){super(),this._data=e,this.type=f.U.Texture,this.events=new n.Z,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this._parameters={...O,...t},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){null!=e&&(e instanceof HTMLVideoElement?(this.frameUpdate=t=>this._frameUpdate(e,t),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!((0,l.jc)(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){(0,l.HK)(e.src)||(0,l.jc)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const t=new M.X;return t.wrapMode=this._parameters.wrap??g.e8.REPEAT,t.flipped=!this._parameters.noUnpackFlip,t.samplingMode=this._parameters.mipmap?g.cw.LINEAR_MIPMAP_LINEAR:g.cw.LINEAR,t.hasMipmap=!!this._parameters.mipmap,t.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,t.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),t}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||function(e,t){if(null==e)return 0;if((0,a.eP)(e)||(0,a.lq)(e))return t.encoding===h.Ti.KTX2_ENCODING?(0,d._h)(e,!!t.mipmap):t.encoding===h.Ti.BASIS_ENCODING?(0,d.$u)(e,!!t.mipmap):e.byteLength;const{width:i,height:r}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?R(e):t;return(t.mipmap?4/3:1)*i*r*(t.components||4)||0}(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const t=this._data;return null==t?(this._glTexture=new y.x(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),"string"==typeof t?this._loadFromURL(e,t):t instanceof Image?this._loadFromImageElement(e,t):t instanceof HTMLVideoElement?this._loadFromVideoElement(e,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this._loadFromImage(e,t):(0,a.lq)(t)&&this._parameters.encoding===h.Ti.DDS_ENCODING?this._loadFromDDSData(e,t):(0,a.eP)(t)&&this._parameters.encoding===h.Ti.DDS_ENCODING?this._loadFromDDSData(e,new Uint8Array(t)):((0,a.eP)(t)||(0,a.lq)(t))&&this._parameters.encoding===h.Ti.KTX2_ENCODING?this._loadFromKTX2(e,t):((0,a.eP)(t)||(0,a.lq)(t))&&this._parameters.encoding===h.Ti.BASIS_ENCODING?this._loadFromBasis(e,t):(0,a.lq)(t)?this._loadFromPixelData(e,t):(0,a.eP)(t)?this._loadFromPixelData(e,new Uint8Array(t)):null)}_frameUpdate(e,t){return null==this._glTexture||e.readyState<C.HAVE_CURRENT_DATA||t===e.currentTime?t:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,t){return this._glTexture=function(e,t,i){const r=T(i,t.hasMipmap??!1);if(null==r)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=r;return t.samplingMode=n.levels.length>1?g.cw.LINEAR_MIPMAP_LINEAR:g.cw.LINEAR,t.hasMipmap=n.levels.length>1,t.internalFormat=s,t.width=o,t.height=a,new y.x(e,t,n)}(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>(0,d.pk)(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>(0,d.fX)(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){(0,E.hu)(this._parameters.width>0&&this._parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=1===this._parameters.components?g.VI.LUMINANCE:3===this._parameters.components?g.VI.RGB:g.VI.RGBA,i.width=this._parameters.width??0,i.height=this._parameters.height??0,this._glTexture=new y.x(e,i,t),this._glTexture}_loadFromURL(e,t){return this._loadAsync((async i=>{const r=await(0,c.t)(t,{signal:i});return(0,o.k_)(i),this._loadFromImage(e,r)}))}_loadFromImageElement(e,t){return t.complete?this._loadFromImage(e,t):this._loadAsync((async i=>{const r=await(0,u.fY)(t,t.src,!1,i);return(0,o.k_)(i),this._loadFromImage(e,r)}))}_loadFromVideoElement(e,t){return t.readyState>=C.HAVE_CURRENT_DATA?this._loadFromImage(e,t):this._loadFromVideoElementAsync(e,t)}_loadFromVideoElementAsync(e,t){return this._loadAsync((i=>new Promise(((n,a)=>{const l=()=>{t.removeEventListener("loadeddata",c),t.removeEventListener("error",u),(0,s.hw)(h)},c=()=>{t.readyState>=C.HAVE_CURRENT_DATA&&(l(),n(this._loadFromImage(e,t)))},u=e=>{l(),a(e||new r.Z("Failed to load video"))};t.addEventListener("loadeddata",c),t.addEventListener("error",u);const h=(0,o.fu)(i,(()=>u((0,o.zE)())))}))))}_loadFromImage(e,t){let i=t;if(!(i instanceof HTMLVideoElement)){const{maxTextureSize:t}=e.parameters;i=this._parameters.downsampleUncompressed?(0,S.n9)(i,t):(0,S.qB)(i,t)}const r=R(i);this._parameters.width=r.width,this._parameters.height=r.height;const n=this._createDescriptor(e);return n.pixelFormat=3===this._parameters.components?g.VI.RGB:g.VI.RGBA,n.width=r.width,n.height=r.height,n.shouldCompress=this._parameters.shouldCompress,this._glTexture=new y.x(e,n,i),this._glTexture}_loadAsync(e){const t=new AbortController;this._loadingController=t;const i=e(t.signal);this._loadingPromise=i;const r=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(r,r),i}unload(){if(this._glTexture=(0,s.M2)(this._glTexture),null!=this._loadingController){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}}function R(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}!function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(C||(C={}));const O={wrap:{s:g.e8.REPEAT,t:g.e8.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1,shouldCompress:!1}},405:(e,t,i)=>{i.d(t,{g:()=>u});class r{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}}var n=i(81936),s=i(91907),o=i(43487),a=i(80479);class l{constructor(e,t=1){this._rctx=e,this._fieldCount=t,this.textureWidth=4096,this._dirty=!0;const i=new a.X(this.textureWidth,1);i.samplingMode=s.cw.NEAREST,i.wrapMode=s.e8.CLAMP_TO_EDGE,this._texture=new o.x(this._rctx,i),this._data=new n.mc(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,t,i,r,n,s){const o=e*this._fieldCount+t;this._dirty=!0,this._data.set(o,0,i),this._data.set(o,1,r),this._data.set(o,2,n),this._data.set(o,3,s)}setDataElement(e,t,i,r){const n=e*this._fieldCount+t;this._dirty=!0,this._data.set(n,i,r)}getDataElement(e,t,i){const r=e*this._fieldCount+t;return this._dirty=!0,this._data.get(r,i)}resizeToFit(e){const t=(e+1)*this._fieldCount;if(t>this._data.count){const e=Math.ceil(t/this.textureWidth)*this.textureWidth,i=new n.mc(new ArrayBuffer(4*e));i.typedBuffer.set(this._data.typedBuffer),this._data=i}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,t=this._texture.descriptor.height;this._data.count>e*t&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}}class c{constructor(e,t=1){this.textureBuffer=new l(e,t),this._indexManager=new r(65536)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}}class u{constructor(e,t=1){this._rctx=e,this._fieldCount=t,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter((e=>0!==e.activeCount||(e.dispose(),!1)))}destroy(){this._buffers.forEach((e=>e.dispose())),this._buffers=[]}getBuffer(e){for(const t of this._buffers)if(t.availableCount>=e)return t;if(e>65536)return null;const t=new c(this._rctx,this._fieldCount);return this._buffers.push(t),t}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}}},11722:(e,t,i)=>{var r;i.d(t,{B:()=>r}),function(e){e[e.Immediate=0]="Immediate",e[e.FadeWithWeather=1]="FadeWithWeather"}(r||(r={}))},53448:(e,t,i)=>{var r;i.d(t,{j:()=>r}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(r||(r={}))},15095:(e,t,i)=>{i.d(t,{E6:()=>d,T:()=>l,ep:()=>u,hu:()=>a,iV:()=>h,kG:()=>p,yK:()=>c});var r=i(84164),n=i(56999);const s=(0,i(52721).Ue)();class o{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function a(e,t="Assertion"){if(!e){const e=new Error(t).stack;throw new o(`${t} at ${e}`)}}function l(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function c(e,t,i,r){let n,s=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];s>o&&(n=s,s=o,o=n);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],u=(r[2]-e[2])/t[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o||(u<o&&(o=u),o<0))}function u(e,t,i,n,s,o=(0,r.Ue)()){const a=(n[s]-i[s])*(t[0]-e[0])-(n[0]-i[0])*(t[s]-e[s]),l=(n[0]-i[0])*(e[s]-i[s])-(n[s]-i[s])*(e[0]-i[0]);if(0===a)return!1;const c=l/a;return o[0]=e[0]+c*(t[0]-e[0]),o[1]=e[s]+c*(t[s]-e[s]),!0}function h(e,t,i,r,o){s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=1,(0,n.t)(s,s,t),o.length>2&&(o[2]=-s[2]),(0,n.t)(s,s,i),a(0!==s[3]),o[0]=s[0]/s[3],o[1]=s[1]/s[3],o[2]=s[2]/s[3],o[0]=(.5*o[0]+.5)*r[2]+r[0],o[1]=(.5*o[1]+.5)*r[3]+r[1]}function d(e,t){return Math.log(e)/Math.log(t)}function p(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},44125:(e,t,i)=>{i.d(t,{U:()=>n});var r=i(29620);class n extends r.U{}},21414:(e,t,i)=>{var r;function n(e){return e===r.POSITION}i.d(t,{T:()=>r,j:()=>n}),function(e){e.POSITION="position",e.NORMAL="normal",e.NORMALCOMPRESSED="normalCompressed",e.UV0="uv0",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.ROTATION="rotation",e.TANGENT="tangent",e.OFFSET="offset",e.PERSPECTIVEDIVIDE="perspectiveDivide",e.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",e.LENGTH="length",e.PREVPOSITION="prevPosition",e.NEXTPOSITION="nextPosition",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.INSTANCEMODELORIGINHI="instanceModelOriginHi",e.INSTANCEMODELORIGINLO="instanceModelOriginLo",e.INSTANCEMODEL="instanceModel",e.INSTANCEMODELNORMAL="instanceModelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMAL2COMPRESSED="normal2Compressed",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.START_UP="startUp",e.END_UP="endUp",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"}(r||(r={}))},26982:(e,t,i)=>{i.d(t,{F:()=>d,e:()=>p});var r=i(31355),n=i(44584),s=i(61681),o=i(17135),a=i(10107),l=i(95399);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var u=i(20766),h=i(53448);class d extends a.c{constructor(e,t,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=l.U.Layer,this.events=new r.Z,this.visible=!0,this.sliceable=!1,this._objectsAdded=new o.Z,this._handles=new n.Z,this._objects=new o.Z,this._pickable=!0,this.visible=t?.visible??!0,this._pickable=t?.pickable??!0,this.updatePolicy=t?.updatePolicy??h.j.ASYNC,this._disableOctree=t?.disableOctree??!1,e.add(this);for(const t of c)this._handles.add(this.events.on(t,(i=>e.handleEvent(t,i))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}set pickable(e){this._pickable=e}get pickable(){return this._pickable&&this.visible}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==h.j.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new u.Z((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=(0,s.SC)(this._octree),this._objectsAdded.clear()}}function p(e){return null!=e&&e.type===l.U.Layer}},70984:(e,t,i)=>{var r,n,s,o,a,l,c,u;i.d(t,{Gv:()=>n,JJ:()=>c,Rw:()=>o,Ti:()=>u,V_:()=>l,Vr:()=>r,Xx:()=>s,hU:()=>a}),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(n||(n={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(s||(s={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(o||(o={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(a||(a={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee"}(l||(l={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(c||(c={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(u||(u={}))},75427:(e,t,i)=>{var r;i.d(t,{i:()=>r}),function(e){e[e.TRANSPARENT=0]="TRANSPARENT",e[e.OPAQUE=1]="OPAQUE"}(r||(r={}))},62039:(e,t,i)=>{i.d(t,{Ar:()=>d,l_:()=>h,ow:()=>u});var r=i(5474),n=i(71299),s=i(44125),o=i(78951),a=i(91907),l=i(43487),c=i(80479);function u(e,t=d.Pos2,i=r.i,n=-1,l=1){const c=t===d.Pos2?new Float32Array([n,n,l,n,n,l,l,l]):new Float32Array([n,n,0,0,l,n,1,0,n,l,0,1,l,l,1,1]);return new s.U(e,i,new Map([["geometry",p.get(t)]]),new Map([["geometry",o.f.createVertex(e,a.l1.STATIC_DRAW,c)]]))}function h(e){const t=new c.X(4);return t.samplingMode=a.cw.NEAREST,new l.x(e,t)}var d;!function(e){e[e.Pos2=0]="Pos2",e[e.Pos2Tex=1]="Pos2Tex"}(d||(d={}));const p=new Map([[d.Pos2,n.QI],[d.Pos2Tex,n.Bn]])},66218:(e,t,i)=>{i.d(t,{G1:()=>u,e4:()=>l,es:()=>c,nn:()=>a});var r=i(86717),n=i(81095),s=i(96739),o=i(20757);function a(e){return null!=e?.dist}function l(e){return(t,i,n)=>((0,r.m)(h,t,i,n),!(0,s.e)(e,h))}function c(e){return a(e)&&e.intersector===o.q7.OBJECT&&!!e.target}function u(e){return a(e)&&e.intersector===o.q7.HUD&&!!e.target&&"center"in e.target&&null!=e.target.center}const h=(0,n.Ue)()},84523:(e,t,i)=>{i.d(t,{J4:()=>h,VB:()=>g,_s:()=>y,bK:()=>p,tB:()=>d});var r=i(32114),n=i(81095),s=i(37116),o=i(73687),a=i(94576),l=i(87564),c=i(66218),u=i(55061);function h(e,t){return(0,c.es)(e)||(0,c.G1)(e)?m(e.target?.object,t):(0,l.TX)(e)?t.map?.ground:(0,a.a8)(e)||(0,a.GS)(e)||(0,l.j9)(e)||(0,a.A8)(e)?m(e.target,t):null}function d(e,t){const i=p(e,t);return null!=i&&"graphic"===i.type?i.graphic:null}function p(e,t){if(null==e)return null;if((0,c.es)(e)||(0,c.G1)(e))return f(e.target?.object,t);if((0,a.a8)(e)){const t=e.target.createGraphic();return{type:"graphic",graphic:t,layer:t.layer}}if((0,a.A8)(e)){const t=e.target.createVoxelGraphic();return{type:"graphic",graphic:t,layer:t.layer}}if((0,a.BF)(e)){const t=e.target.createTiles3DGraphic();return{type:"graphic",graphic:t,layer:t.layer}}return(0,l.j9)(e)||(0,u.w)(e)?f(e.target,t):(0,a.GS)(e)?function(e,t){const i=m(e,t);if(null==i)return null;const r=t.allLayerViews.find((e=>e.layer===i));return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?function(e){return null!=e?{type:"graphic",graphic:e,layer:e.layer}:null}(r.getGraphicFromIntersectorTarget(e)):null}(e.target,t):null}function f(e,t){if(null==e?.graphicUid)return null;const i=m(e,t);if(null==i)return null;if(i===t.graphics)return null==t.graphicsView||"number"!=typeof e.graphicUid?null:t.graphicsView.getHit(e.graphicUid);const r=t.allLayerViews.find((e=>e.layer===i));return!r||r.suspended||null==e.graphicUid?null:"getHit"in r?r.getHit(e.graphicUid):null}function m(e,t){return null==e?.layerUid?null:null!=t.graphicsView&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.allLayers.find((t=>t.uid===e.layerUid))}function g(e,t){if((0,c.es)(e)||(0,c.G1)(e))return(0,o.g)(e.target.object.boundingVolumeWorldSpace.bounds);if((0,u.w)(e)){(0,r.Q$)(_,e.transformation);const t=Math.max(_[0],_[1],_[2]);return e.target.baseBoundingSphere.radius*t}if((0,a.GS)(e)){const i=function(e,t){const i=m(e,t);if(null==i)return null;const r=t.allLayerViews.find((e=>e.layer===i));return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(e):null}(e.target,t);return i?.5*(0,s.wz)(i):null}return null}function y(e){return!(0,c.es)(e)&&!(0,c.G1)(e)&&((0,u.w)(e)?e.target.numLodLevels>1:!!(0,a.GS)(e))}const _=(0,n.Ue)()},55061:(e,t,i)=>{i.d(t,{w:()=>a,x:()=>o});var r=i(20757),n=i(10774),s=i(66218);class o extends n.Dx{constructor(e,t,i,r,n){super(e,t),this.layerUid=e,this.graphicUid=t,this.triangleNr=i,this.baseBoundingSphere=r,this.numLodLevels=n}}function a(e){return(0,s.nn)(e)&&e.intersector===r.q7.LOD&&!!e.target}},3248:(e,t,i)=>{i.d(t,{Np:()=>c,QD:()=>d,T6:()=>p,hO:()=>f,pT:()=>u});var r=i(7753),n=i(99235),s=i(8927),o=i(20757),a=i(21414),l=i(55061);class c{constructor(e,t,i,r){this.material=e,this.bufferWriter=e.createBufferWriter(),this.vertexBufferLayout=this.bufferWriter.vertexBufferLayout,this.buffer=t,this.elementCount=i,this.boundingInfo=r}get numTriangles(){return this.elementCount/3}get numVertices(){return this.elementCount}computeUsedMemory(){return this.buffer.byteLength+n.Qi}getRenderGeometry(){return this}intersect(e,t,i,r,n,s,o,a){const l=this.bufferWriter,c=this.buffer;l.intersect(c,e,i,r,((i,r,l,c,u)=>h(i,r,l,u,e,t,s,o,n,a)))}}class u{constructor(e){this.engineGeometry=e}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.attributes.get(a.T.POSITION).indices.length}get numTriangles(){return this.engineGeometry.indexCount/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce(((e,t)=>e+(0,n.G7)(t.data,t.indices)),0)}getRenderGeometry(){const e=this.material,t=this.engineGeometry,i=t.attributes,r=t.boundingInfo,n=e.createBufferWriter(),s=n.vertexBufferLayout,o=n.elementCount(i),a=s.createBuffer(o);return n.write(null,null,i,null,a,0),new c(e,a.buffer,o,r)}intersect(e,t,i,r,n,s,o,a){const l=this.engineGeometry;this.material.intersect(l,e.transform.transform,e,i,r,((i,r,l,c,u)=>h(i,r,l,u,e,t,s,o,n,a)))}}function h(e,t,i,r,n,a,c,u,h,d){if(e<0)return;if(a&&!a(n.rayBegin,n.rayEnd,e))return;const p=new l.x(c.layerUid,c.graphicUid(h),i,u,d);if((null==n.results.min.drapedLayerOrder||r>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||e<n.results.min.dist)&&n.results.min.set(o.q7.LOD,p,e,t,n.transform.transform,r),n.options.store!==o.eC.MIN&&(null==n.results.max.drapedLayerOrder||r>=n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||e>n.results.max.dist)&&n.results.max.set(o.q7.LOD,p,e,t,n.transform.transform,r),n.options.store===o.eC.ALL){const i=(0,s.LP)(n.results.min.ray);i.set(o.q7.LOD,p,e,t,n.transform.transform,r),n.results.all.push(i)}}class d{constructor(e,t=null){this.geometry=e,this.textures=t}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}}class p{constructor(e,t,i){this.components=e,this.minScreenSpaceRadius=t,this.pivotOffset=i;const n=(0,r.Tw)(this.components.map((e=>e.geometry)));this.numVertices=n.reduce(((e,t)=>e+t.numVertices),0)}}class f{constructor(e){this.levels=e,this.levels.sort(((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius))}getMaterials(){const e=[];return this.levels.forEach((t=>t.components.forEach((t=>e.push(t.geometry.material))))),(0,r.Tw)(e)}getTextures(){const e=new Array;return this.levels.forEach((t=>t.components.forEach((t=>{null!=t.textures&&e.push(...t.textures)})))),(0,r.Tw)(e)}getGeometries(){const e=new Array;return this.levels.forEach((t=>t.components.forEach((t=>{e.push(t.geometry)})))),(0,r.Tw)(e)}getEngineGeometries(){return this.getGeometries().map((e=>e.engineGeometry)).filter((e=>null!=e))}computeUsedMemory(){const e=this.getGeometries(),t=this.getTextures(),i=e.reduce(((e,t)=>e+t.computeUsedMemory()),0);return t.reduce(((e,t)=>e+t.memoryEstimate),0)+i}}},74533:(e,t,i)=>{i.d(t,{Np:()=>n,YE:()=>r,q9:()=>o});var r,n,s=i(2236);function o(e){const t=new Map,i=e=>{let i=t.get(e);return i||(i=new s.t9,t.set(e,i)),i};return e.removes.forAll((e=>{a(e)&&i(e.material).removes.push(e)})),e.adds.forAll((e=>{a(e)&&i(e.material).adds.push(e)})),e.updates.forAll((e=>{a(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)})),t}function a(e){return e.geometry.indexCount>=1}!function(e){e[e.Default=0]="Default",e[e.Screenshot=1]="Screenshot",e[e.ObjectAndLayerID=2]="ObjectAndLayerID"}(r||(r={})),function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(n||(n={}))},72946:(e,t,i)=>{i.d(t,{Gw:()=>a,PV:()=>h,TU:()=>d,bA:()=>p,n9:()=>l,sX:()=>u});var r=i(19431),n=i(96739),s=i(73687),o=i(65684);function a(e,t){return new f(e,m,t)}function l(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:n}=m;return new f(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:g.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:g.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:n,minPixelSize:g.minPixelSize},t)}function c(e,t,i){const r=i.parameters;return y.scale=Math.min(r.divisor/(t-r.offset),1),y.factor=function(e){return Math.abs(e*e*e)}(e),y}function u(e,t){return(0,r.t7)(e*Math.max(t.scale,t.minScaleFactor),e,t.factor)}function h(e,t,i,r){r.scale=function(e,t,i){const r=c(e,t,i);return r.minScaleFactor=0,u(1,r)}(e,t,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function d(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,t.minScaleFactor),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function p(e,t,i,r){return u(e,c(t,i,r))}class f{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,t,i,r={camera:{distance:0,fovY:0},divisor:0,offset:0},n){this._viewingMode=e,this._description=t,this._ellipsoidRadius=i,this.parameters=r,this._fontHeight=n,this._viewingMode===o.JY.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),0))}overrideFontHeight(e){return e!==this._fontHeight?new f(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,t,i){const{scaleStart:r,scaleFallOffRange:n}=this._description,{fovY:s,distance:o}=e,a=this._calculateCurvatureDependentParameters(e,t),l=this._coverageCompensation(e,t,a),{tiltAngle:c,scaleFallOffFactor:u}=a,h=Math.sin(c)*o,d=.5*Math.PI-c-s*(.5-r*l),p=h/Math.cos(d),f=d+s*n*l,m=(p-u*(h/Math.cos(f)))/(1-u);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=m,i.divisor=p-m,i}_calculateCurvatureDependentParametersLocal(e,t,i=_){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,t,i=_){const n=this._description.curvatureDependent,s=1+e.distance/t,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=(0,r.uZ)((o-a)/(l-a),0,1),[u,h]=[n.min,n.max];return i.tiltAngle=(0,r.t7)(u.tiltAngle,h.tiltAngle,c),i.scaleFallOffFactor=(0,r.t7)(u.scaleFallOffFactor,h.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,t,i){return(0,n.c)(i.tiltAngle,e.fovY)}_surfaceCoverageCompensationGlobal(e,t,i){return(0,s.b)(v,t),(0,s.d)(v,i.tiltAngle,e.distance,e.fovY)}}const m={curvatureDependent:{min:{curvature:(0,r.Vl)(10),tiltAngle:(0,r.Vl)(12),scaleFallOffFactor:.5},max:{curvature:(0,r.Vl)(70),tiltAngle:(0,r.Vl)(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},g={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};const y={scale:0,factor:0,minScaleFactor:0},_={tiltAngle:0,scaleFallOffFactor:0},v=(0,s.c)()},39169:(e,t,i)=>{i.d(t,{p:()=>n,y:()=>r});const r={stableRendering:!1},n={rootOrigin:null}},42142:(e,t,i)=>{i.d(t,{n9:()=>o,nq:()=>n,pf:()=>s,qB:()=>a});var r=i(70375);function n(e){return 16*Math.ceil(e/16)}function s(e){return 16*Math.floor(e/16)}function o(e,t){let i=e.width*e.height;if(i<4096)return e instanceof ImageData?c(e):e;let r=e.width,n=e.height;do{r=Math.ceil(r/2),n=Math.ceil(n/2),i=r*n}while(i>1048576||null!=t&&(r>t||n>t));return l(e,r,n)}function a(e,t){const i=Math.max(e.width,e.height);if(i<=t)return e;const r=t/i;return l(e,Math.round(e.width*r),Math.round(e.height*r))}function l(e,t,i){if(e instanceof ImageData)return l(c(e),t,i);const r=document.createElement("canvas");return r.width=t,r.height=i,r.getContext("2d").drawImage(e,0,0,r.width,r.height),r}function c(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");if(null==i)throw new r.Z("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(e,0,0),t}},5073:(e,t,i)=>{i.d(t,{W9:()=>m,iO:()=>y,lV:()=>v,xX:()=>b,yn:()=>d});var r=i(46332),n=i(3965),s=i(32114),o=i(3308),a=i(86717),l=i(81095),c=i(73687),u=i(65684),h=i(47850);class d{constructor(){this._transform=(0,o.Ue)(),this._transformInverse=new p({value:this._transform},s.U_,o.Ue),this._transformInverseTranspose=new p(this._transformInverse,s.p4,o.Ue),this._transformTranspose=new p({value:this._transform},s.p4,o.Ue),this._transformInverseRotation=new p({value:this._transform},r.f6,n.Ue)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){(0,s.JG)(this._transform,e)}multiplyTransform(e){(0,s.Jp)(this._transform,this._transform,e)}set(e){(0,s.JG)(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class p{constructor(e,t,i){this._original=e,this._update=t,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const f=new class{constructor(e=0){this.offset=e,this.sphere=(0,c.c)(),this.tmpVertex=(0,l.Ue)()}applyToVertex(e,t,i){const r=this.objectTransform.transform,n=(0,a.i)(w,e,t,i),s=(0,a.t)(n,n,r),o=this.offset/(0,a.l)(s);(0,a.b)(s,s,s,o);const l=this.objectTransform.inverse;return(0,a.t)(this.tmpVertex,s,l),this.tmpVertex}applyToMinMax(e,t){const i=this.offset/(0,a.l)(e);(0,a.b)(e,e,e,i);const r=this.offset/(0,a.l)(t);(0,a.b)(t,t,t,r)}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const t=(0,a.l)((0,c.a)(e)),i=this.offset/t;return(0,a.b)((0,c.a)(this.sphere),(0,c.a)(e),(0,c.a)(e),i),this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function m(e){return null!=e?(f.offset=e,f):null}const g=new class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=(0,l.Ue)(),this._tmpMbs=(0,c.c)(),this._tmpObb=new h.Oo,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=(0,a.l)(e)}applyToVertex(e,t,i){const r=(0,a.i)(w,e,t,i),n=(0,a.i)(x,e,t,i+this.componentLocalOriginLength),s=this._totalOffset/(0,a.l)(n);return(0,a.b)(this._tmpVertex,r,n,s),this._tmpVertex}applyToAabb(e){const t=this.componentLocalOriginLength,i=e[0],r=e[1],n=e[2]+t,s=e[3],o=e[4],a=e[5]+t,l=Math.abs(i),c=Math.abs(r),u=Math.abs(n),h=Math.abs(s),d=Math.abs(o),p=Math.abs(a),f=.5*(1+Math.sign(i*s))*Math.min(l,h),m=.5*(1+Math.sign(r*o))*Math.min(c,d),g=.5*(1+Math.sign(n*a))*Math.min(u,p),y=Math.max(l,h),_=Math.max(c,d),v=Math.max(u,p),b=Math.sqrt(f*f+m*m+g*g),w=Math.sign(l+i),x=Math.sign(c+r),T=Math.sign(u+n),C=Math.sign(h+s),S=Math.sign(d+o),E=Math.sign(p+a),M=this._totalOffset;if(b<M)return e[0]-=(1-w)*M,e[1]-=(1-x)*M,e[2]-=(1-T)*M,e[3]+=C*M,e[4]+=S*M,e[5]+=E*M,e;const A=M/Math.sqrt(y*y+_*_+v*v),R=M/b,O=R-A,P=-O;return e[0]+=i*(w*P+R),e[1]+=r*(x*P+R),e[2]+=n*(T*P+R),e[3]+=s*(C*O+A),e[4]+=o*(S*O+A),e[5]+=a*(E*O+A),e}applyToMbs(e){const t=(0,a.l)((0,c.a)(e)),i=this._totalOffset/t;return(0,a.b)((0,c.a)(this._tmpMbs),(0,c.a)(e),(0,c.a)(e),i),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/t,this._tmpMbs}applyToObb(e){return(0,h.gI)(e,this._totalOffset,this._totalOffset,u.JY.Global,this._tmpObb),this._tmpObb}};function y(e){return null!=e?(g.offset=e,g):null}const _=new class{constructor(e=0){this.offset=e,this.tmpVertex=(0,l.Ue)()}applyToVertex(e,t,i){const r=(0,a.i)(w,e,t,i),n=(0,a.g)(x,r,this.localOrigin),s=this.offset/(0,a.l)(n);return(0,a.b)(this.tmpVertex,r,n,s),this.tmpVertex}applyToAabb(e){const t=T,i=C,r=S;for(let n=0;n<3;++n)t[n]=e[0+n]+this.localOrigin[n],i[n]=e[3+n]+this.localOrigin[n],r[n]=t[n];const n=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=n[t],e[t+3]=n[t];const s=t=>{const i=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=Math.min(e[t],i[t]),e[t+3]=Math.max(e[t+3],i[t])};for(let e=1;e<8;++e){for(let n=0;n<3;++n)r[n]=e&1<<n?i[n]:t[n];s(r)}let o=0;for(let e=0;e<3;++e)t[e]*i[e]<0&&(o|=1<<e);if(0!==o&&7!==o)for(let e=0;e<8;++e)if(!(o&e)){for(let n=0;n<3;++n)r[n]=o&1<<n?0:e&1<<n?t[n]:i[n];s(r)}for(let t=0;t<3;++t)e[t]-=this.localOrigin[t],e[t+3]-=this.localOrigin[t];return e}};function v(e){return null!=e?(_.offset=e,_):null}const b="terrain",w=(0,l.Ue)(),x=(0,l.Ue)(),T=(0,l.Ue)(),C=(0,l.Ue)(),S=(0,l.Ue)()},23627:(e,t,i)=>{i.d(t,{AM:()=>s,Eg:()=>o,Mi:()=>n,Ur:()=>a});var r=i(81095);class n{constructor(e=(0,r.ll)()){this.intensity=e}}class s{constructor(e=(0,r.ll)(),t=(0,r.al)(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class o{constructor(e=(0,r.ll)(),t=(0,r.al)(.57735,.57735,.57735),i=!0,n=1,s=1){this.intensity=e,this.direction=t,this.castShadows=i,this.specularStrength=n,this.environmentStrength=s}}class a{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},39501:(e,t,i)=>{i.d(t,{cI:()=>S,Vt:()=>C});var r=i(19431),n=i(86717),s=i(81095),o=i(23627);function a(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function l(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function c(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function u(e){return(e+1)*(e+1)}function h(e,t,i){const r=e[0],n=e[1],s=e[2],o=i||[];return o.length=u(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*s,o[3]=.4886025119*n),t>=2&&(o[4]=1.09254843059*r*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*r*s,o[8]=.54627421529*(r*r-n*n)),o}function d(e,t){const i=u(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let e=0;e<i;e++)r.r[e]=r.g[e]=r.b[e]=0;return r}function p(e,t){const i=function(e){return(0,r.uZ)(Math.floor(Math.sqrt(e)-1),0,2)}(t.r.length);for(const r of e)(0,n.v)(b,r.direction),h(b,i,_),a(_,w),l(_,r.intensity[0],v),c(t.r,v),l(_,r.intensity[1],v),c(t.g,v),l(_,r.intensity[2],v),c(t.b,v);return t}function f(e,t){h(b,0,_);for(const i of e)t.r[0]+=_[0]*w[0]*i.intensity[0]*4*Math.PI,t.g[0]+=_[0]*w[0]*i.intensity[1]*4*Math.PI,t.b[0]+=_[0]*w[0]*i.intensity[2]*4*Math.PI;return t}const m=[],g=[],y=[],_=[0],v=[0],b=(0,s.Ue)(),w=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class x{constructor(){this.color=(0,s.Ue)(),this.intensity=1}}class T{constructor(){this.direction=(0,s.Ue)(),this.ambient=new x,this.diffuse=new x}}const C=.4;class S{constructor(){this._shOrder=2,this._legacy=new T,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new o.Ur,this._mainLight=new o.Eg((0,s.Ue)(),(0,s.al)(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){(function(e,t,i,r){d(t,r),(0,n.i)(i.intensity,0,0,0);let s=!1;const a=m,l=g,u=y;a.length=0,l.length=0,u.length=0;for(const t of e)t instanceof o.Eg&&!s?((0,n.c)(i.direction,t.direction),(0,n.c)(i.intensity,t.intensity),i.specularStrength=t.specularStrength,i.environmentStrength=t.environmentStrength,i.castShadows=t.castShadows,s=!0):t instanceof o.Eg||t instanceof o.AM?a.push(t):t instanceof o.Mi?l.push(t):t instanceof o.Ur&&u.push(t);p(a,r),f(l,r);for(const e of u)c(r.r,e.r),c(r.g,e.g),c(r.b,e.b)})(e,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,n.c)(this._legacy.direction,this._mainLight.direction);const t=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,(0,n.h)(this._legacy.diffuse.color,this._mainLight.intensity,t),(0,n.c)(E,this._legacy.diffuse.color),(0,n.h)(E,E,C*this.globalFactor),(0,n.g)(this._legacy.ambient.color,this._legacy.ambient.color,E)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),(0,n.c)(this._mainLight.direction,e.mainLight.direction),(0,n.c)(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,t,i){if((0,n.m)(this._mainLight.intensity,e.mainLight.intensity,t.mainLight.intensity,i),this._mainLight.environmentStrength=(0,r.t7)(e.mainLight.environmentStrength,t.mainLight.environmentStrength,i),this._mainLight.specularStrength=(0,r.t7)(e.mainLight.specularStrength,t.mainLight.specularStrength,i),(0,n.c)(this._mainLight.direction,t.mainLight.direction),this._mainLight.castShadows=t.mainLight.castShadows,this.globalFactor=(0,r.t7)(e.globalFactor,t.globalFactor,i),this.noonFactor=(0,r.t7)(e.noonFactor,t.noonFactor,i),e.sh.r.length===t.sh.r.length)for(let n=0;n<t.sh.r.length;n++)this._sphericalHarmonics.r[n]=(0,r.t7)(e.sh.r[n],t.sh.r[n],i),this._sphericalHarmonics.g[n]=(0,r.t7)(e.sh.g[n],t.sh.g[n],i),this._sphericalHarmonics.b[n]=(0,r.t7)(e.sh.b[n],t.sh.b[n],i);else for(let e=0;e<t.sh.r.length;e++)this._sphericalHarmonics.r[e]=t.sh.r[e],this._sphericalHarmonics.g[e]=t.sh.g[e],this._sphericalHarmonics.b[e]=t.sh.b[e]}}const E=(0,s.Ue)()},79601:(e,t,i)=>{i.d(t,{G:()=>c});var r=i(86717),n=i(81095),s=i(81936),o=i(85906),a=i(21414),l=i(21123);class c{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.get(a.T.POSITION).indices.length}write(e,t,i,r,n,s){(0,l.NK)(i,r,this.vertexBufferLayout,e,t,n,s)}intersect(e,t,i,n,l){const c=this.vertexBufferLayout.createView(e).getField(a.T.POSITION,s.ct);if(null==c)return;const h=(0,r.a)(u,n,i),d=c.elementCount/3,p=t.options.normalRequired;(0,o.IG)(i,h,0,d,c.typedBuffer,c.typedBufferStride,p,((e,t,i)=>{l(e,i,t,!1)}))}}const u=(0,n.Ue)()},46151:(e,t,i)=>{i.d(t,{Gp:()=>L});var r=i(86717),n=i(81095),s=i(65684),o=i(44685),a=i(35031),l=i(7792),c=i(57583),u=i(2833),h=i(3864),d=i(43338),p=i(70984),f=i(80776),m=i(7358),g=i(12045),y=i(85906),_=i(46378),v=i(21414),b=i(5073),w=i(79601),x=i(25584),T=i(28541),C=i(36663),S=i(82082),E=i(12907),M=i(22957);class A extends M.W{constructor(e,t){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=t,this.alphaDiscardMode=p.JJ.Opaque,this.doubleSidedMode=u.q.None,this.pbrMode=h.f7.Disabled,this.cullFace=p.Vr.None,this.normalType=l.r.Attribute,this.customDepthTest=p.Gv.Less,this.emissionSource=c.jo.None,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.hasVvInstancing=!0,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0}get textureCoordinateType(){return this.hasColorTexture||this.hasMetallicRoughnessTexture||this.emissionSource===c.jo.Texture||this.hasOcclusionTexture||this.hasNormalTexture?S.I.Default:S.I.None}get objectAndLayerIdColorInstanced(){return this.instanced}get discardInvisibleFragments(){return this.transparent}}(0,C._)([(0,E.o)({count:p.JJ.COUNT})],A.prototype,"alphaDiscardMode",void 0),(0,C._)([(0,E.o)({count:u.q.COUNT})],A.prototype,"doubleSidedMode",void 0),(0,C._)([(0,E.o)({count:h.f7.COUNT})],A.prototype,"pbrMode",void 0),(0,C._)([(0,E.o)({count:p.Vr.COUNT})],A.prototype,"cullFace",void 0),(0,C._)([(0,E.o)({count:l.r.COUNT})],A.prototype,"normalType",void 0),(0,C._)([(0,E.o)({count:p.Gv.COUNT})],A.prototype,"customDepthTest",void 0),(0,C._)([(0,E.o)({count:c.jo.COUNT})],A.prototype,"emissionSource",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasVertexColors",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasSymbolColors",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasVerticalOffset",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasColorTexture",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasMetallicRoughnessTexture",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasOcclusionTexture",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasNormalTexture",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasScreenSizePerspective",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasVertexTangents",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasOccludees",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasModelTransformation",void 0),(0,C._)([(0,E.o)()],A.prototype,"offsetBackfaces",void 0),(0,C._)([(0,E.o)()],A.prototype,"vvSize",void 0),(0,C._)([(0,E.o)()],A.prototype,"vvColor",void 0),(0,C._)([(0,E.o)()],A.prototype,"receiveShadows",void 0),(0,C._)([(0,E.o)()],A.prototype,"receiveAmbientOcclusion",void 0),(0,C._)([(0,E.o)()],A.prototype,"textureAlphaPremultiplied",void 0),(0,C._)([(0,E.o)()],A.prototype,"instanced",void 0),(0,C._)([(0,E.o)()],A.prototype,"instancedColor",void 0),(0,C._)([(0,E.o)()],A.prototype,"writeDepth",void 0),(0,C._)([(0,E.o)()],A.prototype,"transparent",void 0),(0,C._)([(0,E.o)()],A.prototype,"enableOffset",void 0),(0,C._)([(0,E.o)()],A.prototype,"terrainDepthTest",void 0),(0,C._)([(0,E.o)()],A.prototype,"cullAboveTerrain",void 0),(0,C._)([(0,E.o)()],A.prototype,"snowCover",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasColorTextureTransform",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasEmissionTextureTransform",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasNormalTextureTransform",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasOcclusionTextureTransform",void 0),(0,C._)([(0,E.o)()],A.prototype,"hasMetallicRoughnessTextureTransform",void 0);var R=i(9969),O=i(60926);class P extends T.tT{constructor(e,t){super(e,t,new R.J(O.R,(()=>i.e(56353).then(i.bind(i,56353))))),this.type="RealisticTreeTechnique"}}var I=i(5226);class L extends m.F5{constructor(e,t){super(e,N),this.materialType="default",this.supportsEdges=!0,this.produces=new Map([[_.r.OPAQUE_MATERIAL,e=>((0,a.ED)(e)||(0,a.Kr)(e))&&!this.parameters.transparent],[_.r.TRANSPARENT_MATERIAL,e=>((0,a.ED)(e)||(0,a.Kr)(e))&&this.parameters.transparent&&this.parameters.writeDepth],[_.r.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>((0,a.Jb)(e)||(0,a.Kr)(e))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._vertexBufferLayout=function(e){const t=(0,o.U$)().vec3f(v.T.POSITION);return e.normalType===l.r.Compressed?t.vec2i16(v.T.NORMALCOMPRESSED,{glNormalized:!0}):t.vec3f(v.T.NORMAL),e.hasVertexTangents&&t.vec4f(v.T.TANGENT),(e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId)&&t.vec2f(v.T.UV0),e.hasVertexColors&&t.vec4u8(v.T.COLOR),e.hasSymbolColors&&t.vec4u8(v.T.SYMBOLCOLOR),(0,d.B)()&&t.vec4u8(v.T.OBJECTANDLAYERIDCOLOR),t}(this.parameters),this._configuration=new A(t.spherical,t.doublePrecisionRequiresObfuscation)}isVisibleForOutput(e){return e!==a.H_.Shadow&&e!==a.H_.ShadowExcludeHighlight&&e!==a.H_.ShadowHighlight||this.parameters.castShadows}get visible(){const e=this.parameters;if(e.layerOpacity<I.e)return!1;const{hasInstancedColor:t,hasVertexColors:i,hasSymbolColors:r,vvColor:n}=e,s=t||n||r,o="replace"===e.colorMixMode,a=e.opacity>=I.e;if(i&&s)return o||a;const l=e.externalColor&&e.externalColor[3]>=I.e;return i?o?l:a:s?o||a:o?l:a}get hasEmissions(){return!!this.parameters.emissiveTextureId||!(0,r.p)(this.parameters.emissiveFactor,n.AG)}getConfiguration(e,t){const i=this.parameters,{treeRendering:r,doubleSided:n,doubleSidedType:s}=i;return this._configuration.output=e,this._configuration.hasNormalTexture=!r&&!!i.normalTextureId,this._configuration.hasColorTexture=!!i.textureId,this._configuration.hasVertexTangents=!r&&i.hasVertexTangents,this._configuration.instanced=i.isInstanced,this._configuration.instancedDoublePrecision=i.instancedDoublePrecision,this._configuration.vvSize=!!i.vvSize,this._configuration.hasVerticalOffset=null!=i.verticalOffset,this._configuration.hasScreenSizePerspective=null!=i.screenSizePerspective,this._configuration.hasSlicePlane=i.hasSlicePlane,this._configuration.alphaDiscardMode=i.textureAlphaMode,this._configuration.normalType=r?l.r.Attribute:i.normalType,this._configuration.transparent=i.transparent,this._configuration.writeDepth=i.writeDepth,null!=i.customDepthTest&&(this._configuration.customDepthTest=i.customDepthTest),this._configuration.hasOccludees=t.hasOccludees,this._configuration.cullFace=i.hasSlicePlane?p.Vr.None:i.cullFace,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.hasModelTransformation=!r&&null!=i.modelTransformation,this._configuration.hasVertexColors=i.hasVertexColors,this._configuration.hasSymbolColors=i.hasSymbolColors,this._configuration.doubleSidedMode=r?u.q.WindingOrder:n&&"normal"===s?u.q.View:n&&"winding-order"===s?u.q.WindingOrder:u.q.None,this._configuration.instancedColor=i.hasInstancedColor,(0,a.c1)(e)?(this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.receiveShadows=i.receiveShadows,this._configuration.receiveAmbientOcclusion=i.receiveAmbientOcclusion&&null!=t.ssao):(this._configuration.terrainDepthTest=!1,this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1),this._configuration.vvColor=!!i.vvColor,this._configuration.textureAlphaPremultiplied=!!i.textureAlphaPremultiplied,this._configuration.pbrMode=i.usePBR?i.isSchematic?h.f7.Schematic:h.f7.Normal:h.f7.Disabled,this._configuration.hasMetallicRoughnessTexture=!r&&!!i.metallicRoughnessTextureId,this._configuration.emissionSource=r?c.jo.None:null!=i.emissiveTextureId?c.jo.Texture:i.usePBR?c.jo.Value:c.jo.None,this._configuration.hasOcclusionTexture=!r&&!!i.occlusionTextureId,this._configuration.offsetBackfaces=!(!i.transparent||!i.offsetTransparentBackfaces),this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<g.ve,this._configuration.snowCover=function(e){return null!=e.weather&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}(t),this._configuration.hasColorTextureTransform=!!i.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!i.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!i.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!i.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!i.metallicRoughnessTextureTransformMatrix,this._configuration}intersect(e,t,i,n,o,a){if(null!=this.parameters.verticalOffset){const e=i.camera;(0,r.i)(V,t[12],t[13],t[14]);let a=null;switch(i.viewingMode){case s.JY.Global:a=(0,r.n)(z,V);break;case s.JY.Local:a=(0,r.c)(z,k)}let l=0;const c=(0,r.d)(H,V,e.eye),u=(0,r.l)(c),h=(0,r.h)(c,c,1/u);let d=null;this.parameters.screenSizePerspective&&(d=(0,r.f)(a,h)),l+=(0,x.Hx)(e,u,this.parameters.verticalOffset,d??0,this.parameters.screenSizePerspective),(0,r.h)(a,a,l),(0,r.q)(B,a,i.transform.inverseRotation),n=(0,r.d)(F,n,B),o=(0,r.d)(U,o,B)}(0,y.Bw)(e,i,n,o,(0,b.W9)(i.verticalOffset),a)}createGLMaterial(e){return new D(e)}createBufferWriter(){return new w.G(this._vertexBufferLayout)}}class D extends f.Fj{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){this._material.setParameters({receiveShadows:e.shadowMap.enabled});const t=this._material.parameters;this.updateTexture(t.textureId);const i=e.camera.viewInverseTransposeMatrix;return(0,r.i)(t.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.getTechnique(t.treeRendering?P:T.tT,e)}}class N extends T.em{constructor(){super(...arguments),this.treeRendering=!1,this.hasVertexTangents=!1}}const F=(0,n.Ue)(),U=(0,n.Ue)(),k=(0,n.al)(0,0,1),z=(0,n.Ue)(),B=(0,n.Ue)(),V=(0,n.Ue)(),H=(0,n.Ue)()},22957:(e,t,i)=>{i.d(t,{W:()=>c});var r=i(36663),n=i(35031),s=i(12907);class o extends s.m{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}(0,r._)([(0,s.o)()],o.prototype,"instancedDoublePrecision",void 0),(0,r._)([(0,s.o)()],o.prototype,"hasModelTransformation",void 0);var a=i(97994),l=i(5224);class c extends o{constructor(){super(...arguments),this.output=n.H_.Color,this.oitPass=a.M.NONE,this.hasSlicePlane=!1,this.bindType=l.P.Pass,this.writeDepth=!0}}(0,r._)([(0,s.o)({count:n.H_.COUNT})],c.prototype,"output",void 0),(0,r._)([(0,s.o)({count:a.M.COUNT})],c.prototype,"oitPass",void 0),(0,r._)([(0,s.o)()],c.prototype,"hasSlicePlane",void 0)},22456:(e,t,i)=>{i.d(t,{w:()=>s});var r=i(81095),n=i(78549);class s extends n.Pf{constructor(e=(0,r.Ue)()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}}},98166:(e,t,i)=>{i.d(t,{A:()=>W});var r=i(19431),n=i(46332),s=i(3965),o=i(32114),a=i(3308),l=i(36531),c=i(84164),u=i(86717),h=i(81095),d=i(52721);function p(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var f=i(24568),m=i(81936),g=i(85132),y=i(3289),_=i(44685),v=i(35031),b=i(21737),w=i(43338),x=i(80776),T=i(7358),C=i(46378),S=i(72946),E=i(15095),M=i(21414),A=i(40353),R=i(21123),O=i(25584),P=i(56444),I=i(9969),L=i(62575),D=i(97994),N=i(12045),F=i(91907),U=i(17346);class k extends L.A{constructor(e,t){super(e,t,new I.J(P.H,(()=>i.e(49180).then(i.bind(i,49180))))),this.primitiveType=t.occlusionPass?F.MX.POINTS:F.MX.TRIANGLES}initializePipeline(e){const{oitPass:t,hasPolygonOffset:i,draped:r,output:n,depthTestEnabled:s,occlusionPass:o}=e,a=t===D.M.NONE,l=t===D.M.ColorAlpha,c=n===v.H_.Highlight,u=s&&!r&&!l&&!o&&!c;return(0,U.sm)({blending:(0,v.c1)(n)?a?U.xW:(0,N.j7)(t):null,depthTest:s&&!r?{func:F.wb.LEQUAL}:null,depthWrite:u?U.ck:null,drawBuffers:(0,N.u_)(t,n),colorWrite:U.gf,polygonOffset:i?z:null})}}const z={factor:0,units:-4};var B=i(36663),V=i(82082),H=i(57583),G=i(12907),j=i(22957);class Z extends j.W{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.textureCoordinateType=V.I.None,this.emissionSource=H.jo.None,this.discardInvisibleFragments=!0,this.hasVvInstancing=!1}}(0,B._)([(0,G.o)()],Z.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,B._)([(0,G.o)()],Z.prototype,"occlusionTestEnabled",void 0),(0,B._)([(0,G.o)()],Z.prototype,"signedDistanceFieldEnabled",void 0),(0,B._)([(0,G.o)()],Z.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,B._)([(0,G.o)()],Z.prototype,"vvSize",void 0),(0,B._)([(0,G.o)()],Z.prototype,"vvColor",void 0),(0,B._)([(0,G.o)()],Z.prototype,"hasVerticalOffset",void 0),(0,B._)([(0,G.o)()],Z.prototype,"hasScreenSizePerspective",void 0),(0,B._)([(0,G.o)()],Z.prototype,"hasRotation",void 0),(0,B._)([(0,G.o)()],Z.prototype,"debugDrawLabelBorder",void 0),(0,B._)([(0,G.o)()],Z.prototype,"hasPolygonOffset",void 0),(0,B._)([(0,G.o)()],Z.prototype,"depthTestEnabled",void 0),(0,B._)([(0,G.o)()],Z.prototype,"pixelSnappingEnabled",void 0),(0,B._)([(0,G.o)()],Z.prototype,"draped",void 0),(0,B._)([(0,G.o)()],Z.prototype,"terrainDepthTest",void 0),(0,B._)([(0,G.o)()],Z.prototype,"cullAboveTerrain",void 0),(0,B._)([(0,G.o)()],Z.prototype,"occlusionPass",void 0),(0,B._)([(0,G.o)()],Z.prototype,"occludedFragmentFade",void 0),(0,B._)([(0,G.o)()],Z.prototype,"objectAndLayerIdColorInstanced",void 0),(0,B._)([(0,G.o)()],Z.prototype,"horizonCullingEnabled",void 0),(0,B._)([(0,G.o)()],Z.prototype,"isFocused",void 0);var q=i(5226);class W extends T.F5{constructor(e,t){super(e,ge),this.produces=new Map([[C.r.HUD_MATERIAL,e=>(0,v.Qo)(e)&&!this.parameters.drawAsLabel],[C.r.LABEL_MATERIAL,e=>(0,v.Qo)(e)&&this.parameters.drawAsLabel],[C.r.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[C.r.DRAPED_MATERIAL,e=>this.parameters.draped&&(0,v.Qo)(e)]]),this._visible=!0,this._configuration=new Z(t)}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===C.r.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||t.slot===C.r.OCCLUSION_PIXELS,(0,v.c1)(e)&&(this._configuration.debugDrawLabelBorder=!!y.h.LABELS_SHOW_BORDER),this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}intersect(e,t,i,r,s,a){const{options:{selectionMode:l,hud:c,excludeLabels:d},point:p,camera:f}=i,{parameters:m}=this;if(!l||!c||d&&m.isLabel||!e.visible||!p)return;const{scaleX:g,scaleY:y}=this._getScreenScale(e,f.pixelRatio);(0,n.xO)(se,t),e.attributes.has(M.T.FEATUREATTRIBUTE)&&function(e){const t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+i*i+r*r),h=1/Math.sqrt(n*n+s*s+o*o),d=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*u,e[1]=i*u,e[2]=r*u,e[3]=n*h,e[4]=s*h,e[5]=o*h,e[6]=a*d,e[7]=l*d,e[8]=c*d}(se);const _=e.attributes.get(M.T.POSITION),v=e.attributes.get(M.T.SIZE),b=e.attributes.get(M.T.NORMAL),w=e.attributes.get(M.T.ROTATION),x=e.attributes.get(M.T.CENTEROFFSETANDDISTANCE);(0,E.hu)(_.size>=3);const T=(0,P.c)(m),C="screen"===this.parameters.centerOffsetUnits;for(let e=0;e<_.data.length/_.size;e++){const r=e*_.size;(0,u.i)(K,_.data[r],_.data[r+1],_.data[r+2]),(0,u.t)(K,K,t),(0,u.t)(K,K,f.viewMatrix);const n=e*x.size;if((0,u.i)(le,x.data[n],x.data[n+1],x.data[n+2]),!C&&(K[0]+=le[0],K[1]+=le[1],0!==le[2])){const e=le[2];(0,u.n)(le,K),(0,u.d)(K,K,(0,u.h)(le,le,e))}const s=e*b.size;if((0,u.i)(Q,b.data[s],b.data[s+1],b.data[s+2]),Y(Q,se,f,he),this._applyVerticalOffsetTransformationView(K,he,f,X),f.applyProjection(K,ee),ee[0]>-1){C&&(le[0]||le[1])&&(ee[0]+=le[0]*f.pixelRatio,0!==le[1]&&(ee[1]+=(0,S.sX)(le[1],X.factorAlignment)*f.pixelRatio),f.unapplyProjection(ee,K)),ee[0]+=this.parameters.screenOffset[0]*f.pixelRatio,ee[1]+=this.parameters.screenOffset[1]*f.pixelRatio,ee[0]=Math.floor(ee[0]),ee[1]=Math.floor(ee[1]);const t=e*v.size;fe[0]=v.data[t],fe[1]=v.data[t+1],(0,S.TU)(fe,X.factor,fe);const r=de*f.pixelRatio;let n=0;m.textureIsSignedDistanceField&&(n=Math.min(m.outlineSize,.5*fe[0])*f.pixelRatio/2),fe[0]*=g,fe[1]*=y;const s=e*w.size,l=m.rotation+w.data[s];if(J(p,ee[0],ee[1],fe,r,n,l,m,T)){const e=i.ray;if((0,u.t)(ie,K,(0,o.U_)(ae,f.viewMatrix)),ee[0]=p[0],ee[1]=p[1],f.unprojectFromRenderScreen(ee,K)){const t=(0,h.Ue)();(0,u.c)(t,e.direction);const i=1/(0,u.l)(t);(0,u.h)(t,t,i),a((0,u.j)(e.origin,K)*i,t,-1,!0,1,ie)}}}}}intersectDraped(e,t,i,r,n,s){const o=e.attributes.get(M.T.POSITION),a=e.attributes.get(M.T.SIZE),l=e.attributes.get(M.T.ROTATION),c=this.parameters,u=(0,P.c)(c),{scaleX:h,scaleY:d}=this._getScreenScale(e,e.screenToWorldRatio),p=pe*e.screenToWorldRatio;for(let t=0;t<o.data.length/o.size;t++){const i=t*o.size,f=o.data[i],m=o.data[i+1],g=t*a.size;fe[0]=a.data[g],fe[1]=a.data[g+1];let y=0;c.textureIsSignedDistanceField&&(y=Math.min(c.outlineSize,.5*fe[0])*e.screenToWorldRatio/2),fe[0]*=h,fe[1]*=d;const _=t*l.size,v=c.rotation+l.data[_];J(r,f,m,fe,p,y,v,c,u)&&n(s.dist,s.normal,-1,!1)}}createBufferWriter(){return new ve}_updateScaleInfo(e,t,i){const r=this.parameters;null!=r.screenSizePerspective?(0,S.PV)(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=r.screenSizePerspectiveAlignment?(0,S.PV)(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,i,r,n,s,o){const a=Y(t,i,n,he);return this._applyVerticalGroundOffsetView(e,a,n,o),this._applyVerticalOffsetTransformationView(o,a,n,s),this._applyPolygonOffsetView(o,a,r[3],n,o),this._applyCenterOffsetView(o,r,o),o}applyShaderOffsetsNDC(e,t,i,r,n){return this._applyCenterOffsetNDC(e,t,i,r),null!=n&&(0,u.c)(n,r),this._applyPolygonOffsetNDC(r,t,i,r),r}_applyPolygonOffsetView(e,t,i,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(i);0===a&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return(0,u.c)(s,e);const c=(0,r.uZ)(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/n.viewport[2];return(0,u.h)(s,e,l>0?h:1/h),s}_applyVerticalGroundOffsetView(e,t,i,r){const n=(0,u.l)(e),s=i.aboveGround?1:-1,o=i.computeRenderPixelSizeAtDist(n)*b.c,a=(0,u.h)(K,t.normal,s*o);return(0,u.g)(r,e,a),r}_applyVerticalOffsetTransformationView(e,t,i,r){const n=this.parameters;if(!n.verticalOffset?.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const i=(0,u.l)(e);this._updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const s=(0,u.l)(e),o=n.screenSizePerspectiveAlignment??n.screenSizePerspective,a=(0,O.Hx)(i,s,n.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(r,s,t.cosAngle),(0,u.h)(t.normal,t.normal,a),(0,u.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,u.c)(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&((0,u.n)(Q,i),(0,u.g)(i,i,(0,u.h)(Q,Q,t[2])))),i}_applyCenterOffsetNDC(e,t,i,r){const n="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,u.c)(r,e),n||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}_applyPolygonOffsetNDC(e,t,i,r){const n=this.parameters.shaderPolygonOffset;if(e!==r&&(0,u.c)(r,e),n){const e=i.aboveGround?1:-1,s=e*Math.sign(t[3]);r[2]-=(s||e)*n}return r}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:t,outlineColor:i}=this.parameters,r=e[3]>=q.e||t>=q.e&&i[3]>=q.e;return this._visible&&r}createGLMaterial(e){return new $(e)}calculateRelativeScreenBounds(e,t,i=(0,f.Ue)()){return function(e,t,i,r){r[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*i,r[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*i}(this.parameters,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}_getScreenScale(e,t){const i=e.attributes.get(M.T.FEATUREATTRIBUTE);if(null==i)return{scaleX:t,scaleY:t};const r=(0,d.nI)(i.data,ue);return(0,g.FE)(ce,this.parameters,r),{scaleX:ce[0]*t,scaleY:ce[1]*t}}}class $ extends x.Fj{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(k,e)}}function Y(e,t,i,r){return p(t)&&(t=(0,n.xO)(oe,t)),(0,u.q)(r.normal,e,t),(0,u.t)(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=(0,u.f)(te,me),r}function J(e,t,i,n,s,o,a,c,u){let h=t-s-n[0]*u[0],d=h+n[0]+2*s,p=i-s-n[1]*u[1],f=p+n[1]+2*s;const m=c.distanceFieldBoundingBox;return c.textureIsSignedDistanceField&&null!=m&&(h+=n[0]*m[0],p+=n[1]*m[1],d-=n[0]*(1-m[2]),f-=n[1]*(1-m[3]),h-=o,d+=o,p-=o,f+=o),(0,l.t8)(ne,t,i),(0,l.U1)(re,e,ne,(0,r.Vl)(a)),re[0]>h&&re[0]<d&&re[1]>p&&re[1]<f}const X=new A.G,K=(0,h.Ue)(),Q=(0,h.Ue)(),ee=(0,d.Ue)(),te=(0,h.Ue)(),ie=(0,h.Ue)(),re=(0,c.Ue)(),ne=(0,c.Ue)(),se=(0,s.Ue)(),oe=(0,s.Ue)(),ae=(0,a.Ue)(),le=(0,h.Ue)(),ce=(0,h.Ue)(),ue=(0,d.Ue)(),he={normal:te,cosAngle:0},de=1,pe=2,fe=[0,0],me=(0,h.al)(0,0,1);class ge extends x.EY{constructor(){super(...arguments),this.renderOccluded=T.yD.Occlude,this.isDecoration=!1,this.color=(0,d.vV)(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=(0,c.al)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,d.vV)(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=(0,d.Ue)(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusEffect="none",this.draped=!1,this.isLabel=!1}}const ye=(0,_.U$)().vec3f(M.T.POSITION).vec3f(M.T.NORMAL).vec2f(M.T.UV0).vec4u8(M.T.COLOR).vec2f(M.T.SIZE).f32(M.T.ROTATION).vec4f(M.T.CENTEROFFSETANDDISTANCE).vec4f(M.T.FEATUREATTRIBUTE),_e=ye.clone().vec4u8(M.T.OBJECTANDLAYERIDCOLOR);class ve{constructor(){this.vertexBufferLayout=(0,w.B)()?_e:ye}elementCount(e){return 6*e.get(M.T.POSITION).indices.length}write(e,t,i,r,n,s){(0,R.ho)(i.get(M.T.POSITION),e,n.position,s,6),(0,R.s5)(i.get(M.T.NORMAL),t,n.normal,s,6);const o=i.get(M.T.UV0)?.data;let a=0,l=0,c=1,u=1;o&&o.length>=4&&(a=o[0],l=o[1],c=o[2],u=o[3]),c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let h=i.get(M.T.POSITION).indices.length,d=s;const p=n.uv0;for(let e=0;e<h;++e)p.set(d,0,a),p.set(d,1,l),d++,p.set(d,0,c),p.set(d,1,l),d++,p.set(d,0,c),p.set(d,1,u),d++,p.set(d,0,c),p.set(d,1,u),d++,p.set(d,0,a),p.set(d,1,u),d++,p.set(d,0,a),p.set(d,1,l),d++;(0,R.Vs)(i.get(M.T.COLOR),4,n.color,s,6);const{data:f,indices:g}=i.get(M.T.SIZE);h=g.length;const y=n.size;d=s;for(let e=0;e<h;++e){const t=f[2*g[e]],i=f[2*g[e]+1];for(let e=0;e<6;++e)y.set(d,0,t),y.set(d,1,i),d++}if((0,R.XW)(i.get(M.T.ROTATION),n.rotation,s,6),i.get(M.T.CENTEROFFSETANDDISTANCE)?(0,R.SW)(i.get(M.T.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,s,6):(0,R.h)(n.centerOffsetAndDistance,s,6*h),i.get(M.T.FEATUREATTRIBUTE)?(0,R.SW)(i.get(M.T.FEATUREATTRIBUTE),n.featureAttribute,s,6):(0,R.h)(n.featureAttribute,s,6*h),null!=r){const e=i.get(M.T.POSITION)?.indices;if(e){const t=e.length,i=n.getField(M.T.OBJECTANDLAYERIDCOLOR,m.mc);(0,R.xP)(r,i,t,s,6)}}}}},19663:(e,t,i)=>{i.d(t,{t:()=>n});var r=i(7958);class n{constructor(e,t,i){this._createTexture=e,this._parametersKey=t,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${(0,r.D)()}`,(e=>e.dispose()))}destroy(){for(const{texture:e}of this._repository.values())e.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,t=null){const i=this._acquire(e);return this.release(t),i}release(e){if(null==e)return;const t=this._parametersKey(e),i=this._repository.get(t);if(i&&(i.refCount--,0===i.refCount)){this._repository.delete(t);const{texture:e}=i;this._orphanCache.put(t,e)}}_acquire(e){if(null==e)return null;const t=this._parametersKey(e),i=this._repository.get(t);if(i)return i.refCount++,i.texture;const r=this._orphanCache.pop(t)??this._createTexture(e),n=new s(r);return this._repository.set(t,n),r}}class s{constructor(e){this.texture=e,this.refCount=1}}},65392:(e,t,i)=>{i.d(t,{U:()=>U});var r=i(13802),n=i(19431),s=i(95550),o=i(36531),a=i(86717),l=i(81095),c=i(52721),u=i(59934),h=i(56215),d=i(69430),p=i(44685),f=i(35031),m=i(43338),g=i(5079),y=i(7358),_=i(46378),v=i(15095),b=i(21414),w=i(67874),x=i(60997),T=i(2013),C=(i(39994),i(9969)),S=i(62575),E=i(97994),M=i(12045),A=i(79040),R=i(91907),O=i(17346);class P extends S.A{constructor(e,t){super(e,t,new C.J(T.R,(()=>i.e(16615).then(i.bind(i,16615)))),L),this.primitiveType=t.wireframe?R.MX.LINES:R.MX.TRIANGLE_STRIP}_makePipelineState(e,t){const{oitPass:i,output:r,hasOccludees:n,hasPolygonOffset:s}=e,o=i===E.M.NONE,a=i===E.M.FrontFace;return(0,O.sm)({blending:(0,f.c1)(r)?(0,M.Wo)(i):null,depthTest:{func:(0,M.Bh)(i)},depthWrite:(0,M.W$)(e),drawBuffers:r===f.H_.Depth?{buffers:[R.Xg.NONE]}:(0,M.u_)(i,r),colorWrite:O.gf,stencilWrite:n?A.s3:null,stencilTest:n?t?A.eD:A.RY:null,polygonOffset:o||a?s?I:null:M.E0})}initializePipeline(e){if(e.occluder){const t=e.hasPolygonOffset?I:null;this._occluderPipelineTransparent=(0,O.sm)({blending:O.Dh,polygonOffset:t,depthTest:A.zV,depthWrite:null,colorWrite:O.gf,stencilWrite:null,stencilTest:A.YD,drawBuffers:e.output===f.H_.Depth?{buffers:[R.Xg.NONE]}:null}),this._occluderPipelineOpaque=(0,O.sm)({blending:O.Dh,polygonOffset:t,depthTest:A.zV,depthWrite:null,colorWrite:O.gf,stencilWrite:A.P7,stencilTest:A.ii,drawBuffers:e.output===f.H_.Depth?{buffers:[R.Xg.NONE]}:null}),this._occluderPipelineMaskWrite=(0,O.sm)({blending:null,polygonOffset:t,depthTest:A.JN,depthWrite:null,colorWrite:null,stencilWrite:A.s3,stencilTest:A.eD,drawBuffers:e.output===f.H_.Depth?{buffers:[R.Xg.NONE]}:null})}return this._occludeePipeline=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,t){if(e)return this._occludeePipeline;switch(t){case _.r.TRANSPARENT_OCCLUDER_MATERIAL:return this._occluderPipelineTransparent??super.getPipeline();case _.r.OCCLUDER_MATERIAL:return this._occluderPipelineOpaque??super.getPipeline();default:return this._occluderPipelineMaskWrite??super.getPipeline()}}}const I={factor:0,units:-4},L=new Map([[b.T.POSITION,0],[b.T.PREVPOSITION,1],[b.T.NEXTPOSITION,2],[b.T.SUBDIVISIONFACTOR,3],[b.T.UV0,4],[b.T.COLOR,5],[b.T.COLORFEATUREATTRIBUTE,5],[b.T.SIZE,6],[b.T.SIZEFEATUREATTRIBUTE,6],[b.T.OPACITYFEATUREATTRIBUTE,7],[b.T.OBJECTANDLAYERIDCOLOR,8]]);var D,N=i(26531),F=i(5226);!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(D||(D={}));class U extends y.F5{constructor(e){super(e,z),this._configuration=new N.G,this.vertexAttributeLocations=L,this.produces=new Map([[_.r.OPAQUE_MATERIAL,e=>(0,f.Gy)(e)||(0,f.c1)(e)&&this.parameters.renderOccluded===y.yD.OccludeAndTransparentStencil],[_.r.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>(0,f.BX)(e)],[_.r.OCCLUDER_MATERIAL,e=>(0,f.f_)(e)&&this.parameters.renderOccluded===y.yD.OccludeAndTransparentStencil],[_.r.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,f.f_)(e)&&this.parameters.renderOccluded===y.yD.OccludeAndTransparentStencil],[_.r.TRANSPARENT_MATERIAL,e=>(0,f.c1)(e)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==y.yD.OccludeAndTransparentStencil],[_.r.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,f.c1)(e)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==y.yD.OccludeAndTransparentStencil],[_.r.DRAPED_MATERIAL,e=>(0,f.xs)(e)]])}getConfiguration(e,t){this._configuration.output=e,this._configuration.oitPass=t.oitPass,this._configuration.draped=t.slot===_.r.DRAPED_MATERIAL;const i=null!=this.parameters.stipplePattern&&e!==f.H_.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===x.i5.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.hasOccludees=t.hasOccludees,this._configuration.occluder=this.parameters.renderOccluded===y.yD.OccludeAndTransparentStencil,this._configuration.terrainDepthTest=t.terrainDepthTest&&(0,f.c1)(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.wireframe=this.parameters.wireframe,this._configuration}get visible(){return this.parameters.color[3]>=F.e||null!=this.parameters.stipplePattern&&(this.parameters.stippleOffColor?.[3]??0)>F.e}intersectDraped({attributes:e,screenToWorldRatio:t},i,r,s,o,a){if(!r.options.selectionMode)return;const l=e.get(b.T.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const t=e.get(b.T.SIZEFEATUREATTRIBUTE).data[0];c*=(0,n.uZ)(this.parameters.vvSize.offset[0]+t*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=s[0],h=s[1],d=(c/2+4)*t;let p=Number.MAX_VALUE,f=0;const m=e.get(b.T.POSITION).data,g=H(this.parameters,e)?m.length-2:m.length-5;for(let e=0;e<g;e+=3){const t=m[e],i=m[e+1],r=(e+3)%m.length,s=u-t,o=h-i,a=m[r]-t,l=m[r+1]-i,c=(0,n.uZ)((a*s+l*o)/(a*a+l*l),0,1),d=a*c-s,g=l*c-o,y=d*d+g*g;y<p&&(p=y,f=e/3)}p<d*d&&o(a.dist,a.normal,f,!1)}intersect(e,t,i,s,l,c){if(!i.options.selectionMode||!e.visible)return;if(!(0,v.kG)(t))return void r.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const p=e.attributes,f=p.get(b.T.POSITION).data;let m=this.parameters.width;if(this.parameters.vvSize){const e=p.get(b.T.SIZEFEATUREATTRIBUTE).data[0];m*=(0,n.uZ)(this.parameters.vvSize.offset[0]+e*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else p.has(b.T.SIZE)&&(m*=p.get(b.T.SIZE).data[0]);const g=i.camera,y=W;(0,o.JG)(y,i.point);const _=m*g.pixelRatio/2+4*g.pixelRatio;(0,a.i)(re[0],y[0]-_,y[1]+_,0),(0,a.i)(re[1],y[0]+_,y[1]+_,0),(0,a.i)(re[2],y[0]+_,y[1]-_,0),(0,a.i)(re[3],y[0]-_,y[1]-_,0);for(let e=0;e<4;e++)if(!g.unprojectFromRenderScreen(re[e],ne[e]))return;(0,d.zk)(g.eye,ne[0],ne[1],se),(0,d.zk)(g.eye,ne[1],ne[2],oe),(0,d.zk)(g.eye,ne[2],ne[3],ae),(0,d.zk)(g.eye,ne[3],ne[0],le);let w=Number.MAX_VALUE,x=0;const T=H(this.parameters,p)?f.length-2:f.length-5;for(let e=0;e<T;e+=3){G[0]=f[e]+t[12],G[1]=f[e+1]+t[13],G[2]=f[e+2]+t[14];const i=(e+3)%f.length;if(j[0]=f[i]+t[12],j[1]=f[i+1]+t[13],j[2]=f[i+2]+t[14],(0,d.jH)(se,G)<0&&(0,d.jH)(se,j)<0||(0,d.jH)(oe,G)<0&&(0,d.jH)(oe,j)<0||(0,d.jH)(ae,G)<0&&(0,d.jH)(ae,j)<0||(0,d.jH)(le,G)<0&&(0,d.jH)(le,j)<0)continue;if(g.projectToRenderScreen(G,$),g.projectToRenderScreen(j,Y),$[2]<0&&Y[2]>0){(0,a.d)(Z,G,j);const e=g.frustum,t=-(0,d.jH)(e[u.Nu.NEAR],G)/(0,a.f)(Z,(0,d.st)(e[u.Nu.NEAR]));(0,a.h)(Z,Z,t),(0,a.g)(G,G,Z),g.projectToRenderScreen(G,$)}else if($[2]>0&&Y[2]<0){(0,a.d)(Z,j,G);const e=g.frustum,t=-(0,d.jH)(e[u.Nu.NEAR],j)/(0,a.f)(Z,(0,d.st)(e[u.Nu.NEAR]));(0,a.h)(Z,Z,t),(0,a.g)(j,j,Z),g.projectToRenderScreen(j,Y)}else if($[2]<0&&Y[2]<0)continue;$[2]=0,Y[2]=0;const r=(0,h.Jk)((0,h.zk)($,Y,K),y);r<w&&(w=r,(0,a.c)(J,G),(0,a.c)(X,j),x=e/3)}const C=i.rayBegin,S=i.rayEnd;if(w<_*_){let e=Number.MAX_VALUE;if((0,h.AR)((0,h.zk)(J,X,K),(0,h.zk)(C,S,Q),q)){(0,a.d)(q,q,C);const t=(0,a.l)(q);(0,a.h)(q,q,1/t),e=t/(0,a.j)(C,S)}c(e,q,x,!1)}}get _layout(){const e=(0,p.U$)().vec3f(b.T.POSITION).vec3f(b.T.PREVPOSITION).vec3f(b.T.NEXTPOSITION).f32(b.T.SUBDIVISIONFACTOR).vec2f(b.T.UV0);return this.parameters.vvSize?e.f32(b.T.SIZEFEATUREATTRIBUTE):e.f32(b.T.SIZE),this.parameters.vvColor?e.f32(b.T.COLORFEATUREATTRIBUTE):e.vec4f(b.T.COLOR),this.parameters.vvOpacity&&e.f32(b.T.OPACITYFEATUREATTRIBUTE),(0,m.B)()&&e.vec4u8(b.T.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new B(this._layout,this.parameters)}createGLMaterial(e){return new k(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}class k extends g.Z{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}beginSlot(e){const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.getTechnique(P,e)}}class z extends w.n{constructor(){super(...arguments),this.width=0,this.color=c.hq,this.join="miter",this.cap=N.R.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.wireframe=!1}get transparent(){return this.color[3]<1||null!=this.stipplePattern&&(this.stippleOffColor?.[3]??0)<1}}class B{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;const i=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=T.r+i}}_isClosed(e){return H(this._parameters,e)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.get(b.T.POSITION).indices.length/2+1,i=this._isClosed(e);let r=i?2:4;return r+=((i?t:t-1)-(i?0:1))*(2*this.numJoinSubdivisions+4),r+=2,this._parameters.wireframe&&(r=2+4*(r-2)),r}write(e,t,i,r,n,s){const o=ee,l=te,c=ie,u=i.get(b.T.POSITION),h=u.indices,d=u.data.length/3,p=i.get(b.T.DISTANCETOSTART)?.data;h&&h.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");const f=i.get(b.T.SIZEFEATUREATTRIBUTE)?.data[0]??i.get(b.T.SIZE)?.data[0]??1;let g=[1,1,1,1],y=0;const _=this.vertexBufferLayout.fields.has(b.T.COLORFEATUREATTRIBUTE);_?y=i.get(b.T.COLORFEATUREATTRIBUTE).data[0]:i.has(b.T.COLOR)&&(g=i.get(b.T.COLOR).data);const v=this.vertexBufferLayout.fields.has(b.T.OPACITYFEATUREATTRIBUTE),w=v?i.get(b.T.OPACITYFEATUREATTRIBUTE).data[0]:0,x=new Float32Array(n.buffer),T=(0,m.B)()?new Uint8Array(n.buffer):null,C=this.vertexBufferLayout.stride/4;let S=s*C;const E=S;let M=0;const A=p?(e,t,i)=>M=p[i]:(e,t,i)=>M+=(0,a.j)(e,t),R=(e,t,i,n,s,o,a)=>{if(x[S++]=t[0],x[S++]=t[1],x[S++]=t[2],x[S++]=e[0],x[S++]=e[1],x[S++]=e[2],x[S++]=i[0],x[S++]=i[1],x[S++]=i[2],x[S++]=n,x[S++]=a,x[S++]=s,x[S++]=f,_)x[S++]=y;else{const e=Math.min(4*o,g.length-4);x[S++]=g[e],x[S++]=g[e+1],x[S++]=g[e+2],x[S++]=g[e+3]}v&&(x[S++]=w),(0,m.B)()&&(r&&(T[4*S]=r[0],T[4*S+1]=r[1],T[4*S+2]=r[2],T[4*S+3]=r[3]),S++)};S+=C,(0,a.i)(l,u.data[0],u.data[1],u.data[2]),e&&(0,a.t)(l,l,e);const O=this._isClosed(i);if(O){const t=u.data.length-3;(0,a.i)(o,u.data[t],u.data[t+1],u.data[t+2]),e&&(0,a.t)(o,o,e)}else(0,a.i)(c,u.data[3],u.data[4],u.data[5]),e&&(0,a.t)(c,c,e),R(l,l,c,1,D.LEFT_CAP_START,0,0),R(l,l,c,1,D.RIGHT_CAP_START,0,0),(0,a.c)(o,l),(0,a.c)(l,c);const P=O?0:1,I=O?d:d-1;for(let t=P;t<I;t++){const i=(t+1)%d*3;(0,a.i)(c,u.data[i],u.data[i+1],u.data[i+2]),e&&(0,a.t)(c,c,e),A(o,l,t),R(o,l,c,0,D.LEFT_JOIN_END,t,M),R(o,l,c,0,D.RIGHT_JOIN_END,t,M);const r=this.numJoinSubdivisions;for(let e=0;e<r;++e){const i=(e+1)/(r+1);R(o,l,c,i,D.LEFT_JOIN_END,t,M),R(o,l,c,i,D.RIGHT_JOIN_END,t,M)}R(o,l,c,1,D.LEFT_JOIN_START,t,M),R(o,l,c,1,D.RIGHT_JOIN_START,t,M),(0,a.c)(o,l),(0,a.c)(l,c)}O?((0,a.i)(c,u.data[3],u.data[4],u.data[5]),e&&(0,a.t)(c,c,e),M=A(o,l,I),R(o,l,c,0,D.LEFT_JOIN_END,P,M),R(o,l,c,0,D.RIGHT_JOIN_END,P,M)):(M=A(o,l,I),R(o,l,l,0,D.LEFT_CAP_END,I,M),R(o,l,l,0,D.RIGHT_CAP_END,I,M)),V(x,E+C,x,E,C),S=V(x,S-C,x,S,C),this._parameters.wireframe&&this._addWireframeVertices(n,E,S,C)}_addWireframeVertices(e,t,i,r){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),s=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,i-t);let o=0;const a=e=>o=V(s,e,n,o,r);for(let e=0;e<s.length-1;e+=2*r)a(e),a(e+2*r),a(e+1*r),a(e+2*r),a(e+1*r),a(e+3*r)}}function V(e,t,i,r,n){for(let s=0;s<n;s++)i[r++]=e[t++];return r}function H(e,t){return!!e.isClosed&&t.get(b.T.POSITION).indices.length>2}const G=(0,l.Ue)(),j=(0,l.Ue)(),Z=(0,l.Ue)(),q=(0,l.Ue)(),W=(0,l.Ue)(),$=(0,s.J$)(),Y=(0,s.J$)(),J=(0,l.Ue)(),X=(0,l.Ue)(),K=(0,h.Ue)(),Q=(0,h.Ue)(),ee=(0,l.Ue)(),te=(0,l.Ue)(),ie=(0,l.Ue)(),re=[(0,s.J$)(),(0,s.J$)(),(0,s.J$)(),(0,s.J$)()],ne=[(0,l.Ue)(),(0,l.Ue)(),(0,l.Ue)(),(0,l.Ue)()],se=(0,d.Ue)(),oe=(0,d.Ue)(),ae=(0,d.Ue)(),le=(0,d.Ue)()},40353:(e,t,i)=>{i.d(t,{G:()=>r});class r{constructor(){this.factor=new n,this.factorAlignment=new n}}class n{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}},67874:(e,t,i)=>{i.d(t,{n:()=>s,x:()=>o});var r=i(85132),n=i(7358);class s extends r.Ve{constructor(){super(...arguments),this.renderOccluded=n.yD.Occlude,this.isDecoration=!1}}const o=8},25584:(e,t,i)=>{i.d(t,{FZ:()=>l,Hx:()=>o,LO:()=>a});var r=i(7753),n=i(19431),s=i(72946);function o(e,t,i,r,o){let a=(i.screenLength||0)*e.pixelRatio;null!=o&&(a=(0,s.bA)(a,r,t,o));const l=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return(0,n.uZ)(l*t,i.minWorldLength||0,null!=i.maxWorldLength?i.maxWorldLength:1/0)}function a(e,t){let i=!1;for(const n in t){const s=t[n];void 0!==s&&(Array.isArray(s)?Array.isArray(e[n])&&(0,r.fS)(s,e[n])||(e[n]=s.slice(),i=!0):e[n]!==s&&(i=!0,e[n]=s))}return i}const l={multiply:1,ignore:2,replace:3,tint:4}},21123:(e,t,i)=>{i.d(t,{NK:()=>g,SW:()=>u,Vs:()=>f,XW:()=>a,h:()=>h,ho:()=>d,i9:()=>y,s5:()=>p,xP:()=>m});var r=i(32114),n=i(81936),s=i(15095),o=i(21414);function a(e,t,i,r=1){const{data:n,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(i*=a,1===r)for(let e=0;e<l;++e)o[i]=n[s[e]],i+=a;else for(let e=0;e<l;++e){const t=n[s[e]];for(let e=0;e<r;e++)o[i]=t,i+=a}}function l(e,t,i){const{data:r,indices:n}=e,s=t.typedBuffer,o=t.typedBufferStride,a=n.length;i*=o;for(let e=0;e<a;++e){const t=2*n[e];s[i]=r[t],s[i+1]=r[t+1],i+=o}}function c(e,t,i,r){const{data:n,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(i*=a,null==r||1===r)for(let e=0;e<l;++e){const t=3*s[e];o[i]=n[t],o[i+1]=n[t+1],o[i+2]=n[t+2],i+=a}else for(let e=0;e<l;++e){const t=3*s[e];for(let e=0;e<r;++e)o[i]=n[t],o[i+1]=n[t+1],o[i+2]=n[t+2],i+=a}}function u(e,t,i,r=1){const{data:n,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(i*=a,1===r)for(let e=0;e<l;++e){const t=4*s[e];o[i]=n[t],o[i+1]=n[t+1],o[i+2]=n[t+2],o[i+3]=n[t+3],i+=a}else for(let e=0;e<l;++e){const t=4*s[e];for(let e=0;e<r;++e)o[i]=n[t],o[i+1]=n[t+1],o[i+2]=n[t+2],o[i+3]=n[t+3],i+=a}}function h(e,t,i){const r=e.typedBuffer,n=e.typedBufferStride;t*=n;for(let e=0;e<i;++e)r[t]=0,r[t+1]=0,r[t+2]=0,r[t+3]=0,t+=n}function d(e,t,i,n,s=1){if(!t)return void c(e,i,n,s);const{data:o,indices:a}=e,l=i.typedBuffer,u=i.typedBufferStride,h=a.length,d=t[0],p=t[1],f=t[2],m=t[4],g=t[5],y=t[6],_=t[8],v=t[9],b=t[10],w=t[12],x=t[13],T=t[14];n*=u;let C=0,S=0,E=0;const M=(0,r.lv)(t)?e=>{C=o[e]+w,S=o[e+1]+x,E=o[e+2]+T}:e=>{const t=o[e],i=o[e+1],r=o[e+2];C=d*t+m*i+_*r+w,S=p*t+g*i+v*r+x,E=f*t+y*i+b*r+T};if(1===s)for(let e=0;e<h;++e)M(3*a[e]),l[n]=C,l[n+1]=S,l[n+2]=E,n+=u;else for(let e=0;e<h;++e){M(3*a[e]);for(let e=0;e<s;++e)l[n]=C,l[n+1]=S,l[n+2]=E,n+=u}}function p(e,t,i,n,s=1){if(!t)return void c(e,i,n,s);const{data:o,indices:a}=e,l=t,u=i.typedBuffer,h=i.typedBufferStride,d=a.length,p=l[0],f=l[1],m=l[2],g=l[4],y=l[5],_=l[6],v=l[8],b=l[9],w=l[10],x=!(0,r.pV)(l),T=1e-6,C=1-T;n*=h;let S=0,E=0,M=0;const A=(0,r.lv)(l)?e=>{S=o[e],E=o[e+1],M=o[e+2]}:e=>{const t=o[e],i=o[e+1],r=o[e+2];S=p*t+g*i+v*r,E=f*t+y*i+b*r,M=m*t+_*i+w*r};if(1===s)if(x)for(let e=0;e<d;++e){A(3*a[e]);const t=S*S+E*E+M*M;if(t<C&&t>T){const e=1/Math.sqrt(t);u[n]=S*e,u[n+1]=E*e,u[n+2]=M*e}else u[n]=S,u[n+1]=E,u[n+2]=M;n+=h}else for(let e=0;e<d;++e)A(3*a[e]),u[n]=S,u[n+1]=E,u[n+2]=M,n+=h;else for(let e=0;e<d;++e){if(A(3*a[e]),x){const e=S*S+E*E+M*M;if(e<C&&e>T){const t=1/Math.sqrt(e);S*=t,E*=t,M*=t}}for(let e=0;e<s;++e)u[n]=S,u[n+1]=E,u[n+2]=M,n+=h}}function f(e,t,i,r,n=1){const{data:s,indices:o}=e,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,t!==s.length||4!==t)if(1!==n)if(4!==t)for(let e=0;e<c;++e){const t=3*o[e];for(let e=0;e<n;++e)a[r]=s[t],a[r+1]=s[t+1],a[r+2]=s[t+2],a[r+3]=255,r+=l}else for(let e=0;e<c;++e){const t=4*o[e];for(let e=0;e<n;++e)a[r]=s[t],a[r+1]=s[t+1],a[r+2]=s[t+2],a[r+3]=s[t+3],r+=l}else{if(4===t){for(let e=0;e<c;++e){const t=4*o[e];a[r]=s[t],a[r+1]=s[t+1],a[r+2]=s[t+2],a[r+3]=s[t+3],r+=l}return}for(let e=0;e<c;++e){const t=3*o[e];a[r]=s[t],a[r+1]=s[t+1],a[r+2]=s[t+2],a[r+3]=255,r+=l}}else{a[r]=s[0],a[r+1]=s[1],a[r+2]=s[2],a[r+3]=s[3];const e=new Uint32Array(i.typedBuffer.buffer,i.start),t=l/4,o=e[r/=4];r+=t;const u=c*n;for(let i=1;i<u;++i)e[r]=o,r+=t}}function m(e,t,i,r,n=1){const s=t.typedBuffer,o=t.typedBufferStride;if(r*=o,1===n)for(let t=0;t<i;++t)s[r]=e[0],s[r+1]=e[1],s[r+2]=e[2],s[r+3]=e[3],r+=o;else for(let t=0;t<i;++t)for(let t=0;t<n;++t)s[r]=e[0],s[r+1]=e[1],s[r+2]=e[2],s[r+3]=e[3],r+=o}function g(e,t,i,r,s,a,l){for(const c of i.fields.keys()){const i=e.get(c),u=i?.indices;if(i&&u)y(c,i,r,s,a,l);else if(c===o.T.OBJECTANDLAYERIDCOLOR&&null!=t){const i=e.get(o.T.POSITION)?.indices;if(i){const e=i.length;m(t,a.getField(c,n.mc),e,l)}}}}function y(e,t,i,a,c,h){switch(e){case o.T.POSITION:{(0,s.hu)(3===t.size);const r=c.getField(e,n.ct);(0,s.hu)(!!r,`No buffer view for ${e}`),r&&d(t,i,r,h);break}case o.T.NORMAL:{(0,s.hu)(3===t.size);const i=c.getField(e,n.ct);(0,s.hu)(!!i,`No buffer view for ${e}`),i&&p(t,a,i,h);break}case o.T.NORMALCOMPRESSED:{(0,s.hu)(2===t.size);const i=c.getField(e,n.or);(0,s.hu)(!!i,`No buffer view for ${e}`),i&&l(t,i,h);break}case o.T.UV0:{(0,s.hu)(2===t.size);const i=c.getField(e,n.Eu);(0,s.hu)(!!i,`No buffer view for ${e}`),i&&l(t,i,h);break}case o.T.COLOR:case o.T.SYMBOLCOLOR:{const i=c.getField(e,n.mc);(0,s.hu)(!!i,`No buffer view for ${e}`),(0,s.hu)(3===t.size||4===t.size),!i||3!==t.size&&4!==t.size||f(t,t.size,i,h);break}case o.T.COLORFEATUREATTRIBUTE:{const i=c.getField(e,n.ly);(0,s.hu)(!!i,`No buffer view for ${e}`),(0,s.hu)(1===t.size),i&&1===t.size&&function(e,t,i){const{data:r,indices:n}=e,s=t.typedBuffer,o=t.typedBufferStride,a=n.length,l=r[0];i*=o;for(let e=0;e<a;++e)s[i]=l,i+=o}(t,i,h);break}case o.T.TANGENT:{(0,s.hu)(4===t.size);const o=c.getField(e,n.ek);(0,s.hu)(!!o,`No buffer view for ${e}`),o&&function(e,t,i,n,s=1){if(!t)return void u(e,i,n,s);const{data:o,indices:a}=e,l=t,c=i.typedBuffer,h=i.typedBufferStride,d=a.length,p=l[0],f=l[1],m=l[2],g=l[4],y=l[5],_=l[6],v=l[8],b=l[9],w=l[10],x=!(0,r.pV)(l),T=1e-6,C=1-T;if(n*=h,1===s)for(let e=0;e<d;++e){const t=4*a[e],i=o[t],r=o[t+1],s=o[t+2],l=o[t+3];let u=p*i+g*r+v*s,d=f*i+y*r+b*s,S=m*i+_*r+w*s;if(x){const e=u*u+d*d+S*S;if(e<C&&e>T){const t=1/Math.sqrt(e);u*=t,d*=t,S*=t}}c[n]=u,c[n+1]=d,c[n+2]=S,c[n+3]=l,n+=h}else for(let e=0;e<d;++e){const t=4*a[e],i=o[t],r=o[t+1],l=o[t+2],u=o[t+3];let d=p*i+g*r+v*l,S=f*i+y*r+b*l,E=m*i+_*r+w*l;if(x){const e=d*d+S*S+E*E;if(e<C&&e>T){const t=1/Math.sqrt(e);d*=t,S*=t,E*=t}}for(let e=0;e<s;++e)c[n]=d,c[n+1]=S,c[n+2]=E,c[n+3]=u,n+=h}}(t,i,o,h);break}case o.T.PROFILERIGHT:case o.T.PROFILEUP:case o.T.PROFILEVERTEXANDNORMAL:case o.T.FEATUREVALUE:{(0,s.hu)(4===t.size);const i=c.getField(e,n.ek);(0,s.hu)(!!i,`No buffer view for ${e}`),i&&u(t,i,h)}}}},19765:(e,t,i)=>{i.d(t,{Ih:()=>s,Ix:()=>o,S7:()=>l,eP:()=>c,xq:()=>a});var r=i(86717),n=i(81095);function s({normalTexture:e,metallicRoughnessTexture:t,metallicFactor:i,roughnessFactor:s,emissiveTexture:o,emissiveFactor:a,occlusionTexture:l}){return null==e&&null==t&&null==o&&(null==a||(0,r.p)(a,n.AG))&&null==l&&(null==s||1===s)&&(null==i||1===i)}function o({normalTexture:e,metallicRoughnessTexture:t,metallicFactor:i,roughnessFactor:s,emissiveTexture:o,emissiveFactor:a,occlusionTexture:l}){return null==e&&null==t&&null==o&&(null==a||(0,r.p)(a,n.AG))&&null==l&&(null==s||1===s)&&(null==i||1===i||0===i)}const a=(0,n.vV)(1,1,.5),l=(0,n.vV)(0,.6,.2),c=(0,n.vV)(0,1,.2)},40846:(e,t,i)=>{i.d(t,{A:()=>I});var r=i(36663),n=i(7753),s=(i(39994),i(19431)),o=i(61681),a=i(22445),l=i(17135),c=i(19784),u=i(81977),h=(i(13802),i(40266)),d=i(32114),p=i(3308),f=i(95397),m=i(35031),g=i(36935),y=i(71399),_=i(79341),v=i(46378),b=i(15095),w=i(22456);class x{constructor(e=0,t=0){this.from=e,this.to=t}get numElements(){return this.to-this.from}}function T(e){if(e.length<2)return;const t=new Map;e.forAll((e=>t.set(e.from,e)));let i=!0;for(;i;){i=!1;for(let r=0;r<e.length;++r){const n=e.data[r],s=t.get(n.to);s&&(n.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)}}}class C extends x{constructor(e,t,i,r){super(t,i),this.geometry=e,this._highlightName=null,this.updateHighlightOptions(r)}updateHighlightOptions(e){const{geometry:t}=this;if(!t.hasHighlights)return void(this._highlightName=null);let i=-1,r=null;t.foreachHighlightOptions((t=>{const n=e.get(t)??-1;n>i&&(i=n,r=t)})),this._highlightName=r}get highlightName(){return this._highlightName}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}get hasOccludees(){return null!=this.geometry.occludees}}var S=i(86114);class E{constructor(){this.first=0,this.count=0}}var M=i(67235);class A{constructor(){this._numElements=0,this._instances=new Map,this.holes=new l.Z({allocator:e=>e||new x,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightNames=new Set,this.drawCommandsDefault=R(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=R(),this.drawCommandsShadowHighlightRest=R()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return this.highlightNames.size>0}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightNames.clear()}updateIfDrawCommandsDirty(e,t){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const e of this.instances.values())this.updateDrawState(e);this.updateDrawCommands(e,t)}}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,i){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,r.from=t,r.to=i,this._numElements+=r.numElements)}updateDrawState(e){if(e.isVisible){const{highlightName:t}=e;t&&this.highlightNames.add(t),e.hasOccludees&&(this.hasOccludees=!0)}else this.hasHiddenInstances=!0}updateDrawCommands(e,t){if(this.drawCommandsDefault.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;const{sortedInstances:i}=this;if(this._updateHighlightDrawCommands(e,i),!this.needsMultipleCommands()){const e=this.drawCommandsDefault.pushNew(),i=this.holes.front();return null!=this.vao&&1===this.holes.length&&i.to===Math.floor(this.vao.byteSize/t)?(e.first=0,void(e.count=i.from)):(e.first=1/0,e.count=0,this._instances.forEach((t=>{e.first=Math.min(e.first,t.from),e.count=Math.max(e.count,t.to)})),void(e.count-=e.first))}for(const e of i)e.isVisible&&O(e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,e)}get sortedInstances(){return Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from))}updateHighlights(e){this.highlightNames.clear();const t=this.sortedInstances;for(const i of t)i.updateHighlightOptions(e),i.isVisible&&i.highlightName&&this.highlightNames.add(i.highlightName);this._updateHighlightDrawCommands(e)}_updateHighlightDrawCommands(e,t=this.sortedInstances){const{drawCommandsHighlights:i,drawCommandsShadowHighlightRest:r}=this;i.clear(),r.clear();for(const n of t){if(n.updateHighlightOptions(e),!n.isVisible)continue;const{highlightName:t}=n;t&&(this.highlightNames.add(t),O((0,S.s1)(i,t,R),n)),t&&t===M.b||O(r,n)}}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function R(){return new l.Z({allocator:e=>e||new E,deallocator:e=>e})}function O(e,t){const i=e.back();if(null==i){const i=e.pushNew();return i.first=t.from,void(i.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(i,t)){const e=t.from-i.first+t.numElements;i.count=e}else{const i=e.pushNew();i.first=t.from,i.count=t.numElements}}class P{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}let I=class extends g.tY{get _hasHighlights(){return this._highlightNames.size>0}hasHighlightOptions(e){return this._highlightNames.has(e)}constructor(e){super(e),this._dataByOrigin=new Map,this._drawParameters=new w.w,this._highlightNames=new Set,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=(0,o.M2)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this._updateProduces()}_updateProduces(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==m.H_.Highlight&&t!==m.H_.ShadowHighlight||this._hasHighlights))&&e(t)))}))}initializeRenderContext(e,t){this._glMaterials=new y.p(this.material,t??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,f.K)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.cachedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((({geometry:t})=>e(t)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}updateHighlights(e){this.highlightOrderMap=e,this._highlightNames.clear(),this._dataByOrigin.forEach((t=>{t.buffers.forEach((t=>{t.updateHighlights(e),t.highlightNames.forEach((e=>this._highlightNames.add(e)))}))})),this._updateProduces()}_updateGeometries(e){const t=this._bufferWriter;if(null==t)return;const i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.renderGeometry,n=this._dataByOrigin.get(e.localOrigin.id)?.findBuffer(e.id);if(null==n)return;const s=n.instances.get(e.id);if(r.updateType&(_.$.GEOMETRY|_.$.TRANSFORMATION)){const r=G(t.elementCount(s.geometry.geometry.attributes)*i),o=t.vertexBufferLayout.createView(r.buffer);this._writeGeometry(e,o,0),n.vao.vertexBuffers.get("geometry").setSubData(r,s.from*i,0,s.numElements*i)}r.updateType&(_.$.HIGHLIGHT|_.$.OCCLUDEE|_.$.VISIBILITY)&&(n.drawCommandsDirty=!0)}}_computeDeltas(e,t){const i=new a.r;for(const t of e){const e=t.localOrigin;if(null==e)continue;let r=i.get(e.id,null);null==r&&(r=new L(e.vec3),i.set(e.id,null,r)),r.changes.push(t)}for(const e of t){const t=e.localOrigin;if(null==t)continue;const r=this._dataByOrigin.get(t.id)?.findBuffer(e.id);if(null==r)continue;let n=i.get(t.id,r);null==n&&(n=new L(t.vec3),i.set(t.id,r,n)),n.changes.push(e)}return i}_addAndRemoveGeometries(e,t){if(null==this._bufferWriter||null==this._vaoCache)return;const{_bufferWriter:i,_dataByOrigin:r}=this,s=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,t);o.forEach(((e,t)=>{const a=e.get(null),l=a?.changes??[];o.delete(t,null);let c=r.get(t);if(e.forEach(((e,a)=>{if(o.delete(t,a),null==a)return void(0,b.hu)(!1,"No VAO for removed geometries");if(a.instances.size===e.changes.length)return this._vaoCache.deleteVao(a.vao),(0,n.e$)(c.buffers,a),void(0===c.buffers.length&&0===l.length&&r.delete(t));const u=a.numElements,h=a.vao.byteSize/4,d=l.reduce(((e,t)=>e+i.elementCount(t.geometry.attributes)),0),p=e.changes.reduce(((e,t)=>e+i.elementCount(t.geometry.attributes)),0),f=Math.min((u+d-p)*s,V),m=f>h;f>k&&f<h/2?(e.changes.forEach((({id:e})=>a.deleteInstance(e))),a.instances.forEach((({geometry:e})=>l.push(e))),this._vaoCache.deleteVao(a.vao),(0,n.e$)(c.buffers,a)):m?this._applyAndRebuild(a,l,e):this._applyRemoves(a,e)})),l.length>0)for(null==c&&(c=new P(a.origin),r.set(t,c)),c.buffers.forEach((e=>this._applyAdds(e,l)));l.length>0;)c.buffers.push(this._applyAndRebuild(new A,l,null))}))}_updateDrawCommands(){this._highlightNames.clear(),this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.updateIfDrawCommandsDirty(this.highlightOrderMap,this._bufferWriter.vertexBufferLayout.stride),e.hasHighlights&&(0,c.w6)(this._highlightNames,e.highlightNames),this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,i){if(i)for(const t of i.changes)e.deleteInstance(t.id);const r=this._bufferWriter,n=r.vertexBufferLayout.stride,s=n/4,o=Math.floor(V/s);let a=e.numElements;for(;t.length>0;){const i=t.pop(),n=r.elementCount(i.geometry.attributes);if(a+n>o&&a>0){t.push(i);break}a+=n;const s=new C(i,0,0,this.highlightOrderMap);(0,b.hu)(null==e.instances.get(i.id)),e.addInstance(i.id,s)}const l=a*s,c=G(l),u=r.vertexBufferLayout.createView(c.buffer);let h=0;e.resetInstanceSummary(),e.instances.forEach(((t,i)=>{this._writeGeometry(t.geometry,u,h);const n=h;h+=r.elementCount(t.geometry.geometry.attributes),e.updateInstance(i,n,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(j(l)),e.vao.vertexBuffers.get("geometry").setSubData(c,0,0,h*s),e.holes.clear();const d=e.holes.pushNew();return d.from=h,d.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(this.highlightOrderMap,n),e}_applyRemoves(e,t){if(0===t.changes.length||null==this._bufferWriter)return;for(const i of t.changes){const t=i.id,r=e.instances.get(t);if(!r)continue;e.deleteInstance(t);const n=U.back();if(n){if(n.to===r.from){n.to=r.to;continue}if(n.from===r.to){n.from=r.from;continue}}const s=U.pushNew();s.from=r.from,s.to=r.to}T(U);const i=this._bufferWriter.vertexBufferLayout.stride/4,r=U.reduce(((e,t)=>Math.max(e,t.numElements)),0)*i,n=G(r);n.fill(0,0,r);const s=e.vao.vertexBuffers.get("geometry");U.forAll((e=>s.setSubData(n,e.from*i,0,e.numElements*i))),e.holes.pushArray(U.data,U.length),U.forAll(((e,t)=>U.data[t]=null)),U.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null==this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4,s=e.numElements,o=t.reduce(((e,t)=>e+i.elementCount(t.geometry.attributes)),0),a=Math.min((s+o)*r,V),l=4*a;if(e.vao.byteSize<j(V-k)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);T(e.holes);const c=new Array;for(const r of t){const t=i.elementCount(r.geometry.attributes),n=D(e.holes,t);c.push(n)}const u=e.vao.vertexBuffers.get("geometry");let h=0,d=0,p=0;const f=G(a),m=i.vertexBufferLayout.createView(f.buffer);t.forEach(((t,n)=>{const s=c[n];if(null==s)return;if(p!==s){const e=p-d;e>0&&u.setSubData(f,d*r,0,e*r),d=s,h=0}const o=i.elementCount(t.geometry.attributes);this._writeGeometry(t,m,h),h+=o,p=s+o;const a=new C(t,s,s+o,this.highlightOrderMap);(0,b.hu)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const g=p-d;g>0&&u.setSubData(f,d*r,0,g*r),(0,n.hv)(t,((e,t)=>null==c[t]))}_writeGeometry(e,t,i){null!=this._bufferWriter&&((0,d.JG)(N,e.transformation),N[12]-=e.localOrigin.vec3[0],N[13]-=e.localOrigin.vec3[1],N[14]-=e.localOrigin.vec3[2],(0,d.U_)(F,N),(0,d.p4)(F,F),this._bufferWriter.write(N,F,e.geometry.attributes,e.geometry.objectAndLayerIdColor,t,i))}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){if(!this.material.shouldRender(e))return null;const{output:t,bind:i}=e;if(!this.material.produces.get(i.slot)?.(t))return null;const{highlight:r,slot:n}=i,s=t===m.H_.ShadowHighlight,o=t===m.H_.Highlight,a=o||s,l=r?.name;if(a&&(0===this._highlightNames.size||o&&l&&!this._highlightNames.has(l)))return null;const c=e=>o&&!!l&&!e.has(l),u=t===m.H_.ShadowExcludeHighlight,h=!(a||u);for(const{buffers:r}of this._dataByOrigin.values())for(const o of r){if(c(o.highlightNames))continue;const r=s?o.drawCommandsHighlights.get(M.b):a?l?o.drawCommandsHighlights.get(l):o.drawCommandsHighlights.size>0:((u&&o.needsMultipleCommands()?o.drawCommandsShadowHighlightRest:o.drawCommandsDefault)||null)?.length??!1,d=h&&o.drawCommandsOccludees||null;if(r||d?.length){const r=this._glMaterials.load(e.rctx,n,t)?.beginSlot(i);if(r)return r}}return null}render(e,t){const{output:i,bind:r}=e,{slot:n,highlight:s}=r,o=i===m.H_.Highlight,a=s?.name??"";if(o&&!s)return;const c=i===m.H_.ShadowHighlight,u=o||c,h=i===m.H_.ShadowExcludeHighlight,d=!(u||h),p=n===v.r.OCCLUDER_MATERIAL||n===v.r.TRANSPARENT_OCCLUDER_MATERIAL?n:null,{rctx:f}=e;f.runAppleAmdDriverHelper();const g=f.bindTechnique(t,r,this.material.parameters);for(const e of this._dataByOrigin.values())for(const i of e.buffers){if(o&&(!i.hasHighlights||!i.drawCommandsHighlights.has(a)))continue;if(c&&(!i.hasHighlights||!i.drawCommandsHighlights.has(M.b)))continue;const n=()=>{const e=[],t=i.drawCommandsHighlights.get(M.b)??new l.Z;return t&&e.push(t),e},s=u&&!c?i.drawCommandsHighlights.get(a)??null:null,m=c?n():u?s?[s]:Z:h&&i.needsMultipleCommands()?[i.drawCommandsShadowHighlightRest]:[i.drawCommandsDefault],y=m.some((e=>e.length>0)),_=d&&i.drawCommandsOccludees||null;if(y||_?.length){if(this._drawParameters.origin=e.origin,g.bindDraw(r,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(i.vao),f.bindVAO(i.vao),y)for(const e of m)f.setPipelineState(t.getPipeline(!1,p)),e.forAll((e=>f.drawArrays(t.primitiveType,e.first,e.count)));_?.length&&(f.setPipelineState(t.getPipeline(!0,p)),_.forAll((e=>f.drawArrays(t.primitiveType,e.first,e.count))))}}}static prune(){H=new Float32Array(k)}get test(){}};(0,r._)([(0,u.Cb)({constructOnly:!0})],I.prototype,"material",void 0),(0,r._)([(0,u.Cb)({})],I.prototype,"highlightOrderMap",void 0),I=(0,r._)([(0,h.j)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],I);class L{constructor(e){this.origin=e,this.changes=new Array}}function D(e,t){const i=e.find((e=>e.numElements>=t));if(null==i)return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}const N=(0,p.Ue)(),F=(0,p.Ue)(),U=new l.Z({allocator:e=>e||new x,deallocator:null}),k=65536,z=4*k,B=16777216,V=B/4;let H=new Float32Array(k);function G(e){return H.length<e&&(H=new Float32Array(e)),H}function j(e){const t=4*e;return t<=1024?1024:t<z?(0,s.Sf)(t):Math.max(Math.min(Math.ceil(1.5*t/z)*z,B),t)}const Z=[]},73622:(e,t,i)=>{i.d(t,{EE:()=>a,U_:()=>o,lr:()=>s});var r=i(81095),n=i(30560);function s(e,t){return null==e&&(e=[]),e.push(t),e}function o(e,t){if(null==e)return null;const i=e.filter((e=>e!==t));return 0===i.length?null:i}function a(e,t,i,r,s){l[0]=e.get(t,0),l[1]=e.get(t,1),l[2]=e.get(t,2),(0,n.LF)(l,c,3),i.set(s,0,c[0]),r.set(s,0,c[1]),i.set(s,1,c[2]),r.set(s,1,c[3]),i.set(s,2,c[4]),r.set(s,2,c[5])}const l=(0,r.Ue)(),c=new Float32Array(6)},33195:(e,t,i)=>{i.d(t,{$A:()=>h,kW:()=>l,kj:()=>d});var r=i(73534),n=i(19663),s=i(91907),o=i(43487),a=i(80479);function l(e,t){return new n.t((t=>{const{encodedData:i,textureSize:r}=c(t),n=new a.X;return n.internalFormat=s.VI.RGBA,n.width=r,n.height=1,n.wrapMode=s.e8.REPEAT,new o.x(e,n,i)}),(e=>`${e.pattern.join(",")}-r${e.pixelRatio}`),t)}function c(e){const t=u(e),i=1/e.pixelRatio,n=h(e),s=d(e),o=(Math.floor(.5*(s-1))+.5)*i,a=[];let l=1;for(const e of t){for(let t=0;t<e;t++){const r=l*(Math.min(t,e-1-t)+.5)*i/o*.5+.5;a.push(r)}l=-l}const c=Math.round(t[0]/2),p=[...a.slice(c),...a.slice(0,c)],f=new Uint8Array(4*n);let m=0;for(const e of p)(0,r.I)(e,f,m),m+=4;return{encodedData:f,textureSize:n}}function u(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function h(e){if(null==e)return 1;const t=u(e);return Math.floor(t.reduce(((e,t)=>e+t)))}function d(e){return u(e).reduce(((e,t)=>Math.max(e,t)))}},3995:(e,t,i)=>{i.d(t,{l:()=>c});var r=i(27755),n=i(9969),s=i(62575),o=i(73487),a=i(42199),l=i(17346);class c extends s.A{constructor(e,t){super(e,t,new n.J(o.a,(()=>i.e(4622).then(i.bind(i,4622)))))}initializePipeline(e){switch(e.blitMode){case a.J.None:case a.J.Depth:return(0,l.sm)({colorWrite:l.gf});case a.J.Alpha:return(0,l.sm)({blending:l.Dh,colorWrite:l.gf});default:(0,r.Bg)(e.blitMode);case a.J.PremultipliedAlpha:case a.J.COUNT:return(0,l.sm)({blending:l.xW,colorWrite:l.gf})}}}},42199:(e,t,i)=>{i.d(t,{J:()=>r,Z:()=>o});var r,n=i(36663),s=i(12907);!function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.Depth=3]="Depth",e[e.COUNT=4]="COUNT"}(r||(r={}));class o extends s.m{constructor(){super(...arguments),this.blitMode=r.None,this.hasOpacityFactor=!1}}(0,n._)([(0,s.o)({count:r.COUNT})],o.prototype,"blitMode",void 0),(0,n._)([(0,s.o)()],o.prototype,"hasOpacityFactor",void 0)},28541:(e,t,i)=>{i.d(t,{Qm:()=>w,em:()=>b,tT:()=>x});var r=i(81095),n=i(52721),s=i(35031),o=i(7792),a=i(78549),l=i(9969),c=i(62575),u=i(70984),h=i(7358),d=i(97994),p=i(12045),f=i(79040),m=i(19765),g=i(45584),y=i(91907),_=i(17346),v=i(5226);class b extends a.d4{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=m.xq,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=u.Vr.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=r.AG,this.instancedDoublePrecision=!1,this.normalType=o.r.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=(0,r.vV)(.2,.2,.2),this.diffuse=(0,r.vV)(.8,.8,.8),this.externalColor=(0,n.al)(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=(0,r.Ue)(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=u.Gv.Less,this.textureAlphaMode=u.JJ.Blend,this.textureAlphaCutoff=v.e,this.textureAlphaPremultiplied=!1,this.renderOccluded=h.yD.Occlude,this.isDecoration=!1}}class w extends a.Pf{constructor(){super(...arguments),this.origin=(0,r.Ue)(),this.slicePlaneLocalOrigin=this.origin}}class x extends c.A{constructor(e,t,r=new l.J(g.D,(()=>i.e(1180).then(i.bind(i,1180))))){super(e,t,r),this.type="DefaultMaterialTechnique"}_makePipeline(e,t){const{oitPass:i,output:r,transparent:n,cullFace:o,customDepthTest:a,hasOccludees:l,enableOffset:c}=e,u=i===d.M.NONE,h=i===d.M.FrontFace;return(0,_.sm)({blending:(0,s.c1)(r)&&n?(0,p.Wo)(i):null,culling:C(e)?(0,_.zp)(o):null,depthTest:{func:(0,p.Bh)(i,T(a))},depthWrite:(0,p.W$)(e),drawBuffers:r===s.H_.Depth?{buffers:[y.Xg.NONE]}:(0,p.u_)(i,r),colorWrite:_.gf,stencilWrite:l?f.s3:null,stencilTest:l?t?f.eD:f.RY:null,polygonOffset:u||h?null:(0,p.je)(c)})}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}function T(e){return e===u.Gv.Lequal?y.wb.LEQUAL:y.wb.LESS}function C(e){return e.cullFace!==u.Vr.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}},60997:(e,t,i)=>{i.d(t,{I9:()=>r,PI:()=>u,i5:()=>n});var r,n,s=i(36663),o=i(82082),a=i(57583),l=i(12907),c=i(22957);!function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(n||(n={}));class u extends c.W{constructor(){super(...arguments),this.space=r.Screen,this.anchor=n.Center,this.occluder=!1,this.writeDepth=!1,this.hideOnShortSegments=!1,this.hasCap=!1,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=o.I.None,this.emissionSource=a.jo.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.hasVvInstancing=!0,this.hasSliceTranslatedView=!0,this.objectAndLayerIdColorInstanced=!1}get draped(){return this.space===r.Draped}}(0,s._)([(0,l.o)({count:r.COUNT})],u.prototype,"space",void 0),(0,s._)([(0,l.o)({count:n.COUNT})],u.prototype,"anchor",void 0),(0,s._)([(0,l.o)()],u.prototype,"occluder",void 0),(0,s._)([(0,l.o)()],u.prototype,"writeDepth",void 0),(0,s._)([(0,l.o)()],u.prototype,"hideOnShortSegments",void 0),(0,s._)([(0,l.o)()],u.prototype,"hasCap",void 0),(0,s._)([(0,l.o)()],u.prototype,"hasTip",void 0),(0,s._)([(0,l.o)()],u.prototype,"vvSize",void 0),(0,s._)([(0,l.o)()],u.prototype,"vvColor",void 0),(0,s._)([(0,l.o)()],u.prototype,"vvOpacity",void 0),(0,s._)([(0,l.o)()],u.prototype,"hasOccludees",void 0),(0,s._)([(0,l.o)()],u.prototype,"terrainDepthTest",void 0),(0,s._)([(0,l.o)()],u.prototype,"cullAboveTerrain",void 0)},82050:(e,t,i)=>{i.d(t,{j:()=>u});var r=i(35031),n=i(57583),s=i(32560),o=i(32394),a=i(20200),l=i(97994),c=i(5226);function u(e,t){e.include(s.b,t),e.include(n.Ok,t),e.fragment.include(o.Y);const i=t.output===r.H_.ObjectAndLayerIdColor,u=(0,r.qC)(t.output),h=(0,r.c1)(t.output)&&t.oitPass===l.M.ColorAlpha,d=(0,r.c1)(t.output)&&t.oitPass!==l.M.ColorAlpha,p=t.discardInvisibleFragments;let f=0;(d||u||h)&&e.outputs.add("fragColor","vec4",f++),u&&e.outputs.add("fragEmission","vec4",f++),h&&e.outputs.add("fragAlpha","float",f++),e.fragment.code.add(a.H`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition) {
      ${(0,a.If)(i,"finalColor.a = 1.0;")}

      ${(0,a.If)(p,`if (finalColor.a < ${a.H.float(c.e)}) { discard; }`)}

      finalColor = applySlice(finalColor, vWorldPosition);
      ${(0,a.If)(h,a.H`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${(0,a.If)(d,"fragColor = finalColor;")}
      ${(0,a.If)(u,"fragEmission = finalColor.a * getEmissions();")}
      calculateOcclusionAndOutputHighlight();
      ${(0,a.If)(i,"outputObjectAndLayerIdColor();")}
    }
  `)}},75862:(e,t,i)=>{i.d(t,{T:()=>s});var r=i(36663),n=i(12907);class s extends n.m{constructor(){super(...arguments),this.receiveShadows=!0}}(0,r._)([(0,n.o)()],s.prototype,"receiveShadows",void 0)},26531:(e,t,i)=>{i.d(t,{G:()=>c,R:()=>r});var r,n=i(36663),s=i(82082),o=i(57583),a=i(12907),l=i(22957);!function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"}(r||(r={}));class c extends l.W{constructor(){super(...arguments),this.capType=r.BUTT,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.occluder=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.wireframe=!1,this.discardInvisibleFragments=!1,this.objectAndLayerIdColorInstanced=!1,this.textureCoordinateType=s.I.None,this.emissionSource=o.jo.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.hasSliceTranslatedView=!0}}(0,n._)([(0,a.o)({count:r.COUNT})],c.prototype,"capType",void 0),(0,n._)([(0,a.o)()],c.prototype,"hasPolygonOffset",void 0),(0,n._)([(0,a.o)()],c.prototype,"writeDepth",void 0),(0,n._)([(0,a.o)()],c.prototype,"draped",void 0),(0,n._)([(0,a.o)()],c.prototype,"stippleEnabled",void 0),(0,n._)([(0,a.o)()],c.prototype,"stippleOffColorEnabled",void 0),(0,n._)([(0,a.o)()],c.prototype,"stipplePreferContinuous",void 0),(0,n._)([(0,a.o)()],c.prototype,"roundJoins",void 0),(0,n._)([(0,a.o)()],c.prototype,"applyMarkerOffset",void 0),(0,n._)([(0,a.o)()],c.prototype,"vvSize",void 0),(0,n._)([(0,a.o)()],c.prototype,"vvColor",void 0),(0,n._)([(0,a.o)()],c.prototype,"vvOpacity",void 0),(0,n._)([(0,a.o)()],c.prototype,"falloffEnabled",void 0),(0,n._)([(0,a.o)()],c.prototype,"innerColorEnabled",void 0),(0,n._)([(0,a.o)()],c.prototype,"hasOccludees",void 0),(0,n._)([(0,a.o)()],c.prototype,"occluder",void 0),(0,n._)([(0,a.o)()],c.prototype,"terrainDepthTest",void 0),(0,n._)([(0,a.o)()],c.prototype,"cullAboveTerrain",void 0),(0,n._)([(0,a.o)()],c.prototype,"wireframe",void 0),(0,n._)([(0,a.o)()],c.prototype,"discardInvisibleFragments",void 0),(0,n._)([(0,a.o)()],c.prototype,"objectAndLayerIdColorInstanced",void 0)},16009:(e,t,i)=>{i.d(t,{X:()=>l});var r=i(32114),n=i(3308),s=i(20200),o=i(61002),a=i(21414);function l(e,t={needUVs:!0,needEyeDirection:!0}){e.attributes.add(a.T.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{needUVs:i,needEyeDirection:n}=t;i&&e.varyings.add("uv","vec2"),n&&e.varyings.add("eyeDir","vec3"),e.vertex.uniforms.add(new o.C("inverseProjectionMatrix",(e=>e.camera.inverseProjectionMatrix)),new o.C("inverseViewMatrix",(e=>(0,r.iS)(c,e.camera.viewMatrix)))),e.vertex.main.add(s.H`
    vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
    ${(0,s.If)(n,"eyeDir = posViewNear;")}
    worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
    ${(0,s.If)(i,"uv = position * 0.5 + vec2(0.5);")}
    gl_Position = vec4(position, 1, 1);
  `)}const c=(0,n.Ue)()},50740:(e,t,i)=>{i.d(t,{l:()=>o,w:()=>r});var r,n=i(36663),s=i(12907);!function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"}(r||(r={}));class o extends s.m{constructor(){super(...arguments),this.visualization=r.Gradient,this.bandsEnabled=!1}}(0,n._)([(0,s.o)({count:r.COUNT})],o.prototype,"visualization",void 0),(0,n._)([(0,s.o)()],o.prototype,"bandsEnabled",void 0)},21388:(e,t,i)=>{i.d(t,{l:()=>n});var r=i(20200);function n(e){e.code.add(r.H`vec2 sphereIntersect(vec3 start, vec3 dir, float distance) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * distance;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`)}},81809:(e,t,i)=>{i.d(t,{l:()=>n});var r=i(20200);function n(e){e.code.add(r.H`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)}},37630:(e,t,i)=>{i.d(t,{G7:()=>n,Pb:()=>r,UR:()=>y,lV:()=>_});var r,n,s=i(22919),o=i(7792),a=i(5331),l=i(9794),c=i(32006),u=i(43036),h=i(20200),d=i(55784),p=i(11125),f=i(61002),m=i(37649),g=i(21414);function y(e,t){const i=e.vertex;i.include(l.n),e.include(o.O,t);const{silhouette:r,legacy:n,spherical:y}=t;i.uniforms.add(new m.R("componentDataTex",(e=>e.componentDataTexture))),e.attributes.add(g.T.COMPONENTINDEX,"float");i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.code.add(h.H`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = ${h.H.float(3)}  * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, ${h.H.float(0)});
      vec2 otherIndex = _componentTextureCoords(componentIndex, ${h.H.float(1)});
      vec2 verticalOffsetIndex = _componentTextureCoords(float(componentIndex), ${h.H.float(2)} );
      vec3 normal = normalModel();
      vec3 normal2 = ${r?h.H`decompressNormal(normal2Compressed)`:h.H`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = uninterpolatedRGBAToFloat(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) * ${h.H.float(s.Hz)};

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / ${h.H.float(8)} ),
        otherValue.y * 255.0 - ${h.H.float(128)},
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),n?i.code.add(h.H`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new d.j("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel))),i.code.add(h.H`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),r?(e.attributes.add(g.T.NORMAL2COMPRESSED,"vec2"),i.code.add(h.H`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):i.code.add(h.H`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),n?i.code.add(h.H`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(a.$,t),i.uniforms.add(new p.c("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new d.j("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new c.B("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL)),new c.B("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new u.J("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new u.J("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH))),i.code.add(h.H`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${y?"normalize(transformWorldFromModelTL + rotatedModelPosition);":"vec3(0.0, 0.0, 1.0);"}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new f.C("transformProjFromView",(e=>e.camera.projectionMatrix))).code.add(h.H`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(h.H`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function _(e){return e===r.Sketch||e===r.Mixed}!function(e){e[e.Solid=0]="Solid",e[e.Sketch=1]="Sketch",e[e.Mixed=2]="Mixed",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.SILHOUETTE=1]="SILHOUETTE"}(n||(n={}))},7590:(e,t,i)=>{i.d(t,{CM:()=>n,lu:()=>r});var r,n;i(3308),i(7845),i(22349);!function(e){e.OPAQUE="opaque-color",e.TRANSPARENT="transparent-color",e.COMPOSITE="composite-color",e.FINAL="final-color"}(r||(r={})),function(e){e.SSAO="ssao",e.LASERLINES="laserline-color",e.ANTIALIASING="aa-color",e.HIGHLIGHTS="highlight-color",e.MAGNIFIER="magnifier-color",e.OCCLUDED="occluded-color",e.VIEWSHED="viewshed-color",e.OPAQUE_ENVIRONMENT="opaque-environment-color",e.TRANSPARENT_ENVIRONMENT="transparent-environment-color",e.FOCUSAREA="focus-area"}(n||(n={}))},5512:(e,t,i)=>{i.d(t,{Z:()=>S});var r=i(36663),n=i(74396),s=i(13802),o=i(19431),a=i(95550),l=i(81977),c=(i(39994),i(4157),i(40266)),u=i(32114),h=i(3308),d=i(36531),p=i(84164),f=i(86717),m=i(81095),g=i(56999),y=i(52721),_=i(59934),v=i(97537),b=i(5700),w=i(65684);var x,T=i(74533);let C=x=class extends n.Z{constructor(e){super(e),this._ray=(0,v.Ue)(),this._viewport=(0,y.al)(0,0,1,1),this._padding=(0,y.al)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,p.al)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,h.Ue)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,h.Ue)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,h.Ue)(),this._frustumDirty=!0,this._frustum=(0,_.Ue)(),this._fullViewport=(0,y.Ue)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,m.Ue)(),this._up=(0,m.Ue)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,f.d)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,u.JG)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,f.i)((0,m.Ue)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,f.i)((0,m.Ue)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,f.i)((0,m.Ue)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,g.b)((0,y.Ue)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,g.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,g.b)((0,y.Ue)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,g.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[T.Np.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[T.Np.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[T.Np.RIGHT]+this._padding[T.Np.LEFT]}set fullWidth(e){this.width=e-(this._padding[T.Np.RIGHT]+this._padding[T.Np.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[T.Np.TOP]+this._padding[T.Np.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[T.Np.TOP]+this._padding[T.Np.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[T.Np.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[T.Np.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,g.a)(this._padding,e)||(this._viewport[0]+=e[T.Np.LEFT]-this._padding[T.Np.LEFT],this._viewport[1]+=e[T.Np.BOTTOM]-this._padding[T.Np.BOTTOM],this._viewport[2]-=e[T.Np.RIGHT]+e[T.Np.LEFT]-(this._padding[T.Np.RIGHT]+this._padding[T.Np.LEFT]),this._viewport[3]-=e[T.Np.TOP]+e[T.Np.BOTTOM]-(this._padding[T.Np.TOP]+this._padding[T.Np.BOTTOM]),(0,g.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,u.Jp)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,u.U_)((0,h.Ue)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,h.Ue)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}(this._fov,this.width,this.height)}set fovX(e){this._fov=function(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}(this._fov,this.width,this.height)}set fovY(e){this._fov=function(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,f.j)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,u.U_)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,u.p4)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const{near:t,far:i}=this;return 2*t*i/(i+t-e*(i-t))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,n=i/this.rows,s=r/this.columns,o=-r/2+this.column*s,a=o+s,l=-i/2+this.row*n,c=l+n,d=(0,u.oy)((0,h.Ue)(),o*(1+2*this._padding[T.Np.LEFT]/e),a*(1+2*this._padding[T.Np.RIGHT]/e),l*(1+2*this._padding[T.Np.BOTTOM]/t),c*(1+2*this._padding[T.Np.TOP]/t),this.near,this.far),p=this._get("projectionMatrix");return p&&(0,u.fS)(p,d)?p:d}copyFrom(e){(0,f.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,g.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,g.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,d.JG)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,u.JG)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,_.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,u.JG)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,g.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up,this.fov=e.fov}clone(){return(new x).copyFrom(this)}equals(e){return(0,f.p)(this.eye,e.eye)&&(0,f.p)(this.center,e.center)&&(0,f.p)(this.up,e.up)&&(0,g.a)(this._viewport,e.viewport)&&(0,g.a)(this._padding,e.padding)&&(0,d.I6)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,g.d)(e.screenPadding,this.screenPadding)>=t||(0,g.d)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,f.a)(A,e.eye,e.center),(0,f.a)(R,this.eye,this.center);const i=(0,f.f)(A,R),r=(0,f.z)(A),n=(0,f.z)(R),s=5e-4;return i*i>=(1-1e-10)*r*n&&(0,f.y)(e.eye,this.eye)<Math.max(r,n)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,b.SR)(this.viewForward,(0,f.d)(A,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,a.s1)()){return e[0]=(this.padding[T.Np.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[T.Np.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e[0]=this.padding[T.Np.LEFT]+this.width*t,e[1]=this.padding[T.Np.BOTTOM]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t){e!==E&&(0,f.c)(E,e),E[3]=1,(0,g.t)(E,E,this.projectionMatrix);const i=Math.abs(E[3]);(0,f.h)(E,E,1/i);const r=this.fullViewport;t[0]=(0,o.t7)(0,r[0]+r[2],.5+.5*E[0]),t[1]=(0,o.t7)(0,r[1]+r[3],.5+.5*E[1]),t[2]=.5*(E[2]+1),t[3]=i}unapplyProjection(e,t){const i=this.fullViewport;E[0]=(e[0]/(i[0]+i[2])*2-1)*e[3],E[1]=(e[1]/(i[1]+i[3])*2-1)*e[3],E[2]=(2*e[2]-1)*e[3],E[3]=e[3],null!=this.inverseProjectionMatrix&&((0,g.t)(E,E,this.inverseProjectionMatrix),t[0]=E[0],t[1]=E[1],t[2]=E[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,O),this.renderToScreen(O,t),t}projectToRenderScreen(e,t){if(E[0]=e[0],E[1]=e[1],E[2]=e[2],E[3]=1,(0,g.t)(E,E,this.viewProjectionMatrix),0===E[3])return null;const i=E;(0,f.h)(i,i,1/Math.abs(E[3]));const r=this.fullViewport,n=(0,o.t7)(0,r[0]+r[2],.5+.5*i[0]),s=(0,o.t7)(0,r[1]+r[3],.5+.5*i[1]);return"x"in t?(t.x=n,t.y=s):(t[0]=n,t[1]=s,t.length>2&&(t[2]=.5*(i[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,O),t)}unprojectFromRenderScreen(e,t){if((0,u.Jp)(M,this.projectionMatrix,this.viewMatrix),!(0,u.U_)(M,M))return null;const i=this.fullViewport;return E[0]=2*(e[0]-i[0])/i[2]-1,E[1]=2*(e[1]-i[1])/i[3]-1,E[2]=2*e[2]-1,E[3]=1,(0,g.t)(E,E,M),0===E[3]?null:(t[0]=E[0]/E[3],t[1]=E[1]/E[3],t[2]=E[2]/E[3],t)}constrainWindowSize(e,t,i,r){const n=e*this.pixelRatio,s=t*this.pixelRatio,o=Math.max(n-i/2,0),a=Math.max(this.fullHeight-s-r/2,0),l=-Math.min(n-i/2,0),c=-Math.min(this.fullHeight-s-r/2,0),u=i-l- -Math.min(this.fullWidth-n-i/2,0),h=r-c- -Math.min(s-r/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(e){e===w.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const i=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=i,t[1]=r}_computeUpGlobal(){(0,f.d)(A,this.center,this.eye);const e=(0,f.l)(this.center);e<1?((0,f.i)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,f.f)(A,this.center))>.9999*(0,f.l)(A)*e||((0,f.e)(this._up,A,this.center),(0,f.e)(this._up,this._up,A),(0,f.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,f.o)(A,this.eye,this.center),Math.abs(A[2])<=.9999&&((0,f.h)(A,A,A[2]),(0,f.i)(this._up,-A[0],-A[1],1-A[2]),(0,f.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,i=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,f.p)(e,t)||((0,f.c)(t,e),this._markViewDirty(),i.length&&this.notifyChange(i)):s.Z.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,_.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,u.zB)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,r._)([(0,l.Cb)()],C.prototype,"_viewport",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"_padding",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"_fov",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"_nearFar",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"_viewDirty",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"_viewMatrix",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"_pixelRatio",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"pixelRatio",null),(0,r._)([(0,l.Cb)()],C.prototype,"row",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"column",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"_rows",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"rows",null),(0,r._)([(0,l.Cb)()],C.prototype,"_columns",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"columns",null),(0,r._)([(0,l.Cb)()],C.prototype,"eye",null),(0,r._)([(0,l.Cb)()],C.prototype,"center",null),(0,r._)([(0,l.Cb)()],C.prototype,"_center",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"up",null),(0,r._)([(0,l.Cb)()],C.prototype,"_up",void 0),(0,r._)([(0,l.Cb)()],C.prototype,"viewMatrix",null),(0,r._)([(0,l.Cb)({readOnly:!0})],C.prototype,"viewForward",null),(0,r._)([(0,l.Cb)({readOnly:!0})],C.prototype,"viewUp",null),(0,r._)([(0,l.Cb)({readOnly:!0})],C.prototype,"viewRight",null),(0,r._)([(0,l.Cb)({readOnly:!0})],C.prototype,"nearFar",null),(0,r._)([(0,l.Cb)()],C.prototype,"near",null),(0,r._)([(0,l.Cb)()],C.prototype,"far",null),(0,r._)([(0,l.Cb)()],C.prototype,"viewport",null),(0,r._)([(0,l.Cb)({readOnly:!0})],C.prototype,"screenViewport",null),(0,r._)([(0,l.Cb)({readOnly:!0})],C.prototype,"screenPadding",null),(0,r._)([(0,l.Cb)()],C.prototype,"x",null),(0,r._)([(0,l.Cb)()],C.prototype,"y",null),(0,r._)([(0,l.Cb)()],C.prototype,"width",null),(0,r._)([(0,l.Cb)()],C.prototype,"height",null),(0,r._)([(0,l.Cb)()],C.prototype,"fullWidth",null),(0,r._)([(0,l.Cb)()],C.prototype,"fullHeight",null),(0,r._)([(0,l.Cb)({readOnly:!0})],C.prototype,"_aspect",null),(0,r._)([(0,l.Cb)()],C.prototype,"padding",null),(0,r._)([(0,l.Cb)({readOnly:!0})],C.prototype,"projectionMatrix",null),(0,r._)([(0,l.Cb)({readOnly:!0})],C.prototype,"inverseProjectionMatrix",null),(0,r._)([(0,l.Cb)()],C.prototype,"fov",null),(0,r._)([(0,l.Cb)()],C.prototype,"fovX",null),(0,r._)([(0,l.Cb)()],C.prototype,"fovY",null),(0,r._)([(0,l.Cb)()],C.prototype,"viewInverseTransposeMatrix",null),(0,r._)([(0,l.Cb)({readOnly:!0})],C.prototype,"_projectionMatrixInternal",null),(0,r._)([(0,l.Cb)()],C.prototype,"relativeElevation",void 0),C=x=(0,r._)([(0,c.j)("esri.views.3d.webgl.RenderCamera")],C);const S=C,E=(0,y.Ue)(),M=(0,h.Ue)(),A=(0,m.Ue)(),R=(0,m.Ue)(),O=(0,a.J$)()},25534:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(36663),n=i(74396),s=i(70375),o=i(76868),a=i(81977),l=i(40266),c=i(7590),u=i(70984);let h=class extends n.Z{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=c.lu.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([(0,o.watch)((()=>this.view.ready),(e=>{e&&this.view._stage?.renderer.addRenderNode(this)}),o.initial)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new s.Z("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}get techniques(){return this.view._stage.renderView.techniques}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,t=this.view._stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return t.fbo?.initializeAndBind(),t}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){e===u.Xx.UPDATE&&this.view._stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view._stage.renderView.renderingContext}get renderContext(){return this.view._stage?.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find((({name:e})=>e===this.produces));try{return this.render(e)}finally{this._frameBuffer=null}}};(0,r._)([(0,a.Cb)({constructOnly:!0})],h.prototype,"view",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],h.prototype,"consumes",void 0),(0,r._)([(0,a.Cb)()],h.prototype,"produces",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],h.prototype,"techniques",null),h=(0,r._)([(0,l.j)("esri.views.3d.webgl.RenderNode")],h);const d=h},37503:(e,t,i)=>{var r,n;i.d(t,{m:()=>n,q:()=>r}),function(e){e[e.RED=0]="RED",e[e.RG=1]="RG",e[e.RGBA4=2]="RGBA4",e[e.RGBA=3]="RGBA",e[e.RGBA_MIPMAP=4]="RGBA_MIPMAP",e[e.R16F=5]="R16F",e[e.RGBA16F=6]="RGBA16F"}(r||(r={})),function(e){e[e.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",e[e.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(n||(n={}))},52064:(e,t,i)=>{i.d(t,{J:()=>Y,b:()=>$});var r=i(36663),n=i(74396),s=i(41831),o=i(61681),a=i(76868),l=i(81977),c=(i(39994),i(13802),i(4157),i(40266)),u=i(5992),h=i(3308),d=i(86717),p=i(81095),f=i(10186),m=i(7845),g=i(92570),y=i(35914),_=i(6766),v=i(65684),b=i(29642),w=i(92740),x=i(14923),T=i(82844),C=i(7590),S=i(25534),E=i(9969),M=i(62575),A=i(21635),R=i(17346);class O extends M.A{constructor(e,t){super(e,t,new E.J(A.a,(()=>i.e(8393).then(i.bind(i,8393)))))}initializePipeline(){return(0,R.sm)({colorWrite:R.gf})}}let P=class extends S.Z{constructor(e){super({...e,view:e.focusAreas.view}),this.consumes={required:[C.lu.COMPOSITE,C.CM.FOCUSAREA]},this.produces=C.lu.COMPOSITE,this._passParameters=new A.F}precompile(){this.techniques.precompile(O)}render(e){const t=this.techniques.get(O),i=e.find((({name:e})=>e===C.lu.COMPOSITE));if(!t.compiled)return this.requestRender(),i;const r=this.bindParameters,n=r.camera,s=n.fullViewport[2],o=n.fullViewport[3],a=e.find((({name:e})=>e===C.CM.FOCUSAREA)),l=this.fboCache.acquire(s,o,this.produces),c=this.renderingContext;return c.gl.clear(c.gl.STENCIL_BUFFER_BIT),c.bindFramebuffer(l.fbo),this._passParameters.color=i.getTexture(),this._passParameters.focusArea=a.getTexture(),this._passParameters.effect=L[this.focusAreas.style],c.bindTechnique(t,r,this._passParameters),c.screen.draw(),l.attachDepth(i.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),l}};var I;(0,r._)([(0,l.Cb)()],P.prototype,"consumes",void 0),(0,r._)([(0,l.Cb)()],P.prototype,"produces",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],P.prototype,"focusAreas",void 0),P=(0,r._)([(0,c.j)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],P),function(e){e[e.NONE=0]="NONE",e[e.BRIGHT=1]="BRIGHT",e[e.DARK=2]="DARK"}(I||(I={}));const L={none:I.NONE,bright:I.BRIGHT,dark:I.DARK};var D=i(37503),N=i(10221),F=i(91907);class U extends M.A{constructor(e,t){super(e,t,new E.J(N.a,(()=>i.e(6500).then(i.bind(i,6500)))))}initializePipeline(){return(0,R.sm)({colorWrite:R.gf,depthTest:{func:F.wb.LEQUAL}})}}var k=i(5474),z=i(71299),B=i(44125),V=i(78951),H=i(86765);let G=class extends S.Z{constructor(e){super({...e,view:e.focusAreas.view}),this.consumes={required:[C.CM.FOCUSAREA,C.lu.TRANSPARENT]},this.produces=C.CM.FOCUSAREA,this._vaos=new Array,this._counts=new Array,this._origins=new Array,this._maskParameters=new N.F}initialize(){this.updateGeometries()}destroy(){this._vaos.forEach((e=>e.dispose())),this._vaos.length=this._counts.length=this._origins.length=0}precompile(){this.techniques.precompile(U)}render(e){const t=this.techniques.get(U),i=this.bindParameters,r=i.camera,n=r.fullViewport[2],s=r.fullViewport[3],o=this.fboCache.acquire(n,s,C.CM.FOCUSAREA,D.q.RGBA);if(!t.compiled||!this._vaos)return this.requestRender(),o;const a=e.find((({name:e})=>e===C.lu.TRANSPARENT)),l=this.renderingContext;o.attachDepth(a.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),l.bindFramebuffer(o.fbo),l.clear(F.Hf.COLOR|F.Hf.STENCIL),l.setViewport(0,0,n,s),l.gl.clearStencil(0),l.gl.clear(l.gl.STENCIL_BUFFER_BIT),l.setClearStencil(0);const c=l.bindTechnique(t,i);l.setFaceCullingEnabled(!1),l.setStencilTestEnabled(!0),l.setStencilOpSeparate(F.LR.FRONT,F.xS.KEEP,F.xS.INCR_WRAP,F.xS.KEEP),l.setStencilOpSeparate(F.LR.BACK,F.xS.KEEP,F.xS.DECR_WRAP,F.xS.KEEP),l.setDepthWriteEnabled(!1);for(let e=0;e<this._vaos.length;e++){const t=this._vaos[e],r=this._counts[e];this._maskParameters.origin=this._origins[e],c.bindDraw(i,H.G,this._maskParameters),l.bindVAO(t),l.setStencilWriteMask(255),l.setStencilFunction(F.wb.ALWAYS,0,255),l.setColorMask(!1,!1,!1,!1),l.drawArrays(F.MX.TRIANGLES,0,r),l.setStencilWriteMask(0),l.setStencilFunction(F.wb.NOTEQUAL,0,255),l.setColorMask(!0,!0,!0,!0),l.drawArrays(F.MX.TRIANGLES,0,r)}return o}updateGeometries(){if(!this.view._stage)return;this._vaos.forEach((e=>e.dispose())),this._vaos.length=this._counts.length=this._origins.length=0;const e=this.focusAreas.geometries;for(const t of e){const e=new Array,i=t.indicesBottom;for(let r=0;r<i.length;r++)e.push(t.positions[3*(i[r]-1)]),e.push(t.positions[3*(i[r]-1)+1]),e.push(t.positions[3*(i[r]-1)+2]);const r=t.indicesExtruded;for(let i=0;i<r.length;i++)e.push(t.positions[3*r[i]]),e.push(t.positions[3*r[i]+1]),e.push(t.positions[3*r[i]+2]);const n=new Float32Array(e),s=new B.U(this.renderingContext,k.i,new Map([["geometry",z.ap]]),new Map([["geometry",V.f.createVertex(this.renderingContext,F.l1.STATIC_DRAW,n)]]));this._vaos.push(s),this._counts.push(i.length+r.length),this._origins.push(t.origin)}this.requestRender()}};(0,r._)([(0,l.Cb)()],G.prototype,"consumes",void 0),(0,r._)([(0,l.Cb)()],G.prototype,"produces",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],G.prototype,"focusAreas",void 0),G=(0,r._)([(0,c.j)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaMaskNode")],G);class j{constructor(e,t,i,r,n,s){this.positions=e,this.indicesBottom=t,this.indicesExtruded=i,this.height=r,this.origin=n,this.color=s}}var Z;!function(e){e[e.NONE=0]="NONE",e[e.BRIGHT=1]="BRIGHT",e[e.DARK=2]="DARK"}(Z||(Z={}));const q=.42,W=.32;function $(e,t){if(e){if("bright"===t){const t=(e[0]+e[1]+e[2])/3;return[t*W+(1-W),t*W+(1-W),t*W+(1-W),e[3]*W]}return"dark"===t?[e[0]*q,e[1]*q,e[2]*q,e[3]*q]:e}}let Y=class extends n.Z{constructor(e){super(e),this.style="dark",this.geometries=new Array,this._areas=new s.Z,this._elevationContext=new b.o}initialize(){this.addHandles([(0,a.watch)((()=>this.style),(()=>this._updateRenderNodes()),a.syncAndInitial)]),this.addHandles([(0,a.watch)((()=>this.activePolygons),(()=>this._updateFocusAreaGeometries()),a.syncAndInitial)])}get activePolygons(){const e=new s.Z;for(const t of this.areas)if(t.enabled)for(const i of t.geometries)e.push(i);return e}add(e){this.areas.add(e),this._updateFocusAreaGeometries()}addMany(e){this.areas.addMany(e),this._updateFocusAreaGeometries()}remove(e){this.areas.remove(e),this._updateFocusAreaGeometries()}removeMany(e){this.areas.removeMany(e),this._updateFocusAreaGeometries()}removeAll(){this.areas.removeAll(),this._updateFocusAreaGeometries()}containsGeometry(e){let t=!0;const i=new f.Z(e);return t=this.areas.some((e=>!!e.enabled&&!!e?.geometries.length&&e.geometries.some((e=>e.contains(i))))),t}get areas(){return this._areas}_updateFocusAreaGeometries(){this._extrudePolygons(),this._updateRenderNodes()}_extrudePolygons(){if(!this.view.renderCoordsHelper)return;this.geometries.length=0;const e=5e6,t=(0,p.Ue)(),i=this.view.renderCoordsHelper.viewingMode===v.JY.Global,r=(0,h.Ue)(),n=(0,h.Ue)();i||this.view.renderCoordsHelper.worldUpAtPosition([0,0,0],t);for(const s of this.areas)if(s.enabled)for(const o of s.geometries){const a=(0,x.zE)(o);if(null==a)continue;(0,m.B)(o.spatialReference,[a.x,a.y,0],r,this.view.renderCoordsHelper.spatialReference);const l=(0,d.n)(J,[r[12]-0*t[0],r[13]-0*t[1],r[14]-0*t[2]]);n[12]=-r[12],n[13]=-r[13],n[14]=-r[14];const c=(0,T.VP)(o,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:h,mapPositions:p,position:f}=c;for(const o of h){const a=o.count,c=(0,u.e)(o.mapPositions,o.holeIndices,3);if(0===c.length)continue;const h=c.length,d=6*a,m=(0,y.$z)(d+h),v=(0,y.$z)(h),b=(0,g.bg)(3*d),x=(0,g.bg)(3*d),T=(0,g.bg)(3*d),C=(0,g.bg)(d);(0,w.A)(f,p,c,o,b,T,x,C,m,v,e,t,i),(0,_.t)(b,b,n);const S=new j(b,v,m,e,[r[12]+0*l[0],r[13]+0*l[1],r[14]+0*l[2]],s.outline?.color);this.geometries.push(S)}}this._maskRenderNode?.updateGeometries()}_updateRenderNodes(){this.view._stage&&("none"===this.style||0===this.geometries.length?(this._maskRenderNode=(0,o.SC)(this._maskRenderNode),this._colorRenderNode=(0,o.SC)(this._colorRenderNode)):(this._maskRenderNode??=new G({focusAreas:this}),this._colorRenderNode??=new P({focusAreas:this})))}};(0,r._)([(0,l.Cb)()],Y.prototype,"activePolygons",null),(0,r._)([(0,l.Cb)()],Y.prototype,"style",void 0),(0,r._)([(0,l.Cb)()],Y.prototype,"geometries",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],Y.prototype,"view",void 0),(0,r._)([(0,l.Cb)()],Y.prototype,"_areas",void 0),Y=(0,r._)([(0,c.j)("esri.views.FocusAreas")],Y);const J=(0,p.Ue)()},65684:(e,t,i)=>{var r;function n(e){return"global"===e?r.Global:r.Local}function s(e){return e===r.Global?"global":"local"}i.d(t,{JY:()=>r,M7:()=>s,wg:()=>n}),function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"}(r||(r={}))},8365:(e,t,i)=>{function r(e,t,i){if(!t||!e?.map)return;const{map:r}=e,n=r.layers.find((e=>e===t));n||r.add(t,i),n&&null!=i&&r.layers.reorder(n,i)}function n(e,t){const i="subtype-sublayer"===t?.type?t.parent:t;return e.allLayerViews.find((e=>{const t=e.layer;return t===i||"sublayers"in t&&null!=t.sublayers&&t.sublayers.includes(i)}))}i.d(t,{j:()=>n,p:()=>r})},51986:(e,t,i)=>{var r;i.d(t,{t:()=>r}),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(r||(r={}))},41649:(e,t,i)=>{i.d(t,{a:()=>n});i(39994),i(13802);class r{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const e of this.keyModifiers)if(!t.has(e))return!1;return!0}}class n{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let n;"function"==typeof t?(i=t,n=[]):n=t||[];const o="string"==typeof e?new r(e,n):e,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},l=e=>{const t=this._incoming[e.match.eventType];if(t){const i=t.indexOf(e);t.splice(i,1),a(),this._manager&&this._manager.updateDependencies()}},c=new s(o,i,{onPause:l,onRemove:l,onResume:e=>{const t=this._incoming[e.match.eventType];t&&!t.includes(e)&&(t.push(e),a(),this._manager&&this._manager.updateDependencies())}});let u=this._incoming[o.eventType];return u||(u=[],this._incoming[o.eventType]=u),u.push(c),a(),this._manager&&this._manager.updateDependencies(),c}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new o(e,{onEmit:(e,t,i,r)=>{this._manager?.emit(e.eventType,t,i,r)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const i of t)if(i.match.matches(e)&&(i.callback?.(e),e.shouldStopPropagation()))break}}class s{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class o{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}},97737:(e,t,i)=>{i.d(t,{$:()=>m,f:()=>_});var r=i(36663),n=i(74396),s=(i(39994),i(13802)),o=i(58713),a=i(81977),l=(i(4157),i(40266)),c=i(79622),u=i(41649);class h extends u.a{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",(e=>this._update(e.data)))}_update(e){const t="touch"===e.native.pointerType?"touch":"mouse",{x:i,y:r}=e;t===this._value&&this._x===i&&this._y===r||(this._value=t,this._x=i,this._y=r,this._onChange(t,i,r))}}var d=i(18809);class p extends u.a{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=(0,d.t)(!1),this._onPointerAdd=({data:e})=>{"touch"===e.pointerType&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{"touch"===e.pointerType&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}}var f=i(13727);let m=class extends n.Z{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=c.C,this._latestPointerType="mouse",this._propertiesPool=new f.L({latestPointerLocation:v},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,t,i=_.INTERNAL){if(this._nameToGroup[e])return;if(0===t.length)return;const r={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=r;for(let e=r.handlers.length-1;e>=0;e--){const t=r.handlers[e];this._handlers.push(t),t.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(e,i,r,n,s)=>{this._emitInputEvent(t.priorityIndex+1,e,i,r,s,n)},setPointerCapture:(e,i)=>{this._setPointerCapture(r,t,e,i)},setEventCallback:e=>{t.eventCallback=e},setUninstallCallback:e=>{t.uninstallCallback=e},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback?.()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):s.Z.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}isModifierKeyDown(e){return this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let e=this._handlers.length-1;e>=0;e--){const t=this._handlers[e];t.priorityIndex=e,this._handlersPriority.push(t)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let n=r.handler.hasSideEffects;if(!n)for(const t of r.handler.outgoingEventTypes)if(e.has(t)){n=!0;break}if(n)for(const i of r.handler.incomingEventMatches){e.add(i.eventType);for(const e of i.keyModifiers)(0,c.w)(e)||t.add(e)}r.active=n}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._latestPointerType=e;const r=this._get("latestPointerLocation");if(null==r||r.x!==t||r.y!==i){const e=this._propertiesPool.get("latestPointerLocation");e.x=t,e.y=i,this._set("latestPointerLocation",e)}}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{i||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),i=!0)},n=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(r(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(r(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const i=t.key;this._keyModifiers.has(i)&&n(i,"key-down"===e)}const s=t.native;n("Alt",!!s?.altKey),n("Control",!!s?.ctrlKey),n("Ctrl",!!s?.ctrlKey),n("Shift",!!s?.shiftKey),n("Meta",!!s?.metaKey),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new h(((e,t,i)=>this._setLatestPointer(e,t,i))),this._multiTouchHandler=new p,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,_.INTERNAL)}_setPointerCapture(e,t,i,r){const n=e.name+"-"+t.priorityIndex,s=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,s),r?(s.add(n),1===s.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):s.has(n)&&(s.delete(n),0===s.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,n,s){const o=void 0!==r?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=void 0!==n&&n,l={event:new g(t,i,o,s||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new o.Z,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:t,priorityIndex:i}=e.events.pop(),r=t.data?.eventId;if(null==r||!this._stoppedPropagationEventIds.has(r))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback?.(t),t.shouldStopPropagation()){null!=r&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new o.Z;t.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)t.push(i.events.pop());i.events=t,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(i.eventType!==e.eventType)continue;const t=i.keyModifiers.filter((t=>e.keyModifiers.includes(t)));if(t.length===i.keyModifiers.length!=(t.length===e.keyModifiers.length))return i.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(i,t[e])>=0;)e++;t.splice(e,0,i)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,i)=>{e((()=>this._onEventReceived(t,i)))},disablePointerCapture:e}}};(0,r._)([(0,a.Cb)({readOnly:!0})],m.prototype,"hasPendingInputs",null),(0,r._)([(0,a.Cb)({constructOnly:!0})],m.prototype,"eventSource",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],m.prototype,"recognizers",void 0),(0,r._)([(0,a.Cb)()],m.prototype,"_latestPointerType",void 0),(0,r._)([(0,a.Cb)()],m.prototype,"latestPointerType",null),(0,r._)([(0,a.Cb)()],m.prototype,"multiTouchActive",null),(0,r._)([(0,a.Cb)({readOnly:!0})],m.prototype,"latestPointerLocation",void 0),(0,r._)([(0,a.Cb)()],m.prototype,"_paused",void 0),(0,r._)([(0,a.Cb)({readOnly:!0})],m.prototype,"updating",null),m=(0,r._)([(0,l.j)("esri.views.input.InputManager")],m);class g{constructor(e,t,i,r,n){this.type=e,this.data=t,this.timestamp=i,this.modifiers=r,this.cancelable=n,this._propagationState=y.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=y.STOPPED}shouldStopPropagation(){return!!(this._propagationState&y.STOPPED)}async(e){this._propagationState|=y.PAUSED;const t=(e,t)=>{this._propagationState&=~y.PAUSED;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(this._propagationState&y.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}var y;!function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"}(y||(y={}));const _={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};const v=class{}},3846:(e,t,i)=>{i.d(t,{CE:()=>h,uS:()=>l});i(39994);var r=i(23148),n=i(19431),s=i(95550),o=i(41649),a=i(97737);i(51986);const l=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],c={};function u(e){return!!c[e]}l.forEach((e=>{c[e]=!0}));class h{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach((({handler:e,priority:t},i)=>this.inputManager?.installHandlers(i,[e],t)))}disconnect(){this.inputManager&&this._handlers.forEach(((e,t)=>this.inputManager?.uninstallHandlers(t))),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,t,i,n){const s=Array.isArray(e)?e:e.split(",");if(!function(e){for(const t of e)if(!u(t))return!1;return!0}(s))return s.some(u)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,l;Array.isArray(t)?l=t:(o=t,l=[]),"function"==typeof i?o=i:n=i,n=null!=n?n:a.f.DEFAULT;const c=this._createUniqueGroupName(),h=new d(this.view,s,l,o);this._handlers.set(c,{handler:h,priority:n});for(const e of s){const t=this._handlerCounts.get(e)||0;this._handlerCounts.set(e,t+1)}return this.inputManager&&this.inputManager.installHandlers(c,[h],n),(0,r.kB)((()=>this._removeHandler(c,s)))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,t){if(this._handlers.has(e)){this._handlers.delete(e);for(const e of t){const t=this._handlerCounts.get(e);void 0===t||(1===t?this._handlerCounts.delete(e):this._handlerCounts.set(e,t-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}}class d extends o.a{constructor(e,t,i,r){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of t)switch(n){case"click":this.registerIncoming("click",i,(t=>r(m(e,t))));break;case"double-click":this.registerIncoming("double-click",i,(t=>r(g(e,t))));break;case"immediate-click":this.registerIncoming("immediate-click",i,(t=>r(y(e,t))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,(t=>r(_(e,t))));break;case"hold":this.registerIncoming("hold",i,(t=>r(v(e,t))));break;case"drag":this.registerIncoming("drag",i,(e=>{const t=this._wrapDrag(e);t&&r(t)}));break;case"key-down":this.registerIncoming("key-down",i,(e=>r(w(e))));break;case"key-up":this.registerIncoming("key-up",i,(e=>r(x(e))));break;case"pointer-down":this.registerIncoming("pointer-down",i,(e=>r(T(e,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",i,(e=>r(T(e,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",i,(e=>r(T(e,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,(e=>r(C(e))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,(e=>r(S(e))));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,(e=>r(T(e,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,(e=>r(T(e,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",i,(e=>{r(E(e))}));break;case"focus":this.registerIncoming("focus",i,(e=>{r(p(e))}));break;case"blur":this.registerIncoming("blur",i,(e=>{r(f(e))}))}}_wrapDrag(e){const t=e.data,{x:i,y:r}=t.center,{action:s,pointerType:o,button:a}=t;if("start"===s&&(this._latestDragStart=t),!this._latestDragStart)return;const l=t.pointer.native,c=t.buttons,{cancelable:u,timestamp:h}=e,d={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return"end"===s&&(this._latestDragStart=void 0),{type:"drag",action:s,x:i,y:r,origin:d,pointerType:o,button:a,buttons:c,radius:t.radius,angle:(0,n.BV)(t.angle),native:l,timestamp:h,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}}function p(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function f(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function m(e,t){const{pointerType:i,button:r,buttons:n,x:o,y:a,native:l,eventId:c}=t.data,{cancelable:u,timestamp:h}=t;return{type:"click",pointerType:i,button:r,buttons:n,x:o,y:a,native:l,timestamp:h,screenPoint:(0,s.vW)(o,a),mapPoint:b(e,o,a),eventId:c,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function g(e,t){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:u}=t;return{type:"double-click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:u,mapPoint:b(e,s,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function y(e,t){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:u,timestamp:h}=t;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:b(e,s,o),eventId:l,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function _(e,t){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:u,timestamp:h}=t;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:b(e,s,o),eventId:l,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function v(e,t){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:b(e,s,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function b(e,t,i){return e.toMap((0,s.vW)(t,i),{exclude:[]})}function w(e){const{key:t,repeat:i,native:r}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-down",key:t,repeat:i,native:r,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function x(e){const{key:t,native:i}=e.data,{cancelable:r,timestamp:n}=e;return{type:"key-up",key:t,native:i,timestamp:n,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function T(e,t){const{x:i,y:r,button:n,buttons:s,native:o,eventId:a}=e.data,l=o.pointerId,c=o.pointerType,{cancelable:u,timestamp:h}=e;return{type:t,x:i,y:r,pointerId:l,pointerType:c,button:n,buttons:s,native:o,timestamp:h,eventId:a,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function C(e){const{x:t,y:i,buttons:r,native:n,eventId:s}=e.data.currentEvent,{button:o}=e.data.startEvent,a=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,c=e.data.action,u={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:h,timestamp:d}=e;return{type:"pointer-drag",x:t,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:c,origin:u,native:n,timestamp:d,eventId:s,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function S(e){const{cancelable:t,data:i,timestamp:r}=e,{x:n,y:s,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:n,y:s,deltaY:o,native:a,timestamp:r,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function E(e){const{action:t,state:i,device:r}=e.data,{cancelable:n,timestamp:s}=e,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:s,action:t,buttons:o,axes:a,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}},79622:(e,t,i)=>{i.d(t,{C:()=>r,w:()=>s});const r=(0,i(39994).Z)("mac")?"Meta":"Control",n=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),s=e=>n.has(e)},91258:(e,t,i)=>{var r,n,s;i.d(t,{Q9:()=>n,bH:()=>r,jg:()=>s}),function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(n||(n={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(s||(s={}))},41775:(e,t,i)=>{i.d(t,{G7:()=>d,Kj:()=>c,Lk:()=>h,Sn:()=>l,T6:()=>u});var r=i(7753),n=i(23148),s=i(86114),o=i(97737),a=i(79622);const l={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},c={toggle:"Control"},u={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},h={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:a.C,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},editSourcePoints:{key:"Alt",continuePropagation:!0},undo:"z",redo:"r"};class d{constructor(){this._bindings=new Map}add(e,t){return this.addToggle(e,(e=>{"key-down"===e.type&&t(e)}))}addToggle(e,t){const i=p.fromDefinition(e,t),o=(0,s.s1)(this._bindings,i.key,(()=>[]));return o.push(i),(0,n.kB)((()=>(0,r.Od)(o,i)))}register(e,t=o.f.WIDGET){return(0,n.AL)([e.on("key-down",(t=>this.dispatch(e.inputManager,t)),t),e.on("key-up",(t=>this.dispatch(e.inputManager,t)),t)])}dispatch(e,t){const i=t.key,r=this._bindings.get(i);if(r)for(const i of r)i.process(e,t)}}class p{constructor(e,t,i,r,n){this.key=e,this.modifiers=t,this.repeats=i,this.continuePropagation=r,this.callback=n}process(e,t){if(!(t.key!==this.key||"repeat"in t&&t.repeat&&!this.repeats)){for(const t of this.modifiers)if(!e.isModifierKeyDown(t))return;this.continuePropagation||t.stopPropagation(),this.callback(t)}}static fromDefinition(e,t){if("string"==typeof e)return new p(e,[],!1,!1,t);const{key:i,modifier:r,repeats:n,continuePropagation:s}=e;return new p(i,r?Array.isArray(r)?r:[r]:[],!!n,!!s,t)}}},41386:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(36663),n=i(74396),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(e){super(e),this.enabled=!1}};(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],a.prototype,"enabled",void 0),a=(0,r._)([(0,o.j)("esri.views.interactive.sketch.SketchLabelOptions")],a);const l=a},4399:(e,t,i)=>{i.d(t,{Z:()=>h});var r=i(36663),n=i(74396),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),a=i(41386),l=i(35329),c=i(98051);let u=class extends n.Z{constructor(e){super(e),this.labels=new a.Z,this.tooltips=new l.Z,this.values=new c.Z}};(0,r._)([(0,s.Cb)({nonNullable:!0,type:a.Z})],u.prototype,"labels",void 0),(0,r._)([(0,s.Cb)({nonNullable:!0,type:l.Z})],u.prototype,"tooltips",void 0),(0,r._)([(0,s.Cb)({nonNullable:!0,type:c.Z})],u.prototype,"values",void 0),u=(0,r._)([(0,o.j)("esri.views.interactive.sketch.SketchOptions")],u);const h=u},35329:(e,t,i)=>{i.d(t,{Z:()=>h});var r=i(36663),n=i(74396),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};(0,r._)([(0,s.Cb)({type:String,nonNullable:!0})],a.prototype,"mode",void 0),a=(0,r._)([(0,o.j)("esri.views.interactive.sketch.SketchTooltipElevationOptions")],a);let l=class extends n.Z{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"area",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"coordinates",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"direction",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"distance",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"elevation",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"header",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"helpMessage",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"orientation",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"radius",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"rotation",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"scale",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"size",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"totalLength",void 0),l=(0,r._)([(0,o.j)("esri.views.interactive.sketch.SketchTooltipVisibleElements")],l);const c=l;let u=class extends n.Z{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new a,this.placement="auto",this.offset=null,this.visibleElements=new c,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],u.prototype,"enabled",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"forceEnabled",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"effectiveEnabled",null),(0,r._)([(0,s.Cb)()],u.prototype,"helpMessage",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"helpMessageIcon",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],u.prototype,"inputEnabled",void 0),(0,r._)([(0,s.Cb)({type:a,nonNullable:!0})],u.prototype,"elevation",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"placement",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"offset",void 0),(0,r._)([(0,s.Cb)({type:c,nonNullable:!0})],u.prototype,"visibleElements",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"visualVariables",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"xyMode",void 0),u=(0,r._)([(0,o.j)("esri.views.interactive.sketch.SketchTooltipOptions")],u);const h=u},98051:(e,t,i)=>{i.d(t,{Z:()=>h});var r=i(36663),n=i(74396),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};(0,r._)([(0,s.Cb)()],a.prototype,"length",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"verticalLength",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"area",void 0),a=(0,r._)([(0,o.j)("esri.views.interactive.sketch.Units")],a);const l=a;var c=i(92772);let u=class extends n.Z{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?c.uE.RelativeBilateral:c.uE.Relative;case"absolute":return c.uE.Absolute}}get displayUnits(){return this._get("displayUnits")??new l}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new l}set inputUnits(e){this._set("inputUnits",e)}};(0,r._)([(0,s.Cb)({type:String,nonNullable:!0})],u.prototype,"directionMode",void 0),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],u.prototype,"relativeDirectionIsBilateral",void 0),(0,r._)([(0,s.Cb)()],u.prototype,"effectiveDirectionMode",null),(0,r._)([(0,s.Cb)({type:l,nonNullable:!0})],u.prototype,"displayUnits",null),(0,r._)([(0,s.Cb)({type:l,nonNullable:!0})],u.prototype,"inputUnits",null),u=(0,r._)([(0,o.j)("esri.views.interactive.sketch.SketchValueOptions")],u);const h=u},82308:(e,t,i)=>{i.d(t,{Hk:()=>b,M8:()=>B,SP:()=>O,Vy:()=>H,aU:()=>U,f2:()=>re,jg:()=>k,kt:()=>S,ku:()=>x,lY:()=>V,wp:()=>se});var r=i(7753),n=i(19431),s=i(36531),o=i(84164),a=i(86717),l=i(81095),c=i(56999),u=i(52721),h=i(36285),d=i(85130),p=i(69430),f=i(73687),m=i(35369),g=i(51633),y=i(6271),_=i(23440);class v{intersect(e){return q(this,e)}closestPoints(e){return[this.closestTo(e)]}}class b extends v{constructor(e){super(),this.point=e}equals(e){return this===e||se(e)&&(0,a.p)(this.point,e.point)}closestTo(){return(0,g.d9)(this.point)}}class w extends v{constructor(e,t,i){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:i}}equals(e){return this===e||oe(e)&&this.lineLike.type===e.lineLike.type&&(0,a.p)(this.start,e.start)&&(0,a.p)(this.end,e.end)}closestTo(e){const t=(0,g.by)();return(0,y.ZE)(e,this.lineLike,t),t}}class x extends w{constructor(e,t){super(e,t,_.SP.LINE)}}class T extends w{constructor(e,t){super(e,t,_.SP.RAY)}}class C extends v{constructor(e){super(),this.constraints=e}equals(e){return this===e||ne(e)&&(0,r.fS)(this.constraints,e.constraints,((e,t)=>e.equals(t)))}closestTo(e){let t,i=1/0;for(const r of this.constraints){const n=r.closestTo(e),s=(0,a.s)(e,n);s<i&&(i=s,t=n)}return(0,g.d9)(t??e)}closestPoints(e){return this.constraints.flatMap((t=>t===this?[]:t.closestPoints(e)))}}class S extends v{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ce(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=(0,g.by)();return(0,y.sc)(e,this.center,this.radius,t),t}}class E extends v{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ue(e)&&(0,a.p)(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=(0,g.by)();return(0,y.sc)(e,this.center,this.radius,t),t[2]=this.center[2],t}asCircle(){return new M((0,g.d9)(this.center),this.radius,(0,g.al)(0,0,1))}}class M extends v{constructor(e,t,i,r){super(),this.center=e,this.radius=t,this.normal=i,this.slicePlane=r}equals(e){return this===e||he(e)&&(0,a.p)(this.center,e.center)&&(0,a.p)(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:i}=this;(0,p.nF)(this.getPlane(R),e,A);const r=(0,a.a)(A,A,t),n=(0,a.k)(r);if((0,y.hA)(n,0))return(0,g.d9)(e);const s=i/Math.sqrt(n),o=(0,g.by)();(0,a.b)(o,t,r,s);const{slicePlane:l}=this;if(l&&!(0,y.zf)(l,o)){return $(l,this)?.closestTo(e)??(0,g.d9)(e)}return o}getPlane(e=(0,p.Ue)()){return(0,p.Yq)(this.center,this.normal,e)}}const A=(0,l.Ue)(),R=(0,p.Ue)();class O extends v{constructor(e){super(),this.z=e}equals(e){return this===e||ae(e)&&this.z===e.z}closestTo(e){return(0,g.al)(e[0],e[1],this.z)}getPlane(e=(0,p.Ue)()){return(0,a.i)(P,0,0,this.z),(0,p.Yq)(P,l.eG,e)}}const P=(0,l.Ue)();class I extends v{constructor(e,t,i){super(),this.start=e,this.end=t,this.planeLike={start:(0,g.eR)(e),end:(0,g.eR)(t),type:i}}equals(e){return this===e||le(e)&&this.planeLike.type===e.planeLike.type&&(0,a.p)(this.start,e.start)&&(0,a.p)(this.end,e.end)}closestTo(e){const t=(0,g.by)();return(0,y.z9)(e,this.planeLike,t),t}closestEndTo(e){const{start:t,end:i}=this.planeLike;return Math.sign((0,s.AK)((0,s.$X)(L,i,t),(0,s.$X)(D,(0,g.eR)(e),t)))>0?this.end:this.start}getPlane(e=(0,p.Ue)()){const t=(0,a.c)(N,this.end);return t[2]+=1,(0,p.zk)(this.start,this.end,t,e)}getSlicePlane(e=(0,p.Ue)()){const{start:t,end:i,type:r}=this.planeLike;if(r===y.Jk.PLANE)return;const n=(0,a.i)(N,t[0],t[1],0),s=(0,a.i)(F,i[0],i[1],0),o=(0,a.d)(F,s,n);return(0,p.Yq)(n,o,e),e}}const L=(0,o.Ue)(),D=(0,o.Ue)(),N=(0,l.Ue)(),F=(0,l.Ue)();class U extends I{constructor(e,t){super(e,t,y.Jk.HALF_PLANE)}}class k extends I{constructor(e,t){super(e,t,y.Jk.PLANE)}}class z extends v{constructor(e,t){super(),this.sphere=(0,f.l)(e,t)}equals(e){return this===e||de(e)&&(0,f.m)(this.sphere,e.sphere)}closestTo(e){const t=(0,g.by)();return(0,f.p)(this.sphere,e,t),t}get center(){return(0,f.a)(this.sphere)}get radius(){return this.sphere[3]}}class B extends v{constructor(e,t,i){super(),this.start=e,this.end=t,this.getZ=i,this.planeLike={start:(0,g.eR)(e),end:(0,g.eR)(t),type:y.Jk.PLANE}}equals(e){return this===e||pe(e)&&(0,a.p)(this.start,e.start)&&(0,a.p)(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){const i=(0,g.by)();return(0,y.z9)(t,e.planeLike,i),i[2]=e.getZ(i[0],i[1])??fe,i}(this,e)}addIfOnTheGround(e,t){for(const i of t){const t=this.getZ(i[0],i[1])??0;(0,y.hA)(i[2],t)&&(i[2]=t,e.push(i))}}}class V extends v{constructor(e,t,i){super(),this._x=e,this._y=t,this._z=i}equals(e){return this===e||function(e){return e instanceof V}(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,t,i]){return(0,g.Ue)(this._x??e,this._y??t,this._z??i)}}class H extends v{constructor(e,t,i,r,n){super(),this._origin=e,this._spatialReference=t,this._distanceMeters=i,this._z=r,this._directionDegrees=n}equals(e){return this===e||function(e){return e instanceof H}(e)&&(0,s.I6)(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,t,i]){return(0,s.t8)(G,e,t),(0,s.I6)(G,this._origin)||this._applyDirectionAndDistance(G),(0,g.Ue)(G[0],G[1],this._z??i)}_applyDirectionAndDistance(e){if(null!=this._directionDegrees&&null!=this._distanceMeters)(0,d.TB)(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(null!=this._directionDegrees)!function(e,t,i,r,n){let{azimuth:s,distance:o}=(0,d.cA)(Z,t,r,n);s??=0;let a=o*Math.cos((s-i)*h.Yr);a=Math.max(0,a),(0,d.TB)(e,t,i,a,n)}(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(null!=this._distanceMeters){const{azimuth:t}=(0,d.cA)(j,this._origin,e,this._spatialReference);(0,d.TB)(e,this._origin,t??0,this._distanceMeters,this._spatialReference)}}}const G=[0,0],j=new d._q;const Z=new d._q;function q(e,t){if(ne(e)){const i=[];for(const r of e.constraints){const e=r.intersect(t);e&&i.push(e)}return re(i)}if(ne(t))return q(t,e);if(pe(e))return Q(e,t);if(pe(t))return Q(t,e);if(se(e)){const{point:i}=e;if(se(t))return(0,a.p)(i,t.point)?e:void 0;const r=t.closestTo(i);return(0,a.I)(r,i)?e:void 0}if(oe(e)){if(se(t))return q(t,e);if(oe(t))return te((0,y.Au)(e.lineLike,t.lineLike));if(ae(t))return W(e,t);if(le(t))return te((0,y.fK)(t.planeLike,e.lineLike));if(ce(t))return te((0,y.CJ)(e.lineLike,t.center,t.radius));if(he(t))return te((0,y.UG)(e.lineLike,t));if(ue(t))return function({lineLike:e},{center:t,radius:i}){const r=t[2];return te((0,y.CJ)(e,t,i).filter((e=>(0,y.hA)(e[2],r))))}(e,t);if(de(t))return function({lineLike:e},{sphere:t}){return te((0,f.n)(t,e.start,e.end))}(e,t)}else if(ae(e)){if(se(t)||oe(t))return q(t,e);if(ae(t))return function(e,t){return(0,y.hA)(e.z,t.z)?e:void 0}(e,t);if(le(t))return function({z:e},{planeLike:t}){const[i,r]=t.start,[n,s]=t.end,o=(0,g.al)(i,r,e),a=(0,g.al)(n,s,e);return t.type===y.Jk.PLANE?new x(o,a):new T(o,a)}(e,t);if(ce(t))return function(e,t){const[i,r]=t.center;return new E((0,g.al)(i,r,e.z),t.radius)}(e,t);if(he(t))return Y(e,t);if(ue(t))return function(e,t){return(0,y.hA)(t.center[2],e.z)?t:void 0}(e,t);if(de(t))return function(e,{center:t,radius:i}){const r=Math.abs(t[2]-e.z);if(r>i&&!(0,y.hA)(r,i))return;const n=(0,g.al)(t[0],t[1],e.z),s=Math.sqrt(i**2-r**2);return(0,y.hA)(s,0)?void 0:new E(n,s)}(e,t)}else if(le(e)){if(se(t)||oe(t)||ae(t))return q(t,e);if(le(t))return ee((0,y.Nn)(e.planeLike,t.planeLike));if(ce(t))return ee((0,y.SD)(e.planeLike,t.center,t.radius));if(he(t))return X(e,t);if(ue(t))return J(e,t);if(de(t))return K(e,t)}else if(ce(e)){if(se(t)||oe(t)||ae(t)||le(t))return q(t,e);if(ce(t))return ee((0,y.Yf)((0,g.eR)(e.center),e.radius,(0,g.eR)(t.center),t.radius));if(he(t))return;if(ue(t))return function(e,t){const i=(0,s.bI)((0,g.eR)(e.center),(0,g.eR)(t.center));return(0,y.hA)(i,0)&&(0,y.hA)(e.radius,t.radius)?t:ie((0,y.Yf)((0,g.eR)(e.center),e.radius,(0,g.eR)(t.center),t.radius),t.center[2])}(e,t);if(de(t))return}else if(he(e)){if(se(t)||oe(t)||ae(t)||le(t)||ce(t))return q(t,e);if(he(t))return;if(ue(t))return void t.asCircle();if(de(t))return}else if(ue(e)){if(se(t)||oe(t)||ae(t)||le(t)||ce(t)||he(t))return q(t,e);if(ue(t))return function(e,t){if(!(0,y.$7)(e.center,t.center))return;const i=(0,s.bI)((0,g.eR)(e.center),(0,g.eR)(t.center));return(0,y.hA)(i,0)&&(0,y.hA)(e.radius,t.radius)?e:ie((0,y.Yf)((0,g.eR)(e.center),e.radius,(0,g.eR)(t.center),t.radius),e.center[2])}(t,e);if(de(t))return}else if(de(e)){if(se(t)||oe(t)||ae(t)||le(t)||ce(t)||ue(t))return q(t,e);if(de(t))return}}const W=(()=>{const e=(0,p.Ue)();return(t,i)=>{const{start:r,end:n}=t;if((0,y.$7)(r,n)&&(0,y.hA)(r[2],i.z))return t;const s=(0,g.by)();return(0,p.fn)(i.getPlane(e),r,n,s)?new b(s):void 0}})();const $=(()=>{const e=(0,u.Ue)(),t=(0,l.Ue)(),i=(0,l.Ue)();return(r,s,o)=>{const{normal:u,center:h,radius:d}=s;(0,m._F)(u,t,i);const f=(0,p.st)(r),_=d*(0,a.f)(f,t),v=d*(0,a.f)(f,i);(0,c.s)(e,h[0],h[1],h[2],1);const w=(0,c.h)(r,e),x=Math.hypot(_,v),T=(0,y.hA)(x,0);if((0,y.hA)((0,p.TE)(r,h),0)){if(T)return s;if((0,y.hA)(d,0))return!o||(0,y.zf)(o,h)?new b((0,g.d9)(h)):void 0;(0,a.e)(t,f,u),(0,a.n)(t,t);const e=new Array,i=(0,l.d9)(h);(0,a.b)(i,i,t,d),o&&!(0,y.zf)(o,i)||e.push(i);const r=(0,l.d9)(h);return(0,a.b)(r,r,t,-d),o&&!(0,y.zf)(o,r)||e.push(r),te(e)}if(T)return;const C=-w/x;if(Math.abs(C)>1||(0,y.hA)(C,1))return;const S=Math.atan(_/v),E=(0,n.Kt)(C)-S,M=Math.PI-E,A=new Array,R=(0,l.Ue)();(0,a.b)(R,h,t,d*Math.cos(E)),(0,a.b)(R,R,i,d*Math.sin(E)),A.push(R);const O=(0,l.Ue)();return(0,a.b)(O,h,t,d*Math.cos(M)),(0,a.b)(O,O,i,d*Math.sin(M)),A.push(O),te(o?(0,y.rq)(o,A):A)}})();const Y=(()=>{const e=(0,p.Ue)();return(t,i)=>$(t.getPlane(e),i,i.slicePlane)})();const J=(()=>{const e=(0,p.Ue)();return(t,{center:i,radius:r})=>{const n=(0,y.SD)(t.planeLike,i,r),s=i[2];t.getSlicePlane(e);const o=new Array;for(const[t,i]of n){const r=[t,i,s];(0,y.zf)(e,r)&&o.push(r)}return te(o)}})(),X=(()=>{const e=(0,p.Ue)(),t=(0,p.Ue)();return(i,r)=>$(i.getPlane(e),r,i.getSlicePlane(t))})(),K=(()=>{const e=(0,p.Ue)();return(t,{center:i,radius:r})=>{const n=t.getPlane(e),s=(0,p.jH)(n,i),o=Math.abs(s);if(o>r&&!(0,y.hA)(o,r))return;const c=Math.sqrt(r**2-s**2);if((0,y.hA)(c,0)){const e=(0,g.by)();return(0,p.nF)(n,i,e),new b(e)}const u=(0,g.by)(),h=(0,l.d9)((0,p.st)(n));return(0,a.b)(u,i,h,s),new M(u,c,h,t.getSlicePlane())}})();function Q(e,t){const{planeLike:i,getZ:r}=e,n=new Array;if(se(t))e.addIfOnTheGround(n,(0,y.hm)(i,t.point));else if(oe(t))e.addIfOnTheGround(n,(0,y.fK)(i,t.lineLike));else if(ce(t))for(const[e,s]of(0,y.SD)(i,t.center,t.radius)){const t=r(e,s);null!=t&&n.push((0,l.al)(e,s,t))}else if(le(t)||pe(t))for(const[e,s]of(0,y.Nn)(i,t.planeLike)){const t=r(e,s)??fe;n.push((0,l.al)(e,s,t))}return te(n)}function ee(e){return re(e.map((([e,t])=>{const i=(0,g.al)(e,t,0),r=(0,g.al)(e,t,1);return new x(i,r)})))}function te(e){return re(e.map((e=>e?new b((0,g.uo)(e)):void 0)))}function ie(e,t){return te(e.map((([e,i])=>[e,i,t])))}function re(e){if(0!==e.length)return 1===e.length?e[0]??void 0:new C(e.filter(r.pC))}function ne(e){return e instanceof C}function se(e){return e instanceof b}function oe(e){return e instanceof w}function ae(e){return e instanceof O}function le(e){return e instanceof I}function ce(e){return e instanceof S}function ue(e){return e instanceof E}function he(e){return e instanceof M}function de(e){return e instanceof z}function pe(e){return e instanceof B}const fe=0},51633:(e,t,i)=>{i.d(t,{Ju:()=>y,SN:()=>g,Ue:()=>a,Vx:()=>v,aK:()=>_,al:()=>h,by:()=>l,d9:()=>d,eR:()=>u,hx:()=>f,j7:()=>m,s:()=>p,uo:()=>c});var r,n=i(81095),s=i(98196),o=i(83772);function a(e,t,i){return l(e,t,i)}function l(e=0,t=0,i=0){return(0,n.al)(e,t,i)}function c(e){return e}function u(e){return e}function h(e,t,i){return(0,n.al)(e,t,i)}function d(e){const[t,i,r]=e;return e.length>3?[t,i,r,e[3]]:[t,i,r]}function p(e){return e[3]=((e.length>3?e[3]:void 0)??r.NONE)|r.TARGET,e}function f(e){return Boolean(((e.length>3?e[3]:void 0)??r.NONE)&r.TARGET)}function m(e,t,{coordinateHelper:i,elevationInfo:r},n){return e?g(i.vectorToDehydratedPoint(e,b),t,r,n):null}function g(e,t,i,r=l()){return r[0]=e.x,r[1]=e.y,r[2]=e.z??0,null==t||("2d"===t.type?r[2]=0:r[2]=(0,o.vQ)(t,e,i,o.jG)??0),r}function y(e,t,i){return i?((0,s.y)(i,e[0],e[1],e[2],t),i):(0,s.T)(e[0],e[1],e[2],t)}function _(e,t,{z:i,m:r},n,a){const{spatialReference:l,elevationInfo:c}=n;let u;u=null==i&&null==r?void 0:null==t||"2d"===t.type?i??void 0:(0,o.zx)(t,e,l,o.jG,c)??0;const[h,d]=e;return a?(0,s.y)(a,h,d,u,l):a=(0,s.T)(h,d,u,l),null!=r&&(a.m=r,a.hasM=!0),a}function v(e,t,i,n,s=l()){const[a,c]=e;return s[0]=a,s[1]=c,e.length>3&&(s[3]=e[3]??r.NONE),"3d"!==i?.type?(s[2]=t.value,s):(s[2]=(0,o.O3)(i,a,c,t.value,n,t.elevationInfo,o.jG)??0,s)}!function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"}(r||(r={}));const b=(0,s.T)(0,0,0,null)},88878:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(36663),n=i(74396),s=i(41831),o=i(81977),a=(i(39994),i(13802),i(4157),i(40266));let l=class extends n.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new s.Z}};(0,r._)([(0,o.Cb)({constructOnly:!0})],l.prototype,"layer",void 0),(0,r._)([(0,o.Cb)()],l.prototype,"enabled",void 0),(0,r._)([(0,o.Cb)()],l.prototype,"updating",void 0),(0,r._)([(0,o.Cb)()],l.prototype,"availability",void 0),(0,r._)([(0,o.Cb)()],l.prototype,"sublayerSources",void 0),l=(0,r._)([(0,a.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],l);const c=l},50639:(e,t,i)=>{i.d(t,{c:()=>u});var r=i(36663),n=i(30936),s=i(82064),o=i(81977),a=i(40266);let l=class extends s.Z{constructor(){super(...arguments),this.enabled=!0}};(0,r._)([(0,o.Cb)({type:Boolean})],l.prototype,"enabled",void 0),l=(0,r._)([(0,a.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],l);let c=class extends s.Z{constructor(e){super(e),this.lineSnapper=new l,this.parallelLineSnapper=new l,this.rightAngleSnapper=new l,this.rightAngleTriangleSnapper=new l,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new n.Z([255,127,0]),this.orangeTransparent=new n.Z([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,r._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"lineSnapper",void 0),(0,r._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"parallelLineSnapper",void 0),(0,r._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleSnapper",void 0),(0,r._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleTriangleSnapper",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"shortLineThreshold",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"distance",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointThreshold",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"intersectionParallelLineThreshold",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"parallelLineThreshold",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"verticalLineThresholdMeters",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointOnLineThreshold",void 0),(0,r._)([(0,o.Cb)({type:n.Z,nonNullable:!0})],c.prototype,"orange",void 0),(0,r._)([(0,o.Cb)({type:n.Z,nonNullable:!0})],c.prototype,"orangeTransparent",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthReference",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthTarget",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"lineHintFadedExtensions",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"parallelLineHintWidth",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],c.prototype,"parallelLineHintLength",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"parallelLineHintOffset",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],c.prototype,"rightAngleHintSize",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],c.prototype,"rightAngleHintOutlineSize",void 0),(0,r._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"satisfiesConstraintScreenThreshold",void 0),c=(0,r._)([(0,a.j)("esri.views.interactive.snapping.Settings.Defaults")],c);const u=new c},20999:(e,t,i)=>{var r;i.d(t,{B:()=>r}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(r||(r={}))},97682:(e,t,i)=>{i.d(t,{N:()=>E});var r=i(36663),n=i(74396),s=i(67979),o=i(31355),a=(i(39994),i(78668)),l=i(76868),c=i(81977),u=(i(13802),i(4157),i(40266)),h=i(90472),d=i(83772),p=i(51633),f=i(50639),m=i(20999),g=i(8593),y=i(22519),_=i(1834),v=i(46455),b=i(36485),w=i(66200),x=i(45924),T=i(99182),C=i(16186),S=i(86);let E=class extends(o.Z.EventedMixin(n.Z)){constructor(e){super(e),this.options=new g.Z,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=M.MAIN}initialize(){this.addHandles([(0,l.watch)((()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:i,effectiveFeatureEnabled:r,effectiveGridEnabled:n}=this.options;return{selfEnabled:i,featureEnabled:r,gridEnabled:"2d"===this.view.type&&n,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}}),((e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=(0,s.vr)((i=>this._updateEngines(e,t,i)))}),l.syncAndInitial),(0,l.watch)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),l.sync)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach((e=>e.destroy())),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,i){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const r=this._engineCache,n=await Promise.allSettled([e.featureEnabled&&!r.has("feature")?this._createFeatureSnappingEngine(i):void 0,e.selfEnabled&&!r.has("self")?this._createSelfSnappingEngine(i):void 0,e.gridEnabled&&!r.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(const e of n)"fulfilled"===e.status&&e.value?.engine.destroy();else{for(const e of n)"fulfilled"===e.status&&e.value&&r.set(e.value.type,e.value.engine);this._engines=Array.from(r.values())}}async _createSelfSnappingEngine(e){const{SelfSnappingEngine:t}=await Promise.all([i.e(89067),i.e(78746)]).then(i.bind(i,51862));return(0,a.k_)(e),{type:"self",engine:new t({view:this.view,options:this.options})}}async _createGridSnappingEngine(e){const{view:t}=this;if("2d"!==t.type)return;const{GridSnappingEngine:r}=await i.e(99865).then(i.bind(i,99865));return(0,a.k_)(e),{type:"grid",engine:new r({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await i.e(53812).then(i.bind(i,53812));(0,a.k_)(e);const{view:r,options:n}=this,{spatialReference:s}=r;return{type:"feature",engine:new t({view:r,options:n,spatialReference:s})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const r=this._currentMainCandidate;if(null==r)return t;const n=this._selectUpdateInput(e);if(null==n)return t;const{spatialReference:s}=i,o=(0,h.project)(n,s);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=i,u=[],d=(0,p.SN)(o,a,l),f=r.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,f,i)||!R(r,i.drawConstraints))return this._resetSnappingState(),t;r.targetPoint=(0,p.s)(f),u.push(...r.hints);for(const e of this._currentOtherActiveCandidates)R(e,i.drawConstraints)&&(e.targetPoint=(0,p.s)(f),u.push(...e.hints));return null!=c&&this.addHandles(c.draw(u,{spatialReference:s,elevationInfo:P(i),view:a,selfSnappingZ:i.selfSnappingZ}),A),(0,p.aK)(f,a,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case M.MAIN:return e;case M.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=M.MAIN}_removeVisualization(){this.removeHandles(A)}async _snapSinglePoint({point:e,context:t,signal:i}){const{view:r}=this,{elevationInfo:n}=t,s=(0,p.SN)(e,r,n),o=await this._fetchCandidates(s,m.B.ALL,t,i);return this._createSnapResult(s,M.MAIN,o,r,e,t,i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:r}){const{view:n}=this,{coordinateHelper:s,elevationInfo:o,spatialReference:a}=i;await(0,h.initializeProjection)(t.spatialReference,a);const l=(0,h.project)(t,a),c=(0,p.SN)(l,n,o),u=await this._fetchCandidates(c,m.B.FEATURE,i,r);if(u.length>0){const e=await this._fetchCandidates(c,m.B.SELF,i,r);return this._createSnapResult(c,M.SCENE,[...u,...e],n,l,i,r)}const d=(0,p.SN)(e,n,o),f=await this._fetchCandidates(d,m.B.SELF,i,r);return this._createSnapResult(d,M.MAIN,f,n,{z:s.hasZ()&&e.hasZ?e.z??0:void 0,m:s.hasM()&&e.hasM?e.m??0:void 0},i,r)}async _fetchCandidates(e,t,i,r){return(await Promise.all(this._engines.map((n=>n.fetchCandidates(e,t,i,r))))).flat()}_createSnapResult(e,t,i,r,n,s,o){return{get valid(){return!(0,a.Hc)(o)},apply:()=>{const{spatialReference:o}=s,{snappedPoint:a,hints:l}=this._processCandidates(e,t,i,s);return this._removeVisualization(),null!=s.visualizer&&this.addHandles(s.visualizer.draw(l,{spatialReference:o,elevationInfo:d.jG,view:r,selfSnappingZ:s.selfSnappingZ}),A),(0,p.aK)(a,r,n,s)}}}_processCandidates(e,t,i,r){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,y.lQ)(e,i);const n=this._currentMainCandidate;if(null!=n){const s=function(e,t){return e instanceof b.m?O(t,e.first)>=0&&O(t,e.second)>=0?0:-1:O(t,e)}(n,i);if(s>=0){if(!(i[s]instanceof b.m))return this._intersectWithOtherCandidates(s,i,e,t,r);if(this._arePointsWithinScreenThreshold(e,n.targetPoint,r))return this._updateSnappingCandidate(n,t,i,r)}}return this._intersectWithOtherCandidates(0,i,e,t,r)}_intersectWithOtherCandidates(e,t,i,r,n){const{coordinateHelper:s}=n,o=t[e],a=[];for(let r=0;r<t.length;++r){if(r===e)continue;const n=t[r],l=o.constraint.intersect(n.constraint);if(l)for(const e of l.closestPoints(o.targetPoint))a.push([new b.m((0,p.s)(e),o,n,n.isDraped),this._squaredScreenDistance(i,e,s)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(n.pointer))?this._updateSnappingCandidate(a[0][0],r,t,n):R(o,n.drawConstraints)?this._updateSnappingCandidate(o,r,t,n):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(e,t,i,r){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const n=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const t of i){if(e instanceof b.m){if(t.constraint.equals(e.first.constraint)||t.constraint.equals(e.second.constraint))continue}else if(t.constraint.equals(e.constraint))continue;const i=t.constraint.closestTo(n);this._squaredScreenDistance(i,n,r.coordinateHelper)<f.c.satisfiesConstraintScreenThreshold*f.c.satisfiesConstraintScreenThreshold&&(t.targetPoint=n,this._currentOtherActiveCandidates.push(t),s.push(...t.hints))}return{snappedPoint:n,hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,y.Bb)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,S.R)(e,t.spatialReference,d.jG,this.view)}get test(){}};var M;(0,r._)([(0,c.Cb)({constructOnly:!0})],E.prototype,"view",void 0),(0,r._)([(0,c.Cb)()],E.prototype,"options",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],E.prototype,"updating",null),(0,r._)([(0,c.Cb)()],E.prototype,"_loadTask",void 0),(0,r._)([(0,c.Cb)()],E.prototype,"_engines",void 0),(0,r._)([(0,c.Cb)()],E.prototype,"_squaredMouseProximityThreshold",null),(0,r._)([(0,c.Cb)()],E.prototype,"_squaredTouchProximityThreshold",null),E=(0,r._)([(0,u.j)("esri.views.interactive.snapping.SnappingManager")],E),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(M||(M={}));const A="visualization-handle";function R(e,t){return!t||null==t.direction&&null==t.distance||!(e instanceof _.k||e instanceof v.L||e instanceof w.u||e instanceof x.n||e instanceof C.K)&&(!(e instanceof T.A1)||null==t.direction&&e.selfSnappingType===T.dq.LastVertex)}function O(e,t){let i=-1;for(let r=0;r<e.length;++r)if(t.constraint.equals(e[r].constraint)){i=r;break}return i}function P({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?d.jG:t}},8593:(e,t,i)=>{i.d(t,{Z:()=>p});var r=i(36663),n=i(74396),s=i(7753),o=i(41831),a=i(13802),l=i(81977),c=(i(39994),i(40266)),u=i(88878),h=i(50639);let d=class extends n.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new o.Z,this.distance=h.c.distance,this.touchSensitivityMultiplier=h.c.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(f)&&a.Z.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(g),i=this._get("_effectiveFeatureSources")?.filter(f)??new o.Z;for(const e of t){const t=i.find((t=>t.layer===e.layer.parent));if(t)t.sublayerSources.includes(e)||t.sublayerSources.add(e);else if(e.layer.parent){const t=new u.Z({layer:e.layer.parent});t.sublayerSources.add(e),i.add(t)}}for(const e of i){const i=e.sublayerSources.filter((e=>!t.includes(e)));e.sublayerSources.removeMany(i)}i.removeMany(i.filter((e=>0===e.sublayerSources.length)));const r=e.filter(m),n=this._get("_effectiveFeatureSources")??new o.Z,{added:l,removed:c}=(0,s.e5)(n.toArray(),[...r,...i]);return n.removeMany(c),n.addMany(l),n}};(0,r._)([(0,l.Cb)()],d.prototype,"enabled",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"enabledToggled",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"forceDisabled",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"selfEnabled",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"featureEnabled",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"gridEnabled",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"attributeRulesEnabled",void 0),(0,r._)([(0,l.Cb)({type:o.Z.ofType(u.Z)})],d.prototype,"featureSources",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"distance",void 0),(0,r._)([(0,l.Cb)()],d.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],d.prototype,"effectiveEnabled",null),(0,r._)([(0,l.Cb)({readOnly:!0})],d.prototype,"effectiveGridEnabled",null),(0,r._)([(0,l.Cb)({readOnly:!0})],d.prototype,"effectiveSelfEnabled",null),(0,r._)([(0,l.Cb)({readOnly:!0})],d.prototype,"effectiveFeatureEnabled",null),(0,r._)([(0,l.Cb)({readOnly:!0})],d.prototype,"_effectiveFeatureSources",null),d=(0,r._)([(0,c.j)("esri.views.interactive.snapping.SnappingOptions")],d);const p=d;function f(e){return"subtype-group"===e.layer.type}function m(e){return"subtype-group"!==e.layer.type}function g(e){return"subtype-sublayer"===e.layer.type}},1834:(e,t,i)=>{i.d(t,{k:()=>a});var r=i(82308),n=i(22519),s=i(7062),o=i(65453);class a extends s.a{constructor(e){super({...e,isDraped:!0,constraint:new r.M8(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.w(n.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},46455:(e,t,i)=>{i.d(t,{L:()=>a});var r=i(82308),n=i(22519),s=i(7062),o=i(65453);class a extends s.a{constructor(e){super({...e,constraint:new r.ku(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.w(n.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},7062:(e,t,i)=>{i.d(t,{a:()=>s});var r=i(20999),n=i(72461);class s extends n.j{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:n}){super(e,i,n,r.B.FEATURE),this.objectId=t}}},36485:(e,t,i)=>{i.d(t,{m:()=>a});var r=i(82308),n=i(20999),s=i(72461),o=i(59282);class a extends s.j{constructor(e,t,i,s){super(e,new r.Hk(e),s,n.B.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new o.w(this.targetPoint,this.isDraped,this.domain)]}}},66200:(e,t,i)=>{i.d(t,{u:()=>l});var r=i(82308),n=i(20999),s=i(22519),o=i(72461),a=i(65453);class l extends o.j{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:o}){super(i,new r.jg(e,t),o,n.B.SELF),this._referenceLineHint=new a.w(s.ze.REFERENCE_EXTENSION,e,t,o,this.domain)}get hints(){return[this._referenceLineHint,new a.w(s.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}},45924:(e,t,i)=>{i.d(t,{n:()=>d});var r=i(86717),n=i(81095),s=i(82308),o=i(51633),a=i(20999),l=i(22519),c=i(72461),u=i(65453),h=i(23688);class d extends c.j{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:l}){const c=(0,n.d9)(t),{left:u,right:h}=e;(0,r.d)(c,(0,r.g)(c,c,h),u),super(i,new s.jg(t,(0,o.uo)(c)),l,a.B.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new u.w(l.ze.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new h.L(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new u.w(l.ze.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{(0,r.p)(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),(0,r.p)(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),(0,r.p)(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),(0,r.p)(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}},99182:(e,t,i)=>{i.d(t,{A1:()=>u,YJ:()=>r,dq:()=>n});var r,n,s=i(20999),o=i(22519),a=i(72461),l=i(65453),c=i(31367);class u extends a.j{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:r,otherVertexType:o,isDraped:a,selfSnappingType:l,objectId:c,domain:u}){super(e,t,a,u??s.B.SELF),this.previousVertex=i,this.otherVertex=r,this.otherVertexType=o,this.selfSnappingType=l??n.None,this.objectId=c??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===r.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===r.CENTER?this.targetPoint:this.otherVertex;return[new l.w(o.ze.TARGET,t,i,this.isDraped,this.domain),new l.w(o.ze.REFERENCE,e,t,this.isDraped,this.domain),new c.y(this.previousVertex,t,i,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(r||(r={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(n||(n={}))},16186:(e,t,i)=>{i.d(t,{K:()=>p});var r=i(36531),n=i(86717),s=i(81095),o=i(82308),a=i(51633),l=i(20999),c=i(22519),u=i(72461),h=i(65453),d=i(31367);class p extends u.j{constructor({targetPoint:e,point1:t,point2:i,isDraped:c}){super(e,new o.kt((0,a.uo)((0,n.m)((0,s.Ue)(),t,i,.5)),.5*(0,r.TE)((0,a.eR)(t),(0,a.eR)(i))),c,l.B.SELF),this._p1=t,this._p2=i}get hints(){return[new h.w(c.ze.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new h.w(c.ze.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new d.y(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}},72461:(e,t,i)=>{i.d(t,{j:()=>r});class r{constructor(e,t,i,r){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=r}}},59282:(e,t,i)=>{i.d(t,{w:()=>o});var r=i(86717),n=i(20999),s=i(9650);class o extends s.r{constructor(e,t,i=n.B.ALL){super(t,i),this.intersectionPoint=e}equals(e){return e instanceof o&&(0,r.p)(this.intersectionPoint,e.intersectionPoint)}}},65453:(e,t,i)=>{i.d(t,{w:()=>o});i(39994),i(13802);var r=i(86717),n=i(20999),s=i(9650);class o extends s.r{constructor(e,t,i,r,s=n.B.ALL,o=!0,a=!0){super(r,s),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&(0,r.p)(this.lineStart,e.lineStart)&&(0,r.p)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,r.j)(this.lineStart,this.lineEnd)}}},23688:(e,t,i)=>{i.d(t,{L:()=>o});i(39994),i(13802);var r=i(86717),n=i(20999),s=i(9650);class o extends s.r{constructor(e,t,i,r=n.B.ALL){super(i,r),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof o&&(0,r.p)(this.lineStart,e.lineStart)&&(0,r.p)(this.lineEnd,e.lineEnd)}}},31367:(e,t,i)=>{i.d(t,{y:()=>o});i(39994),i(13802);var r=i(86717),n=i(20999),s=i(9650);class o extends s.r{constructor(e,t,i,r,s=n.B.ALL){super(r,s),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof o&&(0,r.p)(this.previousVertex,e.previousVertex)&&(0,r.p)(this.centerVertex,e.centerVertex)&&(0,r.p)(this.nextVertex,e.nextVertex)}}},9650:(e,t,i)=>{i.d(t,{r:()=>r});class r{constructor(e,t){this.isDraped=e,this.domain=t}}},22519:(e,t,i)=>{i.d(t,{Bb:()=>m,Ob:()=>x,Ry:()=>f,_j:()=>b,fG:()=>g,lQ:()=>y,n0:()=>T,rh:()=>v,ze:()=>_});var r=i(76868),n=i(19784),s=i(84684),o=i(807),a=i(86717),l=i(98196),c=i(14626),u=i(97737),h=i(41775),d=i(51633),p=i(96726);const f=Symbol("grid-placement-graphic");function m(e,t){const i=e.x-t.x,r=e.y-t.y;return i*i+r*r}function g(e,t){return Math.sqrt(m(e,t))}function y(e,t){t.sort(((t,i)=>(0,a.s)(t.targetPoint,e)-(0,a.s)(i.targetPoint,e)))}var _;function v({point:e,distance:t,returnEdge:i,vertexMode:r,coordinateHelper:{spatialReference:a},filter:u},h,d){return d=null!=d?d.clone():new c.Z({where:"1=1"}),u&&(d.geometry=u.geometry,d.distance=u.distance,d.spatialRelationship=u.spatialRelationship,d.where=(0,s._$)(d.where,u.where),d.timeExtent=(0,o.Ov)(d.timeExtent,u.timeExtent),d.objectIds=function(e,t){return e||t?t?e?Array.from((0,n.jV)(new Set(e),new Set(t))):t:e:null}(d.objectIds,u.objectIds)),{point:(0,l.T)(e[0],e[1],e[2],a.toJSON()),mode:h,distance:t,returnEdge:i,vertexMode:r,query:d.toJSON()}}function b(e,t,i){return{left:(0,d.j7)(e.leftVertex.pos,t,i),right:(0,d.j7)(e.rightVertex.pos,t,i)}}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(_||(_={}));const w=Symbol("snapping-toggle");function x(e,t=(()=>{})){const i=(0,r.watch)((()=>({view:e.view,snappingOptions:e.snappingOptions})),(({view:i,snappingOptions:r})=>{if(e.removeHandles(w),!i||!r)return;const n=u.f.TOOL,s=[i.on("key-down",(e=>{e.key!==h.Kj.toggle||e.repeat||(r.enabledToggled=!0,t())}),n),i.on("key-up",(e=>{e.key===h.Kj.toggle&&(r.enabledToggled=!1,t())}),n),i.on("pointer-move",(e=>{const i=e.native.ctrlKey;r.enabledToggled!==i&&(r.enabledToggled=i,t())}),n)];e.addHandles(s,w)}),r.syncAndInitial);e.addHandles(i)}function T(e){return(0,p.s)(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}},86:(e,t,i)=>{i.d(t,{R:()=>a});var r=i(95550),n=i(81095),s=i(98196),o=i(6533);function a(e,t,i,n){return"2d"===n.type?(l.x=e[0],l.y=e[1],l.spatialReference=t,n.toScreen(l)):((0,o.R)(e,t,i,n,c),n.state.camera.projectToScreen(c,u),(0,r.vW)(u[0],u[1]))}const l=(0,s.T)(0,0,0,null),c=(0,n.Ue)(),u=(0,r.s1)()},59439:(e,t,i)=>{i.d(t,{V5:()=>s,e7:()=>n,zc:()=>o});var r=i(14845);async function n(e,t=e.popupTemplate){if(null==t)return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:n}=t,{objectIdField:s,typeIdField:o,globalIdField:a,relationships:l}=e;if(i.includes("*"))return["*"];const c=n?(0,r.CH)(e):[],u=(0,r.Q0)(e.fieldsIndex,[...i,...c]);return o&&u.push(o),u&&s&&e.fieldsIndex?.has(s)&&!u.includes(s)&&u.push(s),u&&a&&e.fieldsIndex?.has(a)&&!u.includes(a)&&u.push(a),l&&l.forEach((t=>{const{keyField:i}=t;u&&i&&e.fieldsIndex?.has(i)&&!u.includes(i)&&u.push(i)})),u}function s(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function o(e,t){return null!=s(e,{defaultPopupTemplateEnabled:t})}},43761:(e,t,i)=>{i.d(t,{e:()=>s});var r=i(78668),n=i(44883);async function s(e){const t=i.e(12030).then(i.bind(i,12030)),s=i.e(49110).then(i.bind(i,49110)),o=(0,n.t)((await t).default,{signal:e}),a=(0,n.t)((await s).default,{signal:e}),l={mask:await o,overlay:await a};return(0,r.k_)(e),l}},20296:(e,t,i)=>{i.d(t,{J:()=>r});class r{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const t=this.computeDelta(e);this._updateDelta(t)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(e){return void 0===this.lastValue?NaN:e-this.lastValue}_updateDelta(e){void 0!==this.filteredDelta?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}}},98120:(e,t,i)=>{i.d(t,{X:()=>r});class r{constructor(e,t,i){this._initialVelocity=e,this._stopVelocity=t,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,t){const i=this.value(e);return this.value(e+t)-i}valueFromInitialVelocity(e,t){t=Math.min(t,this.duration);const i=1-this.friction;return e*(i**t-1)/Math.log(i)}}},90903:(e,t,i)=>{i.d(t,{s:()=>o});var r=i(19431),n=i(20296),s=i(98120);class o{constructor(e=2.5,t=.01,i=.95,r=12){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=i,this._maxVelocity=r,this.enabled=!0,this.value=new n.J(.8),this.time=new n.J(.3)}add(e,t){if(this.enabled&&null!=t){if(this.time.hasLastValue()){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta()){const t=this.value.computeDelta(e);this.value.filteredDelta*t<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=(0,r.uZ)(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,t,i){return new s.X(e,t,i)}}},73578:(e,t,i)=>{i.d(t,{G:()=>l});var r=i(86717),n=i(81095),s=i(20296),o=i(98120);class a extends o.X{constructor(e,t,i,r,n){super(e,t,i),this._sceneVelocity=r,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}}class l{constructor(e=300,t=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=i,this.enabled=!0,this._time=new s.J(.6),this._screen=[new s.J(.4),new s.J(.4)],this._scene=[new s.J(.6),new s.J(.6),new s.J(.6)],this._tmpDirection=(0,n.Ue)()}add(e,t,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(t[0]),this._scene[1].update(t[1]),this._scene[2].update(t[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,i=null==e||null==t?0:Math.sqrt(e*e+t*t),r=this._time.filteredDelta,n=null==r||null==i?0:i/r;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,t,i){(0,r.i)(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=(0,r.l)(this._tmpDirection);n>0&&(0,r.h)(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new a(e,t,i,null==s?0:n/s,this._tmpDirection)}}},48991:(e,t,i)=>{i.d(t,{y:()=>n});var r=i(90903);class n extends r.s{constructor(e=3,t=.01,i=.95,r=12){super(e,t,i,r)}add(e,t){const i=this.value.lastValue;if(null!=i){let t=e-i;for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;e=i+t}super.add(e,t)}}},5672:(e,t,i)=>{i.d(t,{D:()=>o});var r=i(98120),n=i(90903);class s extends r.X{constructor(e,t,i){super(e,t,i)}value(e){const t=super.value(e);return Math.exp(t)}valueDelta(e,t){const i=super.value(e),r=super.value(e+t)-i;return Math.exp(r)}}class o extends n.s{constructor(e=2.5,t=.01,i=.95,r=12){super(e,t,i,r)}add(e,t){super.add(Math.log(e),t)}createMomentum(e,t,i){return new s(e,t,i)}}},67235:(e,t,i)=>{i.d(t,{Ac:()=>o,CN:()=>l,En:()=>u,Ke:()=>f,NU:()=>a,SQ:()=>n,b:()=>h,hG:()=>p,j2:()=>s,oH:()=>c,x:()=>d});var r=i(30936);const n=new r.Z("cyan"),s=1,o=.25,a=new r.Z("black"),l=.4,c=.2,u=.25,h="default",d="temporary",p=new r.Z("yellow"),f=8},57761:(e,t,i)=>{i.d(t,{Z:()=>h});var r,n=i(36663),s=i(30936),o=i(74396),a=i(81977),l=(i(39994),i(13802),i(4157),i(40266)),c=i(67235);let u=r=class extends o.Z{constructor(e){super(e),this.name=c.b,this.color=c.SQ.clone(),this.haloColor=null,this.haloOpacity=c.j2,this.fillOpacity=c.Ac,this.shadowColor=c.NU.clone(),this.shadowOpacity=c.CN,this.shadowDifference=c.oH,this.haloWidth=2.1,this.haloBlur=.8/this.haloWidth}equals(e){return this.color.equals(e.color)&&(this.haloColor||this.color).equals(e.haloColor||e.color)&&this.haloOpacity===e.haloOpacity&&this.fillOpacity===e.fillOpacity&&this.haloWidth===e.haloWidth&&this.haloBlur===e.haloBlur&&this.shadowColor.equals(e.shadowColor)&&this.shadowOpacity===e.shadowOpacity&&this.shadowDifference===e.shadowDifference}clone(){return new r({...this,color:this.color.clone(),haloColor:this.haloColor?.clone(),shadowColor:this.shadowColor?.clone()})}assignFrom(e){this.color=e.color.clone(),this.haloColor=e.haloColor?.clone(),this.haloOpacity=e.haloOpacity,this.fillOpacity=e.fillOpacity,this.shadowColor=e.shadowColor.clone(),this.shadowDifference=e.shadowDifference,this.shadowOpacity=e.shadowOpacity,this.haloBlur=e.haloBlur,this.haloWidth=e.haloWidth}};(0,n._)([(0,a.Cb)({type:String,constructOnly:!0,nonNullable:!0})],u.prototype,"name",void 0),(0,n._)([(0,a.Cb)({type:s.Z,nonNullable:!0})],u.prototype,"color",void 0),(0,n._)([(0,a.Cb)({type:s.Z})],u.prototype,"haloColor",void 0),(0,n._)([(0,a.Cb)({nonNullable:!0})],u.prototype,"haloOpacity",void 0),(0,n._)([(0,a.Cb)({nonNullable:!0})],u.prototype,"fillOpacity",void 0),(0,n._)([(0,a.Cb)({type:s.Z,nonNullable:!0})],u.prototype,"shadowColor",void 0),(0,n._)([(0,a.Cb)({nonNullable:!0})],u.prototype,"shadowOpacity",void 0),(0,n._)([(0,a.Cb)({nonNullable:!0})],u.prototype,"shadowDifference",void 0),(0,n._)([(0,a.Cb)({nonNullable:!0})],u.prototype,"haloWidth",void 0),(0,n._)([(0,a.Cb)({nonNullable:!0})],u.prototype,"haloBlur",void 0),u=r=(0,n._)([(0,l.j)("esri.views.support.HighlightOptions")],u);const h=u},13727:(e,t,i)=>{i.d(t,{L:()=>s});var r=i(2497),n=i(81509);class s{constructor(e,t){this._owner=t,this._properties={},this._afterDispatchHandle=null;for(const t in e){const i=e[t],n=new r.e(i,void 0,void 0,2,2);this._properties[t]={pool:n,acquired:[]}}this._afterDispatchHandle=(0,n.Fs)((()=>this._release()))}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const t=this._properties[e];for(const e of t.acquired)(0,n.NC)(e)||t.pool.release(e);t.pool.destroy(),t.pool=null,t.acquired=null}this._properties=null,this._owner=null}get(e){const t=this._owner._get(e),i=this._properties[e];let r=i.pool.acquire();for(i.acquired.push(r);r===t;)i.acquired.push(r),r=i.pool.acquire();return r}_release(){for(const e in this._properties){const t=this._properties[e];let i=0;for(const e of t.acquired)(0,n.NC)(e)?t.acquired[i++]=e:t.pool.release(e);t.acquired.length=i}}}},22855:(e,t,i)=>{var r;i.d(t,{n:()=>r}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(r||(r={}))},86111:(e,t,i)=>{i.d(t,{c:()=>u});i(39994);var r=i(61681),n=i(78668),s=i(58713),o=i(20230),a=i(17262),l=i(18809);class c{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class u{constructor(e){this._schedule=null,this._task=null,this._deferreds=new o.Z,this._controllers=new o.Z,this._processingItems=new o.Z,this._pausedSignal=(0,l.t)(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new s.Z(e.peeker),this.process=e.process;const t=e.scheduler;e.priority&&t&&(this._task=t.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=(0,r.hw)(this._schedule),this._task=(0,r.hw)(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach((t=>e.push(t))),this._controllers.clear(),e.forEach((e=>e.abort())),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach(((t,i)=>e(i)))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const i=this.get(e);if(i)return i;const r=new AbortController;let s=null;t&&(s=(0,n.fu)(t,(()=>r.abort())));const o=()=>{a.remove(),null!=s&&s.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},a=(0,n.$F)(r.signal,(()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),o(),l.reject((0,n.zE)())})),l=(0,n.hh)();return this._deferreds.set(e,l),this._controllers.set(e,r),l.promise.then(o,o),this._queue.push(e),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject((0,n.zE)()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=(0,a.Os)((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const i=new AbortController,r=new c(e,i);this._processingItems.set(e,r);try{t=this.process(e,i.signal)}catch(e){this._processError(r,e)}(0,n.y8)(t)?(r.promise=t,t.then((e=>this._processResult(r,e)),(e=>this._processError(r,e)))):this._processResult(r,t)}get test(){}}},22167:(e,t,i)=>{i.d(t,{G5:()=>M,T8:()=>r,sq:()=>A,z4:()=>y});var r,n=i(44584),s=(i(39994),i(13802)),o=i(61681),a=i(31168),l=i(17135),c=i(78668),u=i(76868),h=i(18809),d=i(12928),p=i(253),f=i(16407),m=i(22855),g=i(14169);function y(){return new S.Scheduler}!function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e.MAPVIEW_FETCH_QUEUE="mapview fetch queue",e.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",e.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",e[e.NONE=0]="NONE",e[e.TEST_PRIO=1]="TEST_PRIO"}(r||(r={}));const _=new Map([[r.RESOURCE_CONTROLLER_IMMEDIATE,0],[r.RESOURCE_CONTROLLER,4],[r.SLIDE,0],[r.STREAM_DATA_LOADER,0],[r.ELEVATION_QUERY,0],[r.TERRAIN_SURFACE,1],[r.SURFACE_GEOMETRY_UPDATES,1],[r.LOD_RENDERER,2],[r.GRAPHICS_CORE,2],[r.I3S_CONTROLLER,2],[r.POINT_CLOUD_LAYER,2],[r.FEATURE_TILE_FETCHER,2],[r.CLOUDS_GENERATOR,2],[r.OVERLAY,4],[r.STAGE,4],[r.GRAPHICS_DECONFLICTOR,4],[r.FILTER_VISIBILITY,4],[r.SCALE_VISIBILITY,4],[r.FRUSTUM_VISIBILITY,4],[r.POINT_OF_INTEREST_FREQUENT,6],[r.POINT_OF_INTEREST_INFREQUENT,30],[r.LABELER,8],[r.FEATURE_QUERY_ENGINE,8],[r.FEATURE_TILE_TREE,16],[r.FEATURE_TILE_TREE_ACTIVE,0],[r.ELEVATION_ALIGNMENT,12],[r.ELEVATION_ALIGNMENT_SCENE,14],[r.TEXT_TEXTURE_ATLAS,12],[r.TEXTURE_UNLOAD,12],[r.LINE_OF_SIGHT_TOOL,16],[r.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[r.SNAPPING,0],[r.SHADOW_ACCUMULATOR,30],[r.MAPVIEW_FETCH_QUEUE,0],[r.MAPVIEW_LAYERVIEW_UPDATE,2],[r.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function v(e){return _.has(e)?_.get(e):"number"==typeof e?e:1}const b=(0,d.HA)(6.5),w=(0,d.HA)(1),x=(0,d.HA)(30),T=(0,d.HA)(1e3/30),C=(0,d.HA)(100);var S,E;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,h.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new a.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=m.n.INTERACTING,this._tasks=new l.Z,this._runQueue=new l.Z,this._load=0,this._idleStateCallbacks=new l.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,u.watch)((()=>f.Z.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),u.initial);for(const e of Object.keys(r))this.performanceInfo.tasks.set(r[e],new a.Z(r[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,o.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())})))}registerTask(e,i){const r=new t(this,e,i);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new a.Z(e)),r}registerIdleStateCallbacks(e,t){const i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),this.state===m.n.IDLE&&this._idleUpdatesStartFired&&i.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(i),set idleBegin(e){r._idleUpdatesStartFired&&(i.idleEnd(),r._state===m.n.IDLE&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==m.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=b,i=e.frameDuration,r=w;switch(this.state){case m.n.IDLE:t=(0,d.HA)(0),i=(0,d.HA)(Math.max(C,e.frameDuration)),r=x;break;case m.n.INTERACTING:i=(0,d.HA)(Math.max(T,e.frameDuration));case m.n.ANIMATING:}return i=(0,d.HA)(i-e.elapsedFrameTime-t),this.state!==m.n.IDLE&&i<w&&!this._forceTask?(this._forceTask=!0,!1):(i=(0,d.HA)(Math.max(i,r)),this._budget.reset(i,this.state),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case m.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case m.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset((0,d.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return E.SCHEDULED;let t=E.IDLE;return this._tasks.forAll((i=>{i.name===e&&i.needsUpdate&&(i.schedulePriority<=1?t=E.READY:t!==E.READY&&(t=E.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((i=>{i.name===e&&(t+=i.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,i)=>{t+=e>1?` ${e}x ${i}`:` ${i}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((i=>{i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&i.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,this._runQueue.push(i)):--i.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const e=this._budget.now(),t=this._runQueue.pop();this._budget.resetProgress();try{t.task.runTask(this._budget)===g.J&&(t.blockFrame=this._frameNumber)}catch(e){s.Z.getLogger("esri.views.support.Scheduler").error(`Exception in task "${t.name}"`,e),t.blockFrame=this._frameNumber}!this._budget.hasProgressed&&t.blockFrame!==this._frameNumber&&t.needsUpdate&&(t.name,r.I3S_CONTROLLER,t.blockFrame=this._frameNumber),t.schedulePriority=t.basePriority;const i=this._budget.now()-e;if(t.runtime+=i,this._frameTaskTimes.set(t.priority,this._frameTaskTimes.get(t.priority)+i),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(r))this._frameTaskTimes.set(r[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).push(e))),this.performanceInfo.total.push(e)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,i){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new p.b,this._handles=new n.Z,this._basePriority=v(t),this.schedulePriority=this._basePriority,this._task=(0,h.t)(null!=i?i:this._queue),this._handles.add((0,u.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(M),this._scheduler.removeTask(this),this.schedule=A.schedule,this.reschedule=A.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=v(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,i){return this._queue.push(e,t,i)}reschedule(e,t,i){return this._queue.unshift(e,t,i)}processQueue(e){return this._queue.runTask(e)}}class i{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=m.n.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=i}(S||(S={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(E||(E={}));const M=(()=>{const e=new S.Budget;return e.enabled=!1,e})();const A=new class{remove(){}processQueue(){}schedule(e,t,i){try{if((0,c.Hc)(t)){const e=(0,c.zE)();return i?Promise.resolve(i(e)):Promise.reject(e)}return(0,c.gx)(e(M))}catch(e){return Promise.reject(e)}}reschedule(e,t,i){return this.schedule(e,t,i)}}},14169:(e,t,i)=>{i.d(t,{J:()=>r});const r=Symbol("Yield")},92772:(e,t,i)=>{i.d(t,{Ci:()=>v,LH:()=>w,Lm:()=>f,d3:()=>b,ib:()=>T,n6:()=>g,uE:()=>r,yd:()=>x,zS:()=>y});var r,n=i(16068),s=i(39405),o=i(17321),a=i(36531),l=i(84164),c=i(86717),u=i(81095),h=i(49757),d=i(85130),p=i(35925);function f(e,t){if(null==e||null==t)return;const i=m(e,t);return null!=i?(0,s.GJ)(i,"radians","geographic"):void 0}!function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"}(r||(r={}));const m=(()=>{const e=(0,u.Ue)(),t=(0,u.Ue)();return(i,r)=>((0,c.i)(e,i.x,i.y,i.z??0),(0,c.i)(t,r.x,r.y,r.z??0),g(e,t,i.spatialReference,r.spatialReference))})(),g=(()=>{const e=(0,l.Ue)(),t=(0,u.Ue)(),i=(0,u.Ue)();return(r,n,s,u)=>{if((0,c.p)(r,n))return;const f=(0,d.Lc)(s),m=(0,d.Lc)(u);if(f&&m&&(0,p.fS)(f,m)&&(0,h.S)(r,s,t,f)&&(0,h.S)(n,u,i,m)){const{azimuth:e}=(0,d.cA)(S,t,i,f);return null!=e?(0,o.En)(e,"degrees","radians"):void 0}e[0]=n[0]-r[0],e[1]=n[1]-r[1];let g=(0,a.EU)(l.IO,e);return e[0]<0&&(g=E-g),g}})();function y(e,t,i,n=r.Absolute){if(t&&i)switch(n){case r.Absolute:return f(t,i);case r.Relative:return v(_(e,t,i),r.Relative);case r.RelativeBilateral:return v(_(e,t,i),r.RelativeBilateral)}}function _(e,t,i){if(!e||!t||!i)return;const r=m(e,t),n=m(t,i);return null!=r&&null!=n?(0,s.GJ)(n-r,"radians","geographic"):void 0}function v(e,t){if(null!=e)switch(t){case r.Absolute:return b(e);case r.Relative:{const t=x(e);let i=A.normalize(t,0,!0);return-180===i&&(i=180),(0,s.GJ)(i,"degrees","geographic")}case r.RelativeBilateral:{const t=x(e),i=Math.abs(A.normalize(t,0,!0));return(0,s.GJ)(i,"degrees","geographic")}}}function b(e){const t=x(e),i=M.normalize(t,0,!0);return(0,s.GJ)(i,"degrees","geographic")}const w=(()=>{const e=(0,u.Ue)();return(t,i,r,n,a,l="geodesic")=>{(0,c.c)(e,i);const u=x(a);if("geodesic"===l){const s=(0,d.Lc)(r);if(s&&(0,h.S)(e,r,e,s))return(0,d.TB)(t,e,u,n,s),t[2]=i[2],!!(0,h.S)(t,s,t,r)}const p=(0,s.hw)(u,"geographic","arithmetic"),f=(0,o.En)(p,"degrees","radians"),m=i[0]+n*Math.cos(f),g=i[1]+n*Math.sin(f),y=i[2];return(0,c.i)(t,m,g,y),!0}})();function x(e){if(null!=e)return(0,s.hw)(C(e),e.rotationType,"geographic")}function T(e){if(null!=e)return(0,s.hw)(C(e),e.rotationType,"arithmetic")}function C(e){return(0,o.En)(e.value,e.unit,"degrees")}const S=new d._q,E=2*Math.PI,M=n.BV,A=new n.pE(-180,180)},16407:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(36663),n=i(74396),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));let a=class extends n.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,r._)([(0,s.Cb)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,r._)([(0,s.Cb)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,r._)([(0,o.j)("esri.views.support.debugFlags")],a);const l=new a},23440:(e,t,i)=>{i.d(t,{SP:()=>r,UG:()=>u,dU:()=>c,k0:()=>a,xO:()=>l});i(19431);var r,n=i(36531),s=i(84164);function o(e,t){return e[0]*t[1]-e[1]*t[0]}function a(e,t,i,r,s=i){return(0,n.$X)(d,r,i),(0,n.$X)(f,t,s),function(e,t,i){const r=(0,n.AK)(i,t)/(0,n.we)(i);(0,n.bA)(e,i,r)}(m,f,d),(0,n.IH)(e,s,m)}function l(e,t,i,r){(0,n.$X)(d,t,i);const s=r/(0,n.kE)(d);return(0,n.od)(e,i,d,s)}function c(e,t){const i=e.start,s=e.end,a=t.start,l=t.end,c=(0,n.$X)(d,s,i),u=(0,n.$X)(p,l,a),g=o(c,u);if(Math.abs(g)<=h)return[];const y=(0,n.$X)(f,i,a),_=o(u,y)/g,v=o(c,y)/g;if(_>=0){if(v>=0||t.type===r.LINE)return[(0,n.od)(m,i,c,_)]}else if(e.type===r.LINE&&(v>=0||t.type===r.LINE))return[(0,n.od)(m,i,c,_)];return[]}function u(e,t,i){const s=[],o=(0,n.$X)(d,e.end,e.start),a=(0,n.$X)(p,e.start,t),l=(0,n.we)(o),c=2*(0,n.AK)(o,a),u=c*c-4*l*((0,n.we)(a)-i*i);if(0===u){const t=-c/(2*l);(e.type===r.LINE||t>=0)&&s.push((0,n.od)(m,e.start,o,t))}else if(u>0){const t=Math.sqrt(u),i=(-c+t)/(2*l);(e.type===r.LINE||i>=0)&&s.push((0,n.od)(m,e.start,o,i));const a=(-c-t)/(2*l);(e.type===r.LINE||a>=0)&&s.push((0,n.od)(f,e.start,o,a))}return s}!function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"}(r||(r={}));const h=1e-6,d=(0,s.Ue)(),p=(0,s.Ue)(),f=(0,s.Ue)(),m=(0,s.Ue)()},6271:(e,t,i)=>{i.d(t,{$7:()=>C,Au:()=>w,CJ:()=>b,Jk:()=>A,Nn:()=>m,SD:()=>d,UG:()=>v,Yf:()=>x,ZE:()=>_,fK:()=>p,hA:()=>S,hm:()=>f,rq:()=>E,sc:()=>y,z9:()=>g,zf:()=>M});var r=i(19431),n=i(36531),s=i(84164),o=i(86717),a=i(81095),l=i(40201),c=i(69430),u=i(35369),h=i(23440);function d({start:e,end:t,type:i},r,o){const a=[],l=(0,n.$X)(O,t,e),c=(0,n.$X)(P,e,r),u=(0,n.we)(l),h=2*(0,n.AK)(l,c),d=h*h-4*u*((0,n.we)(c)-o*o);if(0===d){const t=-h/(2*u);(i===A.PLANE||t>=0)&&a.push((0,n.od)((0,s.Ue)(),e,l,t))}else if(d>0){const t=Math.sqrt(d),r=(-h+t)/(2*u);(i===A.PLANE||r>=0)&&a.push((0,n.od)((0,s.Ue)(),e,l,r));const o=(-h-t)/(2*u);(i===A.PLANE||o>=0)&&a.push((0,n.od)((0,s.Ue)(),e,l,o))}return a}function p(e,t){const i=e.start,r=e.end,s=(0,n.$X)(O,r,i),c=(0,o.i)(L,-s[1],s[0],0),u=t.start,d=t.end,p=(0,o.a)(D,d,u),f=(0,o.f)(p,c),m=(0,o.i)(N,i[0],i[1],0),g=(0,o.a)(F,m,u),y=(0,o.f)(g,c),_=(0,l.bn)();if(Math.abs(f)<_)return Math.abs(y),[];const v=(0,o.b)(U,u,p,y/f);if(t.type===h.SP.RAY){const e=(0,o.a)(k,v,u);if((0,o.f)(e,p)<-_)return[]}if(e.type===A.HALF_PLANE){const e=(0,n.lu)(P,v,i);if((0,n.AK)(e,s)<-_)return[]}return[(0,a.d9)(v)]}function f(e,t){return function({start:e,end:t,type:i},r){const n=(0,o.a)(I,r,e),s=(0,o.a)(L,t,e),c=(0,o.e)(D,s,n),u=(0,o.z)(c)/(0,o.z)(s),d=(0,l.bn)();if(u<d)switch(i){case h.SP.LINE:return[(0,a.d9)(r)];case h.SP.RAY:return(0,o.f)(s,n)<-d?[]:[(0,a.d9)(r)]}return[]}(T(B,t[2],e),t)}function m(e,t){return w(T(B,0,e),T(V,0,t)).map((([e,t])=>(0,s.al)(e,t)))}function g(e,t,i){return _(e,T(B,e[2],t),i)}function y(e,t,i,r=(0,a.Ue)()){const s=(0,n.$X)(O,e,t),o=(0,n.kE)(s);return(0,n.od)(r,t,s,0===o?1:i/o),r[2]=e[2],r}function _(e,{start:t,end:i,type:r},n=(0,a.Ue)()){const s=(0,o.a)(I,e,t),l=(0,o.a)(L,i,t),c=(0,o.f)(s,l)/(0,o.f)(l,l);return(0,o.b)(n,t,l,r===h.SP.RAY?Math.max(c,0):c)}const v=(()=>{const e=(0,a.Ue)(),t=(0,a.Ue)(),i=(0,a.Ue)();return({start:r,end:l},{center:d,radius:p,normal:f,slicePlane:m})=>{const g=(0,c.Yq)(d,f,z);if(S((0,c.TE)(g,r),0)&&S((0,c.TE)(g,l),0)){(0,u._F)(f,e,t);const c=(r,s)=>((0,o.d)(i,s,d),(0,n.t8)(r,(0,o.f)(i,e),(0,o.f)(i,t)),r),g=(0,h.UG)({start:c(O,r),end:c(P,l),type:h.SP.LINE},s.AG,p),y=[];for(const[i,r]of g){const n=(0,o.c)((0,a.Ue)(),d);(0,o.b)(n,n,e,i),(0,o.b)(n,n,t,r),m&&!M(m,n)||y.push(n)}return y}const y=(0,a.Ue)();return(0,c.fn)(g,r,l,y)?!S((0,o.j)(y,d),p)||m&&!M(m,y)?[]:[y]:[]}})();function b({start:e,end:t,type:i},r,s){const l=[],c=(0,o.d)(I,t,e),u=(0,n.$X)(P,e,r),d=(0,n.we)(c),p=2*(0,n.AK)(c,u),f=p*p-4*d*((0,n.we)(u)-s*s);if(0===f){const t=-p/(2*d);(i===h.SP.LINE||t>=0)&&l.push((0,o.b)((0,a.Ue)(),e,c,t))}else if(f>0){const t=Math.sqrt(f),r=(-p+t)/(2*d);(i===h.SP.LINE||r>=0)&&l.push((0,o.b)((0,a.Ue)(),e,c,r));const n=(-p-t)/(2*d);(i===h.SP.LINE||n>=0)&&l.push((0,o.b)((0,a.Ue)(),e,c,n))}return l}function w(e,t){const i=e.start,r=e.end,n=t.start,s=t.end,c=(0,o.a)(I,r,i),u=(0,o.a)(L,s,n),d=(0,o.a)(D,n,i),p=(0,o.e)(N,c,u);if(!S((0,o.f)(d,p),0))return[];const f=(0,o.z)(p);if(S(f,0))return[];const m=(0,o.e)(F,d,u),g=(0,o.f)(m,p)/f,y=(0,o.b)(U,i,c,g);if(e.type===h.SP.RAY){const e=(0,o.a)(k,y,i);if((0,o.f)(c,e)<-(0,l.bn)())return[]}if(t.type===h.SP.RAY){const e=(0,o.a)(k,y,n);if((0,o.f)(u,e)<-(0,l.bn)())return[]}return[(0,a.d9)(y)]}function x(e,t,i,r){const[o,a]=e,[l,c]=i,u=l-o,h=c-a,d=u*u+h*h,p=Math.sqrt(d);if(p>t+r)return[];if(p<Math.abs(t-r))return[];if(S(p,0)&&S(t,r))return[];const f=(t*t-r*r+d)/(2*p),m=Math.sqrt(t*t-f*f),g=m*h/p,y=m*u/p,[_,v]=(0,n.t7)(O,e,i,f/p);return S(g,y)?[(0,s.al)(_,v)]:[(0,s.al)(_+g,v-y),(0,s.al)(_-g,v+y)]}function T(e,t,{start:i,end:r,type:n}){return(0,o.i)(e.start,i[0],i[1],t),(0,o.i)(e.end,r[0],r[1],t),e.type=R[n],e}function C(e,t){return S(e[2],t[2])}function S(e,t){return(0,r.W8)(Math.abs(e-t),0,(0,l.bn)())}function E(e,t){return t.filter((t=>M(e,t)))}function M(e,t){return(0,c.Ac)(e,t)}var A;!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(A||(A={}));const R={[A.PLANE]:h.SP.LINE,[A.HALF_PLANE]:h.SP.RAY},O=(0,s.Ue)(),P=(0,s.Ue)(),I=(0,a.Ue)(),L=(0,a.Ue)(),D=(0,a.Ue)(),N=(0,a.Ue)(),F=(0,a.Ue)(),U=(0,a.Ue)(),k=(0,a.Ue)(),z=(0,c.Ue)(),B={start:(0,a.Ue)(),end:(0,a.Ue)(),type:h.SP.LINE},V={start:(0,a.Ue)(),end:(0,a.Ue)(),type:h.SP.LINE}},19832:(e,t,i)=>{async function r(e,t){if("2d"===e.type)return e.hitTest(t);const i=await e.hitTest(t);if(0===i.results.length)return i;const r=i.results[0],s=(r.distance??0)*(1+n),o=i.results.findIndex((e=>(e.distance??0)>s));return-1!==o&&(i.results=i.results.slice(0,o)),r&&i.ground.distance>s&&(i.ground.mapPoint=null),i}i.d(t,{ZV:()=>r,qm:()=>o});const n=.05;function s(e){return"graphic"===e?.type}function o(e){return e.find(s)??null}},42780:(e,t,i)=>{i.d(t,{Av:()=>l,Cy:()=>c,GB:()=>a,_1:()=>s,lE:()=>u,rs:()=>o,tl:()=>n});var r=i(70375);function n(e){return e&&"function"==typeof e.highlight}function s(e){return e&&"function"==typeof e.maskOccludee}function o(e,t,i){return null==e||e>=i&&(0===t||e<=t)}function a(e,t){if(t&&e){const{minScale:i,maxScale:r}=e;if(l(i,r))return o(t,i,r)}return!0}function l(e,t){return null!=e&&e>0||null!=t&&t>0}function c(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale}function u(e,t,i){return new r.Z("layerview:spatial-reference-incompatible",`The spatial reference of this ${e}${t?`(wkid:${t})`:""} is incompatible with the spatial reference of the view${i?`(wkid:${i})`:""}.`,{})}},38114:(e,t,i)=>{i.d(t,{Eu:()=>o,Rw:()=>l,Sj:()=>s,s6:()=>a,vT:()=>n});i(39994);var r=i(95550);function n(e){return(0,r.vW)(e.x,e.y)}function s(e){return(0,r.s1)(e.x,e.y)}function o(e,t){const i=(e instanceof HTMLElement?e:e.surface)?.getBoundingClientRect();return i?(0,r.vW)(t.clientX-i.left,t.clientY-i.top):(0,r.vW)(0,0)}function a(e,t){return t instanceof Event?o(e,t):n(t)}function l(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}},994:(e,t,i)=>{i.r(t),i.d(t,{completeUserSettings:()=>s,createEmptyImageData:()=>n.r7,encode:()=>a,encodeData:()=>l,getFormatAndQuality:()=>p,getMaximumResolutionScale:()=>f,resampleHermite:()=>m,screenshotSuperSampleSettings:()=>g,toDataUrl:()=>d,toRenderSettings:()=>o});i(39994);var r=i(19431),n=i(8955);function s(e,t){const{format:i,quality:n,rotation:s,disableDecorations:o}=e||{},a=y(e,t.padding),l=function(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e?.area){null!=e.area.x&&(i.x=Math.floor(e.area.x)),null!=e.area.y&&(i.y=Math.floor(e.area.y));const r=null!=e.area.width?Math.floor(e.area.width):null,n=null!=e.area.height?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,null!=r&&null!=n)i.width=Math.min(i.width,r),i.height=Math.min(i.height,n);else if(null==r&&null!=n){const e=Math.min(i.width,r);i.height=e/i.width*i.height,i.width=e}else if(null!=r&&null==n){const e=Math.min(i.height,n);i.width=e/i.height*i.width,i.height=e}}return function(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),n={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},s=n.width/n.height,o=e.width/e.height;if(o===s)return n;if(o>s){const e=Math.floor(n.width/o),t=n.height-e;return{x:n.x,y:Math.floor(n.y+t/2),width:n.width,height:e}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}(function(e,t){if(null==t?.width||null==t.height)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const t=Math.floor(e.height*i);return e.x-=(t-e.width)/2,e.width=t,e}const n=Math.floor(e.width/i);return e.y-=(n-e.height)/2,e.height=n,e}(i,e),t)}(e,{width:t.width-a.left-a.right,height:t.height-a.top-a.bottom}),{width:c,height:u}=function(e,t){if(!e)return t;const i=e.width,r=e.height;if(null!=i&&null!=r)return{width:Math.floor(i),height:Math.floor(r)};if(null==i&&null==r)return t;const n=t.width/t.height;return null==r?{width:Math.floor(i),height:Math.floor(i/n)}:{width:Math.floor(r*n),height:Math.floor(r)}}(e,l),h=_(i),d=w[h];return{format:h,quality:(0,r.uZ)(null!=n?n:d,0,100),area:l,width:c,height:u,rotation:s,disableDecorations:!!o,ignoreBackground:!!e?.ignoreBackground,ignorePadding:!!e?.ignorePadding}}function o(e,t){const i=s(e,t),r=i.area,n=i.width/r.width,o=y(i,t.padding),a=o.left+o.right,l=o.top+o.bottom,c=t.width-a,u=t.height-l,h=Math.floor(c*n+a),d=Math.floor(u*n+l),p=e?.layers??[],f=i.ignoreBackground,m=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:d,region:{x:Math.floor(r.x*n)+o.left,y:Math.floor(r.y*n)+o.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:n,layers:p,disableDecorations:i.disableDecorations,ignoreBackground:f,ignorePadding:m,objectAndLayerIdColor:!1}}function a(e,t,i){const{ctx:r,canvas:n}=c(e,i),s=r.getImageData(0,0,e.width,e.height),o=d(n,t);return u(n),{dataUrl:o,data:s}}function l(e,t){const{ctx:i,canvas:r}=c(e,t),n=i.getImageData(0,0,e.width,e.height);return u(r),n}function c(e,t){const i=(null==h&&(h=document.createElement("canvas")),h);t.premultipliedAlpha&&function(e){const t=e.data,i=t.length;for(let e=0;e<i;e+=4){const i=t[e+3];if(255!==i&&i>0){const r=255/i;t[e]=t[e]*r,t[e+1]=t[e+1]*r,t[e+2]=t[e+2]*r}}}(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(e,0,0),t.flipY&&function(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}(r),{ctx:r,canvas:i}}function u(e){e.width=0,e.height=0}let h=null;function d(e,t){const i=v[t.format],r=t.quality/100;return e.toDataURL(i,r)}function p(e,t){const i=_(e),n=w[i];return{format:i,quality:(0,r.uZ)(null!=t?t:n,0,100)}}function f(e,t){return t/Math.max(e[0],e[1])}function m(e,t,i,r=0,n=0,s=e.width-r,o=e.height-n,a=!1){const{data:l}=e,{width:c,height:u,data:h}=t,d=s/c,p=o/u,f=Math.ceil(d/2),m=Math.ceil(p/2),g=e.width;for(let e=0;e<u;e++)for(let t=0;t<c;t++){const s=4*(t+(a?u-e-1:e)*c);let o=0,y=0,_=0,v=0,b=0,w=0;const x=(e+.5)*p;for(let s=Math.floor(e*p);s<(e+1)*p;s++){const e=Math.abs(x-(s+.5))/m,a=(t+.5)*d,c=e*e;for(let e=Math.floor(t*d);e<(t+1)*d;e++){const t=Math.abs(a-(e+.5))/f,u=Math.sqrt(c+t*t);if(u>=1)continue;let h=2*u*u*u-3*u*u+1;const d=4*(r+e+(n+s)*g);w+=h*l[d+3],y+=h,!i&&l[d+3]<255&&(h=h*l[d+3]/255),_+=h*l[d],v+=h*l[d+1],b+=h*l[d+2],o+=h}}h[s]=_/o,h[s+1]=v/o,h[s+2]=b/o,h[s+3]=w/y}return t}function g(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:n,pixelRatio:s,region:o}=e,a=y(e,i),l=a.left+a.right,c=a.top+a.bottom,u=r-l,h=n-c,d=Math.min(8,Math.min((2048-l)/u,(2048-c)/h));return d<1.5?e:{...e,framebufferWidth:Math.round(u*d)+l,framebufferHeight:Math.round(h*d)+c,pixelRatio:s*d,resample:{region:{x:Math.round((o.x-a.left)*d)+a.left,y:Math.round((o.y-a.top)*d)+a.top,width:Math.round(o.width*d),height:Math.round(o.height*d)},width:r,height:n}}}function y(e,t){return!t||e?.ignorePadding?x:t}function _(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return b}}const v={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},b="png",w={png:100,jpg:98,jpeg:98},x={top:0,right:0,bottom:0,left:0}},14029:(e,t,i)=>{i.d(t,{D:()=>s});var r=i(52345),n=i(65684);function s(e,t){return null!=e&&(null==t||(t===n.JY.Local?!e.isGeographic||e.isWGS84||e.wkid===r.W.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===r.W.CGCS2000||e.wkid===r.W.GCSMARS2000||e.wkid===r.W.GCSMARS2000_SPHERE||e.wkid===r.W.GCSMOON2000))}},24818:(e,t,i)=>{i.d(t,{E:()=>s});i(39994);var r=i(78951),n=i(91907);class s{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const e=s.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return r.f.createIndex(this._rctx,n.l1.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,n.w0.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(n.MX.POINTS,1,n.g.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}}},5224:(e,t,i)=>{var r;i.d(t,{P:()=>r}),function(e){e[e.Bind=0]="Bind",e[e.Pass=1]="Pass",e[e.Draw=2]="Draw"}(r||(r={}))},78951:(e,t,i)=>{i.d(t,{f:()=>c});var r=i(7753),n=(i(39994),i(13802)),s=i(86098),o=i(6174),a=i(91907);const l=()=>n.Z.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,i){return new c(e,a.w0.ELEMENT_ARRAY_BUFFER,t,i)}static createVertex(e,t,i){return new c(e,a.w0.ARRAY_BUFFER,t,i)}static createUniform(e,t,i){return new c(e,a.w0.UNIFORM_BUFFER,t,i)}static createPixelPack(e,t=a.l1.STREAM_READ,i){const r=new c(e,a.w0.PIXEL_PACK_BUFFER,t);return i&&r.setSize(i),r}static createPixelUnpack(e,t=a.l1.STREAM_DRAW,i){return new c(e,a.w0.PIXEL_UNPACK_BUFFER,t,i)}static createTransformFeedback(e,t=a.l1.STATIC_DRAW,i){const r=new c(e,a.w0.TRANSFORM_FEEDBACK_BUFFER,t);return r.setSize(i),r}constructor(e,t,i,r){this._context=e,this.bufferType=t,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a._g.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.zu)(this._context.gl),r&&this.setData(r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.w0.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.g.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.g.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.w0.ELEMENT_ARRAY_BUFFER||this.bufferType===a.w0.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a._g.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===a.w0.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.g.UNSIGNED_SHORT:e*=2;break;case a.g.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.w0.ELEMENT_ARRAY_BUFFER&&((0,s.lq)(e)?this._indexType=a.g.UNSIGNED_BYTE:(0,s.Uc)(e)?(t/=2,this._indexType=a.g.UNSIGNED_SHORT):(0,s.ZY)(e)&&(t/=4,this._indexType=a.g.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const r=this._context.gl;null!=t?r.bufferData(this.bufferType,t,this.usage):r.bufferData(this.bufferType,e,this.usage),(0,o.zu)(r),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,t,i,r){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,i,r-i),(0,o.zu)(s),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,t=0,i,n){if(i<0||n<0)return;const s=function(e){return(0,r.zG)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(s*((i??0)+(n??0))>e.byteLength)return;t+s*(n??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.w0.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.w0.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.w0.TRANSFORM_FEEDBACK_BUFFER,t,e,i,n),this._context.unbindBuffer(a.w0.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.w0.COPY_READ_BUFFER),o.getBufferSubData(a.w0.COPY_READ_BUFFER,t,e,i,n),this._context.unbindBuffer(a.w0.COPY_READ_BUFFER))}async getSubDataAsync(e,t=0,i,r){await this._context.clientWaitAsync(),this.getSubData(e,t,i,r)}}},18567:(e,t,i)=>{i.d(t,{X:()=>h,d:()=>p});i(39994);var r=i(13802),n=i(61681),s=i(78951),o=i(6174),a=i(91907),l=i(43106),c=i(37165),u=i(43487);class h{constructor(e,t,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(a._g.FramebufferObject,this);const r=d(t)?t:new u.x(this._context,t);if(this._colorAttachments.set(a.VY.COLOR_ATTACHMENT0,r),this._validateTextureDescriptor(r.descriptor),this._validateColorAttachmentPoint(a.VY.COLOR_ATTACHMENT0),null!=i)if(function(e){return d(e)||null!=e&&"pixelFormat"in e}(i))this._depthStencilTexture=d(i)?i:new u.x(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const e=function(e){return null!=e&&"type"in e&&e.type===l.B.RenderBuffer}(i)?i:new c.r(this._context,i);this._depthStencilBuffer=e,this._validateRenderBufferDescriptor(e.descriptor)}}dispose(){if(0===this._colorAttachments.size&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach(((e,t)=>this.detachColorTexture(t)?.dispose())),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(a._g.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(a.VY.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(a.VY.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(a.VY.COLOR_ATTACHMENT0)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce(((e,[t,i])=>e+i.usedMemory),this.depthStencil?.usedMemory??0)}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&d(t)?t:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,t=a.VY.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(t);const i=e.descriptor;this._validateTextureDescriptor(i),this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,t)),this._colorAttachments.set(t,e)}detachColorTexture(e=a.VY.COLOR_ATTACHMENT0){const t=this._colorAttachments.get(e);if(t){if(this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(t)}return this._colorAttachments.delete(e),t}}setColorTextureTarget(e,t=a.VY.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);i&&this._framebufferTexture2D(i.glName,t,e)}attachDepthStencil(e){if(e)switch(e.type){case l.B.Texture:return this._attachDepthStencilTexture(e);case l.B.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(null==e)return;const t=e.descriptor;t.pixelFormat!==a.VI.DEPTH_STENCIL&&t.pixelFormat!==a.VI.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),t.dataType!==a.Br.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,a.Lu)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,a.Lu),this._context.bindFramebuffer(e)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(null==e)return;const t=e.descriptor;if(this._validateRenderBufferDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,r=this._getGLAttachmentPoint(t);i.framebufferRenderbuffer(a.qi.FRAMEBUFFER,r,i.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const i=this._context.gl,r=this._getGLAttachmentPoint(e.descriptor);i.framebufferRenderbuffer(a.qi.FRAMEBUFFER,r,i.RENDERBUFFER,null),this._context.bindFramebuffer(t)}return this._depthStencilBuffer=null,e}copyToTexture(e,t,i,r,n,s,o){(e<0||t<0||n<0||s<0)&&console.error("Offsets cannot be negative!"),(i<=0||r<=0)&&console.error("Copy width and height must be greater than zero!");const l=o.descriptor;o.descriptor.target!==a.No.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==l?.width||null==l?.height||e+i>this.width||t+r>this.height||n+i>l.width||s+r>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(o,u.x.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(u.x.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(a.No.TEXTURE_2D,0,n,s,e,t,i,r),c.bindTexture(h,u.x.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,t,i,r,n,s,o){(i<=0||r<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,i,r,n,s,o)}async readPixelsAsync(e,t,i,r,n,o,l){const{gl:c}=this._context,u=s.f.createPixelPack(this._context,a.l1.STREAM_READ,l.byteLength);this._context.bindBuffer(u);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),c.readPixels(e,t,i,r,n,o,0),this._context.unbindBuffer(a.w0.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(h),await u.getSubDataAsync(l),u.dispose()}resize(e,t){if(this.width===e&&this.height===t)return;const i={width:e,height:t};p(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach((e=>e.resize(i.width,i.height))),this._depthStencilTexture?.resize(i.width,i.height),this._initialized&&(p(i,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=a.qi.FRAMEBUFFER){const t=this._context.gl;if(this._initialized)return void t.bindFramebuffer(e,this.glName);this._glName&&t.deleteFramebuffer(this._glName);const i=t.createFramebuffer();if(t.bindFramebuffer(e,i),this._colorAttachments.forEach(((t,i)=>this._framebufferTexture2D(t.glName,i,f(t),e))),this._depthStencilBuffer){const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(e,i,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,t.DEPTH_STENCIL_ATTACHMENT,f(this._depthStencilTexture),e);(0,o.hZ)()&&t.checkFramebufferStatus(e)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,t=a.VY.COLOR_ATTACHMENT0,i=a.No.TEXTURE_2D,r=a.qi.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(r,t,i,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(a.qi.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthStencilBuffer=(0,n.M2)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=(0,n.M2)(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==a.No.TEXTURE_2D&&e.target!==a.No.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),p(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){p(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case a.Tg.DEPTH_COMPONENT16:case a.Tg.DEPTH_COMPONENT24:case a.Tg.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case a.Tg.DEPTH24_STENCIL8:case a.Tg.DEPTH32F_STENCIL8:case a.Tg.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case a.Tg.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(-1===h._MAX_COLOR_ATTACHMENTS){const{gl:e}=this._context;h._MAX_COLOR_ATTACHMENTS=e.getParameter(e.MAX_COLOR_ATTACHMENTS)}const t=e-a.VY.COLOR_ATTACHMENT0;t+1>h._MAX_COLOR_ATTACHMENTS&&r.Z.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${h._MAX_COLOR_ATTACHMENTS} color attachments`)}}function d(e){return null!=e&&"type"in e&&e.type===l.B.Texture}function p(e,t){const i=Math.max(e.width,e.height);if(i>t){r.Z.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${e.width}x${e.height} to device limit ${t}`);const n=t/i;return e.width=Math.round(e.width*n),e.height=Math.round(e.height*n),!1}return!0}function f(e){return e.descriptor.target===a.No.TEXTURE_CUBE_MAP?a.No.TEXTURE_CUBE_MAP_POSITIVE_X:a.No.TEXTURE_2D}h._MAX_COLOR_ATTACHMENTS=-1},43106:(e,t,i)=>{var r;i.d(t,{B:()=>r}),function(e){e[e.Texture=0]="Texture",e[e.RenderBuffer=1]="RenderBuffer"}(r||(r={}))},86765:(e,t,i)=>{i.d(t,{G:()=>n,K:()=>r});const r=class{},n=new r},69609:(e,t,i)=>{i.d(t,{$:()=>T});i(39994);var r=i(6174),n=i(91907);const s=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],o=!1,a=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],l=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],c=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var u=999,h=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function d(){var e,t,i,r=0,n=0,s=u,o=[],d=[],p=1,f=0,m=0,g=!1,y=!1,_="";return function(e){return d=[],null!==e?b(e.replace?e.replace(/\r\n/g,"\n"):e):(o.length&&v(o.join("")),s=10,v("(eof)"),d)};function v(e){e.length&&d.push({type:h[s],data:e,position:m,line:p,column:f})}function b(t){var o;for(r=0,i=(_+=t).length;e=_[r],r<i;){switch(o=r,s){case 0:r=C();break;case 1:case 2:r=T();break;case 3:r=S();break;case 4:r=A();break;case 11:r=M();break;case 5:r=R();break;case 9999:r=O();break;case 9:r=x();break;case u:r=w()}o!==r&&("\n"===_[o]?(f=0,++p):++f)}return n+=r,_=_.slice(r),d}function w(){return o=o.length?[]:o,"/"===t&&"*"===e?(m=n+r-1,s=0,t=e,r+1):"/"===t&&"/"===e?(m=n+r-1,s=1,t=e,r+1):"#"===e?(s=2,m=n+r,r):/\s/.test(e)?(s=9,m=n+r,r):(g=/\d/.test(e),y=/[^\w_]/.test(e),m=n+r,s=g?4:y?3:9999,r)}function x(){return/[^\s]/g.test(e)?(v(o.join("")),s=u,r):(o.push(e),t=e,r+1)}function T(){return"\r"!==e&&"\n"!==e||"\\"===t?(o.push(e),t=e,r+1):(v(o.join("")),s=u,r)}function C(){return"/"===e&&"*"===t?(o.push(e),v(o.join("")),s=u,r+1):(o.push(e),t=e,r+1)}function S(){if("."===t&&/\d/.test(e))return s=5,r;if("/"===t&&"*"===e)return s=0,r;if("/"===t&&"/"===e)return s=1,r;if("."===e&&o.length){for(;E(o););return s=5,r}if(";"===e||")"===e||"("===e){if(o.length)for(;E(o););return v(e),s=u,r+1}var i=2===o.length&&"="!==e;if(/[\w_\d\s]/.test(e)||i){for(;E(o););return s=u,r}return o.push(e),t=e,r+1}function E(e){for(var t,i,r=0;;){if(t=l.indexOf(e.slice(0,e.length+r).join("")),i=l[t],-1===t){if(r--+e.length>0)continue;i=e.slice(0,1).join("")}return v(i),m+=i.length,(o=o.slice(i.length)).length}}function M(){return/[^a-fA-F0-9]/.test(e)?(v(o.join("")),s=u,r):(o.push(e),t=e,r+1)}function A(){return"."===e||/[eE]/.test(e)?(o.push(e),s=5,t=e,r+1):"x"===e&&1===o.length&&"0"===o[0]?(s=11,o.push(e),t=e,r+1):/[^\d]/.test(e)?(v(o.join("")),s=u,r):(o.push(e),t=e,r+1)}function R(){return"f"===e&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(v(o.join("")),s=u,r):(o.push(e),t=e,r+1)}function O(){if(/[^\d\w_]/.test(e)){var i=o.join("");return s=a.indexOf(i)>-1?8:c.indexOf(i)>-1?7:6,v(o.join("")),s=u,r}return o.push(e),t=e,r+1}}function p(e){return function(e){var t=d(),i=[];return(i=i.concat(t(e))).concat(t(null))}(e)}const f=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function m(e,t){for(let i=t-1;i>=0;i--){const t=e[i];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function g(e,t,i,r){r=r||i;for(const n of e)if("ident"===n.type&&n.data===i)return r in t?t[r]++:t[r]=0,g(e,t,r+"_"+t[r],r);return i}function y(e,t,i="afterVersion"){function r(e,t){for(let i=t;i<e.length;i++){const t=e[i];if("operator"===t.type&&";"===t.data)return i}return null}const n={data:"\n",type:"whitespace"},s=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let o=function(e){let t=-1,n=0,s=-1;for(let o=0;o<e.length;o++){const a=e[o];if("preprocessor"===a.type&&(/#(if|ifdef|ifndef)\s+.+/.test(a.data)?++n:/#endif\s*.*/.test(a.data)&&--n),"afterVersion"!==i&&"afterPrecision"!==i||"preprocessor"===a.type&&a.data.startsWith("#version")&&(s=Math.max(s,o)),"afterPrecision"===i&&"keyword"===a.type&&"precision"===a.data){const t=r(e,o);if(null===t)throw new Error("precision statement not followed by any semicolons!");s=Math.max(s,t)}t<s&&0===n&&(t=o)}return t+1}(e);s(o-1)&&e.splice(o++,0,n);for(const i of t)e.splice(o++,0,i);s(o-1)&&s(o)&&e.splice(o,0,n)}function _(e,t,i,r="lowp"){y(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function v(e,t,i,r,n="lowp"){y(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function b(e,t){let i,r,n=-1;for(let s=t;s<e.length;s++){const t=e[s];if("operator"===t.type&&("["===t.data&&(i=s),"]"===t.data)){r=s;break}"integer"===t.type&&(n=parseInt(t.data,10))}return i&&r&&e.splice(i,r-i+1),n}function w(e,t){if(e.startsWith("#version 300"))return e;const i=function(e){return o?x.get(e):null}(e);if(null!=i)return i;const r=p(e);if("300 es"===function(e,t="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of e)if("preprocessor"===n.type){const e=r.exec(n.data);if(e){const r=e[1].replaceAll(/\s{2,}/g," ");if(r===i)return r;if(r===t)return n.data="#version "+i,t;throw new Error("unknown glsl version: "+r)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:"\n"}),null}(r,"100","300 es"))return e;let a=null,l=null;const c={},u={};for(let e=0;e<r.length;++e){const i=r[e];switch(i.type){case"keyword":t===n.Ho.VERTEX_SHADER&&"attribute"===i.data?i.data="in":"varying"===i.data&&(i.data=t===n.Ho.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(i.data.trim())&&(i.data=i.data.replaceAll(/(2D|Cube|EXT)/g,"")),t===n.Ho.FRAGMENT_SHADER&&"gl_FragColor"===i.data&&(a||(a=g(r,c,"fragColor"),_(r,a,"vec4")),i.data=a),t===n.Ho.FRAGMENT_SHADER&&"gl_FragData"===i.data){const t=b(r,e+1),n=g(r,c,"fragData");v(r,n,"vec4",t,"mediump"),i.data=n}else t===n.Ho.FRAGMENT_SHADER&&"gl_FragDepthEXT"===i.data&&(l||(l=g(r,c,"gl_FragDepth")),i.data=l);break;case"ident":if(s.includes(i.data)){if(t===n.Ho.VERTEX_SHADER&&m(r,e))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");i.data in u||(u[i.data]=g(r,c,i.data)),i.data=u[i.data]}}}for(let e=r.length-1;e>=0;--e){const t=r[e];if("preprocessor"===t.type){const i=t.data.match(/#extension\s+(.*):/);if(i?.[1]&&f.has(i[1].trim())){const t=r[e+1];r.splice(e,t&&"whitespace"===t.type?2:1)}const n=t.data.match(/#ifdef\s+(.*)/);n?.[1]&&f.has(n[1].trim())&&(t.data="#if 1");const s=t.data.match(/#ifndef\s+(.*)/);s?.[1]&&f.has(s[1].trim())&&(t.data="#if 0")}}return function(e,t){return o&&x.set(e,t),t}(e,function(e){return e.map((e=>"eof"!==e.type?e.data:"")).join("")}(r))}const x=new Map;class T{constructor(e,t,i,s,o=new Map,a=[]){this._context=e,this._locations=s,this._uniformBlockBindings=o,this._transformFeedbackVaryings=a,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),t=w(t,n.Ho.VERTEX_SHADER),i=w(i,n.Ho.FRAGMENT_SHADER),this._vShader=C(this._context,n.Ho.VERTEX_SHADER,t),this._fShader=C(this._context,n.Ho.FRAGMENT_SHADER,i),E.enabled&&(this._linesOfCode=t.match(/\n/g).length+i.match(/\n/g).length+2,this._context.instanceCounter.increment(n._g.LinesOfCode,this._vShader,this._linesOfCode)),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(n._g.Shader,this),(0,r.CG)()&&(this.vertexShader=t,this.fragmentShader=i),this.usedMemory=t.length+i.length;const l=this._context.gl,c=l.createProgram();l.attachShader(c,this._vShader),l.attachShader(c,this._fShader),this._locations.forEach(((e,t)=>l.bindAttribLocation(c,e,t))),this._transformFeedbackVaryings?.length&&l.transformFeedbackVaryings(c,this._transformFeedbackVaryings,l.SEPARATE_ATTRIBS),l.linkProgram(c),(0,r.CG)()&&!l.getProgramParameter(c,l.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${l.getProgramParameter(c,l.VALIDATE_STATUS)}, gl error ${l.getError()}, vertex: ${l.getShaderParameter(this._vShader,l.COMPILE_STATUS)}, fragment: ${l.getShaderParameter(this._fShader,l.COMPILE_STATUS)}, info log: ${l.getProgramInfoLog(c)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[e,t]of this._uniformBlockBindings){const i=l.getUniformBlockIndex(c,e);i<4294967295&&l.uniformBlockBinding(c,i,t)}this._glName=c,this._context.instanceCounter.increment(n._g.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==e||null==this.glName?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,t=this._context.instanceCounter;this._nameToUniformLocation.forEach((e=>e&&t.decrement(n._g.Uniform,e))),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(t.decrement(n._g.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,t.decrement(n._g.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,t.decrement(n._g.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const t=this._nameToUniformLocation.get(e);if(void 0!==t)return t;if(this.glName){const t=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,t),t&&this._context.instanceCounter.increment(n._g.Uniform,t),t}return null}hasUniform(e){return null!=this._getUniformLocation(e)}setUniform1i(e,t){const i=this._nameToUniform1.get(e);void 0!==i&&t===i||(this._context.gl.uniform1i(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1iv(e,t){S(this._nameToUniform1v,e,t)&&this._context.gl.uniform1iv(this._getUniformLocation(e),t)}setUniform2iv(e,t){S(this._nameToUniform2,e,t)&&this._context.gl.uniform2iv(this._getUniformLocation(e),t)}setUniform3iv(e,t){S(this._nameToUniform3,e,t)&&this._context.gl.uniform3iv(this._getUniformLocation(e),t)}setUniform4iv(e,t){S(this._nameToUniform4,e,t)&&this._context.gl.uniform4iv(this._getUniformLocation(e),t)}setUniform1f(e,t){const i=this._nameToUniform1.get(e);void 0!==i&&t===i||(this._context.gl.uniform1f(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1fv(e,t){S(this._nameToUniform1v,e,t)&&this._context.gl.uniform1fv(this._getUniformLocation(e),t)}setUniform2f(e,t,i){const r=this._nameToUniform2.get(e);void 0===r?(this._context.gl.uniform2f(this._getUniformLocation(e),t,i),this._nameToUniform2.set(e,[t,i])):t===r[0]&&i===r[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),t,i),r[0]=t,r[1]=i)}setUniform2fv(e,t){S(this._nameToUniform2,e,t)&&this._context.gl.uniform2fv(this._getUniformLocation(e),t)}setUniform3f(e,t,i,r){const n=this._nameToUniform3.get(e);void 0===n?(this._context.gl.uniform3f(this._getUniformLocation(e),t,i,r),this._nameToUniform3.set(e,[t,i,r])):t===n[0]&&i===n[1]&&r===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),t,i,r),n[0]=t,n[1]=i,n[2]=r)}setUniform3fv(e,t){const i=this._getUniformLocation(e);null!=i&&S(this._nameToUniform3,e,t)&&this._context.gl.uniform3fv(i,t)}setUniform4f(e,t,i,r,n){const s=this._nameToUniform4.get(e);void 0===s?(this._context.gl.uniform4f(this._getUniformLocation(e),t,i,r,n),this._nameToUniform4.set(e,[t,i,r,n])):void 0!==s&&t===s[0]&&i===s[1]&&r===s[2]&&n===s[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),t,i,r,n),s[0]=t,s[1]=i,s[2]=r,s[3]=n)}setUniform4fv(e,t){const i=this._getUniformLocation(e);null!=i&&S(this._nameToUniform4,e,t)&&this._context.gl.uniform4fv(i,t)}setUniformMatrix3fv(e,t,i=!1){const r=this._getUniformLocation(e);null!=r&&S(this._nameToUniformMatrix3,e,t)&&this._context.gl.uniformMatrix3fv(r,i,t)}setUniformMatrix4fv(e,t,i=!1){const r=this._getUniformLocation(e);null!=r&&S(this._nameToUniformMatrix4,e,t)&&this._context.gl.uniformMatrix4fv(r,i,t)}stop(){}}function C(e,t,i){const s=e.gl,o=s.createShader(t);return s.shaderSource(o,i),s.compileShader(o),(0,r.CG)()&&!s.getShaderParameter(o,s.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===n.Ho.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(s.getShaderInfoLog(o)),console.error(function(e){let t=2;return e.replaceAll("\n",(()=>"\n"+function(e){return e>=1e3?e.toString():("  "+e).slice(-3)}(t++)+":"))}(i))),o}function S(e,t,i){const r=e.get(t);if(!r)return e.set(t,Array.from(i)),!0;const n=i.length;if(r.length!==n)return e.set(t,Array.from(i)),!0;for(let e=0;e<n;++e){const t=i[e];if(r[e]!==t){for(r[e]=t;e<n;++e)r[e]=i[e];return!0}}return!1}const E={enabled:!1}},18636:(e,t,i)=>{i.d(t,{G:()=>s});i(39994);var r=i(22445),n=i(69609);class s{constructor(e){this._rctx=e,this._store=new r.r}dispose(){this._store.forAll((e=>e.dispose())),this._store.clear()}acquire(e,t,i,r){const s=this._store.get(e,t);if(null!=s)return s.ref(),s;const o=new n.$(this._rctx,e,t,i,r);return o.ref(),this._store.set(e,t,o),o}get test(){}}},37165:(e,t,i)=>{i.d(t,{r:()=>o});var r=i(91907),n=i(43106),s=i(56109);class o{constructor(e,t){this._context=e,this._descriptor=t,this.type=n.B.RenderBuffer,this._context.instanceCounter.increment(r._g.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:o,internalFormat:a,multisampled:l}=t;l?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,a,s,o):i.renderbufferStorage(i.RENDERBUFFER,a,s,o),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,t=this._context.parameters.maxSamples;return e?Math.min(e,t):t}get usedMemory(){return(0,s.G)(this._descriptor)}resize(e,t){const i=this._descriptor;if(i.width===e&&i.height===t)return;i.width=e,i.height=t;const r=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):r.renderbufferStorage(r.RENDERBUFFER,i.internalFormat,i.width,i.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(r._g.Renderbuffer,this),this._context=null)}}},56109:(e,t,i)=>{i.d(t,{G:()=>s,Y:()=>n});var r=i(62486);class n{constructor(e,t,i=t){this.internalFormat=e,this.width=t,this.height=i,this.multisampled=!1,this.samples=1}}function s(e){return e.width<=0||e.height<=0||null==e.internalFormat?0:e.width*e.height*(0,r.RG)(e.internalFormat)}},31812:(e,t,i)=>{i.d(t,{x:()=>z});var r=i(39994),n=i(61681),s=i(78668),o=i(12928),a=i(6174),l=i(91907);class c{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:l.zi.ONE,dstRGB:l.zi.ZERO,srcAlpha:l.zi.ONE,dstAlpha:l.zi.ZERO},this.blendEquation={mode:l.db.ADD,modeAlpha:l.db.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=l.LR.BACK,this.frontFace=l.Wf.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=l.wb.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:l.LR.FRONT_AND_BACK,func:l.wb.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:l.LR.FRONT_AND_BACK,fail:l.xS.KEEP,zFail:l.xS.KEEP,zPass:l.xS.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[l.Xg.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}}class u{constructor(e){this._objectType=e,this._active=new Map}get _stack(){const e=(new Error).stack.split("\n");return e.shift(),e.shift(),e.shift(),e.join("\n")}add(e){this._active.set(e,new h(this._stack))}remove(e){this._active.delete(e)}addReference(e){const t=this._active.get(e);t&&t.retains.push(this._stack)}removeReference(e){const t=this._active.get(e);t&&t.releases.push(this._stack)}resetLog(){const e=new Map;let t="";this._active.forEach(((i,{usedMemory:r})=>{e.has(i.from)||(e.set(i.from,new Map),i.retains.length>0&&(t+=`  First reference count mismatch:\n  Retain:\n    ${i.retains.join("\n\n    ")}\n\n  Release:    ${i.releases.join("\n\n    ")}\n`));const n=e.get(i.from);n.set(r??0,n.get(r??0)??1)})),this._active.clear();let i=0;const r=new Array;return e.forEach(((e,t)=>{let n=0;e.forEach(((e,t)=>n+=e*t)),e.set(-1,n),i+=n,r.push([t,e])})),e.clear(),r.sort(((e,t)=>t[1].get(-1)-e[1].get(-1))),r.reduce(((e,[t,i])=>{const r=Math.round(i.get(-1)/1024);return i.delete(-1),e+`  ${r}KB from ${Array.from(i.values()).reduce(((e,t)=>e+t),0)} allocations at ${t}\n`}),`Total ${this._objectType} memory: ${Math.round(i/1024)}KB\n${t}`)}}class h{constructor(e){this.from=e,this.retains=new Array,this.releases=new Array}}const d=!1;class p{constructor(){for(this._current=new Array,this._allocations=d?new u("WebGLObject"):null;this._current.length<l._g.COUNT;)this._current.push(0)}increment(e,t,i=1){this._current[e]+=i,this._allocations?.add(t)}decrement(e,t,i=1){this._current[e]-=i,this._allocations?.remove(t)}get current(){return this._current}get total(){return this.current.reduce(((e,t,i)=>e+(i<l._g.UNCOUNTED?t:0)),0)}get resourceInformation(){let e="";if(this.total>0){e+="Live objects:\n";for(let t=0;t<l._g.COUNT;++t){const i=this._current[t];i>0&&(e+=`${l._g[t]}: ${i}\n`)}}return e+=this._allocations?.resetLog(),e}}class f{constructor(e,t,i){const r=t.textureFilterAnisotropic,n=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=r?Math.min(e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}}var m=i(18636),g=i(17346),y=i(43487),_=i(62486),v=i(20200),b=i(24818),w=i(78951),x=i(18567),T=i(80479),C=i(31873);class S extends C.G{constructor(e){super(),this._rctx=e,this._helperProgram=null,(0,r.Z)("mac")&&(0,r.Z)("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const t=this._rctx,i=t.getBoundFramebufferObject(),{x:r,y:n,width:s,height:o}=t.getViewport();t.resetState();const a=new T.X(1);a.wrapMode=l.e8.CLAMP_TO_EDGE,a.samplingMode=l.cw.NEAREST;const c=new x.X(t,a),u=w.f.createIndex(this._rctx,l.l1.STATIC_DRAW,new Uint8Array([0]));t.bindFramebuffer(c),t.setViewport(0,0,1,1),t.useProgram(this._helperProgram),t.bindBuffer(u,l.w0.ELEMENT_ARRAY_BUFFER),t.drawElements(l.MX.POINTS,1,l.g.UNSIGNED_BYTE,0),t.useProgram(e),t.bindVAO(null),t.drawArrays(l.MX.TRIANGLES,0,258);const h=new Uint8Array(4);return c.readPixels(0,0,1,1,l.VI.RGBA,l.Br.UNSIGNED_BYTE,h),t.setViewport(r,n,s,o),t.bindFramebuffer(i),c.dispose(),u.dispose(),255===h[0]}_prepareProgram(){const e=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${v.H.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,t=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${v.H.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(e,t,new Map([]))}_prepareHelperProgram(){const e=b.E.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}}var E=i(73534),M=i(81095),A=i(30560),R=i(29620),O=i(41163);class P extends C.G{constructor(e){super(),this._rctx=e,this._program=I(this._rctx,!1),this._obfuscated=I(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=(0,n.M2)(this._obfuscated)}_test(e){if((0,r.Z)("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;const t=this._rctx,i=t.getBoundFramebufferObject(),{x:n,y:s,width:o,height:a}=t.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return t.setViewport(n,s,o,a),t.bindFramebuffer(i),0!==l&&(0===c||l/c>5)}_runProgram(e){const t=this._rctx;t.resetState();const i=new T.X(1);i.wrapMode=l.e8.CLAMP_TO_EDGE,i.samplingMode=l.cw.NEAREST;const r=new x.X(t,i),n=w.f.createVertex(t,l.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new R.U(t,new Map([["position",0]]),new Map([["geometry",[new O.G("position",2,l.g.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",n]])),o=(0,M.al)(5633261.287538229,2626832.878767164,1434988.0495278358),a=(0,M.al)(5633271.46742708,2626873.6381334523,1434963.231608387),c=new Float32Array(6);(0,A.LF)(o,c,3);const u=new Float32Array(6);(0,A.LF)(a,u,3),t.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),t.bindFramebuffer(r),t.setViewport(0,0,1,1),t.bindVAO(s),t.drawArrays(l.MX.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);r.readPixels(0,0,1,1,l.VI.RGBA,l.Br.UNSIGNED_BYTE,h),s.dispose(),r.dispose();const d=(o[2]-a[2])/25,p=(0,E.v)(h);return Math.abs(d-p)}}function I(e,t){const i=`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `;return e.programCache.acquire(i,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]]))}class L extends C.G{constructor(e){if(super(),this._rctx=e,!e.gl)return;if(!e.capabilities.colorBufferFloat?.textureFloat||!e.capabilities.colorBufferFloat?.floatBlend)return;this._program=e.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]]))}_test(e){const t=this._rctx,i=new T.X(1);i.wrapMode=l.e8.CLAMP_TO_EDGE,i.dataType=l.Br.FLOAT,i.internalFormat=l.lP.RGBA32F,i.samplingMode=l.cw.NEAREST;const r=new x.X(t,i),n=w.f.createVertex(t,l.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new R.U(t,new Map([["a_pos",0]]),new Map([["geometry",[new O.G("a_pos",2,l.g.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",n]]));t.gl.getError(),t.useProgram(e);const o=t.getBoundFramebufferObject(),{x:a,y:c,width:u,height:h}=t.getViewport();t.bindFramebuffer(r),t.setViewport(0,0,1,1),t.bindVAO(s),t.drawArrays(l.MX.TRIANGLE_STRIP,0,4);const d=(0,g.sm)({blending:g.a5});t.setPipelineState(d),t.drawArrays(l.MX.TRIANGLE_STRIP,0,4);const p=t.gl.getError();return t.setViewport(a,c,u,h),t.bindFramebuffer(o),s.dispose(),r.dispose(),p!==t.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}}var D=i(61581);class N{constructor(e){this.rctx=e,this.floatBufferBlend=new L(e),this.svgPremultipliesAlpha=new D.d(e),this.doublePrecisionRequiresObfuscation=new P(e),this.drawArraysRequiresIndicesTypeReset=new S(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}}var F=i(52997),U=i(33679);class k{constructor(e,t){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._debugRendererInfo=null,this._disabledExtensions=t.disabledExtensions||{},this._debugWebGLExtensions=t.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??=function(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(this._gl,this._disabledExtensions),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??=function(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(this._gl,this._disabledExtensions),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??=function(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}(this._gl,this._disabledExtensions),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??=(0,U.mO)(this._gl,this._disabledExtensions),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??=function(e,t){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),n=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}(this._gl,this._disabledExtensions),this._colorBufferFloat}get textureNorm16(){return this._textureNorm16??=function(e,t){if(t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}(this._gl,this._disabledExtensions),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??=function(e,t,i,r,n){if(r)return!0;if(t[i])return!1;for(const t of n)if(e.getExtension(t))return!0;return!1}(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]),this._textureFloatLinear}get loseContext(){return this._loseContext??=function(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}(this._gl,this._debugWebGLExtensions),this._loseContext}get debugRendererInfo(){return this._debugRendererInfo??=(0,F.F)(this._gl,this._debugWebGLExtensions),this._debugRendererInfo}enable(e){return this[e]}}let z=class{constructor(e,t){this.gl=e,this.instanceCounter=new p,this.programCache=new m.G(this),this._transformFeedbackRequestInfo=null,this._state=new c,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(t)}configure(e){this._capabilities=new k(this.gl,e),this._parameters=new f(this.gl,this._capabilities,e),y.x.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const t=this.gl.getParameter(this.gl.VIEWPORT);this._state=new c,this._state.viewport={x:t[0],y:t[1],width:t[2],height:t[3]},this._stateTracker=new g.jp({setBlending:e=>{if(e){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(e.opRgb,e.opAlpha),this.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);const t=e.color;this.setBlendColor(t.r,t.g,t.b,t.a)}else this.setBlendingEnabled(!1)},setCulling:e=>{e?(this.setFaceCullingEnabled(!0),this.setCullFace(e.face),this.setFrontFace(e.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:e=>{e?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(e.factor,e.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:e=>{e?(this.setDepthTestEnabled(!0),this.setDepthFunction(e.func)):this.setDepthTestEnabled(!1)},setStencilTest:e=>{if(e){this.setStencilTestEnabled(!0);const t=e.function;this.setStencilFunction(t.func,t.ref,t.mask);const i=e.operation;this.setStencilOp(i.fail,i.zFail,i.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:e=>{e?(this.setDepthWriteEnabled(!0),this.setDepthRange(e.zNear,e.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:e=>{e?this.setColorMask(e.r,e.g,e.b,e.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:e=>{e?this.setStencilWriteMask(e.mask):this.setStencilWriteMask(0)},setDrawBuffers:e=>{if(e)this.setDrawBuffers(e.buffers);else{const{drawFramebuffer:e}=this._state;null===e?this.setDrawBuffers([l.Xg.BACK]):0===e.colorAttachments.length?this.setDrawBuffers([l.Xg.NONE]):this.setDrawBuffers([l.VY.COLOR_ATTACHMENT0])}}}),this.enforceState(),(0,n.M2)(this._driverTest),this._driverTest=new N(this)}dispose(){(0,n.M2)(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(l.w0.ARRAY_BUFFER),this.unbindBuffer(l.w0.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(l.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(l.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(l.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(l.w0.COPY_READ_BUFFER),this.unbindBuffer(l.w0.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,(0,a.hZ)()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,t){for(let t=0;t<e.length;++t)this._state.textureUnitMap[e[t]]=null;t>=0&&(this._state.activeTexture=t)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,t,i,r){e===this._state.blendColor.r&&t===this._state.blendColor.g&&i===this._state.blendColor.b&&r===this._state.blendColor.a||(this.gl.blendColor(e,t,i,r),this._state.blendColor.r=e,this._state.blendColor.g=t,this._state.blendColor.b=i,this._state.blendColor.a=r,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._state.blendFunction.srcRGB&&t===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,t),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,i,r){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===t&&this._state.blendFunction.dstAlpha===r||(this.gl.blendFuncSeparate(e,t,i,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,i,r){this._state.colorMask.r===e&&this._state.colorMask.g===t&&this._state.colorMask.b===i&&this._state.colorMask.a===r||(this.gl.colorMask(e,t,i,r),this._state.colorMask.r=e,this._state.colorMask.g=t,this._state.colorMask.b=i,this._state.colorMask.a=r,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,i,r){this._state.clearColor.r===e&&this._state.clearColor.g===t&&this._state.clearColor.b===i&&this._state.clearColor.a===r||(this.gl.clearColor(e,t,i,r),this._state.clearColor.r=e,this._state.clearColor.g=t,this._state.clearColor.b=i,this._state.clearColor.a=r)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===t||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,t,i,r){this._state.scissorRect.x===e&&this._state.scissorRect.y===t&&this._state.scissorRect.width===i&&this._state.scissorRect.height===r||(this.gl.scissor(e,t,i,r),this._state.scissorRect.x=e,this._state.scissorRect.y=t,this._state.scissorRect.width=i,this._state.scissorRect.height=r)}setDepthTestEnabled(e){this._state.depthTest!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===t||(this.gl.depthRange(e,t),this._state.depthRange.zNear=e,this._state.depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,t,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===t&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,t,i),this._state.stencilFunction.face=l.LR.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,i,r){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFuncSeparate(e,t,i,r),this._state.stencilFunction.face=e,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,i){this._state.stencilOperation.face===l.LR.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===t&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,t,i),this._state.stencilOperation.face=l.LR.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,i,r){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOpSeparate(e,t,i,r),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,t=!1){const i=this._state.activeTexture;return e>=0&&(t||e!==this._state.activeTexture)&&(this.gl.activeTexture(l.V1+e),this._state.activeTexture=e),i}setDrawBuffers(e){const{drawFramebuffer:t}=this._state,i=null===t,r=i?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(t);if(r?.length!==e.length||!r.every(((t,i)=>t===e[i])))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(i){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==l.Xg.BACK&&e[0]!==l.Xg.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}i||!e.includes(l.Xg.BACK)?(this.gl.drawBuffers(e),i?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(t,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,t=255){if(e){if(e&l.Hf.COLOR){const e=this._state.drawFramebuffer?.colorAttachments;e&&this.setDrawBuffers(e),this.setColorMask(!0,!0,!0,!0)}e&l.Hf.DEPTH&&this.setDepthWriteEnabled(!0),e&l.Hf.STENCIL&&this.setStencilWriteMask(t),this.gl.clear(e)}}clearFramebuffer(e,t=!1,i=!1){let r=0;if(e){const t=1e-13,i=Math.max(t,e[3]);this.setClearColor(e[0],e[1],e[2],i),r|=l.Hf.COLOR}t&&(r|=l.Hf.DEPTH),!1===i?i=0:(!0===i&&(i=255),r|=l.Hf.STENCIL),r&&this.clear(r,i)}drawArrays(e,t,i){if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(null==this._state.program?.hasTransformFeedbackVaryings)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if((0,a.hZ)()){this._numOfDrawCalls++,this._numOfTriangles+=V(e,i);const t=this._state.textureUnitMap;for(let e=0;e<t.length;e++){const i=t[e];if(null!=i&&i===this._state.drawFramebuffer?.colorTexture)throw new Error(`Detected readWrite. Texture already bound at index ${e}`)}}this.gl.drawArrays(e,t,i),(0,a.zu)(this.gl)}drawArraysInstanced(e,t,i,r){this.gl.drawArraysInstanced(e,t,i,r),(0,a.zu)(this.gl)}drawElements(e,t,i,r){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if((0,a.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=V(e,t)),this.gl.drawElements(e,t,i,r),(0,a.hZ)()){const n=(0,_.HH)(this);if(n){const s=this.getBoundVAO(),o=s?.indexBuffer,a=s?.vertexBuffers,l={indexBuffer:o,vertexBuffers:a},c={mode:e,count:t,type:i,offset:r},u=o?.size??0,h=r+t,d=u<h?`. Buffer is too small. Attempted to draw index ${h} of ${u}`:"";console.error(`drawElements: ${n}${d}`,{args:c,vao:l})}}}drawElementsInstanced(e,t,i,r,n){this.gl.drawElementsInstanced(e,t,i,r,n),(0,a.zu)(this.gl)}logInfo(){(0,a.hZ)()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){(0,a.hZ)()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,t,i,r){i=Math.max(Math.round(i),1),r=Math.max(Math.round(r),1);const n=this._state.viewport;n.x===e&&n.y===t&&n.width===i&&n.height===r||(n.x=e,n.y=t,n.width=i,n.height=r,this.gl.viewport(e,t,i,r))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:t,width:i,height:r}){this.setViewport(e,t,i,r)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,t,i=!1){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const r=this._state.textureUnitMap[t];return null==e?.glName?(null!=r&&(this.setActiveTexture(t,i),this.gl.bindTexture(r.descriptor.target,null)),this._state.textureUnitMap[t]=null,r):i||r!==e?(this.setActiveTexture(t,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[t]=e,r):(e.isDirty&&(this.setActiveTexture(t,i),e.applyChanges()),r)}unbindTexture(e){if(null!=e)for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===e&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}bindFramebuffer(e,t=!1){if(t||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),null==e)return this.gl.bindFramebuffer(l.qi.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(l.qi.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,t,i=!1){const r=t===l.qi.READ_FRAMEBUFFER,n=r?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==e)&&(null==e?this.gl.bindFramebuffer(t,null):e.initializeAndBind(t),r?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,t,i=0,r=0,n=e.width,s=e.height,o=0,a=0,c=t.width,u=t.height,h=l.Hf.COLOR,d=l.cw.NEAREST){this.bindFramebufferSeparate(e,l.qi.READ_FRAMEBUFFER),this.bindFramebufferSeparate(t,l.qi.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,r,n,s,o,a,c,u,h,d)}bindBuffer(e,t){if(e)switch(t??=e.bufferType,t){case l.w0.ARRAY_BUFFER:this._state.vertexBuffer=B(this.gl,e,t,this._state.vertexBuffer);break;case l.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=B(this.gl,e,t,this._state.indexBuffer);break;case l.w0.UNIFORM_BUFFER:this._state.uniformBuffer=B(this.gl,e,t,this._state.uniformBuffer);break;case l.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=B(this.gl,e,t,this._state.pixelPackBuffer);break;case l.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=B(this.gl,e,t,this._state.pixelUnpackBuffer);break;case l.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=B(this.gl,e,t,this._state.copyReadBuffer);break;case l.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=B(this.gl,e,t,this._state.copyWriteBuffer);break;case l.w0.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=B(this.gl,e,t,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,t){if(t>=this.parameters.maxUniformBufferBindings||t<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=e===l.w0.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let r=i[t];return null==r&&(r={buffer:null,offset:0,size:0},i[t]=r),r}bindBufferBase(e,t,i){const r=this._getBufferBinding(e,t);null!=r&&(r.buffer===i&&0===r.offset&&0===r.size||(this.gl.bindBufferBase(e,t,i?i.glName:null),r.buffer=i,r.offset=0,r.size=0))}bindBufferRange(e,t,i,r,n){const s=this._getBufferBinding(e,t);null!=s&&(s.buffer===i&&s.offset===r&&s.size===n||(r%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,t,i.glName,r,n),s.buffer=i,s.offset=r,s.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,t,i,r){null!=t?((0,a.hZ)()&&(r??t.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),void 0!==i&&void 0!==r?this.bindBufferRange(l.w0.UNIFORM_BUFFER,e,t.buffer,i,r):this.bindBufferBase(l.w0.UNIFORM_BUFFER,e,t.buffer)):this.bindBufferBase(l.w0.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let t=0,i=this._state.uniformBufferBindingPoints.length;t<i;t++){const i=this._state.uniformBufferBindingPoints[t];null!=i&&i.buffer===e.buffer&&this.bindBufferBase(l.w0.UNIFORM_BUFFER,t,null)}}unbindBuffer(e){switch(e){case l.w0.ARRAY_BUFFER:this._state.vertexBuffer=B(this.gl,null,e,this._state.vertexBuffer);break;case l.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=B(this.gl,null,e,this._state.indexBuffer);break;case l.w0.UNIFORM_BUFFER:this._state.uniformBuffer=B(this.gl,null,e,this._state.uniformBuffer);break;case l.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=B(this.gl,null,e,this._state.pixelPackBuffer);break;case l.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=B(this.gl,null,e,this._state.pixelUnpackBuffer);break;case l.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=B(this.gl,null,e,this._state.copyReadBuffer);break;case l.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=B(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){null!=e?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,t){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName),i.beginTransformFeedback(t),this._transformFeedbackRequestInfo={primitiveType:t}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=(0,o.HA)(10)){const{gl:t}=this,i=t.fenceSync(l.V7.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let r;this.instanceCounter.increment(l._g.Sync,i),t.flush();do{await(0,s.e4)(e),r=t.clientWaitSync(i,0,0)}while(r===l.Y5.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(l._g.Sync,i),t.deleteSync(i),r===l.Y5.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=l.qi.FRAMEBUFFER){return e===l.qi.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(l.w0.ARRAY_BUFFER),this.unbindBuffer(l.w0.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(l.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(l.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(l.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(l.w0.COPY_READ_BUFFER),this.unbindBuffer(l.w0.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(l.zi.ONE,l.zi.ZERO),this.setBlendEquation(l.db.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(l.LR.BACK),this.setFrontFace(l.Wf.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(l.wb.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(l.wb.ALWAYS,0,0),this.setStencilOp(l.xS.KEEP,l.xS.KEEP,l.xS.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([l.Xg.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const{gl:e}=this;e.bindVertexArray(null);for(let t=0;t<this.parameters.maxVertexAttributes;t++)e.disableVertexAttribArray(t);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(l.w0.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(l.w0.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(l.w0.UNIFORM_BUFFER,null);for(let t=0;t<this._parameters.maxUniformBufferBindings;t++){const i=this._state.uniformBufferBindingPoints[t];if(null!=i){const{buffer:r,offset:n,size:s}=i;null!==r?0===n&&0===s?e.bindBufferBase(l.w0.UNIFORM_BUFFER,t,r.glName):e.bindBufferRange(l.w0.UNIFORM_BUFFER,t,r.glName,n,s):e.bindBufferBase(l.w0.UNIFORM_BUFFER,t,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(l.w0.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(l.w0.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(l.w0.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(l.w0.COPY_WRITE_BUFFER,null),e.bindFramebuffer(l.qi.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(l.qi.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(l.VY.COLOR_ATTACHMENT0)),e.bindFramebuffer(l.qi.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null),null===this._state.drawFramebuffer){const t=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(t??[l.Xg.BACK])}else{const t=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(t??[l.VY.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const e=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(e)}e.useProgram(this._state.program?.glName??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?.glName??null),!0===this._state.blend?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),!0===this._state.faceCulling?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let t=0;t<this.parameters.maxTextureImageUnits;t++){e.activeTexture(l.V1+t),e.bindTexture(l.No.TEXTURE_2D,null),e.bindTexture(l.No.TEXTURE_CUBE_MAP,null),e.bindTexture(l.No.TEXTURE_3D,null),e.bindTexture(l.No.TEXTURE_2D_ARRAY,null);const i=this._state.textureUnitMap[t];null!=i&&e.bindTexture(i.descriptor.target,i.glName)}e.activeTexture(l.V1+this._state.activeTexture);const t=this._state.viewport;e.viewport(t.x,t.y,t.width,t.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function B(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function V(e,t){switch(e){case l.MX.POINTS:return 2*t;case l.MX.TRIANGLES:return t/3;case l.MX.TRIANGLE_STRIP:case l.MX.TRIANGLE_FAN:return t-2;default:return 0}}},9229:(e,t,i)=>{i.d(t,{kG:()=>l});var r=i(70375),n=(i(39994),i(13802)),s=i(5224);const o=()=>n.Z.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class a{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class l extends a{constructor(){super(...arguments),this.vertex=new d,this.fragment=new d,this.attributes=new p,this.varyings=new f,this.extensions=new m,this.outputs=new g}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e,t=!1){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s="vertex"===e?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=s.main.generateSource(t),c="vertex"===e?v:_,u=s.constants.generateSource(),h=this.outputs.generateSource(e);return`#version 300 es\n${i.join("\n")}\n${c}\n${u.join("\n")}\n${o.join("\n")}\n${r.join("\n")}\n${n.join("\n")}\n${h.join("\n")}\n${a.join("\n")}\n${l.join("\n")}`}generateBind(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const i=e.bind[s.P.Bind];i&&t.set(e.name,i)})),this.fragment.uniforms.entries.forEach((e=>{const i=e.bind[s.P.Bind];i&&t.set(e.name,i)}));const i=Array.from(t.values()),r=i.length;return t=>{for(let n=0;n<r;++n)i[n](e,t)}}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const i=e.bind[s.P.Pass];i&&t.set(e.name,i)})),this.fragment.uniforms.entries.forEach((e=>{const i=e.bind[s.P.Pass];i&&t.set(e.name,i)}));const i=Array.from(t.values()),r=i.length;return(t,n)=>{for(let s=0;s<r;++s)i[s](e,t,n)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const i=e.bind[s.P.Draw];i&&t.set(e.name,i)})),this.fragment.uniforms.entries.forEach((e=>{const i=e.bind[s.P.Draw];i&&t.set(e.name,i)}));const i=Array.from(t.values()),r=i.length;return(t,n,s)=>{for(let o=0;o<r;++o)i[o](e,s,t,n)}}}class c{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const t of e)this._add(t);return this._stage}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new r.Z(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else o().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((e=>null!=e.arraySize?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class u{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(e){if(this._bodies.length>0)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];if(e)throw new r.Z("Shader does not contain main function body.");return[]}}class h{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}}class d extends a{constructor(){super(...arguments),this.uniforms=new c(this),this.main=new u(this),this.code=new h(this),this.constants=new y(this)}get builder(){return this}}class p{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class f{constructor(){this._entries=new Map}add(e,t){this._entries.has(e)?o().warn(`Ignoring duplicate varying ${t} ${e}`):this._entries.set(e,t)}generateSource(e){const t=new Array;return this._entries.forEach(((i,r)=>t.push("vertex"===e?`out ${i} ${r};`:`in ${i} ${r};`))),t}}class m{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?m.ALLOWLIST_VERTEX:m.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}m.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],m.ALLOWLIST_VERTEX=[];class g{constructor(){this._entries=new Map}add(e,t,i=0){const r=this._entries.get(i);r?.name!==e||r?.type!==t?this._entries.set(i,{name:e,type:t}):o().warn(`Fragment shader output location ${i} occupied`)}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:g.DEFAULT_NAME,type:g.DEFAULT_TYPE});const t=new Array;return this._entries.forEach(((e,i)=>t.push(`layout(location = ${i}) out ${e.type} ${e.name};`))),t}}g.DEFAULT_TYPE="vec4",g.DEFAULT_NAME="fragColor";class y{constructor(e){this._stage=e,this._entries=new Set}add(e,t,i){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":r=y._numberToFloatStr(i);break;case"int":r=y._numberToIntStr(i);break;case"bool":r=i.toString();break;case"vec2":r=`vec2(${y._numberToFloatStr(i[0])},                            ${y._numberToFloatStr(i[1])})`;break;case"vec3":r=`vec3(${y._numberToFloatStr(i[0])},                            ${y._numberToFloatStr(i[1])},                            ${y._numberToFloatStr(i[2])})`;break;case"vec4":r=`vec4(${y._numberToFloatStr(i[0])},                            ${y._numberToFloatStr(i[1])},                            ${y._numberToFloatStr(i[2])},                            ${y._numberToFloatStr(i[3])})`;break;case"ivec2":r=`ivec2(${y._numberToIntStr(i[0])},                             ${y._numberToIntStr(i[1])})`;break;case"ivec3":r=`ivec3(${y._numberToIntStr(i[0])},                             ${y._numberToIntStr(i[1])},                             ${y._numberToIntStr(i[2])})`;break;case"ivec4":r=`ivec4(${y._numberToIntStr(i[0])},                             ${y._numberToIntStr(i[1])},                             ${y._numberToIntStr(i[2])},                             ${y._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":r=`${t}(${Array.prototype.map.call(i,(e=>y._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${r};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const _="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n#endif",v="precision highp float;\nprecision highp sampler2D;"},43487:(e,t,i)=>{i.d(t,{x:()=>m});var r=i(70375),n=(i(39994),i(13802)),s=i(61681),o=i(78668),a=i(18809),l=i(6174),c=i(91907),u=i(43106),h=i(80479),d=i(85289),p=i(6717);const f=()=>n.Z.getLogger("esri/views/webgl/Texture");let m=class{constructor(e,t=null,i=null){if(this.type=u.B.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,this._compressionAbortController=(0,a.t)(null),"context"in e)this._descriptor=e,i=t;else{const i=p.r.validate(e,t);if(!i)throw new r.Z("Texture descriptor invalid");this._descriptor=i}this._descriptor.target===c.No.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return(0,h.G)(this._descriptor)}get cachedMemory(){return this.usedMemory}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}get isCompressing(){return null!==this._compressionAbortController.value}dispose(){this.abortCompression(),this._glName&&this._descriptor.context.instanceCounter.decrement(c._g.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,t){const i=this._descriptor;if(i.width!==e||i.height!==t){if(this._wasImmutablyAllocated)throw new r.Z("Immutable textures can't be resized!");i.width=e,i.height=t,this._descriptor.target===c.No.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.shouldCompress=e}setData(e){this.abortCompression(),!(0,d.w1)(e)&&this._descriptor.internalFormat&&this._descriptor.internalFormat in c.q_&&(this._descriptor.internalFormat=void 0),this._setData(e),!(0,d.w1)(e)&&this._descriptor.shouldCompress&&this._compressOnWorker(e)}updateData(e,t,i,s,o,a,l=0){a||f().error("An attempt to use uninitialized data!"),this._glName||f().error("An attempt to update uninitialized texture!");const c=this._descriptor;c.internalFormat=(0,d.Sn)(c);const{context:u,pixelFormat:h,dataType:p,target:m,isImmutable:g}=c;if(g&&!this._wasImmutablyAllocated)throw new r.Z("Cannot update immutable texture before allocation!");const y=u.bindTexture(this,n.Z.TEXTURE_UNIT_FOR_UPDATES,!0);(t<0||i<0||t+s>c.width||i+o>c.height)&&f().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:_}=u;l&&(s&&o||f().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),_.pixelStorei(_.UNPACK_SKIP_ROWS,l)),(0,d.E)(a)?_.texSubImage2D(m,e,t,i,s,o,h,p,a):(0,d.w1)(a)?_.compressedTexSubImage2D(m,e,t,i,s,o,c.internalFormat,a.levels[e]):_.texSubImage2D(m,e,t,i,s,o,h,p,a),l&&_.pixelStorei(_.UNPACK_SKIP_ROWS,0),u.bindTexture(y,n.Z.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,t,i,s,o,a,l,c){c||f().error("An attempt to use uninitialized data!"),this._glName||f().error("An attempt to update an uninitialized texture!");const u=this._descriptor;u.internalFormat=(0,d.Sn)(u);const{context:h,pixelFormat:p,dataType:m,isImmutable:g,target:y}=u;if(g&&!this._wasImmutablyAllocated)throw new r.Z("Cannot update immutable texture before allocation!");(0,d.px)(y)||f().warn("Attempting to set 3D texture data on a non-3D texture");const _=h.bindTexture(this,n.Z.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(n.Z.TEXTURE_UNIT_FOR_UPDATES),(t<0||i<0||s<0||t+o>u.width||i+a>u.height||s+l>u.depth)&&f().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=h;if((0,d.w1)(c))c=c.levels[e],v.compressedTexSubImage3D(y,e,t,i,s,o,a,l,u.internalFormat,c);else{const r=c;v.texSubImage3D(y,e,t,i,s,o,a,l,p,m,r)}h.bindTexture(_,n.Z.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(0===e.width||0===e.height)return;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new r.Z("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,(0,d.QY)(e)}e.samplingMode===c.cw.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=c.cw.LINEAR_MIPMAP_NEAREST):e.samplingMode===c.cw.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=c.cw.NEAREST_MIPMAP_NEAREST);const t=this._descriptor.context.bindTexture(this,n.Z.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(n.Z.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(t,n.Z.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new r.Z("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,(0,d.QY)(e)}e.samplingMode===c.cw.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=c.cw.LINEAR):e.samplingMode===c.cw.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=c.cw.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,(0,d.QY)(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1)}abortCompression(){this.isCompressing&&(this._compressionAbortController.value=(0,s.IM)(this._compressionAbortController.value))}_setData(e,t){const i=this._descriptor,s=i.context?.gl;if(!s)return;(0,l.zu)(s),this._glName||(this._glName=s.createTexture(),this._glName&&i.context.instanceCounter.increment(c._g.Texture,this)),(0,d.QY)(i);const o=i.context.bindTexture(this,n.Z.TEXTURE_UNIT_FOR_UPDATES);i.context.setActiveTexture(n.Z.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),(0,l.zu)(s);const a=t??i.target,u=(0,d.px)(a);if((0,d.E)(e))this._setDataFromTexImageSource(e,a);else{const{width:t,height:n,depth:o}=i;if(null==t||null==n)throw new r.Z("Width and height must be specified!");if(u&&null==o)throw new r.Z("Depth must be specified!");if(i.internalFormat=(0,d.Sn)(i),i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(a,i.internalFormat,i.hasMipmap,t,n,o),(0,d.w1)(e)){if(!(0,d.gP)(i.internalFormat))throw new r.Z("Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(e,i.internalFormat,a)}else this._texImage(a,0,i.internalFormat,t,n,o,e),(0,l.zu)(s),i.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),(0,l.zu)(s),i.context.bindTexture(o,n.Z.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let t=c.No.TEXTURE_CUBE_MAP_POSITIVE_X;t<=c.No.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:i,preMultiplyAlpha:r}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r?1:0)}_setDataFromTexImageSource(e,t){const{gl:i}=this._descriptor.context,r=this._descriptor;r.internalFormat=(0,d.Sn)(r);const n=(0,d.px)(t),{width:s,height:o,depth:a}=(0,d.t_)(e);r.width&&r.height,r.width||(r.width=s),r.height||(r.height=o),n&&r.depth,n&&(r.depth=a),r.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(t,r.internalFormat,r.hasMipmap,s,o,a),this._texImage(t,0,r.internalFormat,s,o,a,e),(0,l.zu)(i),r.hasMipmap&&(this.generateMipmap(),(0,l.zu)(i))}_setDataFromCompressedSource(e,t,i){const r=this._descriptor,{width:n,height:s,depth:o}=r,a=e.levels,l=(0,d.eE)(i,n,s,o),c=Math.min(l,a.length)-1;this._descriptor.context.gl.texParameteri(r.target,r.context.gl.TEXTURE_MAX_LEVEL,c),this._forEachMipmapLevel(((e,r,n,s)=>{const o=a[Math.min(e,a.length-1)];this._compressedTexImage(i,e,t,r,n,s,o)}),c)}_texStorage(e,t,i,n,s,o){const{gl:a}=this._descriptor.context;if(!(0,d.av)(t))throw new r.Z("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?(0,d.eE)(e,n,s,o):1;if((0,d.px)(e)){if(null==o)throw new r.Z("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,t,n,s,o)}else a.texStorage2D(e,l,t,n,s);this._wasImmutablyAllocated=!0}_texImage(e,t,i,n,s,o,a){const l=this._descriptor.context.gl,c=(0,d.px)(e),{isImmutable:u,pixelFormat:h,dataType:p}=this._descriptor;if(u){if(null!=a){const i=a;if(c){if(null==o)throw new r.Z("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,t,0,0,0,n,s,o,h,p,i)}else l.texSubImage2D(e,t,0,0,n,s,h,p,i)}}else{const u=a;if(c){if(null==o)throw new r.Z("Missing depth dimension for 3D texture upload");l.texImage3D(e,t,i,n,s,o,0,h,p,u)}else l.texImage2D(e,t,i,n,s,0,h,p,u)}}_compressedTexImage(e,t,i,n,s,o,a){const l=this._descriptor.context.gl,c=(0,d.px)(e);if(this._descriptor.isImmutable){if(null!=a)if(c){if(null==o)throw new r.Z("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,t,0,0,0,n,s,o,i,a)}else l.compressedTexSubImage2D(e,t,0,0,n,s,i,a)}else if(c){if(null==o)throw new r.Z("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,t,i,n,s,o,0,a)}else l.compressedTexImage2D(e,t,i,n,s,0,a)}async _compressOnWorker(e){if(!n.Z.compressionWorkerHandle||!n.Z.compressionWorkerHandle.isCompressible(e))return;const t=this._descriptor.context?.gl.getExtension("WEBGL_compressed_texture_etc"),i=this._descriptor.context?.gl.getExtension("WEBGL_compressed_texture_s3tc");if(t||i){const r=new AbortController;this._compressionAbortController.value=r;const s={data:await createImageBitmap(e),flipped:this.descriptor.flipped,width:e.width,height:e.height,hasMipmap:this._descriptor.hasMipmap,hasETC:!!t,hasS3TC:!!i};n.Z.compressionWorkerHandle.invoke(s,this._compressionAbortController.value.signal).then((e=>{e&&this.isCompressing&&this.glName&&(this._descriptor.internalFormat=e.internalFormat,this._setData(e.compressedTexture)),r===this._compressionAbortController.value&&(this._compressionAbortController.value=null)})).catch((e=>{(0,o.D_)(e)||r!==this._compressionAbortController.value||(this._compressionAbortController.value=null)}))}}_forEachMipmapLevel(e,t=1/0){let{width:i,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===c.No.TEXTURE_3D;if(null==i||null==n||l&&null==s)throw new r.Z("Missing texture dimensions for mipmap calculation");for(let r=0;e(r,i,n,s),o&&(1!==i||1!==n||l&&1!==s)&&!(r>=t);++r)i=Math.max(1,i>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}_applySamplingMode(){const e=this._descriptor,t=e.context?.gl;let i=e.samplingMode,r=e.samplingMode;i===c.cw.LINEAR_MIPMAP_NEAREST||i===c.cw.LINEAR_MIPMAP_LINEAR?(i=c.cw.LINEAR,e.hasMipmap||(r=c.cw.LINEAR)):i!==c.cw.NEAREST_MIPMAP_NEAREST&&i!==c.cw.NEAREST_MIPMAP_LINEAR||(i=c.cw.NEAREST,e.hasMipmap||(r=c.cw.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}_applyWrapMode(){const e=this._descriptor,t=e.context?.gl;"number"==typeof e.wrapMode?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}_applyAnisotropicFilteringParameters(){const e=this._descriptor,t=e.context.capabilities.textureFilterAnisotropic;t&&e.context.gl.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}};m.TEXTURE_UNIT_FOR_UPDATES=0,m.compressionWorkerHandle=null},80479:(e,t,i)=>{i.d(t,{G:()=>o,X:()=>s});var r=i(91907),n=i(62486);class s{constructor(e=0,t=e){this.width=e,this.height=t,this.target=r.No.TEXTURE_2D,this.pixelFormat=r.VI.RGBA,this.dataType=r.Br.UNSIGNED_BYTE,this.samplingMode=r.cw.LINEAR,this.wrapMode=r.e8.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.shouldCompress=!1,this.depth=1,this.isImmutable=!1}}function o(e){return e.width<=0||e.height<=0?0:Math.round(e.width*e.height*e.depth*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:(0,n.RG)(e.internalFormat))*(e.target===r.No.TEXTURE_CUBE_MAP?6:1))}},23474:(e,t,i)=>{i.d(t,{x:()=>n});i(39994);var r=i(5224);class n{constructor(e,t,i,n,s=null){if(this.name=e,this.type=t,this.arraySize=s,this.bind={[r.P.Bind]:null,[r.P.Pass]:null,[r.P.Draw]:null},n)switch(i){case void 0:break;case r.P.Bind:this.bind[r.P.Bind]=n;break;case r.P.Pass:this.bind[r.P.Pass]=n;break;case r.P.Draw:this.bind[r.P.Draw]=n}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}},62486:(e,t,i)=>{i.d(t,{HH:()=>o,RG:()=>u,UF:()=>c,XP:()=>l,_V:()=>a});i(39994);var r=i(6174),n=i(91907),s=i(13683);function o(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function a(e,t){return(e.vertexBuffers.get(t)?.usedMemory??0)/function(e){return e[0].stride}(e.layout.get(t))}function l(e,t,i,n,a=0){const l=e.gl;e.bindBuffer(i);for(const i of n){const n=t.get(i.name);if(null==n){console.warn(`There is no location for vertex attribute '${i.name}' defined.`);continue}const c=a*i.stride;if(i.count<=4)l.vertexAttribPointer(n,i.count,i.type,i.normalized,i.stride,i.offset+c),l.enableVertexAttribArray(n),i.divisor>0&&e.gl.vertexAttribDivisor(n,i.divisor);else if(9===i.count)for(let t=0;t<3;t++)l.vertexAttribPointer(n+t,3,i.type,i.normalized,i.stride,i.offset+12*t+c),l.enableVertexAttribArray(n+t),i.divisor>0&&e.gl.vertexAttribDivisor(n+t,i.divisor);else if(16===i.count)for(let t=0;t<4;t++)l.vertexAttribPointer(n+t,4,i.type,i.normalized,i.stride,i.offset+16*t+c),l.enableVertexAttribArray(n+t),i.divisor>0&&e.gl?.vertexAttribDivisor(n+t,i.divisor);else console.error("Unsupported vertex attribute element count: "+i.count);if((0,r.hZ)()){const t=o(e),r=(0,s.S)(i.type),n=i.offset,a=Math.round(r/n)!==r/n?`. Offset not a multiple of stride. DataType requires ${r} bytes, but descriptor has an offset of ${n}`:"";t&&console.error(`Unable to bind vertex attribute "${i.name}" with baseInstanceOffset ${c}${a}:`,t,i)}}}function c(e,t,i,r){const s=e.gl;e.bindBuffer(i);for(const i of r){const r=t.get(i.name);if(i.count<=4)s.disableVertexAttribArray(r),i.divisor&&i.divisor>0&&e.gl?.vertexAttribDivisor(r,0);else if(9===i.count)for(let t=0;t<3;t++)s.disableVertexAttribArray(r+t),i.divisor&&i.divisor>0&&e.gl?.vertexAttribDivisor(r+t,0);else if(16===i.count)for(let t=0;t<4;t++)s.disableVertexAttribArray(r+t),i.divisor&&i.divisor>0&&e.gl?.vertexAttribDivisor(r+t,0);else console.error("Unsupported vertex attribute element count: "+i.count)}e.unbindBuffer(n.w0.ARRAY_BUFFER)}function u(e){switch(e){case n.VI.ALPHA:case n.VI.LUMINANCE:case n.VI.RED:case n.VI.RED_INTEGER:case n.lP.R8:case n.lP.R8I:case n.lP.R8UI:case n.lP.R8_SNORM:case n.Tg.STENCIL_INDEX8:return 1;case n.VI.LUMINANCE_ALPHA:case n.VI.RG:case n.VI.RG_INTEGER:case n.lP.RGBA4:case n.lP.R16F:case n.lP.R16I:case n.lP.R16UI:case n.lP.RG8:case n.lP.RG8I:case n.lP.RG8UI:case n.lP.RG8_SNORM:case n.lP.RGB565:case n.lP.RGB5_A1:case n.Tg.DEPTH_COMPONENT16:return 2;case n.VI.DEPTH_COMPONENT:case n.VI.RGB:case n.VI.RGB_INTEGER:case n.lP.RGB8:case n.lP.RGB8I:case n.lP.RGB8UI:case n.lP.RGB8_SNORM:case n.lP.SRGB8:case n.Tg.DEPTH_COMPONENT24:return 3;case n.VI.DEPTH_STENCIL:case n.VI.DEPTH24_STENCIL8:case n.VI.RGBA:case n.VI.RGBA_INTEGER:case n.lP.RGBA8:case n.lP.R32F:case n.lP.R11F_G11F_B10F:case n.lP.RG16F:case n.lP.R32I:case n.lP.R32UI:case n.lP.RG16I:case n.lP.RG16UI:case n.lP.RGBA8I:case n.lP.RGBA8UI:case n.lP.RGBA8_SNORM:case n.lP.SRGB8_ALPHA8:case n.lP.RGB9_E5:case n.lP.RGB10_A2UI:case n.lP.RGB10_A2:case n.Tg.DEPTH_STENCIL:case n.Tg.DEPTH_COMPONENT32F:case n.Tg.DEPTH24_STENCIL8:return 4;case n.Tg.DEPTH32F_STENCIL8:return 5;case n.lP.RGB16F:case n.lP.RGB16I:case n.lP.RGB16UI:return 6;case n.lP.RG32F:case n.lP.RG32I:case n.lP.RG32UI:case n.lP.RGBA16F:case n.lP.RGBA16I:case n.lP.RGBA16UI:return 8;case n.lP.RGB32F:case n.lP.RGB32I:case n.lP.RGB32UI:return 12;case n.lP.RGBA32F:case n.lP.RGBA32I:case n.lP.RGBA32UI:return 16;case n.q_.COMPRESSED_RGB_S3TC_DXT1_EXT:case n.q_.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case n.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT:case n.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case n.q_.COMPRESSED_R11_EAC:case n.q_.COMPRESSED_SIGNED_R11_EAC:case n.q_.COMPRESSED_RGB8_ETC2:case n.q_.COMPRESSED_SRGB8_ETC2:case n.q_.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case n.q_.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case n.q_.COMPRESSED_RG11_EAC:case n.q_.COMPRESSED_SIGNED_RG11_EAC:case n.q_.COMPRESSED_RGBA8_ETC2_EAC:case n.q_.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}},6717:(e,t,i)=>{i.d(t,{r:()=>s});var r=i(91907),n=i(80479);class s extends n.X{constructor(e,t){switch(super(),this.context=e,Object.assign(this,t),this.internalFormat){case r.lP.R16F:case r.lP.R16I:case r.lP.R16UI:case r.lP.R32F:case r.lP.R32I:case r.lP.R32UI:case r.lP.R8_SNORM:case r.lP.R8:case r.lP.R8I:case r.lP.R8UI:this.pixelFormat=r.VI.RED}}static validate(e,t){return new s(e,t)}}},29620:(e,t,i)=>{i.d(t,{U:()=>c});var r=i(13802),n=i(61681),s=i(99235),o=i(91907),a=i(62486);const l=()=>r.Z.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,i,r,n=null){this._context=e,this._locations=t,this._layout=i,this._buffers=r,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((e,t)=>e+t.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(this._buffers.size+(this._indexBuffer?1:0))*s.Qi}get cachedMemory(){return this.usedMemory}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this._indexBuffer=(0,n.M2)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o._g.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(o._g.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:i}=this;e||l().error("Vertex buffer dictionary is empty!");const r=this._context.gl;this._buffers.forEach(((e,i)=>{const r=t.get(i);r?(0,a.XP)(this._context,this._locations,e,r):l().error("Vertex element descriptor is empty!")})),null!=i&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},41163:(e,t,i)=>{i.d(t,{G:()=>r});class r{constructor(e,t,i,r,n,s=!1,o=0){this.name=e,this.count=t,this.type=i,this.offset=r,this.stride=n,this.normalized=s,this.divisor=o}}},31873:(e,t,i)=>{i.d(t,{G:()=>n});var r=i(61681);class n{constructor(){this._result=!1}dispose(){this._program=(0,r.M2)(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}},35119:(e,t,i)=>{i.d(t,{h:()=>s});var r=i(52997);let n;function s(){return n??=function(){const e=new o,t=function(e){if("undefined"==typeof WebGL2RenderingContext)return null;const t=document.createElement("canvas");if(!t)return null;let i=t.getContext("webgl2",{failIfMajorPerformanceCaveat:!0});if(null==i&&(i=t.getContext("webgl2"),null!=i&&(e.majorPerformanceCaveat=!0)),null==i)return i;e.available=!0,e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(e.supportsHighPrecisionFragment=r.precision>0),i}(e);return null==t||(e.supportsColorBufferFloat=null!==t.getExtension("EXT_color_buffer_float"),e.supportsColorBufferFloatBlend=null!==t.getExtension("EXT_float_blend"),e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||null!==t.getExtension("EXT_color_buffer_half_float"),e.unmaskedRenderer=(0,r.F)(t,{debugRendererInfo:!0})?.getUnmaskedRendererWebGL()??"unknown"),e}(),n}class o{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1,this.unmaskedRenderer="unloaded"}}},52997:(e,t,i)=>{function r(e,t){const i=t.debugRendererInfo&&e.getExtension("WEBGL_debug_renderer_info");return i?{getUnmaskedRendererWebGL:()=>e.getParameter(i.UNMASKED_RENDERER_WEBGL)}:null}i.d(t,{F:()=>r})},33679:(e,t,i)=>{i.d(t,{P9:()=>n,mO:()=>s});class r{constructor(e,t,i,r,n,s,o,a,l){this.createQuery=e,this.deleteQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=n,this.beginTimeElapsed=s,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}let n=!1;function s(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i?new r((()=>e.createQuery()),(t=>{e.deleteQuery(t),n=!1}),(t=>e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)),(t=>e.getQueryParameter(t,e.QUERY_RESULT)),(()=>e.getParameter(i.GPU_DISJOINT_EXT)),(t=>{n||(n=!0,e.beginQuery(i.TIME_ELAPSED_EXT,t))}),(()=>{e.endQuery(i.TIME_ELAPSED_EXT),n=!1}),(e=>i.queryCounterEXT(e,i.TIMESTAMP_EXT)),(()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):(i=e.getExtension("EXT_disjoint_timer_query"),i?new r((()=>i.createQueryEXT()),(e=>{i.deleteQueryEXT(e),n=!1}),(e=>i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT)),(e=>i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)),(()=>e.getParameter(i.GPU_DISJOINT_EXT)),(e=>{n||(n=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,e))}),(()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),n=!1}),(e=>i.queryCounterEXT(e,i.TIMESTAMP_EXT)),(()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):null)}},6174:(e,t,i)=>{i.d(t,{CG:()=>l,CM:()=>o,hZ:()=>a,zu:()=>c});var r=i(70375),n=i(39994),s=i(13802);const o=!!(0,n.Z)("enable-feature:webgl-debug");function a(){return o}function l(){return o}function c(e){if(a()){const t=e.getError();if(t){const i=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),n=(new Error).stack;s.Z.getLogger("esri.views.webgl.checkWebGLError").error(new r.Z("webgl-error","WebGL error occurred",{message:i,stack:n}))}}}},30560:(e,t,i)=>{function r(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function n(e,t){const i=e.length;for(let r=0;r<i;++r)o[0]=e[r],t[r]=o[0];return t}function s(e,t){const i=e.length;for(let r=0;r<i;++r)o[0]=e[r],o[1]=e[r]-o[0],t[r]=o[1];return t}i.d(t,{GB:()=>s,LF:()=>r,U8:()=>n});const o=new Float32Array(2)},91907:(e,t,i)=>{var r,n,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,b,w,x;i.d(t,{Br:()=>_,Hf:()=>r,Ho:()=>w,LR:()=>l,Lu:()=>M,MX:()=>n,No:()=>m,Se:()=>R,Tg:()=>v,V1:()=>T,V7:()=>L,VI:()=>g,VY:()=>S,Wf:()=>c,Xg:()=>E,Y5:()=>I,_g:()=>C,cw:()=>p,db:()=>o,e8:()=>f,g:()=>u,l1:()=>b,lP:()=>y,q_:()=>A,qi:()=>x,w0:()=>a,wb:()=>h,xS:()=>d,zi:()=>s}),function(e){e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e[e.COLOR=16384]="COLOR"}(r||(r={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(n||(n={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(s||(s={})),function(e){e[e.ADD=32774]="ADD",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(o||(o={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(a||(a={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(l||(l={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(c||(c={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT"}(u||(u={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(h||(h={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(d||(d={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(p||(p={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(f||(f={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(m||(m={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(g||(g={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(y||(y={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(_||(_={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(v||(v={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(b||(b={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(w||(w={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(x||(x={}));const T=33984;var C,S,E;!function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.TransformFeedback=7]="TransformFeedback",e[e.Sync=8]="Sync",e[e.UNCOUNTED=9]="UNCOUNTED",e[e.LinesOfCode=9]="LinesOfCode",e[e.Uniform=10]="Uniform",e[e.COUNT=11]="COUNT"}(C||(C={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(S||(S={})),function(e){e[e.NONE=0]="NONE",e[e.BACK=1029]="BACK"}(E||(E={}));const M=33306;var A,R,O,P,I,L,D;!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"}(A||(A={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(R||(R={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(O||(O={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(P||(P={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(I||(I={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(L||(L={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(D||(D={}))},13683:(e,t,i)=>{i.d(t,{S:()=>n});var r=i(91907);function n(e){switch(e){case r.g.BYTE:case r.g.UNSIGNED_BYTE:return 1;case r.g.SHORT:case r.g.UNSIGNED_SHORT:case r.g.HALF_FLOAT:return 2;case r.g.FLOAT:case r.g.INT:case r.g.UNSIGNED_INT:return 4}}},17346:(e,t,i)=>{i.d(t,{Dh:()=>h,JI:()=>c,Rd:()=>d,a5:()=>a,ck:()=>m,di:()=>l,gf:()=>g,if:()=>s,jp:()=>$,sg:()=>p,sm:()=>E,wK:()=>o,xW:()=>u,zp:()=>f});var r=i(70984),n=i(91907);function s(e,t,i=n.db.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function o(e,t,i,r,s=n.db.ADD,o=n.db.ADD,a=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const a=s(n.zi.ZERO,n.zi.ONE_MINUS_SRC_ALPHA),l=s(n.zi.ONE,n.zi.ZERO),c=s(n.zi.ONE,n.zi.ONE),u=s(n.zi.ONE,n.zi.ONE_MINUS_SRC_ALPHA),h=o(n.zi.SRC_ALPHA,n.zi.ONE,n.zi.ONE_MINUS_SRC_ALPHA,n.zi.ONE_MINUS_SRC_ALPHA),d={face:n.LR.BACK,mode:n.Wf.CCW},p={face:n.LR.FRONT,mode:n.Wf.CCW},f=e=>e===r.Vr.Back?d:e===r.Vr.Front?p:null,m={zNear:0,zFar:1},g={r:!0,g:!0,b:!0,a:!0};function y(e){return R.intern(e)}function _(e){return P.intern(e)}function v(e){return L.intern(e)}function b(e){return N.intern(e)}function w(e){return U.intern(e)}function x(e){return z.intern(e)}function T(e){return V.intern(e)}function C(e){return G.intern(e)}function S(e){return Z.intern(e)}function E(e){return W.intern(e)}class M{constructor(e,t){this._makeKey=e,this._makeRef=t,this._interns=new Map}intern(e){if(!e)return null;const t=this._makeKey(e),i=this._interns;return i.has(t)||i.set(t,this._makeRef(e)),i.get(t)??null}}function A(e){return"["+e.join(",")+"]"}const R=new M(O,(e=>({__tag:"Blending",...e})));function O(e){return e?A([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const P=new M(I,(e=>({__tag:"Culling",...e})));function I(e){return e?A([e.face,e.mode]):null}const L=new M(D,(e=>({__tag:"PolygonOffset",...e})));function D(e){return e?A([e.factor,e.units]):null}const N=new M(F,(e=>({__tag:"DepthTest",...e})));function F(e){return e?A([e.func]):null}const U=new M(k,(e=>({__tag:"StencilTest",...e})));function k(e){return e?A([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const z=new M(B,(e=>({__tag:"DepthWrite",...e})));function B(e){return e?A([e.zNear,e.zFar]):null}const V=new M(H,(e=>({__tag:"ColorWrite",...e})));function H(e){return e?A([e.r,e.g,e.b,e.a]):null}const G=new M(j,(e=>({__tag:"StencilWrite",...e})));function j(e){return e?A([e.mask]):null}const Z=new M(q,(e=>({__tag:"DrawBuffers",...e})));function q(e){return e?A(e.buffers):null}const W=new M((function(e){return e?A([O(e.blending),I(e.culling),D(e.polygonOffset),F(e.depthTest),k(e.stencilTest),B(e.depthWrite),H(e.colorWrite),j(e.stencilWrite),q(e.drawBuffers)]):null}),(e=>({blending:y(e.blending),culling:_(e.culling),polygonOffset:v(e.polygonOffset),depthTest:b(e.depthTest),stencilTest:w(e.stencilTest),depthWrite:x(e.depthWrite),colorWrite:T(e.colorWrite),stencilWrite:C(e.stencilWrite),drawBuffers:S(e.drawBuffers)})));class ${constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,t,i,r){return(i||e!==t)&&(r(e),this._pipelineInvalid=!0),e}}},61581:(e,t,i)=>{i.d(t,{d:()=>h});var r=i(27894),n=i(78951),s=i(91907),o=i(18567),a=i(43487),l=i(80479),c=i(29620),u=i(31873);class h extends u.G{constructor(e){super(),this._rctx=e;this._program=e.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const t=this._rctx;if(!t.gl)return e.dispose(),!0;const i=new l.X(1);i.wrapMode=s.e8.CLAMP_TO_EDGE,i.samplingMode=s.cw.NEAREST;const u=new o.X(t,i),h=n.f.createVertex(t,s.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),p=new c.U(t,new Map([["a_pos",0]]),r.cD,new Map([["geometry",h]])),f=new l.X;f.samplingMode=s.cw.LINEAR,f.wrapMode=s.e8.CLAMP_TO_EDGE;const m=new a.x(t,f,d);t.useProgram(e),t.bindTexture(m,0),e.setUniform1i("u_texture",0);const g=t.getBoundFramebufferObject(),{x:y,y:_,width:v,height:b}=t.getViewport();t.bindFramebuffer(u),t.setViewport(0,0,1,1),t.setClearColor(0,0,0,0),t.setBlendingEnabled(!1),t.clear(s.Hf.COLOR),t.bindVAO(p),t.drawArrays(s.MX.TRIANGLE_STRIP,0,4);const w=new Uint8Array(4);return u.readPixels(0,0,1,1,s.VI.RGBA,s.Br.UNSIGNED_BYTE,w),p.dispose(),u.dispose(),m.dispose(),t.setViewport(y,_,v,b),t.bindFramebuffer(g),255!==w[0]}}const d=new Image;d.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",d.width=5,d.height=5,d.decode()},85289:(e,t,i)=>{i.d(t,{E:()=>h,QY:()=>o,Sn:()=>f,av:()=>a,eE:()=>p,gP:()=>l,p6:()=>u,px:()=>d,t_:()=>m,w1:()=>c});var r=i(70375),n=i(13802),s=i(91907);function o(e){(null!=e.width&&e.width<0||null!=e.height&&e.height<0||null!=e.depth&&e.depth<0)&&n.Z.getLogger("esri/views/webgl/textureUtils").error("Negative dimension parameters are not allowed!")}function a(e){return e in s.lP}function l(e){return e in s.q_}function c(e){return null!=e&&"type"in e&&"compressed"===e.type}function u(e){return!!e.descriptor.internalFormat&&l(e.descriptor.internalFormat)}function h(e){return null!=e&&!c(e)&&!function(e){return null!=e&&"byteLength"in e}(e)}function d(e){return e===s.No.TEXTURE_3D||e===s.No.TEXTURE_2D_ARRAY}function p(e,t,i,r=1){let n=Math.max(t,i);return e===s.No.TEXTURE_3D&&(n=Math.max(n,r)),Math.floor(Math.log2(n))+1}function f(e){if(null!=e.internalFormat)return e.internalFormat===s.VI.DEPTH_STENCIL?s.VI.DEPTH24_STENCIL8:e.internalFormat;switch(e.dataType){case s.Br.FLOAT:switch(e.pixelFormat){case s.VI.RGBA:return s.lP.RGBA32F;case s.VI.RGB:return s.lP.RGB32F;default:throw new r.Z("Unable to derive format")}case s.Br.UNSIGNED_BYTE:switch(e.pixelFormat){case s.VI.RGBA:return s.lP.RGBA8;case s.VI.RGB:return s.lP.RGB8}}return e.internalFormat=e.pixelFormat===s.VI.DEPTH_STENCIL?s.VI.DEPTH24_STENCIL8:e.pixelFormat}function m(e){let t="width"in e?e.width:e.codedWidth,i="height"in e?e.height:e.codedHeight;return e instanceof HTMLVideoElement&&(t=e.videoWidth,i=e.videoHeight),{width:t,height:i,depth:1}}},78621:(e,t,i)=>{i.d(t,{a:()=>n,b:()=>s});var r=i(7283);function n(e){const t=(0,r.vU)(100*(1-e));return Math.max(0,Math.min(t,100))}function s(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}},83415:(e,t,i)=>{i.d(t,{H:()=>a,b:()=>l});var r=i(70375),n=i(78668),s=i(12173),o=i(68611);async function a(e,t,i){const r=await c(e,t,i);await u(r,t,i)}async function l(e,t,i,r,n){const s=await c(i,r,n);await e.update({data:t}),await u(s,r,n)}async function c(e,t,a){if(!t?.resources)return;const l=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const c=new Set(t.resources.toKeep.map((e=>e.resource.path))),u=new Set,h=[];c.forEach((t=>{l.delete(t),e.paths.push(t)}));const d=[],p=[],f=[];for(const i of t.resources.toUpdate)if(l.delete(i.resource.path),c.has(i.resource.path)||u.has(i.resource.path)){const{resource:t,content:r,finish:n}=i,a=(0,o.getSiblingOfSameTypeI)(t,(0,s.DO)());e.paths.push(a.path),d.push({resource:a,content:await(0,o.contentToBlob)(r),compress:i.compress}),n&&f.push((()=>n(a)))}else{e.paths.push(i.resource.path),p.push({resource:i.resource,content:await(0,o.contentToBlob)(i.content),compress:i.compress});const t=i.finish;t&&f.push((()=>t(i.resource))),u.add(i.resource.path)}for(const i of t.resources.toAdd)if(e.paths.push(i.resource.path),l.has(i.resource.path))l.delete(i.resource.path);else{d.push({resource:i.resource,content:await(0,o.contentToBlob)(i.content),compress:i.compress});const e=i.finish;e&&f.push((()=>e(i.resource)))}if(d.length||p.length){const{addOrUpdateResources:e}=await Promise.resolve().then(i.bind(i,68611));await e(t.portalItem,d,"add",a),await e(t.portalItem,p,"update",a)}if(f.forEach((e=>e())),0===h.length)return l;const m=await(0,n.UO)(h);if((0,n.k_)(a),m.length>0)throw new r.Z("save:resources","Failed to save one or more resources",{errors:m});return l}async function u(e,t,i){if(!e||!t.portalItem)return;const r=[];for(const n of e){const e=t.portalItem.resourceFromPath(n);r.push(e.portalItem.removeResource(e,i))}await(0,n.as)(r)}},60629:(e,t,i)=>{i.d(t,{P:()=>n,z:()=>o});var r=i(70375);async function n(e){const t=[];for(const i of e.allLayers)if("beforeSave"in i&&"function"==typeof i.beforeSave){const e=i.beforeSave();e&&t.push(e)}await Promise.allSettled(t)}const s=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function o(e,t,i){let n=(e.messages??[]).filter((({type:e})=>"error"===e)).map((({name:e,message:t,details:i})=>new r.Z(e,t,i)));if(e.blockedRelativeUrls&&(n=n.concat(e.blockedRelativeUrls.map((e=>new r.Z("url:unsupported",`Relative url '${e}' is not supported`))))),i){const{ignoreUnsupported:e,supplementalUnsupportedErrors:t=[],requiredPropertyChecksDisabled:r}=i;e&&(n=n.filter((({name:e})=>!(s.has(e)||t.includes(e))))),r&&(n=n.filter((e=>"web-document-write:property-required"!==e.name)))}if(n.length>0)throw new r.Z(t.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}},4e4:(e,t,i)=>{i.d(t,{Nw:()=>f});var r=i(70375),n=i(67134),s=i(86745),o=i(64626),a=i(54957);const l=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wcs","wms","wmts"]),c=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wcs","wfs","wms","wmts"]),u=new Set([...c,"link-chart"]);function h(e,t){if(t.restrictedWebMapWriting){const i=function(e){switch(e.layerContainerType){case"basemap":return l;case"operational-layers":return"link-chart"===e.origin?u:c;default:return null}}(t);return null==i||i.has(e.type)&&!(0,a.rQ)(e)}return!0}function d(e,t){"maxScale"in e&&(t.maxScale=(0,o.k)(e.maxScale)??void 0),"minScale"in e&&(t.minScale=(0,o.k)(e.minScale)??void 0)}function p(e,t){if(function(e,t){if(t)if((0,a.rQ)(e)){const i=(0,s.hS)("featureCollection.layers",t)?.[0]?.layerDefinition;i&&d(e,i)}else"group"!==e.type&&d(e,t)}(e,t),t&&(t.id=e.id,"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=(0,o.k)(e.opacity)??void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type))if((0,a.rQ)(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function f(e,t,i){if(!e.persistenceEnabled)return null;if(!("write"in e)||!e.write)return i?.messages&&i.messages.push(new r.Z("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if((0,a.rQ)(e)&&!e.isTable)t=e.resourceInfo;else if(h(e,i)){const t={};return e.write(t,i)?t:null}return null!=t&&p(e,t=(0,n.d9)(t)),t}},96726:(e,t,i)=>{i.d(t,{s:()=>s});var r=i(26139);class n extends r.G{constructor(e,t){super(e,t,"webmap")}}function s(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass}new n(2,33)},5226:(e,t,i)=>{i.d(t,{e:()=>r});const r=1/255.5},50201:(e,t,i)=>{i.d(t,{_v:()=>s,eq:()=>o,k2:()=>n});const r="ProfileGenerationError";var n;!function(e){e.TooComplex="too-complex",e.InvalidGeometry="invalid-geometry",e.InvalidElevationInfo="invalid-elevation-info",e.ElevationQueryError="elevation-query-error"}(n||(n={}));class s extends Error{constructor(e){super("profile could not be generated",{cause:e}),this.type=r}}function o(e){return e.type===r}},89815:(e,t,i)=>{i.d(t,{J8:()=>n,TH:()=>h,dd:()=>r,h8:()=>u,iE:()=>c});var r,n,s=i(17321),o=i(52721),a=i(7358);!function(e){e.Disabled="disabled",e.Ready="ready",e.Creating="creating",e.Created="created",e.Selecting="selecting",e.Selected="selected"}(r||(r={})),function(e){e.NoValidInput="no-valid-input",e.NoVisibleProfiles="no-visible-profiles",e.InvalidGeometry="invalid-geometry",e.TooComplex="too-complex",e.InvalidElevationInfo="invalid-elevation-info",e.UnknownError="unknown-error",e.RefinedButNoChartData="refined-but-no-chart-data",e.None="none"}(n||(n={}));let l={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:l.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:(0,s.En)(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesStyle3D:{width:3,falloff:0,innerWidth:0,innerColor:(0,o.al)(0,0,0,0),renderOccluded:a.yD.Opaque},profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function c(){return l}const u="  ",h={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null}},28179:(e,t,i)=>{i.d(t,{G9:()=>v,OH:()=>f,WC:()=>A,l9:()=>b});var r=i(19431),n=i(78668),s=i(17321),o=i(36531),a=i(86717),l=i(90819),c=i(90472),u=i(14685),h=i(85130),d=i(83772),p=i(50201);async function f(e,t,r,o,a,l,d){let f,y,_;const v=e.spatialReference,b=v.isGeographic||v.isWebMercator;let A=0;if(!b){const{planarLength:t}=await i.e(15917).then(i.bind(i,15917));(0,n.k_)(d),A=await t(e,"meters"),(0,n.k_)(d)}const O=1/(0,s.c9)(o);if(b){await(0,c.initializeProjection)([{source:v,dest:o},{source:v,dest:u.Z.WGS84}],d);const i=function(e){return(0,h.Gb)(e.spatialReference)?e:(0,c.project)(e,u.Z.WGS84)}(e);f=(0,h.Jf)([i],"meters")[0];const n=m(f,a);if(R(e,f,n)>l)throw new p._v(p.k2.TooComplex);const s=g(i,t,r);({densifiedPath:y,distances:_}=function(e,t,i){const{hasZ:r}=e;return w(e,t,i,x,r?S:C)}(s,n,O)),y=(0,c.project)(y,o)}else{await(0,c.initializeProjection)([{source:v,dest:o}],d),f=A;const i=m(f,a);if(R(e,f,i)>l)throw new p._v(p.k2.TooComplex);const s=g(e,t,r);({densifiedPath:y,distances:_}=function(e,t,i){const{hasZ:r}=e;return w(e,t,i,T,r?M:E)}(s,i,O)),(0,n.k_)(d),y=(0,c.project)(y,o)}return{densifiedPath:y,pathLength:f*O,distances:_}}function m(e,t){const i=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,i)}function g(e,t,i){if(null==t)return y(e);const r=e.spatialReference,n=t.mode,s=(0,d.ap)(t,r);let o=null;switch(i.type){case"2d":o=function({hasZ:e},t,i){return"absolute-height"===t?e?([e,t,r])=>[e,t,r+i]:([e,t])=>[e,t,i]:null}(e,n,s);break;case"3d":o=function({spatialReference:e,hasZ:t},i,r,{elevationProvider:n}){const s=(t,i,r,s)=>n?.getElevation(t,i,r,e,s)??0;switch(i){case"on-the-ground":return([e,t])=>[e,t,s(e,t,0,"ground")];case"absolute-height":return t?([e,t,i])=>[e,t,i+r]:([e,t])=>[e,t,r];case"relative-to-ground":return t?([e,t,i])=>[e,t,i+s(e,t,i,"ground")+r]:([e,t])=>[e,t,s(e,t,0,"ground")+r];case"relative-to-scene":return t?([e,t,i])=>[e,t,i+s(e,t,i,"scene")+r]:([e,t])=>[e,t,s(e,t,0,"scene")+r];default:return null}}(e,n,s,i)}return null==o?y(e):new l.Z({hasZ:!0,hasM:!1,spatialReference:r,paths:_(e.paths,o)})}function y(e){return e.hasZ?new l.Z({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:_(e.paths,(([e,t])=>[e,t]))}):e}function _(e,t){const i=e.length,r=new Array(i);for(let n=0;n<i;++n){const i=e[n],s=i.length,o=new Array(i.length);r[n]=o;for(let e=0;e<s;++e)o[e]=t(i[e])}return r}function v(e){return b(e)&&e.paths.length>0&&e.paths.every((e=>e.length>=2))}function b(e){return null!=e&&"polyline"===e.type}function w(e,t,i,n,o){const{spatialReference:a,hasZ:c}=e,u={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:a,metersPerSR:(0,s.c9)(a)},h=[],d=[];let p=0;for(let s=0;s<e.paths.length;++s){const a=e.paths[s],l=new Array,c=new Array;let f=0;for(let e=1;e<a.length;++e){const s=a[e-1],h=a[e],d=n(u,s,h);let m;for(m=f;m<d.distance&&!(0,r.Po)(m,d.distance);m+=t)l.push(o(d,m)),c.push((p+m)*i);f=m-d.distance,p+=d.distance,l.push(h),c.push(p*i)}h[s]=l,d[s]=c}return{densifiedPath:new l.Z({spatialReference:a,hasZ:c,paths:h}),distances:d}}function x(e,t,i){return e.distance=0,(0,h.cA)(e,t,i,e.spatialReference),e.from=t,e.to=i,e}function T(e,t,i){return e.from=t,e.to=i,e.distance=(0,o.TE)(i,t)*e.metersPerSR,e}function C({from:e,azimuth:t,spatialReference:i},r){return(0,h.TB)([0,0],e,t,r,i)}function S({from:e,to:t,azimuth:i,distance:n,spatialReference:s},o){const a=o/n,l=[0,0,(0,r.t7)(e[2],t[2],a)];return(0,h.TB)(l,e,i,o,s),l}function E({from:e,to:t,distance:i},r){return(0,o.t7)([0,0],e,t,r/i)}function M({from:e,to:t,distance:i},r){return(0,a.m)([0,0,0],e,t,r/i)}function A(e){return e.paths.reduce(((e,t)=>e+t.length),0)}function R(e,t,i){return A(e)+Math.floor(t/i)+Math.max(0,e.paths.reduce((e=>1+e),0)-1)}},29214:(e,t,i)=>{function r(e,{profiles:t}){const i=e.title;if(null!=i)return i;switch(e.type){case"ground":return t.ground;case"input":return t.input;case"query":return t.query;case"view":return t.view;default:return""}}i.d(t,{f:()=>r})},46284:(e,t,i)=>{i.d(t,{hG:()=>E,Qr:()=>b,m7:()=>y});var r=i(7753),n=i(19431),s=i(78668),o=i(74304),a=i(38028),l=i(35925),c=i(86111),u=i(22167),h=i(89815),d=i(28179),p=i(50201),f=i(84322);function m(e,t,i=[]){if(e>=t)return i;if(i.push(e),t-e<2)return i;const r=t-1;i.push(r);const n=g(e+1,r);for(;;){const e=n.next();if(e.done)break;i.push(e.value)}return i}function*g(e,t){if(e>=t)return;const i=e+Math.floor((t-e)/2);yield i;const r=g(e,i),n=g(i+1,t);for(;;){const e=r.next(),t=n.next();if(e.done&&t.done)break;e.done||(yield e.value),t.done||(yield t.value)}}async function*y(e,t){const{view:i,geometry:r,elevationInfo:n,providers:o,options:a}=e,l=i.spatialReference;if(!l||null==r||!(0,d.G9)(r))throw new p._v(p.k2.InvalidGeometry);const c=o.length;if(0===c)return null;const u=Math.round(a.maxTotalSamples/c);if((0,d.WC)(r)>u)throw new p._v(p.k2.TooComplex);const f=await(0,d.OH)(r,n,i,l,a,u,t);let m=0;const g=new Array(c),y=new Array(c);for(let i=0;i<c;i++){const r=x(f);g[i]=r,m+=r.samples.length;const n={...e,provider:o[i],result:r,densificationResult:f};y[i]=_(n,t)[Symbol.iterator]()}if(m>a.maxTotalSamples)throw new p._v(p.k2.TooComplex);const v=await Promise.all(y.map((e=>{const t=e.next();return!0===t.done?Promise.resolve(null):t.value})));(0,s.k_)(t);for(let e=0;e<c;e++)g[e]=v[e];yield g,await(0,s.e4)(e.delayAfterPreview??(0,h.iE)().delayAfterPreviewMillis,null,t.signal);const b=[];try{let e;do{e=!1;for(let t=0;t<c;t++){const i=y[t].next();!1===i.done&&(b.push({resultPromise:i.value,index:t}),e=!0)}}while(e)}finally{y.forEach((e=>e.return?.()))}for(const{resultPromise:e,index:i}of b)g[i]=await e,(0,s.k_)(t),yield g;for(const e of g)null!=e&&(e.progress=1);yield g}function*_(e,t){const{densificationResult:i}=e,n={...e,abortOptions:t,densificationResult:i},s=m(0,n.result.samples.length),o=s.slice(0,n.provider.numSamplesForPreview);yield v(n,o,!0);const a=(0,r.vr)(s,n.provider.numSamplesPerChunk);for(const e of a)yield v(n,e,!1)}async function v({densificationResult:e,result:t,provider:i,queue:r,abortOptions:n,cache:a},l,c){const{densifiedPath:u,pathLength:d}=e,p=t.spatialReference,{samples:f}=t,m=[];for(let e=0;e<l.length;e++){const t=f[l[e]];m[e]=t.coordinate}try{return await r.push({geometry:new o.Z({spatialReference:p,points:m,hasZ:u.hasZ}),provider:i,indices:l,preview:c,result:t,queryOptions:{...(0,h.iE)().defaultQueryOptions(),minDemResolution:c?Math.round(d/i.numSamplesForPreview):Math.round(d/f.length),cache:a}},n),{...t}}catch(e){return(0,s.D_)(e)?null:h.TH}}function b(e){return new c.c({priority:u.T8.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async e=>{(0,s.k_)(e.queryOptions);try{await async function({geometry:e,provider:t,indices:i,preview:r,result:n,queryOptions:s}){if(0===i.length)return;const o=(await async function(e,t,i){try{return await e.queryElevation(t,i)}catch(e){throw new p._v(p.k2.ElevationQueryError)}}(t,e,s)).geometry,{hasZ:a,points:l}=o,c=s.noDataValue,{samples:u}=n;for(let e=0;e<i.length;e++){const t=u[i[e]];if(t.isHole)continue;const r=a?l[e][2]:null;null===r||r===c?t.sampledZ=null:(n.hasZ=!0,t.sampledZ=r),t.sampled=!0}(function(e){const t=e.length-1;let i=0;for(let r=1;r<=t;r++)(e[r].sampled||r===t)&&(w(e,i,r),i=r)})(u),n.progress=r?0:n.progress+i.length/u.length,n.statistics=(0,f.aC)(n.samples,n.spatialReference)}(e)}catch(e){(0,s.H9)(e)}}})}function w(e,t,i){if(i-t==1)return;const r=e[t],s=r.sampledZ,o=e[i],a=o.sampledZ;if(null==s||null==a){for(let r=t+1;r<i;r++)e[r].sampledZ=null;return}const l=r.distance,c=o.distance-l;for(let r=t+1;r<i;r++){const t=e[r],i=(t.distance-l)/c;t.sampledZ=(0,n.t7)(s,a,i)}}function x({densifiedPath:e,distances:t}){const i=e.spatialReference,r=(0,l.C5)(i),n=e.paths,s=n.length,o=[];let c=null,u=0;for(let e=0;e<s;e++){const i=n[e],s=i.length,l=t[e];for(let e=0;e<s;e++){const t=i[e],n=l[e];r&&(t[0]=(0,a.gQ)(t[0],r.valid[0],r.valid[1])),c&&0===e&&T(o,c,t,u,n),o.push(C(t,n)),c=t,u=n}}return{progress:0,samples:o,hasZ:!1,statistics:null,spatialReference:i}}function T(e,t,i,r,n){e.push(S(t,r)),e.push(S(i,n))}function C(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function S(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}function E(e,t,i){if(!e||0===e.length)return;const r=e.length-1,n=e[0];if(t<=i(n))return n;const s=e[r];if(t>=i(s))return s;let o=0,a=0,l=r;for(;o<l;){a=o+Math.floor((l-o)/2);const n=e[a],s=i(n);if(s===t)return n;if(t<s){if(a>0){const r=e[a-1],o=i(r);if(t>o)return t-o>=s-t?n:r}l=a}else{if(a<r){const r=e[a+1],o=i(r);if(t<o)return t-s>=o-t?r:n}o=a+1}}return e[a]}},84322:(e,t,i)=>{i.d(t,{Ds:()=>a,aC:()=>o,lg:()=>l});var r=i(7753),n=i(17321),s=i(89815);function o(e,t){const i=e.length;if(0===i)return null;const r=e[0],o=r.sampledZ;let a=o,l=o,h=0,p=0,f=null,m=null,g=null!=o?o:0,y=0,_=0,v=null!=o?1:0,b=0,w=0;const x=(0,n.c9)(t),T=(0,n._R)(t),C=(0,s.iE)().minSlopeSampleDistance/x,S=2*C,E=new d,M=new d,A=()=>{O(),E.copy(M),M.reset()},R=(e,t)=>{A(),e>0&&e-E.start<=S&&(e=E.start+C),M.restart(e,t)},O=()=>{if(E.isHole||M.isHole)return;const e=M.avgElevation-E.avgElevation,t=M.start-E.start,i=e*T,r=t*x,s=(0,n.En)(Math.atan2(i,r),"radians","degrees");s>0?(y+=s,f=u(f,s),b++):s<0&&(_-=s,m=u(m,-s),w++)};null!=r.sampledZ&&R(r.distance,r.sampledZ);for(let t=1;t<i;++t){const i=e[t-1],r=e[t],n=r.sampledZ;if(null==n){M.isHole||A();continue}v++,g+=n,a=c(a,n),l=u(l,n),M.isHole||r.distance-M.start>=C?R(r.distance,n):M.insert(n);const s=i.sampledZ;if(null!=s){const e=n-s;e>0?h+=e:e<0&&(p-=e)}}return A(),0===v?null:{maxDistance:e[i-1].distance,minElevation:a,maxElevation:l,avgElevation:0===v?null:g/v,elevationGain:h,elevationLoss:p,maxPositiveSlope:f,maxNegativeSlope:m,avgPositiveSlope:0===b?null:y/b,avgNegativeSlope:0===w?null:_/w}}function a(e){const t=e.filter(r.pC),i=t.length;if(0===i)return null;const n=t[0];if(1===i)return n;let s=n.maxDistance,o=n.minElevation,a=n.maxElevation,l=n.maxPositiveSlope,h=n.maxNegativeSlope;for(let e=1;e<t.length;++e){const i=t[e];s=u(s,i.maxDistance),o=c(o,i.minElevation),a=u(a,i.maxElevation),l=u(l,i.maxPositiveSlope),h=u(h,i.maxNegativeSlope)}return{maxDistance:s,minElevation:o,maxElevation:a,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:l,maxNegativeSlope:h,avgPositiveSlope:null,avgNegativeSlope:null}}function l(e){let t=null,i=null,r=null;for(const s of e){if(null==s)continue;const{statistics:e,spatialReference:o}=s;if(null==e)continue;const a=(0,n.c9)(o);t=u(t,h(e.maxDistance,a));const l=(0,n._R)(o);r=c(r,h(e.minElevation,l)),i=u(i,h(e.maxElevation,l))}return{minDistance:0,maxDistance:t??0,minElevation:r??0,maxElevation:i??0}}function c(e,t){return null==t?e:null!=e?Math.min(e,t):t}function u(e,t){return null==t?e:null!=e?Math.max(e,t):t}function h(e,t){return null!=e&&null!=t?e*t:null}class d{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return 0===this._sampleCount}get start(){return this._start}copy(e){this._start=e._start,this._sampleCount=e._sampleCount,this._totalElevation=e._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(e,t){this._start=e,this._sampleCount=1,this._totalElevation=t}insert(e){++this._sampleCount,this._totalElevation+=e}}},94203:(e,t,i)=>{i.d(t,{Z:()=>ae});var r=i(36663),n=i(41831),s=i(70375),o=i(31355),a=i(23148),l=(i(39994),i(13802)),c=i(61681),u=i(78668),h=i(76868),d=i(81977),p=(i(4157),i(40266)),f=i(98940),m=i(69442),g=i(90472),y=i(38028),_=i(35925),v=i(45857),b=i(54957),w=i(88283),x=i(83849),T=i(43411),C=i(15498),S=i(1759),E=i(9539),M=i(24567),A=i(71271),R=i(83772);function O(e){return function(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return{result:M.h.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:M.h.GEOMETRY_MISSING};if((0,R.XH)(e.elevationInfo))return{result:M.h.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,i=e.operations.data.geometry;return"point"===t||"mesh"===t||"polyline"===t||"polygon"===t?{result:M.h.SUPPORTED,geometry:i}:{result:M.h.GEOMETRY_TYPE_UNSUPPORTED}}(e).result}var P=i(8365),I=i(97737),L=i(41775),D=i(41386),N=i(4399),F=i(35329),U=i(98051),k=i(97682),z=i(8593),B=i(22519),V=i(19832),H=i(38114),G=i(27755);let j=class extends o.Z.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,G.Bg)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",(()=>{this.canUndo()&&e()}))}set redo(e){this._set("redo",(()=>{this.canRedo()&&e()}))}};(0,r._)([(0,d.Cb)()],j.prototype,"activeComponent",void 0),(0,r._)([(0,d.Cb)()],j.prototype,"cancelled",void 0),(0,r._)([(0,d.Cb)()],j.prototype,"history",void 0),(0,r._)([(0,d.Cb)()],j.prototype,"tool",null),(0,r._)([(0,d.Cb)()],j.prototype,"type",void 0),(0,r._)([(0,d.Cb)()],j.prototype,"canUndo",null),(0,r._)([(0,d.Cb)()],j.prototype,"canRedo",null),(0,r._)([(0,d.Cb)()],j.prototype,"onEnd",void 0),(0,r._)([(0,d.Cb)()],j.prototype,"undo",null),(0,r._)([(0,d.Cb)()],j.prototype,"redo",null),(0,r._)([(0,d.Cb)()],j.prototype,"toggleTool",void 0),(0,r._)([(0,d.Cb)()],j.prototype,"addToSelection",void 0),(0,r._)([(0,d.Cb)()],j.prototype,"removeFromSelection",void 0),j=(0,r._)([(0,p.j)("esri.widgets.Sketch.support.OperationHandle")],j);let Z=class extends j{};(0,r._)([(0,d.Cb)()],Z.prototype,"activeComponent",void 0),Z=(0,r._)([(0,p.j)("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],Z);let q=class extends j{};var W;(0,r._)([(0,d.Cb)()],q.prototype,"activeComponent",void 0),q=(0,r._)([(0,p.j)("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],q),function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"}(W||(W={}));const $={defaultZ:0},Y={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let J=class extends o.Z.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new f.R,this._internalGraphicsLayer=new v.Z({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new S.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new T.Z({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new C.Z({color:[130,130,130,1],width:2}),this.meshSymbol=new x.Z({symbolLayers:new n.Z([new w.Z])}),this.updateGraphics=new n.Z,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new S.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new N.Z,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=$,this.defaultUpdateOptions=Y,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new z.Z}initialize(){this.addHandles([(0,h.on)((()=>this.view?.map?.layers),"change",(e=>{e.removed.includes(this.layer)&&this.cancel()})),(0,h.on)((()=>this.layer?.graphics),"change",(e=>{if(null!=this._operationHandle)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())})),(0,h.watch)((()=>this.layer?.elevationInfo??null),(e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)}),h.syncAndInitial),(0,h.watch)((()=>this.view),(e=>{this._defaultSnappingManager=(0,c.SC)(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new k.N({view:e,options:this.snappingOptions})),"2d"===e.type?Promise.all([i.e(89067),i.e(4708),i.e(72257),i.e(84427),i.e(76292)]).then(i.bind(i,76292)):"3d"===e.type&&(Promise.all([i.e(89067),i.e(4708),i.e(65206),i.e(54221),i.e(72257),i.e(13540),i.e(84427),i.e(71473),i.e(30212),i.e(19932),i.e(565),i.e(90834)]).then(i.bind(i,565)),Promise.all([i.e(66445),i.e(95484),i.e(31636)]).then(i.bind(i,31636))))}),h.syncAndInitial),(0,h.watch)((()=>this.view?.spatialReference),((e,t)=>{e&&t&&!e.equals(t)&&this.cancel()}))]),(0,B.Ob)(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=(0,c.SC)(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||null!=this.snappingManager&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return"create"===this._operationHandle?.type&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,i=!t&&e&&"tooltip"in e?e.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...$,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Y,...e,reshapeOptions:{...Y.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...Y.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){null!=this._defaultSnappingManager&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=(0,c.SC)(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new k.N({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:i}=t;e&&(t.cursor=null),i?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),e&&this.addHandles((0,h.when)((()=>e.ready),(t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)}),h.syncAndInitial),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=(0,c.IM)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,c.IM)(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:i}=this,r=t.toArray();i.removeMany(r),this.cancel(),this._emitDeleteEvent({graphics:r,tool:e})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){const e=this.updateGraphics.map((e=>e.clone())).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:i,layer:r}=this;if(!i||"disabled"===this.state)throw r||this._logMissingLayer(),(0,u.zE)();if(null!=i.activeTool&&(i.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,P.p)(i,this._internalGraphicsLayer);const n=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(null==n||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);n.on("complete",(()=>{if(n===this._operationHandle){const i=this.createGraphic,s=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),n.cancelled||null==i||r.add(i),this._sketchContinuationFlag=!1,this.emit("create",{graphic:i,state:s?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),s||this._sketchContinuationFlag)return;const{creationMode:o}=this;if("continuous"===o){if(t?.geometryToPlace)return;this._updatingHandles.addPromise((0,u.R8)(this.create(e,t)))}else"update"===o&&i&&this._updatingHandles.addPromise((0,u.R8)(this.update([i])))}})),this._operationHandle=n,i.ready&&i.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:r,state:n}=this;if(!r||"disabled"===n)throw i||this._logMissingLayer(),(0,u.zE)();null!=r.activeTool&&(r.activeTool=null);const s=Array.isArray(e)?e:[e];if(null==e||!s?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some((e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):null==e.geometry&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0))))return;const o=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,t));this.destroyed||null==o||oe(o)||((0,P.p)(r,this._internalGraphicsLayer),this._setUpdateOperationHandle(o,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:o.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const i of e)null==i.geometry||"mesh"===i.geometry.type||(0,_.fS)(i.geometry.spatialReference,t.spatialReference)||((0,g.canProjectWithoutEngine)(i.geometry.spatialReference,t.spatialReference)||(0,g.isLoaded)()||await(0,g.load)(),i.geometry=(0,g.project)(i.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if("2d"===t.type){const i=[];t.map.allLayers.forEach((e=>{"vector-tile"!==e.type&&"imagery"!==e.type||i.push(e)}));const r=await t.hitTest(e,{exclude:i});return(0,V.qm)(r.results)}const i=[t.map.ground];t.map.allLayers.forEach((e=>{(0,b.nx)(e.type)&&i.push(e)}));const r=await t.hitTest(e,{exclude:i});if(r.results.length>0){const e=r.results[0];if(null!=e&&"graphic"===e.type&&e.graphic&&(!r.ground.mapPoint||t.map.ground.opacity<1||r.ground.distance-(e.distance??0)>-Math.min(3*r.ground.distance,"global"===t.viewingMode?(0,m.Iu)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",(async e=>{const t="active"===this.state&&"create"===this._operationHandle?.type;"disabled"!==this.state&&!t&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))}),I.f.WIDGET)]}async _handleImmediateClick(e){const t=await e.async((()=>this._getFirstHit((0,H.vT)(e))));let i=null;if(null!=t){const r=t.graphic;this.updateGraphics.includes(r)||r.layer===this.layer?(e.stopPropagation(),i=r):"2d"!==this.view?.type||this._isComponentGraphic(r)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();null==i||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const i=this.view;if(!i)return this._logMissingView(),null;const r={hasZ:"3d"===i.type,...this.defaultCreateOptions,...t},n=await this._setupDrawGraphicTool(e,i,r);return null==n?null:(i.tools.add(n),i.activeTool=n,this._setupCreateOperationHandle(n))}async _setupDrawGraphicTool(e,t,i){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:r,defaultZ:n,hasZ:s,geometryToPlace:o,graphicProperties:a,mode:l,preserveAspectRatio:c}=i,u=function(e,t){return"freehandPolygon"===t||"freehandPolyline"===t?"freehand":e??("rectangle"===t||"circle"===t?"hybrid":"click")}(l,e),h=function(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}(e),d=i?.optionsPerTool?.has(e)?i.optionsPerTool.get(e):{},p=d?.preserveAspectRatio??c??"rectangle"!==e,f={centered:"rectangle"!==e&&!("circle"===e&&!p),cursor:r,defaultZ:n,forceUniformSize:p,graphicProperties:{...a,attributes:{...a?.attributes}},geometryToPlace:o,geometryType:h,mode:u,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:t,...d};return"2d"===t.type?this._makeDrawGraphicTool2D(f):this._makeDrawGraphicTool3D(f)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(Promise.all([i.e(89067),i.e(4708),i.e(72257),i.e(84427),i.e(76292)]).then(i.bind(i,76292)));return oe(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Q(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(Promise.all([i.e(89067),i.e(4708),i.e(65206),i.e(54221),i.e(72257),i.e(13540),i.e(84427),i.e(71473),i.e(30212),i.e(19932),i.e(565),i.e(90834)]).then(i.bind(i,565)));if(oe(t)||this.destroyed)return null;const{elevationInfo:r}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:r,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let i=null;const r=e.forceUniformSize,n=e.centered,s=[t.on("key-down",(t=>{if(t.key===L.Sn.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===L.Sn.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==L.Sn.vertexAdd||t.repeat)t.key===L.Sn.undo?(t.stopPropagation(),o.undo()):t.key===L.Sn.redo?(t.stopPropagation(),o.redo()):t.key!==L.Sn.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===L.Sn.center&&(t.repeat||(e.centered=!n,t.stopPropagation())):(e.forceUniformSize=!r,t.stopPropagation());else{const i=e.drawOperation.geometryType;"polyline"!==i&&"polygon"!==i&&"multipoint"!==i||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}}),I.f.WIDGET),t.on("key-up",(t=>{t.key===L.Sn.pan?e.enabled=!0:t.key!==L.Sn.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===L.Sn.center&&(e.centered=n,t.stopPropagation()):(e.forceUniformSize=r,t.stopPropagation())}),I.f.WIDGET),e.on("vertex-add",(t=>{switch(i=null==i?"start":"active",t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}})),e.on("cursor-update",(t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})})),e.on("vertex-remove",(t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}})),e.on("complete",(e=>{this._set("createGraphic",e.graphic),i="complete",e.aborted?o&&o.cancel():o&&o.complete()})),(0,h.watch)((()=>this._getGraphicSymbolFromTool(e.geometryType)),(t=>{e.graphicSymbol=t}))],o=new Z({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{(0,a.yV)(s),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return o}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:i,view:r}=this;if(!r)return this._logMissingView(),null;const n={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let s=n.tool??Y.tool;for(const t of e)i.remove(t),i.add(t);if("3d"===r.type){if(0===e.length)return null;switch(s){case"move":return this._setupMove3DOperation(e,n,r,s);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],n,r);case"transform":return this._setupGraphicTransform3DOperation(e,n,r)}}switch(s){case"move":return this._setupMove2DOperation(e,n,r);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,s,n,r);case"transform":if(1===e.length){const t=e[0].geometry?.type;"point"!==t&&"multipoint"!==t||(s="reshape")}return this._setupTransformOrReshape2DOperation(e,s,n,r)}}async _setupMove3DOperation(e,t,r,n,s=!1){const o=await this._requireModule(Promise.all([i.e(89067),i.e(4708),i.e(65206),i.e(54221),i.e(72257),i.e(13540),i.e(84427),i.e(71473),i.e(30212),i.e(19932),i.e(565),i.e(90834)]).then(i.bind(i,565)));if(oe(o))return o;const{ManipulatedObject3DGraphic:l,MoveTool3D:c}=o.module,u=new Map,h=()=>{u.forEach((e=>e.destroy())),u.clear()};for(const t of e){const e=new l({view:r,graphic:t}),i=(0,A.Y)(e);if(i!==M.h.SUPPORTED)return h(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${(0,M.O)(i)}).`),null;u.set(t,e)}const d=new c({view:r,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});r.tools.add(d),d.objects.addMany(Array.from(u.values())),s||this.updateGraphics.addMany(e);const p=[],f=new q({activeComponent:d,tool:n,type:"update",onEnd:()=>{(0,a.yV)(p),se(r,d),h()},undo:()=>{re(this.view,d),ee(f,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{te(f,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:e=>{this.updateGraphics.push(e);const t=new l({view:r,graphic:e});u.set(e,t),d.objects.push(t),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);if(f.history.undo.forEach((e=>e.updates.splice(t,1))),f.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0===this.updateGraphics.length)return void f.complete();const i=u.get(e);i&&(d.objects.remove(i),i.destroy(),u.delete(e))},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==n)return;const e=this.updateGraphics.at(0),i=await this._setupReshape3DOperation(e,t,r,!0);i&&!oe(i)&&(f.onEnd(),f.destroy(),this._setUpdateOperationHandle(i,t))}});return p.push(...this._getHandlesForComponent(f,t),r.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(f,e,t)),I.f.WIDGET),r.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(f,e)}),I.f.WIDGET)),f}_setupGraphicTransform3DOperation(e,t,i,r=!1){if(1===e.length&&function(e){if("graphics"!==e.layer?.type)return M.h.GRAPHICS_LAYER_MISSING;if(null==e.geometry)return M.h.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return M.h.SUPPORTED;default:return M.h.GEOMETRY_TYPE_UNSUPPORTED}const t=null!=e.symbol&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return t&&t.some((e=>"object"===e.type))?"on-the-ground"!==(0,R.vu)(e)&&(0,R.Lt)(e)?M.h.ELEVATION_MODE_UNSUPPORTED:M.h.SUPPORTED:M.h.SYMBOL_TYPE_UNSUPPORTED}(e[0])===M.h.SUPPORTED){const n=e[0],s=n.geometry;if(null!=s&&("point"===s.type||"mesh"===s.type))return this._setupPointTransform3DOperation(n,t,i);if(null!=s&&("polygon"===s.type||"polyline"===s.type))return this._setupPolyTransform3DOperation(n,t,i,r)}return this._setupMove3DOperation(e,t,i,"transform",r)}async _setupPointTransform3DOperation(e,t,r){const n="transform",{enableRotation:s,enableScaling:o,enableZ:l}=t,c=await this._requireModule(Promise.all([i.e(89067),i.e(4708),i.e(65206),i.e(54221),i.e(72257),i.e(13540),i.e(84427),i.e(71473),i.e(30212),i.e(19932),i.e(565),i.e(90834)]).then(i.bind(i,565)));if(oe(c))return c;const{TransformTool3D:u,ManipulatedObject3DGraphic:h}=c.module,d=new h({graphic:e,view:r}),p=new u({object:d,view:r,enableRotation:s,enableScaling:o,enableZ:l,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});r.tools.add(p),this.updateGraphics.add(e);const f=[],m=new q({activeComponent:p,tool:n,type:"update",onEnd:()=>{(0,a.yV)(f),se(r,p),d.destroy()},undo:()=>{re(this.view,p),ee(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{te(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,r,"transform",!0);oe(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),m.complete()},toggleTool:()=>{}});return f.push(...this._getHandlesForComponent(m,t),r.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(m,e,t)),I.f.WIDGET),r.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)}),I.f.WIDGET)),m}async _setupPolyTransform3DOperation(e,t,r,n=!1){const s="transform",{enableRotation:o,enableScaling:l,enableZ:c,preserveAspectRatio:u}=t,h=await this._requireModule(Promise.all([i.e(89067),i.e(4708),i.e(65206),i.e(54221),i.e(72257),i.e(13540),i.e(84427),i.e(71473),i.e(30212),i.e(19932),i.e(565),i.e(90834)]).then(i.bind(i,565)));if(oe(h))return h;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:p}=h.module,f=this.view?.inputManager?.isModifierKeyDown(L.Sn.constraint),m=new d({view:r,graphic:e}),g=new p({object:m,view:r,enableRotation:o,enableScaling:l,enableZ:c,preserveAspectRatio:!!u!=!!f,sketchOptions:this.sketchOptions});r.tools.add(g),n||this.updateGraphics.add(e);const y=[],_=new q({activeComponent:g,tool:s,type:"update",onEnd:()=>{(0,a.yV)(y),se(r,g),m.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),_.onEnd(),_.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,r,"transform",!0);oe(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),_.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const i=await this._setupReshape3DOperation(e,t,r,!0);i&&!oe(i)&&(_.onEnd(),_.destroy(),this._setUpdateOperationHandle(i,t))}});return y.push(...this._getHandlesForComponent(_,t),r.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(_,e,t)),I.f.WIDGET),r.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(_,e)),I.f.WIDGET),r.on("key-down",(e=>{e.key!==L.Sn.constraint||e.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,e.stopPropagation())}),I.f.WIDGET),r.on("key-up",(e=>{e.key===L.Sn.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,e.stopPropagation())}),I.f.WIDGET)),_}async _setupMove2DOperation(e,t,i){const r="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const n=await this._getGraphicMover(e,t,i);if(oe(n))return n;const s=new q({activeComponent:n,tool:r,type:"update",onEnd:()=>{this._displayDefaultCursor(),(0,a.yV)(c),(0,a.yV)(l),n.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();ee(s,e),s.refreshComponent(),this._emitUndoEvent({graphics:e,tool:r})},redo:()=>{const e=this.updateGraphics.toArray();te(s,e),s.refreshComponent(),this._emitRedoEvent({graphics:e,tool:r})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),n.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);s.history.undo.forEach((e=>e.updates.splice(t,1))),s.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?n.graphics=i:s.complete()}});let o=!1;const l=[i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(s,e,t)),I.f.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(s,e),e.key!==L.Sn.constraint||e.repeat||(o=!0,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)}),I.f.WIDGET),i.on("key-up",(e=>{e.key===L.Sn.constraint&&o&&(o=!1,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)}),I.f.WIDGET)],c=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,r,n=!1){const s="reshape",o=await this._requireModule(Promise.all([i.e(89067),i.e(4708),i.e(65206),i.e(54221),i.e(72257),i.e(13540),i.e(84427),i.e(71473),i.e(30212),i.e(19932),i.e(565),i.e(90834)]).then(i.bind(i,565)));if(oe(o))return o;const{ManipulatedObject3DGraphic:l,ReshapeTool3D:c}=o.module,u=new l({view:r,graphic:e}),h=O(u);if(h!==M.h.SUPPORTED)return u.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,M.O)(h)}).`),null;const d=t.reshapeOptions,p=new c({view:r,object:u,enableZVertex:t.enableZ&&"move"===d?.vertexOperation,enableZShape:t.enableZ&&"move"===d?.shapeOperation,enableMoveObject:"move"===d?.shapeOperation||"move-xy"===d?.shapeOperation,enableMidpoints:"split"===d?.edgeOperation,enableEdgeOffset:"offset"===d?.edgeOperation,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});r.tools.add(p),n||this.updateGraphics.add(u.graphic);const f=[],m=new q({activeComponent:p,tool:s,type:"update",onEnd:()=>{(0,a.yV)(f),se(r,p),u.destroy()},canUndo:()=>!p.destroyed&&p.canUndo,undo:()=>{p.destroyed||(p.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},canRedo:()=>!p.destroyed&&p.canRedo,redo:()=>{p.destroyed||(p.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,r,"transform",!0);oe(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),m.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;m.onEnd(),m.destroy();const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,r,!0);oe(e)||this._setUpdateOperationHandle(e,t)}});return f.push(...this._getHandlesForComponent(m,t),r.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(m,e,t)),I.f.WIDGET),r.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)}),I.f.WIDGET)),m}async _setupTransformOrReshape2DOperation(e,t,i,r){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const n="transform"===t?await this._getBox(e,i,r):await this._getReshape(e,i,r);if(oe(n))return n;const s=new q({activeComponent:n,type:"update",onEnd:()=>{(0,a.yV)(l),(0,a.yV)(o),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{ee(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{te(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async e=>{let t=s.activeComponent;if("reshape"===t?.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const n=await this._setupTransformOrReshape2DOperation(t,"transform",i,r);if(oe(n))return;this._setUpdateOperationHandle(n,i)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);s.history.undo.forEach((e=>e.updates.splice(t,1))),s.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();if(0===i.length)s.complete();else{const e=i[0].geometry;1!==i.length||null==e||"point"!==e.type&&"multipoint"!==e.type?s.activeComponent.graphics=i:s.toggleTool()}this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.at(0),t=e.geometry;if(null!=t&&("reshape"===s.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===s.tool&&"extent"===t.type))return;let n=null;"transform"===s.tool?n=await this._getReshape([e],i,r):"reshape"===s.tool&&(n=await this._getBox([e],i,r)),oe(n)||(s.activeComponent?.destroy(),s.activeComponent=n,s.activeComponent&&((0,a.yV)(l),l=this._getHandlesForComponent(s,i)))}}),o=[r.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(s,e,i)),I.f.WIDGET),r.on("key-down",(e=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,e),e.key===L.Sn.constraint&&!e.repeat&&s){const e=s.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),I.f.WIDGET),r.on("key-up",(e=>{if(e.key===L.Sn.constraint&&s){const e=s.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),I.f.WIDGET)];let l=this._getHandlesForComponent(s,i);return s}async _getGraphicMover(e,t,r){const{enableMoveAllGraphics:n,highlightOptions:s}=t,o=await this._requireModule(Promise.all([i.e(96888),i.e(4641)]).then(i.bind(i,96888)));return oe(o)?o:new o.module.default({enableMoveAllGraphics:n,highlightsEnabled:!!s?.enabled,indicatorsEnabled:!1,graphics:e,view:r,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:i})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:t,graphic:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:i})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,r){const{enableRotation:n,enableScaling:s,highlightOptions:o,preserveAspectRatio:a}=t,l=await this._requireModule(Promise.all([i.e(89067),i.e(72257),i.e(96888),i.e(24e3)]).then(i.bind(i,24e3)));if(oe(l))return l;const c=this.view?.inputManager?.isModifierKeyDown(L.Sn.constraint);return new l.module.default({graphics:e,enableRotation:n,enableScaling:s,highlightsEnabled:!!o?.enabled,preserveAspectRatio:!!a!=!!c,layer:this._internalGraphicsLayer,view:r,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,r){const n="split"===t.reshapeOptions?.edgeOperation,s="move"===t.reshapeOptions?.shapeOperation,o=!!t.highlightOptions?.enabled,a=await this._requireModule(Promise.all([i.e(89067),i.e(4708),i.e(72257),i.e(96888),i.e(91203)]).then(i.bind(i,78137)));return oe(a)?a:new a.module.default({enableMidpoints:n,enableMovement:s,graphic:e[0],highlightsEnabled:o,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:r,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:i,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:r},type:"update"}),onMove:({dx:e,dy:t,mover:i,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:r},type:"update"}),onMoveStop:({dx:e,dy:t,mover:i,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:r},type:"update"}),onVertexAdd:({added:e,type:t,vertices:i})=>{const r=e.map((e=>(0,y.nA)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:r,vertices:i,type:t},type:"update"})},onVertexRemove:({removed:e,type:t,vertices:i})=>{const r=e.map((e=>(0,y.nA)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:r,vertices:i,type:t},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",(({graphic:t,viewEvent:i})=>{i.native?.shiftKey&&(i.stopPropagation(),e.removeFromSelection(t))})),i.on("graphic-move-start",(t=>e.addToHistory(ne(t.allGraphics))))];case"box":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(ne(t.graphics)))),i.on("rotate-start",(t=>e.addToHistory(ne(t.graphics)))),i.on("scale-start",(t=>e.addToHistory(ne(t.graphics))))];case"reshape":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(ne([t.mover])))),i.on("reshape-start",(t=>e.addToHistory(ne([t.graphic])))),i.on("vertex-add",(t=>e.addToHistory(ne([t.oldGraphic])))),i.on("vertex-remove",(t=>e.addToHistory(ne([t.oldGraphic]))))];case"move-3d":return[i.events.on("record-undo",(({updates:t})=>{e.addToHistory({updates:t})})),i.events.on("move-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-start"},type:"update"})})),i.events.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move"},type:"update"})})),i.events.on("move-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-stop"},type:"update"})})),i.events.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()}))];case"transform-3d":return[i.events.on("record-undo",(({updates:t})=>{e.addToHistory({updates:t})})),i.events.on("translate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})})),i.events.on("translate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})})),i.events.on("rotate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-start"},type:"update"})})),i.events.on("rotate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})})),i.events.on("scale-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})})),i.events.on("scale-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})})),i.events.on("translate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})})),i.events.on("rotate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate"},type:"update"})})),i.events.on("scale",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})})),i.events.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()}))];case"reshape-3d":return[i.events.on("reshape",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})})),i.events.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})})),i.events.on("vertex-add",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.events.on("vertex-remove",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.events.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()}))]}}_onTransformOrReshape2DGraphicClick(e,t,i){const{graphic:r,viewEvent:n}=i;return n.native?.shiftKey&&r.layer===this.layer?(n.stopPropagation(),e.removeFromSelection(r)):t.toggleToolOnClick?(n.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view?.map;this._disablePopup(t);e.on("complete",(()=>{if(e===this._operationHandle){const r=this.updateGraphics.toArray(),n=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:r,state:"complete",aborted:e.cancelled,tool:n,toolEventInfo:null,type:"update"})}}))}async _getCommonUpdateOperationClickHandlers(e,t,i){const r=(0,H.vT)(t),n=await t.async((()=>this._getFirstHit(r)));null!=n&&(t.native.shiftKey&&this._toggleSelection([n.graphic],e,i)||this.updateGraphics.includes(n.graphic))?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const r=!!i.multipleSelectionEnabled;return e.some((e=>!(null==e||!r||e.layer!==this.layer||(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),0))))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===L.Sn.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===L.Sn.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===L.Sn.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&L.Sn.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,i=this.updateGraphics.toArray();null!=t&&("reshape"!==t.type||1===i.length&&"point"===i[0].geometry?.type)&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,c.SC)(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||null==t)&&(e.attributes?.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){l.Z.getLogger(this).error(new s.Z(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return(0,h.whenOnce)((()=>!this.updating))}_disablePopupEnabled(e){return"3d"!==this.view?.type||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?((0,c.IM)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await(0,u.Hl)((0,h.whenOnce)((()=>e?.ready)),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",K("view"))}_logMissingLayer(){this._logError(X,K("layer"))}};(0,r._)([(0,d.Cb)()],J.prototype,"_defaultSnappingManager",void 0),(0,r._)([(0,d.Cb)()],J.prototype,"updating",null),(0,r._)([(0,d.Cb)({readOnly:!0})],J.prototype,"_updatingHandles",void 0),(0,r._)([(0,d.Cb)()],J.prototype,"_operationHandle",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],J.prototype,"activeTool",null),(0,r._)([(0,d.Cb)({readOnly:!0})],J.prototype,"activeCreateToolDrawMode",null),(0,r._)([(0,d.Cb)()],J.prototype,"activeTooltip",null),(0,r._)([(0,d.Cb)({types:E.LB})],J.prototype,"activeFillSymbol",void 0),(0,r._)([(0,d.Cb)()],J.prototype,"activeLineSymbol",void 0),(0,r._)([(0,d.Cb)()],J.prototype,"activeVertexSymbol",void 0),(0,r._)([(0,d.Cb)()],J.prototype,"allowDeleteKey",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],J.prototype,"createGraphic",null),(0,r._)([(0,d.Cb)()],J.prototype,"defaultCreateOptions",null),(0,r._)([(0,d.Cb)()],J.prototype,"defaultUpdateOptions",null),(0,r._)([(0,d.Cb)({type:D.Z,nonNullable:!0})],J.prototype,"labelOptions",null),(0,r._)([(0,d.Cb)()],J.prototype,"layer",void 0),(0,r._)([(0,d.Cb)({types:E.LB})],J.prototype,"pointSymbol",void 0),(0,r._)([(0,d.Cb)({types:E.LB})],J.prototype,"polygonSymbol",void 0),(0,r._)([(0,d.Cb)({types:E.LB})],J.prototype,"polylineSymbol",void 0),(0,r._)([(0,d.Cb)()],J.prototype,"meshSymbol",void 0),(0,r._)([(0,d.Cb)({type:z.Z,nonNullable:!0})],J.prototype,"snappingOptions",null),(0,r._)([(0,d.Cb)()],J.prototype,"snappingManager",null),(0,r._)([(0,d.Cb)({readOnly:!0})],J.prototype,"state",null),(0,r._)([(0,d.Cb)({type:F.Z,nonNullable:!0})],J.prototype,"tooltipOptions",null),(0,r._)([(0,d.Cb)({readOnly:!0})],J.prototype,"updateGraphics",void 0),(0,r._)([(0,d.Cb)()],J.prototype,"updateOnGraphicClick",void 0),(0,r._)([(0,d.Cb)()],J.prototype,"creationMode",void 0),(0,r._)([(0,d.Cb)({type:U.Z,nonNullable:!0})],J.prototype,"valueOptions",null),(0,r._)([(0,d.Cb)({types:E.LB})],J.prototype,"vertexSymbol",void 0),(0,r._)([(0,d.Cb)({value:null})],J.prototype,"view",null),(0,r._)([(0,d.Cb)({constructOnly:!0,type:N.Z})],J.prototype,"sketchOptions",void 0),J=(0,r._)([(0,p.j)("esri.widgets.Sketch.SketchViewModel")],J);const X="sketch:missing-property",K=e=>`Property '${e}' is missing on SketchViewModel.`;function Q(e){return"polygon"===e||"rectangle"===e||"circle"===e}function ee(e,t){ie("undo",e.history.undo,e.history.redo,t)}function te(e,t){ie("redo",e.history.redo,e.history.undo,t)}function ie(e,t,i,r){const n=t.pop();if(!n)return;const s=n.updates,o=[];r.forEach(((t,i)=>{const r=s[i];null!=r&&("geometry"in r&&null!=r.geometry&&(o.push({geometry:t.geometry}),t.geometry=r.geometry),"symbol"in r&&null!=r.symbol&&(o.push({symbol:t.symbol}),t.symbol=r.symbol),"undo"in r&&(o.push(r),r[e](t)))})),i.push({updates:o})}function re(e,t){null!=e&&t.hasGrabbedManipulators&&(e.activeTool=null)}function ne(e){return{updates:e.map((({geometry:e})=>"mesh"===e?.type?{geometry:e.cloneShallow()}:{geometry:e}))}}function se(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function oe(e){return"requireError"in e&&"aborted"===e.requireError}const ae=J},35679:(e,t,i)=>{i.d(t,{Z:()=>U});var r=i(36663),n=(i(87090),i(59183)),s=i(31355),o=i(49546),a=(i(39994),i(67134)),l=i(13802),c=i(61681),u=i(64189),h=i(78668),d=i(76868),p=i(12173),f=i(81977),m=i(69236),g=i(40266),y=i(55860),_=i(24163),v=i(66311);i(22591);const b={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},w={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{"-"===t.charAt(0)?e.style.setProperty(t,i):e.style[t]=i}},x=(e,t,i=!1)=>{let r=e;return t.forEach(((e,n)=>{const s=r?.children?((e,t)=>e.find(t))(r.children,(t=>t.domNode===e)):void 0;i&&!s&&n!==t.length-1||(r=s)})),r};var T=i(45095),C=i(67181),S=i(8941);const E=new Set;var M,A=i(67842),R=i(54956),O=i(8108),P=i(60720);let I=0;function L(e,t){const i=Object.prototype.hasOwnProperty;for(const r in t)i.call(t,r)&&i.call(e,r)&&(null!=e[r]&&null!=t[r]&&"object"==typeof e[r]&&"object"==typeof t[r]?L(e[r],t[r]):e[r]=t[r]);return e}const D=(e=>{let t;const i={...b,...e},r=(e=>({...w,...e}))(i),n=r.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],u=(e,s,o)=>{let a;r.eventHandlerInterceptor=(e,r,s,o)=>function(e){let r;n("domEvent",e);const s=((e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i})(e.currentTarget,a.domNode),o=s.some((e=>customElements.get(e?.tagName?.toLowerCase())));if(e.eventPhase!==Event.CAPTURING_PHASE&&o){const t=e.composedPath(),i=t.slice(t.indexOf(e.currentTarget),t.indexOf(a.domNode)).reverse();r=x(a.getLastRender(),i,!0)}else s.reverse(),r=x(a.getLastRender(),s);let l;return r&&(l=i.handleInterceptedEvent(t,r,this,e)),n("domEventProcessed",e),l},i.postProcessProjectionOptions?.(r);const u=o();a=e(s,u,r),r.eventHandlerInterceptor=void 0,l.push(a),c.push(o),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(a,u)};let h=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let e=0;e<l.length;e++){const t=c[e]();n("rendered",void 0);try{l[e].update(t)}catch(e){console.error(e)}n("patched",void 0)}n("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(h=i.modifyDoRenderImplementation(h,l,c)),t={renderNow:h,scheduleRender:()=>{s||a||(s=requestAnimationFrame(h))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(e,t)=>{u(v.v.append,e,t)},insertBefore:(e,t)=>{u(v.v.insertBefore,e,t)},merge:(e,t)=>{u(v.v.merge,e,t)},replace:(e,t)=>{u(v.v.replace,e,t)},detach:e=>{for(let t=0;t<c.length;t++)if(c[t]===e)return c.splice(t,1),l.splice(t,1)[0];throw new Error("renderFunction was not found")}},t})({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(e,r,n,s)=>{const o=t?.(e,r,n,s),a=i.test(e);if(!((e=e.replace(i,"")).toLowerCase()in n)||a){const t=e[2].toLowerCase()+e.slice(3),i=e=>o?.call(n,e);n.addEventListener(t,i,a);const r=()=>n.removeEventListener(t,i,a),l=s.afterRemoved;s.afterRemoved=e=>{l?.(e),r()}}return o}},handleInterceptedEvent(e,t,i,r){const{eventPhase:n,type:s}=r,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=t.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&((0,A.Uy)(),e.scheduleRender(),l[a].call(l.bind||i,r))}});let N=!1,F=class extends(u.Z.EsriPromiseMixin(s.Z.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._projector=D,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=(0,h.Ds)((async()=>{if(this._messageBundleProps?.length){const e=await Promise.allSettled(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{if(this.destroyed)return;let i=await(0,P.ME)(e);this.uiStrings&&Object.keys(this.uiStrings)&&(i=L((0,a.d9)(i),this.uiStrings)),this[t]=i})));if(this.destroyed)return;for(const t of e)"rejected"===t.status&&l.Z.getLogger(this).error("widget-intl:locale-error",this.declaredClass,t.reason)}await this.loadLocale()})),(0,T.B)();const i="esri-widget-uid-"+(0,p.DO)(),r=this.render.bind(this);this._trackingTarget=new _.M((()=>{this.autoRenderingEnabled&&this.scheduleRender()}));const n=()=>({vnodeSelector:"div",properties:{key:`${i}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),s=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const e=r()??n(),t=e.properties??={};if(t.key??=i,(0,C.Z)(e.vnodeSelector)){if(!this.visible)return n()}else this.visible?t.styles||(t.styles={}):(t.class="",t.styles={display:"none"}),t.styles.display??="";let s=0;return e.children?.forEach((e=>{(0,C.Z)(e.vnodeSelector)||(e.properties??={},e.properties.key??=`${this.id}--${s++}`)})),(0,C.d)(this,e)};this.render=()=>{if(N)return s();let e=(0,A.O9)(this)??null;if(e)return e;this._trackingTarget.clear(),N=!0;try{e=(0,y.LJ)(this._trackingTarget,s)}catch(e){throw l.Z.getLogger(this).error(e),e}finally{N=!1}return e&&(0,A.KF)(this,e),e};const o=this.beforeFirstRender();o?this._resourcesFetch=o.then((()=>{this._readyForTrueRender=!0,this._postInitialize()})):(this._resourcesFetch=Promise.resolve().then((()=>{this._postInitialize()})),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),function(e){E.add(e),e.finally((()=>E.delete(e)))}(this._resourcesFetch)}normalizeCtorArgs(e,t){const i={...e};return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then((()=>{})).catch(h.H9):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||((0,c.SC)(this._trackingTarget),(0,c.SC)(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,(0,A.w7)(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return(0,n.L)(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+I++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(M=S.R,S.T)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||((0,A.w7)(this),this._projector.scheduleRender())}classes(...e){return R.Sh.apply(this,e)}renderNow(){(0,A.w7)(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles((0,d.watch)((()=>this.viewModel),((e,t)=>{t&&this.removeHandles("delegated-events"),e&&(0,o.OP)(e)&&this.addHandles(this._delegatedEventNames.map((t=>(0,o.on)(e,t,(e=>{this.emit(t,e)})))),"delegated-events")}),d.syncAndInitial)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(h.H9),this.scheduleRender()};this.addHandles([(0,O.qe)(e),(0,d.watch)((()=>this.uiStrings),e),(0,d.when)((()=>this.container),(e=>{this.destroyed||this._attach(e)}),{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};F[M]=!0,F.vnodeSelector="div",(0,r._)([(0,f.Cb)()],F.prototype,"_readyForTrueRender",void 0),(0,r._)([(0,f.Cb)({value:null})],F.prototype,"container",null),(0,r._)([(0,m.p)("container")],F.prototype,"castContainer",null),(0,r._)([(0,f.Cb)()],F.prototype,"icon",null),(0,r._)([(0,f.Cb)()],F.prototype,"id",null),(0,r._)([(0,f.Cb)()],F.prototype,"label",null),(0,r._)([(0,f.Cb)()],F.prototype,"renderable",null),(0,r._)([(0,f.Cb)()],F.prototype,"uiStrings",void 0),(0,r._)([(0,f.Cb)()],F.prototype,"viewModel",void 0),(0,r._)([(0,f.Cb)({value:!0})],F.prototype,"visible",null),(0,r._)([(0,f.Cb)()],F.prototype,"key",void 0),(0,r._)([(0,f.Cb)()],F.prototype,"children",void 0),(0,r._)([(0,f.Cb)()],F.prototype,"afterCreate",void 0),(0,r._)([(0,f.Cb)()],F.prototype,"afterUpdate",void 0),(0,r._)([(0,f.Cb)()],F.prototype,"afterRemoved",void 0),F=(0,r._)([(0,g.j)("esri.widgets.Widget")],F);const U=F},68266:(e,t,i)=>{i.d(t,{Z:()=>a});var r=i(36663),n=i(61681),s=i(81977),o=(i(39994),i(13802),i(4157),i(40266));const a=e=>{let t=class extends e{constructor(...e){super(...e),this.goToOverride=null,this.view=null}callGoTo(e){const{view:t}=this;return(0,n.O3)(t),this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}};return(0,r._)([(0,s.Cb)()],t.prototype,"goToOverride",void 0),(0,r._)([(0,s.Cb)()],t.prototype,"view",void 0),t=(0,r._)([(0,o.j)("esri.widgets.support.GoTo")],t),t}},62199:(e,t,i)=>{i.d(t,{X:()=>a});var r=i(19431),n=i(49590),s=i(54956),o=i(26451);function a({level:e,class:t,...i},r){const a=l(e);return(0,o.u)(`h${a}`,{...i,"aria-level":String(a),class:(0,s.Sh)(n.z.heading,t),role:"heading"},r)}function l(e){return(0,r.uZ)(Math.ceil(e),1,6)}},45095:(e,t,i)=>{i.d(t,{B:()=>l,h:()=>c});var r=i(94827);let n=!1;var s=i(36567),o=(i(39994),i(3466));let a;function l(){n||(e=>{n=!0,(0,r.s)(e)})((0,o.hF)((0,s.V)(a)))}function c(e){const t=[];for(const i of Object.keys(e))customElements.get(`calcite-${i}`)||t.push(e[i]?.());return t.length>0?Promise.all(t):null}a="components/assets"},92165:(e,t,i)=>{i.d(t,{h:()=>n});var r=i(54956);function n(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${String(t)}'`);return{value:s(e[t])}}}function s(e){return function(t,...i){!function(e){const t=e?.type;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}(t)?e.call(this,t,...i):(0,r.pf)(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click())}}},34236:(e,t,i)=>{function r(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}i.d(t,{H:()=>r})},49590:(e,t,i)=>{i.d(t,{z:()=>r});const r={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"}},26451:(e,t,i)=>{i.d(t,{D:()=>l,u:()=>a});var r=i(67181),n=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},s=function(e,t){for(var i=0,r=e.length;i<r;i++){var o=e[i];Array.isArray(o)?s(o,t):null!=o&&!1!==o&&(o.hasOwnProperty("vnodeSelector")||(o=n(o)),t.push(o))}},o=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(1===i.length&&"string"==typeof i[0])return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var n=[];return s(i,n),{vnodeSelector:e,properties:t||void 0,children:n,text:void 0,domNode:null}};function a(e,t,...i){return"function"!=typeof e||(0,r.Z)(e)?o(e,t??null,...i):e(t,...i)}function l(...e){return e}},67181:(e,t,i)=>{i.d(t,{Z:()=>d,d:()=>l});var r=i(23148),n=i(8941);const s=[],o={},a=new WeakMap;function l(e,t){let i=t.children;if(i?.length)for(let t=0;t<i.length;++t)i[t]=l(e,i[t]);else i=s;const r=t.vnodeSelector;if(d(r)){const n=t.properties||o,s=n.key||r,a={key:s,afterCreate:c,afterUpdate:u,afterRemoved:h,parentWidget:e,widgetConstructor:r,widgetProperties:{...n,key:s,children:i}};return{vnodeSelector:r.vnodeSelector,properties:a,children:void 0,text:void 0,domNode:null}}return t}function c(e,t,i,{parentWidget:s,widgetConstructor:o,widgetProperties:l}){const c=new o(l);c.container=e,a.set(e,c),c.afterCreate?.(c,e),s.addHandles((0,r.kB)((()=>h(e)))),queueMicrotask((()=>{c[n.T].projector.renderNow()}))}function u(e,t,i,{widgetProperties:r}){const n=a.get(e);n&&(n.set(r),n.afterUpdate?.(n,e))}function h(e){const t=a.get(e);t&&(t.afterRemoved?.(t,e),t.destroy(),a.delete(e))}function d(e){return"function"==typeof e&&e[n.R]}},8941:(e,t,i)=>{i.d(t,{R:()=>r,T:()=>n});const r=Symbol("widget"),n=Symbol("widget-test-data")},67842:(e,t,i)=>{i.d(t,{KF:()=>o,O9:()=>s,Uy:()=>n,w7:()=>a});const r=new Map;function n(){r.clear()}function s(e){return r.get(e)}function o(e,t){r.set(e,t)}function a(e){r.delete(e)}},54956:(e,t,i)=>{i.d(t,{Sh:()=>me,pV:()=>ye,pf:()=>xe,dZ:()=>ge,w3:()=>we,kW:()=>Te,Yo:()=>_e});var r=function(){return r=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},r.apply(this,arguments)},n={exports:{}},s={},o={exports:{}},a={};function l(){var e={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1};return e}var c=/javascript\s*\:/gim;a.whiteList=l(),a.getDefaultWhiteList=l,a.onAttr=function(e,t,i){},a.onIgnoreAttr=function(e,t,i){},a.safeAttrValue=function(e,t){return c.test(t)?"":t};var u={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,n;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,n=e.length;r<n;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},h=u;var d=function(e,t){";"!==(e=h.trimRight(e))[e.length-1]&&(e+=";");var i=e.length,r=!1,n=0,s=0,o="";function a(){if(!r){var i=h.trim(e.slice(n,s)),a=i.indexOf(":");if(-1!==a){var l=h.trim(i.slice(0,a)),c=h.trim(i.slice(a+1));if(l){var u=t(n,o.length,l,c,i);u&&(o+=u+"; ")}}}n=s+1}for(;s<i;s++){var l=e[s];if("/"===l&&"*"===e[s+1]){var c=e.indexOf("*/",s+2);if(-1===c)break;n=(s=c+1)+1,r=!1}else"("===l?r=!0:")"===l?r=!1:";"===l?r||a():"\n"===l&&a()}return h.trim(o)},p=a,f=d;function m(e){return null==e}function g(e){(e=function(e){var t={};for(var i in e)t[i]=e[i];return t}(e||{})).whiteList=e.whiteList||p.whiteList,e.onAttr=e.onAttr||p.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||p.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||p.safeAttrValue,this.options=e}g.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,i=t.whiteList,r=t.onAttr,n=t.onIgnoreAttr,s=t.safeAttrValue;return f(e,(function(e,t,o,a,l){var c=i[o],u=!1;if(!0===c?u=c:"function"==typeof c?u=c(a):c instanceof RegExp&&(u=c.test(a)),!0!==u&&(u=!1),a=s(o,a)){var h,d={position:t,sourcePosition:e,source:l,isWhite:u};return u?m(h=r(o,a,d))?o+":"+a:h:m(h=n(o,a,d))?void 0:h}}))};var y=g;!function(e,t){var i=a,r=y;for(var n in(t=e.exports=function(e,t){return new r(t).process(e)}).FilterCSS=r,i)t[n]=i[n]}(o,o.exports);var _=o.exports,v={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,n;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,n=e.length;r<n;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1}},b=_.FilterCSS,w=_.getDefaultWhiteList,x=v;function T(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var C=new b;function S(e){return e.replace(E,"&lt;").replace(M,"&gt;")}var E=/</g,M=/>/g,A=/"/g,R=/&quot;/g,O=/&#([a-zA-Z0-9]*);?/gim,P=/&colon;?/gim,I=/&newline;?/gim,L=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,D=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,N=/u\s*r\s*l\s*\(.*/gi;function F(e){return e.replace(A,"&quot;")}function U(e){return e.replace(R,'"')}function k(e){return e.replace(O,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function z(e){return e.replace(P,":").replace(I," ")}function B(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return x.trim(t)}function V(e){return e=B(e=z(e=k(e=U(e))))}function H(e){return e=S(e=F(e))}s.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},s.getDefaultWhiteList=T,s.onTag=function(e,t,i){},s.onIgnoreTag=function(e,t,i){},s.onTagAttr=function(e,t,i){},s.onIgnoreTagAttr=function(e,t,i){},s.safeAttrValue=function(e,t,i,r){if(i=V(i),"href"===t||"src"===t){if("#"===(i=x.trim(i)))return"#";if("http://"!==i.substr(0,7)&&"https://"!==i.substr(0,8)&&"mailto:"!==i.substr(0,7)&&"tel:"!==i.substr(0,4)&&"data:image/"!==i.substr(0,11)&&"ftp://"!==i.substr(0,6)&&"./"!==i.substr(0,2)&&"../"!==i.substr(0,3)&&"#"!==i[0]&&"/"!==i[0])return""}else if("background"===t){if(L.lastIndex=0,L.test(i))return""}else if("style"===t){if(D.lastIndex=0,D.test(i))return"";if(N.lastIndex=0,N.test(i)&&(L.lastIndex=0,L.test(i)))return"";!1!==r&&(i=(r=r||C).process(i))}return i=H(i)},s.escapeHtml=S,s.escapeQuote=F,s.unescapeQuote=U,s.escapeHtmlEntities=k,s.escapeDangerHtml5Entities=z,s.clearNonPrintableCharacter=B,s.friendlyAttrValue=V,s.escapeAttrValue=H,s.onIgnoreTagStripAll=function(){return""},s.StripTagBody=function(e,t){"function"!=typeof t&&(t=function(){});var i=!Array.isArray(e),r=[],n=!1;return{onIgnoreTag:function(s,o,a){if(function(t){return!!i||-1!==x.indexOf(e,t)}(s)){if(a.isClosing){var l="[/removed]",c=a.position+l.length;return r.push([!1!==n?n:a.position,c]),n=!1,l}return n||(n=a.position),"[removed]"}return t(s,o,a)},remove:function(e){var t="",i=0;return x.forEach(r,(function(r){t+=e.slice(i,r[0]),i=r[1]})),t+=e.slice(i)}}},s.stripCommentTag=function(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("\x3c!--",i);if(-1===r){t+=e.slice(i);break}t+=e.slice(i,r);var n=e.indexOf("--\x3e",r);if(-1===n)break;i=n+3}return t},s.stripBlankChar=function(e){var t=e.split("");return(t=t.filter((function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))}))).join("")},s.cssFilter=C,s.getDefaultCSSWhiteList=w;var G={},j=v;function Z(e){var t,i=j.spaceIndex(e);return t=-1===i?e.slice(1,-1):e.slice(1,i+1),"/"===(t=j.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}function q(e){return"</"===e.slice(0,2)}var W=/[^a-zA-Z0-9\\_:.-]/gim;function $(e,t){for(;t<e.length;t++){var i=e[t];if(" "!==i)return"="===i?t:-1}}function Y(e,t){for(;t<e.length;t++){var i=e[t];if(" "!==i)return"'"===i||'"'===i?t:-1}}function J(e,t){for(;t>0;t--){var i=e[t];if(" "!==i)return"="===i?t:-1}}function X(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}G.parseTag=function(e,t,i){var r="",n=0,s=!1,o=!1,a=0,l=e.length,c="",u="";e:for(a=0;a<l;a++){var h=e.charAt(a);if(!1===s){if("<"===h){s=a;continue}}else if(!1===o){if("<"===h){r+=i(e.slice(n,a)),s=a,n=a;continue}if(">"===h){r+=i(e.slice(n,s)),c=Z(u=e.slice(s,a+1)),r+=t(s,r.length,c,u,q(u)),n=a+1,s=!1;continue}if('"'===h||"'"===h)for(var d=1,p=e.charAt(a-d);""===p.trim()||"="===p;){if("="===p){o=h;continue e}p=e.charAt(a-++d)}}else if(h===o){o=!1;continue}}return n<e.length&&(r+=i(e.substr(n))),r},G.parseAttr=function(e,t){var i=0,r=0,n=[],s=!1,o=e.length;function a(e,i){if(!((e=(e=j.trim(e)).replace(W,"").toLowerCase()).length<1)){var r=t(e,i||"");r&&n.push(r)}}for(var l=0;l<o;l++){var c,u=e.charAt(l);if(!1!==s||"="!==u)if(!1===s||l!==r)if(/\s|\n|\t/.test(u)){if(e=e.replace(/\s|\n|\t/g," "),!1===s){if(-1===(c=$(e,l))){a(j.trim(e.slice(i,l))),s=!1,i=l+1;continue}l=c-1;continue}if(-1===(c=J(e,l-1))){a(s,X(j.trim(e.slice(i,l)))),s=!1,i=l+1;continue}}else;else{if(-1===(c=e.indexOf(u,l+1)))break;a(s,j.trim(e.slice(r+1,c))),s=!1,i=(l=c)+1}else s=e.slice(i,l),i=l+1,r='"'===e.charAt(i)||"'"===e.charAt(i)?i:Y(e,l+1)}return i<e.length&&(!1===s?a(e.slice(i)):a(s,X(j.trim(e.slice(i))))),j.trim(n.join(" "))};var K=_.FilterCSS,Q=s,ee=G,te=ee.parseTag,ie=ee.parseAttr,re=v;function ne(e){return null==e}function se(e){(e=function(e){var t={};for(var i in e)t[i]=e[i];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Q.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=function(e){var t={};for(var i in e)Array.isArray(e[i])?t[i.toLowerCase()]=e[i].map((function(e){return e.toLowerCase()})):t[i.toLowerCase()]=e[i];return t}(e.whiteList||e.allowList):e.whiteList=Q.whiteList,e.onTag=e.onTag||Q.onTag,e.onTagAttr=e.onTagAttr||Q.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Q.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Q.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Q.safeAttrValue,e.escapeHtml=e.escapeHtml||Q.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new K(e.css))}se.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,i=t.whiteList,r=t.onTag,n=t.onIgnoreTag,s=t.onTagAttr,o=t.onIgnoreTagAttr,a=t.safeAttrValue,l=t.escapeHtml,c=this.cssFilter;t.stripBlankChar&&(e=Q.stripBlankChar(e)),t.allowCommentTag||(e=Q.stripCommentTag(e));var u=!1;t.stripIgnoreTagBody&&(u=Q.StripTagBody(t.stripIgnoreTagBody,n),n=u.onIgnoreTag);var h=te(e,(function(e,t,u,h,d){var p={sourcePosition:e,position:t,isClosing:d,isWhite:Object.prototype.hasOwnProperty.call(i,u)},f=r(u,h,p);if(!ne(f))return f;if(p.isWhite){if(p.isClosing)return"</"+u+">";var m=function(e){var t=re.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var i="/"===(e=re.trim(e.slice(t+1,-1)))[e.length-1];return i&&(e=re.trim(e.slice(0,-1))),{html:e,closing:i}}(h),g=i[u],y=ie(m.html,(function(e,t){var i=-1!==re.indexOf(g,e),r=s(u,e,t,i);return ne(r)?i?(t=a(u,e,t,c))?e+'="'+t+'"':e:ne(r=o(u,e,t,i))?void 0:r:r}));return h="<"+u,y&&(h+=" "+y),m.closing&&(h+=" /"),h+=">"}return ne(f=n(u,h,p))?l(h):f}),l);return u&&(h=u.remove(h)),h};var oe=se;!function(e,t){var i=s,r=G,n=oe;function o(e,t){return new n(t).process(e)}(t=e.exports=o).filterXSS=o,t.FilterXSS=n,function(){for(var e in i)t[e]=i[e];for(var n in r)t[n]=r[n]}(),"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=e.exports)}(n,n.exports);var ae=n.exports,le=function(){function e(e,t){var i,n=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],del:["style"],details:["open","style"],div:["align","aria-hidden","aria-label","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["aria-hidden","aria-label","style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=r(r({},ae.getDefaultCSSWhiteList()),{"align-items":!0,"align-self":!0,flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,float:!0,gap:!0,grid:!0,"grid-area":!0,"grid-auto-columns":!0,"grid-auto-flow":!0,"grid-auto-rows":!0,"grid-column":!0,"grid-column-end":!0,"grid-column-start":!0,"grid-row":!0,"grid-row-end":!0,"grid-row-start":!0,"grid-template":!0,"grid-template-areas":!0,"grid-template-columns":!0,"grid-template-rows":!0,"justify-content":!0,"justify-items":!0,"justify-self":!0,"line-height":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(e,t,i,r){return"a"===e&&"href"===t||("img"===e||"source"===e)&&"src"===t?n.sanitizeUrl(i):ae.safeAttrValue(e,t,i,r)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"},e&&!t?i=e:e&&t?((i=Object.create(this.arcgisFilterOptions)).css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach((function(t){if("whiteList"===t)i.whiteList=n._extendObjectOfArrays([n.arcgisWhiteList,e.whiteList||{}]);else if("css"===t){var r=e.css.whiteList;null!=r&&e.css instanceof Object&&Object.keys(r).forEach((function(e){return i.css.whiteList[e]=r[e]}))}else i[t]=e[t]}))):((i=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,i.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=i,this._xssFilter=new ae.FilterXSS(i)}return e.prototype.sanitize=function(e,t){switch(void 0===t&&(t={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,t);default:if(t.allowUndefined&&void 0===e)return;return null}},e.prototype.sanitizeUrl=function(e,t){var i=(null!=t?t:{}).isProtocolRequired,r=void 0===i||i,n=this._trim(e.substring(0,e.indexOf(":"))),s="/"===e,o=/^#/.test(e),a=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return s||o||a?ae.escapeAttrValue(e):n||r?"":ae.escapeAttrValue("https://".concat(e))},e.prototype.sanitizeHTMLAttribute=function(e,t,i,r){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(e,t,i,r):ae.safeAttrValue(e,t,i,r)},e.prototype.validate=function(e,t){void 0===t&&(t={});var i=this.sanitize(e,t);return{isValid:e===i,sanitized:i}},e.prototype.encodeHTML=function(e){var t=this;return String(e).replace(/[&<>"'\/]/g,(function(e){return t._entityMap[e]}))},e.prototype.encodeAttrValue=function(e){var t=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,(function(i,r){return t.test(i)?i:"&#x".concat(Number(e.charCodeAt(r)).toString(16),";")}))},e.prototype._extendObjectOfArrays=function(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(i){Array.isArray(e[i])&&Array.isArray(t[i])?t[i]=t[i].concat(e[i]):t[i]=e[i]}))})),t},e.prototype._iterateOverObject=function(e,t){var i=this;void 0===t&&(t={});try{var r=!1,n=void 0;if(Array.isArray(e))n=e.reduce((function(e,n){var s=i.validate(n,t);return s.isValid?e.concat([n]):(r=!0,e.concat([s.sanitized]))}),[]);else{if(!function(e){if("object"!=typeof e||null===e)return!1;if("[object Object]"!==Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e)){if(t.allowUndefined&&void 0===e)return;return null}n=Object.keys(e).reduce((function(n,s){var o=e[s],a=i.validate(o,t);return a.isValid?n[s]=o:(r=!0,n[s]=a.sanitized),n}),{})}return r?n:e}catch(e){return null}},e.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},e}(),ce=i(50904),ue=i(23148),he=(i(39994),i(13802),i(78668)),de=i(76868),pe=i(17262),fe=i(67842);function me(...e){const t=ce.Z.acquire();for(let i=0;i<e.length;i++){const r=e[i],n=typeof r;if("string"===n)t.push(r);else if(Array.isArray(r))t.push.apply(t,r);else if("object"===n)for(const e in r)r[e]&&t.push(e)}const i=t.join(" ");return ce.Z.release(t),i}(()=>{const e=new Map,t=new ResizeObserver((t=>{(0,fe.Uy)();for(const i of t)e.get(i.target)?.(i)})),i=(i,r,n)=>(e.set(i,r),t.observe(i,n),(0,ue.kB)((()=>{t.unobserve(i),e.delete(i)})))})();function ge(e){const t=e?.closest("[dir]");return null!==t&&t instanceof HTMLElement&&"rtl"===t.dir||"rtl"===document.dir}function ye(e){this[e.getAttribute("data-node-ref")]=null}function _e(e){this[e.getAttribute("data-node-ref")]=e}const ve=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((e,t)=>(e[t]=[],e)),{}),be=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],we=new le({whiteList:ve,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(be.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function xe(e){return"Enter"===e||" "===e}async function Te(e,t){await(0,pe.JM)((0,he.$h)(t));const i="function"==typeof e?e():e;i&&("setFocus"in i&&"function"==typeof i.setFocus?await i.setFocus():i instanceof HTMLElement&&i.focus())}},62910:(e,t,i)=>{i.d(t,{oi:()=>C,yM:()=>x,RD:()=>S,Ld:()=>A,Vp:()=>E,kA:()=>M,P$:()=>R,Kb:()=>O});var r=i(39462);function n(e){let t=e;for(;t=t.parentNode??t.host;)if(t?.constructor?.lumina){const i=t;return i.manager?.loadedCalled||i._offspring.push(e),i._postLoad.promise}return!1}var s=Object.defineProperty;function o(e){const t=e.split(":");return 1===t.length?[t[0],(0,r.mB)(t[0])]:t}globalThis.HTMLElement,class extends(null){constructor(){super(),this._store={},this._pendingAttributes=[],this._postLoad=new Deferred,this._postLoaded=new Deferred,this._offspring=[],this._saveInstanceProperties();const e=this.constructor;e._LitConstructor?this._initializeComponent({a:e._LitConstructor}):e._loadPromise.then(this._initializeComponent.bind(this)).catch((e=>{this._postLoaded.reject(e),setTimeout((()=>{throw e}))}))}static{this.lumina=!0}static _initializePrototype(){this._properties?.forEach(this._bindProp,this),this._asyncMethods?.forEach(this._bindAsync,this),this._syncMethods?.forEach(this._bindSync,this)}static _bindProp(e){s(this.prototype,e,{configurable:!0,enumerable:!0,get(){return this._store[e]},set(t){this._store[e]=t}})}static _bindAsync(e){s(this.prototype,e,{async value(...t){this._litElement||await this._postLoaded.promise;const i=this._litElement;return await i[e](...t)},configurable:!0})}static _bindSync(e){s(this.prototype,e,{value(...t){return this._litElement[e](...t)},configurable:!0})}get manager(){return this._litElement?.manager}_saveInstanceProperties(){const e=this.constructor,t=this;e._properties?.forEach((e=>{Object.hasOwn(this,e)&&(this._store[e]=t[e],delete t[e])}))}attributeChangedCallback(e,t,i){this._litElement?.attributeChangedCallback(e,t,i),this._litElement||this._pendingAttributes.push(e)}connectedCallback(){this._litElement?this._litElement.connectedCallback?.():queueMicrotask((()=>{this._ancestorLoad=n(this)}))}disconnectedCallback(){this._litElement?.disconnectedCallback?.()}async componentOnReady(){return await this._postLoaded.promise,this}_initializeComponent(e){const t=this.constructor,i=t._name,r=this._store,n=Object.values(e).find((e=>e.tagName===i));const o=`${i}--lazy`;let l=n;for(;l&&!Object.hasOwn(l,"lumina");)l=Object.getPrototypeOf(l);!function(e){const t=e.prototype,i=Element.prototype;Object.hasOwn(t,"isConnected")||(t.setAttribute=function(e,t){i.setAttribute.call(this.el,e,t)},t.removeAttribute=function(e){i.removeAttribute.call(this.el,e)},s(t,"isConnected",{get(){return Reflect.get(i,"isConnected",this.el)}}));0}(l);!t._LitConstructor&&(t._LitConstructor=n,customElements.define(o,n)),n.lazy=this;const c=document.createElement(o);n.lazy=void 0,this._litElement=c,this._store=c,this._pendingAttributes.forEach((e=>{const t=this.getAttribute(e);c.attributeChangedCallback(e,null,t)})),Object.entries(r).forEach(a,c);const u=this.isConnected;(u||this._ancestorLoad)&&(c.connectedCallback?.(),u||c.disconnectedCallback())}addController(){}requestUpdate(){this._litElement?.requestUpdate()}};function a([e,t]){this[e]=t}var l={},c=i(91637);class u extends Event{constructor(e,t,i,r){super("context-request",{bubbles:!0,composed:!0}),this.context=e,this.contextTarget=t,this.callback=i,this.subscribe=r??!1}}class h extends Event{constructor(e,t){super("context-provider",{bubbles:!0,composed:!0}),this.context=e,this.contextTarget=t}}var d=i(88732);d.Ts,d.Qu;var p=i(21293),f=i(33692),m=i(50875);const g=(0,m.XM)(class extends m.Xe{constructor(e){if(super(e),e.type!==m.pX.ATTRIBUTE||"class"!==e.name||e.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(e){return" "+Object.keys(e).filter((t=>e[t])).join(" ")+" "}update(e,[t]){if(void 0===this.st){this.st=new Set,void 0!==e.strings&&(this.nt=new Set(e.strings.join(" ").split(/\s/).filter((e=>""!==e))));for(const e in t)t[e]&&!this.nt?.has(e)&&this.st.add(e);return this.render(t)}const i=e.element.classList;for(const e of this.st)e in t||(i.remove(e),this.st.delete(e));for(const e in t){const r=!!t[e];r===this.st.has(e)||this.nt?.has(e)||(r?(i.add(e),this.st.add(e)):(i.remove(e),this.st.delete(e)))}return f.Jb}}),y="important",_=" !"+y,v=(0,m.XM)(class extends m.Xe{constructor(e){if(super(e),e.type!==m.pX.ATTRIBUTE||"style"!==e.name||e.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(e){return Object.keys(e).reduce(((t,i)=>{const r=e[i];return null==r?t:t+`${i=i.includes("-")?i:i.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${r};`}),"")}update(e,[t]){const{style:i}=e.element;if(void 0===this.ft)return this.ft=new Set(Object.keys(t)),this.render(t);for(const e of this.ft)null==t[e]&&(this.ft.delete(e),e.includes("-")?i.removeProperty(e):i[e]=null);for(const e in t){const r=t[e];if(null!=r){this.ft.add(e);const t="string"==typeof r&&r.endsWith(_);e.includes("-")||t?i.setProperty(e,t?r.slice(0,-11):r,t?y:""):i[e]=r}}return f.Jb}});var b=i(44677);var w=(e="",t={},i=(0,c.Yz)())=>{const r={emit:r=>{""===e&&(0,c.A)();const n=new CustomEvent(e,{detail:r,cancelable:!0,bubbles:!0,composed:!0,...t});return i.el.dispatchEvent(n),n}};return""===e&&(0,c.Bp)(void 0,(t=>{e=t.key}),r),r},x=w.bind(null,""),T=()=>{},C=class e extends p.oi{constructor(){super(),this.el=this.constructor.lazy??this,this.manager=(0,c.a3)(this),this._postLoad=this.constructor.lazy?._postLoad??new r.BH,this._offspring=this.constructor.lazy?._offspring??[],this._postLoaded=this.constructor.lazy?._postLoaded??new r.BH,this._enableUpdating=this.enableUpdating,this.enableUpdating=T;const t=e.prototype.shouldUpdate;this.shouldUpdate!==t&&(this._originalShouldUpdate=this.shouldUpdate,this.shouldUpdate=t),p.sk&&this.el.setAttribute(this.constructor.runtime.hydratedAttribute,"")}static finalizeStyles(e){const t=super.finalizeStyles(e),i=this.shadowRootOptions===l;return void 0===this.runtime?.commonStyles||i?t:[this.runtime.commonStyles,...t]}static createProperty(e,t){const i="number"==typeof t?t:Array.isArray(t)?t[0]:0,n=Array.isArray(t)?t[1]:void 0;super.createProperty(e,{attribute:!!(1&i&&"string"==typeof e)&&(0,r.mB)(e),reflect:!!(2&i),type:4&i?Boolean:8&i?Number:void 0,state:!!(16&i),readOnly:!!(32&i),noAccessor:!!(64&i),...n})}static{this.lumina=!0}connectedCallback(){if(this.el.hasAttribute("defer-hydration"))return;const e=!this.manager.connectedCalled;super.connectedCallback(),e&&queueMicrotask((()=>this._load().catch((e=>{this._postLoaded.reject(e),setTimeout((()=>{throw e}))}))))}createRenderRoot(){const e=this.el.shadowRoot,t=this.constructor,i=t.shadowRootOptions,r=e??(i===l?this.el:this.el.attachShadow(i));if(Object.defineProperty(this,"shadowRoot",{value:r}),e)return p.oi.prototype.createRenderRoot.call(this),e;if(this.isConnected){const e=r.getRootNode();0,e.adoptedStyleSheets=[...e.adoptedStyleSheets,...t.elementStyles.map((e=>"styleSheet"in e?e.styleSheet:e))]}return r}async _load(){const e=this.el._ancestorLoad??n(this.el);e&&await e,await this.manager._load(),this._enableUpdating(!0),this.performUpdate(),this._postLoad.resolve(),await Promise.resolve();const t=this._offspring.filter((e=>!e.manager?.loadedCalled));t.length&&await Promise.allSettled(t.map((async e=>await e.componentOnReady()))),this._offspring.length=0,this.el.setAttribute(this.constructor.runtime.hydratedAttribute,""),this.manager._loaded(),this._postLoaded.resolve()}shouldUpdate(e){return this.$changes=e,this._originalShouldUpdate?.(e)??!0}listen(e,t,i){const r=t?.bind(this)??t;this.manager.onLifecycle((()=>(this.el.addEventListener(e,r,i),()=>this.el.removeEventListener(e,r,i))))}listenOn(e,t,i,r){const n=i?.bind(this)??i;this.manager.onLifecycle((()=>(e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r))))}async componentOnReady(){return await this._postLoaded.promise,this}};function S(e){let t;const i=e=>{t=new URL(e,globalThis.location?.href||void 0).href},r={...e,getAssetPath(e){const i=new URL(e,t);return i.origin!==globalThis.location?.origin?i.href:i.pathname},setAssetPath:i,customElement(e,t){t.runtime=r,t.tagName=e,customElements.get(e)||customElements.define(e,t)}};return i(e.defaultAssetPath),r}C.$createEvent=w;var E=e=>"object"==typeof e&&null!=e?g(e):e,M=e=>"object"==typeof e&&null!=e?v(e):e,A=(m.XM,b.a,f.Ld);f.Jb;function R(e,t,i){null==i?e.removeAttribute(t):e.setAttribute(t,i)}var O={toAttribute:e=>!0===e?"":!1===e?null:e}},94827:(e,t,i)=>{i.d(t,{C:()=>a,D:()=>l,c:()=>g,f:()=>h,g:()=>y,i:()=>f,l:()=>d,s:()=>_});var r=i(62910),n=i(58676);const s="calcite-mode-auto",o="calcite-mode-dark",a={autoMode:s,darkMode:o,lightMode:"calcite-mode-light",rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left"},l={filter:250,nextTick:0,resize:150,reposition:100};function c(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>e.contains(o)||e.contains(s)&&t?"dark":"light",r=e=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:e}})),n=e=>{a!==e&&r(e),a=e};let a=i();r(a),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>n(e.matches?"dark":"light"))),new MutationObserver((()=>n(i()))).observe(document.body,{attributes:!0,attributeFilter:["class"]})}const u=globalThis.calciteConfig,h=u?.focusTrapStack||[],d=u?.logLevel||"info",p="3.1.0";const f=()=>!n.s&&typeof navigator<"u"&&typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;f()&&("interactive"===document.readyState?c():document.addEventListener("DOMContentLoaded",(()=>c()),{once:!0})),function(){if(u&&u.version)return;console.info(`Using Calcite Components ${p} [Date: 2025-03-26, Revision: d5f75fd64]`);const e=u||globalThis.calciteConfig||{};Object.defineProperty(e,"version",{value:p,writable:!1}),globalThis.calciteConfig=e}();const m=(0,r.RD)({defaultAssetPath:"https://js.arcgis.com/calcite-components/3.1.0/",hydratedAttribute:"calcite-hydrated"}),{customElement:g,getAssetPath:y,setAssetPath:_}=m},98701:(e,t,i)=>{i.d(t,{ec:()=>c,i1:()=>u,iv:()=>l});const r=globalThis,n=r.ShadowRoot&&(void 0===r.ShadyCSS||r.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s=Symbol(),o=new WeakMap;class a{constructor(e,t,i){if(this._$cssResult$=!0,i!==s)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(n&&void 0===e){const i=void 0!==t&&1===t.length;i&&(e=o.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&o.set(t,e))}return e}toString(){return this.cssText}}const l=(e,...t)=>{const i=1===e.length?e[0]:t.reduce(((t,i,r)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[r+1]),e[0]);return new a(i,e,s)},c=(e,t)=>{if(n)e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet));else for(const i of t){const t=document.createElement("style"),n=r.litNonce;void 0!==n&&t.setAttribute("nonce",n),t.textContent=i.cssText,e.appendChild(t)}},u=n?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new a("string"==typeof e?e:e+"",void 0,s))(t)})(e):e},88732:(e,t,i)=>{i.d(t,{Qu:()=>g,Ts:()=>m,fl:()=>_});var r=i(98701);const{is:n,defineProperty:s,getOwnPropertyDescriptor:o,getOwnPropertyNames:a,getOwnPropertySymbols:l,getPrototypeOf:c}=Object,u=globalThis,h=u.trustedTypes,d=h?h.emptyScript:"",p=u.reactiveElementPolyfillSupport,f=(e,t)=>e,m={toAttribute(e,t){switch(t){case Boolean:e=e?d:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},g=(e,t)=>!n(e,t),y={attribute:!0,type:String,converter:m,reflect:!1,useDefault:!1,hasChanged:g};Symbol.metadata??=Symbol("metadata"),u.litPropertyMetadata??=new WeakMap;class _ extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=y){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const i=Symbol(),r=this.getPropertyDescriptor(e,i,t);void 0!==r&&s(this.prototype,e,r)}}static getPropertyDescriptor(e,t,i){const{get:r,set:n}=o(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:r,set(t){const s=r?.call(this);n?.call(this,t),this.requestUpdate(e,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??y}static _$Ei(){if(this.hasOwnProperty(f("elementProperties")))return;const e=c(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(f("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(f("properties"))){const e=this.properties,t=[...a(e),...l(e)];for(const i of t)this.createProperty(i,e[i])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,i]of t)this.elementProperties.set(e,i)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const i=this._$Eu(e,t);void 0!==i&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift((0,r.i1)(e))}else void 0!==e&&t.push((0,r.i1)(e));return t}static _$Eu(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return(0,r.ec)(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$ET(e,t){const i=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,i);if(void 0!==r&&!0===i.reflect){const n=(void 0!==i.converter?.toAttribute?i.converter:m).toAttribute(t,i.type);this._$Em=e,null==n?this.removeAttribute(r):this.setAttribute(r,n),this._$Em=null}}_$AK(e,t){const i=this.constructor,r=i._$Eh.get(e);if(void 0!==r&&this._$Em!==r){const e=i.getPropertyOptions(r),n="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:m;this._$Em=r,this[r]=n.fromAttribute(t,e.type)??this._$Ej?.get(r)??null,this._$Em=null}}requestUpdate(e,t,i){if(void 0!==e){const r=this.constructor,n=this[e];if(i??=r.getPropertyOptions(e),!((i.hasChanged??g)(n,t)||i.useDefault&&i.reflect&&n===this._$Ej?.get(e)&&!this.hasAttribute(r._$Eu(e,i))))return;this.C(e,t,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:i,reflect:r,wrapped:n},s){i&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,s??t??this[e]),!0!==n||void 0!==s)||(this._$AL.has(e)||(this.hasUpdated||i||(t=void 0),this._$AL.set(e,t)),!0===r&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,i]of e){const{wrapped:e}=i,r=this[t];!0!==e||this._$AL.has(t)||void 0===r||this.C(t,void 0,i,r)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach((e=>e.hostUpdate?.())),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach((e=>e.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach((e=>this._$ET(e,this[e]))),this._$EM()}updated(e){}firstUpdated(e){}}_.elementStyles=[],_.shadowRootOptions={mode:"open"},_[f("elementProperties")]=new Map,_[f("finalized")]=new Map,p?.({ReactiveElement:_}),(u.reactiveElementVersions??=[]).push("2.1.0")},14232:(e,t,i)=>{i.d(t,{OR:()=>s,hl:()=>a});var r=i(33692);const{I:n}=r.Al,s=e=>void 0===e.strings,o={},a=(e,t=o)=>e._$AH=t},50875:(e,t,i)=>{i.d(t,{XM:()=>n,Xe:()=>s,pX:()=>r});const r={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},n=e=>(...t)=>({_$litDirective$:e,values:t});class s{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,i){this._$Ct=e,this._$AM=t,this._$Ci=i}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}},44677:(e,t,i)=>{i.d(t,{a:()=>o});var r=i(33692),n=i(50875),s=i(14232);const o=(0,n.XM)(class extends n.Xe{constructor(e){if(super(e),e.type!==n.pX.PROPERTY&&e.type!==n.pX.ATTRIBUTE&&e.type!==n.pX.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!(0,s.OR)(e))throw Error("`live` bindings can only contain a single expression")}render(e){return e}update(e,[t]){if(t===r.Jb||t===r.Ld)return t;const i=e.element,o=e.name;if(e.type===n.pX.PROPERTY){if(t===i[o])return r.Jb}else if(e.type===n.pX.BOOLEAN_ATTRIBUTE){if(!!t===i.hasAttribute(o))return r.Jb}else if(e.type===n.pX.ATTRIBUTE&&i.getAttribute(o)===t+"")return r.Jb;return(0,s.hl)(e),t}})},58676:(e,t,i)=>{i.d(t,{s:()=>r});const r=!1},33692:(e,t,i)=>{i.d(t,{Al:()=>H,Jb:()=>M,Ld:()=>A,YP:()=>S,cV:()=>E,dy:()=>C,sY:()=>G});const r=globalThis,n=r.trustedTypes,s=n?n.createPolicy("lit-html",{createHTML:e=>e}):void 0,o="$lit$",a=`lit$${Math.random().toFixed(9).slice(2)}$`,l="?"+a,c=`<${l}>`,u=document,h=()=>u.createComment(""),d=e=>null===e||"object"!=typeof e&&"function"!=typeof e,p=Array.isArray,f=e=>p(e)||"function"==typeof e?.[Symbol.iterator],m="[ \t\n\f\r]",g=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,y=/-->/g,_=/>/g,v=RegExp(`>|${m}(?:([^\\s"'>=/]+)(${m}*=${m}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),b=/'/g,w=/"/g,x=/^(?:script|style|textarea|title)$/i,T=e=>(t,...i)=>({_$litType$:e,strings:t,values:i}),C=T(1),S=T(2),E=T(3),M=Symbol.for("lit-noChange"),A=Symbol.for("lit-nothing"),R=new WeakMap,O=u.createTreeWalker(u,129);function P(e,t){if(!p(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==s?s.createHTML(t):t}const I=(e,t)=>{const i=e.length-1,r=[];let n,s=2===t?"<svg>":3===t?"<math>":"",l=g;for(let t=0;t<i;t++){const i=e[t];let u,h,d=-1,p=0;for(;p<i.length&&(l.lastIndex=p,h=l.exec(i),null!==h);)p=l.lastIndex,l===g?"!--"===h[1]?l=y:void 0!==h[1]?l=_:void 0!==h[2]?(x.test(h[2])&&(n=RegExp("</"+h[2],"g")),l=v):void 0!==h[3]&&(l=v):l===v?">"===h[0]?(l=n??g,d=-1):void 0===h[1]?d=-2:(d=l.lastIndex-h[2].length,u=h[1],l=void 0===h[3]?v:'"'===h[3]?w:b):l===w||l===b?l=v:l===y||l===_?l=g:(l=v,n=void 0);const f=l===v&&e[t+1].startsWith("/>")?" ":"";s+=l===g?i+c:d>=0?(r.push(u),i.slice(0,d)+o+i.slice(d)+a+f):i+a+(-2===d?t:f)}return[P(e,s+(e[i]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),r]};class L{constructor({strings:e,_$litType$:t},i){let r;this.parts=[];let s=0,c=0;const u=e.length-1,d=this.parts,[p,f]=I(e,t);if(this.el=L.createElement(p,i),O.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(r=O.nextNode())&&d.length<u;){if(1===r.nodeType){if(r.hasAttributes())for(const e of r.getAttributeNames())if(e.endsWith(o)){const t=f[c++],i=r.getAttribute(e).split(a),n=/([.?@])?(.*)/.exec(t);d.push({type:1,index:s,name:n[2],strings:i,ctor:"."===n[1]?k:"?"===n[1]?z:"@"===n[1]?B:U}),r.removeAttribute(e)}else e.startsWith(a)&&(d.push({type:6,index:s}),r.removeAttribute(e));if(x.test(r.tagName)){const e=r.textContent.split(a),t=e.length-1;if(t>0){r.textContent=n?n.emptyScript:"";for(let i=0;i<t;i++)r.append(e[i],h()),O.nextNode(),d.push({type:2,index:++s});r.append(e[t],h())}}}else if(8===r.nodeType)if(r.data===l)d.push({type:2,index:s});else{let e=-1;for(;-1!==(e=r.data.indexOf(a,e+1));)d.push({type:7,index:s}),e+=a.length-1}s++}}static createElement(e,t){const i=u.createElement("template");return i.innerHTML=e,i}}function D(e,t,i=e,r){if(t===M)return t;let n=void 0!==r?i._$Co?.[r]:i._$Cl;const s=d(t)?void 0:t._$litDirective$;return n?.constructor!==s&&(n?._$AO?.(!1),void 0===s?n=void 0:(n=new s(e),n._$AT(e,i,r)),void 0!==r?(i._$Co??=[])[r]=n:i._$Cl=n),void 0!==n&&(t=D(e,n._$AS(e,t.values),n,r)),t}class N{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,r=(e?.creationScope??u).importNode(t,!0);O.currentNode=r;let n=O.nextNode(),s=0,o=0,a=i[0];for(;void 0!==a;){if(s===a.index){let t;2===a.type?t=new F(n,n.nextSibling,this,e):1===a.type?t=new a.ctor(n,a.name,a.strings,this,e):6===a.type&&(t=new V(n,this,e)),this._$AV.push(t),a=i[++o]}s!==a?.index&&(n=O.nextNode(),s++)}return O.currentNode=u,r}p(e){let t=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class F{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,i,r){this.type=2,this._$AH=A,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=r,this._$Cv=r?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=D(this,e,t),d(e)?e===A||null==e||""===e?(this._$AH!==A&&this._$AR(),this._$AH=A):e!==this._$AH&&e!==M&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):f(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==A&&d(this._$AH)?this._$AA.nextSibling.data=e:this.T(u.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:i}=e,r="number"==typeof i?this._$AC(e):(void 0===i.el&&(i.el=L.createElement(P(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===r)this._$AH.p(t);else{const e=new N(r,this),i=e.u(this.options);e.p(t),this.T(i),this._$AH=e}}_$AC(e){let t=R.get(e.strings);return void 0===t&&R.set(e.strings,t=new L(e)),t}k(e){p(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,r=0;for(const n of e)r===t.length?t.push(i=new F(this.O(h()),this.O(h()),this,this.options)):i=t[r],i._$AI(n),r++;r<t.length&&(this._$AR(i&&i._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class U{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,r,n){this.type=1,this._$AH=A,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=n,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=A}_$AI(e,t=this,i,r){const n=this.strings;let s=!1;if(void 0===n)e=D(this,e,t,0),s=!d(e)||e!==this._$AH&&e!==M,s&&(this._$AH=e);else{const r=e;let o,a;for(e=n[0],o=0;o<n.length-1;o++)a=D(this,r[i+o],t,o),a===M&&(a=this._$AH[o]),s||=!d(a)||a!==this._$AH[o],a===A?e=A:e!==A&&(e+=(a??"")+n[o+1]),this._$AH[o]=a}s&&!r&&this.j(e)}j(e){e===A?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class k extends U{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===A?void 0:e}}class z extends U{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==A)}}class B extends U{constructor(e,t,i,r,n){super(e,t,i,r,n),this.type=5}_$AI(e,t=this){if((e=D(this,e,t,0)??A)===M)return;const i=this._$AH,r=e===A&&i!==A||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,n=e!==A&&(i===A||r);r&&this.element.removeEventListener(this.name,this,i),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class V{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){D(this,e)}}const H={M:o,P:a,A:l,C:1,L:I,R:N,D:f,V:D,I:F,H:U,N:z,U:B,B:k,F:V};(0,r.litHtmlPolyfillSupport)?.(L,F),(r.litHtmlVersions??=[]).push("3.3.0");const G=(e,t,i)=>{const r=i?.renderBefore??t;let n=r._$litPart$;if(void 0===n){const e=i?.renderBefore??null;r._$litPart$=n=new F(t.insertBefore(h(),e),e,void 0,i??{})}return n._$AI(e),n}},21293:(e,t,i)=>{i.d(t,{oi:()=>o,dy:()=>n.dy,sk:()=>a.s,Ld:()=>n.Ld,YP:()=>n.YP});var r=i(88732),n=i(33692);const s=globalThis;class o extends r.fl{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=(0,n.sY)(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return n.Jb}}o._$litElement$=!0,o.finalized=!0,s.litElementHydrateSupport?.({LitElement:o});(0,s.litElementPolyfillSupport)?.({LitElement:o});(s.litElementVersions??=[]).push("4.2.0");var a=i(58676)},17126:(e,t,i)=>{i.d(t,{ou:()=>fr,Qf:()=>re,vF:()=>H,ld:()=>F});class r extends Error{}class n extends r{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class s extends r{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class o extends r{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class a extends r{}class l extends r{constructor(e){super(`Invalid unit ${e}`)}}class c extends r{}class u extends r{constructor(){super("Zone is an abstract class")}}const h="numeric",d="short",p="long",f={year:h,month:h,day:h},m={year:h,month:d,day:h},g={year:h,month:d,day:h,weekday:d},y={year:h,month:p,day:h},_={year:h,month:p,day:h,weekday:p},v={hour:h,minute:h},b={hour:h,minute:h,second:h},w={hour:h,minute:h,second:h,timeZoneName:d},x={hour:h,minute:h,second:h,timeZoneName:p},T={hour:h,minute:h,hourCycle:"h23"},C={hour:h,minute:h,second:h,hourCycle:"h23"},S={hour:h,minute:h,second:h,hourCycle:"h23",timeZoneName:d},E={hour:h,minute:h,second:h,hourCycle:"h23",timeZoneName:p},M={year:h,month:h,day:h,hour:h,minute:h},A={year:h,month:h,day:h,hour:h,minute:h,second:h},R={year:h,month:d,day:h,hour:h,minute:h},O={year:h,month:d,day:h,hour:h,minute:h,second:h},P={year:h,month:d,day:h,weekday:d,hour:h,minute:h},I={year:h,month:p,day:h,hour:h,minute:h,timeZoneName:d},L={year:h,month:p,day:h,hour:h,minute:h,second:h,timeZoneName:d},D={year:h,month:p,day:h,weekday:p,hour:h,minute:h,timeZoneName:p},N={year:h,month:p,day:h,weekday:p,hour:h,minute:h,second:h,timeZoneName:p};class F{get type(){throw new u}get name(){throw new u}get ianaName(){return this.name}get isUniversal(){throw new u}offsetName(e,t){throw new u}formatOffset(e,t){throw new u}offset(e){throw new u}equals(e){throw new u}get isValid(){throw new u}}let U=null;class k extends F{static get instance(){return null===U&&(U=new k),U}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return it(e,t,i)}formatOffset(e,t){return ot(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}let z={};const B={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let V={};class H extends F{static create(e){return V[e]||(V[e]=new H(e)),V[e]}static resetCache(){V={},z={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(e){return!1}}constructor(e){super(),this.zoneName=e,this.valid=H.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return it(e,t,i,this.name)}formatOffset(e,t){return ot(this.offset(e),t)}offset(e){const t=new Date(e);if(isNaN(t))return NaN;const i=(r=this.name,z[r]||(z[r]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:r,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),z[r]);var r;let[n,s,o,a,l,c,u]=i.formatToParts?function(e,t){const i=e.formatToParts(t),r=[];for(let e=0;e<i.length;e++){const{type:t,value:n}=i[e],s=B[t];"era"===t?r[s]=n:Ne(s)||(r[s]=parseInt(n,10))}return r}(i,t):function(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,n,s,o,a,l,c,u]=r;return[o,n,s,a,l,c,u]}(i,t);"BC"===a&&(n=1-Math.abs(n));let h=+t;const d=h%1e3;return h-=d>=0?d:1e3+d,(Ke({year:n,month:s,day:o,hour:24===l?0:l,minute:c,second:u,millisecond:0})-h)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let G={};let j={};function Z(e,t={}){const i=JSON.stringify([e,t]);let r=j[i];return r||(r=new Intl.DateTimeFormat(e,t),j[i]=r),r}let q={};let W={};let $=null;let Y={};function J(e,t,i,r){const n=e.listingMode();return"error"===n?null:"en"===n?i(t):r(t)}class X{constructor(e,t,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:r,floor:n,...s}=i;if(!t||Object.keys(s).length>0){const t={useGrouping:!1,...i};i.padTo>0&&(t.minimumIntegerDigits=i.padTo),this.inf=function(e,t={}){const i=JSON.stringify([e,t]);let r=q[i];return r||(r=new Intl.NumberFormat(e,t),q[i]=r),r}(e,t)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}return je(this.floor?Math.floor(e):$e(e,3),this.padTo)}}class K{constructor(e,t,i){let r;if(this.opts=i,this.originalZone=void 0,this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){const t=e.offset/60*-1,i=t>=0?`Etc/GMT+${t}`:`Etc/GMT${t}`;0!==e.offset&&H.create(i).valid?(r=i,this.dt=e):(r="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,r=e.zone.name):(r="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||r,this.dtf=Z(t,n)}format(){return this.originalZone?this.formatToParts().map((({value:e})=>e)).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map((e=>{if("timeZoneName"===e.type){const t=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...e,value:t}}return e})):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Q{constructor(e,t,i){this.opts={style:"long",...i},!t&&ke()&&(this.rtf=function(e,t={}){const{base:i,...r}=t,n=JSON.stringify([e,r]);let s=W[n];return s||(s=new Intl.RelativeTimeFormat(e,t),W[n]=s),s}(e,i))}format(e,t){return this.rtf?this.rtf.format(e,t):function(e,t,i="always",r=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===i&&s){const i="days"===e;switch(t){case 1:return i?"tomorrow":`next ${n[e][0]}`;case-1:return i?"yesterday":`last ${n[e][0]}`;case 0:return i?"today":`this ${n[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=1===a,c=n[e],u=r?l?c[1]:c[2]||c[1]:l?n[e][0]:e;return o?`${a} ${u} ago`:`in ${a} ${u}`}(t,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const ee={firstDay:1,minimalDays:4,weekend:[6,7]};class te{static fromOpts(e){return te.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,i,r,n=!1){const s=e||ve.defaultLocale,o=s||(n?"en-US":$||($=(new Intl.DateTimeFormat).resolvedOptions().locale,$)),a=t||ve.defaultNumberingSystem,l=i||ve.defaultOutputCalendar,c=He(r)||ve.defaultWeekSettings;return new te(o,a,l,c,s)}static resetCache(){$=null,j={},q={},W={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:i,weekSettings:r}={}){return te.create(e,t,i,r)}constructor(e,t,i,r,n){const[s,o,a]=function(e){const t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));const i=e.indexOf("-u-");if(-1===i)return[e];{let t,r;try{t=Z(e).resolvedOptions(),r=e}catch(n){const s=e.substring(0,i);t=Z(s).resolvedOptions(),r=s}const{numberingSystem:n,calendar:s}=t;return[r,n,s]}}(e);this.locale=s,this.numberingSystem=t||o||null,this.outputCalendar=i||a||null,this.weekSettings=r,this.intl=function(e,t,i){return i||t?(e.includes("-u-")||(e+="-u"),i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e&&t?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?te.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,He(e.weekSettings)||this.weekSettings,e.defaultToEN||!1):this}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return J(this,e,ht,(()=>{const i=t?{month:e,day:"numeric"}:{month:e},r=t?"format":"standalone";return this.monthsCache[r][e]||(this.monthsCache[r][e]=function(e){const t=[];for(let i=1;i<=12;i++){const r=fr.utc(2009,i,1);t.push(e(r))}return t}((e=>this.extract(e,i,"month")))),this.monthsCache[r][e]}))}weekdays(e,t=!1){return J(this,e,mt,(()=>{const i=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},r=t?"format":"standalone";return this.weekdaysCache[r][e]||(this.weekdaysCache[r][e]=function(e){const t=[];for(let i=1;i<=7;i++){const r=fr.utc(2016,11,13+i);t.push(e(r))}return t}((e=>this.extract(e,i,"weekday")))),this.weekdaysCache[r][e]}))}meridiems(){return J(this,void 0,(()=>gt),(()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[fr.utc(2016,11,13,9),fr.utc(2016,11,13,19)].map((t=>this.extract(t,e,"dayperiod")))}return this.meridiemCache}))}eras(e){return J(this,e,bt,(()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[fr.utc(-40,1,1),fr.utc(2017,1,1)].map((e=>this.extract(e,t,"era")))),this.eraCache[e]}))}extract(e,t,i){const r=this.dtFormatter(e,t).formatToParts().find((e=>e.type.toLowerCase()===i));return r?r.value:null}numberFormatter(e={}){return new X(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new K(e,this.intl,t)}relFormatter(e={}){return new Q(this.intl,this.isEnglish(),e)}listFormatter(e={}){return function(e,t={}){const i=JSON.stringify([e,t]);let r=G[i];return r||(r=new Intl.ListFormat(e,t),G[i]=r),r}(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:ze()?function(e){let t=Y[e];if(!t){const i=new Intl.Locale(e);t="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,Y[e]=t}return t}(this.locale):ee}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let ie=null;class re extends F{static get utcInstance(){return null===ie&&(ie=new re(0)),ie}static instance(e){return 0===e?re.utcInstance:new re(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new re(rt(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${ot(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${ot(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return ot(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class ne extends F{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function se(e,t){if(Ne(e)||null===e)return t;if(e instanceof F)return e;if(function(e){return"string"==typeof e}(e)){const i=e.toLowerCase();return"default"===i?t:"local"===i||"system"===i?k.instance:"utc"===i||"gmt"===i?re.utcInstance:re.parseSpecifier(i)||H.create(e)}return Fe(e)?re.instance(e):"object"==typeof e&&"offset"in e&&"function"==typeof e.offset?e:new ne(e)}const oe={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},ae={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},le=oe.hanidec.replace(/[\[|\]]/g,"").split("");let ce={};function ue({numberingSystem:e},t=""){const i=e||"latn";return ce[i]||(ce[i]={}),ce[i][t]||(ce[i][t]=new RegExp(`${oe[i]}${t}`)),ce[i][t]}let he,de=()=>Date.now(),pe="system",fe=null,me=null,ge=null,ye=60,_e=null;class ve{static get now(){return de}static set now(e){de=e}static set defaultZone(e){pe=e}static get defaultZone(){return se(pe,k.instance)}static get defaultLocale(){return fe}static set defaultLocale(e){fe=e}static get defaultNumberingSystem(){return me}static set defaultNumberingSystem(e){me=e}static get defaultOutputCalendar(){return ge}static set defaultOutputCalendar(e){ge=e}static get defaultWeekSettings(){return _e}static set defaultWeekSettings(e){_e=He(e)}static get twoDigitCutoffYear(){return ye}static set twoDigitCutoffYear(e){ye=e%100}static get throwOnInvalid(){return he}static set throwOnInvalid(e){he=e}static resetCaches(){te.resetCache(),H.resetCache(),fr.resetCache(),ce={}}}class be{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const we=[0,31,59,90,120,151,181,212,243,273,304,334],xe=[0,31,60,91,121,152,182,213,244,274,305,335];function Te(e,t){return new be("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function Ce(e,t,i){const r=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const n=r.getUTCDay();return 0===n?7:n}function Se(e,t,i){return i+(Ye(e)?xe:we)[t-1]}function Ee(e,t){const i=Ye(e)?xe:we,r=i.findIndex((e=>e<t));return{month:r+1,day:t-i[r]}}function Me(e,t){return(e-t+7)%7+1}function Ae(e,t=4,i=1){const{year:r,month:n,day:s}=e,o=Se(r,n,s),a=Me(Ce(r,n,s),i);let l,c=Math.floor((o-a+14-t)/7);return c<1?(l=r-1,c=et(l,t,i)):c>et(r,t,i)?(l=r+1,c=1):l=r,{weekYear:l,weekNumber:c,weekday:a,...at(e)}}function Re(e,t=4,i=1){const{weekYear:r,weekNumber:n,weekday:s}=e,o=Me(Ce(r,1,t),i),a=Je(r);let l,c=7*n+s-o-7+t;c<1?(l=r-1,c+=Je(l)):c>a?(l=r+1,c-=Je(r)):l=r;const{month:u,day:h}=Ee(l,c);return{year:l,month:u,day:h,...at(e)}}function Oe(e){const{year:t,month:i,day:r}=e;return{year:t,ordinal:Se(t,i,r),...at(e)}}function Pe(e){const{year:t,ordinal:i}=e,{month:r,day:n}=Ee(t,i);return{year:t,month:r,day:n,...at(e)}}function Ie(e,t){if(!Ne(e.localWeekday)||!Ne(e.localWeekNumber)||!Ne(e.localWeekYear)){if(!Ne(e.weekday)||!Ne(e.weekNumber)||!Ne(e.weekYear))throw new a("Cannot mix locale-based week fields with ISO-based week fields");return Ne(e.localWeekday)||(e.weekday=e.localWeekday),Ne(e.localWeekNumber)||(e.weekNumber=e.localWeekNumber),Ne(e.localWeekYear)||(e.weekYear=e.localWeekYear),delete e.localWeekday,delete e.localWeekNumber,delete e.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function Le(e){const t=Ue(e.year),i=Ge(e.month,1,12),r=Ge(e.day,1,Xe(e.year,e.month));return t?i?!r&&Te("day",e.day):Te("month",e.month):Te("year",e.year)}function De(e){const{hour:t,minute:i,second:r,millisecond:n}=e,s=Ge(t,0,23)||24===t&&0===i&&0===r&&0===n,o=Ge(i,0,59),a=Ge(r,0,59),l=Ge(n,0,999);return s?o?a?!l&&Te("millisecond",n):Te("second",r):Te("minute",i):Te("hour",t)}function Ne(e){return void 0===e}function Fe(e){return"number"==typeof e}function Ue(e){return"number"==typeof e&&e%1==0}function ke(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function ze(){try{return"undefined"!=typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(e){return!1}}function Be(e,t,i){if(0!==e.length)return e.reduce(((e,r)=>{const n=[t(r),r];return e&&i(e[0],n[0])===e[0]?e:n}),null)[1]}function Ve(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function He(e){if(null==e)return null;if("object"!=typeof e)throw new c("Week settings must be an object");if(!Ge(e.firstDay,1,7)||!Ge(e.minimalDays,1,7)||!Array.isArray(e.weekend)||e.weekend.some((e=>!Ge(e,1,7))))throw new c("Invalid week settings");return{firstDay:e.firstDay,minimalDays:e.minimalDays,weekend:Array.from(e.weekend)}}function Ge(e,t,i){return Ue(e)&&e>=t&&e<=i}function je(e,t=2){let i;return i=e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0"),i}function Ze(e){return Ne(e)||null===e||""===e?void 0:parseInt(e,10)}function qe(e){return Ne(e)||null===e||""===e?void 0:parseFloat(e)}function We(e){if(!Ne(e)&&null!==e&&""!==e){const t=1e3*parseFloat("0."+e);return Math.floor(t)}}function $e(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function Ye(e){return e%4==0&&(e%100!=0||e%400==0)}function Je(e){return Ye(e)?366:365}function Xe(e,t){const i=function(e,t){return e-t*Math.floor(e/t)}(t-1,12)+1;return 2===i?Ye(e+(t-i)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function Ke(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function Qe(e,t,i){return-Me(Ce(e,1,t),i)+t-1}function et(e,t=4,i=1){const r=Qe(e,t,i),n=Qe(e+1,t,i);return(Je(e)-r+n)/7}function tt(e){return e>99?e:e>ve.twoDigitCutoffYear?1900+e:2e3+e}function it(e,t,i,r=null){const n=new Date(e),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(s.timeZone=r);const o={timeZoneName:t,...s},a=new Intl.DateTimeFormat(i,o).formatToParts(n).find((e=>"timezonename"===e.type.toLowerCase()));return a?a.value:null}function rt(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0;return 60*i+(i<0||Object.is(i,-0)?-r:r)}function nt(e){const t=Number(e);if("boolean"==typeof e||""===e||Number.isNaN(t))throw new c(`Invalid unit value ${e}`);return t}function st(e,t){const i={};for(const r in e)if(Ve(e,r)){const n=e[r];if(null==n)continue;i[t(r)]=nt(n)}return i}function ot(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),n=e>=0?"+":"-";switch(t){case"short":return`${n}${je(i,2)}:${je(r,2)}`;case"narrow":return`${n}${i}${r>0?`:${r}`:""}`;case"techie":return`${n}${je(i,2)}${je(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function at(e){return function(e,t){return t.reduce(((t,i)=>(t[i]=e[i],t)),{})}(e,["hour","minute","second","millisecond"])}const lt=["January","February","March","April","May","June","July","August","September","October","November","December"],ct=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ut=["J","F","M","A","M","J","J","A","S","O","N","D"];function ht(e){switch(e){case"narrow":return[...ut];case"short":return[...ct];case"long":return[...lt];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const dt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],pt=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ft=["M","T","W","T","F","S","S"];function mt(e){switch(e){case"narrow":return[...ft];case"short":return[...pt];case"long":return[...dt];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const gt=["AM","PM"],yt=["Before Christ","Anno Domini"],_t=["BC","AD"],vt=["B","A"];function bt(e){switch(e){case"narrow":return[...vt];case"short":return[..._t];case"long":return[...yt];default:return null}}function wt(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const xt={D:f,DD:m,DDD:y,DDDD:_,t:v,tt:b,ttt:w,tttt:x,T,TT:C,TTT:S,TTTT:E,f:M,ff:R,fff:I,ffff:D,F:A,FF:O,FFF:L,FFFF:N};class Tt{static create(e,t={}){return new Tt(e,t)}static parseFormat(e){let t=null,i="",r=!1;const n=[];for(let s=0;s<e.length;s++){const o=e.charAt(s);"'"===o?(i.length>0&&n.push({literal:r||/^\s+$/.test(i),val:i}),t=null,i="",r=!r):r||o===t?i+=o:(i.length>0&&n.push({literal:/^\s+$/.test(i),val:i}),i=o,t=o)}return i.length>0&&n.push({literal:r||/^\s+$/.test(i),val:i}),n}static macroTokenToFormatOpts(e){return xt[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return je(e,t);const i={...this.opts};return t>0&&(i.padTo=t),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,t){const i="en"===this.loc.listingMode(),r=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,n=(t,i)=>this.loc.extract(e,t,i),s=t=>e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):"",o=()=>i?function(e){return gt[e.hour<12?0:1]}(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),a=(t,r)=>i?function(e,t){return ht(t)[e.month-1]}(e,t):n(r?{month:t}:{month:t,day:"numeric"},"month"),l=(t,r)=>i?function(e,t){return mt(t)[e.weekday-1]}(e,t):n(r?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday"),c=t=>{const i=Tt.macroTokenToFormatOpts(t);return i?this.formatWithSystemDefault(e,i):t},u=t=>i?function(e,t){return bt(t)[e.year<0?0:1]}(e,t):n({era:t},"era");return wt(Tt.parseFormat(t),(t=>{switch(t){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12==0?12:e.hour%12);case"hh":return this.num(e.hour%12==0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return o();case"d":return r?n({day:"numeric"},"day"):this.num(e.day);case"dd":return r?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return r?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return r?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return a("short",!0);case"LLLL":return a("long",!0);case"LLLLL":return a("narrow",!0);case"M":return r?n({month:"numeric"},"month"):this.num(e.month);case"MM":return r?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return a("short",!1);case"MMMM":return a("long",!1);case"MMMMM":return a("narrow",!1);case"y":return r?n({year:"numeric"},"year"):this.num(e.year);case"yy":return r?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return r?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return r?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return u("short");case"GG":return u("long");case"GGGGG":return u("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return c(t)}}))}formatDurationFromString(e,t){const i=e=>{switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},r=Tt.parseFormat(t),n=r.reduce(((e,{literal:t,val:i})=>t?e:e.concat(i)),[]);return wt(r,(e=>t=>{const r=i(t);return r?this.num(e.get(r),t.length):t})(e.shiftTo(...n.map(i).filter((e=>e)))))}}const Ct=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function St(...e){const t=e.reduce(((e,t)=>e+t.source),"");return RegExp(`^${t}$`)}function Et(...e){return t=>e.reduce((([e,i,r],n)=>{const[s,o,a]=n(t,r);return[{...e,...s},o||i,a]}),[{},null,1]).slice(0,2)}function Mt(e,...t){if(null==e)return[null,null];for(const[i,r]of t){const t=i.exec(e);if(t)return r(t)}return[null,null]}function At(...e){return(t,i)=>{const r={};let n;for(n=0;n<e.length;n++)r[e[n]]=Ze(t[i+n]);return[r,null,i+n]}}const Rt=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Ot=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Pt=RegExp(`${Ot.source}${`(?:${Rt.source}?(?:\\[(${Ct.source})\\])?)?`}`),It=RegExp(`(?:T${Pt.source})?`),Lt=At("weekYear","weekNumber","weekDay"),Dt=At("year","ordinal"),Nt=RegExp(`${Ot.source} ?(?:${Rt.source}|(${Ct.source}))?`),Ft=RegExp(`(?: ${Nt.source})?`);function Ut(e,t,i){const r=e[t];return Ne(r)?i:Ze(r)}function kt(e,t){return[{hours:Ut(e,t,0),minutes:Ut(e,t+1,0),seconds:Ut(e,t+2,0),milliseconds:We(e[t+3])},null,t+4]}function zt(e,t){const i=!e[t]&&!e[t+1],r=rt(e[t+1],e[t+2]);return[{},i?null:re.instance(r),t+3]}function Bt(e,t){return[{},e[t]?H.create(e[t]):null,t+1]}const Vt=RegExp(`^T?${Ot.source}$`),Ht=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Gt(e){const[t,i,r,n,s,o,a,l,c]=e,u="-"===t[0],h=l&&"-"===l[0],d=(e,t=!1)=>void 0!==e&&(t||e&&u)?-e:e;return[{years:d(qe(i)),months:d(qe(r)),weeks:d(qe(n)),days:d(qe(s)),hours:d(qe(o)),minutes:d(qe(a)),seconds:d(qe(l),"-0"===l),milliseconds:d(We(c),h)}]}const jt={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Zt(e,t,i,r,n,s,o){const a={year:2===t.length?tt(Ze(t)):Ze(t),month:ct.indexOf(i)+1,day:Ze(r),hour:Ze(n),minute:Ze(s)};return o&&(a.second=Ze(o)),e&&(a.weekday=e.length>3?dt.indexOf(e)+1:pt.indexOf(e)+1),a}const qt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Wt(e){const[,t,i,r,n,s,o,a,l,c,u,h]=e,d=Zt(t,n,r,i,s,o,a);let p;return p=l?jt[l]:c?0:rt(u,h),[d,new re(p)]}const $t=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Yt=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Jt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Xt(e){const[,t,i,r,n,s,o,a]=e;return[Zt(t,n,r,i,s,o,a),re.utcInstance]}function Kt(e){const[,t,i,r,n,s,o,a]=e;return[Zt(t,a,i,r,n,s,o),re.utcInstance]}const Qt=St(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,It),ei=St(/(\d{4})-?W(\d\d)(?:-?(\d))?/,It),ti=St(/(\d{4})-?(\d{3})/,It),ii=St(Pt),ri=Et((function(e,t){return[{year:Ut(e,t),month:Ut(e,t+1,1),day:Ut(e,t+2,1)},null,t+3]}),kt,zt,Bt),ni=Et(Lt,kt,zt,Bt),si=Et(Dt,kt,zt,Bt),oi=Et(kt,zt,Bt);const ai=Et(kt);const li=St(/(\d{4})-(\d\d)-(\d\d)/,Ft),ci=St(Nt),ui=Et(kt,zt,Bt);const hi="Invalid Duration",di={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},pi={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...di},fi=365.2425,mi=30.436875,gi={years:{quarters:4,months:12,weeks:52.1775,days:fi,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:mi,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...di},yi=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],_i=yi.slice(0).reverse();function vi(e,t,i=!1){const r={values:i?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new xi(r)}function bi(e,t){let i=t.milliseconds??0;for(const r of _i.slice(1))t[r]&&(i+=t[r]*e[r].milliseconds);return i}function wi(e,t){const i=bi(e,t)<0?-1:1;yi.reduceRight(((r,n)=>{if(Ne(t[n]))return r;if(r){const s=t[r]*i,o=e[n][r],a=Math.floor(s/o);t[n]+=a*i,t[r]-=a*o*i}return n}),null),yi.reduce(((i,r)=>{if(Ne(t[r]))return i;if(i){const n=t[i]%1;t[i]-=n,t[r]+=n*e[i][r]}return r}),null)}class xi{constructor(e){const t="longterm"===e.conversionAccuracy||!1;let i=t?gi:pi;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||te.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,t){return xi.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(null==e||"object"!=typeof e)throw new c("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new xi({values:st(e,xi.normalizeUnit),loc:te.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(Fe(e))return xi.fromMillis(e);if(xi.isDuration(e))return e;if("object"==typeof e)return xi.fromObject(e);throw new c(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[i]=function(e){return Mt(e,[Ht,Gt])}(e);return i?xi.fromObject(i,t):xi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[i]=function(e){return Mt(e,[Vt,ai])}(e);return i?xi.fromObject(i,t):xi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new c("need to specify a reason the Duration is invalid");const i=e instanceof be?e:new be(e,t);if(ve.throwOnInvalid)throw new o(i);return new xi({invalid:i})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new l(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const i={...t,floor:!1!==t.round&&!1!==t.floor};return this.isValid?Tt.create(this.loc,i).formatDurationFromString(this,e):hi}toHuman(e={}){if(!this.isValid)return hi;const t=yi.map((t=>{const i=this.values[t];return Ne(i)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:t.slice(0,-1)}).format(i)})).filter((e=>e));return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=$e(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();if(t<0||t>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1};return fr.fromMillis(t,{zone:"UTC"}).toISOTime(e)}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?bi(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=xi.fromDurationLike(e),i={};for(const e of yi)(Ve(t.values,e)||Ve(this.values,e))&&(i[e]=t.get(e)+this.get(e));return vi(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const t=xi.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=nt(e(this.values[i],i));return vi(this,{values:t},!0)}get(e){return this[xi.normalizeUnit(e)]}set(e){if(!this.isValid)return this;return vi(this,{values:{...this.values,...st(e,xi.normalizeUnit)}})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:i,matrix:r}={}){return vi(this,{loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:r,conversionAccuracy:i})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return wi(this.matrix,e),vi(this,{values:e},!0)}rescale(){if(!this.isValid)return this;return vi(this,{values:function(e){const t={};for(const[i,r]of Object.entries(e))0!==r&&(t[i]=r);return t}(this.normalize().shiftToAll().toObject())},!0)}shiftTo(...e){if(!this.isValid)return this;if(0===e.length)return this;e=e.map((e=>xi.normalizeUnit(e)));const t={},i={},r=this.toObject();let n;for(const s of yi)if(e.indexOf(s)>=0){n=s;let e=0;for(const t in i)e+=this.matrix[t][s]*i[t],i[t]=0;Fe(r[s])&&(e+=r[s]);const o=Math.trunc(e);t[s]=o,i[s]=(1e3*e-1e3*o)/1e3}else Fe(r[s])&&(i[s]=r[s]);for(const e in i)0!==i[e]&&(t[n]+=e===n?i[e]:i[e]/this.matrix[n][e]);return wi(this.matrix,t),vi(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=0===this.values[t]?0:-this.values[t];return vi(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;for(const r of yi)if(t=this.values[r],i=e.values[r],!(void 0===t||0===t?void 0===i||0===i:t===i))return!1;var t,i;return!0}}const Ti="Invalid Interval";class Ci{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new c("need to specify a reason the Interval is invalid");const i=e instanceof be?e:new be(e,t);if(ve.throwOnInvalid)throw new s(i);return new Ci({invalid:i})}static fromDateTimes(e,t){const i=mr(e),r=mr(t),n=function(e,t){return e&&e.isValid?t&&t.isValid?t<e?Ci.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null:Ci.invalid("missing or invalid end"):Ci.invalid("missing or invalid start")}(i,r);return null==n?new Ci({start:i,end:r}):n}static after(e,t){const i=xi.fromDurationLike(t),r=mr(e);return Ci.fromDateTimes(r,r.plus(i))}static before(e,t){const i=xi.fromDurationLike(t),r=mr(e);return Ci.fromDateTimes(r.minus(i),r)}static fromISO(e,t){const[i,r]=(e||"").split("/",2);if(i&&r){let e,n,s,o;try{e=fr.fromISO(i,t),n=e.isValid}catch(r){n=!1}try{s=fr.fromISO(r,t),o=s.isValid}catch(r){o=!1}if(n&&o)return Ci.fromDateTimes(e,s);if(n){const i=xi.fromISO(r,t);if(i.isValid)return Ci.after(e,i)}else if(o){const e=xi.fromISO(i,t);if(e.isValid)return Ci.before(s,e)}}return Ci.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",t){if(!this.isValid)return NaN;const i=this.start.startOf(e,t);let r;return r=t?.useLocaleWeeks?this.end.reconfigure({locale:i.locale}):this.end,r=r.startOf(e,t),Math.floor(r.diff(i,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&(this.s<=e&&this.e>e)}set({start:e,end:t}={}){return this.isValid?Ci.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(mr).filter((e=>this.contains(e))).sort(((e,t)=>e.toMillis()-t.toMillis())),i=[];let{s:r}=this,n=0;for(;r<this.e;){const e=t[n]||this.e,s=+e>+this.e?this.e:e;i.push(Ci.fromDateTimes(r,s)),r=s,n+=1}return i}splitBy(e){const t=xi.fromDurationLike(e);if(!this.isValid||!t.isValid||0===t.as("milliseconds"))return[];let i,{s:r}=this,n=1;const s=[];for(;r<this.e;){const e=this.start.plus(t.mapUnits((e=>e*n)));i=+e>+this.e?this.e:e,s.push(Ci.fromDateTimes(r,i)),r=i,n+=1}return s}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e==+e.s}abutsEnd(e){return!!this.isValid&&+e.e==+this.s}engulfs(e){return!!this.isValid&&(this.s<=e.s&&this.e>=e.e)}equals(e){return!(!this.isValid||!e.isValid)&&(this.s.equals(e.s)&&this.e.equals(e.e))}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return t>=i?null:Ci.fromDateTimes(t,i)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Ci.fromDateTimes(t,i)}static merge(e){const[t,i]=e.sort(((e,t)=>e.s-t.s)).reduce((([e,t],i)=>t?t.overlaps(i)||t.abutsStart(i)?[e,t.union(i)]:[e.concat([t]),i]:[e,i]),[[],null]);return i&&t.push(i),t}static xor(e){let t=null,i=0;const r=[],n=e.map((e=>[{time:e.s,type:"s"},{time:e.e,type:"e"}])),s=Array.prototype.concat(...n).sort(((e,t)=>e.time-t.time));for(const e of s)i+="s"===e.type?1:-1,1===i?t=e.time:(t&&+t!=+e.time&&r.push(Ci.fromDateTimes(t,e.time)),t=null);return Ci.merge(r)}difference(...e){return Ci.xor([this].concat(e)).map((e=>this.intersection(e))).filter((e=>e&&!e.isEmpty()))}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:Ti}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=f,t={}){return this.isValid?Tt.create(this.s.loc.clone(t),e).formatInterval(this):Ti}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Ti}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Ti}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Ti}toFormat(e,{separator:t="  "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:Ti}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):xi.invalid(this.invalidReason)}mapEndpoints(e){return Ci.fromDateTimes(e(this.s),e(this.e))}}class Si{static hasDST(e=ve.defaultZone){const t=fr.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return H.isValidZone(e)}static normalizeZone(e){return se(e,ve.defaultZone)}static getStartOfWeek({locale:e=null,locObj:t=null}={}){return(t||te.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:t=null}={}){return(t||te.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:t=null}={}){return(t||te.create(e)).getWeekendDays().slice()}static months(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null,outputCalendar:n="gregory"}={}){return(r||te.create(t,i,n)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null,outputCalendar:n="gregory"}={}){return(r||te.create(t,i,n)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null}={}){return(r||te.create(t,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null}={}){return(r||te.create(t,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return te.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return te.create(t,null,"gregory").eras(e)}static features(){return{relative:ke(),localeWeek:ze()}}}function Ei(e,t){const i=e=>e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(xi.fromMillis(r).as("days"))}function Mi(e,t,i,r){let[n,s,o,a]=function(e,t,i){const r=[["years",(e,t)=>t.year-e.year],["quarters",(e,t)=>t.quarter-e.quarter+4*(t.year-e.year)],["months",(e,t)=>t.month-e.month+12*(t.year-e.year)],["weeks",(e,t)=>{const i=Ei(e,t);return(i-i%7)/7}],["days",Ei]],n={},s=e;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,n[l]=c(e,t),a=s.plus(n),a>t?(n[l]--,(e=s.plus(n))>t&&(a=e,n[l]--,e=s.plus(n))):e=a);return[e,n,a,o]}(e,t,i);const l=t-n,c=i.filter((e=>["hours","minutes","seconds","milliseconds"].indexOf(e)>=0));0===c.length&&(o<t&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const u=xi.fromObject(s,r);return c.length>0?xi.fromMillis(l,r).shiftTo(...c).plus(u):u}function Ai(e,t=(e=>e)){return{regex:e,deser:([e])=>t(function(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(-1!==e[i].search(oe.hanidec))t+=le.indexOf(e[i]);else for(const e in ae){const[i,n]=ae[e];r>=i&&r<=n&&(t+=r-i)}}return parseInt(t,10)}return t}(e))}}const Ri=`[ ${String.fromCharCode(160)}]`,Oi=new RegExp(Ri,"g");function Pi(e){return e.replace(/\./g,"\\.?").replace(Oi,Ri)}function Ii(e){return e.replace(/\./g,"").replace(Oi," ").toLowerCase()}function Li(e,t){return null===e?null:{regex:RegExp(e.map(Pi).join("|")),deser:([i])=>e.findIndex((e=>Ii(i)===Ii(e)))+t}}function Di(e,t){return{regex:e,deser:([,e,t])=>rt(e,t),groups:t}}function Ni(e){return{regex:e,deser:([e])=>e}}const Fi={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let Ui=null;function ki(e,t){return Array.prototype.concat(...e.map((e=>function(e,t){if(e.literal)return e;const i=Vi(Tt.macroTokenToFormatOpts(e.val),t);return null==i||i.includes(void 0)?e:i}(e,t))))}class zi{constructor(e,t){if(this.locale=e,this.format=t,this.tokens=ki(Tt.parseFormat(t),e),this.units=this.tokens.map((t=>function(e,t){const i=ue(t),r=ue(t,"{2}"),n=ue(t,"{3}"),s=ue(t,"{4}"),o=ue(t,"{6}"),a=ue(t,"{1,2}"),l=ue(t,"{1,3}"),c=ue(t,"{1,6}"),u=ue(t,"{1,9}"),h=ue(t,"{2,4}"),d=ue(t,"{4,6}"),p=e=>{return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([e])=>e,literal:!0};var t},f=(f=>{if(e.literal)return p(f);switch(f.val){case"G":return Li(t.eras("short"),0);case"GG":return Li(t.eras("long"),0);case"y":return Ai(c);case"yy":case"kk":return Ai(h,tt);case"yyyy":case"kkkk":return Ai(s);case"yyyyy":return Ai(d);case"yyyyyy":return Ai(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return Ai(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return Ai(r);case"MMM":return Li(t.months("short",!0),1);case"MMMM":return Li(t.months("long",!0),1);case"LLL":return Li(t.months("short",!1),1);case"LLLL":return Li(t.months("long",!1),1);case"o":case"S":return Ai(l);case"ooo":case"SSS":return Ai(n);case"u":return Ni(u);case"uu":return Ni(a);case"uuu":case"E":case"c":return Ai(i);case"a":return Li(t.meridiems(),0);case"EEE":return Li(t.weekdays("short",!1),1);case"EEEE":return Li(t.weekdays("long",!1),1);case"ccc":return Li(t.weekdays("short",!0),1);case"cccc":return Li(t.weekdays("long",!0),1);case"Z":case"ZZ":return Di(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Di(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return Ni(/[a-z_+-/]{1,256}?/i);case" ":return Ni(/[^\S\n\r]/);default:return p(f)}})(e)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return f.token=e,f}(t,e))),this.disqualifyingUnit=this.units.find((e=>e.invalidReason)),!this.disqualifyingUnit){const[e,t]=[`^${(i=this.units).map((e=>e.regex)).reduce(((e,t)=>`${e}(${t.source})`),"")}$`,i];this.regex=RegExp(e,"i"),this.handlers=t}var i}explainFromTokens(e){if(this.isValid){const[t,i]=function(e,t,i){const r=e.match(t);if(r){const e={};let t=1;for(const n in i)if(Ve(i,n)){const s=i[n],o=s.groups?s.groups+1:1;!s.literal&&s.token&&(e[s.token.val[0]]=s.deser(r.slice(t,t+o))),t+=o}return[r,e]}return[r,{}]}(e,this.regex,this.handlers),[r,n,s]=i?function(e){let t,i=null;return Ne(e.z)||(i=H.create(e.z)),Ne(e.Z)||(i||(i=new re(e.Z)),t=e.Z),Ne(e.q)||(e.M=3*(e.q-1)+1),Ne(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),Ne(e.u)||(e.S=We(e.u)),[Object.keys(e).reduce(((t,i)=>{const r=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(i);return r&&(t[r]=e[i]),t}),{}),i,t]}(i):[null,null,void 0];if(Ve(i,"a")&&Ve(i,"H"))throw new a("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:t,matches:i,result:r,zone:n,specificOffset:s}}return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function Bi(e,t,i){return new zi(e,i).explainFromTokens(t)}function Vi(e,t){if(!e)return null;const i=Tt.create(t,e).dtFormatter((Ui||(Ui=fr.fromMillis(1555555555555)),Ui)),r=i.formatToParts(),n=i.resolvedOptions();return r.map((t=>function(e,t,i){const{type:r,value:n}=e;if("literal"===r){const e=/^\s+$/.test(n);return{literal:!e,val:e?" ":n}}const s=t[r];let o=r;"hour"===r&&(o=null!=t.hour12?t.hour12?"hour12":"hour24":null!=t.hourCycle?"h11"===t.hourCycle||"h12"===t.hourCycle?"hour12":"hour24":i.hour12?"hour12":"hour24");let a=Fi[o];if("object"==typeof a&&(a=a[s]),a)return{literal:!1,val:a}}(t,e,n)))}const Hi="Invalid DateTime",Gi=864e13;function ji(e){return new be("unsupported zone",`the zone "${e.name}" is not supported`)}function Zi(e){return null===e.weekData&&(e.weekData=Ae(e.c)),e.weekData}function qi(e){return null===e.localWeekData&&(e.localWeekData=Ae(e.c,e.loc.getMinDaysInFirstWeek(),e.loc.getStartOfWeek())),e.localWeekData}function Wi(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new fr({...i,...t,old:i})}function $i(e,t,i){let r=e-60*t*1e3;const n=i.offset(r);if(t===n)return[r,t];r-=60*(n-t)*1e3;const s=i.offset(r);return n===s?[r,n]:[e-60*Math.min(n,s)*1e3,Math.max(n,s)]}function Yi(e,t){const i=new Date(e+=60*t*1e3);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function Ji(e,t,i){return $i(Ke(e),t,i)}function Xi(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),n=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),s={...e.c,year:r,month:n,day:Math.min(e.c.day,Xe(r,n))+Math.trunc(t.days)+7*Math.trunc(t.weeks)},o=xi.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=Ke(s);let[l,c]=$i(a,i,e.zone);return 0!==o&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function Ki(e,t,i,r,n,s){const{setZone:o,zone:a}=i;if(e&&0!==Object.keys(e).length||t){const r=t||a,n=fr.fromObject(e,{...i,zone:r,specificOffset:s});return o?n:n.setZone(a)}return fr.invalid(new be("unparsable",`the input "${n}" can't be parsed as ${r}`))}function Qi(e,t,i=!0){return e.isValid?Tt.create(te.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function er(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=je(e.c.year,i?6:4),t?(r+="-",r+=je(e.c.month),r+="-",r+=je(e.c.day)):(r+=je(e.c.month),r+=je(e.c.day)),r}function tr(e,t,i,r,n,s){let o=je(e.c.hour);return t?(o+=":",o+=je(e.c.minute),0===e.c.millisecond&&0===e.c.second&&i||(o+=":")):o+=je(e.c.minute),0===e.c.millisecond&&0===e.c.second&&i||(o+=je(e.c.second),0===e.c.millisecond&&r||(o+=".",o+=je(e.c.millisecond,3))),n&&(e.isOffsetFixed&&0===e.offset&&!s?o+="Z":e.o<0?(o+="-",o+=je(Math.trunc(-e.o/60)),o+=":",o+=je(Math.trunc(-e.o%60))):(o+="+",o+=je(Math.trunc(e.o/60)),o+=":",o+=je(Math.trunc(e.o%60)))),s&&(o+="["+e.zone.ianaName+"]"),o}const ir={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},rr={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},nr={ordinal:1,hour:0,minute:0,second:0,millisecond:0},sr=["year","month","day","hour","minute","second","millisecond"],or=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],ar=["year","ordinal","hour","minute","second","millisecond"];function lr(e){switch(e.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return function(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new l(e);return t}(e)}}function cr(e,t){const i=se(t.zone,ve.defaultZone);if(!i.isValid)return fr.invalid(ji(i));const r=te.fromObject(t);let n,s;if(Ne(e.year))n=ve.now();else{for(const t of sr)Ne(e[t])&&(e[t]=ir[t]);const t=Le(e)||De(e);if(t)return fr.invalid(t);const r=function(e){return pr[e]||(void 0===dr&&(dr=ve.now()),pr[e]=e.offset(dr)),pr[e]}(i);[n,s]=Ji(e,r,i)}return new fr({ts:n,zone:i,loc:r,o:s})}function ur(e,t,i){const r=!!Ne(i.round)||i.round,n=(e,n)=>{e=$e(e,r||i.calendary?0:2,!0);return t.loc.clone(i).relFormatter(i).format(e,n)},s=r=>i.calendary?t.hasSame(e,r)?0:t.startOf(r).diff(e.startOf(r),r).get(r):t.diff(e,r).get(r);if(i.unit)return n(s(i.unit),i.unit);for(const e of i.units){const t=s(e);if(Math.abs(t)>=1)return n(t,e)}return n(e>t?-0:0,i.units[i.units.length-1])}function hr(e){let t,i={};return e.length>0&&"object"==typeof e[e.length-1]?(i=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[i,t]}let dr,pr={};class fr{constructor(e){const t=e.zone||ve.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new be("invalid input"):null)||(t.isValid?null:ji(t));this.ts=Ne(e.ts)?ve.now():e.ts;let r=null,n=null;if(!i){if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[r,n]=[e.old.c,e.old.o];else{const s=Fe(e.o)&&!e.old?e.o:t.offset(this.ts);r=Yi(this.ts,s),i=Number.isNaN(r.year)?new be("invalid input"):null,r=i?null:r,n=i?null:s}}this._zone=t,this.loc=e.loc||te.create(),this.invalid=i,this.weekData=null,this.localWeekData=null,this.c=r,this.o=n,this.isLuxonDateTime=!0}static now(){return new fr({})}static local(){const[e,t]=hr(arguments),[i,r,n,s,o,a,l]=t;return cr({year:i,month:r,day:n,hour:s,minute:o,second:a,millisecond:l},e)}static utc(){const[e,t]=hr(arguments),[i,r,n,s,o,a,l]=t;return e.zone=re.utcInstance,cr({year:i,month:r,day:n,hour:s,minute:o,second:a,millisecond:l},e)}static fromJSDate(e,t={}){const i=function(e){return"[object Date]"===Object.prototype.toString.call(e)}(e)?e.valueOf():NaN;if(Number.isNaN(i))return fr.invalid("invalid input");const r=se(t.zone,ve.defaultZone);return r.isValid?new fr({ts:i,zone:r,loc:te.fromObject(t)}):fr.invalid(ji(r))}static fromMillis(e,t={}){if(Fe(e))return e<-Gi||e>Gi?fr.invalid("Timestamp out of range"):new fr({ts:e,zone:se(t.zone,ve.defaultZone),loc:te.fromObject(t)});throw new c(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(Fe(e))return new fr({ts:1e3*e,zone:se(t.zone,ve.defaultZone),loc:te.fromObject(t)});throw new c("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const i=se(t.zone,ve.defaultZone);if(!i.isValid)return fr.invalid(ji(i));const r=te.fromObject(t),n=st(e,lr),{minDaysInFirstWeek:s,startOfWeek:o}=Ie(n,r),l=ve.now(),c=Ne(t.specificOffset)?i.offset(l):t.specificOffset,u=!Ne(n.ordinal),h=!Ne(n.year),d=!Ne(n.month)||!Ne(n.day),p=h||d,f=n.weekYear||n.weekNumber;if((p||u)&&f)throw new a("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(d&&u)throw new a("Can't mix ordinal dates with month/day");const m=f||n.weekday&&!p;let g,y,_=Yi(l,c);m?(g=or,y=rr,_=Ae(_,s,o)):u?(g=ar,y=nr,_=Oe(_)):(g=sr,y=ir);let v=!1;for(const e of g){Ne(n[e])?n[e]=v?y[e]:_[e]:v=!0}const b=m?function(e,t=4,i=1){const r=Ue(e.weekYear),n=Ge(e.weekNumber,1,et(e.weekYear,t,i)),s=Ge(e.weekday,1,7);return r?n?!s&&Te("weekday",e.weekday):Te("week",e.weekNumber):Te("weekYear",e.weekYear)}(n,s,o):u?function(e){const t=Ue(e.year),i=Ge(e.ordinal,1,Je(e.year));return t?!i&&Te("ordinal",e.ordinal):Te("year",e.year)}(n):Le(n),w=b||De(n);if(w)return fr.invalid(w);const x=m?Re(n,s,o):u?Pe(n):n,[T,C]=Ji(x,c,i),S=new fr({ts:T,zone:i,o:C,loc:r});return n.weekday&&p&&e.weekday!==S.weekday?fr.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${S.toISO()}`):S.isValid?S:fr.invalid(S.invalid)}static fromISO(e,t={}){const[i,r]=function(e){return Mt(e,[Qt,ri],[ei,ni],[ti,si],[ii,oi])}(e);return Ki(i,r,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[i,r]=function(e){return Mt(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[qt,Wt])}(e);return Ki(i,r,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[i,r]=function(e){return Mt(e,[$t,Xt],[Yt,Xt],[Jt,Kt])}(e);return Ki(i,r,t,"HTTP",t)}static fromFormat(e,t,i={}){if(Ne(e)||Ne(t))throw new c("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:n=null}=i,s=te.fromOpts({locale:r,numberingSystem:n,defaultToEN:!0}),[o,a,l,u]=function(e,t,i){const{result:r,zone:n,specificOffset:s,invalidReason:o}=Bi(e,t,i);return[r,n,s,o]}(s,e,t);return u?fr.invalid(u):Ki(o,a,i,`format ${t}`,e,l)}static fromString(e,t,i={}){return fr.fromFormat(e,t,i)}static fromSQL(e,t={}){const[i,r]=function(e){return Mt(e,[li,ri],[ci,ui])}(e);return Ki(i,r,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new c("need to specify a reason the DateTime is invalid");const i=e instanceof be?e:new be(e,t);if(ve.throwOnInvalid)throw new n(i);return new fr({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const i=Vi(e,te.fromObject(t));return i?i.map((e=>e?e.val:null)).join(""):null}static expandFormat(e,t={}){return ki(Tt.parseFormat(e),te.fromObject(t)).map((e=>e.val)).join("")}static resetCache(){dr=void 0,pr={}}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Zi(this).weekYear:NaN}get weekNumber(){return this.isValid?Zi(this).weekNumber:NaN}get weekday(){return this.isValid?Zi(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?qi(this).weekday:NaN}get localWeekNumber(){return this.isValid?qi(this).weekNumber:NaN}get localWeekYear(){return this.isValid?qi(this).weekYear:NaN}get ordinal(){return this.isValid?Oe(this.c).ordinal:NaN}get monthShort(){return this.isValid?Si.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Si.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Si.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Si.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,i=Ke(this.c),r=this.zone.offset(i-e),n=this.zone.offset(i+e),s=this.zone.offset(i-r*t),o=this.zone.offset(i-n*t);if(s===o)return[this];const a=i-s*t,l=i-o*t,c=Yi(a,s),u=Yi(l,o);return c.hour===u.hour&&c.minute===u.minute&&c.second===u.second&&c.millisecond===u.millisecond?[Wi(this,{ts:a}),Wi(this,{ts:l})]:[this]}get isInLeapYear(){return Ye(this.year)}get daysInMonth(){return Xe(this.year,this.month)}get daysInYear(){return this.isValid?Je(this.year):NaN}get weeksInWeekYear(){return this.isValid?et(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?et(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:i,calendar:r}=Tt.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:i,outputCalendar:r}}toUTC(e=0,t={}){return this.setZone(re.instance(e),t)}toLocal(){return this.setZone(ve.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:i=!1}={}){if((e=se(e,ve.defaultZone)).equals(this.zone))return this;if(e.isValid){let r=this.ts;if(t||i){const t=e.offset(this.ts),i=this.toObject();[r]=Ji(i,t,e)}return Wi(this,{ts:r,zone:e})}return fr.invalid(ji(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:i}={}){return Wi(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:i})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=st(e,lr),{minDaysInFirstWeek:i,startOfWeek:r}=Ie(t,this.loc),n=!Ne(t.weekYear)||!Ne(t.weekNumber)||!Ne(t.weekday),s=!Ne(t.ordinal),o=!Ne(t.year),l=!Ne(t.month)||!Ne(t.day),c=o||l,u=t.weekYear||t.weekNumber;if((c||s)&&u)throw new a("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&s)throw new a("Can't mix ordinal dates with month/day");let h;n?h=Re({...Ae(this.c,i,r),...t},i,r):Ne(t.ordinal)?(h={...this.toObject(),...t},Ne(t.day)&&(h.day=Math.min(Xe(h.year,h.month),h.day))):h=Pe({...Oe(this.c),...t});const[d,p]=Ji(h,this.o,this.zone);return Wi(this,{ts:d,o:p})}plus(e){if(!this.isValid)return this;return Wi(this,Xi(this,xi.fromDurationLike(e)))}minus(e){if(!this.isValid)return this;return Wi(this,Xi(this,xi.fromDurationLike(e).negate()))}startOf(e,{useLocaleWeeks:t=!1}={}){if(!this.isValid)return this;const i={},r=xi.normalizeUnit(e);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0}if("weeks"===r)if(t){const e=this.loc.getStartOfWeek(),{weekday:t}=this;t<e&&(i.weekNumber=this.weekNumber-1),i.weekday=e}else i.weekday=1;if("quarters"===r){const e=Math.ceil(this.month/3);i.month=3*(e-1)+1}return this.set(i)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e,t={}){return this.isValid?Tt.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):Hi}toLocaleString(e=f,t={}){return this.isValid?Tt.create(this.loc.clone(t),e).formatDateTime(this):Hi}toLocaleParts(e={}){return this.isValid?Tt.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:i=!1,includeOffset:r=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const s="extended"===e;let o=er(this,s);return o+="T",o+=tr(this,s,t,i,r,n),o}toISODate({format:e="extended"}={}){return this.isValid?er(this,"extended"===e):null}toISOWeekDate(){return Qi(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:i=!0,includePrefix:r=!1,extendedZone:n=!1,format:s="extended"}={}){if(!this.isValid)return null;return(r?"T":"")+tr(this,"extended"===s,t,e,i,n)}toRFC2822(){return Qi(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Qi(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?er(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:i=!0}={}){let r="HH:mm:ss.SSS";return(t||e)&&(i&&(r+=" "),t?r+="z":e&&(r+="ZZ")),Qi(this,r,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():Hi}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",i={}){if(!this.isValid||!e.isValid)return xi.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=(a=t,Array.isArray(a)?a:[a]).map(xi.normalizeUnit),s=e.valueOf()>this.valueOf(),o=Mi(s?this:e,s?e:this,n,r);var a;return s?o.negate():o}diffNow(e="milliseconds",t={}){return this.diff(fr.now(),e,t)}until(e){return this.isValid?Ci.fromDateTimes(this,e):this}hasSame(e,t,i){if(!this.isValid)return!1;const r=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(t,i)<=r&&r<=n.endOf(t,i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||fr.fromObject({},{zone:this.zone}),i=e.padding?this<t?-e.padding:e.padding:0;let r=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(r=e.unit,n=void 0),ur(t,this.plus(i),{...e,numeric:"always",units:r,unit:n})}toRelativeCalendar(e={}){return this.isValid?ur(e.base||fr.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(fr.isDateTime))throw new c("min requires all arguments be DateTimes");return Be(e,(e=>e.valueOf()),Math.min)}static max(...e){if(!e.every(fr.isDateTime))throw new c("max requires all arguments be DateTimes");return Be(e,(e=>e.valueOf()),Math.max)}static fromFormatExplain(e,t,i={}){const{locale:r=null,numberingSystem:n=null}=i;return Bi(te.fromOpts({locale:r,numberingSystem:n,defaultToEN:!0}),e,t)}static fromStringExplain(e,t,i={}){return fr.fromFormatExplain(e,t,i)}static buildFormatParser(e,t={}){const{locale:i=null,numberingSystem:r=null}=t,n=te.fromOpts({locale:i,numberingSystem:r,defaultToEN:!0});return new zi(n,e)}static fromFormatParser(e,t,i={}){if(Ne(e)||Ne(t))throw new c("fromFormatParser requires an input string and a format parser");const{locale:r=null,numberingSystem:n=null}=i,s=te.fromOpts({locale:r,numberingSystem:n,defaultToEN:!0});if(!s.equals(t.locale))throw new c(`fromFormatParser called with a locale of ${s}, but the format parser was created for ${t.locale}`);const{result:o,zone:a,specificOffset:l,invalidReason:u}=t.explainFromTokens(e);return u?fr.invalid(u):Ki(o,a,i,`format ${t.format}`,e,l)}static get DATE_SHORT(){return f}static get DATE_MED(){return m}static get DATE_MED_WITH_WEEKDAY(){return g}static get DATE_FULL(){return y}static get DATE_HUGE(){return _}static get TIME_SIMPLE(){return v}static get TIME_WITH_SECONDS(){return b}static get TIME_WITH_SHORT_OFFSET(){return w}static get TIME_WITH_LONG_OFFSET(){return x}static get TIME_24_SIMPLE(){return T}static get TIME_24_WITH_SECONDS(){return C}static get TIME_24_WITH_SHORT_OFFSET(){return S}static get TIME_24_WITH_LONG_OFFSET(){return E}static get DATETIME_SHORT(){return M}static get DATETIME_SHORT_WITH_SECONDS(){return A}static get DATETIME_MED(){return R}static get DATETIME_MED_WITH_SECONDS(){return O}static get DATETIME_MED_WITH_WEEKDAY(){return P}static get DATETIME_FULL(){return I}static get DATETIME_FULL_WITH_SECONDS(){return L}static get DATETIME_HUGE(){return D}static get DATETIME_HUGE_WITH_SECONDS(){return N}}function mr(e){if(fr.isDateTime(e))return e;if(e&&e.valueOf&&Fe(e.valueOf()))return fr.fromJSDate(e);if(e&&"object"==typeof e)return fr.fromObject(e);throw new c(`Unknown datetime argument: ${e}, of type ${typeof e}`)}}},r={};function n(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={exports:{}};return i[e](s,s.exports,n),s.exports}n.m=i,n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,i)=>(n.f[i](e,t),t)),[])),n.u=e=>e+".js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="arcgis_webpack01:",n.l=(i,r,s,o)=>{if(e[i])e[i].push(r);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+s){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+s),a.src=i),e[i]=[r];var d=(t,r)=>{a.onerror=a.onload=null,clearTimeout(p);var n=e[i];if(delete e[i],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((e=>e(r))),t)return t(r)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={40179:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var s=new Promise(((i,n)=>r=e[t]=[i,n]));i.push(r[2]=s);var o=n.p+n.u(t),a=new Error;n.l(o,(i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,r[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,s,[o,a,l]=i,c=0;if(o.some((t=>0!==e[t]))){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(l)l(n)}for(t&&t(i);c<o.length;c++)s=o[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0},i=self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{var e,t=n(51366),i=n(36663),r=n(10017),s=n(30936),o=n(41831),a=n(58811),l=n(27755),c=n(70375),u=n(82064),h=n(67134),d=n(68309),p=n(63592),f=n(13802),m=n(61681),g=n(78668),y=n(81977),_=n(7283),v=n(40266),b=n(39835),w=n(39994),x=(n(4157),n(79438));let T=e=class extends u.Z{constructor(e){super(e),this.type="none"}clone(){return new e({type:this.type})}};(0,i._)([(0,x.J)({none:"none",stayAbove:"stay-above"}),(0,y.Cb)({json:{write:{isRequired:!0}}})],T.prototype,"type",void 0),T=e=(0,i._)([(0,v.j)("esri.ground.NavigationConstraint")],T);const C=Symbol("GroundInstance");var S,E,M=n(78621);let A=E=class extends(u.Z.JSONSupportMixin(d.Z)){constructor(e){super(e),this[S]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new o.Z;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"!==e.type&&"base-elevation"!==e.type&&f.Z.getLogger(this).error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.addHandles([this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>(e=>{e.parent=null})(e.item)))])}initialize(){this.when().catch((e=>{(0,g.D_)(e)||f.Z.getLogger(this).error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)(0,m.SC)(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",(0,a.Z)(e,this._get("layers")))}writeLayers(e,t,i,r){const n=[];e?(r={...r,layerContainerType:"ground"},e.forEach((e=>{if("write"in e){const t={};(0,l.sM)(e)().write(t,r)&&n.push(t)}else r?.messages&&r.messages.push(new c.Z("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in the ground`,{layer:e}))})),t.layers=n):t.layers=n}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,p.G)(this,(e=>{e(this.layers)}))}async queryElevation(e,t){await this.load({signal:t?.signal});const{ElevationQuery:i}=await Promise.resolve().then(n.bind(n,8184));(0,g.k_)(t);const r=new i,s=this.layers.filter(R).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{ElevationQuery:i}=await Promise.resolve().then(n.bind(n,8184));(0,g.k_)(t);const r=new i,s=this.layers.filter(R).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:(0,h.d9)(this.surfaceColor),navigationConstraint:(0,h.d9)(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new E({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,i){const r=t?.origin||"web-scene",s=t?.portal||null,o=t?.url||null,{populateOperationalLayers:a}=await n.e(45423).then(n.bind(n,45423));(0,g.k_)(i);const l=[];if(e.layers&&Array.isArray(e.layers)){const t={context:{origin:r,url:o,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};l.push(a(this.layers,e.layers,t))}await Promise.allSettled(l)}};function R(e){return"elevation"===e.type||function(e){return e&&"createElevationSampler"in e}(e)}S=C,(0,i._)([(0,y.Cb)({json:{read:!1,write:{isRequired:!0}}})],A.prototype,"layers",null),(0,i._)([(0,b.c)("layers")],A.prototype,"writeLayers",null),(0,i._)([(0,y.Cb)({readOnly:!0})],A.prototype,"resourceInfo",void 0),(0,i._)([(0,y.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:_.z8,read:{reader:M.b,source:"transparency"},write:{writer:(e,t)=>{t.transparency=(0,M.a)(e)},target:"transparency"}}})],A.prototype,"opacity",void 0),(0,i._)([(0,y.Cb)({type:s.Z,json:{type:[_.z8],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],A.prototype,"surfaceColor",void 0),(0,i._)([(0,y.Cb)({type:T,json:{write:!0}})],A.prototype,"navigationConstraint",void 0),A=E=(0,i._)([(0,v.j)("esri.Ground")],A);const O=A;var P=n(74396),I=n(81739),L=n(31355),D=n(69236),N=n(23148),F=n(76868);const U=new WeakMap;function k(e){return!e.destroyed&&(U.has(e)||e.addHandles([(0,F.watch)((()=>{const t=e.parent;return!(!t||!("type"in t))&&("catalog-dynamic-group"===t.type||k(t))}),(t=>U.set(e,t)),F.syncAndInitial),(0,N.kB)((()=>U.delete(e)))]),U.get(e))}var z=n(54957);function B(e){return!(!function(e){return"object"==typeof e&&null!=e&&"loaded"in e&&!0===e.loaded&&"type"in e}(e)||!(0,z.S1)(e)?.operations?.supportsEditing||"editingEnabled"in e&&!(0,z.ln)(e)||k(e))}var V=n(2725),H=n(64573);const G=()=>f.Z.getLogger("esri.support.basemapUtils");function j(e){for(const t in e){const i=e[t];(0,m.SC)(i),delete e[t]}}function Z(e,i){let n;if("string"==typeof e){const s=e in V.s,o=!s&&e.includes("/");if(!s&&!o){if(t.Z.apiKey)G().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const t=Object.entries(V.s).filter((([e,t])=>t.classic||t.is3d)).map((([e])=>`"${e}"`)).sort().join(", ");G().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`)}return null}i&&(n=i[e]),n||(n=s?r.default.fromId(e):new r.default({style:{id:e}}),i&&(i[e]=n))}else n=(0,_.se)(r.default,e);return n?.destroyed&&(G().warn("The provided basemap is already destroyed",{basemap:n}),n=null),n}var q=n(42228);const W={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};var $=n(9008),Y=n(98234);let J=class extends((0,Y.Q)((0,$.K)(L.Z.EventedMixin(P.Z)))){constructor(e){super(e),this.allLayers=new I.Z({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:e=>"layers"in e?e.layers:null}),this.allTables=(0,q.a)(this),this.basemap=null,this.editableLayers=new I.Z({getCollections:()=>[this.allLayers],itemFilterFunction:B}),this.ground=new O,this._basemapCache={}}destroy(){j(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=(0,m.SC)(this.basemap),(0,m.SC)(this.ground),this._set("ground",null)}castBasemap(e){return Z(e,this._basemapCache)}castGround(e){return function(e){let t=null;"string"==typeof e?e in W?t=new O({resourceInfo:{data:{layers:[W[e]]}}}):f.Z.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`):t=(0,_.se)(O,e);return t}(e)??this._get("ground")}findLayerById(e){return this.allLayers.find((t=>t.id===e))}findTableById(e){return this.allTables.find((t=>t.id===e))}};(0,i._)([(0,y.Cb)({readOnly:!0,dependsOn:[]})],J.prototype,"allLayers",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],J.prototype,"allTables",void 0),(0,i._)([(0,y.Cb)({type:r.default,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],J.prototype,"basemap",void 0),(0,i._)([(0,D.p)("basemap")],J.prototype,"castBasemap",null),(0,i._)([(0,y.Cb)({readOnly:!0})],J.prototype,"editableLayers",void 0),(0,i._)([(0,y.Cb)({type:O,nonNullable:!0})],J.prototype,"ground",void 0),(0,i._)([(0,D.p)("ground")],J.prototype,"castGround",null),(0,i._)([(0,y.Cb)()],J.prototype,"undoRedo",void 0),J=(0,i._)([(0,v.j)("esri.Map")],J);const X=J;var K=n(19812),Q=n(62517),ee=n(89542),te=n(90472),ie=n(81590),re=n(50904);const ne={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],n=this.values;return r>=i?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},se={xsmall:544,small:768,medium:992,large:1200};function oe(e,t){return t?ne[e].valueToClassName[t].split(" "):[]}const ae=e=>{let t=class extends e{constructor(...e){super(...e),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=se}initialize(){this.addHandles((0,F.watch)((()=>[this.breakpoints,this.size]),(()=>this._updateClassNames()),F.initial))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(e){if(e!==this._get("breakpoints")){if(!function(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(e)){const t=JSON.stringify(se,null,2);console.warn("provided breakpoints are not valid, using defaults:"+t),e=se}this._set("breakpoints",{...e})}}_updateClassNames(){if(!this.container)return;const e=re.Z.acquire(),t=re.Z.acquire();let i,r=!1;for(i in ne){const n=this[i],s=ne[i].getValue({viewSize:this.size,breakpoints:this.breakpoints});n!==s&&(r=!0,this[i]=s,oe(i,n).forEach((e=>t.push(e))),oe(i,s).forEach((t=>e.push(t))))}r&&(this._applyClassNameChanges(e,t),re.Z.release(e),re.Z.release(t))}_applyClassNameChanges(e,t){const i=this.container;i&&(t.forEach((e=>i.classList.remove(e))),e.forEach((e=>i.classList.add(e))))}_removeActiveClassNames(){const e=this.container;if(!e)return;let t;for(t in ne)oe(t,this[t]).forEach((t=>e.classList.remove(t)))}};return(0,i._)([(0,y.Cb)()],t.prototype,"breakpoints",null),(0,i._)([(0,y.Cb)()],t.prototype,"orientation",void 0),(0,i._)([(0,y.Cb)()],t.prototype,"widthBreakpoint",void 0),(0,i._)([(0,y.Cb)()],t.prototype,"heightBreakpoint",void 0),t=(0,i._)([(0,v.j)("esri.views.BreakpointsOwner")],t),t};var le=n(59183),ce=n(49546),ue=n(17262),he=n(98940),de=(n(56803),n(22591));let pe=class extends P.Z{constructor(){super(...arguments),this.items=new o.Z,this._watchUpdatingTracking=new he.R,this._callbacks=new Map,this._projector=(0,de.E)(),this._hiddenProjector=(0,de.E)()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange((()=>this.items),(e=>{for(const t of e.added){const e=()=>t.render();this._callbacks.set(t,e),this._projector.append(this.surface,e)}for(const t of e.removed){const e=this._projector.detach(this._callbacks.get(t));this.surface.removeChild(e.domNode),this._callbacks.delete(t)}}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r;const n=()=>(r=e.render(),r);i.append(t,n),i.renderNow();const s={left:0,top:0,right:0,bottom:0};if(r?.domNode){const e=r.domNode.getBoundingClientRect();s.left=e.left,s.top=e.top,s.right=e.right,s.bottom=e.bottom}for(i.detach(n);t.firstChild;)t.removeChild(t.firstChild);return s}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}async prepare(){await document.fonts.load(this._fontString()).catch((()=>{}))}renderCanvas(e,t){const i=!!t?.disableDecorations;if(!this.items.some((e=>e.visible&&!(i&&e.isDecoration))))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach((e=>{i&&e.isDecoration||(r.save(),e.renderCanvas(r),r.restore())})),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};(0,i._)([(0,y.Cb)({readOnly:!0})],pe.prototype,"surface",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],pe.prototype,"items",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],pe.prototype,"needsRender",null),(0,i._)([(0,y.Cb)({readOnly:!0})],pe.prototype,"_watchUpdatingTracking",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],pe.prototype,"updating",null),pe=(0,i._)([(0,v.j)("esri.views.overlay.ViewOverlay")],pe);const fe=pe,me=[0,0];function ge(e){e&&(e.textContent="",e.parentNode&&e.parentNode.removeChild(e))}const ye=16,_e=750,ve=e=>{let t=class extends e{constructor(...e){super(...e),this._freqInfo={freq:ye,time:_e},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([(0,F.watch)((()=>this.cursor),(e=>{const{surface:t}=this;t&&t.setAttribute("data-cursor",e)})),(0,F.watch)((()=>this.navigating),(e=>{const{surface:t}=this;t&&t.setAttribute("data-navigating",e.toString())}))])}initialize(){this.addHandles([(0,F.watch)((()=>this.ui),((e,t)=>this._handleUIChange(e,t)),F.initial),this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui?.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(e){const t=this._get("container"),i=(0,le.L)(e);if(i||"string"!=typeof e||f.Z.getLogger(this).error("#container",`element with id '${e}' not found`),t===i)return;if(this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(ge(this.root),this._set("root",null)),this.userContent&&((0,le.Y)(this.userContent,t),ge(this.userContent),this._set("userContent",null))),!i)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);i.classList.add("esri-view");const r=document.createElement("div");r.className="esri-view-user-storage",(0,le.Y)(i,r),i.appendChild(r),this._set("userContent",r);const n=document.createElement("div");n.className="esri-view-root",i.insertBefore(n,i.firstChild),this._set("root",n);const s=document.createElement("div");s.className="esri-view-surface",s.setAttribute("role","application"),s.tabIndex=0,n.appendChild(s),this._set("surface",s);const o=new fe;n.appendChild(o.surface),this._set("overlay",o),this.addHandles((0,F.watch)((()=>o.needsRender),(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=(0,ue.A)({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=(0,m.hw)(this._overlayRenderTaskHandle)}))),this.forceDOMReadyCycle(),this._set("container",i),this._startMeasuring()}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(e,t,i){const r=this.position;return e-=r?r[0]:0,t-=r?r[1]:0,i?(i[0]=e,i[1]=t):i=[e,t],i}containerToPage(e,t,i){const r=this.position;return e+=r?r[0]:0,t+=r?r[1]:0,i?(i[0]=e,i[1]=t):i=[e,t],i}_handleUIChange(e,t){this.removeHandles("ui"),t&&t!==e&&t.destroy(),e&&(e.view=this,this.addHandles((0,F.watch)((()=>this.root),(t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null}),F.initial),"ui")),this._set("ui",e)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=ye,e.time=_e;const t=(0,ue.A)({prepare:e=>{const i=this._measure(),r=this._freqInfo;if(r.time+=e.deltaTime,i&&(r.freq=ye,this._get("resizing")||this._set("resizing",!0)),r.time<r.freq)return;r.time=0;const n=this._position();r.freq=n||i?ye:Math.min(_e,2*r.freq),!i&&r.freq>=512&&(t.pause(),this._get("resizing")&&this._set("resizing",!1))}}),i=new ResizeObserver((i=>{e.freq=ye,e.time=_e,t.resume()}));null!=this.container&&i.observe(this.container);const r=(0,N.kB)((()=>i.disconnect()));this.addHandles([(0,ce.on)(window,"resize",(()=>{e.freq=ye,e.time=_e,t.resume()})),r,t],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,i=e?e.clientHeight:0;if(0===t||0===i)return this.suspended||this._set("suspended",!0),!1;const r=this.width,n=this.height;return t===r&&i===n?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:r,oldHeight:n,width:t,height:i}),!0)}_position(){const e=this.container,t=this.position,i=e&&function(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return me[0]=i.left+(t?.pageXOffset??0),me[1]=i.top+(t?.pageYOffset??0),me}(e);return!(!i||t&&i[0]===t[0]&&i[1]===t[1]||(this._set("position",[i[0],i[1]]),0))}forceDOMReadyCycle(){}};return(0,i._)([(0,y.Cb)()],t.prototype,"container",null),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"focused",null),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"height",void 0),(0,i._)([(0,y.Cb)()],t.prototype,"messagesCommon",void 0),(0,i._)([(0,y.Cb)({type:fe})],t.prototype,"overlay",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"position",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"resizing",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"root",void 0),(0,i._)([(0,y.Cb)({value:null,readOnly:!0})],t.prototype,"size",null),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"surface",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"suspended",void 0),(0,i._)([(0,y.Cb)({nonNullable:!0})],t.prototype,"ui",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"userContent",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"width",void 0),(0,i._)([(0,y.Cb)()],t.prototype,"widthBreakpoint",void 0),t=(0,i._)([(0,v.j)("esri.views.DOMContainer")],t),t};var be=n(67979),we=n(97737);function xe(e){return null!=e&&"open"in e&&"declaredClass"in e}function Te(e){return null!=e&&"declaredClass"in e&&"dockOptions"in e}const Ce=e=>{let t=class extends e{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([(0,F.watch)((()=>[this.ui,this.popup]),(([e,t],i)=>{const r="popup";if(i){const[e,t]=i;e&&xe(t)&&(t.view=null,Te(t)&&e.remove(t,r))}e&&xe(t)&&(t.view=this,Te(t)&&e.add(t,{key:r,position:"manual",internal:!0}))}),F.initial),this.on("click",(e=>{this.popup&&this.popupEnabled&&("mouse"!==e.pointerType||0===e.button)&&(xe(this.popup)?this.popup.viewModel.handleViewClick(e):e.async((async()=>{await this.setupPopup(),xe(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(e)})))}),we.f.WIDGET)]),(0,F.whenOnce)((()=>this.ready&&this.popupEnabled&&!this.updating)).then((()=>{Promise.all([n.e(41984),n.e(63789),n.e(12926),n.e(96027),n.e(43675)]).then(n.bind(n,66119))}))}destroy(){this.destroyed||this.closePopup()}async openPopup(e){if(xe(this.popup))return this.popup.open(e);try{if(await this.setupPopup(),!this.popup)return void f.Z.getLogger(this).error(new c.Z("view:null-popup","Popup is null and can't be opened"));this.popup.open(e)}catch{}}closePopup(){this._popupSetupTask?.abort(),xe(this.popup)&&this.popup.close()}async fetchPopupFeatures(e,t){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(e,t),t)}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!xe(this.popup))return this._popupSetupTask=(0,be.vr)((async e=>{const{default:t}=await Promise.all([n.e(41984),n.e(63789),n.e(12926),n.e(96027),n.e(43675)]).then(n.bind(n,66119));if((0,g.k_)(e),!this.popup||xe(this.popup))return;const i=this.popup;delete i.open,delete i.close,this.popup=new t(i)})),this._popupSetupTask.promise}async _popupHitsToFeatures({location:e,hits:t},i){const r=[],n=[];let s=!1;const o=(0,g.CH)(i,(0,w.Z)("popup-view-fetch-timeout")??Ee),a=e=>{const t=n.at(-1);return t&&t.layerView===e&&!s?t:(e=>{const t=new Se(e);return n.push(t),r.push(t.promise),t})(e)};for(const e of t)"graphic"in e?(a(e.layerView).graphics.push(e.graphic),s=!1):(r.push(e.layerView.fetchPopupFeaturesAtLocation(e.mapPoint,o)),s=!0);n.map((e=>e.resolve(o)));const l=(0,g.OT)(r).then((e=>e.filter((e=>!!e)).flat()));return{pendingFeatures:r,allGraphicsPromise:l,location:e}}async _getPopupHits(e,t){const{hits:i,location:r}=await this.popupHitTest(e);(0,g.k_)(t);const n=[];for(const e of i)if("graphic"in e){if(this._isValidPopupGraphic(e.graphic,t)){const t=this._isValidPopupGraphicsLayerView(e.layerView)?e.layerView:void 0;n.push({graphic:e.graphic,layerView:t})}}else this._isValidPopupLocationLayerView(e.layerView)&&n.push({mapPoint:e.mapPoint,layerView:e.layerView});return{hits:n,location:r}}_isValidPopupGraphic(e,t){return e&&!!e.getEffectivePopupTemplate(t?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(e){return!e||(!("layer"in e)||!e.suspended)&&"fetchPopupFeaturesFromGraphics"in e}_isValidPopupLocationLayerView(e){return(!("layer"in e)||!e.suspended)&&"fetchPopupFeaturesAtLocation"in e}};return(0,i._)([(0,y.Cb)()],t.prototype,"popup",void 0),(0,i._)([(0,y.Cb)()],t.prototype,"popupEnabled",void 0),t=(0,i._)([(0,v.j)("esri.views.PopupView")],t),t};class Se{constructor(e){this.layerView=e,this._resolver=(0,g.hh)(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:t,graphics:i,_resolver:r}=this;if(!t)return r.resolve(i),r.promise;let n;return t.fetchPopupFeaturesFromGraphics(i,e).catch((e=>(n=e,null))).then((e=>{e?r.resolve(e):r.reject(n)})),r.promise}}const Ee=5e3;var Me=n(44584),Ae=n(64189),Re=n(4637),Oe=n(91772),Pe=n(64307),Ie=n(14685),Le=n(35925);let De=class extends Re.a{constructor(e){super(e),this.addHandles(this.on("before-add",(e=>{null!=e.item&&e.item.parent===this.owner&&(f.Z.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),e.preventDefault())})))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};De=(0,i._)([(0,v.j)("esri.support.AnalysesCollection")],De);var Ne=n(94449),Fe=n(97718),Ue=n(49684),ke=n(72559);let ze=class extends P.Z{constructor(e){super(e),this.view=null,this.baseLayerViews=new o.Z,this.referenceLayerViews=new o.Z,this._loadingHandle=(0,F.watch)((()=>this.view?.map?.basemap),(e=>{e&&e.load().catch((()=>{}))}),F.initial)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return this.view?.suspended??!0}get updating(){if(this.view?.suspended)return!1;const e=this.view?.map?.basemap;return!!e?.loaded&&(this.baseLayerViews.some((e=>e.updating))||this.referenceLayerViews.some((e=>e.updating)))}};(0,i._)([(0,y.Cb)({constructOnly:!0})],ze.prototype,"view",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],ze.prototype,"baseLayerViews",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],ze.prototype,"referenceLayerViews",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],ze.prototype,"suspended",null),(0,i._)([(0,y.Cb)({type:Boolean,readOnly:!0})],ze.prototype,"updating",null),ze=(0,i._)([(0,v.j)("esri.views.BasemapView")],ze);const Be=ze;var Ve=n(86114),He=n(51777),Ge=n(38481);function je(e){return null!=e&&"object"==typeof e&&"layerViews"in e}class Ze{constructor(e,t,i){this.layer=e,this.view=t,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=(0,g.hh)(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,(0,g.fu)(this._controller.signal,(()=>{const t=new c.Z("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)}))}tryRecycle(e){if(!this.done||!this.layerView||!function(e){return"tryRecycleWith"in e}(this.layerView))return null;const t=this.layer.type,i=this._controller.signal;for(let r=0;r<e.length;r++){const n=e[r];if(n.type!==t)continue;const s=this.layerView.tryRecycleWith(n,{signal:i});if(s){e.splice(r,1),this.layer=n;const t=this.layerView,i=t.view;return this.promise=Promise.race([s.then((()=>((0,g.k_)(this._controller.signal),n.emit("layerview-destroy",{view:i,layerView:t}),i.emit("layerview-destroy",{view:i,layerView:t}),n.emit("layerview-create",{view:i,layerView:t}),i.emit("layerview-create",{view:i,layerView:t}),t))),new Promise(((e,t)=>(0,g.fu)(this._controller.signal,(()=>t((0,g.zE)())))))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:t,view:i}=this;t.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:t,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:i}=this;this._map=i.map;try{let r,n;if(await t.load({signal:e}),t.prefetchResources&&await t.prefetchResources({signal:e}),function(e){return e.createLayerView!==Ge.Z.prototype.createLayerView}(t))r=await t.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new c.Z("layer:view-not-supported","No layerview implementation was found");const n=await this.layerViewImporter.importLayerView(t);(0,g.k_)(e),r="default"in n?new n.default({layer:t,view:i}):new n({layer:t,view:i})}const s=()=>{n=(0,m.hw)(n),r.destroyed||r.destroy(),r.layer=null,r.parent=null,r.view=null,this.done=!0};n=(0,g.fu)(e,s),(0,g.k_)(e);try{await r.when()}catch(e){throw s(),e}const o=this._map?.allLayers?.includes(t);if(!o)return s(),void this._deferred.reject(new c.Z("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=r,t.emit("layerview-create",{view:i,layerView:r}),i.emit("layerview-create",{layer:t,layerView:r}),this.done=!0,this._deferred.resolve(r)}catch(e){t.emit("layerview-create-error",{view:i,error:e}),i.emit("layerview-create-error",{layer:t,error:e}),this.done=!0,this._deferred.reject(new c.Z("layerview:create-error","layerview creation failed",{layer:t,error:e}))}}}let qe=class extends P.Z{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new he.R,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const e=this.view.map?.allLayers;if(e)for(const t of e)this.layerViewImporter.hasLayerViewModule(t)&&this.layerViewImporter.importLayerView(t)},this._reschedule=()=>this.destroyed?Promise.reject():(null==this._workPromise&&(this._workPromise=(0,g.hh)(),this._workPromise.promise.catch((()=>{}))),this.removeHandles("reschedule"),this.addHandles((0,ue.Os)(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const e=this.view.map;if(this._map!==e&&(this.clear(),this._map=e),null==this._workPromise)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const t=new Set,i=[],r=this.view.ready,n=e=>{if(null!=e)for(const s of e)if(s){t.add(s);const e=this._layerLayerViewInfoMap.get(s);e&&r?e.start():e||this._recyclingInfoMap.has(s)||i.push(s),"layers"in s&&s.layers&&n(s.layers)}};for(const e of this._rootCollectionNames)n((0,He.U2)(this,e));for(const[e,r]of this._layerLayerViewInfoMap)if(!t.has(e)){this._layerLayerViewInfoMap.delete(r.layer);const e=r.tryRecycle(i);e?(this.notifyChange("updating"),this._recyclingInfoMap.set(r.layer,r),e.then((()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(r.layer),this._layerLayerViewInfoMap.set(r.layer,r),this._reschedule()})).catch((()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(r.layer),r.destroy(),this._reschedule()}))):r.destroy()}for(const[e,i]of this._recyclingInfoMap)t.has(e)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(i.layer),i.destroy());for(const e of i)this._createLayerView(e);this._refreshCollections();const s=[e?.ground?.layers,e?.basemap?.baseLayers,e?.basemap?.referenceLayers,e?.layers].filter((e=>!!e));t.forEach((e=>"layers"in e&&s.push(e.layers))),this.addHandles(s.map((e=>this._watchUpdatingTracking.addOnCollectionChange((()=>e),this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([(0,F.on)((()=>this.view?.map?.allLayers),"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),(0,F.watch)((()=>{const e=this.view,t=e?.map;return[t?.basemap,t?.ground,t?.layers,e?.ready]}),(()=>this._reschedule()),F.syncAndInitial)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),(0,q.O)(this._recyclingInfoMap),(0,q.O)(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,null!=this._workPromise&&(this._workPromise.reject((0,g.zE)()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return null!=this._workPromise||this._watchUpdatingTracking.updating||(0,Ve.oE)(this._layerLayerViewInfoMap,(e=>!e.done))||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){this.destroyed||((0,q.O)(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new c.Z("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,t){this.commitProperty("updatingRemaining");const i=this._layerLayerViewInfoMap.get(e);if(!i?.done)return!0;const r=i.layerView;return!(!r||!t||r.parent===t)||!!(i.done&&r&&"layers"in e&&e.layers?.length)&&e.layers.some((e=>this.isCreatingLayerViewsForLayer(e,r)))}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners((0,He.U2)(this,e),(0,He.U2)(this,t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const n of e){const e=this._layerLayerViewInfoMap.get(n);if(!e?.layerView)continue;const s=e.layerView;s.layer=n,s.parent=i,t.at(r)!==s&&t.splice(r,0,s),"layers"in n&&je(s)&&this._populateLayerViewsOwners(n.layers,s.layerViews,s),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new Ze(e,this.view,this.layerViewImporter);t.promise.then((()=>this._refreshCollections()),(t=>{t&&((0,g.D_)(t)||"cancelled:layerview-create"===t.name)||f.Z.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};(0,i._)([(0,y.Cb)()],qe.prototype,"_workPromise",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],qe.prototype,"_watchUpdatingTracking",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],qe.prototype,"_layersToLayerViews",null),(0,i._)([(0,y.Cb)({readOnly:!0})],qe.prototype,"_rootCollectionNames",null),(0,i._)([(0,y.Cb)()],qe.prototype,"layerViewImporter",void 0),(0,i._)([(0,y.Cb)()],qe.prototype,"supportsGround",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],qe.prototype,"updating",null),(0,i._)([(0,y.Cb)({readOnly:!0})],qe.prototype,"updatingRemaining",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],qe.prototype,"view",void 0),qe=(0,i._)([(0,v.j)("esri.views.LayerViewManager")],qe);const We=qe;var $e=n(95550);let Ye=class extends P.Z{constructor(e){super(e),this.factor=1.5,this.offset=(0,$e.vW)(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};(0,i._)([(0,y.Cb)({type:Number})],Ye.prototype,"factor",void 0),(0,i._)([(0,y.Cb)({nonNullable:!0})],Ye.prototype,"offset",void 0),(0,i._)([(0,y.Cb)()],Ye.prototype,"position",void 0),(0,i._)([(0,y.Cb)({type:Number,range:{min:0}})],Ye.prototype,"size",void 0),(0,i._)([(0,y.Cb)()],Ye.prototype,"maskUrl",void 0),(0,i._)([(0,y.Cb)()],Ye.prototype,"maskEnabled",void 0),(0,i._)([(0,y.Cb)()],Ye.prototype,"overlayUrl",void 0),(0,i._)([(0,y.Cb)()],Ye.prototype,"overlayEnabled",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Ye.prototype,"version",null),(0,i._)([(0,y.Cb)({type:Boolean})],Ye.prototype,"visible",void 0),Ye=(0,i._)([(0,v.j)("esri.views.Magnifier")],Ye);const Je=Ye;var Xe=n(7753),Ke=n(20230),Qe=n(19784),et=n(14626);function tt(e){return!!(null!=e&&"object"==typeof e&&"createQuery"in e&&e.createQuery&&"on"in e&&e.on)}let it=class extends L.Z.EventedAccessor{constructor(e){super(e),this._selectionMap=new Ke.Z,this._sources=new o.Z,this._trashCan=[],this._layerEditHandles=new o.Z,this._vizTaskId=0,this.showHighlight=!0,this.highlightName="default"}initialize(){this.addHandles([(0,F.watch)((()=>[this.view,this.showHighlight]),(()=>this._refreshVisualization())),(0,F.on)((()=>this.sources),"change",(e=>{const t=this._selectionMap;for(const i of e.removed)t.delete(i);this._refreshListeners(),this._refreshVisualization()}),{onListenerAdd:()=>this._refreshListeners()})]);const e=new o.Z;this.view.when().then((()=>{this.view.map&&(this.view.map.allLayers.flatten((e=>"sublayers"in e&&e.sublayers?e.sublayers:null)).forEach((t=>{(tt(t)&&!(0,z.e9)(t)||(0,z.Hd)(t))&&e.add(t)})),this.sources=e)}))}destroy(){this._layerEditHandles.drain(m.hw)}get selections(){return Array.from(this._selectionMap.entries()).map((e=>{const[t,i]=e;return{layer:t,selection:[...i.selection]}}))}get count(){let e=0;for(const t of this._selectionMap.values())e+=t.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){(0,a.Z)(e,this._sources)}async getSelectedFeatures(e,t={},i="layerView"){const{view:r,selections:n}=this,s=(void 0!==e?n.filter((t=>e.includes(t.layer))):n).filter((e=>e.selection.length>0)).map((async e=>{const{layer:n,selection:s}=e,o=(0,z.Hd)(n)?n.parent:n;if(null==o||!nt(o))return null;if("layer"===i)return ot(o,s,t);if(rt(o))return null;const a=await r.whenLayerView(o).catch((()=>null));return a?ot(a,s,t):null}));return(await Promise.all(s)).filter((e=>null!=e))}updateSelection(e){const t=new Map;for(const[e,i]of this._selectionMap)t.set(e,[...i.selection]);let i=!1;const r=e.current.concat(e.added);for(const e of r){const r=e.sourceLayer,n=e.getObjectId();if(this.sources.includes(r)&&(tt(r)||(0,z.Hd)(r))&&null!==n){const e=(0,Ve.s1)(t,r,(()=>[]));e.includes(n)||(e.push(n),i=!0)}}for(const r of e.removed){const e=r.sourceLayer,n=r.getObjectId();if(this.sources.includes(e)&&(tt(e)||(0,z.Hd)(e))&&null!==n){const r=t.get(e),s=r?.indexOf(n);void 0!==s&&s>=0&&(r?.splice(s,1),i=!0)}}if(i){const{_selectionMap:e,_trashCan:i}=this,r=[];for(const[n,s]of t){const t=e.get(n);void 0!==t&&i.push(t),e.set(n,{selection:s}),r.push({layer:n,selection:s,...(0,Xe.e5)(void 0!==t?t.selection:[],s)})}this._onSelectionChange(r)}}setSelection(e,t){this._setSelection(e,t)}getSelection(e){return this._selectionMap.get(e)?.selection}appendToSelection(e,t){const i=this._selectionMap.get(e),r=void 0!==i?[...i.selection]:[];for(const e of t)r.includes(e)||r.push(e);this._setSelection(e,r)}removeFromSelection(e,t){const i=this._selectionMap.get(e);if(!i)return;const r=[];for(const e of i.selection)t.includes(e)||r.push(e);this._setSelection(e,r)}toggleInSelection(e,t){const i=this._selectionMap.get(e);if(!i||0===i.selection.length)return void this._setSelection(e,t);const r=new Set(i.selection),n=new Set(t),s=(0,Qe.Sp)(r,n);this._setSelection(e,Array.from(s))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const t=[];for(const[e,i]of this._selectionMap.entries())t.push({layer:e,added:[],removed:[...i.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(t)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){if(null==this.view||null==this.sources)return;for(this._vizTaskId++;this._trashCan.length>0;){this._trashCan.pop()?.highlightHandle?.remove()}const{sources:e,view:t,_selectionMap:i,showHighlight:r}=this,n=this._vizTaskId;for(const s of e){const e=i.get(s),o=(0,z.Hd)(s)?s.parent:s;if(null!=o&&nt(o)){if(rt(o))continue;t.whenLayerView(o).then((t=>{e?.highlightHandle?.remove(),null!=e&&r&&n===this._vizTaskId&&"highlight"in t&&"function"==typeof t.highlight&&e.selection.length>0&&(e.highlightHandle=t.highlight(e.selection,this.highlightName))})).catch((()=>{e?.highlightHandle?.remove()}))}}}_refreshListeners(){this._layerEditHandles.drain(m.hw);for(const e of this.sources){const t=(0,z.Hd)(e)?e.parent:e;if(null!=t&&tt(t)){const i=t.on("edits",(t=>{this._handleEditChanges(t,e)}));this._layerEditHandles.push(i)}}}_handleEditChanges(e,t){if(void 0!==e.deletedFeatures&&e.deletedFeatures.length>0&&this._selectionMap.has(t)){const i=e.deletedFeatures.filter((e=>null==e.error)).map((e=>e.objectId)).filter(Xe.pC);this.removeFromSelection(t,i)}}_setSelection(e,t){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const i=this._selectionMap.get(e);if(void 0===i||!st(i,{selection:t})){void 0!==i&&this._trashCan.push(i),this._selectionMap.set(e,{selection:[...t]});const r={layer:e,selection:[...t],...(0,Xe.e5)(void 0!==i?i.selection:[],t)};this._onSelectionChange([r])}}};(0,i._)([(0,y.Cb)({readOnly:!0,nonNullable:!0})],it.prototype,"selections",null),(0,i._)([(0,y.Cb)({readOnly:!0,nonNullable:!0})],it.prototype,"count",null),(0,i._)([(0,y.Cb)({constructOnly:!0,nonNullable:!0})],it.prototype,"view",void 0),(0,i._)([(0,y.Cb)({readOnly:!0,nonNullable:!0})],it.prototype,"hasSelection",null),(0,i._)([(0,y.Cb)()],it.prototype,"showHighlight",void 0),(0,i._)([(0,y.Cb)()],it.prototype,"sources",null),(0,i._)([(0,y.Cb)()],it.prototype,"highlightName",void 0),it=(0,i._)([(0,v.j)("esri.views.SelectionManager")],it);const rt=e=>(0,z.Hd)(e)?!0===e.parent?.isTable:e.isTable,nt=e=>void 0!==e?.when,st=(e,t)=>{if(null==e&&null==t)return!0;if(null!=e&&null==t||null==e&&null!=t)return!1;if(null!=e&&null!=t&&null!=e.selection&&null!=t.selection){const i=[...e.selection],r=[...t.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let e=0;e<i.length;e++)if(i[e]!==r[e])return!1}return!0},ot=async(e,t,i={})=>{let r;if((e=>void 0!==e.layer)(e)){const n=e;r=void 0===n?null:await n.queryFeatures(new et.Z({...i,objectIds:t})).then((t=>({data:t,layer:e.layer})))}else{const n=e;r=void 0===n?null:await n.queryFeatures(new et.Z({...i,objectIds:t})).then((e=>({data:e,layer:n})))}return r},at=it;var lt=n(41151);let ct=class extends(lt.Z.ClonableMixin(P.Z)){constructor(e){super(e),this.accentColor=new s.Z([255,127,0]),this.textColor=new s.Z([255,255,255])}};(0,i._)([(0,y.Cb)({type:s.Z,nonNullable:!0})],ct.prototype,"accentColor",void 0),(0,i._)([(0,y.Cb)({type:s.Z,nonNullable:!0})],ct.prototype,"textColor",void 0),ct=(0,i._)([(0,v.j)("esri.views.Theme")],ct);const ut=ct;var ht=n(18234),dt=n(3846),pt=n(91258);function ft(e){return[e.on("before-add",(t=>{const i=t.item;if(null==i||e.includes(i))return f.Z.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()})),e.on("after-remove",(e=>{const t=e.item;t.active&&(t.view.activeTool=null),t.destroy()}))]}function mt(e){return e.visible&&null!=e.getEditableFlag&&e.getEditableFlag(pt.bH.USER)&&e.getEditableFlag(pt.bH.MANAGER)}var gt=n(99118),yt=n(19431),_t=n(38114);class vt{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,t){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":xt(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:"start"===e.action?this._externallyDragging=!0:"end"===e.action&&(this._externallyDragging=!1),this._stopDrag&&(i(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!Tt(e))break;const r=(0,_t.vT)(e),n=wt(r,e.pointerType,t.forEachTool);if(null==n)break;const s=n.manipulator,o=n.tool;null==s||null==o||!s.interactive||s.grabbable&&s.grabbableForEvent(e)||!s.grabbing||s.dragging||this._releaseManipulatorBeforeDragging(s,e,t),null!=s&&null!=o&&s.interactive&&s.grabbable&&s.grabbableForEvent(e)&&!s.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:s,tool:o,start:r,pointerType:e.pointerType}),1===this._grabbedManipulators.size&&null==t.activeTool&&(this._revertToNullActiveTool=!0,t.setActiveTool(n.tool)),s.grabbing=!0,s.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:r}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!Tt(e))break;const r=this._grabbedManipulators.get(e.pointerId),n=r?.manipulator,s=r?.tool;if(null==n||null==s)break;const o=(0,_t.vT)(e);o.x=(0,yt.uZ)(o.x,0,t.view.width),o.y=(0,yt.uZ)(o.y,0,t.view.height);const a=r.start,l=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(n.dragging=!0,l?n.events.emit("drag",{action:"update",start:a,screenPoint:o}):n.events.emit("drag",{action:"start",start:a,screenPoint:o,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:s,manipulator:n,start:a}));break;case"end":n.dragging=!1,l&&n.events.emit("drag",{action:"end",start:a,screenPoint:o}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}i();break}case"immediate-click":{const r=(0,_t.vT)(e),n=wt(r,e.pointerType,t.forEachTool);if(function(e){return!!e.native.shiftKey}(e)||t.forEachTool((e=>{if((null==n||n.tool!==e||e.automaticManipulatorSelection)&&e.manipulators){let t=!1;e.manipulators.forEach((({manipulator:e})=>{e.selected&&(e.selected=!1,t=!0)})),t&&e.onManipulatorSelectionChanged&&e.onManipulatorSelectionChanged()}})),null==n)break;const{manipulator:s,tool:o}=n;if(!s.interactive)break;s.selectable&&o.automaticManipulatorSelection&&(s.selected=!s.selected,o.onManipulatorSelectionChanged&&o.onManipulatorSelectionChanged());const a=e.native.shiftKey;s.events.emit("immediate-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),Ct(s,i);break}case"click":{const r=(0,_t.vT)(e),n=wt(r,e.pointerType,t.forEachTool)?.manipulator;if(null==n||!n.interactive)break;const s=e.native.shiftKey;n.events.emit(e.type,{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:s}),i();break}case"double-click":{const r=(0,_t.vT)(e),n=wt(r,e.pointerType,t.forEachTool),s=null!=n?n.manipulator:null;if(null==s||!s.interactive)break;const o=e.native.shiftKey;s.events.emit("double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i}),Ct(s,i);break}case"immediate-double-click":{const r=(0,_t.vT)(e),n=wt(r,e.pointerType,t.forEachTool),s=null!=n?n.manipulator:null;if(null==s||!s.interactive)break;const o=e.native.shiftKey;s.events.emit("immediate-double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i}),"mouse"===e.pointerType&&Ct(s,i);break}}this._onFocusChange(t.forEachTool)}_releaseManipulatorBeforeDragging(e,t,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:(0,_t.vT)(t)}),this._grabbedManipulators.forEach((({manipulator:t},i)=>{t===e&&this._grabbedManipulators.delete(i)})),this._afterManipulatorRelease(i.setActiveTool)}_handlePointerEnd(e,t){const i=this._grabbedManipulators.get(e.pointerId)?.manipulator;null!=i&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:(0,_t.vT)(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(t.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=bt(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=bt(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const t=new Set,i=new Set;this._grabbedManipulators.forEach((({tool:e})=>{t.add(e)})),this._hoveredManipulators.forEach((({tool:e})=>{i.add(e)})),e((e=>{e.hasGrabbedManipulators=t.has(e),e.hasHoveredManipulators=i.has(e);const r=this._grabbedManipulators.values(),n=(0,gt.sE)(r,(({tool:t})=>t===e));e.firstGrabbedManipulator=null!=n?n.manipulator:null}))}clearPointers(e,{forEachTool:t,setActiveTool:i},r=!0,n){const s=(t,i)=>t===e&&(null==n||n===i);this._grabbedManipulators.forEach((({tool:e,manipulator:t,pointerType:i},r)=>{s(e,t)&&(this._grabbedManipulators.delete(r),t.grabbing=!1,t.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:i}))})),this._draggedManipulators.forEach((({tool:e,manipulator:t},i)=>{s(e,t)&&(this._draggedManipulators.delete(i),t.dragging=!1,t.events.emit("drag",{action:"cancel"}))})),r&&this._hoveredManipulators.forEach((({tool:e,manipulator:t},i)=>{s(e,t)&&(this._hoveredManipulators.delete(i),t.hovering=!1)})),this._afterManipulatorRelease(i),this._onFocusChange(t)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach(((t,i)=>{this._updateHoveredStateForPointerAtScreenPosition((0,$e.vW)(t.x,t.y),i,t.pointerType,e)}))}handleHoverEvent(e,t){const i=e.type;"pointer-up"!==i&&"immediate-click"!==i&&"pointer-move"!==i||!xt(e.pointerType)||("pointer-up"!==i&&this._externallyDragging?this._clearHoveredManipulatorStates(e.pointerId):this._updateHoveredStateForPointerAtScreenPosition((0,_t.vT)(e),e.pointerId,e.pointerType,t))}_updateHoveredStateForPointerAtScreenPosition(e,t,i,r){let n=wt(e,i,r);const s=this._hoveredManipulators.get(t)?.manipulator;null==n||n.manipulator.interactive||(n=null),null!=n&&s===n.manipulator||(null!=s&&(s.hovering=!1),null!=n?(n.manipulator.hovering=!0,this._hoveredManipulators.set(t,n)):this._hoveredManipulators.delete(t),this._onFocusChange(r))}_afterManipulatorRelease(e){0===this._grabbedManipulators.size&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(e){this._hoveredManipulators.forEach((({manipulator:t},i)=>{e===i&&(this._hoveredManipulators.delete(e),t.hovering=!1)}))}}function bt(e){for(const{manipulator:t}of e.values())if(null!=t&&t.interactive){if(t.grabbing&&t.grabCursor)return t.grabCursor;if(t.cursor)return t.cursor}return null}function wt(e,t,i){let r=null;return i((i=>{if(null==i.manipulators||!mt(i))return!1;const n=i.manipulators.intersect(e,t);return null!=n&&(r={tool:i,manipulator:n},!0)})),r}function xt(e){return"mouse"===e}function Tt(e){return"mouse"!==e.pointerType||0===e.button}function Ct(e,t){e?.consumesClicks&&t()}const St="attached",Et="tools";let Mt=class extends P.Z{constructor(e){super(e),this._updatingHandles=new he.R,this._clock=ht.m,this._manipulatorState=new vt,this.tools=new o.Z,this.cursor=null,this._interacting=!1,this._interactingTimeout=1e3,this._interactingTimeoutHandle=null,this._forEachTool=e=>{for(const t of this.tools.items)if(e(t))return}}initialize(){this.addHandles([this.view.on(dt.uS,(e=>{this._handleInputEvent(e)}),we.f.TOOL),...ft(this.tools),this.tools.on("before-add",(({item:e})=>{this._updateToolEditableFlag(e)})),this.tools.on("before-remove",(({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this.activeTool=null,this.tools.drain((e=>e.destroy())),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(null!=e&&!this.view.ready)return void f.Z.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),null!=t&&t.deactivate(),null!=e&&e.activate(),this._removeIncompleteTools(e);for(const e of this.tools){this._updateToolEditableFlag(e);const t=mt(e);null!=this.activeTool&&t||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!t)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some((e=>e.updating))}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=(0,m.hw)(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout((()=>this._interacting=!1),this._interactingTimeout)}attach(){"3d"===this.view.type?this.addHandles([(0,F.watch)((()=>{const{state:e}=this.view;return"camera"in e&&e.camera}),(()=>this._forEachManipulator((e=>e.onViewChange())))),this.view.elevationProvider?.on("elevation-change",(e=>this._forEachManipulator((t=>t.onElevationChange(e)))))],St):this.addHandles((0,F.watch)((()=>this.view.extent),(()=>this._forEachManipulator((e=>e.onViewChange())))))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(St),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool((t=>{t.manipulators&&t.manipulators.forEach((({manipulator:i})=>e(i,t)))}))}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};null!=this.activeTool?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((e=>{!t&&e.visible&&e.handleInputEvent(i)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),t||null==this.activeTool||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),"pointer-move"===e.type&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(Et),this._forEachTool((e=>{if(e instanceof P.Z){const t=(0,F.watch)((()=>[e.cursor,e.visible,e.editable]),(()=>{mt(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}));this.addHandles(t,Et)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",(t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)})),e.manipulators.on("change",(()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}))],Et)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(pt.bH.MANAGER,null==this.activeTool||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;null==e&&this._forEachTool((t=>!(null==t.cursor||!t.visible||(e=t.cursor,0)))),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter((t=>(null==e||t!==e)&&!t.created&&t.removeIncompleteOnCancel)).forEach((e=>{this.tools.remove(e)}))}get test(){}};(0,i._)([(0,y.Cb)({constructOnly:!0,nonNullable:!0})],Mt.prototype,"view",void 0),(0,i._)([(0,y.Cb)({value:null})],Mt.prototype,"activeTool",null),(0,i._)([(0,y.Cb)({readOnly:!0,type:o.Z})],Mt.prototype,"tools",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Mt.prototype,"cursor",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Mt.prototype,"updating",null),(0,i._)([(0,y.Cb)()],Mt.prototype,"_interacting",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Mt.prototype,"interacting",null),Mt=(0,i._)([(0,v.j)("esri.views.ToolViewManager")],Mt);var At=n(67235),Rt=n(57761);let Ot=class extends P.Z{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown","standard"===e.mapping?this._detectedDeviceType="standard":It.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return null!=this.nativeIndex&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Lt[this.deviceType]}};(0,i._)([(0,y.Cb)({nonNullable:!0,readOnly:!0})],Ot.prototype,"nativeIndex",void 0),(0,i._)([(0,y.Cb)({type:String,readOnly:!0})],Ot.prototype,"deviceType",null),(0,i._)([(0,y.Cb)({type:Number,readOnly:!0})],Ot.prototype,"axisThreshold",null),Ot=(0,i._)([(0,v.j)("esri.views.input.gamepad.GamepadInputDevice")],Ot);const Pt=Ot,It=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Lt={standard:.15,spacemouse:.025,unknown:0};let Dt=class extends P.Z{constructor(...e){super(...e),this.devices=new o.Z,this.enabledFocusMode="document"}};(0,i._)([(0,y.Cb)({type:o.Z.ofType(Pt),readOnly:!0})],Dt.prototype,"devices",void 0),(0,i._)([(0,y.Cb)({type:["document","view","none"]})],Dt.prototype,"enabledFocusMode",void 0),Dt=(0,i._)([(0,v.j)("esri.views.input.gamepad.GamepadSettings")],Dt);const Nt=Dt;let Ft=class extends P.Z{constructor(){super(...arguments),this.gamepad=new Nt}};(0,i._)([(0,y.Cb)({readOnly:!0})],Ft.prototype,"gamepad",void 0),Ft=(0,i._)([(0,v.j)("esri.views.input.Input")],Ft);const Ut=Ft;var kt=n(759),zt=n(59801);const Bt=()=>(0,y.Cb)({type:["pan","rotate","zoom","none"],nonNullable:!0});let Vt=class extends P.Z{constructor(e){super(e),this.dragPrimary="pan",this.dragSecondary="rotate",this.dragTertiary="zoom",this.mouseWheel="zoom"}};(0,i._)([Bt()],Vt.prototype,"dragPrimary",void 0),(0,i._)([Bt()],Vt.prototype,"dragSecondary",void 0),(0,i._)([Bt()],Vt.prototype,"dragTertiary",void 0),(0,i._)([(0,y.Cb)({type:["zoom","none"],nonNullable:!0})],Vt.prototype,"mouseWheel",void 0),Vt=(0,i._)([(0,v.j)("esri.views.navigation.NavigationActionMap")],Vt);const Ht=Vt;let Gt=class extends P.Z{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};(0,i._)([(0,y.Cb)({type:Boolean,nonNullable:!0})],Gt.prototype,"enabled",void 0),(0,i._)([(0,y.Cb)({type:Pt})],Gt.prototype,"device",void 0),(0,i._)([(0,y.Cb)({type:["pan","zoom"],nonNullable:!0})],Gt.prototype,"mode",void 0),(0,i._)([(0,y.Cb)({type:["forward-down","forward-up"],nonNullable:!0})],Gt.prototype,"tiltDirection",void 0),(0,i._)([(0,y.Cb)({type:Number,nonNullable:!0})],Gt.prototype,"velocityFactor",void 0),Gt=(0,i._)([(0,v.j)("esri.views.navigation.gamepad.GamepadSettings")],Gt);const jt=Gt;let Zt=class extends P.Z{constructor(e){super(e),this.actionMap=new Ht,this.browserTouchPanEnabled=!0,this.gamepad=new jt,this.momentumEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!(0,kt.n)()}get mouseWheelZoomEnabled(){return"zoom"===this.actionMap.mouseWheel}set mouseWheelZoomEnabled(e){(0,zt.Mr)(f.Z.getLogger(this),"mouseWheelZoomEnabled",{replacement:"actionMap.mouseWheel",version:"4.32",warnOnce:!0}),this.actionMap.mouseWheel=e?"zoom":"none"}};(0,i._)([(0,y.Cb)({type:Ht,nonNullable:!0})],Zt.prototype,"actionMap",void 0),(0,i._)([(0,y.Cb)({type:Boolean})],Zt.prototype,"browserTouchPanEnabled",void 0),(0,i._)([(0,y.Cb)({type:jt,nonNullable:!0})],Zt.prototype,"gamepad",void 0),(0,i._)([(0,y.Cb)({type:Boolean})],Zt.prototype,"momentumEnabled",void 0),(0,i._)([(0,y.Cb)({type:Boolean})],Zt.prototype,"mouseWheelZoomEnabled",null),Zt=(0,i._)([(0,v.j)("esri.views.navigation.Navigation")],Zt);const qt=Zt;var Wt=n(64862),$t=n(65684);let Yt,Jt=null;async function Xt(e){Jt||(Jt=n.e(8060).then(n.bind(n,8060)).then((e=>Yt=e))),await Jt,(0,g.k_)(e)}async function Kt(e,t,i,r){if(!e)return null;const n=e.spatialReference;return(0,te.isLoaded)()||(0,te.canProjectWithoutEngine)(n,t)?(0,te.project)(e,t):Yt?Yt.projectGeometry(e,t,i,r):(await Promise.race([Xt(r),(0,te.load)(r)]),Kt(e,t,i,r))}let Qt=class extends P.Z{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=(0,m.IM)(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return null==this.userSpatialReference||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),t=[];return null!=this.priorityCollection&&t.push(this.priorityCollection),t.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),t}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,(t=>{const i=this._getSupportedSpatialReferences(t);if(i.length>0){const t=this._narrowDownSpatialReferenceCandidates(e,i);null!=t&&(e=t)}return 1===e?.length}))&&1!==e?.length)return{updating:!0};const t=this._pickSpatialReferenceCandidate(e);return{spatialReference:t?.spatialReference??null,viewingMode:t?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};const e=this.map?.(),t=this.spatialReference;if(!t)return{updating:this._spatialReferenceTask.updating};let i;const r=this._collectLayers([{parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers}],(e=>!(!("tileInfo"in e)||!e.tileInfo?.spatialReference.equals(t)||(i=e,0))),(e=>"tileInfo"in e));return i?{tileInfo:i.tileInfo,updating:!1}:{updating:r}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};let e={};const t=this._collectLayers(this.mapCollections,(t=>{const i=(0,Wt.Ku)(t);return!!i&&(e={heightModelInfo:i,vcsWkid:t.spatialReference?.vcsWkid,latestVcsWkid:t.spatialReference?.latestVcsWkid},!0)}),(e=>(0,Wt.qC)(e)));return{...e,updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=[],t=this._collectLayers(this.mapCollections,(t=>{const i="fullExtents"in t&&t.fullExtents||(null!=t.fullExtent?[t.fullExtent]:[]),r=this.requiresExtentInSpatialReference?null:i[0],n=i.find((e=>e.spatialReference.equals(this.spatialReference)))??r;if(n)return e.push({extent:n,layer:t}),!0;if(this._getSupportedSpatialReferences(t).length>0)for(const r of i)e.push({extent:r,layer:t});return!1}));return{candidates:e,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(null==e||0===e.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:null!=this._projectExtentTask.task&&!this._projectExtentTask.task.finished}:(null!=this._projectExtentTask.task&&(this._projectExtentTask.task=(0,m.IM)(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:(0,be.vr)((async e=>{try{const t=await Kt(i.extent,r,"portalItem"in i.layer?i.layer.portalItem:void 0,e);this._projectExtentTask={...this._projectExtentTask,task:null,output:t}}catch(t){if((0,g.Hc)(e))return;this._projectExtentTask={...this._projectExtentTask,task:null}}}))},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(null==e)return t;const i=new Array;for(const r of e)for(const e of t){if(!r.spatialReference.equals(e.spatialReference))continue;const t=ti(r.viewingMode,e.viewingMode);if(!1!==t){i.push({spatialReference:r.spatialReference,viewingMode:t});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return null==e||e.length<1?t?{spatialReference:t,viewingMode:null}:null:(null!=t&&e.length>1&&e.some((({spatialReference:e})=>e.equals(t)))&&(e=e.filter((({spatialReference:e})=>e.equals(t)))),e.length>1&&e.some((({viewingMode:e})=>e!==$t.JY.Local))&&(e=e.filter((({viewingMode:e})=>e!==$t.JY.Local))),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return[];const i=[];for(const r of t){const t=this.getSpatialReferenceSupport(r,e);if(null!=t){const e=t.constraints??[{spatialReference:r,viewingMode:null}];for(const{spatialReference:t,viewingMode:r}of e)this.requiresExtentInSpatialReference&&null!=this.userSpatialReference&&!t.equals(this.userSpatialReference)||i.push({spatialReference:t,viewingMode:r})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find((({extent:e})=>t.equals(e.spatialReference)))||e[0]}_collectLayers(e,t,i=(()=>!0)){switch(this._loadMaybe(this.map?.())){case"loading":return!0;case"failed":return!1}const r=new ei(i,t);for(const t of e)if(this._collectCollection(t,r),r.done||r.preloading===this.sourcePreloadCount)break;return r.updating}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers)if(t.layerFilter(i)){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":if(t.updating||(t.done=t.pushLayer(i)),t.done||t.preloading===this.sourcePreloadCount)break;"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.done||t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&null!=e.loadStatus?"not-loaded"===e.loadStatus?(e.load().catch((e=>{(0,g.D_)(e)})),"loading"):e.loadStatus:"loaded"}};(0,i._)([(0,y.Cb)()],Qt.prototype,"required",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Qt.prototype,"map",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Qt.prototype,"getSpatialReferenceSupport",void 0),(0,i._)([(0,y.Cb)()],Qt.prototype,"defaultSpatialReference",void 0),(0,i._)([(0,y.Cb)()],Qt.prototype,"userSpatialReference",void 0),(0,i._)([(0,y.Cb)()],Qt.prototype,"sourcePreloadCount",void 0),(0,i._)([(0,y.Cb)()],Qt.prototype,"priorityCollection",void 0),(0,i._)([(0,y.Cb)()],Qt.prototype,"requiresExtentInSpatialReference",void 0),(0,i._)([(0,y.Cb)()],Qt.prototype,"suspended",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"ready",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"heightModelInfoReady",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"spatialReference",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"extent",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"heightModelInfo",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"vcsWkid",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"latestVcsWkid",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"viewingMode",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"tileInfo",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"mapCollections",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"_spatialReferenceTask",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"_tileInfoTask",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"_heightModelInfoTask",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Qt.prototype,"_extentCandidatesTask",null),(0,i._)([(0,y.Cb)()],Qt.prototype,"_extentTask",null),(0,i._)([(0,y.Cb)()],Qt.prototype,"_projectExtentTask",void 0),Qt=(0,i._)([(0,v.j)("esri.views.support.DefaultsFromMap")],Qt);class ei{constructor(e,t){this.layerFilter=e,this.pushLayer=t,this.preloading=-1,this.updating=!1,this.done=!1}}function ti(e,t){return null!=e?null!=t?e===t&&e:e:t}let ii=class extends P.Z{constructor(e){super(e),this.featureTitleFields=!1,this.utilityNetworkFields=!1,this.globalIdField=!1}};(0,i._)([(0,y.Cb)()],ii.prototype,"featureTitleFields",void 0),(0,i._)([(0,y.Cb)()],ii.prototype,"utilityNetworkFields",void 0),(0,i._)([(0,y.Cb)()],ii.prototype,"globalIdField",void 0),ii=(0,i._)([(0,v.j)("esri.views.support.RequiredFieldsOptions")],ii);const ri=ii;var ni;let si=ni=class extends(L.Z.EventedMixin(Ae.Z.EsriPromiseMixin(P.Z))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.handles=new Me.Z,this.updatingHandles=new he.R,this.allLayerViews=new I.Z({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:li}),this.groundView=null,this.basemapView=null,this.displayFilterEnabled=!0,this.fatalError=null,this.graphics=new Ne.J,this.analyses=new De,this.typeSpecificPreconditionsReady=!0,this.layerViews=new o.Z,this.magnifier=new Je,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this._readyStateWaitingTask=null,this.supportsGround=!0,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Ut,this.navigation=new qt,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new dt.CE(this),this.persistableViewModels=new o.Z,this.requiredFieldsOptions=new ri,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add((0,F.watch)((()=>this.preconditionsReady),(e=>{const t=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,ni.views.add(this)):(this._lockedSpatialReference=null,ni.views.remove(this)),this.notifyChange("spatialReference"),!e&&t)this.toolViewManager?.detach(),null!=this.analysisViewManager&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown();else if(e&&!t){try{this._startup()}catch(e){return void queueMicrotask((()=>{this.fatalError=new c.Z("startup-error",null,e)}))}null!=this.analysisViewManager&&this.analysisViewManager.attach(),this.toolViewManager.attach()}}),F.sync))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then((()=>(this._isValid=!0,(0,F.whenOnce)((()=>this.ready)))))),this.basemapView=new Be({view:this}),this.layerViewManager=new We({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Mt({view:this}),this.selectionManager=new at({view:this}),this.addHandles([(0,F.when)((()=>"map-content-error"===this.readyState&&!this.spatialReference),(()=>{f.Z.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})),(0,F.watch)((()=>this.initialExtentRequired),(e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e}),F.syncAndInitial),(0,F.watch)((()=>this.ready),(e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)}),F.sync),(0,F.watch)((()=>this._userSpatialReference),(e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)}),F.syncAndInitial)])}destroy(){this.destroyed||(ni.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=(0,m.SC)(this.graphics),this.analyses=(0,m.SC)(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),(0,m.SC)(this.analysisViewManager),this.toolViewManager=(0,m.SC)(this.toolViewManager),this.layerViewManager=(0,m.SC)(this.layerViewManager),this.selectionManager=(0,m.SC)(this.selectionManager),this.basemapView=(0,m.SC)(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach((e=>e.destroy())),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=(0,m.SC)(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return f.Z.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Qt({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(e,t)=>this.getSpatialReferenceSupport(e,t),...this.defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get highlights(){return this._get("highlights")??new(o.Z.ofType(Rt.Z))([new Rt.Z({name:At.b}),new Rt.Z({name:At.x,color:At.hG})])}set highlights(e){this._set("highlights",(0,a.Z)(e,this._get("highlights"),o.Z.ofType(Rt.Z)))}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||d.Z.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e?.destroyed&&(f.Z.getLogger(this).warn("#map","The provided map is already destroyed",{map:e}),e=null),d.Z.isLoadable(e)&&e.load().catch((()=>{})),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",e))}get readyState(){if(this.destroyed)return this._get("readyState");if(!this.map)return"missing-map";if("container"in this&&!this.container)return"missing-container";if(this.fatalError)return"rendering-error";if(this.defaultsFromMap?.ready&&!this.spatialReference){const e=!("loaded"in this.map)||this.map.loaded,t=this.map.ground.loaded,i=this.map.basemap?.loaded??!0;return e&&i&&t&&!this.map?.allLayers.length?"empty-map":(this._readyStateWaitingTask||(this._readyStateWaitingTask=(0,be.vr)((e=>(0,g.e4)((0,w.Z)("view-readyState-waiting-delay"),null,e))),this.addHandles(this._readyStateWaitingTask),this.addHandles(this._readyStateWaitingTask,"ready-state-task")),this._readyStateWaitingTask?.finished?"map-content-error":"loading")}return this._readyStateWaitingTask=(0,m.IM)(this._readyStateWaitingTask),this.removeHandles("ready-state-task"),this.ready?"ready":"loading"}get spatialReference(){const e=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(e&&this.defaultsFromMap?.required?.heightModelInfo){const t=e.clone();return t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,t}return e}set spatialReference(e){const t=!(0,Le.fS)(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(e){this._userTimeExtent=e}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Fe.By}set timeZone(e){this._userTimeZone=e,(0,ke.Do)(e)||f.Z.getLogger(this).warn("#timeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new ut}whenLayerView(e){return this.layerViewManager?.whenLayerView(e)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}importLayerView(e){throw new c.Z("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return null!=this.getSpatialReferenceSupport(e)}when(e,t){return this.isResolved()&&!this.ready&&f.Z.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&((0,F.when)((()=>this.destroyed||!1===this.preconditionsReady),(()=>this._readyCycleForced=!1),{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};si.views=new o.Z,(0,i._)([(0,y.Cb)()],si.prototype,"_userSpatialReference",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"activeTool",null),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"allLayerViews",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"groundView",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"animation",null),(0,i._)([(0,y.Cb)()],si.prototype,"basemapView",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"center",null),(0,i._)([(0,y.Cb)()],si.prototype,"defaultsFromMapSettings",null),(0,i._)([(0,y.Cb)()],si.prototype,"defaultsFromMap",null),(0,i._)([(0,y.Cb)()],si.prototype,"displayFilterEnabled",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"fatalError",void 0),(0,i._)([(0,y.Cb)({type:Oe.Z})],si.prototype,"extent",null),(0,i._)([(0,y.Cb)((0,Re.z)(Ne.J,"graphics"))],si.prototype,"graphics",void 0),(0,i._)([(0,y.Cb)((0,Re.z)(De,"analyses"))],si.prototype,"analyses",void 0),(0,i._)([(0,y.Cb)({readOnly:!0,type:Pe.Z})],si.prototype,"heightModelInfo",null),(0,i._)([(0,y.Cb)({type:o.Z.ofType(Rt.Z)})],si.prototype,"highlights",null),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"interacting",null),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"navigating",null),(0,i._)([(0,y.Cb)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],si.prototype,"preconditionsReady",null),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"typeSpecificPreconditionsReady",void 0),(0,i._)([(0,y.Cb)({type:o.Z,readOnly:!0})],si.prototype,"layerViews",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"resolution",null),(0,i._)([(0,y.Cb)({type:Je})],si.prototype,"magnifier",void 0),(0,i._)([(0,y.Cb)({value:null,type:X})],si.prototype,"map",null),(0,i._)([(0,y.Cb)()],si.prototype,"padding",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"ready",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"_readyStateWaitingTask",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"readyState",null),(0,i._)([(0,y.Cb)({type:Ie.Z})],si.prototype,"spatialReference",null),(0,i._)([(0,y.Cb)()],si.prototype,"stationary",null),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"supportsGround",void 0),(0,i._)([(0,y.Cb)({type:Ue.Z})],si.prototype,"timeExtent",null),(0,i._)([(0,y.Cb)({type:String,nonNullable:!0})],si.prototype,"timeZone",null),(0,i._)([(0,y.Cb)()],si.prototype,"tools",null),(0,i._)([(0,y.Cb)()],si.prototype,"toolViewManager",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"type",void 0),(0,i._)([(0,y.Cb)({type:Number})],si.prototype,"scale",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"updating",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"initialExtentRequired",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"initialExtent",null),(0,i._)([(0,y.Cb)()],si.prototype,"cursor",null),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"input",void 0),(0,i._)([(0,y.Cb)({type:qt,nonNullable:!0})],si.prototype,"navigation",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"layerViewManager",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"analysisViewManager",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"selectionManager",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"width",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"height",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"resizing",void 0),(0,i._)([(0,y.Cb)({value:null,readOnly:!0})],si.prototype,"size",null),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"suspended",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"viewEvents",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],si.prototype,"persistableViewModels",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"_isValid",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"_readyCycleForced",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"_lockedSpatialReference",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"_userTimeZone",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"_lockedTimeZone",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"_userTimeExtent",void 0),(0,i._)([(0,y.Cb)()],si.prototype,"_lockedTimeExtent",void 0),(0,i._)([(0,y.Cb)({type:ut})],si.prototype,"theme",void 0),(0,i._)([(0,y.Cb)({readOnly:!0,type:ut})],si.prototype,"effectiveTheme",null),si=ni=(0,i._)([(0,v.j)("esri.views.View")],si);const oi=globalThis.$arcgis;oi&&!oi.views&&Object.defineProperty(oi,"views",{configurable:!1,enumerable:!0,writable:!1,value:si.views});const ai=si;function li(e){return e.layerViews}var ci=n(36531),ui=n(84164),hi=n(69050),di=n(40201),pi=n(76231),fi=n(43056),mi=n(71508),gi=n(46332),yi=n(38642),_i=n(45867);function vi(e){return function(e){return e instanceof Float32Array&&e.length>=2}(e)||function(e){return Array.isArray(e)&&e.length>=2}(e)}var bi,wi=n(10186),xi=n(29927);const Ti=[0,0];let Ci=bi=class extends u.Z{constructor(e){super(e),this._viewpoint2D={center:(0,ui.Ue)(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Oe.Z,this.id=0,this.inverseTransform=(0,mi.Ue)(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=(0,mi.Ue)(),this.transformNoRotation=(0,mi.Ue)(),this.displayMat3=(0,yi.Ue)(),this.displayViewMat3=(0,yi.Ue)(),this.viewMat3=(0,yi.Ue)(),this.viewMat2d=(0,fi.Ue)(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}get visibleArea(){const[e,t]=this.size;return[this.toMap([0,0],0,0),this.toMap([0,0],0,t),this.toMap([0,0],e,t),this.toMap([0,0],e,0)]}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=(0,hi.JG)(i,e.viewpoint),this._set("size",(0,ci.JG)(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new bi({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return vi(t)?(0,ci.iu)(e,t,this.inverseTransform):(Ti[0]=t,Ti[1]=i,(0,ci.iu)(e,Ti,this.inverseTransform))}toScreen(e,t,i){return vi(t)?(0,ci.iu)(e,t,this.transform):(Ti[0]=t,Ti[1]=i,(0,ci.iu)(e,Ti,this.transform))}toScreenNoRotation(e,t,i){return vi(t)?(0,ci.iu)(e,t,this.transformNoRotation):(Ti[0]=t,Ti[1]=i,(0,ci.iu)(e,Ti,this.transformNoRotation))}wrapMapCoordinate(e,t){(0,ci.JG)(e,t);const[i]=t,[r]=this.center,{extent:n,spatialReference:s}=this;let{xmin:o,xmax:a}=n;if(s.isWrappable){const e=(0,hi.ut)(s)/2;o=Math.max(o,r-e),a=Math.min(a,r+e)}return(i<o||i>a)&&(e[0]=(0,xi.it)(i,r,s)),e}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,n=this._get("size");return(0,hi.Rb)(e,i,n,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new K.Z({targetGeometry:new wi.Z(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!s||!t||!i)return;this.resolution=(0,hi.uG)(o),this.rotation=r,this.scale=i,this.spatialReference=t,(0,ci.JG)(this.center,e);const a=0!==s[0]?2/s[0]:0,l=0!==s[1]?-2/s[1]:0;(0,gi.t8)(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=(0,gi.yR)(this.viewMat3),u=(0,_i.al)(s[0]/2,s[1]/2),h=(0,_i.al)(-s[0]/2,-s[1]/2),d=(0,di.c$)(r);(0,gi.Iu)(c,c,u),(0,gi.U1)(c,c,d),(0,gi.Iu)(c,c,h),(0,gi.Jp)(this.displayViewMat3,this.displayMat3,c);const p=(0,pi.vc)(this.viewMat2d,u);return(0,pi.U1)(p,p,d),(0,pi.Iu)(p,p,h),(0,hi.bk)(this.extent,o,s),(0,hi.Ck)(this.transform,o,s,n),(0,pi.U_)(this.inverseTransform,this.transform),(0,hi.Jp)(this.transformNoRotation,o,s,n),this.worldScreenWidth=(0,hi.L2)(this.spatialReference,this.resolution),this._set("id",this.id+1),this.notifyChange("visibleArea"),this}};(0,i._)([(0,y.Cb)({readOnly:!0})],Ci.prototype,"id",void 0),(0,i._)([(0,y.Cb)({value:1,json:{write:!0}})],Ci.prototype,"pixelRatio",null),(0,i._)([(0,y.Cb)({json:{write:!0}})],Ci.prototype,"size",null),(0,i._)([(0,y.Cb)()],Ci.prototype,"spatialReference",void 0),(0,i._)([(0,y.Cb)({type:K.Z,json:{write:!0}})],Ci.prototype,"viewpoint",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Ci.prototype,"visibleArea",null),Ci=bi=(0,i._)([(0,v.j)("esri.views.2d.ViewState")],Ci);const Si=Ci;var Ei,Mi;let Ai=Ei=class extends P.Z{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new Ei({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};(0,i._)([(0,y.Cb)()],Ai.prototype,"left",void 0),(0,i._)([(0,y.Cb)()],Ai.prototype,"top",void 0),(0,i._)([(0,y.Cb)()],Ai.prototype,"right",void 0),(0,i._)([(0,y.Cb)()],Ai.prototype,"bottom",void 0),Ai=Ei=(0,i._)([(0,v.j)("esri.views.2d.PaddedViewState.Padding")],Ai);let Ri=Mi=class extends Si{constructor(...e){super(...e),this.paddedViewState=new Si,this._updateContent=(()=>{const e=(0,ui.Ue)();return()=>{const t=this._get("size"),i=this._get("padding");if(!t||!i)return;const r=this.paddedViewState;(0,ci.t8)(e,i.left+i.right,i.top+i.bottom),(0,ci.$X)(e,t,e),(0,ci.JG)(r.size,e);const n=r.viewpoint;n&&(this.viewpoint=n)}})(),this.addHandles((0,F.watch)((()=>[this.size,this.padding]),(()=>this._updateContent()),F.sync)),this.padding=new Ai,this.size=[0,0]}set padding(e){this._set("padding",e||new Ai)}set viewpoint(e){if(e){this.paddedViewState.viewpoint=e;let t=e;const i=this._get("padding");i&&(t=(0,hi.H4)(e.clone(),e,this._get("size"),i));const{targetGeometry:r,rotation:n,scale:s}=t,{x:o,y:a,spatialReference:l}=r,c=this._viewpoint2D;c.center[0]=o,c.center[1]=a,c.rotation=n,c.scale=s,c.spatialReference=l,this._update()}}clone(){return new Mi({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};(0,i._)([(0,y.Cb)()],Ri.prototype,"paddedViewState",void 0),(0,i._)([(0,y.Cb)({type:Ai})],Ri.prototype,"padding",null),(0,i._)([(0,y.Cb)()],Ri.prototype,"viewpoint",null),Ri=Mi=(0,i._)([(0,v.j)("esri.views.2d.PaddedViewState")],Ri);const Oi=Ri;var Pi=n(22855),Ii=n(22167);class Li{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this._scheduler=(0,Ii.z4)(),this._schedulerHandle=(0,F.when)((()=>this._scheduler.updating),(()=>this.requestFrame())),this.stationary=!0,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),null==this.view.animation?.target||(0,g.y8)(this.view.animation.target)||(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=e=>{if(this._updateRequested=!1,this.view?.destroyed)return;const{allLayerViews:t,graphicsView:i,labelManager:r,state:{id:n}}=this.view;t?.forEach(this._updateLayerView,this),null!=r&&(r.lastUpdateId!==n&&(r.viewChange(),r.lastUpdateId=n),r.updateRequested&&r.processUpdate(this._updateParameters)),null!=i&&(i.lastUpdateId!==n&&(i.viewChange(),i.lastUpdateId=n),i.updateRequested&&i.processUpdate(this._updateParameters)),this.view.graphicsTileStore?.setViewState(this._updateParameters.state),this.view.animation?this._scheduler.state=Pi.n.ANIMATING:this.view.interacting?this._scheduler.state=Pi.n.INTERACTING:this._scheduler.state=Pi.n.IDLE,this._scheduler.frame(e)||this._updateRequested||this._scheduler.state!==Pi.n.IDLE||this._frameTaskHandle?.pause()}}destroy(){this.stop(),this._schedulerHandle.remove(),this._scheduler.destroy()}get scheduler(){return this._scheduler}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,targetState:new Oi,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=(0,F.watch)((()=>e.stationary),(e=>{this.stationary=e,this.requestFrame()})),this._frameTaskHandle=(0,ue.A)(this),this.requestUpdate()}stop(){this._frameTaskHandle&&(this._updateRequested=!1,this._stationaryHandle?.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){if(!e.attached)return void this.requestUpdate();const t=this.view.state,i=e.lastUpdateId;null!=i&&(this.stationary||e.moving)||(e.moving=!0),i!==t.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=t.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews?.forEach(this._updateLayerView,this)}}let Di=class extends Ae.Z{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=(0,g.hh)(),this.addResolvingPromise(this._resolver.promise)}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._resolver?.reject(new c.Z("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._resolver?.resolve())}update(e,t){t||(t=(0,g.y8)(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};(0,i._)([(0,y.Cb)({readOnly:!0})],Di.prototype,"done",null),(0,i._)([(0,y.Cb)({readOnly:!0,type:String})],Di.prototype,"state",void 0),(0,i._)([(0,y.Cb)()],Di.prototype,"target",void 0),Di=(0,i._)([(0,v.j)("esri.views.ViewAnimation")],Di),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Di||(Di={}));const Ni=Di;let Fi=class extends P.Z{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(e,t){if(!e)return void f.Z.getLogger(this).error("#goTo()","target cannot be null or undefined");const i=new Ni;this.view.animation=i,await(0,F.whenOnce)((()=>this.view.ready),t);const r={...t,animate:t?.animate??!(0,kt.n)(),animationMode:t?.animationMode??"auto"},{extent:n,spatialReference:s,size:o,viewpoint:a,constraints:l,padding:c,allLayerViews:u}=this.view,h=(0,hi.Ue)(e,{extent:n,spatialReference:s,size:o,viewpoint:a,constraints:l,padding:c,allLayerViews:u,pickClosestTarget:t?.pickClosestTarget??!0});return i?.update(h),this._gotoTask={},r.animate?this._gotoAnimated(h,r):this._gotoImmediate(h,r)}_gotoImmediate(e,t){const i=this._gotoTask,r=this.view.animation,n=e.then((e=>{if((0,g.k_)(t),i!==this._gotoTask)throw new c.Z("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=r.target=e,r.finish()}));return this._cancellableGoTo(i,r,n,t)}_gotoAnimated(e,t){const i=this._gotoTask,r=this.view.animation;if(!r)return Promise.resolve();const n=e.then((e=>{if((0,g.k_)(t),i!==this._gotoTask)throw new c.Z("view:goto-interrupted","Goto was interrupted");return r.update(e),this.view.animationManager.animate(r,this.view.viewpoint,t),r.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(i,r,n,t)}_cancellableGoTo(e,t,i,r){const n=()=>e===this._gotoTask;return(0,g.Hl)(i,r).finally((()=>{n()&&(t.done||t.stop())}))}};(0,i._)([(0,y.Cb)({constructOnly:!0})],Fi.prototype,"view",void 0),Fi=(0,i._)([(0,v.j)("esri.views.2d.GoToManager")],Fi);var Ui,ki=n(13054),zi=n(86618),Bi=n(27127),Vi=n(38028);let Hi=Ui=class extends(zi.Z.NumericIdentifiableMixin(P.Z)){constructor(e){super(e),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(null==this.geometry||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return(0,te.project)(this.geometry,this.spatialReference)}catch(e){return f.Z.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:e}),null}return this.geometry}constrain(e,t){if(null==this.normalizedGeometry)return e;const i=e.targetGeometry;if("extent"===this.normalizedGeometry.type?(0,Bi.aV)(this.normalizedGeometry,i):(0,Bi.CI)(this.normalizedGeometry,i))return e;const{coordinate:r}=function(e,t){const{spatialReference:i}=t,r=[t.x,t.y];let n,s,o,a;const l=[0,0],u=function(e){switch(e.type){case"extent":return[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]];case"polygon":return e.rings;case"polyline":return e.paths}}(e);for(let e=0;e<u.length;e++){const t=u[e];for(let i=0;i<t.length-1;i++){(0,Vi.Tx)(l,r,t,i);const c=(0,ci.TE)(r,l);(null==n||c<n)&&(n=c,s=[...l],o=e,a=i)}}if(null==n||!s||null==o||null==a)throw new c.Z("nearest-coordinate:failed","Failed to find the nearest coordinate");const[h,d]=s;return{coordinate:new wi.Z({x:h,y:d,spatialReference:i}),distance:n}}(this.normalizedGeometry,i);return r?(e.targetGeometry=r,e):e}clone(){return new Ui({geometry:this.geometry?.clone(),spatialReference:this.spatialReference?.clone()})}};var Gi;(0,i._)([(0,y.Cb)({constructOnly:!0})],Hi.prototype,"geometry",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Hi.prototype,"normalizedGeometry",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],Hi.prototype,"spatialReference",void 0),Hi=Ui=(0,i._)([(0,v.j)("esri.views.2d.constraints.GeometryConstraint")],Hi);let ji=Gi=class extends(zi.Z.NumericIdentifiableMixin(P.Z)){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(e,t){return this.enabled&&t?(this.rotationEnabled||(e.rotation=t.rotation),e):e}clone(){return new Gi({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};(0,i._)([(0,y.Cb)()],ji.prototype,"enabled",void 0),(0,i._)([(0,y.Cb)()],ji.prototype,"rotationEnabled",void 0),ji=Gi=(0,i._)([(0,v.j)("esri.views.2d.constraints.RotationConstraint")],ji);const Zi=ji;var qi;let Wi=qi=class extends(zi.Z.NumericIdentifiableMixin(P.Z)){constructor(e){super(e),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let e,{lods:t,minScale:i,maxScale:r,minZoom:n,maxZoom:s}=this,o=-1,a=-1,l=!1,c=!1;if(0!==i&&0!==r&&i<r&&([i,r]=[r,i]),!t?.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);t=t.map((e=>e.clone())),t.sort(((e,t)=>t.scale-e.scale)),t.forEach(((e,t)=>e.level=t));for(const n of t)!l&&i>0&&i>=n.scale&&(o=n.level,l=!0),!c&&r>0&&r>=n.scale&&(a=e?e.level:-1,c=!0),e=n;-1===n&&(n=0===i?0:o),-1===s&&(s=0===r?t.length-1:a),n=Math.max(n,0),n=Math.min(n,t.length-1),s=Math.max(s,0),s=Math.min(s,t.length-1),n>s&&([n,s]=[s,n]),i=t[n].scale,r=t[s].scale,t.splice(0,n),t.splice(s-n+1,t.length),t.forEach(((e,t)=>{this._lodByScale[e.scale]=e,this._scales[t]=e.scale})),this._set("effectiveLODs",t),this._set("effectiveMinZoom",n),this._set("effectiveMaxZoom",s),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(e,t){if(t&&e.scale===t.scale)return e;const i=this.effectiveMinScale,r=this.effectiveMaxScale,n=e.targetGeometry,s=t&&t.targetGeometry,o=0!==r&&e.scale<r,a=0!==i&&e.scale>i;if(o||a){const o=a?i:r;if(t&&s){const i=(o-t.scale)/(e.scale-t.scale);n.x=s.x+(n.x-s.x)*i,n.y=s.y+(n.y-s.y)*i}e.scale=o}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}fit(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);const t=this.scaleToZoom(e.scale),i=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(i>.99?Math.round(t):Math.floor(t)),e}zoomToScale(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);const t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];const i=Math.floor(e),r=Math.ceil(e);return t[i]+(e-i)*(t[r]-t[i])}scaleToZoom(e){if(!this.effectiveLODs)return-1;const t=this._scales;let i,r;if(e>=t[0])return this.effectiveMinZoom;if(e<=t[t.length-1])return this.effectiveMaxZoom;for(let n=0;n<t.length-1;n++){if(i=t[n],r=t[n+1],r===e)return n+this.effectiveMinZoom+1;if(i>e&&r<e)return n+this.effectiveMinZoom+1-(e-r)/(i-r)}return-1}snapToClosestScale(e){if(!this.effectiveLODs)return e;const t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}snapToNextScale(e,t=.5){if(!this.effectiveLODs)return e*t;const i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i+1)}snapToPreviousScale(e,t=2){if(!this.effectiveLODs)return e*t;const i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i-1)}clone(){return new qi({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(e){return this._lodByScale[e]||(e=this._scales.reduce(((t,i)=>Math.abs(i-e)<=Math.abs(t-e)?i:t),this._scales[0])),this._lodByScale[e].scale}};(0,i._)([(0,y.Cb)({readOnly:!0})],Wi.prototype,"effectiveLODs",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Wi.prototype,"effectiveMinZoom",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Wi.prototype,"effectiveMaxZoom",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Wi.prototype,"effectiveMinScale",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Wi.prototype,"effectiveMaxScale",void 0),(0,i._)([(0,y.Cb)()],Wi.prototype,"lods",void 0),(0,i._)([(0,y.Cb)()],Wi.prototype,"minZoom",void 0),(0,i._)([(0,y.Cb)()],Wi.prototype,"maxZoom",void 0),(0,i._)([(0,y.Cb)()],Wi.prototype,"minScale",void 0),(0,i._)([(0,y.Cb)()],Wi.prototype,"maxScale",void 0),(0,i._)([(0,y.Cb)()],Wi.prototype,"snapToZoom",void 0),Wi=qi=(0,i._)([(0,v.j)("esri.views.2d.constraints.ZoomConstraint")],Wi);const $i=Wi,Yi={base:null,key:"type",typeMap:{extent:Oe.Z,polygon:ee.Z}};let Ji=class extends P.Z{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new o.Z}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){return`${this._zoom?.uid}/${this._rotation?.uid}/${this._geometry?.uid}`}get _geometry(){const e=this._get("_geometry");return e&&this.geometry===e.geometry&&this.view?.constraintsInfo.spatialReference===e.spatialReference?e:new Hi({geometry:this.geometry,spatialReference:this.view?.constraintsInfo.spatialReference})}get _rotation(){return new Zi({rotationEnabled:this.rotationEnabled})}get _zoom(){const e=this._get("_zoom"),t=this.lods||this.view?.constraintsInfo.lods,i=this.minZoom,r=this.maxZoom,n=this.minScale,s=this.maxScale,o=this.snapToZoom;return e&&e.lods===t&&e.minZoom===i&&e.maxZoom===r&&e.minScale===n&&e.maxScale===s&&e.snapToZoom===o?e:new $i({lods:t,minZoom:i,maxZoom:r,minScale:n,maxScale:s,snapToZoom:o})}canZoomInTo(e){const t=this.effectiveMaxScale;return 0===t||e>=t}canZoomOutTo(e){const t=this.effectiveMinScale;return 0===t||e<=t}constrain(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),this.customConstraints.forEach((i=>i.constrain(e,t))),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach((t=>t.applyPanConstraint?.(e))),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};(0,i._)([(0,y.Cb)({readOnly:!0})],Ji.prototype,"effectiveLODs",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Ji.prototype,"effectiveMinScale",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Ji.prototype,"effectiveMaxScale",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Ji.prototype,"effectiveMinZoom",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Ji.prototype,"effectiveMaxZoom",null),(0,i._)([(0,y.Cb)({types:Yi,value:null})],Ji.prototype,"geometry",null),(0,i._)([(0,y.Cb)({type:[ki.Z]})],Ji.prototype,"lods",void 0),(0,i._)([(0,y.Cb)()],Ji.prototype,"minScale",void 0),(0,i._)([(0,y.Cb)()],Ji.prototype,"maxScale",void 0),(0,i._)([(0,y.Cb)()],Ji.prototype,"minZoom",void 0),(0,i._)([(0,y.Cb)()],Ji.prototype,"maxZoom",void 0),(0,i._)([(0,y.Cb)()],Ji.prototype,"rotationEnabled",void 0),(0,i._)([(0,y.Cb)()],Ji.prototype,"snapToZoom",void 0),(0,i._)([(0,y.Cb)({type:o.Z})],Ji.prototype,"customConstraints",void 0),(0,i._)([(0,y.Cb)()],Ji.prototype,"view",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Ji.prototype,"version",null),(0,i._)([(0,y.Cb)({type:Hi,readOnly:!0})],Ji.prototype,"_geometry",null),(0,i._)([(0,y.Cb)({type:Zi})],Ji.prototype,"_rotation",null),(0,i._)([(0,y.Cb)({readOnly:!0,type:$i})],Ji.prototype,"_zoom",null),Ji=(0,i._)([(0,v.j)("esri.views.2d.MapViewConstraints")],Ji);const Xi=Ji;var Ki=n(96863),Qi=n(96926);let er=class extends P.Z{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([(0,F.watch)((()=>this.constraints?.version),(e=>{this.constraints&&e&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))}),F.sync)])}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:t}=this.state.paddedViewState;return this.state.commitProperty("id"),new wi.Z({x:e[0],y:e[1],spatialReference:t})}set center(e){if(null==e)return;if(!this.ready)return void this._set("center",e);let t;try{t=this._project(e,this.state.spatialReference)}catch(t){return void f.Z.getLogger(this).error(new c.Z("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:t}))}const i=this.viewpoint;(0,hi.o2)(i,i,t),this.viewpoint=i}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(null==e)return;if(!e.width||!e.height)return void f.Z.getLogger(this).error(new c.Z("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let t;try{t=this._project(e,this.state.spatialReference)}catch(e){return void f.Z.getLogger(this).error(new c.Z("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:e}))}const i=this.viewpoint;(0,hi.qf)(i,i,t,this.state.size,{constraints:this.constraints}),this.viewpoint=i}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const t=this.viewpoint;(0,hi.YQ)(t,t,e),this.viewpoint=t}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);const t=this._get("extent");return void(t&&(this._set("extent",void 0),this._set("center",t.center)))}const t=this.viewpoint;(0,hi.Hy)(t,t,e),this.viewpoint=t}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){if(null==e)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let t,i;try{t=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?i=new c.Z("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):null==e.targetGeometry&&(i=new c.Z("mapview:invalid-viewpoint","geometry not defined"))}catch(e){i=new c.Z("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:e})}if(i)return void f.Z.getLogger(this).error(i);this._scaleBeforeChangingSpatialReference=null;const r=new K.Z({targetGeometry:new wi.Z,scale:0,rotation:0});(0,hi.JG)(r,t),this.constraints?.constrain(r,this.state.paddedViewState.viewpoint),this.state.viewpoint=r,this._set("viewpoint",r)}get visibleArea(){return this.ready?this.state.visibleArea:null}get zoom(){return this.ready?this.constraints?.scaleToZoom(this.scale)??-1:this._get("zoom")}set zoom(e){if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);const t=this._get("extent");return void(t&&(this._set("extent",void 0),this._set("center",t.center)))}const t=this.constraints?.zoomToScale(e)??0;if(!t)return void this._set("zoom",-1);const i=this.viewpoint;(0,hi.Hy)(i,i,t),this.viewpoint=i,this._set("zoom",this.constraints?.scaleToZoom(this.scale)??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};const{padding:t,constraints:i}=this,r=this._get("center"),n=this._get("extent"),s=this._get("scale"),o=this._get("rotation"),a=this._get("viewpoint"),l=this._get("zoom"),c=null!=l&&null!=i&&i.zoomToScale(l)||void 0;let u,h,d;const p=a?.rotation,f=a?.targetGeometry;"extent"===f?.type?u=f:"point"===f?.type&&(h=f,d=a?.scale);const m=n??u;return{center:r??h??m?.center,rotation:o??p,scale:(s??c??d??(m&&(0,hi.EK)(m,[e[0]-t.left-t.right,e[1]-t.top-t.bottom])))||void 0}}startup(e,t,i,r){const n=e.targetGeometry;try{this._project(e,i)}catch(t){f.Z.getLogger(this).warn(new Ki.Z("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:n.toJSON(),spatialReference:i,error:t})),e.targetGeometry=r||new wi.Z({x:0,y:0,spatialReference:i})}this.constraints?.fit(e),this._set("state",new Oi({padding:this.padding,size:t,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);const{center:[e,t],spatialReference:i,rotation:r,scale:n}=this.state.paddedViewState,s=new wi.Z({x:e,y:t,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",s),this._set("zoom",-1),this._set("rotation",r),this._set("scale",n),this._set("state",null)}changeSpatialReference(e){const t=this.state.paddedViewState.clone();if(null==this._scaleBeforeChangingSpatialReference)this._scaleBeforeChangingSpatialReference=t.scale;else{const e=t.viewpoint.clone();e.scale=this._scaleBeforeChangingSpatialReference,t.viewpoint=e}const i=t.clone(),[r,n]=t.center;let s=null;try{s=this._project(new wi.Z({x:r,y:n,spatialReference:t.spatialReference}),e)}catch(t){(0,Qi.i)()||f.Z.getLogger(this).warn(new Ki.Z("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:s?.toJSON(),spatialReference:e,error:t}))}s||(s=new wi.Z({x:0,y:0,spatialReference:e}));const o=(0,hi.o2)(new K.Z({targetGeometry:new wi.Z,scale:0,rotation:0}),t.viewpoint,s);i.viewpoint=o;try{const r=20,n=[t.size[0]/2,t.size[1]/2],s=[n[0]+r,n[1]],a=t.toMap([0,0],s),{x:l,y:c}=this._project(new wi.Z({x:a[0],y:a[1],spatialReference:t.spatialReference}),e);a[0]=l,a[1]=c,i.toScreen(a,a);const u=(0,hi.dI)(n,a,s),h=Math.hypot(a[0]-n[0],a[1]-n[1])/r;!Number.isFinite(h)||Math.abs(h)>4?(o.rotation=0,o.targetGeometry=new wi.Z({x:0,y:0,spatialReference:e})):(o.scale*=h,o.scale>(0,w.Z)("mapview-srswitch-adjust-rotation-scale-threshold")?o.rotation=0:o.rotation+=Number.isFinite(u)?u:0)}catch{}this._get("constraints")?.constrain(o,void 0),this._get("state").viewpoint=o}resize(e,t){if(!this.ready)return;const i=this.state;let r=this.state.paddedViewState.viewpoint;const n=this.state.paddedViewState.size.slice();i.size=[e,t],(0,hi.SI)(r,r,n,this.state.paddedViewState.size,this.resizeAlign),r=this.constraints?.constrain(r,void 0)??r,this.state.viewpoint=r}toMap(e){if(!this.ready)return null;const[t,i]=this.state.toMap([0,0],[e.x,e.y]),r=this.state.spatialReference;return new wi.Z({x:t,y:i,spatialReference:r})}toScreen(e,t){if(!this.ready)return null;const i=this._project(e,this.state.spatialReference),r=[i.x,i.y];return!1===t?.pickClosestTarget||this.state.paddedViewState.wrapMapCoordinate(r,r),this.state.toScreen(r,r),(0,$e.vW)(r[0],r[1])}_project(e,t){const i=e?.targetGeometry||e;if(!t)return e;if(!i)return null;if(t.imageCoordinateSystem||i.spatialReference?.imageCoordinateSystem)return e;if((0,Le.fS)(t,i.spatialReference))return e;const r=(0,te.project)(i,t);if(!r)throw new c.Z("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:i,spatialReference:t});return function(e){return"esri.Viewpoint"===e?.declaredClass}(e)?(e.targetGeometry=r,e):r}};(0,i._)([(0,y.Cb)({type:wi.Z})],er.prototype,"center",null),(0,i._)([(0,y.Cb)()],er.prototype,"constraints",void 0),(0,i._)([(0,y.Cb)({type:Oe.Z})],er.prototype,"extent",null),(0,i._)([(0,y.Cb)({value:{top:0,right:0,bottom:0,left:0},cast:e=>({top:0,right:0,bottom:0,left:0,...e})})],er.prototype,"padding",null),(0,i._)([(0,y.Cb)()],er.prototype,"ready",void 0),(0,i._)([(0,y.Cb)()],er.prototype,"resizeAlign",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],er.prototype,"resolution",null),(0,i._)([(0,y.Cb)({type:Number})],er.prototype,"rotation",null),(0,i._)([(0,y.Cb)({type:Number})],er.prototype,"scale",null),(0,i._)([(0,y.Cb)({readOnly:!0})],er.prototype,"state",void 0),(0,i._)([(0,y.Cb)({type:K.Z})],er.prototype,"viewpoint",null),(0,i._)([(0,y.Cb)({readOnly:!0})],er.prototype,"visibleArea",null),(0,i._)([(0,y.Cb)()],er.prototype,"zoom",null),er=(0,i._)([(0,v.j)("esri.views.2d.ViewStateManager")],er);var tr=n(41649);function ir(e,t){switch(t){case"primary":return"touch"===e.pointerType||0===e.button;case"secondary":return"touch"!==e.pointerType&&2===e.button;case"tertiary":return"touch"!==e.pointerType&&1===e.button}}function rr(e,t){return t.some((t=>ir(e,t)))}function nr(e,t){const{button:i,pointerType:r}=e;return"touch"!==r&&t.some((e=>"primary"===e&&0===i||"secondary"===e&&2===i||"tertiary"===e&&1===i))}function sr(e,{dragPrimary:t,dragSecondary:i,dragTertiary:r}){return[{key:"primary",value:t},{key:"secondary",value:i},{key:"tertiary",value:r}].filter((t=>t.value===e)).map((e=>e.key))}class or extends tr.a{constructor(e,t){super(!0),this._view=e,this.registerIncoming("double-click",t,(e=>this._handleDoubleClick(e,t)))}_handleDoubleClick(e,t){ir(e.data,"primary")&&(e.stopPropagation(),t?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}}class ar extends tr.a{constructor(e,t,i){super(!0),this.view=e,this.pointerType=t,this.registerIncoming("double-tap-drag",i,(e=>this._handleDoubleTapDrag(e)))}_handleDoubleTapDrag(e){const{data:t}=e,{pointerType:i}=t;if(i!==this.pointerType)return;e.stopPropagation();const{action:r,delta:n}=t,{view:s}=this,{mapViewNavigation:o}=s;switch(r){case"begin":{const{scale:e}=s;this._startScale=e,this._currentScale=e,this._previousDelta=n,o.begin();break}case"update":{if(this._previousDelta.y===n.y)return;this._previousDelta=n;const e=1.015**n.y,t=this._startScale*e,i=t/this._currentScale;o.setViewpointImmediate(i),this._currentScale=t;break}case"end":{const{constraints:e}=s,{effectiveLODs:t,snapToZoom:i}=e;if(!i||!t)return void o.end();const r=e.snapScale(this._currentScale),a=(n.y>0?Math.max(r,e.snapToPreviousScale(this._startScale)):Math.min(r,e.snapToNextScale(this._startScale)))/this._currentScale;o.zoom(a).then((()=>{o.end()}));break}}}}class lr{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const t=e.data,i=t.pointers.size;switch(t.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}}class cr extends tr.a{constructor(e,t,i){super(!0),this.view=e,this.pointerActions=t,this.registerIncoming("drag",i,(e=>this._handleDrag(e))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()))}onInstall(e){super.onInstall(e),this._dragEventSeparator=new lr({start:(e,t)=>{this.view.mapViewNavigation.pan.begin(this.view,t.data),t.stopPropagation()},update:(e,t)=>{this.view.mapViewNavigation.pan.update(this.view,t.data),t.stopPropagation()},end:(e,t)=>{this.view.mapViewNavigation.pan.end(this.view,t.data),t.stopPropagation()},condition:(e,t)=>1===e&&rr(t.data,this.pointerActions)})}_handleDrag(e){const t=this.view.mapViewNavigation;t.pinch.zoomMomentum||t.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}}class ur extends tr.a{constructor(e,t,i){super(!0),this._view=e,this.pointerActions=t;const r=this._view.mapViewNavigation;this._dragEventSeparator=new lr({start:(e,t)=>{r.rotate.begin(this._view,t.data),t.stopPropagation()},update:(e,t)=>{r.rotate.update(this._view,t.data),t.stopPropagation()},end:(e,t)=>{r.rotate.end(),t.stopPropagation()},condition:(e,t)=>1===e&&rr(t.data,this.pointerActions)}),this.registerIncoming("drag",i,(e=>this._dragEventSeparator.handle(e)))}}var hr=n(86717);function dr(e){let t=e*e;return e<0&&(t*=-1),t}function pr(e,t,i){const r=i,n=e.state,s=e.device,o="forward-down"===t.tiltDirection?1:-1;return"standard"===s.deviceType?(r.translation[0]=dr(n.axes[0]),r.translation[1]=dr(n.axes[1]),r.translation[2]=dr(n.buttons[7])-dr(n.buttons[6]),r.heading=dr(n.axes[2]),r.tilt=dr(n.axes[3])):"spacemouse"===s.deviceType&&(r.translation[0]=1.2*dr(n.axes[0]),r.translation[1]=1.2*dr(n.axes[1]),r.translation[2]=2*-dr(n.axes[2]),r.heading=1.2*dr(n.axes[5]),r.tilt=1.2*dr(n.axes[3])),r.tilt*=o,(0,hr.h)(r.translation,r.translation,1),r}function fr(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function mr(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}class gr extends tr.a{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new Me.Z,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",(e=>this._handleGamePadEvent(e))),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([(0,F.watch)((()=>this._view.navigation.gamepad?.enabled),(e=>{e?(this._handle.resume(),this._frameTask||(this._frameTask=(0,ue.A)({update:e=>this._frameUpdate(e.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))}),F.initial)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){const t=this._view.navigation.gamepad.device;t&&e.data.device!==t||this._currentDevice&&this._currentDevice!==e.data.device||("end"===e.data.action?(this._currentDevice=null,function(e){e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0}(this._transformation)):(this._currentDevice=e.data.device,pr(e.data,this._view.navigation.gamepad,this._transformation)),this._frameTask?.resume())}_frameUpdate(e){const t=this._transformation;if(mr(t))return void this._frameTask?.pause();const i=this._view.viewpoint.clone(),r=this._view.navigation.gamepad.velocityFactor,n=_r*r*e;(0,hi.Rx)(i,i,[t.translation[0]*n,-t.translation[1]*n]);const s=1+t.translation[2]*vr*e,o=this._view.constraints.rotationEnabled?-t.heading*yr*e:0,a=this._view.size,l=[a[0]/2,a[1]];(0,hi.UZ)(i,i,s,o,l,a);const c=this._view.constraints.constrain(i,this._view.viewpoint);this._view.viewpoint=c}}const yr=.06,_r=.7,vr=6e-4;function br(e){const t=()=>e("visible"===document.visibilityState);return document.addEventListener("visibilitychange",t),(0,N.kB)((()=>document.removeEventListener("visibilitychange",t)))}class wr extends tr.a{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=e=>{const t=this._keyMap[e.data.key];if(e.modifiers.has("Meta")||e.modifiers.has("Control"))return void this._stopMovement();if(null==t)return;e.stopPropagation(),e.preventDefault();const i="key-down"===e.type;if(this._pressedKeys[i?"add":"delete"](t),i){if(this._direction===t)return;this._direction=t,this._isSticky=!1,this._setTimeout((()=>{this._isSticky&&this._handlePopKey()}))}else{const e=void 0===this._timeout,t=this._pressedKeys.size>0;e||t?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),null==this._direction&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[t.left]:"left",[t.right]:"right",[t.up]:"up",[t.down]:"down"},this.registerIncoming("key-down",i,this._handleKey),this.registerIncoming("key-up",i,this._handleKey),this.registerIncoming("blur",i,this._stopMovement),this._visibilityHandle=br((e=>e?null:this._stopMovement()))}onUninstall(){this._stopMovement(),this._visibilityHandle?.remove()}get _direction(){return this._currentDirection}set _direction(e){const t=null!=this._currentDirection;if(null!=e){if(t||this.view.mapViewNavigation.begin(),this._currentDirection!==e)switch(e){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else t&&this.view.mapViewNavigation.stop();this._currentDirection=e}_setTimeout(e){clearTimeout(this._timeout),this._timeout=void 0===e?void 0:setTimeout((()=>{this._timeout=void 0,e()}),this._stickyKeyDuration)}}class xr extends tr.a{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._keyToDirection=new Map,this._pressed=!1,this._addKeysMapping(t),this.registerIncoming("key-down",i,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",i,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",i,(()=>this._handleStop())),this._visibilityHandle=br((e=>e?null:this._handleStop()))}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_addKeysMapping(e){this._addKeyMapping(e.clockwise,"clockwise"),this._addKeyMapping(e.counterClockwise,"counterClockwise"),this._addKeyMapping(e.reset,"reset")}_addKeyMapping(e,t){for(const i of e)this._keyToDirection.set(i,t)}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,t){const i=e.modifiers;if(i.size>0&&!i.has("Shift")||!this.view.constraints.rotationEnabled)return;const r=this._keyToDirection.get(e.data.key);if(this._pressed=null!=r,this._pressed){if(e.preventDefault(),t)switch(this.view.mapViewNavigation.begin(),r){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}}var Tr;!function(e){e[e.IN=0]="IN",e[e.OUT=1]="OUT"}(Tr||(Tr={}));class Cr extends tr.a{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._keysToZoomAction={},this.registerIncoming("key-down",i,(e=>this._handleKeyDown(e))),t.zoomIn.forEach((e=>this._keysToZoomAction[e]=Tr.IN)),t.zoomOut.forEach((e=>this._keysToZoomAction[e]=Tr.OUT))}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const t=e.modifiers;if(t.size>0&&!t.has("Shift"))return;const{key:i}=e.data;if(!(i in this._keysToZoomAction))return;const r=this._keysToZoomAction[i],{mapViewNavigation:n}=this.view;let s=null;switch(r){case Tr.IN:s=n.zoomIn();break;case Tr.OUT:s=n.zoomOut();break;default:return}n.begin(),s.then((()=>n.end())),e.stopPropagation()}}class Sr extends tr.a{constructor(e,t){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",t,(e=>this._handleMouseWheel(e)))}_handleMouseWheel(e){if("zoom"!==this._view.navigation.actionMap.mouseWheel)return;if(e.preventDefault(),e.stopPropagation(),!this._canZoom)return;const t=this._view.mapViewNavigation,{x:i,y:r,deltaY:n}=e.data,s=1/.6**(1/60*n),o=t.zoom(s,[i,r]);o&&(this._canZoom=!1,o.catch((()=>{})).then((()=>{this._canZoom=!0,t.end()})))}}class Er extends tr.a{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",(e=>this._handleDrag(e))),this.registerIncoming("pointer-down",(()=>this._stopMomentumNavigation()));const t=this.view.mapViewNavigation;this._dragEventSeparator=new lr({start:(e,i)=>{t.pinch.begin(this.view,i.data),i.stopPropagation()},update:(e,i)=>{t.pinch.update(this.view,i.data),i.stopPropagation()},end:(e,i)=>{t.pinch.end(this.view),i.stopPropagation()},condition:e=>e>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}}function Mr(e){const t=e.native;return t?{buttons:t.buttons.map((e=>e.pressed?e.value||1:0)),axes:t.axes.map((t=>function(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}(t,e.axisThreshold)))}:{buttons:[],axes:[]}}class Ar{constructor(e,t){this._element=e,this._input=t,this._hasEventListeners=!1,this._onConnectGamepad=e=>{this._connectGamepad(e.gamepad)},this._onDisconnectGamepad=e=>{const t=e.gamepad,i=t.index,r=this._inputDevices[i];r&&(this._emitGamepadEvent(t,Mr(r),!1),this._inputDevices.splice(i,1),this._latestUpdate.splice(i,1),this._input.gamepad.devices.remove(r),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,r=window.isSecureContext;this.supported=i&&r,this.supported&&(Or((e=>this._connectGamepad(e))),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const t=new Pt(e);"unknown"!==t.deviceType&&(this._inputDevices[e.index]=t,this._input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this._frameTask&&(this._frameTask=(0,ue.A)({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),t=this._element.contains(document.activeElement),i="document"===this._input.gamepad.enabledFocusMode&&!e||"view"===this._input.gamepad.enabledFocusMode&&!t;Or((e=>{const t=this._inputDevices[e.index];if(!t)return;const r=this._latestUpdate[e.index],n=Mr(t),s=i||function(e){for(let t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(let t=0;t<e.buttons.length;t++)if(0!==e.buttons[t])return!1;return!0}(n);if(r){if(r.timestamp===e.timestamp)return;if(!r.active&&s)return;if(function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}(r.state,n))return}this._emitGamepadEvent(e,n,!s)}))}_emitGamepadEvent(e,t,i){const r=this._latestUpdate[e.index],n=r&&r.active;if(!n&&!i)return;const s=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:t,action:s})}}function Rr(e){if(!e)return!1;if(!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}function Or(e){for(const t of navigator.getGamepads())Rr(t)&&e(t)}const Pr=(0,w.Z)("edge"),Ir=(0,w.Z)("chrome"),Lr=(0,w.Z)("ff"),Dr=(0,w.Z)("safari"),Nr="esri-view-surface",Fr={touchNone:`${Nr}--touch-none`,touchPan:`${Nr}--touch-pan`};class Ur{constructor(e,t){this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Ar(e,t),this._gamepadSource.onEvent=e=>this._callback("gamepad",e)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach((e=>this._releasePointerCaptureSafe(e))),this._activePointerCaptures.clear(),this._gamepadSource=(0,m.SC)(this._gamepadSource),this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const e=this._active[t];this._element.removeEventListener(kr[t],e),delete this._active[t]}e&&e.forEach((e=>{if(!this._active[e]&&kr[e]){const t=(this._eventHandlers[e]||this._handleDefault).bind(this,e);this._element.addEventListener(kr[e],t),this._active[e]=t}})),this._gamepadSource&&(this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1)}setPointerCapture(e,t){t?this._setPointerCaptureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Fr.touchNone:Fr.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Fr.touchPan:Fr.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Fr.touchNone),this._element.classList.remove(Fr.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCaptureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(e){}}_updateNormalizedPointerLikeEvent(e,t){const i=(0,_t.Eu)(this._element,e);return Ur.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),t.x=i.x,t.y=i.y,t}_handleKey(e,t){const{key:i}=t;i&&"key-up"===e&&this._keyDownState.delete(i);const r={native:t,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&"key-down"===e&&this._keyDownState.add(r.key),this._callback(e,r)}_handlePointer(e,t){const i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,t){const i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,i)}_getDeltaFromTrackpadOrMouseWheel(e){return e.shiftKey&&(0,w.Z)("mac")&&0===e.deltaY?e.deltaX:e.deltaY}_handleMouseWheel(e,t){let i=this._getDeltaFromTrackpadOrMouseWheel(t);switch(t.deltaMode){case 0:Pr&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}Pr?i*=.7:Ir||Dr?i*=.6:Lr&&(i*=1.375);const r=Math.abs(i);r>100&&(i=i/r*200/(1+Math.exp(-.02*(r-100))));const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:i});this._callback(e,n)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const i={native:t};t.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){"Alt"===e.key&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}}Ur.test={disableSubpixelCoordinates:!1};const kr={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class zr extends tr.a{constructor(){super(!0),this.registerIncoming("context-menu",(e=>e.data.native.preventDefault()))}}const Br=300,Vr=1.5,Hr=6,Gr=6,jr=500,Zr=250,qr=10,Wr=350,$r=35;function Yr(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function Jr(e){const{native:t}=e,{pointerId:i,button:r,pointerType:n}=t;return"mouse"===n?`${i}:${r}`:`${n}`}class Xr extends tr.a{constructor(e=Zr,t=qr,i=Wr,r=$r,n=ht.m){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=r,this._clock=n,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=(0,$e.vW)(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new lr({start:(e,t)=>this._dragStart(e,t),update:(e,t)=>this._dragUpdate(t),end:(e,t)=>this._dragEnd(t)}),this.registerIncoming("drag",(e=>this._dragEventSeparator.handle(e))),this.registerIncoming("pointer-down",(e=>this._handlePointerDown(e))),this.registerIncoming("pointer-up",(()=>this._handlePointerUp()))}onUninstall(){this._pointerState.forEach((e=>{e.doubleTapTimeout=(0,m.hw)(e.doubleTapTimeout)}))}get hasPendingInputs(){for(const e of this._pointerState.values())if(null!=e.doubleTapTimeout)return!0;return!1}_clearPointerDown(e){const t=this._pointerState.get(e);t&&(t.doubleTapTimeout=(0,m.hw)(t.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_dragStart(e,t){if(!this._doubleTapDragReady||1!==e)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:i,modifiers:r}=t,{center:n}=i;this._dragStartCenter=n;const s=Kr("begin",(0,$e.vW)(0,0),i);this._doubleTapDrag.emit(s,void 0,r),t.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:i}=e,{center:r}=t,n=Kr("update",(0,$e.vW)(r.x-this._dragStartCenter.x,r.y-this._dragStartCenter.y),t);this._doubleTapDrag.emit(n,void 0,i),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:i}=e,{center:r}=t,n=Kr("end",(0,$e.vW)(r.x-this._dragStartCenter.x,r.y-this._dragStartCenter.y),t);this._doubleTapDrag.emit(n,void 0,i),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:t}=e,i=Jr(t),r=this._pointerState.get(i),{pointerType:n}=t.native;if(r){const s="touch"===n?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(i),Yr(r.event.data,t)>s?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:t}=e,{pointerType:i}=t.native,r=Jr(t),n="touch"===i?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,s=this._clock.setTimeout((()=>this._clearPointerDown(r)),n);this._pointerState.set(r,{event:e,doubleTapTimeout:s}),this.refreshHasPendingInputs()}}function Kr(e,t,i){const{button:r,buttons:n,pointer:s,pointers:o,pointerType:a,timestamp:l}=i;return{action:e,delta:t,button:r,buttons:n,pointer:s,pointers:o,pointerType:a,timestamp:l}}var Qr,en=n(12928);class tn extends tr.a{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,t,i,r){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:t.buttons,timestamp:r,pointers:sn(this._activePointerMap),pointer:t,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const t=e.native.pointerId,i=nn(this._activePointerMap).angle,r={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(t,r);const n=on(r,rn(this._activePointerMap));r.initialAngle=n,r.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(e){if(e&&null==e.x&&null==e.y)return;const t=e.native.pointerId,i=this._activePointerMap.get(t);i?i.event=e:this._addPointer(e)}_removePointer(e){const t=nn(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(t)}_updatePointerAngles(e){const t=nn(this._activePointerMap);this._activePointerMap.forEach((i=>{i.initialAngle=on(i,t)-e,i.lastAngle=on(i,t)-e}))}_emitEvent(e,t,i){const r=nn(this._activePointerMap);this._drag.emit(this._createPayload(e,t,r,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,i=(0,en.HA)(e.timestamp);this._activePointerMap.get(t)&&(1===this._activePointerMap.size?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",e.data,(0,en.HA)(e.timestamp))))}_handlePointerDrag(e){const t=e.data,i=t.currentEvent,r=(0,en.HA)(e.timestamp);switch(t.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,r)):(this._addPointer(i),this._emitEvent("added",i,r),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,r))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}function rn(e){const t=[];return e.forEach((e=>{t.push((0,$e.vW)(e.event.x,e.event.y))})),function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:(0,$e.vW)()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){const[i,r]=e,[n,s]=[r.x-i.x,r.y-i.y];return t.radius=Math.sqrt(n*n+s*s)/2,t.center.x=(i.x+r.x)/2,t.center.y=(i.y+r.y)/2,t}let i=0,r=0;for(let t=0;t<e.length;t++)i+=e[t].x,r+=e[t].y;i/=e.length,r/=e.length;const n=e.map((e=>e.x-i)),s=e.map((e=>e.y-r));let o=0,a=0,l=0,c=0,u=0,h=0,d=0;for(let e=0;e<n.length;e++){const t=n[e],i=s[e],r=t*t,p=i*i;o+=r,a+=p,l+=t*i,c+=r*t,u+=p*i,h+=t*p,d+=i*r}const p=.5*(c+h),f=.5*(u+d),m=o*a-l*l,g=(p*a-f*l)/m,y=(o*f-l*p)/m,_=(0,$e.vW)(g+i,y+r);return{radius:Math.sqrt(g*g+y*y+(o+a)/e.length),center:_}}(t)}function nn(e){const t=rn(e);let i=0;return e.forEach((e=>{let r=on(e,t),n=r-e.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;r=e.lastAngle+n,e.lastAngle=r;const s=r-e.initialAngle;i+=s})),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function sn(e){const t=new Map;return e.forEach(((e,i)=>t.set(i,e.event))),t}function on(e,t){const i=e.event,r=i.x-t.center.x,n=i.y-t.center.y;return Math.atan2(n,r)}!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(Qr||(Qr={}));class an extends tr.a{constructor(e=Zr,t=qr,i=Wr,r=$r,n=ht.m){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=r,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach((e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=Jr(t);if(!this._pointerState.has(i)){const e={downButton:t.native.button,x:t.x,y:t.y,immediateDoubleClick:null};this._pointerState.set(i,e),this.startCapturingPointer(t.native)}}_handlePointerUp(e){const t=e.data,i=Jr(t),r=this._pointerState.get(i);if(r&&r.downButton===t.native.button){const i=r.immediateDoubleClick,n="touch"===e.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;i?(i.timeoutHandle.remove(),Yr(i,e.data)>n?this._startImmediateDoubleClick(e,r):(this._immediateDoubleClick.emit(e.data,void 0,i.modifiers),this._removeState(t))):Yr(r,e.data)>n?this._removeState(t):this._startImmediateDoubleClick(e,r)}}_startImmediateDoubleClick(e,t){const i="touch"===e.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(e.data)),i)}}_removeState(e){const t=Jr(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}}class ln extends tr.a{constructor(e=Br,t=Vr,i=Hr,r=Gr,n=jr,s=ht.m){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=t,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=r,this._holdDelay=n,this._clock=s,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",(e=>this._handlePointerDown(e))),this.registerIncoming("pointer-up",(e=>this._handlePointerLoss(e,"pointer-up"))),this.registerIncoming("pointer-capture-lost",(e=>this._handlePointerLoss(e,"pointer-capture-lost"))),this.registerIncoming("pointer-cancel",(e=>this._handlePointerLoss(e,"pointer-cancel"))),this._moveHandle=this.registerIncoming("pointer-move",(e=>this._handlePointerMove(e))),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((e=>{e.holdTimeout=(0,m.hw)(e.holdTimeout)})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=t.native.pointerId;let r=null;0===this._pointerState.size&&(r=this._clock.setTimeout((()=>{const t=this._pointerState.get(i);if(t){if(!t.isDragging){const i=t.previousEvent;this._pointerHold.emit(i,void 0,e.modifiers),t.holdEmitted=!0}t.holdTimeout=null}}),this._holdDelay));const n={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:r,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const t=e.data,i=t.native.pointerId,r=this._pointerState.get(i);r&&(r.isDragging?this._pointerDrag.emit(cn("update",r,t),void 0,r.modifiers):function(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}(t,r.startEvent)>this._getDragThreshold(t.native.pointerType)&&this._startDragging(e),r.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const t=e.data,i=t.native.pointerId;this._pointerState.forEach((r=>{null!=r.holdTimeout&&(r.holdTimeout.remove(),r.holdTimeout=null),r.isDragging||(r.modifiers=e.modifiers,r.isDragging=!0,i===r.startEvent.native.pointerId?this._pointerDrag.emit(cn("start",r,t)):this._pointerDrag.emit(cn("start",r,r.previousEvent),e.timestamp))}))}_handlePointerLoss(e,t){const i=e.data,r=i.native.pointerId,n=this._pointerState.get(r);n&&(null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(cn("end",n,"pointer-up"===t?i:n.previousEvent),void 0,n.modifiers):"pointer-up"===t&&n.downButton===i.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(r),this.stopCapturingPointer(i.native),0===this._pointerState.size&&this._moveHandle.pause())}}function cn(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}class un extends tr.a{constructor(e=Zr,t=qr,i=Wr,r=$r,n=ht.m){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=r,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",(e=>this._handleImmediateClick(e))),this.registerIncoming("pointer-down",(e=>this._handlePointerDown(e)))}onUninstall(){this._pointerState.forEach((e=>e.doubleClickTimer=(0,m.hw)(e.doubleClickTimer)))}get hasPendingInputs(){for(const e of this._pointerState.values())if(null!=e.doubleClickTimer)return!0;return!1}_clearDoubleClickTimer(e,t){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=(0,m.hw)(i.doubleClickTimer),t&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);1===t.pointerDownCount&&this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const t=e.data,{pointerType:i}=t.native,r=function(e){const{pointerId:t,pointerType:i,button:r}=e.native;return"mouse"===i?`${t}:${r}`:`${i}`}(t);if(!this._pointerState.has(r))return void this._startClick(e);const n=this._pointerState.get(r),{data:s,modifiers:o}=n.event,a="touch"===i?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Yr(s,t)>a?(this._clearDoubleClickTimer(r,!0),this._startClick(e)):(this._clearDoubleClickTimer(r,!1),2===n.pointerDownCount&&this._doubleClick.emit(s,void 0,o))}_handlePointerDown(e){const t=Jr(e.data),i=this._pointerState.get(t);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:t}=e,{native:{pointerType:i}}=t,r=Jr(t),n="touch"===i?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,s=this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(r)),n);this._pointerState.set(r,{event:e,doubleClickTimer:s,pointerDownCount:1}),this.refreshHasPendingInputs()}}const hn="Control",dn={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},pn={zoomIn:["=","+"],zoomOut:["-","_"]},fn={clockwise:["a","A"],counterClockwise:["d","D"],reset:["n","N"]},mn=Symbol("handles");let gn=class extends P.Z{initialize(){const e=()=>this.view?.ready;this.addHandles([(0,F.when)((()=>!e()),(()=>this._disconnect())),(0,F.when)(e,(()=>this._connect()))])}destroy(){this._disconnect()}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_disconnect(){this.view.viewEvents.disconnect(),this.removeHandles(mn),this._inputManager=(0,m.SC)(this._inputManager)}_connect(){const e=this.view.surface,t=new Ur(e,this.view.input),i=[new an,new ln,new un,new tn(this.view.navigation),new Xr],r=new we.$({eventSource:t,recognizers:i}),n=new cr(this.view,["primary"]),s=new ur(this.view,["secondary"]);r.installHandlers("prevent-context-menu",[new zr],we.f.INTERNAL),r.installHandlers("navigation",[new Er(this.view),new gr(this.view),new Sr(this.view),new or(this.view),new or(this.view,[hn]),n,new wr(this.view,dn),new Cr(this.view,pn),new xr(this.view,fn),s,new ar(this.view,"touch")],we.f.INTERNAL),this.view.viewEvents.connect(r),this._source=t,this._inputManager=r,this.addHandles([(0,F.watch)((()=>this.view?.navigation?.browserTouchPanEnabled),(e=>{this._source&&(this._source.browserTouchPanningEnabled=!e)}),F.initial),(0,F.watch)((()=>{const{actionMap:e}=this.view.navigation;return{panActions:sr("pan",e),rotateActions:sr("rotate",e)}}),(({panActions:e,rotateActions:t})=>{n.pointerActions=e,s.pointerActions=t}),F.syncAndInitial)],mn)}get test(){}};(0,i._)([(0,y.Cb)()],gn.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],gn.prototype,"latestPointerType",null),(0,i._)([(0,y.Cb)()],gn.prototype,"latestPointerLocation",null),(0,i._)([(0,y.Cb)()],gn.prototype,"multiTouchActive",null),gn=(0,i._)([(0,v.j)("esri.views.2d.input.MapViewInputManager")],gn);const yn=gn;let _n=class extends P.Z{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),null==this._timer&&(this._timer=setInterval((()=>{performance.now()-this._timestamp>=160&&this.clear()}),160))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};(0,i._)([(0,y.Cb)()],_n.prototype,"_timer",void 0),(0,i._)([(0,y.Cb)()],_n.prototype,"stationary",null),_n=(0,i._)([(0,v.j)("esri.views.2d.support.StationaryManager")],_n);const vn=e=>{let t=class extends e{constructor(...e){super(...e),this.fullOpacity=1,this.stateManager=new er({constraints:new Xi({view:this})}),this.goToManager=new Fi({view:this}),this.stationaryManager=new _n,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!1,labelsAnimationTime:0,labelCollisionsEnabled:!1},this.frameTask=new Li(this),this.inputManager=new yn({view:this}),this.viewEvents=new dt.CE(this),this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([(0,F.watch)((()=>this.viewpoint),(()=>this.stationaryManager.flip()),F.sync),this.on("resize",(e=>this.stateManager.resize(e.width,e.height)))])}get constraintsInfo(){return{lods:null,spatialReference:null}}get extent(){return this.stateManager?.extent??null}set extent(e){this.stateManager.extent=e}get state(){return this.stateManager.state}get interacting(){return this.navigating}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}set animation(e){const t=this._get("animation");if(e===t)return;if(t&&t.stop(),e!==this.animationManager.animation&&this.animationManager.stop(),!e||e.isFulfilled())return void this._set("animation",null);this._set("animation",e);const i=()=>{this.destroyed||e===this._get("animation")&&(this._set("animation",null),this.frameTask?.requestFrame())};e.when(i,i)}get constraints(){return this.stateManager?.constraints}set constraints(e){e.view=this;const t=this.stateManager.constraints;this.stateManager.constraints=e,t?.destroy()}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(e){this.stateManager.resizeAlign=e}get rotation(){return this.stateManager.rotation??0}set rotation(e){const{rotationEnabled:t}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=e,this.constraints.rotationEnabled=t}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(e){this.stateManager.viewpoint=e,this.frameTask.requestFrame()}on(e,t,i,r){return this.inputManager&&this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}goTo(e,t){return this.goToManager.goTo(e,t)}};return(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"animationManager",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"fullOpacity",void 0),(0,i._)([(0,y.Cb)()],t.prototype,"stateManager",void 0),(0,i._)([(0,y.Cb)()],t.prototype,"constraintsInfo",null),(0,i._)([(0,y.Cb)()],t.prototype,"extent",null),(0,i._)([(0,y.Cb)()],t.prototype,"goToManager",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"state",null),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"mapViewNavigation",void 0),(0,i._)([(0,y.Cb)()],t.prototype,"renderingOptions",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"interacting",null),(0,i._)([(0,y.Cb)()],t.prototype,"stationary",null),(0,i._)([(0,y.Cb)()],t.prototype,"animation",null),(0,i._)([(0,y.Cb)({type:Xi})],t.prototype,"constraints",null),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"inputManager",void 0),(0,i._)([(0,y.Cb)()],t.prototype,"padding",null),(0,i._)([(0,y.Cb)()],t.prototype,"resizeAlign",null),(0,i._)([(0,y.Cb)()],t.prototype,"rotation",null),(0,i._)([(0,y.Cb)({readOnly:!0})],t.prototype,"viewEvents",void 0),(0,i._)([(0,y.Cb)({type:K.Z})],t.prototype,"viewpoint",null),t=(0,i._)([(0,v.j)("esri.views.Viewport2DMixin")],t),t};var bn=n(18649);class wn{constructor(e){this._view=e,this.viewpoint=new K.Z({targetGeometry:new wi.Z,scale:0,rotation:0})}get view(){return this._view}get size(){const[e,t]=this._view.size;return Math.sqrt(e*e+t*t)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return(0,hi.j6)(this.center.spatialReference)}pixelsPerPanAtZoom(e){return 1/(e*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(e){return 1/(e*this.scaleToResolutionFactor)}pixelsPerRotate(){return this.size/2}compareTo(e,t){t.pan=(0,bn.TE)(this.center,e.center);let i=Math.abs(e.rotation-this.rotation);i=i>=180?360-i:i,t.rotate=(0,yt.Vl)(i),t.sourceZoom=this.scale,t.targetZoom=e.scale}interpolate(e,t,i){const{pan:r,rotate:n,zoom:s,zoomOffset:o}=i,{center:a}=this;a.spatialReference=e.center.spatialReference,a.x=(0,yt.t7)(e.center.x,t.center.x,r),a.y=(0,yt.t7)(e.center.y,t.center.y,r),this.viewpoint.scale=(0,yt.t7)(e.scale,t.scale+o,s);let l=e.rotation;const c=t.rotation;Math.abs(c-l)>=180&&(l+=360*(l<c?1:-1)),this.viewpoint.rotation=(0,yt.t7)(l,c,n)}copyFrom(e){(0,hi.JG)(this.viewpoint,e.viewpoint),this._view=e.view}}var xn=n(50590);const Tn=e=>e*e,Cn=e=>1-Tn(1-e),Sn=e=>e*e*e,En=e=>1-Sn(1-e),Mn=e=>e<.5?Sn(2*e)/2:(En(2*(e-.5))+1)/2,An=e=>e*e*e*e,Rn=e=>1-An(1-e),On=e=>e*e*e*e*e,Pn=e=>1-On(1-e),In=e=>1-Math.cos(e*Math.PI/2),Ln=e=>1-In(1-e),Dn=e=>2**(10*(e-1)),Nn=e=>1-Dn(1-e),Fn=e=>-(Math.sqrt(1-e*e)-1),Un=e=>1-Fn(1-e);function kn(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function zn(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const Bn=zn(kn(1),1),Vn=zn(kn(1),0),Hn=zn(kn(1),.5),Gn=zn(kn(2),1),jn=zn(kn(2),0),Zn=zn(kn(2),.5),qn=zn(kn(3),1),Wn=zn(kn(3),0),$n=zn(kn(3),.5),Yn=zn(kn(4),1),Jn=zn(kn(4),0),Xn=zn(kn(4),.5),Kn={linear:e=>e,"in-quad":Tn,"out-quad":Cn,"in-out-quad":e=>e<.5?Tn(2*e)/2:(Cn(2*(e-.5))+1)/2,"in-coast-quad":Bn,"out-coast-quad":Vn,"in-out-coast-quad":Hn,"in-cubic":Sn,"out-cubic":En,"in-out-cubic":Mn,"in-coast-cubic":Gn,"out-coast-cubic":jn,"in-out-coast-cubic":Zn,"in-quart":An,"out-quart":Rn,"in-out-quart":e=>e<.5?An(2*e)/2:(Rn(2*(e-.5))+1)/2,"in-coast-quart":qn,"out-coast-quart":Wn,"in-out-coast-quart":$n,"in-quint":On,"out-quint":Pn,"in-out-quint":e=>e<.5?On(2*e)/2:(Pn(2*(e-.5))+1)/2,"in-coast-quint":Yn,"out-coast-quint":Jn,"in-out-coast-quint":Xn,"in-sine":In,"out-sine":Ln,"in-out-sine":e=>e<.5?In(2*e)/2:(Ln(2*(e-.5))+1)/2,"in-expo":Dn,"out-expo":Nn,"in-out-expo":e=>e<.5?Dn(2*e)/2:(Nn(2*(e-.5))+1)/2,"in-circ":Fn,"out-circ":Un,"in-out-circ":e=>e<.5?Fn(2*e)/2:(Un(2*(e-.5))+1)/2,ease:e=>xn.LI.ease(e),"ease-in":e=>xn.LI.easeIn(e),"ease-out":e=>xn.LI.easeOut(e),"ease-in-out":e=>xn.LI.easeInOut(e)};class Qn{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}}const es={desiredScreenFlow:2,minDuration:(0,en.HA)(500),maxDuration:(0,en.HA)(8e3)},ts={...es,maxDuration:(0,en.HA)(4e3)};class is{constructor(e){this._createCamera=e,this.compared=new Qn,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:es.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new is(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,t,i){this.source!==e&&this.source.copyFrom(e),this.target!==t&&this.target.copyFrom(t),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow??es.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const t=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/t}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>(0,di.bn)()}get hasFov(){return Math.abs(this.compared.fov)>(0,di.bn)()}get hasRotate(){return this.compared.rotate>(0,di.bn)()}}let rs=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce(((e,t)=>(0,en._H)(e+t.time)),(0,en._H)(0))}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,r=0;const n=this.definition,s=this.segments.reduce(((e,t)=>e||t.definition.hasZoom),!1);for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(this.segmentInterpolateComponentsAt(a,0===a.time?0:e/a.time,t),n.hasPan&&!isNaN(t.pan)&&isFinite(n.compared.pan)?t.pan=(i+l.compared.pan*t.pan)/n.compared.pan:t.pan=1,n.hasRotate&&!isNaN(t.rotate)&&isFinite(n.compared.rotate)?t.rotate=(r+l.compared.rotate*t.rotate)/n.compared.rotate:t.rotate=1,s&&!isNaN(t.zoom)&&isFinite(l.compared.targetZoom)){const{sourceZoom:e,targetZoom:i}=l.compared,r=t.zoom*(i-e)+e,n=this.segments[0].definition.compared.sourceZoom,s=this.segments[this.segments.length-1].definition.compared.targetZoom,o=Math.abs(i-n)>Math.abs(e-n)?i:e;t.zoomOffset=o-s,t.zoom=(r-n)/(o-n)}else t.zoom=1;return t}e-=a.time,i+=l.compared.pan,r+=l.compared.rotate}}segmentInterpolateComponentsAt(e,t,i){e.interpolateComponentsAt(t,i)}};class ns{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,t=e.compared,i=t.sourceZoom,r=t.targetZoom;this._zoomSign=i>r?1:-1,this._panPixelsAtSource=t.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotate()+e.target.pixelsPerRotate())/2;this._rotatePixels=t.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,t=this.definition.compared.targetZoom,{hasZoom:i,hasPan:r,hasRotate:n}=this.definition;let s=0,o=0;i&&(r&&(s=(t/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(o=this._zoomSign*(Math.log(e/t)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const a=this.definition.desiredPixelFlow;if(i&&r&&n){const e=s+o+s*o;this._zoomPixelFlow=s*o/e*a,this._panPixelFlow=o/e*a,this._rotatePixelFlow=s/e*a}else if(i&&r){const e=1+s;this._zoomPixelFlow=s/e*a,this._panPixelFlow=1/e*a}else if(i&&n){const e=1+o;this._zoomPixelFlow=o/e*a,this._rotatePixelFlow=1/e*a}else if(r&&n){const e=this._panPixelsAtSource/this._rotatePixels,t=1+e;this._panPixelFlow=e/t*a,this._rotatePixelFlow=1/t*a}else r?this._panPixelFlow=a:i?this._zoomPixelFlow=a:n&&(this._rotatePixelFlow=a);if(this._time=(0,en._H)(Math.max(this.rotateTime,this.zoomTime,this.panTime)),this.fovTime>this._time){const e=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=e,this._panPixelFlow/=e,this._rotatePixelFlow/=e}}get rotateTime(){return this.definition.hasRotate?(0,en._H)(this._rotatePixels/this._rotatePixelFlow):(0,en._H)(0)}get zoomTime(){return this.definition.hasZoom?(0,en._H)(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):(0,en._H)(0)}get fovTime(){return this.definition.hasFov?(0,en._H)(Math.abs(this.definition.compared.fov)/ss):(0,en._H)(0)}get panTime(){if(!this.definition.hasPan)return(0,en._H)(0);if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,t=e*this._panPixelsAtSource;return(0,en._H)(Math.log(t*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return(0,en._H)(this._panPixelsAtSource/this._panPixelFlow)}_interpolateComponentsZoom(e){if(0===e||1===e)return e;if(this.definition.hasZoom){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(t*(t/i)**-e-t)/(i-t)}return e}_interpolateComponentsFov(e){if(0===e)return this.definition.segmentStart;if(1===e)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:t,segmentEnd:i}=this.definition;return t+e*(i-t)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(0===e||1===e)return e;if(this.definition.hasPan&&this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(t*e*this._time)-1))/(t*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),t.zoom=this._interpolateComponentsZoom(e),t.pan=this._interpolateComponentsPan(e),t.rotate=this._interpolateComponentsRotate(e),t.zoomOffset=0,t.fov=this._interpolateComponentsFov(e)}}const ss=(0,yt.Vl)(45);function os(e,t,i){const r=t-e.compared.sourceZoom,n=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+n)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*n)}function as(e,t,i){const r=1/t,n=Math.log(e.compared.sourceZoom*r),s=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*s*o*l*c-e.halfWindowSize*n*s*o*l+e.halfWindowSize*n*s*o*c/(a*a)}function ls(e,t,i){const r=t-e.compared.sourceZoom,n=1/r,s=1/t,o=Math.log(e.compared.sourceZoom*s),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function cs(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function us(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function hs(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function ds(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function ps(e,t,i){const r=Math.log(t/e.compared.targetZoom),n=1/e.desiredPixelFlow,s=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*n*s*a+e.halfWindowSize*r*n*s*l/(o*o)+e.halfWindowSize*n*s*a*l/t}function fs(e,t,i){const r=t-e.compared.targetZoom,n=1/r,s=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function ms(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function gs(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function ys(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function _s(e,t){let i=function(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?null!=t.maximumDistance?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}(e,t);const r={ascensionFactor:null!=t.ascensionFactor?t.ascensionFactor:.5,descensionFactor:null!=t.descensionFactor?t.descensionFactor:.5},n=0===r.ascensionFactor,s=0===r.descensionFactor,o=n?cs:os,a=n?us:as,l=n?hs:ls,c=s?ms:ds,u=s?gs:ps,h=s?ys:fs,d=t=>o(e,t,r)+function(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}(e,t,r)+c(e,t,r),p=t=>a(e,t,r)+function(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}(e,t,r)+u(e,t,r),f=t=>l(e,t,r)+function(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}(e,t,r)+h(e,t,r);let m=d(i);const g=function(e){const t=e.compared.sourceZoom-e.compared.targetZoom;if(0===t)return e.compared.pan*e.halfWindowSize/(e.desiredPixelFlow*e.halfWindowPanAtZoom(e.compared.sourceZoom));const i=Math.LN2*e.compared.pan,r=t,n=e.halfWindowPanAtZoom(r),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*n);return e.compared.sourceZoom<=e.compared.targetZoom?s*(i-n):s*(i+n)}(e);let y;const _=t.maximumIterations||20,v=null!=t.maximumDistance?t.maximumDistance:1/0;for(y=0;y<_;y++){const r=t.desiredSlope??1e-6;let n=p(i);Math.abs(n)>r&&(n+=r);const s=n/f(i);if(isNaN(s)||i>=v&&s<0){if(!isFinite(v))return null;i=v,m=d(i);break}if(i-=s,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const o=d(i);if(Math.abs(o-m)/m<=.005)break;m=o}return m>.7*g||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}class vs extends rs{constructor(e,t){super(),this._preallocSegments=[new ns,new ns,new ns],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,t)}update(e,t){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const i=t?.apex?_s(e,t.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i?this._updateWithApex(i,t?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,t,i){e.interpolateComponentsAt(t,i),e===this._ascensionSegment?i.zoom=Cn(i.zoom):e===this._descensionSegment&&(i.zoom=Tn(i.zoom))}_updateWithApex(e,t){const[i,r,n]=this._preallocSegments,s=t?.ascensionFactor??.5,o=Math.min(1-s,null!=t?.ascensionFactor&&null!=t.descensionFactor?t.descensionFactor:.5),a=1-s-o;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*s,i.definition.compared.rotate=this.definition.compared.rotate*s,i.definition.segmentEnd=s,i.update(),this._ascensionSegment=i,this.segments.push(i),a>0&&(r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.copyFrom(this.definition),r.definition.compared.sourceZoom=e,r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*a,r.definition.compared.rotate=this.definition.compared.rotate*a,r.definition.segmentStart=i.definition.segmentEnd,r.definition.segmentEnd=i.definition.segmentEnd+a,r.update(),this.segments.push(r)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*o,n.definition.compared.rotate=this.definition.compared.rotate*o,n.definition.segmentStart=s+a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}}const bs=new class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}};let ws=class{get time(){return this._time}get isLinear(){return 1===this.path.segments.length}constructor(e){this._time=(0,en.HA)(0),this._easing=Hn,this.definition=new is(e),this.path=new vs}update(e,t,i){this.definition.update(e,t,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings((0,en.up)(isFinite(this.path.time)?this.path.time:(0,en._H)(0)),i),this._easing=i.easing??(this._time>=1e3?Hn:Nn)}cameraAt(e,t){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,bs);t.interpolate(this.definition.source,this.definition.target,i)}_normalizedEasing(e){const t=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(i-t)}_applyTimeSettings(e,t){const i=null!=t.speedFactor?t.speedFactor:1,r=t.minDuration??es.minDuration/i,n=t.maxDuration??es.maxDuration/i;return null!=t.duration?(0,en.HA)(t.duration):(0,en.HA)(Math.min(Math.max(e/i,r),n))}};class xs{constructor(e){this._view=e,this._animation=new ws((()=>new wn(this._view))),this._current=new wn(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(e,t,i={}){(0,hi.JG)(this._current.viewpoint,e),(0,hi.JG)(this._source.viewpoint,e),(0,hi.JG)(this._target.viewpoint,t),this._animation.update(this._source,this._target,i)}applyRatio(e,t){this._animation.cameraAt(t,this._current),(0,hi.JG)(e,this._current.viewpoint)}}let Ts=class extends P.Z{constructor(e){super(e),this._animation=null,this._destinationViewState=new Oi,this.updateFunction=null,this.easing=Kn.ease,this.viewpoint=new K.Z({targetGeometry:new wi.Z,scale:0,rotation:0}),this._updateTask=(0,ue.A)({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new xs(e.view)}destroy(){this._updateTask=(0,m.hw)(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view.animation=e}animate(e,t,i){this.stop();const r=this.viewpoint;(0,hi.JG)(r,t);const n=e.target;this._transition.update(this.viewpoint,n,{apex:{maximumDistance:Math.min(64*Math.min(t.scale,n.scale),this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:i?.duration,maxDuration:"auto"===i?.animationMode?(0,en.HA)(1/0):i?.maxDuration??ts.maxDuration,speedFactor:i?.speedFactor,easing:("string"==typeof i?.easing?Kn[i.easing]:i?.easing)||this.easing}),"auto"===i?.animationMode&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=n,function(e,t,i,r){if(null!=t?.duration)return!0;const{time:n,isLinear:s}=e,o=t?.speedFactor||1;if(n>(t?.maxDuration??ts.maxDuration/o))return!1;if(s){const e=1.5,t=(0,ui.Ue)(),s=(0,$e.vW)(...r.toScreen(t,...i.center)),a=(0,$e.vW)(...i.toScreen(t,...r.center)),l=null!=a&&a.x>-1*i.size[0]&&a.x<(e+.5)*i.size[0]&&a.y>-1*i.size[1]&&a.y<(e+.5)*i.size[1],c=null!=s&&s.x>-1*r.size[0]&&s.x<(e+.5)*r.size[0]&&s.y>-1*r.size[1]&&s.y<(e+.5)*r.size[1];if(n>2e3/o&&!l&&!c)return!1}return!0}(this._transition.animation,i,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,n,{duration:(0,en.HA)(0)}));const s=()=>{this.animation===e&&this._updateTask&&("finished"===e.state&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinuous(e,t){this.stop(),this.updateFunction=t,this.viewpoint=e;const i=new Ni({target:e.clone()}),r=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(r,r),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){const t=this.animation;if(t&&t.state!==Ni.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime),this.animation?.update(this.viewpoint);else{const e=performance.now()-this._startTime,t=this._transition.duration,i=t>0?e/t:1,r=i>=1;this._transition.applyRatio(this.viewpoint,i),r&&this.animation?.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};(0,i._)([(0,y.Cb)()],Ts.prototype,"easing",void 0),(0,i._)([(0,y.Cb)()],Ts.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],Ts.prototype,"viewpoint",void 0),Ts=(0,i._)([(0,v.j)("esri.views.2d.AnimationManager")],Ts);const Cs=Ts;function Ss(){return Promise.all([n.e(19091).then(n.bind(n,19091)),Promise.all([n.e(10306),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(50959),n.e(33637),n.e(25002),n.e(2957),n.e(69979)]).then(n.bind(n,69979))])}const Es=()=>Ss().then((()=>Promise.all([n.e(10306),n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(50959),n.e(89183),n.e(33637),n.e(30446),n.e(10890)]).then(n.bind(n,10890)))),Ms=()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(58482),n.e(41860),n.e(69725),n.e(90265)]).then(n.bind(n,90265)))),As={"base-dynamic":()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(56454),n.e(6782)]).then(n.bind(n,6782)))),"base-tile":Es,"bing-maps":Es,catalog:()=>Ss().then((()=>Promise.all([n.e(57998),n.e(33822)]).then(n.bind(n,33822)))),"catalog-dynamic-group":()=>Ss().then((()=>Promise.all([n.e(57998),n.e(30436)]).then(n.bind(n,30436)))),"catalog-footprint":()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(58482),n.e(41860),n.e(69725),n.e(90265),n.e(18534)]).then(n.bind(n,18534)))),csv:Ms,"geo-rss":()=>Ss().then((()=>Promise.all([n.e(10306),n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(42738)]).then(n.bind(n,42738)))),feature:Ms,geojson:Ms,parquet:Ms,graphics:()=>Ss().then((()=>Promise.all([n.e(10306),n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(14372)]).then(n.bind(n,14372)))),group:()=>Ss().then((()=>Promise.all([n.e(57998),n.e(51212)]).then(n.bind(n,51212)))),imagery:()=>Ss().then((()=>Promise.all([n.e(10306),n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(5499),n.e(30446),n.e(16530),n.e(29151),n.e(27857)]).then(n.bind(n,27857)))),"imagery-tile":()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(5499),n.e(41782),n.e(16530),n.e(45613)]).then(n.bind(n,45613)))),kml:()=>Ss().then((()=>Promise.all([n.e(10306),n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(41782),n.e(2957),n.e(50439)]).then(n.bind(n,23001)))),"knowledge-graph":()=>Ss().then((()=>Promise.all([n.e(57998),n.e(36883)]).then(n.bind(n,36883)))),"link-chart":()=>Ss().then((()=>Promise.all([n.e(57998),n.e(36883)]).then(n.bind(n,36883)))),"knowledge-graph-sublayer":Ms,"map-image":()=>Ss().then((()=>Promise.all([n.e(10306),n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(89183),n.e(30446),n.e(93921)]).then(n.bind(n,93921)))),"map-notes":()=>Ss().then((()=>Promise.all([n.e(10306),n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(96857)]).then(n.bind(n,96857)))),media:()=>Ss().then((()=>Promise.all([n.e(10306),n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(50959),n.e(33637),n.e(7937)]).then(n.bind(n,12699)))),"ogc-feature":()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(58482),n.e(41860),n.e(69725),n.e(90265),n.e(7214)]).then(n.bind(n,7214)))),"open-street-map":Es,"oriented-imagery":Ms,route:()=>Ss().then((()=>Promise.all([n.e(10306),n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(63970),n.e(79431)]).then(n.bind(n,79431)))),stream:()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(58482),n.e(41860),n.e(69725),n.e(90265),n.e(14473)]).then(n.bind(n,14473)))),"subtype-group":()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(58482),n.e(41860),n.e(69725),n.e(90265),n.e(63912)]).then(n.bind(n,63912)))),tile:Es,"vector-tile":()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(99578),n.e(10376)]).then(n.bind(n,10376)))),video:()=>Ss().then((()=>Promise.all([n.e(10306),n.e(57998),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(30346)]).then(n.bind(n,30346)))),wcs:()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(5499),n.e(41782),n.e(16530),n.e(45613)]).then(n.bind(n,45613)))),"web-tile":Es,wfs:Ms,wms:()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(56454),n.e(44881)]).then(n.bind(n,44881)))),wmts:()=>Ss().then((()=>Promise.all([n.e(57998),n.e(10994),n.e(56454),n.e(84568)]).then(n.bind(n,84568)))),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,viewshed:null,voxel:null,scene:null,unknown:null,unsupported:null};const Rs=e=>null!=As[e.type],Os=e=>{const t=As[e.type];if(null==t)throw function(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new c.Z(`${i}:view-not-supported`,`${t} is not supported in 2D`)}(e);return t(e)};var Ps=n(64970),Is=n(87241),Ls=(n(17224),n(23656),n(39947)),Ds=n(24568),Ns=n(2290),Fs=n(88782);const Us={added:[],removed:[]},ks=new Set,zs=new Is.Z(0,0,0,0);class Bs extends L.Z{constructor(e){super(),this._tiles=new Map,this._index=(0,Ls.r)(9,(0,w.Z)("esri-csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}getIntersectingTiles(e){if(!e||0===(0,Ds.d_)(e)||0===(0,Ds.Cb)(e))return[];const t=function(e,t){const i=(0,Le.C5)(t);if(!i)return null;const[r,n]=i.valid;return e[2]>n?[(0,Ds.Ue)([e[0],e[1],n,e[3]]),(0,Ds.Ue)([r,e[1],r+e[2]-n,e[3]])]:e[0]<r?[(0,Ds.Ue)([r,e[1],e[2],e[3]]),(0,Ds.Ue)([n-(r-e[0]),e[1],n,e[3]])]:null}(e,this.tileScheme.spatialReference);return null!=t?[...new Set([...this.boundsIntersections(t[0]),...this.boundsIntersections(t[1])])]:this.boundsIntersections(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const i of e.added)if(!this.has(i)){const e=new Ns.n(this.tileScheme,i);this._tiles.set(i,e),this._index.insert(e),t.added.push(e)}for(const i of e.removed)if(this.has(i)){const e=this.get(i);this._tiles.delete(i),this._index.remove(e),t.removed.push(e)}this.tiles.length=0,this._tiles.forEach((e=>this.tiles.push(e))),(t.added.length||t.removed.length)&&this.emit("update",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:i,lodInfo:r}=t,{level:n}=r;if(i.length>0)for(const{row:e,colFrom:t,colTo:s}of i)for(let i=t;i<=s;i++){const t=zs.set(n,e,r.normalizeCol(i),r.getWorldForColumn(i)).id;if(ks.add(t),!this.has(t)){const e=new Ns.n(this.tileScheme,t);this._tiles.set(t,e),this._index.insert(e),this.tiles.push(e),Us.added.push(e)}}for(let e=this.tiles.length-1;e>=0;e--){const t=this.tiles[e];ks.has(t.id)||(this._tiles.delete(t.id),this.tiles.splice(e,1),this._index.remove(t),Us.removed.push(t))}(Us.added.length||Us.removed.length)&&this.emit("update",Us),Fs.Z.pool.release(t),ks.clear(),Us.added.length=0,Us.removed.length=0}}var Vs=n(41214),Hs=n(44158),Gs=n(88808),js=n(80085);function Zs(e,t,i,r,n,s){return o=>{if(o instanceof js.Z){if(o.layer===e)s?.();else{const t=e.allLayerViews.find((e=>e.layer===o.layer));t&&n?.(t)}r(Ws(o))}else if("layer"in o&&"element"in o);else if("subtype-sublayer"===o.type){const t=e.allLayerViews.find((e=>e.layer===o.parent));t&&i(o,t)}else{const i=e.allLayerViews.find((e=>e.layer===o));i&&t(i)}}}function qs(e,t){if(e)if((0,gt.TW)(e))for(const i of e)if((0,gt.TW)(i))for(const e of i)t(e);else t(i);else t(e)}function Ws(e){const t=e.getObjectId();return t?`${e.layer?.uid??e.sourceLayer?.uid??"MapView"}/${t}`:`"MapView/${e.uid}`}function $s({layer:e},t){"subtype-group"===e?.type&&e.sublayers.forEach((e=>{t(e)}))}var Ys=n(994);const Js={flipY:!0,premultipliedAlpha:!0};function Xs(e,t){const i=function(e,t,i,r){e.ignorePadding&&(r={left:0,right:0,top:0,bottom:0});let n=null;null!=e.width&&null!=e.height?n=[e.width,e.height]:null==e.width&&null!=e.height?n=[e.height,e.height]:null!=e.width&&null==e.height?n=[e.width,e.width]:null==e.width&&null==e.height&&(n=null);const s=i[0]-(r.left+r.right),o=i[1]-(r.top+r.bottom);let a,l,c=e.area||{x:0,y:0,width:s,height:o};if(n){const e=s/o,t=n[0]/n[1];if(t>e){const e=c.width/t;c={x:c.x,y:Math.round(c.y+(c.height-e)/2),width:c.width,height:Math.round(e)}}else{const e=c.height*t;c={x:Math.round(c.x+(c.width-e)/2),y:c.y,width:Math.round(e),height:c.height}}}else n=[c.width,c.height];return n[0]>c.width?(a=Math.min(n[0]/c.width,t),l=n[0]/c.width/a):(a=1,l=n[0]/c.width),{cropArea:{x:Math.round((c.x+r.left)*a),y:Math.round((c.y+r.top)*a),width:Math.round(c.width*a),height:Math.round(c.height*a)},outputScale:l,resolutionScale:a}}(t||{},function(e,t){return Math.min(4,(0,Ys.getMaximumResolutionScale)(t,Math.min(4096,e.context.parameters.maxTextureSize)))}(e.stage,e.size),e.size,e.padding),r=function(e={},t){if(!e.layers)return;const i=[];return e.layers.forEach((e=>{const r=t.find((t=>t.layer.id===e.id));r?.container&&i.push(r.container)})),i}(t,e.allLayerViews);return e.stage.takeScreenshot(i,r,e.backgroundColor,t?.rotation)}var Ks=n(45479),Qs=n(35119);function eo(e){const t=(0,Qs.h)();return t.available?"3d"===e&&t.majorPerformanceCaveat?new c.Z("webgl:major-performance-caveat-detected",`Your WebGL implementation (${t.unmaskedRenderer}) doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.`):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?null:new c.Z("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new c.Z("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new c.Z("webgl:required","WebGL2 is required but not supported.",(new Error).stack)}const to="esri-component";let io=class extends P.Z{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(to),t&&t.classList.remove(to),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),(0,le.L)(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};(0,i._)([(0,y.Cb)()],io.prototype,"id",null),(0,i._)([(0,y.Cb)()],io.prototype,"node",null),(0,i._)([(0,D.p)("node")],io.prototype,"castNode",null),(0,i._)([(0,y.Cb)({readOnly:!0})],io.prototype,"widget",void 0),io=(0,i._)([(0,v.j)("esri.views.ui.Component")],io);const ro=io;var no=n(87090),so=n(3368),oo=n(54956),ao=n(8108);const lo={left:0,top:0,bottom:0,right:0},co={bottom:30,top:15,right:15,left:15},uo="esri-ui",ho={ui:uo,corner:`${uo}-corner`,innerContainer:`${uo}-inner-container`,manualContainer:`${uo}-manual-container`,cornerContainer:`${uo}-corner-container`,topLeft:`${uo}-top-left`,topRight:`${uo}-top-right`,bottomLeft:`${uo}-bottom-left`,bottomRight:`${uo}-bottom-right`};function po(e){return 0===e?"0":`${e}px`}function fo(e){const t="object"==typeof e&&null!==e&&Object.getPrototypeOf(e);return null!==t&&t!==Object.prototype||!("component"in e||"index"in e||"position"in e)?null:e}function mo(e,{top:t,bottom:i,left:r,right:n}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=n}let go=class extends L.Z.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=(0,ao.Kd)(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&mo(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&mo(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([(0,F.watch)((()=>[this.view?.padding,this.container]),this._applyViewPadding,F.initial),(0,F.watch)((()=>this.padding),this._applyUIPadding,F.initial),(0,F.watch)((()=>[this.container,this._locale]),(([e,t])=>{e&&e.setAttribute("lang",t)}),F.initial),(0,ao.qe)((e=>{this._locale=e}))])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(ho.ui),(0,so.V$)(e),this._attachContainers(e)),t&&(t.classList.remove(ho.ui),mo(t,{top:"",bottom:"",left:"",right:""}),t.textContent=""),this._set("container",e))}get height(){const e=this.view?.height??0;if(0===e)return e;const t=this._getViewPadding(),{top:i,bottom:r}=t;return Math.max(e-i-r,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:{...co,...e}}get width(){const e=this.view?.width??0;if(0===e)return e;const t=this._getViewPadding(),{left:i,right:r}=t;return Math.max(e-i-r,0)}add(e,t){let i,r,n;if(Array.isArray(e))return void e.forEach((e=>this.add(e,t)));const s=fo(e);s&&({index:i,position:t,component:e,key:r}=s),t&&"object"==typeof t&&({index:i,key:r,position:t,internal:n}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r,n)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map((e=>this.remove(e,t)));const i=this._find(e);if(i){if(this._componentMap.has(i)&&this._componentMap.get(i)?.key!==t)return;const e=this._components.indexOf(i);return i.node.parentNode?.removeChild(i.node),this._componentMap.delete(i),i.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(e,1)[0]}}empty(e,t={removeInternal:!1}){if(Array.isArray(e)){for(const i of e)this.empty(i,t);return}const i=this._positionNameToContainerLookup[e??"manual"],r=Array.prototype.slice.call(i.children).map((e=>this._findByNode(e))).filter((e=>null!=e&&(!this._componentMap.get(e)?.internal||t.removeInternal)));for(const e of r)this.remove(e)}move(e,t){if(Array.isArray(e)&&e.forEach((e=>this.move(e,t))),!e)return;let i;const r=fo(e)||fo(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const n=this.remove(e);n&&this.add(n,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getComponents(e,t={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap((e=>this._getComponentsAtPosition(e,t))):this._getComponentsAtPosition(e,t):this._components.filter((e=>t.includeInternal||!this._componentMap.get(e)?.internal)).map((({widget:e,node:t})=>e??t))}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r,n){e instanceof ro||(e=new ro({node:e}));const{widget:s}=e;null!=s&&s instanceof P.Z&&s.addHandles((0,N.kB)((()=>{queueMicrotask((()=>this.remove(e)))})),this._removeWidgetHandleKey),this._place({component:e,position:t,index:i}),this._components.push(e),this._componentMap.set(e,{key:r,internal:n})}_find(e){return e?e instanceof ro?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??lo}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(ho.innerContainer,ho.cornerContainer);const t=document.createElement("div");t.classList.add(ho.innerContainer,ho.manualContainer);const i=document.createElement("div");i.classList.add(ho.topLeft,ho.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(ho.topRight,ho.corner),e.appendChild(r);const n=document.createElement("div");n.classList.add(ho.bottomLeft,ho.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(ho.bottomRight,ho.corner),e.appendChild(s),this._innerContainer=e,this._manualContainer=t;const o=(0,oo.dZ)();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":n,"bottom-right":s,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?s:n,"bottom-trailing":o?n:s},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.position??"manual",{component:i,index:r}=e,n=this._positionNameToContainerLookup[t],s=null!=r&&r>-1;if(function(e){return e&&!e._started&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(i.widget)&&i.widget.startup(),!s)return void n.appendChild(i.node);const o=Array.from(n.children);if(0===r){const{firstChild:e}=n;return void(e?e.parentNode?.insertBefore(i.node,e):n.appendChild(i.node))}if(r>=o.length)return void n.appendChild(i.node);const a=o[r];a.parentNode?.insertBefore(i.node,a)}_toPixelPosition(e){return{top:po(e.top),left:po(e.left),right:po(e.right),bottom:po(e.bottom)}}_findByComponent(e){return this._components.find((t=>t===e))??null}_findById(e){return this._components.find((({id:t})=>t===e))??null}_findByNode(e){return this._components.find((({node:t})=>t===e))??null}_getComponentsAtPosition(e,t){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map((e=>this._findByNode(e))).filter(Xe.pC).filter((e=>t.includeInternal||!this._componentMap.get(e)?.internal)).map((({widget:e,node:t})=>e??t))}};(0,i._)([(0,y.Cb)()],go.prototype,"_locale",void 0),(0,i._)([(0,y.Cb)()],go.prototype,"container",null),(0,i._)([(0,y.Cb)()],go.prototype,"height",null),(0,i._)([(0,y.Cb)({value:co})],go.prototype,"padding",null),(0,i._)([(0,D.p)("padding")],go.prototype,"castPadding",null),(0,i._)([(0,y.Cb)()],go.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],go.prototype,"width",null),go=(0,i._)([(0,v.j)("esri.views.ui.UI")],go);const yo=go;var _o=n(35679),vo=n(39536),bo=n(23229);function wo(e,t){return e&&"copyright"in e&&(!t||"function"==typeof e.originOf&&"user"===e.originOf("copyright"))}function xo(e,t,i){i&&t&&(e.find((e=>e.layerView===t&&e.text===i))||e.push({text:i,layerView:t}))}const To=[];let Co=class extends P.Z{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new o.Z,this.view=null,this._allLayerViewsChange=e=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const t=this.view?.allLayerViews;t&&(this.addHandles(t.map((e=>(0,F.watch)((()=>[e.suspended,e.layer?.attributionVisible]),(()=>this._updateAttributionItems())))).toArray(),"suspension"),t.forEach((e=>{"esri.views.3d.layers.Tiles3DLayerView3D"===e.declaredClass&&this.addHandles(e.on("visible-geometry-changed",(()=>this._updateAttributionItems())),"visible-geometry-changed")}))),e?.removed&&e.removed.forEach((e=>{this._pendingAttributions.delete(e),this._fetchedAttributionData.delete(e)})),this._updateAttributionItems()},this.addHandles([(0,F.on)((()=>this.view?.allLayerViews),"change",(e=>this._allLayerViewsChange(e)),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),(0,F.when)((()=>!0===this.view?.stationary),(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,t=e?.allLayerViews;if(To.length=0,!e||!t)return void this._clear();t.forEach((t=>{if(t.suspended||!t.layer?.attributionVisible)return;const i=t.layer;if(wo(i,"user"))return void xo(To,t,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(t)){const r=this._fetchedAttributionData.get(t);return void(r?xo(To,t,this._getDynamicAttribution(r,e,i)):wo(i)&&xo(To,t,i.copyright))}return void this._fetchAttributionData(t)}const r="portalItem"in i?i.portalItem?.accessInformation:void 0;xo(To,t,r||i.copyright)}));const i=t.find((e=>"integrated-mesh-3dtiles"===e.layer?.type));if(this.view&&i){const e=(0,bo.WM)(this.view);if(e){const t=e.getAttributionText();for(let e=0;e<t.length;++e)xo(To,i,t[e])}}(function(e,t){return e.length!==t.length||e.some(((e,i)=>e.text!==t[i].text))})(this.items,To)&&(this.items.removeAll(),this.items.addMany(To)),To.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await(0,be.q6)(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,function(e){return"bing-maps"===e.type}(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let e=0;e<i.length;e++){const n=i[e],s=n.coverageAreas;if(!s)return;for(const i of s){const s=i.bbox,o=i.zoomMin-(t&&i.zoomMin?1:0),a=i.zoomMax-(t&&i.zoomMax?1:0),l=new Oe.Z({xmin:s[1],ymin:s[0],xmax:s[3],ymax:s[2],spatialReference:Ie.Z.WGS84}),c={extent:(0,vo.$)(l),attribution:n.attribution||"",score:null!=i.score?i.score:100,id:e};for(let e=o;e<=a;e++)r[e]??=[],r[e].push(c)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:n}=t;let s=i.tileInfo?.scaleToZoom(n)??0;if(s=Math.min(e.maxKey??0,Math.round(s)),!r||null==s||s<=-1)return"";const o=e[s],a=(0,vo.iV)(r.center.clone().normalize(),Ie.Z.WebMercator),l=new Set;return o?o.filter((e=>{const t=e.id,i=!l.has(t)&&a&&e.extent&&(0,Bi.aV)(e.extent,a);return i&&l.add(t),i})).sort(((e,t)=>t.score-e.score||e.objectId-t.objectId)).map((e=>e.attribution)).join(", "):""}};(0,i._)([(0,y.Cb)({readOnly:!0,type:o.Z})],Co.prototype,"items",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Co.prototype,"state",null),(0,i._)([(0,y.Cb)()],Co.prototype,"view",void 0),Co=(0,i._)([(0,v.j)("esri.widgets.Attribution.AttributionViewModel")],Co);const So=Co;var Eo=n(49590),Mo=n(92165),Ao=n(34236),Ro=n(26451);const Oo="esri-attribution",Po={base:Oo,poweredBy:`${Oo}__powered-by`,sources:`${Oo}__sources`,open:`${Oo}--open`,sourcesOpen:`${Oo}__sources--open`,link:`${Oo}__link`};let Io=class extends _o.Z{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver((e=>e.forEach((({target:e})=>this._checkSourceTextOverflow(e))))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new So}initialize(){this.addHandles((0,F.on)((()=>this.viewModel?.items),"change",(()=>this.scheduleRender())))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce(((e,t)=>(e.includes(t.text)||e.push(t.text),e)),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Po.open]:this._isOpen};return(0,Ro.u)("div",{bind:this,class:this.classes(Po.base,Eo.z.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return(0,Ro.u)("div",{class:Po.poweredBy},"Powered by"," ",(0,Ro.u)("a",{class:Po.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?0:void 0,{attributionText:r}=this,n={[Po.sourcesOpen]:e,[Eo.z.interactive]:t};return(0,Ro.u)("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Po.sources,n),innerHTML:r,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:n}=e,s=n>r,o=this._attributionTextOverflowed!==s;if(this._attributionTextOverflowed=s,o&&(t=!0),this._isOpen){const e=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,e&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};(0,i._)([(0,y.Cb)()],Io.prototype,"_isOpen",void 0),(0,i._)([(0,y.Cb)()],Io.prototype,"_isInteractive",null),(0,i._)([(0,y.Cb)()],Io.prototype,"_attributionTextOverflowed",void 0),(0,i._)([(0,y.Cb)()],Io.prototype,"_prevSourceNodeHeight",void 0),(0,i._)([(0,y.Cb)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Io.prototype,"attributionText",null),(0,i._)([(0,y.Cb)()],Io.prototype,"icon",null),(0,i._)([(0,y.Cb)()],Io.prototype,"itemDelimiter",void 0),(0,i._)([(0,y.Cb)()],Io.prototype,"label",null),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/widgets/Attribution/t9n/Attribution")],Io.prototype,"messages",void 0),(0,i._)([(0,y.Cb)()],Io.prototype,"view",null),(0,i._)([(0,y.Cb)({type:So})],Io.prototype,"viewModel",void 0),(0,i._)([(0,Mo.h)()],Io.prototype,"_toggleState",null),Io=(0,i._)([(0,v.j)("esri.widgets.Attribution")],Io);const Lo=Io;var Do=n(9391);var No=n(68266);let Fo=class extends((0,No.Z)(P.Z)){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._watchForView(F.initial)}destroy(){this.view=null}get canShowNorth(){return function(e){return e?.spatialReference?.isWebMercator||e?.spatialReference?.isGeographic||!1}(this.view)}get state(){return!this.view?.ready||"2d"===this.view.type&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&("2d"===this.view?.type?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:(0,Do.O)()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){null!=e&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this._set("orientation",{x:0,y:0,z:t})}_updateRotationWatcher(e){this.removeAllHandles(),this._watchForView(),e&&this.addHandles("2d"===e.type?(0,F.watch)((()=>e?.rotation),this._updateForRotation,F.initial):(0,F.watch)((()=>e?.camera),this._updateForCamera,F.initial))}_watchForView(e){this.addHandles((0,F.watch)((()=>this.view),this._updateRotationWatcher,e))}};(0,i._)([(0,y.Cb)({readOnly:!0})],Fo.prototype,"canShowNorth",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Fo.prototype,"orientation",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Fo.prototype,"state",null),(0,i._)([(0,y.Cb)()],Fo.prototype,"view",void 0),Fo=(0,i._)([(0,v.j)("esri.widgets.Compass.CompassViewModel")],Fo);const Uo=Fo,ko="esri-compass",zo={base:ko,iconContainer:`${ko}__icon-container`};var Bo=n(45095);let Vo=class extends _o.Z{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new Uo,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=e=>({transform:`rotateZ(${e.z}deg)`})}loadDependencies(){return(0,Bo.h)({button:()=>n.e(14625).then(n.bind(n,14625)),icon:()=>n.e(45748).then(n.bind(n,45748))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"rotation"===this.viewModel.state?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,{messages:i}=this;return(0,Ro.u)("div",{class:this.classes(zo.base,Eo.z.widget)},(0,Ro.u)("calcite-button",{class:Eo.z.widgetButton,disabled:"disabled"===t,kind:"neutral",label:i.reset,onclick:this._reset,round:!0,scale:"s",title:i.reset},(0,Ro.u)("div",{"aria-hidden":"true",class:zo.iconContainer,title:i.reset},(0,Ro.u)("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};(0,i._)([(0,y.Cb)()],Vo.prototype,"goToOverride",null),(0,i._)([(0,y.Cb)()],Vo.prototype,"icon",null),(0,i._)([(0,y.Cb)()],Vo.prototype,"label",null),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/widgets/Compass/t9n/Compass")],Vo.prototype,"messages",void 0),(0,i._)([(0,y.Cb)()],Vo.prototype,"view",null),(0,i._)([(0,y.Cb)({type:Uo})],Vo.prototype,"viewModel",void 0),Vo=(0,i._)([(0,v.j)("esri.widgets.Compass")],Vo);const Ho=Vo,Go="esri-navigation-toggle",jo=Go,Zo=`${Go}--horizontal`;let qo=class extends P.Z{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles((0,F.when)((()=>this.view?.navigation?.actionMap),(()=>this._updateNavigationActionMap())))}destroy(){this.view=null}get state(){return this.view?.ready&&"3d"===this.view?.type?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._updateNavigationActionMap()}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate")}_updateNavigationActionMap(){const e=this.view?.navigation?.actionMap;if(!e)return;const t="pan"===this._navigationMode;e.dragPrimary=t?"pan":"rotate",e.dragSecondary=t?"rotate":"pan"}};(0,i._)([(0,y.Cb)({readOnly:!0})],qo.prototype,"state",null),(0,i._)([(0,y.Cb)()],qo.prototype,"_navigationMode",void 0),(0,i._)([(0,y.Cb)()],qo.prototype,"view",void 0),qo=(0,i._)([(0,v.j)("esri.widgets.NavigationToggle.NavigationToggleViewModel")],qo);const Wo=qo;let $o=class extends _o.Z{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new Wo,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{const e="pan"===this.viewModel?.navigationMode?this._rotateButton:this._panButton;(0,oo.kW)(e),this.toggle()}}loadDependencies(){return(0,Bo.h)({button:()=>n.e(14625).then(n.bind(n,14625))})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e="disabled"===this.viewModel?.state,t="pan"===this.viewModel?.navigationMode,i=this.messages.toggle;return(0,Ro.u)("div",{class:this.classes(jo,Eo.z.widget,{[Zo]:"horizontal"===this.layout})},(0,Ro.u)("calcite-button",{afterCreate:e=>{this._panButton=e},appearance:t?"outline-fill":"solid",class:Eo.z.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:i,onclick:this._toggle,tabIndex:t?void 0:-1,title:i}),(0,Ro.u)("calcite-button",{afterCreate:e=>{this._rotateButton=e},appearance:t?"solid":"outline-fill",class:Eo.z.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:i,onclick:this._toggle,tabIndex:t?-1:void 0,title:i}))}};(0,i._)([(0,y.Cb)()],$o.prototype,"icon",null),(0,i._)([(0,y.Cb)()],$o.prototype,"label",null),(0,i._)([(0,y.Cb)({value:"vertical"})],$o.prototype,"layout",null),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],$o.prototype,"messages",void 0),(0,i._)([(0,y.Cb)()],$o.prototype,"view",null),(0,i._)([(0,y.Cb)({type:Wo})],$o.prototype,"viewModel",void 0),$o=(0,i._)([(0,v.j)("esri.widgets.NavigationToggle")],$o);const Yo=$o;let Jo=class extends P.Z{get canZoomIn(){const e=this.view?.ready;if(!e)return!1;const t=this.view?.constraints?.effectiveMaxScale;return 0===t||this._scale>t}get canZoomOut(){const{view:e}=this,t=e?.ready;if(!t)return!1;const i=e.constraints?.effectiveMinScale;return 0===i||this._scale<i}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};(0,i._)([(0,y.Cb)({readOnly:!0})],Jo.prototype,"canZoomIn",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Jo.prototype,"canZoomOut",null),(0,i._)([(0,y.Cb)()],Jo.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],Jo.prototype,"_scale",null),Jo=(0,i._)([(0,v.j)("esri.widgets.Zoom.ZoomConditions2D")],Jo);const Xo=Jo;let Ko=class extends P.Z{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};(0,i._)([(0,y.Cb)({readOnly:!0})],Ko.prototype,"canZoomIn",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Ko.prototype,"canZoomOut",null),(0,i._)([(0,y.Cb)()],Ko.prototype,"view",void 0),Ko=(0,i._)([(0,v.j)("esri.widgets.Zoom.ZoomConditions3D")],Ko);const Qo=Ko;let ea=class extends P.Z{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return null!=this._zoomConditions&&this._zoomConditions.canZoomIn}get canZoomOut(){return null!=this._zoomConditions&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?"2d"===e.type?this._zoomConditions=new Xo({view:e}):"3d"===e.type&&(this._zoomConditions=new Qo({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){const e=this.view;this.canZoomIn&&e&&("2d"===e.type?e.mapViewNavigation.zoomIn():(0,g.R8)(e.goTo({zoomFactor:2})))}zoomOut(){const e=this.view;this.canZoomOut&&e&&("2d"===e.type?e.mapViewNavigation.zoomOut():(0,g.R8)(e.goTo({zoomFactor:.5})))}};(0,i._)([(0,y.Cb)()],ea.prototype,"_zoomConditions",void 0),(0,i._)([(0,y.Cb)()],ea.prototype,"canZoomIn",null),(0,i._)([(0,y.Cb)()],ea.prototype,"canZoomOut",null),(0,i._)([(0,y.Cb)({readOnly:!0})],ea.prototype,"state",null),(0,i._)([(0,y.Cb)()],ea.prototype,"view",null),ea=(0,i._)([(0,v.j)("esri.widgets.Zoom.ZoomViewModel")],ea);const ta=ea,ia="esri-zoom",ra="esri-zoom--horizontal";let na=class extends _o.Z{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new ta,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return(0,Bo.h)({button:()=>n.e(14625).then(n.bind(n,14625))})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[ra]:"horizontal"===this.layout},{canZoomIn:t,canZoomOut:i}=this.viewModel,{zoomIn:r,zoomOut:n}=this.messages;return(0,Ro.u)("div",{class:this.classes(ia,Eo.z.widget,e)},(0,Ro.u)("calcite-button",{class:Eo.z.widgetButton,disabled:!t,iconStart:"plus",kind:"neutral",label:r,onclick:this.zoomIn,title:r}),(0,Ro.u)("calcite-button",{class:Eo.z.widgetButton,disabled:!i,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};(0,i._)([(0,y.Cb)()],na.prototype,"icon",null),(0,i._)([(0,y.Cb)()],na.prototype,"label",null),(0,i._)([(0,y.Cb)({value:"vertical"})],na.prototype,"layout",null),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/widgets/Zoom/t9n/Zoom")],na.prototype,"messages",void 0),(0,i._)([(0,y.Cb)()],na.prototype,"view",null),(0,i._)([(0,y.Cb)({type:ta})],na.prototype,"viewModel",void 0),na=(0,i._)([(0,v.j)("esri.widgets.Zoom")],na);const sa=na;let oa=class extends yo{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach((t=>{const i=this._find(t)?.widget;(function(e){return void 0!==e?.view})(i)&&(i.view=e)}))},this._componentsWatcher=(e,t)=>{this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([(0,F.watch)((()=>this.components),this._componentsWatcher,F.initial),(0,F.watch)((()=>this.view),this._updateViewAwareWidgets,F.initial)])}_add(e,t,i,r,n){let s=e;if("string"==typeof e&&this._defaultPositionLookup[e]){if(this._find(e))return;s=this._createComponent(e)}super._add(s,t,i,r,n)}_removeComponents(e){e.forEach((e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())}))}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(e){this.constructed&&e.forEach((e=>this.add(this._createComponent(e),this._defaultPositionLookup[e])))}_createComponent(e){const t=this._createWidget(e);return new ro({id:e,node:t})}_createWidget(e){const t=this.view;switch(e){case"attribution":return new Lo({view:t});case"compass":return new Ho({view:t});case"navigation-toggle":return new Yo({view:t});case"zoom":return new sa({view:t})}}};(0,i._)([(0,y.Cb)()],oa.prototype,"components",void 0),oa=(0,i._)([(0,v.j)("esri.views.ui.DefaultUI")],oa);const aa=oa;let la=class extends aa{constructor(e){super(e),this.components=["attribution","zoom"]}};(0,i._)([(0,y.Cb)()],la.prototype,"components",void 0),la=(0,i._)([(0,v.j)("esri.views.ui.2d.DefaultUI2D")],la);const ca=la;var ua,ha=n(96726);let da=ua=class extends u.Z{constructor(e){super(e),this.color=new s.Z([0,0,0,1])}clone(){return new ua((0,h.d9)({color:this.color}))}};(0,i._)([(0,y.Cb)({type:s.Z,json:{write:!0}})],da.prototype,"color",void 0),da=ua=(0,i._)([(0,v.j)("esri.webmap.background.ColorBackground")],da);const pa=da;let fa,ma,ga,ya,_a,va,ba;let wa=class extends(vn(ae(Ce(ve(ai))))){constructor(e){super(e),this._magnifierView=null,this._gridView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new I.Z({getCollections:()=>[this.basemapView?.baseLayerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.graphicsView=null,this.labelManager=null,this.navigation=new qt({actionMap:new Ht({dragTertiary:"none"})}),this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.floors=new o.Z,this.grid=null,this.map=null,this.spatialReferenceLocked=!1,this.timeline=new Ks.T,this.type="2d",this.view2dType=null,this.ui=new ca,this.test={takeScreenshot:async e=>async function(e,t){const i=await Xs(e,t);return(0,Ys.encodeData)(i,Js)}(this._getScreenshotView(e),e)},this.padding={top:0,right:0,bottom:0,left:0},(0,Q.j2)()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=(0,m.SC)(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new Bs(this.featuresTilingScheme)}get constraintsInfo(){const e=this.defaultsFromMap?.tileInfo,t=this.spatialReference;return{lods:e?.spatialReference?.equals(t)?e.lods:null,spatialReference:t}}get initialExtentRequired(){if(!this.stateManager)return!1;const{scale:e,constraints:t,center:i,viewpoint:r,extent:n}=this;let s=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.viewpoint||n||(t?.effectiveLODs||(s=-1),i&&(0!==e||-1!==s)||null!=r?.targetGeometry&&("extent"===r.targetGeometry.type||r.scale)))}get defaultsFromMapSettings(){return{required:{extent:!1,heightModelInfo:!1,tileInfo:!0},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get scheduler(){return this.frameTask.scheduler}get typeSpecificPreconditionsReady(){const e=this._getDefaultViewpoint();if(!e)return!1;const t=e.targetGeometry,i=this.spatialReference;return(0,te.isLoadedOrLoadFor)(t.spatialReference,i)}get background(){return(0,ha.s)(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){return this.stateManager?.center??null}set center(e){this.stateManager.center=e}get highlightOptions(){return(0,Gs.A)(this)}set highlightOptions(e){(0,Gs.g)(this,e)}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get rendering(){return this.stage?.renderRequested??!1}get resolution(){return this.stateManager.resolution??0}get scale(){return this.stateManager?.scale??0}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get tileInfo(){return this.featuresTilingScheme?.tileInfo}get updating(){const e=!(!this.magnifier.visible||null===this.magnifier.position||!this._magnifierView?.updatingHandles.updating),t=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||!0===this.layerViewManager.updating||!0===this.labelManager.updating||!0===this.graphicsView.updating||this.allLayerViews.some((e=>!e.destroyed&&!("layerViews"in e)&&!0===e.updating))||e);if((0,w.Z)("esri-2d-log-updating")){const i=this.allLayerViews.reduce(((e,t)=>({...e,[`${t.layer.id}(${t.layer.type})`]:!t.destroyed&&!("layerViews"in t)&&t.updating})),{});console.log(`Updating MapView: ${t}\n-> Null LayerViewManager: ${!this.layerViewManager}\n-> Null LabelManager: ${!this.labelManager}\n-> Null GraphicsView: ${!this.graphicsView}\n-> layerViewManager.updating: ${this.layerViewManager?.updating}\n-> labelManager.updating: ${this.labelManager?.updating}\n-> graphicsView.updating: ${this.graphicsView?.updating}\n-> allLayerViews: ${JSON.stringify(i)}\n-> updatingMagnifier: ${e}\n`)}return t}get visibleArea(){const e=this.stateManager.visibleArea;return e?new ee.Z({rings:[e.map((e=>[e[0],e[1]]))],spatialReference:this.spatialReference}):e}get zoom(){return this.stateManager.zoom??-1}set zoom(e){this.stateManager.zoom=e}get navigating(){return this.mapViewNavigation?.interacting??!1}async hitTest(e,t){return async function(e,t,i){const r=(0,_t.Rw)(t)?(0,_t.s6)(e,t):t;if(!e.ready||isNaN(r.x)||isNaN(r.y))return{screenPoint:r,results:[]};let n=new Set;const s=new Set;let o=!1,a=null,l=null;i?.include?qs(i.include,Zs(e,(e=>{n.add(e),$s(e,(e=>s.add(e)))}),((e,t)=>{s.add(e),n.add(t)}),(e=>{a||(a=new Set),a.add(e)}),(e=>n.add(e)),(()=>o=!0))):(o=!0,n=new Set(e.allLayerViews),n.forEach((e=>{$s(e,(e=>s.add(e)))}))),i?.exclude&&qs(i.exclude,Zs(e,(e=>{n.delete(e),$s(e,(e=>s.delete(e)))}),(e=>s.delete(e)),(e=>{l||(l=new Set),l.add(e)})));const c=e.toMap(r),u=e.allLayerViews.filter((t=>!t.suspended&&n.has(t)&&t.clips.every((t=>(0,Hs.A)(e,t,r,c))))).reverse();let h=[...o?e.graphicsView.hitTest(c).map((e=>({type:"graphic",graphic:e,layer:null,mapPoint:c}))):[],...await Promise.all(u.map((e=>e.hitTest(c,r))).toArray())].filter(Xe.pC).flat().filter(Xe.pC);return h=h.filter((e=>"graphic"!==e.type||"subtype-group"!==e.layer?.type||s.has(e.graphic.layer))),a&&(h=h.filter((e=>!("graphic"in e)||!e.graphic||a?.has(Ws(e.graphic))))),l&&(h=h.filter((e=>!("graphic"in e)||!e.graphic||!l?.has(Ws(e.graphic))))),{screenPoint:r,results:h}}(this,e,t)}async takeScreenshot(e){return async function(e,t){const i=await Xs(e,t),{format:r,quality:n}=(0,Ys.getFormatAndQuality)(t?.format,t?.quality);return(0,Ys.encode)(i,{format:r,quality:n},Js)}(this._getScreenshotView(e),e)}toMap(e){if(!this.ready)return null;const t=(0,_t.Rw)(e)?(0,_t.s6)(this,e):e;return this.stateManager.toMap(t)}toScreen(e,t){return this.stateManager.toScreen(e,t)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise((e=>{this.ready?e(this):this._resolveWhenReady.push(e)}))}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties.spatialReference||this.defaultsFromMap?.spatialReference||null}getDefaultTimeZone(){return(0,ha.s)(this.map)?this.map.initialViewProperties.timeZone:null}getDefaultTimeExtent(){return(0,ha.s)(this.map)?this.map.initialViewProperties.timeExtent:null}hasLayerViewModule(e){return Rs(e)}importLayerView(e){return Os(e)}pixelSizeAt(){return this.ready?this.resolution:(f.Z.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(e){const t=this.toMap(e),i=await this.hitTest(e),r=this.allLayerViews.toArray().filter((i=>i.clips.every((i=>(0,Hs.A)(this,i,e,t))))).reverse(),n=new globalThis.Map(r.map((e=>[e.layer.uid,e]))),s=[];let o=0,a=0;for(;o<i.results.length||a<r.length;){const e=i.results.at(o);if(e&&"graphic"!==e.type){++o;continue}const l=n.get((e?.layer??e?.graphic.layer)?.uid);if((!e||l)&&a<r.length&&r.at(a)!==l){const e=r.at(a);"fetchPopupFeaturesAtLocation"in e&&s.push({mapPoint:t,layerView:e}),++a}else e&&(s.push({graphic:e.graphic,layerView:l}),++o)}return{hits:s,location:t}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let e=eo(this.type);if((0,w.Z)("safari")&&(0,w.Z)("safari")<9&&(e=new c.Z("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:(0,w.Z)("safari")})),null!=e)throw f.Z.getLogger(this).warn("#validate()",e.message),e}loadAsyncDependencies(){return async function(){const[,{GraphicsView2D:e,GraphicContainer:t,LabelManager:i,MapViewNavigation:r,MagnifierView2D:s,GridView2D:o,Stage:a}]=await Promise.all([n.e(19091).then(n.bind(n,19091)),Promise.all([n.e(10306),n.e(10994),n.e(95215),n.e(56454),n.e(76171),n.e(33712),n.e(89354),n.e(50959),n.e(33637),n.e(25002),n.e(2957),n.e(69979)]).then(n.bind(n,69979))]);ma=e,ga=t,ya=i,_a=r,va=s,ba=o,fa=a}()}_getDefaultViewpoint(){const{constraints:e,initialExtent:t,map:i,padding:r,size:n}=this;if(!e)return null;const s=i&&"initialViewProperties"in i?i.initialViewProperties:void 0,o=this.stateManager.getUserStartupOptions(this.size),a=s?.viewpoint,l=a?.targetGeometry?.extent??t,c=l?.center,u=a?.rotation??0,h=a?.scale||l&&(0,hi.EK)(l,[n[0]-r.left-r.right,n[1]-r.top-r.bottom]),d=o.center??c,p=o.rotation??u,f=o.scale??h;return d&&f?new K.Z({targetGeometry:d,scale:f,rotation:p}):null}_startup(){this.timeline.begin("MapView Startup");const e=this._getDefaultViewpoint();this.stateManager.startup(e,this.size,this.spatialReference,this.defaultsFromMap.extent?.center),this.graphics.owner=this;const t=new fa(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=t,this._magnifierView=new va,this._magnifierView.magnifier=this.magnifier,this._gridView=new ba;const i=new ya({view:this});this._set("labelManager",i);const r=new Cs({view:this});this._set("animationManager",r);const n=new _a({view:this,animationManager:r});this._set("mapViewNavigation",n),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",(()=>this._updateStageChildren())),t.on("webgl-error",(e=>this.fatalError=e.error)),(0,F.watch)((()=>this.stationary),(e=>t.stationary=e),F.syncAndInitial),(0,F.watch)((()=>this.background),(e=>{t.backgroundColor=e?.color,this._magnifierView.backgroundColor=e?.color}),F.syncAndInitial),(0,F.watch)((()=>this.magnifier),(e=>this._magnifierView.magnifier=e),F.syncAndInitial),(0,F.watch)((()=>this.grid),(e=>this._gridView.grid=e),F.syncAndInitial),(0,F.watch)((()=>this.renderingOptions),(e=>t.renderingOptions=e),F.syncAndInitial),(0,F.watch)((()=>this.highlights.items.map((e=>({name:e.name,options:{fillColor:e.color,haloColor:e.haloColor,fillOpacity:e.fillOpacity,haloOpacity:e.haloOpacity,haloWidth:e.haloWidth,haloBlur:e.haloBlur}})))),(()=>{t.highlightGradient=(0,Vs.GK)(t.highlightGradient,this.highlights.items)}),F.syncAndInitial),(0,F.watch)((()=>this.state.id),(()=>t.state=this.state),F.syncAndInitial)],"map-view"),this._updateStageChildren();const s=this._resolveWhenReady;this._resolveWhenReady=[],s.forEach((e=>e(this))),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._gridView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._gridView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach((e=>{this.stage.addChild(e.container)}));const e=this.graphicsView;this.stage.addChild(e.container),this.stage.addChild(this._magnifierView),this.stage.addChild(this._gridView)}_setupSpatialReferenceDependentProperties(){const e=new Ps.Z(ie.Z.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);const t=new ma({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new ga(e)});this._set("graphicsView",t)}_destroySpatialReferenceDependentProperties(){const e=this.graphicsView;this._set("graphicsView",null),e.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(e){const{allLayerViews:t,padding:i,size:r,stage:n}=this;return{allLayerViews:t,backgroundColor:e?.ignoreBackground?null:this.background?.color,padding:i,size:r,stage:n}}_spatialReferenceChanged(e){if(this.ready){this.frameTask.stop();for(const e of this.allLayerViews)e.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(e),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const e of this.allLayerViews)e.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};wa.type="2d",(0,i._)([(0,y.Cb)({constructOnly:!0})],wa.prototype,"deactivatedWebGLExtensions",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],wa.prototype,"debugWebGLExtensions",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"featuresTilingScheme",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"graphicsTileStore",null),(0,i._)([(0,y.Cb)()],wa.prototype,"graphicsView",void 0),(0,i._)([(0,y.Cb)()],wa.prototype,"constraintsInfo",null),(0,i._)([(0,y.Cb)()],wa.prototype,"initialExtentRequired",null),(0,i._)([(0,y.Cb)()],wa.prototype,"labelManager",void 0),(0,i._)([(0,y.Cb)({type:qt,nonNullable:!0})],wa.prototype,"navigation",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],wa.prototype,"renderCanvas",void 0),(0,i._)([(0,y.Cb)()],wa.prototype,"renderingOptions",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],wa.prototype,"supersampleScreenshotsEnabled",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"supportsGround",void 0),(0,i._)([(0,y.Cb)()],wa.prototype,"defaultsFromMapSettings",null),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"typeSpecificPreconditionsReady",null),(0,i._)([(0,y.Cb)({type:pa})],wa.prototype,"background",null),(0,i._)([(0,y.Cb)()],wa.prototype,"center",null),(0,i._)([(0,y.Cb)({type:o.Z})],wa.prototype,"floors",void 0),(0,i._)([(0,y.Cb)()],wa.prototype,"grid",void 0),(0,i._)([(0,y.Cb)({type:Rt.Z})],wa.prototype,"highlightOptions",null),(0,i._)([(0,y.Cb)()],wa.prototype,"map",void 0),(0,i._)([(0,y.Cb)()],wa.prototype,"padding",null),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"rendering",null),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"resolution",null),(0,i._)([(0,y.Cb)()],wa.prototype,"scale",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],wa.prototype,"spatialReferenceLocked",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"tileInfo",null),(0,i._)([(0,y.Cb)({type:Ks.T,readOnly:!0})],wa.prototype,"timeline",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"type",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"updating",null),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"view2dType",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"visibleArea",null),(0,i._)([(0,y.Cb)()],wa.prototype,"zoom",null),(0,i._)([(0,y.Cb)({readOnly:!0})],wa.prototype,"navigating",null),(0,i._)([(0,y.Cb)(),(0,D.p)((e=>e instanceof aa?e:(0,_.TJ)(ca,e)))],wa.prototype,"ui",void 0),wa=(0,i._)([(0,v.j)("esri.views.View2D")],wa);const xa=wa;let Ta=class extends xa{constructor(e){super(e),this.view2dType="map"}};(0,i._)([(0,y.Cb)({readOnly:!0})],Ta.prototype,"view2dType",void 0),Ta=(0,i._)([(0,v.j)("esri.views.MapView")],Ta);const Ca=Ta;var Sa=n(33098),Ea=n(98722),Ma=n(17321),Aa=n(65943),Ra=n(95620);function Oa(e,t){const i=(0,Ra.vw)(e),r=(0,Ra.vw)(t),n=i.store,s=r.store,o=r.metadata;for(const t in o){const i=o[t],r=n.originOf(t),a=s.originOf(t);if(!i.readOnly&&a!==Aa.s3.DEFAULTS)if(r===Aa.s3.DEFAULTS)e.set(t,s.get(t));else{const e=n.get(t),i=s.get(t);e&&i&&i instanceof P.Z&&e instanceof P.Z&&e instanceof i.constructor&&Oa(e,i)}}}var Pa=n(81095),Ia=n(72884),La=n(57022),Da=n(96739),Na=n(47190),Fa=n(68577),Ua=n(52064),ka=n(28521),za=n(56397),Ba=n(54565);let Va=class extends L.Z.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=Ba.zl}initialize(){this.view.basemapTerrain.on("elevation-change",(()=>this.emit("changed",{})))}get extent(){const e=this.view.basemapTerrain;if(null==e?.extent||null==e.spatialReference)return null;const t=(0,Ds.HH)(e.extent,e.spatialReference);return t.zmin=e.visibleElevationBounds.min,t.zmax=e.visibleElevationBounds.max,t}get spatialReference(){return this.view.basemapTerrain?.spatialReference??Ie.Z.WGS84}elevationAt(e,t){if(null==this.extent||!(0,Bi.Kv)(this.extent,e,t)){const i=null!=this.extent?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return f.Z.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,t,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return(0,za.G$)(e.clone(),this)}};(0,i._)([(0,y.Cb)({readOnly:!0})],Va.prototype,"demResolution",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Va.prototype,"extent",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Va.prototype,"noDataValue",void 0),(0,i._)([(0,y.Cb)()],Va.prototype,"spatialReference",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],Va.prototype,"view",void 0),Va=(0,i._)([(0,v.j)("esri.views.support.GroundViewElevationSampler")],Va);const Ha=Va;let Ga=class extends P.Z{constructor(e){super(e),this.view=null,this.layerViews=new o.Z}initialize(){this.addHandles((0,F.when)((()=>this.view?.map?.ground),(e=>e.load()))),this.addHandles(this.layerViews.on("after-changes",(()=>this._layerViewsAfterChangesHandler())))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?"2d"===this.view.type?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Ha({view:this.view}):null:null}get extent(){const e=this.view;return e&&"2d"!==e.type&&e.ready?(0,ka.HH)(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some((e=>e.updating))}get suspended(){return this.view?.suspended??!0}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map((e=>(0,F.watch)((()=>e.updating),(()=>this._updateUpdating()),F.sync))).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};(0,i._)([(0,y.Cb)({readOnly:!0})],Ga.prototype,"elevationSampler",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Ga.prototype,"extent",null),(0,i._)([(0,y.Cb)({type:Boolean,readOnly:!0})],Ga.prototype,"updating",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],Ga.prototype,"view",void 0),(0,i._)([(0,y.Cb)({type:o.Z,readOnly:!0})],Ga.prototype,"layerViews",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Ga.prototype,"suspended",null),Ga=(0,i._)([(0,v.j)("esri.views.GroundView")],Ga);const ja=Ga,Za=()=>Promise.all([n.e(89183),n.e(94094)]).then(n.bind(n,94094)),qa=()=>n.e(90969).then(n.bind(n,90969)),Wa={"base-dynamic":()=>Promise.all([n.e(78306),n.e(99134)]).then(n.bind(n,99134)),"base-elevation":qa,"base-tile":Za,"bing-maps":Za,"building-scene":()=>Promise.all([n.e(10306),n.e(85491),n.e(41984),n.e(8638),n.e(42616),n.e(63789),n.e(12926),n.e(66445),n.e(60875),n.e(15536),n.e(65456),n.e(84)]).then(n.bind(n,84)),catalog:()=>n.e(91005).then(n.bind(n,91005)),"catalog-dynamic-group":()=>n.e(71004).then(n.bind(n,71004)),"catalog-footprint":()=>Promise.all([n.e(10306),n.e(85491),n.e(8638),n.e(42616),n.e(66445),n.e(58482),n.e(51211),n.e(96525),n.e(78962)]).then(n.bind(n,78962)),csv:()=>Promise.all([n.e(10306),n.e(85491),n.e(8638),n.e(42616),n.e(66445),n.e(58482),n.e(51211),n.e(96525),n.e(13288)]).then(n.bind(n,13288)),dimension:()=>n.e(18723).then(n.bind(n,18723)),elevation:qa,feature:()=>Promise.all([n.e(10306),n.e(85491),n.e(8638),n.e(42616),n.e(66445),n.e(58482),n.e(51211),n.e(96525),n.e(40834)]).then(n.bind(n,40834)),geojson:()=>Promise.all([n.e(10306),n.e(85491),n.e(8638),n.e(42616),n.e(66445),n.e(58482),n.e(51211),n.e(96525),n.e(55668)]).then(n.bind(n,55668)),graphics:()=>Promise.all([n.e(66445),n.e(95484),n.e(31636)]).then(n.bind(n,31636)),group:()=>n.e(59308).then(n.bind(n,59308)),imagery:()=>Promise.all([n.e(78306),n.e(29151),n.e(16350)]).then(n.bind(n,84766)),"integrated-mesh":()=>Promise.all([n.e(66445),n.e(60875),n.e(15536),n.e(85109)]).then(n.bind(n,85109)),"integrated-mesh-3dtiles":()=>n.e(41688).then(n.bind(n,41688)),"line-of-sight":()=>n.e(46783).then(n.bind(n,46783)),"map-image":()=>Promise.all([n.e(78306),n.e(89183),n.e(34520)]).then(n.bind(n,34520)),media:()=>Promise.all([n.e(4708),n.e(98033)]).then(n.bind(n,98033)),"ogc-feature":()=>Promise.all([n.e(10306),n.e(85491),n.e(8638),n.e(42616),n.e(66445),n.e(58482),n.e(51211),n.e(96525),n.e(17787)]).then(n.bind(n,17787)),"open-street-map":Za,"oriented-imagery":()=>Promise.all([n.e(10306),n.e(85491),n.e(8638),n.e(42616),n.e(66445),n.e(58482),n.e(51211),n.e(96525),n.e(40834)]).then(n.bind(n,40834)),"point-cloud":()=>n.e(24385).then(n.bind(n,24385)),viewshed:()=>n.e(64743).then(n.bind(n,64743)),voxel:()=>n.e(92784).then(n.bind(n,92784)),route:()=>Promise.all([n.e(66445),n.e(63970),n.e(95484),n.e(54853)]).then(n.bind(n,54853)),scene:e=>null==e.profile||"mesh-pyramids"===e.profile?Promise.all([n.e(10306),n.e(85491),n.e(8638),n.e(42616),n.e(66445),n.e(60875),n.e(15536),n.e(81418),n.e(6397)]).then(n.bind(n,6397)):Promise.all([n.e(10306),n.e(85491),n.e(8638),n.e(42616),n.e(66445),n.e(51211),n.e(60875),n.e(81418),n.e(82121)]).then(n.bind(n,82121)),stream:()=>Promise.all([n.e(10306),n.e(85491),n.e(8638),n.e(42616),n.e(66445),n.e(51211),n.e(96525),n.e(59714)]).then(n.bind(n,90488)),tile:Za,"imagery-tile":()=>Promise.all([n.e(41782),n.e(55119)]).then(n.bind(n,55119)),"vector-tile":()=>Promise.all([n.e(99578),n.e(35399)]).then(n.bind(n,35399)),wcs:()=>Promise.all([n.e(41782),n.e(55119)]).then(n.bind(n,55119)),"web-tile":Za,wfs:()=>Promise.all([n.e(10306),n.e(85491),n.e(8638),n.e(42616),n.e(66445),n.e(58482),n.e(51211),n.e(96525),n.e(11603)]).then(n.bind(n,11603)),wms:()=>Promise.all([n.e(78306),n.e(99980)]).then(n.bind(n,99980)),wmts:()=>n.e(89121).then(n.bind(n,89121)),parquet:null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};const $a=e=>null!=Wa[e.type],Ya=e=>{const t=Wa[e.type];if(null==t)throw function(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new c.Z(`${i}:view-not-supported`,`${t} is not supported in 3D`)}(e);return t(e)},Ja="analyses-owner-handles";var Xa,Ka;!function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"}(Xa||(Xa={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(Ka||(Ka={}));let Qa=class extends P.Z{constructor(e){super(e),this._allAnalysisViews=new o.Z,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=el(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject((0,g.zE)("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject((0,g.zE)()),this._attachedToViewResolver=el()}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some((e=>e.updating))}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(null==t||t.state.list===Ka.REMOVED)throw new c.Z("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),Ja)}_disconnectOwners(){this.removeHandles(Ja),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const t of e)this._addAnalysis(t);const t=e.on("after-add",(e=>this._addAnalysis(e.item))),i=e.on("after-remove",(e=>this._removeAnalysis(e.item)));return(0,N.kB)((()=>{t.remove(),i.remove();for(const t of e)this._removeAnalysis(t)}))}_addAnalysis(e){const t=this._items.get(e);if(null==t){const t={state:{view:Xa.PENDING,list:Ka.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,t),t.createAnalysisViewTask=(0,be.vr)((e=>this._createAnalysisViewPromise(t,e)))}else t.state.list=Ka.ADDED}_removeAnalysis(e){const t=this._items.get(e);null!=t?(t.state.list=Ka.REMOVED,this._scheduleUpdate()):f.Z.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){null==this._scheduledUpdateHandle&&(this._scheduledUpdateHandle=(0,ue.Os)((()=>this._update())))}_update(){this._scheduledUpdateHandle=(0,m.hw)(this._scheduledUpdateHandle),this._items.forEach((e=>{if(e.state.list===Ka.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case Xa.PENDING:e.createAnalysisViewTask=(0,m.IM)(e.createAnalysisViewTask);break;case Xa.CREATED:null!=e.view&&(this._allAnalysisViews.remove(e.view),e.view=(0,m.SC)(e.view),e.createAnalysisViewTask=null)}}))}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,n=this._analysisModules[r];if(this._creatingViewCount+=1,null==n.module)try{n.module=await this._loadAnalysisModule(r)}catch(e){throw this._creatingViewCount-=1,e}if((0,g.Hc)(t))throw this._creatingViewCount-=1,(0,g.zE)("AnalysisView creation aborted");const s=new n.module.default({analysis:i,view:this.view});let o=!0;(0,g.fu)(t,(()=>{o&&(this._creatingViewCount-=1,s.destroy())}));try{await s.when()}catch(e){throw o=!1,s.destroyed||(this._creatingViewCount-=1,s.destroy()),e}if((0,g.Hc)(t))throw(0,g.zE)();return o=!1,e.view=s,e.state.view=Xa.CREATED,this._allAnalysisViews.add(s),this._creatingViewCount-=1,s}_loadAnalysisModule(e){switch(e){case"area-measurement":return Promise.all([n.e(89067),n.e(4708),n.e(96905),n.e(73245)]).then(n.bind(n,15694));case"dimension":return Promise.all([n.e(89067),n.e(4708),n.e(65206),n.e(54221),n.e(71473),n.e(96905),n.e(25434)]).then(n.bind(n,39006));case"direct-line-measurement":return Promise.all([n.e(89067),n.e(96905),n.e(4419)]).then(n.bind(n,40288));case"line-of-sight":return Promise.all([n.e(4708),n.e(65206),n.e(54221),n.e(95295)]).then(n.bind(n,12190));case"slice":return Promise.all([n.e(41984),n.e(63789),n.e(12926),n.e(4708),n.e(65206),n.e(65456),n.e(30212),n.e(84327)]).then(n.bind(n,29386));case"viewshed":return Promise.all([n.e(4708),n.e(65206),n.e(54221),n.e(13540),n.e(19932),n.e(1876)]).then(n.bind(n,65021))}}};function el(){const e=(0,g.hh)();return e.promise.catch((()=>{})),e}(0,i._)([(0,y.Cb)()],Qa.prototype,"updating",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],Qa.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],Qa.prototype,"_allAnalysisViews",void 0),(0,i._)([(0,y.Cb)()],Qa.prototype,"_creatingViewCount",void 0),Qa=(0,i._)([(0,v.j)("esri.views.3d.analysis.AnalysisViewManager3D")],Qa);const tl=Qa;var il=n(14260),rl=n(35369);let nl=class extends P.Z{constructor(e){super(e),this.collision=new ll,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===$t.JY.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==$t.JY.Local?this._set("altitude",e):f.Z.getLogger(this).warn("Altitude constraint is ignored in local scenes")}get mode(){return this.state.viewingMode}clampAltitude(e){return this.altitude?(0,yt.uZ)(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return(0,yt.uZ)(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===$t.JY.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=al)=>(i.min=ol.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?(0,rl.uV)([[4e3,ol.max],[1e4,(0,yt.Vl)(88)],[6e6,(0,yt.Vl)(88)]]):()=>ol.max;return(t,i=al)=>(i.min=ol.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?(0,rl.uV)([[4e3,ol.max],[5e4,(0,yt.Vl)(88)],[6e6,(0,yt.Vl)(88)],[2e7,ol.min]]):(0,rl.uV)([[3e5,ol.max],[3e6,(0,yt.Vl)(88)],[6e6,(0,yt.Vl)(88)],[2e7,ol.min]]);return(t,i=al)=>(i.min=ol.min,i.max=e(t),i)}};(0,i._)([(0,y.Cb)()],nl.prototype,"altitude",null),(0,i._)([(0,y.Cb)({readOnly:!0})],nl.prototype,"collision",void 0),(0,i._)([(0,y.Cb)()],nl.prototype,"distance",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],nl.prototype,"minimumPoiDistance",void 0),(0,i._)([(0,y.Cb)()],nl.prototype,"tilt",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],nl.prototype,"state",void 0),nl=(0,i._)([(0,v.j)("esri.views.3d.state.Constraints")],nl);const sl=function(e){return{min:-2e5,max:4*e.radius}}(il.sv),ol={min:(0,yt.Vl)(.5),max:(0,yt.Vl)(179.5)},al={min:0,max:0};let ll=class extends P.Z{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};(0,i._)([(0,y.Cb)({type:Boolean})],ll.prototype,"enabled",void 0),(0,i._)([(0,y.Cb)({type:Number})],ll.prototype,"elevationMargin",void 0),ll=(0,i._)([(0,v.j)("esri.views.3d.state.Constraints.CollisionConstraint")],ll);let cl=class extends lt.Z{constructor(){super(...arguments),this.min=sl.min,this.max=sl.max}};(0,i._)([(0,y.Cb)({type:Number})],cl.prototype,"min",void 0),(0,i._)([(0,y.Cb)({type:Number})],cl.prototype,"max",void 0),cl=(0,i._)([(0,v.j)("esri.views.3d.constraints.AltitudeConstraint")],cl);let ul=class extends lt.Z{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){"auto"===this.mode&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};(0,i._)([(0,y.Cb)({type:Number,value:1e-8})],ul.prototype,"near",null),(0,i._)([(0,D.p)("near")],ul.prototype,"castNear",null),(0,i._)([(0,y.Cb)({type:Number,value:1e-8})],ul.prototype,"far",null),(0,i._)([(0,D.p)("far")],ul.prototype,"castFar",null),(0,i._)([(0,y.Cb)({type:["auto","manual"]})],ul.prototype,"mode",void 0),ul=(0,i._)([(0,v.j)("esri.views.3d.constraints.ClipDistanceConstraint")],ul);const hl={min:(0,yt.BV)(ol.min),max:(0,yt.BV)(ol.max)};let dl=class extends lt.Z{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return(0,yt.uZ)(e,hl.min,hl.max)}autoUpdate(e){"auto"===this.mode&&this._get("max")!==e&&this._set("max",e)}};(0,i._)([(0,y.Cb)({type:["auto","manual"]})],dl.prototype,"mode",void 0),(0,i._)([(0,y.Cb)({type:Number,value:hl.max})],dl.prototype,"max",null),(0,i._)([(0,D.p)("max")],dl.prototype,"castMax",null),dl=(0,i._)([(0,v.j)("esri.views.3d.constraints.TiltConstraint")],dl);let pl=class extends lt.Z{constructor(e){super(e),this.tilt=new dl,this.altitude=new cl,this.clipDistance=new ul}};(0,i._)([(0,y.Cb)({type:dl})],pl.prototype,"tilt",void 0),(0,i._)([(0,y.Cb)({type:cl})],pl.prototype,"altitude",void 0),(0,i._)([(0,y.Cb)({type:ul})],pl.prototype,"clipDistance",void 0),pl=(0,i._)([(0,v.j)("esri.views.3d.constraints.Constraints")],pl);var fl=n(61170),ml=n(52345);function gl(e){return(0,Le.fS)(e,fl.HQ)||(0,Le.BZ)(e)?{wkid:ml.W.GCSMARS2000}:(0,Le.fS)(e,fl.VY)||(0,Le.V2)(e)?{wkid:ml.W.GCSMOON2000}:Ie.Z.WGS84}var yl=n(18809),_l=n(69442),vl=n(62700),bl=n(25853);class wl{constructor(e,t,i,r,n,s,o,a,l=.5){this.coverage=e,this.density=t,this.absorption=i,this.cloudSize=r,this.detailSize=n,this.smoothness=s,this.cloudHeight=o,this.raymarchingSteps=a,this.median=l}}const xl={sunny:new wl([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],bl.p.SIXTEEN),cloudy:new wl([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],bl.p.TWOHUNDRED,.6),rainy:new wl([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],bl.p.TWOHUNDRED,.4),snowy:new wl([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],bl.p.HUNDRED,.65),foggy:new wl([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],bl.p.SIXTEEN)};xl.default=xl.sunny;var Tl=n(32114),Cl=n(3308),Sl=n(17703),El=n(11547),Ml=n(9969),Al=n(62575),Rl=n(91907),Ol=n(17346);class Pl extends Al.A{constructor(e,t){super(e,t,new Ml.J(El.a,(()=>n.e(57530).then(n.bind(n,57530)))))}initializePipeline(e){return(0,Ol.sm)({blending:(0,Ol.if)(Rl.zi.CONSTANT_COLOR,Rl.zi.ONE_MINUS_CONSTANT_COLOR,Rl.db.ADD,e.writeTextureChannels===vl.uz.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Rl.wb.LEQUAL},colorWrite:Ol.gf})}}var Il=n(3720),Ll=n(13696),Dl=n(43175);class Nl extends Al.A{constructor(e,t){super(e,t,new Ml.J(Il.a,(()=>n.e(61378).then(n.bind(n,61378)))))}initializePipeline(e){return(0,Ol.sm)({blending:e.mode===Ll.u.Full?Ol.di:(0,Ol.wK)(Rl.zi.ZERO,Rl.zi.ONE,Rl.zi.ONE,Rl.zi.ZERO),depthTest:{func:Rl.wb.ALWAYS},colorWrite:Ol.gf})}}var Fl=n(18567),Ul=n(80479);let kl=class extends P.Z{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Il.N,this._configuration=new Ll.i,this._fbo=new Fl.X(e.context.renderContext.rctx,new Ul.X(Dl.a5)),e.context.techniques.precompile(Nl,new Ll.i);const t=new Ll.i;t.mode=Ll.u.WeatherMap,e.context.techniques.precompile(Nl,t)}get textureAtlas(){if(this._texture&&!this._needsRender)return this._texture;this._configuration.mode=this._texture?Ll.u.WeatherMap:Ll.u.Full;const e=this.context.techniques.get(Nl,this._configuration);return e.compiled&&(this._texture=this._render(e)),this._texture}updateWeatherMap(e){(0,ci.fS)(this._passParameters.weatherTile,e)||((0,ci.JG)(this._passParameters.weatherTile,e),this._needsRender=!0)}destroy(){this._fbo=(0,m.M2)(this._fbo)}_render(e){if(!this._fbo)return null;const t=this.context.renderContext.rctx,i=t.getViewport();return t.setViewport(0,0,Dl.a5,Dl.a5),t.bindFramebuffer(this._fbo),t.bindTechnique(e,this.context.renderContext.bind,this._passParameters),t.screen.draw(),t.setViewport(i.x,i.y,i.width,i.height),this._needsRender=!1,this._fbo.colorTexture}};(0,i._)([(0,y.Cb)({constructOnly:!0})],kl.prototype,"context",void 0),kl=(0,i._)([(0,v.j)("esri.views.3d.environment.NoiseTextureAtlas")],kl);var zl=n(14169);let Bl=class extends P.Z{constructor(e){super(e),this._state=(0,yl.t)(vl.TH.Idle),this._passParameters=new El.C,this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this._tilesPerFace=1,this.coverage=(0,yt.t7)(xl.default.coverage[0],xl.default.coverage[1],.5),this.density=(0,yt.t7)(xl.default.density[0],xl.default.density[1],.5),this.absorption=(0,yt.t7)(xl.default.absorption[0],xl.default.absorption[1],.5),this.cloudSize=(0,yt.t7)(xl.default.cloudSize[0],xl.default.cloudSize[1],.5),this.detailSize=(0,yt.t7)(xl.default.detailSize[0],xl.default.detailSize[1],.5),this.smoothness=(0,yt.t7)(xl.default.smoothness[0],xl.default.smoothness[1],.5),this.cloudHeight=(0,yt.t7)(xl.default.cloudHeight[0],xl.default.cloudHeight[1],.5),this.raymarchingSteps=xl.default.raymarchingSteps,this._viewMatrix=(0,Cl.Ue)(),this._dirty=!0,this.running=!0,this._configuration=new bl.t}initialize(){const e=(0,_l.Iu)(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius;const t=()=>this.setDirty();this.addHandles([this.view.resourceController.scheduler.registerTask(Ii.T8.CLOUDS_GENERATOR,this),(0,F.watch)((()=>this.coverage),t,F.initial),(0,F.watch)((()=>this.density),t,F.initial),(0,F.watch)((()=>this.absorption),t,F.initial),(0,F.watch)((()=>this.cloudSize),t,F.initial),(0,F.watch)((()=>this.detailSize),t,F.initial),(0,F.watch)((()=>this.smoothness),t,F.initial),(0,F.watch)((()=>this.cloudHeight),t,F.initial),(0,F.watch)((()=>this.raymarchingSteps),t,F.initial)]);const i=(0,ui.d9)(this._computeWeatherTile());let r=0;this.addHandles((0,F.watch)((()=>{const e=this._computeWeatherTile();return(0,ci.fS)(i,e)||(++r,(0,ci.JG)(i,e)),r}),t))}destroy(){this.destroyCubeMap(),this._passParameters.noiseTexture=(0,m.SC)(this._passParameters.noiseTexture)}_precompileTechniques(){this._configuration.steps=this.raymarchingSteps,this._configuration.writeTextureChannels=vl.uz.RG,this.context.techniques.precompile(Pl,this._configuration),this._configuration.writeTextureChannels=vl.uz.BA,this.context.techniques.precompile(Pl,this._configuration)}_acquireTechnique(){switch(this.raymarchingSteps){case bl.p.SIXTEEN:this._tilesPerFace=1;break;case bl.p.HUNDRED:this._tilesPerFace=4;break;case bl.p.COUNT:case bl.p.TWOHUNDRED:this._tilesPerFace=8;break;default:(0,l.Bg)(this.raymarchingSteps)}return this._configuration.writeTextureChannels=1-this.parameters.readChannels,this._configuration.steps=this.raymarchingSteps,this.context.techniques.get(Pl,this._configuration)}_computeWeatherTile(){const{camera:e,environment:t}=this.view,{latitude:i,longitude:r}=e.position;if(null==i||null==r)return ui.AG;(0,ci.t8)(jl,(i+90)/180,(r+180)/360);const n=Math.floor(this._weatherTileCount*Math.abs(2*jl[0]-1));jl[0]=Math.floor(2*this._weatherTileCount*jl[0]),jl[1]=Math.floor(4*(this._weatherTileCount-n)*jl[1]);let s=0,o=0;if("virtual"!==t?.lighting?.type&&null!=t?.lighting?.date){const e=new Date(t.lighting.date);e.setUTCHours(t.lighting.date.getUTCHours()+(t.lighting.displayUTCOffset??0)),s=31*e.getUTCMonth()+e.getUTCDate(),o=e.getUTCFullYear()}return jl[0]=(jl[0]+s)%(2*this._weatherTileCount),jl[1]=(jl[1]+o%100)%(4*this._weatherTileCount),jl}get state(){return this._state.value}set state(e){this._state.value=e}get usedMemory(){return(this._fbo?.usedMemory??0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){return this._passParameters.noiseTexture??=new kl({context:this.context}),this._passParameters.noiseTexture}_ensureFrameBufferCube(e){const t=this.context.renderContext.rctx;if(null==this._fbo){const i=new Ul.X(e);i.target=Rl.No.TEXTURE_CUBE_MAP,i.wrapMode=Rl.e8.CLAMP_TO_EDGE,this._fbo=new Fl.X(t,i),this.parameters.data=this}return t.unbindTexture(this._fbo.colorTexture),this._fbo}get cubeMap(){return this._fbo}get parameters(){return this.context.renderContext.bind.clouds}destroyCubeMap(){this._fbo=(0,m.M2)(this._fbo),this.parameters.data=null}applyPreset(e,t){const i=e.median,r=e=>{const r=(0,yt.t7)(e[0],e[1],i);return t<.5?(0,yt.t7)(e[0],r,2*t):(0,yt.t7)(r,e[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps,this._precompileTechniques()}setDirty(){this._dirty=this.running=!0}runTask(e){if(this.state===vl.TH.Fading)return zl.J;this._dirty&&(this._faceIndex=this._tileIndex=0,this.state=vl.TH.Rendering,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._ensureNoiseTexture().updateWeatherMap(this._computeWeatherTile()),this._dirty=!1);const t=this._acquireTechnique();if(!this._ensureNoiseTexture().textureAtlas||!t.compiled)return zl.J;const i=Vl[this._faceIndex],r=Hl[this._faceIndex];(0,Tl.ji)(this._viewMatrix,Gl,i,r),(0,gi.xO)(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,s=n.getViewport(),o=El.c/this._tilesPerFace,a=this._tileIndex*o;n.setViewport(0,a,El.c,o);const l=this._ensureFrameBufferCube(El.c);n.bindFramebuffer(l),n.bindTechnique(t,this.context.renderContext.bind,this._passParameters);const c=Rl.No.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return l.setColorTextureTarget(c),n.screen.draw(),n.gl.flush(),n.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this._faceIndex=this._tileIndex=0,this.state=vl.TH.Ready,this.running=!1):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),zl.J}};(0,i._)([(0,y.Cb)({constructOnly:!0})],Bl.prototype,"context",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Bl.prototype,"view",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Bl.prototype,"requestRender",void 0),(0,i._)([(0,y.Cb)()],Bl.prototype,"coverage",void 0),(0,i._)([(0,y.Cb)()],Bl.prototype,"density",void 0),(0,i._)([(0,y.Cb)()],Bl.prototype,"absorption",void 0),(0,i._)([(0,y.Cb)()],Bl.prototype,"cloudSize",void 0),(0,i._)([(0,y.Cb)()],Bl.prototype,"detailSize",void 0),(0,i._)([(0,y.Cb)()],Bl.prototype,"smoothness",void 0),(0,i._)([(0,y.Cb)()],Bl.prototype,"cloudHeight",void 0),(0,i._)([(0,y.Cb)()],Bl.prototype,"raymarchingSteps",void 0),(0,i._)([(0,y.Cb)()],Bl.prototype,"running",void 0),Bl=(0,i._)([(0,v.j)("esri.views.3d.environment.CloudsRenderer")],Bl);const Vl=[(0,Sl.al)(1,0,0),(0,Sl.al)(-1,0,0),(0,Sl.al)(0,1,0),(0,Sl.al)(0,-1,0),(0,Sl.al)(0,0,1)],Hl=[(0,Sl.al)(0,1,0),(0,Sl.al)(0,1,0),(0,Sl.al)(0,0,-1),(0,Sl.al)(0,0,1),(0,Sl.al)(0,1,0)],Gl=(0,Pa.ll)(),jl=(0,ui.ll)();var Zl=n(7590),ql=n(74630),Wl=n(21414),$l=n(86765);class Yl extends $l.K{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=0}}class Jl extends Al.A{constructor(e,t){super(e,t,new Ml.J(ql.P,(()=>n.e(63657).then(n.bind(n,63657)))),new Map([[Wl.T.POSITION,0],[Wl.T.INSTANCEFEATUREATTRIBUTE,1]]))}initializePipeline(){return(0,Ol.sm)({blending:Ol.xW,depthTest:{func:Rl.wb.LEQUAL},colorWrite:Ol.gf})}}var Xl=n(15396),Kl=n(95397),Ql=n(44685),ec=n(25534),tc=n(70984),ic=n(44125),rc=n(78951),nc=n(62486);let sc=class extends ec.Z{constructor(e){super(e),this.consumes={required:[Zl.CM.TRANSPARENT_ENVIRONMENT]},this.produces=Zl.CM.TRANSPARENT_ENVIRONMENT,this._rainSpeed=.1,this._snowSpeed=.01,this._numParticles=0,this._passParameters=new Yl,this._configuration=new Xl.Y;const{view:t,type:i}=e;this._configuration.type="rainy"===i?Xl.H.Rain:Xl.H.Snow,t._stage.renderView.techniques.precompile(Jl,this._configuration),this._passParameters.time=0,this._passParameters.radius=(0,_l.Iu)(t.spatialReference).radius,this.addHandles((0,F.watch)((()=>t.environment.weather),(e=>{e.type===i&&this.addHandles((0,F.watch)((()=>e.precipitation),(e=>this._adjustParticles(e)),F.syncAndInitial))}),F.syncAndInitial)),this.addHandles((0,F.watch)((()=>t._stage?.renderer.renderContext.bind.clouds.fadeFactor??1),(e=>{this._passParameters.opacity=e,1===e&&(this.removeHandles("opacity"),this.addHandles((0,F.watch)((()=>t._stage?.renderer.renderContext.bind.clouds.opacity??1),(e=>this._passParameters.opacity=e),F.syncAndInitial),"opacity"))}),F.sync),"opacity")}_adjustParticles(e){const t=e<.5?(0,yt.t7)(0,.35,2*e):(0,yt.t7)(.35,1,2*(e-.5));this._numParticles=oc*t}destroy(){this._numParticles=0,this._vao=(0,m.M2)(this._vao),this._instanceIdBuffer=(0,m.M2)(this._instanceIdBuffer)}fadeOut(e){this.removeAllHandles(),this.addHandles((0,F.watch)((()=>this.renderContext?.bind.clouds.fadeFactor??1),(t=>{this._passParameters.opacity=1-t,1===t&&(this.removeAllHandles(),e())})),"opacity")}updateAnimation(e){const t=("rainy"===this.type?this._rainSpeed:this._snowSpeed)*(0,en.D9)(e.time)%1e5;return this._passParameters.time!==t&&(this._passParameters.time=t,!0)}render(e){const t=this.renderingContext;this._instanceIdBuffer??=this._createInstanceIndices(t);const i=Math.round(this._numParticles*this._passParameters.opacity),r=e.find((({name:e})=>e===Zl.CM.TRANSPARENT_ENVIRONMENT));if(i<1)return r;const n=this.techniques.get(Jl,this._configuration);if(!n.compiled)return this.requestRender(tc.Xx.UPDATE),r;const s=t.bindTechnique(n,this.bindParameters,this._passParameters);return this._vao??=function(e,t){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new ic.U(e,t,new Map([["geometry",(0,Kl.K)(ac)]]),new Map([["geometry",rc.f.createVertex(e,Rl.l1.STATIC_DRAW,i)]]))}(t,n.locations),t.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),(0,nc.XP)(t,n.locations,this._instanceIdBuffer,lc,0),t.drawArraysInstanced(Rl.MX.TRIANGLES,0,3,i),(0,nc.UF)(t,n.locations,this._instanceIdBuffer,lc),r}_createInstanceIndices(e){const t=[];for(let e=0;e<oc;e++)t.push(e);return rc.f.createVertex(e,Rl.l1.STATIC_DRAW,new Float32Array(t))}};(0,i._)([(0,y.Cb)()],sc.prototype,"consumes",void 0),(0,i._)([(0,y.Cb)()],sc.prototype,"produces",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],sc.prototype,"type",void 0),sc=(0,i._)([(0,v.j)("esri.views.3d.environment.Precipitation")],sc);const oc=25e4,ac=(0,Ql.U$)().vec3f(Wl.T.POSITION),lc=(0,Kl.K)((0,Ql.U$)().f32(Wl.T.INSTANCEFEATUREATTRIBUTE),1);var cc=n(87698),uc=n(36935);let hc=class extends uc.tY{constructor(e){super(e),this.produces=new Map([]),this._clouds=(0,yl.t)(null),this._incarnation=0,this._precipitation=null}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage?.removeRenderPlugin(this),this._set("view",null)}get updating(){return!!this._clouds.value?.running}get weatherAvailable(){return(0,hr.l)(this.view.state.camera.eye)-(0,_l.Iu)(this.view.spatialReference).radius<=cc.rm}get usedMemory(){return this._clouds.value?.usedMemory??0}_fadeOutPrecipitation(){this._precipitation&&(this._precipitationOutgoing?.destroy(),this._precipitationOutgoing=this._precipitation,this._precipitationOutgoing.fadeOut((()=>{this._precipitationOutgoing=(0,m.SC)(this._precipitationOutgoing)})),this._precipitation=null,++this._incarnation)}get weather(){return this.view?.environmentManager?.weatherEnabled?this.view.environment.weather:null}initializeRenderContext(e){this._context=e;const t=this.view,i=()=>this._requestRender();this.addHandles([(0,F.watch)((()=>this._precipitation),i,F.sync),(0,F.watch)((()=>this._clouds.value?.state),i,F.sync),(0,F.watch)((()=>t.state.mode),i,F.sync),(0,F.watch)((()=>this._updateClouds()),i,F.sync),(0,F.watch)((()=>this._updatePrecipitation()),i,F.sync),(0,F.watch)((()=>this.weather),(e=>this._initWeather(e)))])}uninitializeRenderContext(){this._context=null,this._clouds.value=(0,m.SC)(this._clouds.value),this._precipitation=(0,m.SC)(this._precipitation),this._precipitationOutgoing=(0,m.SC)(this._precipitationOutgoing)}prepareRender(e){const{bind:t,time:i}=e;if("local"!==this.view.viewingMode&&t.clouds.data){t.clouds.fade(t.camera,i,this.view.qualitySettings.fadeDuration);const e=this._clouds.value;e&&e.state===vl.TH.Idle&&0===e.coverage&&!e.running&&e.destroyCubeMap()}}acquireTechniques(){return[]}render(){}_requestRender(){this._context?.requestRender()}_initWeather(e){const t=this._context;if(!e||!t)return void(this._clouds.value=(0,m.SC)(this._clouds.value));if(this._clouds.value)return;const i=this.view;this._clouds.value=new Bl({context:t,view:i,requestRender:()=>this._requestRender()})}_updateClouds(){const e=this.view.environment.weather;return null==e||null==this._clouds.value||this._clouds.value.applyPreset(xl[e.type],function(e){switch(e.type){case"rainy":case"snowy":case"cloudy":case"sunny":return e.cloudCover;case"foggy":return e.fogStrength}}(e)),++this._incarnation}_updatePrecipitation(){const e=this.view.environment.weather;if(e.type===this._precipitation?.type)return this._incarnation;this._fadeOutPrecipitation();const t="rainy"===e.type||"snowy"===e.type,i=this._context;return t&&i&&(this._precipitation=new sc({view:this.view,type:e.type}),++this._incarnation),this._incarnation}get test(){}hasHighlightOptions(e){return!1}};(0,i._)([(0,y.Cb)({constructOnly:!0})],hc.prototype,"view",void 0),(0,i._)([(0,y.Cb)({type:Boolean,readOnly:!0})],hc.prototype,"updating",null),(0,i._)([(0,y.Cb)()],hc.prototype,"weatherAvailable",null),(0,i._)([(0,y.Cb)()],hc.prototype,"_context",void 0),hc=(0,i._)([(0,v.j)("esri.views.3d.environment.EnvironmentRenderer")],hc);var dc=n(20401),pc=Math.PI,fc=Math.sin,mc=Math.cos,gc=Math.tan,yc=Math.asin,_c=Math.atan2,vc=Math.acos,bc=pc/180,wc=864e5,xc=2440588,Tc=2451545,Cc={dec:0,ra:0};function Sc(e){return new Date((e+.5-xc)*wc)}function Ec(e){return function(e){return e.valueOf()/wc-.5+xc}(e)-Tc}var Mc=23.4397*bc;function Ac(e,t){return _c(fc(e)*mc(Mc)-gc(t)*fc(Mc),mc(e))}function Rc(e,t){return yc(fc(t)*mc(Mc)+mc(t)*fc(Mc)*fc(e))}function Oc(e,t,i){return _c(fc(e),mc(e)*fc(t)-gc(i)*mc(t))}function Pc(e,t,i){return yc(fc(t)*fc(i)+mc(t)*mc(i)*mc(e))}function Ic(e,t){return bc*(280.16+360.9856235*e)-t}function Lc(e){return bc*(357.5291+.98560028*e)}function Dc(e){return bc*(1.9148*fc(e)+.02*fc(2*e)+3e-4*fc(3*e))}function Nc(e,t){return e+t+102.9372*bc+pc}function Fc(e,t){var i=Lc(e),r=Nc(i,Dc(i));return t||(t={dec:0,ra:0}),t.dec=Rc(r,0),t.ra=Ac(r,0),t}var Uc={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(e,t,i,r){var n=bc*-i,s=bc*t,o=Ec(e),a=Fc(o,Cc),l=Ic(o,n)-a.ra;return r||(r={azimuth:0,altitude:0}),r.azimuth=Oc(l,s,a.dec),r.altitude=Pc(l,s,a.dec),r}},kc=[[-.83,"sunrise","sunset"]];Uc.addTime=function(e,t,i){kc.push([e,t,i])};var zc=9e-4;function Bc(e,t,i){return zc+(e+t)/(2*pc)+i}function Vc(e,t,i){return Tc+e+.0053*fc(t)-.0069*fc(2*i)}function Hc(e){var t=bc*(134.963+13.064993*e),i=bc*(93.272+13.22935*e),r=bc*(218.316+13.176396*e)+6.289*bc*fc(t),n=5.128*bc*fc(i),s=385001-20905*mc(t);return{ra:Ac(r,n),dec:Rc(r,n),dist:s}}Uc.getTimes=function(e,t,i){var r=bc*-i,n=bc*t,s=function(e,t){return Math.round(e-zc-t/(2*pc))}(Ec(e),r),o=Bc(0,r,s),a=Lc(o),l=Dc(a),c=Nc(a,l),u=Rc(c,0),h=Vc(o,a,c);function d(e){return Vc(Bc(function(e,t,i){return vc((fc(e)-fc(t)*fc(i))/(mc(t)*mc(i)))}(e,n,u),r,s),a,c)}var p,f,m,g,y,_={solarNoon:Sc(h),nadir:Sc(h-.5),polarException:Uc.PolarException.NORMAL};for(p=0,f=kc.length;p<f;p+=1)y=h-((g=d((m=kc[p])[0]*bc))-h),_[m[1]]=Sc(y),_[m[2]]=Sc(g);return _.polarException=function(e){var t=(fc(e)-fc(n)*fc(u))/(mc(n)*mc(u));return t<-1?Uc.PolarException.MIDNIGHT_SUN:t>1?Uc.PolarException.POLAR_NIGHT:Uc.PolarException.NORMAL}(kc[0][0]*bc),_},Uc.getMoonPosition=function(e,t,i){var r=bc*-i,n=bc*t,s=Ec(e),o=Hc(s),a=Ic(s,r)-o.ra,l=Pc(a,n,o.dec);return l+=.017*bc/gc(l+10.26*bc/(l+5.1*bc)),{azimuth:Oc(a,n,o.dec),altitude:l,distance:o.dist}},Uc.getMoonFraction=function(e){var t=Ec(e),i=Fc(t),r=Hc(t),n=149598e3,s=vc(fc(i.dec)*fc(r.dec)+mc(i.dec)*mc(r.dec)*mc(i.ra-r.ra)),o=_c(n*fc(s),r.dist-n*mc(s));return(1+mc(o))/2};const Gc={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class jc{constructor(e,t){this.direct=e,this.ambient=t}}function Zc(e,t,i,r,n,s){(0,hr.i)(s.ambient.color,1,1,1),s.ambient.intensity=Gc.global.ambient,(0,hr.i)(s.direct.color,1,1,1),s.direct.intensity=Gc.global.direct;const o=t[2],a=(0,yt.uZ)((Math.abs(o)-Gc.local.altitude)/(Gc.global.altitude-Gc.local.altitude),0,1);let l;if(s.globalFactor=a,null!=e&&(l=Uc.getTimes(e,t[1],t[0])),a<1){let t;if(null!=e)t=function(e,t,i){const r=e.valueOf();let n,s;t.polarException===Uc.PolarException.MIDNIGHT_SUN?(n=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=n+432e6):t.polarException===Uc.PolarException.POLAR_NIGHT?(n=r-2,s=r-1):(n=t.sunrise.valueOf(),s=t.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,u=a+l,h=.06*o,d=n-h/2,p=n+h/2,f=s-h/2,m=s+h/2,g=(0,ui.Ue)(),y=(0,Pa.Ue)(),_=(0,Pa.Ue)();let v="";if(r<d||r>m)(0,ci.JG)(g,lu),(0,hr.c)(y,eu),(0,hr.c)(_,nu),v="night";else if(r<p){const e=(r-d)/(p-d);(0,ci.t7)(g,lu,cu,e),(0,hr.m)(y,eu,tu,e),(0,hr.m)(_,nu,su,e),v="sun rising"}else if(r<c){const e=(r-p)/(c-p);(0,ci.t7)(g,cu,uu,e),(0,hr.m)(y,tu,iu,e),(0,hr.m)(_,su,ou,e),v="early morning"}else if(r<a){const e=(r-c)/(a-c);(0,ci.t7)(g,uu,hu,e),(0,hr.m)(y,iu,ru,e),(0,hr.m)(_,ou,au,e),v="late morning"}else if(r<u){const e=(r-a)/(u-a);(0,ci.t7)(g,hu,du,e),(0,hr.m)(y,ru,pu,e),(0,hr.m)(_,au,fu,e),v="early afternoon"}else if(r<f){const e=(r-u)/(f-u);(0,ci.t7)(g,du,mu,e),(0,hr.m)(y,pu,gu,e),(0,hr.m)(_,fu,yu,e),v="late afternoon"}else if(r<m){const e=(r-f)/(m-f);(0,ci.t7)(g,mu,lu,e),(0,hr.m)(y,gu,eu,e),(0,hr.m)(_,yu,nu,e),v="sun setting"}let b=0;switch(i){case"rainy":case"foggy":b=.8;break;case"snowy":b=.5}b>0&&(Qc(y,b),Qc(_,b));const w=Kc(i);return{direct:{intensity:g[0]*w.direct,color:y},ambient:{intensity:g[1]*w.ambient,color:_},timeOfDay:v}}(e,l,r);else{const e=Kc(r);t={direct:{intensity:Gc.local.directAtNoon*e.direct,color:(0,Pa.al)(1,1,1)},ambient:{intensity:Gc.local.ambientAtNoon*e.ambient,color:(0,Pa.al)(1,1,1)},timeOfDay:"early afternoon"}}(0,hr.m)(s.ambient.color,t.ambient.color,s.ambient.color,a),s.ambient.intensity=(0,yt.t7)(t.ambient.intensity,s.ambient.intensity,a),(0,hr.m)(s.direct.color,t.direct.color,s.direct.color,a),s.direct.intensity=(0,yt.t7)(t.direct.intensity,s.direct.intensity,a),s.specularStrength="rainy"===r||"snowy"===r||"foggy"===r?0:1,s.environmentStrength="rainy"===r?.7:"snowy"===r||"foggy"===r?.75:1}s.noonFactor=null!=e?function(e,t){const i=e.valueOf();let r,n;t.polarException===Uc.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=r+432e6):t.polarException===Uc.PolarException.POLAR_NIGHT?(r=i-2,n=i-1):(r=t.sunrise.valueOf(),n=t.sunset.valueOf());const s=r+(n-r)/2;return 1-(0,yt.uZ)(Math.abs(i-s)/432e5,0,1)}(e,l):1,null!=e?Wc(e,t,i,s.direct.directionToLightSource):qc(n,i,s.direct.directionToLightSource)}function qc(e,t,i){t===$t.JY.Global?(0,hr.n)(vu,e.eye):(0,hr.i)(vu,0,0,1),(0,hr.h)(bu,e.viewForward,-1);const r=(0,rl.EU)(bu,vu),n=Math.max(r-2*xu,0),s=.85*n/(n+1),o=Math.max(xu,r-xu-s);(0,Tl.Us)(_u,-o,e.viewRight),(0,hr.t)(i,bu,_u),(0,hr.g)(i,i,(0,hr.h)(wu,e.viewRight,Tu)),(0,hr.n)(i,i)}function Wc(e,t,i,r){const n=Xc,s=(0,Tl.yR)(Jc);if(i===$t.JY.Global)Uc.getPosition(e,0,0,n),(0,hr.i)(r,0,0,-1),(0,Tl.lM)(s,s,-n.azimuth),(0,Tl.uD)(s,s,-n.altitude),(0,hr.t)(r,r,s);else{const i=Gc.planarDirection,o=i.globalAngles,a=t[2];let l=(Math.abs(a)-i.localAltitude)/(i.globalAltitude-i.localAltitude);l=(0,yt.uZ)(l,0,1),l<1?(Uc.getPosition(e,t[1],t[0],n),n.azimuth=(1-l)*n.azimuth+l*o.azimuth,n.altitude=(1-l)*n.altitude+l*o.altitude):(n.azimuth=o.azimuth,n.altitude=o.altitude),(0,hr.i)(r,0,-1,0),(0,Tl.jI)(s,s,-n.azimuth),(0,Tl.lM)(s,s,-n.altitude),(0,hr.t)(r,r,s)}}const $c=(0,Pa.al)(.5773502691896258,-.5773502691896258,.5773502691896258);class Yc{constructor(){this.ambient={color:(0,Pa.al)(1,1,1),intensity:.55},this.direct={color:(0,Pa.al)(1,1,1),intensity:.55,directionToLightSource:(0,Pa.d9)($c)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const Jc=(0,Cl.Ue)(),Xc={azimuth:0,altitude:0};function Kc(e){switch(e){case"disabled":case"sunny":case"cloudy":return new jc(1,1);case"rainy":return new jc(.4,1.2);case"snowy":return new jc(.5,1.3);case"foggy":return new jc(.2,1.6)}}function Qc(e,t){const i=(e[0]+e[1]+e[2])/3;e[0]+=(i-e[0])*t,e[1]+=(i-e[1])*t,e[2]+=(i-e[2])*t}const eu=(0,Pa.al)(.01,.01,.01),tu=(0,Pa.al)(1,.6,.5),iu=(0,Pa.al)(1,.98,.98),ru=(0,Pa.al)(1,1,1),nu=(0,Pa.al)(.8,.8,1),su=(0,Pa.al)(.8,.8,1),ou=(0,Pa.al)(.98,.98,1),au=(0,Pa.al)(1,1,1),lu=(0,ui.al)(.01,Gc.local.ambientAtNight),cu=(0,ui.al)(Gc.local.directAtTwilight,Gc.local.ambientAtTwilight),uu=(0,ui.al)(.9*Gc.local.directAtNoon,Gc.local.ambientAtNoon),hu=(0,ui.al)(Gc.local.directAtNoon,Gc.local.ambientAtNoon),du=uu,pu=iu,fu=ou,mu=cu,gu=tu,yu=su;new Date(0);const _u=(0,Cl.Ue)(),vu=(0,Pa.Ue)(),bu=(0,Pa.Ue)(),wu=(0,Pa.Ue)(),xu=.25,Tu=.2;var Cu=n(11722),Su=n(23627);let Eu=class extends L.Z.EventedAccessor{constructor(){super(),this._tmpLightParameters=new Yc,this._defaultLightParameters=new Yc,this._tmpDate=new Date,this._tmpTz={hours:0,minutes:0,seconds:0},this._viewHandlesKey="viewHandles",this._trackingEnabled=!1,this._mainLight=new Su.Eg,this._ambientLight=new Su.Mi,this._moonLight=new Su.AM,this._disableProjectionEngineAutoLoad=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!!this._renderer?.updating||!this._canProjectCameraPosition}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===$t.JY.Global&&(0,Le.N$)(this._view.spatialReference)}get _weatherAvailable(){return this.weatherEnabled&&this._renderer?.weatherAvailable}get referencePositionGeographic(){return this._referencePositionGeographic}get _canProjectCameraPosition(){const e=this._view?.stateManager?.camera?.position?.spatialReference??Ie.Z.WGS84,t=gl(e);return this._disableProjectionEngineAutoLoad||(0,te.isLoadedOrLoadFor)(e,t)}connectView(e){if(this._renderer)return;this._renderer=new hc({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this.addHandles([(0,F.watch)((()=>e.environment.lighting),(e=>this._updateLightingHandler(e)),F.sync),(0,F.watch)((()=>"virtual"!==e.environment.lighting.type?e.environment.lighting.date:null),(e=>this._lightingDateHandler(e)),F.sync),(0,F.watch)((()=>e.environment.lighting.directShadowsEnabled),t,F.sync),(0,F.watch)((()=>e.qualitySettings.ambientOcclusion),t,F.sync),(0,F.watch)((()=>e.qualitySettings.reflections),t,F.sync),(0,F.watch)((()=>e.spatialReference),(()=>this._resetReferencePosition(!0)),F.sync),(0,F.watch)((()=>[e.environment.weather.type,this.weatherEnabled]),(()=>this._updateLighting(null,Cu.B.FadeWithWeather)),F.sync),(0,F.watch)((()=>e.environment),(e=>e.setComputeWeatherAvailable((()=>this._weatherAvailable))),F.syncAndInitial),(0,F.watch)((()=>e.viewingMode),(()=>this._resetReferencePosition(!0)),F.syncAndInitial),(0,F.watch)((()=>"virtual"!==e.environment.lighting.type&&e.environment.lighting.cameraTrackingEnabled),(e=>this._updateCameraTracking(e)),F.syncAndInitial),(0,F.watch)((()=>e.state.camera),i,F.syncAndInitial),(0,F.when)((()=>this._canProjectCameraPosition),i,F.sync)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=(0,m.SC)(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking("virtual"!==e.type&&e.cameraTrackingEnabled),this._lightingDateHandler("virtual"!==e.type?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const e=this._view.environment.lighting;"virtual"!==e?.type&&(e.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if("virtual"!==t?.type){if(e){if(!t.positionTimezoneInfo.autoUpdated&&(this._preupdateTracking(e),null!=this._referencePositionGeographic)){const e=(0,dc.dF)(this._referencePositionGeographic,this._tmpTz);null!=e&&(t.autoUpdate(null,e),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;if(!i)return;const{position:r}=i,n=gl(r.spatialReference??Ie.Z.WGS84),s=this._referencePositionGeographic??(0,Pa.Ue)();if(!(0,La.K)(r,s,n))return this._referencePositionGeographic=null,void this._updateLighting();this._referencePositionGeographic=s,this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(s,e)||this._updateLighting(e)}_updateLighting(e,t=Cu.B.Immediate){const i=this._view,{lighting:r}=i.environment,n="virtual"===r.type,s=this._referencePositionGeographic,o=null!=s?this._tmpLightParameters:this._defaultLightParameters;if(s){e??=n?null:r.date;const t=this._weatherAvailable?i.environment.weather.type:"disabled";Zc(e,s,i.state.viewingMode,t,i.state.camera,o)}else n&&qc(i.state.camera,i.state.viewingMode,o.direct.directionToLightSource);const a=this._mainLight,l=o.direct;(0,hr.h)(a.intensity,l.color,l.intensity*Math.PI),(0,hr.c)(a.direction,l.directionToLightSource),a.specularStrength=o.specularStrength,a.environmentStrength=o.environmentStrength;const c=this._ambientLight;(0,hr.h)(c.intensity,o.ambient.color,o.ambient.intensity);const u=this._moonLight;(0,hr.m)(u.intensity,Mu,Au,o.globalFactor);const h=(1-.5*o.globalFactor)*(1-.4*o.noonFactor*(1-o.globalFactor));(0,hr.h)(u.intensity,u.intensity,h),(0,hr.c)(u.direction,l.directionToLightSource),this._view._stage.renderer.updateLighting([a,c,u],o.noonFactor,o.globalFactor,this._weatherAvailable?t:Cu.B.Immediate),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||null==e)return!1;const i=this._tmpDate;i.setTime((t||this._view.environment.lighting.date).getTime());const r=(0,dc.dF)(e,this._tmpTz);if(null==r)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===r.hours&&n.minutes===r.minutes&&n.seconds===r.seconds)return!1}else n=r;const s=i.getUTCHours()-(r.hours-n.hours),o=i.getUTCMinutes()-(r.minutes-n.minutes),a=i.getUTCSeconds()-(r.seconds-n.seconds);return i.setUTCHours(s),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=null==this._referencePositionGeographic||function(e,t){if(t===$t.JY.Global)return!0;const i=Gc.planarDirection;return Math.abs(e)<i.localAltitude}(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,environment:this._view.environment,weatherVisible:this._weatherAvailable,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._referencePositionGeographic=null,e&&this._cameraHandler()}get test(){}};(0,i._)([(0,y.Cb)({type:Boolean,readOnly:!0})],Eu.prototype,"updating",null),(0,i._)([(0,y.Cb)()],Eu.prototype,"_disableProjectionEngineAutoLoad",void 0),(0,i._)([(0,y.Cb)()],Eu.prototype,"_disableWeather",void 0),(0,i._)([(0,y.Cb)()],Eu.prototype,"weatherEnabled",null),(0,i._)([(0,y.Cb)()],Eu.prototype,"_weatherAvailable",null),(0,i._)([(0,y.Cb)()],Eu.prototype,"referencePositionGeographic",null),(0,i._)([(0,y.Cb)()],Eu.prototype,"_renderer",void 0),(0,i._)([(0,y.Cb)()],Eu.prototype,"_referencePositionGeographic",void 0),(0,i._)([(0,y.Cb)()],Eu.prototype,"_canProjectCameraPosition",null),Eu=(0,i._)([(0,v.j)("esri.views.3d.environment.EnvironmentManager")],Eu);const Mu=(0,Pa.al)(.22,.22,.33),Au=(0,Pa.al)(.22,.22,.22);var Ru,Ou=n(34248);let Pu=Ru=class extends u.Z{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return null!=t.datetime&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){null!=e&&(t.displayUTCOffset=e)}clone(){return new Ru(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(e.date=new Date(this.date.getTime())),e}};(0,i._)([(0,y.Cb)({readOnly:!0,type:["sun"],json:{write:!0}})],Pu.prototype,"type",void 0),(0,i._)([(0,y.Cb)({type:Date,json:{type:Number,write:{target:"datetime"}}})],Pu.prototype,"date",void 0),(0,i._)([(0,Ou.r)("date",["datetime"])],Pu.prototype,"readDate",null),(0,i._)([(0,b.c)("date")],Pu.prototype,"writeDate",null),(0,i._)([(0,y.Cb)({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Pu.prototype,"directShadowsEnabled",void 0),(0,i._)([(0,Ou.r)("directShadowsEnabled",["directShadows"])],Pu.prototype,"readDirectShadowsEnabled",null),(0,i._)([(0,b.c)("directShadowsEnabled")],Pu.prototype,"writedirectShadowsEnabled",null),(0,i._)([(0,y.Cb)({type:Number,json:{write:!0}})],Pu.prototype,"displayUTCOffset",void 0),(0,i._)([(0,b.c)("displayUTCOffset")],Pu.prototype,"writeDisplayUTCOffset",null),Pu=Ru=(0,i._)([(0,v.j)("esri.webscene.SunLighting")],Pu);const Iu=Pu;var Lu;let Du=Lu=class extends(L.Z.EventedMixin(Iu)){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=(new Date).getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new Lu(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){null!=e&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=Lu.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;null!=e&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(e.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime()))));const n=Lu.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==n&&(Nu.target=this,Nu.timezoneOffset=n,this.emit("timezone-will-change",Nu),Nu.target=null),null!=e)return isNaN(e.getTime())||r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new Lu({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return null!=e.date&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};(0,i._)([(0,y.Cb)({type:Boolean})],Du.prototype,"cameraTrackingEnabled",void 0),(0,i._)([(0,y.Cb)({type:Date})],Du.prototype,"defaultDate",null),(0,i._)([(0,y.Cb)({type:Date})],Du.prototype,"date",null),Du=Lu=(0,i._)([(0,v.j)("esri.views.3d.environment.SunLighting")],Du),function(e){e.calculateTimezoneOffset=function({hours:e,minutes:t,seconds:i}){return Math.round(e+t/60+i/3600)}}(Du||(Du={}));const Nu={target:null,timezoneOffset:0},Fu=Du;var Uu;let ku=Uu=class extends u.Z{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Uu(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};(0,i._)([(0,y.Cb)({readOnly:!0,type:["virtual"],json:{write:{isRequired:!0}}})],ku.prototype,"type",void 0),(0,i._)([(0,y.Cb)({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],ku.prototype,"directShadowsEnabled",void 0),ku=Uu=(0,i._)([(0,v.j)("esri.webscene.VirtualLighting")],ku);const zu=ku;var Bu;let Vu=Bu=class extends(L.Z.EventedMixin(zu)){constructor(e){super(e),this.cameraTrackingEnabled=!0}clone(){return new Bu({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(e){return new Bu(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};(0,i._)([(0,y.Cb)({type:Boolean})],Vu.prototype,"cameraTrackingEnabled",void 0),Vu=Bu=(0,i._)([(0,v.j)("esri.views.3d.environment.VirtualLighting")],Vu);const Hu=Vu,Gu={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Fu,virtual:Hu}};var ju=n(64089);const Zu={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Iu,virtual:zu}};let qu=class extends u.Z{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};(0,i._)([(0,y.Cb)({readOnly:!0,json:{read:!1}})],qu.prototype,"type",void 0),qu=(0,i._)([(0,v.j)("esri.webscene.background.Background")],qu);const Wu=qu;var $u,Yu=n(50264);let Ju=$u=class extends Wu{constructor(e){super(e),this.type="color",this.color=new s.Z([0,0,0,1])}clone(){return new $u(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};(0,i._)([(0,x.J)({color:"color"},{readOnly:!0})],Ju.prototype,"type",void 0),(0,i._)([(0,y.Cb)((0,Yu.a)({nonNullable:!0}))],Ju.prototype,"color",void 0),Ju=$u=(0,i._)([(0,v.j)("esri.webscene.background.ColorBackground")],Ju);const Xu=Ju,Ku={base:Wu,key:"type",typeMap:{color:Xu}};const Qu={types:Ku,json:{read:function(e){return(t,i,r)=>{if(!t)return t;for(const i in e.typeMap)if(t.type===i){const n=new e.typeMap[i];return n.read(t,r),n}}}(Ku),write:{overridePolicy:(e,t,i)=>({enabled:!i?.isPresentation})}}};var eh;const th=(e,t,i)=>({enabled:!i?.isPresentation});let ih=eh=class extends u.Z{constructor(e){super(e),this.lighting=new Iu,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){(0,cc.b8)(e?.type,f.Z.getLogger(this))&&this._set("weather",e)}clone(){return new eh(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?zu.prototype.clone.call(this.lighting):Iu.prototype.clone.call(this.lighting),background:(0,h.d9)(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};(0,i._)([(0,y.Cb)({types:Zu,nonNullable:!0,json:{write:!0}})],ih.prototype,"lighting",void 0),(0,i._)([(0,y.Cb)(Qu)],ih.prototype,"background",void 0),(0,i._)([(0,y.Cb)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:th}}})],ih.prototype,"atmosphereEnabled",void 0),(0,i._)([(0,y.Cb)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:th}}})],ih.prototype,"starsEnabled",void 0),(0,i._)([(0,y.Cb)({types:cc.Hr,nonNullable:!0,json:{write:!0},value:new ju.Z})],ih.prototype,"weather",null),ih=eh=(0,i._)([(0,v.j)("esri.webscene.Environment")],ih);const rh=ih;var nh;let sh=nh=class extends rh{constructor(e){super(e),this.lighting=this.castLighting(),this._computeWeatherAvailable=void 0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new nh({...t,lighting:t.lighting?"virtual"===t.lighting.type?Hu.fromWebsceneLighting(t.lighting):Fu.fromWebsceneLighting(t.lighting):void 0})}get weatherAvailable(){return this._computeWeatherAvailable?.()??!1}setComputeWeatherAvailable(e){this._computeWeatherAvailable=e}castLighting(e){return this._convertLightingWithDestroy(e)}applyLighting(e){this.lighting=this._convertLightingWithDestroy(e)}_convertLightingWithDestroy(e){const t=this._convertLighting(e);return t!==e&&this.addHandles((0,N.ed)(t)),t}_convertLighting(e){return e?e instanceof Fu||e instanceof Hu?e:e instanceof Iu?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(e):new Fu({...e.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):e instanceof zu?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(e):new Hu({...e.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):(0,_.N7)(Gu,e):new Fu}clone(){return new nh({lighting:this.lighting.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:(0,h.d9)(this.background)})}cloneWithWebsceneEnvironment(e){return new nh({weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:(0,h.d9)(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){switch(e.lighting.type){case"sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(e.lighting):Fu.fromWebsceneLighting(e.lighting);case"virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(e.lighting):Hu.fromWebsceneLighting(e.lighting);default:return(0,l.Bg)(e.lighting),Fu.fromWebsceneLighting(e.lighting)}}};(0,i._)([(0,y.Cb)({nonNullable:!0})],sh.prototype,"lighting",void 0),(0,i._)([(0,y.Cb)()],sh.prototype,"_computeWeatherAvailable",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],sh.prototype,"weatherAvailable",null),(0,i._)([(0,D.p)("lighting")],sh.prototype,"castLighting",null),sh=nh=(0,i._)([(0,v.j)("esri.views.3d.environment.SceneViewEnvironment")],sh);const oh=sh;var ah,lh,ch,uh=n(97537),hh=n(73687);!function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(ah||(ah={})),function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"}(lh||(lh={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(ch||(ch={}));class dh{constructor(e=ah.ALL,t=lh.NONE,i=0,r=null,n=null,s=ch.TUMBLE){this.selection=e,this.interactionType=t,this.interactionFactor=i,this.interactionStartCamera=r,this.interactionDirection=n,this.tiltMode=s}}function ph(e,t){return!!(e&t)}function fh(e,t,i,r,n,s){0!==e&&(i?(s.min=Math.min(s.min,t),s.max=Math.max(s.max,t)):null!=r?(s.min-=Math.max(0,(t-s.min)*(1-r)),s.max+=Math.max(0,(t-s.max)*(1-r))):n&&(s.min-=Math.max(0,t-s.min-n),s.max+=Math.max(0,t-s.max-n)))}const mh=new dh(ah.NONE);function gh(e,t,i,r){return t=t||e.viewForward,(0,hr.c)(r,t),(0,hr.h)(r,r,Math.sign((0,hr.f)(t,i))),r}var yh=n(18979);function _h(e,t,i=mh){if(!function(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i||t.interactionType===lh.TUMBLE&&ph(t.selection,ah.TILT))}(e,i)||!e.state.constraints.altitude)return 0;const r=function(e,t){return t.min=e.min,t.max=e.max,t}(e.state.constraints.altitude,vh);!function(e,t,i){const r=t.interactionType;if(r===lh.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;const l=r===lh.TUMBLE||r===lh.ZOOM,c=_h(e,o),u=0===c?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=n,i.max=s,fh(c,u,l,a,.05*u,i)}(e,i,r);const n=e.renderCoordsHelper.getAltitude(t.eye),s=(0,yt.uZ)(n,r.min,r.max)-n;return Math.abs(s)<=1e-6?0:s}const vh={min:0,max:0},bh=(0,Pa.Ue)(),wh=(0,Pa.Ue)(),xh=(0,Pa.Ue)(),Th=(0,Pa.Ue)();function Ch(e,t,i=mh){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;Eh.min=0,Eh.max=r,function(e,t,i){const r=t.interactionType;if(r===lh.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;const l=r===lh.ZOOM||r===lh.PAN,c=Ch(e,o),u=0===c?0:Sh(e,o);i.min=n,i.max=s,fh(c,u,l,a,.05*u,i)}(e,i,Eh);const n=Sh(e,t),s=Eh.max-n;return s>=-1e-6?0:s}function Sh(e,t){const i=e.pointsOfInterest.surfaceOrigin;return i.renderLocation?(0,hr.j)(t.eye,i.renderLocation):0}const Eh={min:0,max:0},Mh=(0,Pa.Ue)(),Ah=(0,Pa.Ue)(),Rh=(0,Pa.Ue)(),Oh=(0,Pa.Ue)(),Ph=(0,Pa.Ue)();var Ih,Lh=n(64666);function Dh(e,t,i=Ih.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const n=(0,Lh.wH)(e,t.eye),s=e.renderCoordsHelper.getAltitude(t.eye),o=n+r.collision.elevationMargin;if(s>=o)return!1;const a=(0,hr.l)(t.eye);if((0,hr.d)(Nh,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(Fh,o,t.eye),i===Ih.EYE_AND_CENTER)t.center=(0,hr.g)(Nh,t.eye,Nh);else if(i===Ih.EYE_AND_CENTER_SCALE){const e=(a-s+o)/a;t.center=(0,hr.h)(Nh,t.center,e)}return!0}!function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"}(Ih||(Ih={}));const Nh=(0,Pa.Ue)(),Fh=(0,Pa.Ue)();var Uh=n(98872);function kh(e,t,i,r=mh,n){if(!e.state.constraints.tilt)return 0;const s=Math.min(t.relativeElevation*qh,t.distance),o=e.state.constraints.tilt(s,Wh);return function(e,t,i){if(t.interactionType===lh.NONE)return;const{interactionStartCamera:r,interactionFactor:n}=t;if(!r)return;const{min:s,max:o}=i,a=kh(e,r,mh,t),l=0===a?0:(0,Uh.L)(e.renderCoordsHelper,r.center,r.eye);i.min=s,i.max=o,t.interactionType===lh.TUMBLE?(ph(t.selection,ah.ALTITUDE)&&Vh(e,r,i),fh(a,l,!0,n,Zh,i)):fh(a,l,!1,n,Zh,i)}(e,i,o),r.interactionType===lh.TUMBLE&&ph(r.selection,ah.ALTITUDE)&&Vh(e,r.interactionStartCamera,o),i.tiltMode===ch.LOOK_AROUND||r.tiltMode===ch.LOOK_AROUND?function(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return function(e,t,i,r){const n=function(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=r+(0,_l.Iu)(e.spatialReference).radius,s=e.renderCoordsHelper.intersectManifold(t.ray,r,jh);return i.distance=Math.min(t.relativeElevation*qh,t.distance),i.centerIsOnSurface=!1,null!=s?(i.distance=Math.min(t.relativeElevation*qh,(0,hr.j)(t.eye,s)),i.tiltAtCenter=(0,Uh.L)(e.renderCoordsHelper,s,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=(0,Uh.L)(e.renderCoordsHelper,t.center,t.eye):((0,hh.k)((0,hh.b)(hh.t,n),t.ray,jh),i.distance=Math.min(t.relativeElevation*qh,(0,hr.j)(t.eye,jh)),i.tiltAtCenter=(0,yt.ZF)(-(0,hr.f)(t.viewForward,(0,hr.n)(jh,jh)))),i.radius=n,i.eyeRadius=(0,hr.l)(t.eye),i.constraints=e.state.constraints,i}(e,t,$h),s=(0,yt.uZ)(n.tiltAtCenter,i.min,i.max);if(!zh(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=function(e){const{constraints:t,distance:i,tiltAtCenter:r}=e;let n=r,s=t.clampTilt(i,r);const o=Bh(e,s);if(t.clampTilt(o,r)===s)return s;let a=0;for(;a<10&&zh(s-n);){const i=(n+s)/2,r=Bh(e,i);zh(t.clampTilt(r,i)-i)?n=i:s=i,a++}return s}(n),a=function(e,t){const i=(0,yt.Kt)(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=(0,yt.Kt)(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}(n,o)):(o=n.constraints.clampTilt(n.distance,n.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=function(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}(n,o)),r&&(r.eyeCenterDistance=Bh(n,o)),a}(e,t,i,r);case"local":return function(e,t,i,r){const n=(0,Uh.L)(e.renderCoordsHelper,t.center,t.eye),s=(0,yt.uZ)(n,i.min,i.max),o=n-s;if(!zh(o))return 0;if(r){const i=Math.abs(e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude),n=e.renderCoordsHelper.getAltitude(t.eye)-i,o=Math.max(Math.cos(s),1e-4);Math.abs(o)>1e-4?r.eyeCenterDistance=n/o:r.eyeCenterDistance=t.distance}return o}(e,t,i,r)}}(e,t,o,n):function(e,t,i){const r=(0,Uh.L)(e.renderCoordsHelper,t.center,t.eye),n=r-(0,yt.uZ)(r,i.min,i.max);return zh(n)?n:0}(e,t,o)}function zh(e){return Math.abs(e)>1e-9}function Bh(e,t){if(!e.centerIsOnSurface)return e.distance;const i=Math.PI-(0,yt.uZ)(t,0,Math.PI),r=(0,yt.Kt)(e.radius/e.eyeRadius*Math.sin(i)),n=Math.PI-i-r,s=Math.sin(n)/Math.sin(i);if(e.eyeRadius<e.radius&&s>1){const t=Math.PI-r,n=Math.PI-i-t;return Math.sin(n)/Math.sin(i)*e.eyeRadius}return s*e.eyeRadius}function Vh(e,t,i){const r=e.state.constraints;if(e.state.isLocal||!r.altitude||!t)return;const n=(0,hr.k)(t.center),s=Math.sqrt(n),o=t.distance,a=(0,_l.Iu)(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,u=(l*l-o*o-n)/(-2*s*o),h=(c*c-o*o-n)/(-2*s*o);i.min=Math.max(i.min,Math.min(Math.PI-(0,yt.ZF)(h),i.max)),i.max=Math.min(i.max,Math.PI-(0,yt.ZF)(u))}const Hh=(0,Pa.Ue)(),Gh=(0,Cl.Ue)(),jh=(0,Pa.Ue)(),Zh=(0,yt.Vl)(5),qh=30,Wh={min:0,max:0},$h={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,distance:0,tiltAtCenter:0},Yh={eyeCenterDistance:0,requiresTwoSteps:!1};function Jh(e,t,i=Qh,r=t){r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);let n=!1;for(let t=0;t<ed;t++){let t=0;for(const s of Kh)if(ph(i.selection,s.type)){const o=Math.abs(s.error(e,r,i));s.apply(e,r,i)&&(n=!0,t+=o)}if(0===t)break}const s=ph(i.selection,ah.COLLISION),o=function(e,t){switch(e){case lh.PAN:return Ih.EYE_AND_CENTER;case lh.ASCEND:return t.state.isGlobal?Ih.EYE_AND_CENTER_SCALE:Ih.EYE_AND_CENTER;default:return Ih.EYE}}(i.interactionType,e);return s&&Dh(e,r,o)&&(n=!0),n&&r.computeUp(e.state.viewingMode),n}function Xh(e){const t=Math.min(1,e/150);return Mn(t)}const Kh=[{type:ah.TILT,error:function(e,t,i){return kh(e,t,i)*t.distance},apply:function e(t,i,r,n=!0){Yh.eyeCenterDistance=0,Yh.requiresTwoSteps=!1;const s=kh(t,i,r,mh,Yh);if(0===s)return!1;switch((0,Tl.Us)(Gh,-s,i.viewRight),r.tiltMode){case ch.LOOK_AROUND:(0,hr.t)(Hh,i.viewForward,Gh),(0,hr.h)(Hh,Hh,Yh.eyeCenterDistance),i.center=(0,hr.g)(jh,i.eye,Hh);break;case ch.TUMBLE:(0,hr.d)(Hh,i.center,i.eye),(0,hr.t)(Hh,Hh,Gh),i.eye=(0,hr.d)(jh,i.center,Hh);break;default:(0,l.Bg)(r.tiltMode)}return i.up=(0,hr.t)(jh,i.up,Gh),!Yh.requiresTwoSteps||!n||e(t,i,r,!1)}},{type:ah.ALTITUDE,error:_h,apply:function(e,t,i=mh){const r=_h(e,t,i);if(0===r)return!1;const n=e.renderCoordsHelper,s=n.getAltitude(t.eye)+r,o=gh(t,i.interactionDirection,function(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),(0,hr.h)(r,r,i),r}(e,t,Math.sign(r),wh),bh),a=(0,hr.c)(xh,t.viewForward),l=n.intersectInfiniteManifold((0,uh.re)(t.eye,o),s,Th);return t.eye=null!=l?l:n.setAltitude(Th,s,t.eye),t.center=(0,yh.W8)(Th,t.eye,a,t.center),!0}},{type:ah.DISTANCE,error:Ch,apply:function(e,t,i=mh){const r=Ch(e,t,i);if(0===r)return!1;const n=e.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=Sh(e,t)+r,o=(0,hr.c)(Mh,t.eye),a=gh(t,i.interactionDirection,function(e,t,i){return(0,hr.o)(i,e.eye,t)}(t,n.renderLocation,Oh),Rh);if(!(0,hh.j)((0,hh.l)(n.renderLocation,s),(0,uh.re)(t.eye,a),Ph))return!1;t.eye=Ph;const l=(0,hr.d)(Ah,t.eye,o);t.center=(0,hr.g)(Ph,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),u=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,Ph);return null!=u&&(t.center=u),!0}}],Qh=new dh,ed=5;var td=n(3965);class id{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=(0,Pa.Ue)(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=(0,Pa.d9)(ud),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotate(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,t){if(this.viewingMode===$t.JY.Global){const i=((0,hr.l)(this.center)+(0,hr.l)(e.center))/2;t.pan=(0,rl.EU)(this.center,e.center)*i}else t.pan=(0,hr.j)(this.center,e.center);let i=Math.abs(e._yaw-this._yaw);i>=Math.PI&&(i=2*Math.PI-i);const r=Math.abs(e._pitch-this._pitch);t.rotate=Math.max(i,r),t.fov=e.fov-this.fov,t.sourceZoom=this._distance,t.targetZoom=e._distance}interpolate(e,t,i){this.viewingMode===$t.JY.Global?(0,rl.ZA)(e.center,t.center,i.pan,this.center):(0,hr.m)(this.center,e.center,t.center,i.pan),this._distance=isFinite(t.distance)?(0,yt.t7)(e.distance,t.distance+i.zoomOffset,i.zoom):e.distance,this._pitch=(0,yt.t7)(e.pitch,t.pitch,i.rotate);let r=e._yaw;const n=t._yaw;Math.abs(n-r)>=Math.PI&&(r+=2*(r<n?1:-1)*Math.PI),this._yaw=(0,yt.t7)(r,n,i.rotate),this._fov=(0,yt.t7)(e.fov,t.fov,i.fov)}copyFrom(e){(0,hr.c)(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,(0,hr.c)(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const t=this._lookAtOrientation(e.center,dd);(0,hr.c)(this.center,e.center),(0,hr.d)(od,e.center,e.eye),(0,hr.q)(od,od,t),(0,hr.q)(ad,e.up,t),this._distance=(0,hr.l)(od),0!==this._distance&&(od[0]/=this._distance,od[1]/=this._distance,od[2]/=this._distance),this._pitch=function(e){return Math.PI-(0,rl.EU)(cd,e)}(od),this._yaw=function(e,t){const i=ld;return Math.abs(t[2])<.5?((0,hr.c)(i,t),e[2]>0&&(0,hr.h)(i,i,-1)):(0,hr.c)(i,e),(0,hr.e)(nd,i,cd),(0,hr.n)(nd,nd),(0,rl.EU)(hd,nd,cd)}(od,ad),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const t=this._lookAtOrientation(this.center,dd);(0,gi.p4)(t,t),this._axisAngleVec3(hd,this._pitch-Math.PI/2,ud,od),this._axisAngleVec3(cd,this._yaw,od,od),this._axisAngleVec3(hd,this._pitch-Math.PI/2,cd,ad),this._axisAngleVec3(cd,this._yaw,ad,ad),(0,hr.h)(od,od,this._distance),(0,hr.q)(od,od,t),(0,hr.q)(ad,ad,t),e.center=this.center,e.eye=(0,hr.d)(od,this.center,od),e.up=ad,e.fov=this._fov}_axisAngleVec3(e,t,i,r){const n=Math.cos(t),s=Math.sin(t);return(0,hr.h)(rd,i,n),(0,hr.e)(nd,e,i),(0,hr.h)(nd,nd,s),(0,hr.h)(sd,e,(1-n)*(0,hr.f)(e,i)),(0,hr.g)(r,(0,hr.g)(r,rd,nd),sd)}_lookAtOrientation(e,t=(0,td.Ue)()){return this._upAtLookAt(e,sd),(0,hr.e)(rd,this.direction,sd),(0,hr.n)(rd,rd),0===rd[0]&&0===rd[1]&&0===rd[2]&&(0,hr.c)(rd,hd),(0,hr.e)(nd,sd,rd),(0,hr.n)(nd,nd),t[0]=rd[0],t[1]=nd[0],t[2]=sd[0],t[3]=rd[1],t[4]=nd[1],t[5]=sd[1],t[6]=rd[2],t[7]=nd[2],t[8]=sd[2],t}_upAtLookAt(e,t){return this.viewingMode===$t.JY.Local?(0,hr.c)(t,cd):(0,hr.n)(t,e)}}const rd=(0,Pa.Ue)(),nd=(0,Pa.Ue)(),sd=(0,Pa.Ue)(),od=(0,Pa.Ue)(),ad=(0,Pa.Ue)(),ld=(0,Pa.Ue)(),cd=Pa.eG,ud=Pa.IO,hd=Pa.E9,dd=(0,td.Ue)();class pd{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=(0,en.HA)(0),this._animation=new ws((()=>new id(e))),this._current=new id(e)}update(e,t,i){const{source:r,target:n}=this._animation.definition,s=(0,hr.d)(fd,t.center,e.center),o=(0,hr.l)(s);o>=1e-5?(s[0]/=o,s[1]/=o,s[2]/=o):(s[0]=0,s[1]=1,s[0]=0),(0,hr.c)(r.direction,s),(0,hr.c)(n.direction,s),r.copyFromRenderCamera(e),n.copyFromRenderCamera(t),this._current.copyFrom(r),this._animation.update(r,n,i),this.currentTime=(0,en.HA)(0),e.almostEquals(t)&&(this.currentTime=this._animation.time)}cameraAt(e,t){this._animation.cameraAt(e,this._current),this._current.copyToRenderCamera(t)}step(e,t){this.finished||(this.currentTime=(0,en.HA)(this.currentTime+(0,en.up)(e)),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,t)}}const fd=(0,Pa.Ue)();var md;!function(e){e[e.Ready=0]="Ready",e[e.Rejected=1]="Rejected",e[e.Running=2]="Running",e[e.Stopped=3]="Stopped",e[e.Finished=4]="Finished"}(md||(md={}));let gd=class extends P.Z{constructor(e){super(e),this.state=md.Ready}get running(){return this.state===md.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=md.Stopped,!0)}finishController(){this.state=md.Finished}get steppingFinished(){return!1}};(0,i._)([(0,y.Cb)({constructOnly:!0})],gd.prototype,"view",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],gd.prototype,"running",null),(0,i._)([(0,y.Cb)()],gd.prototype,"state",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],gd.prototype,"isInteractive",null),gd=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.CameraController")],gd);let yd=class extends gd{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject((0,g.zE)()),this._asyncResult=null),this.state===md.Finished||this.state===md.Stopped?((0,m.O3)(e),this.state===md.Finished?e.resolve():e.reject((0,g.zE)())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=md.Running,null!=this.viewAnimation&&this.viewAnimation.when((()=>this.updateStateFromViewAnimation()),(()=>this.updateStateFromViewAnimation()))}updateStateFromViewAnimation(){!this.viewAnimation||this.state!==md.Ready&&this.state!==md.Running||(this.viewAnimation.state===Ni.State.FINISHED?this.finish():this.viewAnimation.state===Ni.State.STOPPED&&(this.state=md.Stopped))}onControllerEnd(e){null==this.viewAnimation||this.viewAnimation.done||(this.state===md.Finished?this.viewAnimation.finish():this.state===md.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===md.Finished?this._asyncResult.resolve():this._asyncResult.reject((0,g.zE)()))}finish(){this.finishController()}};yd=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.AnimationController")],yd);var _d=n(5512),vd=n(8927);let bd=class extends yd{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.type="point-to-point",this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new pd(this.view.state.viewingMode),this.viewAnimation="interaction"===this.mode?null:new Ni}get isInteractive(){return"interaction"===this.mode}begin(e,t){this._hasTarget=!0;const i=this.animationSettings(t);wd.copyFrom(this.view.state.camera);const r=(0,vd.Z8)(this.view.state.viewingMode);this._intersectionHelper.intersectRay(wd.ray,r,xd)&&(wd.center=xd),this.animation.update(wd,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,t){this._hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:"string"==typeof e.easing?Kn[e.easing]:e.easing}}};(0,i._)([(0,y.Cb)({constructOnly:!0})],bd.prototype,"mode",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],bd.prototype,"isInteractive",null),bd=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.PointToPointAnimationController")],bd);const wd=new _d.Z,xd=(0,Pa.Ue)();function Td(e){return null!=e&&"type"in e&&"point-to-point"===e.type}var Cd=n(16068),Sd=n(1845),Ed=n(96303),Md=n(5700),Ad=n(68817);function Rd(e=Ld){return[e[0],e[1],e[2],e[3]]}function Od(e,t){return Pd(e[0],e[1],e[2],t,Ad.o6.get())}function Pd(e,t,i,r,n=Rd()){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function Id(e,t,i){return(0,hr.e)(i,e,t),(0,hr.n)(i,i),i[3]=(0,Md.EU)(e,t),i}const Ld=[0,0,1,0];(0,Ed.Ue)(),(0,Ed.Ue)();var Dd=n(69430),Nd=n(40460);function Fd(e,t,i,r){const n=(0,Nd.iE)(t,i,Ud);return(0,hh.j)(e,n,r)}const Ud=(0,uh.Ue)();var kd,zd=n(5073);!function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"}(kd||(kd={}));const Bd=[1,3e8],Vd=1508e5,Hd={exclude:new Set([zd.xX])};function Gd(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function jd(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function Zd(e,t,i){const r=(0,Tl.Us)(Ad.MP.get(),i[3],i);null==r||(0,Tl.I6)(r,Cl.Wd)||((0,hr.d)(zp,e.eye,t),(0,hr.t)(zp,zp,r),e.eye=(0,hr.g)(zp,zp,t),(0,hr.d)(zp,e.center,t),(0,hr.t)(zp,zp,r),e.center=(0,hr.g)(zp,zp,t),e.up=(0,hr.t)(zp,e.up,r))}function qd(e,t,i,r){return(0,Dd.BR)(e,(0,Nd.iE)(t,i,jp),r)}function Wd(e,t,i,r){const n=Ad.WM.get();let s=1-i;(0,hr.d)(n,t,e.eye);const o=(0,hr.l)(n);let a=o*(1-s);s>=0&&a<r&&(a=r,s=-(a-o)/o),Math.abs(o-a)<1e-6||((0,hr.h)(n,n,s),e.eye=(0,hr.g)(zp,e.eye,n),e.center=(0,hr.m)(zp,e.center,t,s))}function $d(e,t,i){t.getScreenCenter(Yd),Fd(e,t,Yd,zp)&&(t.center=zp);const r=t.distance,n=r*i;if(Math.abs(r-n)<1e-6)return;const s=(0,hr.h)(Ad.WM.get(),t.viewForward,n);t.eye=(0,hr.d)(zp,t.center,s)}const Yd=(0,$e.s1)();function Jd(e,t){(0,hr.i)(t,0,0,0);for(const i of e)(0,hr.g)(t,t,i);(0,hr.h)(t,t,1/e.length)}function Xd(e,t,i,r){return Math.sin(e/(0,hr.l)(t))*(i+r.radius)}function Kd(e,t,i,r){return Xd(Math.PI/2,t,i,r)+(e-Math.PI/2)}var Qd;!function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(Qd||(Qd={}));const ep={Elevation:3e4,Angle:(0,yt.Vl)(16)},tp=(0,yt.Vl)(80);function ip(e,t,i,r,n,s){const o=(0,Pa.Ue)(),a=(0,hh.c)();let l=!0,c=!0;return e.intersectScreen(i,o,s)?a[3]=(0,hr.l)(o):(c=!1,t.aboveGround&&n!==kd.Ellipsoid?a[3]=Math.max((0,hr.l)(t.center),.9*r.radius):a[3]=(0,hr.l)(t.eye)-t.relativeElevation,n===kd.Silhouette?op(a,t,i,o):l=Fd(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function rp(e,t,i,r){const n=e.relativeElevation;if(n>ep.Elevation&&"global"===r)return Qd.Horizontal;(0,Nd.iE)(e,t,Zp);const s=Math.sign(n),o=i.worldUpAtPosition(e.eye,zp);return-s*(0,hr.f)(o,Zp.direction)<Math.sin(ep.Angle)*(0,hr.l)(Zp.direction)?Qd.Vertical:Qd.Horizontal}function np(e,t,i){(0,hr.d)(sp,i,t),e.eye=(0,hr.d)(zp,e.eye,sp),e.center=(0,hr.d)(zp,e.center,sp)}const sp=(0,Pa.Ue)();function op(e,t,i,r){const n=(0,Nd.iE)(t,i,jp);return!(null==n||((0,hh.k)(e,n,ap),(0,hh.j)(e,n,r)?(0,hr.s)(ap,n.origin)<(0,hr.s)(r,n.origin)&&((0,hr.c)(r,ap),1):((0,hr.d)(lp,t.eye,t.center),(0,hr.n)(lp,lp),(0,Dd.Oy)(lp,-(0,hr.f)((0,hr.n)(lp,lp),ap),cp),(0,Dd.BR)(cp,n,r),1)))}const ap=(0,Pa.Ue)(),lp=(0,Pa.Ue)(),cp=(0,Dd.Ue)();function up(e,t,i,r,n,s){let o=0;if((0,hr.e)(Hp,e,t),(0,hr.d)(Bp,e,t),(0,hr.l)(e)<=n||!r.aboveGround){(0,hr.e)(i,Bp,r.eye);const a=(0,hr.f)(e,t)/((0,hr.l)(e)*(0,hr.l)(t));if(a<.9999)o=(0,yt.ZF)(a);else{const i=(0,hr.l)((0,hr.e)((0,Pa.Ue)(),e,t))/((0,hr.l)(e)*(0,hr.l)(t));o=(0,yt.Kt)(i)}const l=Math.cos((0,yt.uZ)(Cd.Q4.normalize((0,yt.Vl)(s)),0,tp));o=-o-Math.max(0,(0,hr.l)(t)-n)/(l*n)}else(0,hr.d)(hp,r.eye,r.center),(0,hr.e)(i,Bp,hp),o=-(0,hr.l)(Bp)/n;return(0,hr.n)(i,i),(0,hr.h)(i,i,(0,hr.l)(Hp)),o}const hp=(0,Pa.Ue)();function dp(e,t,i,r){let n,s;const o=Math.cos((0,yt.uZ)(Cd.Q4.normalize((0,yt.Vl)(r)),0,tp));return n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):(0,yt.ZF)(t/i),s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):(0,yt.ZF)(e/i),(s-n)*i}function pp(e,t,i,r,n,s,o,a,l,c){(0,hr.e)(Hp,e,t),(0,Na.Tz)(s.up,s.eye,Ap,Rp,Op),(0,Na.Tz)([0,0,1],s.eye,Sp,Ep,Mp),(0,hr.c)(i,Ep),(0,hr.c)(r,Sp),(0,hr.n)(i,i),(0,hr.h)(i,i,(0,hr.l)(Hp)),(0,Na.yS)(e,(0,hr.n)(Rp,Rp),(0,hr.n)(Op,Op),(0,hr.n)(Ap,Ap),Pp),(0,Na.yS)(t,Rp,Op,Ap,Ip),function(e,t,i,r,n,s,o,a,l,c){const u=dp(e[2],t[2],s[3],a),h=l?dp(e[0],t[0],s[3],180):t[0]-e[0],d=Math.sin(o)*h-Math.cos(o)*u,p=Math.cos(o)*h+Math.sin(o)*u;(0,hr.n)(zp,n);const f=l?d/Math.sqrt(Math.abs(s[3]**2-(0,hr.f)(i,zp)**2)):d/s[3],m=p/Math.sqrt(Math.abs(s[3]**2-(0,hr.f)(i,r)**2));(0,ci.t8)(c,f,m)}(Pp,Ip,e,Sp,Ep,o,a,l,c,n)}function fp(e,t,i,r,n,s,o){(0,Tl.Us)(Np,n,r),(0,Tl.Us)(Fp,o,s),(0,Tl.Jp)(Up,Np,Fp),(0,hr.d)(t,e,i),(0,hr.t)(t,t,Up),(0,hr.g)(t,t,i)}function mp(e,t,i,r,n,s){(0,Tl.Us)(Np,r,i),(0,Tl.Us)(Fp,s,n),(0,Tl.Jp)(Up,Np,Fp),(0,hr.d)(zp,e.eye,t),(0,hr.t)(zp,zp,Up),e.eye=(0,hr.g)(zp,zp,t),(0,hr.d)(zp,e.center,t),(0,hr.t)(zp,zp,Up),e.center=(0,hr.g)(zp,zp,t),(0,hr.d)(zp,e.up,t),(0,hr.t)(zp,zp,Up),e.up=(0,hr.g)(zp,zp,t)}const gp=.95,yp=(0,yt.Vl)(18),_p=45,vp=1e-7;let bp=!1;function wp(e,t,i,r,n,s){const o=Math.abs(r)>Math.PI-yp||Math.abs(r)<yp,a=(Math.abs(e[2])<i*gp||Math.abs(t)>i)&&s;return o&&a?!bp&&n<_p-vp?bp=!0:bp&&n>_p+vp&&(bp=!1):bp=!1,bp}function xp(e,t,i,r,n,s){if(s)Id(i,r,Dp),Zd(t,(0,hh.a)(e),Dp);else{const s=up(i,r,Gp,t,e[3],n);Zd(t,(0,hh.a)(e),Od(Gp,s))}}function Tp(e,t,i,r,n,s,o){const a=o?20:1;let l,c;(0,hr.c)(kp,r),Vp.copyFrom(t);for(let r=0;r<a&&(0,hr.s)(i,kp)>1e-12&&(l=(0,hr.s)(i,kp),pp(i,kp,Ep,Sp,Lp,Vp,e,n,s,o),mp(Vp,(0,hh.a)(e),Sp,Lp[1],Ep,Lp[0]),fp(kp,kp,(0,hh.a)(e),Sp,Lp[1],Ep,Lp[0]),c=(0,hr.s)(i,kp),c<l||0===r);r++)t.copyFrom(Vp)}function Cp(e,t,i,r,n,s,o,a,l){wp(e.center,(0,hr.f)(e.up,e.center),(0,hr.l)(e.center),-Cd.Q4.normalize((0,yt.Vl)(s)),o,t.aboveGround)?function(e,t,i,r,n,s){const{eye:o}=e;(0,Na.Tz)([0,0,1],o,Sp,Ep,Mp);const a=t.translation[0]*i.pan,l="zoom"===n.mode?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-(0,hr.f)(e.center,Sp)**2/(0,hr.l)(e.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*a)/c,h=-Math.cos(s)*l+Math.sin(s)*a;switch((0,Tl.U1)(r.pan.matrix,r.pan.matrix,u,Sp),r.pan.enabled=!0,n.mode){case"pan":(0,Tl.U1)(r.pan.matrix,r.pan.matrix,h,Ep),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}(t,i,r,a,l,-Cd.Q4.normalize((0,yt.Vl)(n))):function(e,t,i,r,n){const{eye:s,viewRight:o}=e,a=(0,hr.e)(Ad.WM.get(),o,s),l=t.translation[0]*i.pan;switch(0!==l&&((0,Tl.U1)(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),n.mode){case"pan":{const e=t.translation[1]*i.pan;0!==e&&((0,Tl.U1)(r.pan.matrix,r.pan.matrix,e,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}(t,i,r,a,l)}const Sp=(0,Pa.Ue)(),Ep=(0,Pa.Ue)(),Mp=(0,Pa.Ue)(),Ap=(0,Pa.Ue)(),Rp=(0,Pa.Ue)(),Op=(0,Pa.Ue)(),Pp=(0,Pa.Ue)(),Ip=(0,Pa.Ue)(),Lp=(0,ui.Ue)(),Dp=Rd(),Np=(0,Cl.Ue)(),Fp=(0,Cl.Ue)(),Up=(0,Cl.Ue)(),kp=(0,Pa.Ue)(),zp=(0,Pa.Ue)(),Bp=(0,Pa.Ue)(),Vp=new _d.Z,Hp=(0,Pa.Ue)(),Gp=(0,Pa.Ue)(),jp={origin:(0,Pa.Ue)(),direction:(0,Pa.Ue)()},Zp={origin:(0,Pa.Ue)(),direction:(0,Pa.Ue)()};let qp=class extends bd{constructor(){super(...arguments),this._zoomLocation=(0,Pa.Ue)(),this._tmpCamera=new _d.Z,this._tmpViewDir=(0,Pa.Ue)(),this._tmpRayDir=(0,uh.Ue)(),this._targetOnSphere=(0,Pa.Ue)(),this._tmpCenter=(0,Pa.Ue)(),this._beginCamera=new _d.Z,this._constraintOptions=new dh(ah.ALL_EXCEPT_COLLISION,lh.ZOOM,null,this._beginCamera),this._sphere=(0,hh.c)()}initialize(){this._intersector=(0,vd.Z8)(this.view.state.viewingMode)}step(e,t){if(!this.running)return;const i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera);let r=!1,n=!1;this._intersectionHelper.intersectScreen(t,this._zoomLocation,0===this.view.map.ground.opacity?Hd:{})&&(r=e>0,n=!0),this._tmpCamera.copyFrom(i.camera),r?this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:(0,hr.c)(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,t,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:(0,en.HA)(600),easing:Nn}}_updateCamera(e,t,i,r){const n=rp(e,i,this.view.renderCoordsHelper,this.view.viewingMode),s=Math.abs(this.view.camera.position.z),o=this._zoomLocation;(0,hr.n)($p,e.eye),(0,hr.h)($p,$p,-1),(0,Nd.iE)(e,i,this._tmpRayDir),(0,hr.n)(this._tmpRayDir.direction,this._tmpRayDir.direction);const a=(0,yt.uZ)(Math.min(8,1/Math.abs((0,hr.f)($p,this._tmpRayDir.direction)))*s,200,Vd);if(n===Qd.Horizontal){let r=.6**t;this._sphere[3]=(0,hr.l)(o),(0,hr.d)(this._tmpViewDir,e.center,e.eye);const n=Math.min((0,hr.l)(this._tmpViewDir),a);let s=n*r;if(r<=1&&s<4&&(s=4,r=s/n),Math.abs(n-s)<1e-6)return;const l=(0,hr.l)(e.center);if(this._sphere[3]!==l){const t=this._sphere[3]+r*(l-this._sphere[3]);e.center=(0,hr.h)(Wp,e.center,t/l)}(0,hr.h)(this._tmpViewDir,this._tmpViewDir,-r),e.eye=(0,hr.g)(Wp,e.center,this._tmpViewDir),Jh(this.view,e,this._constraintOptions),(0,hr.s)(o,e.center)>1e-12&&Fd(this._sphere,e,i,this._targetOnSphere)&&function(e,t,i,r,n,s,o){wp(i,(0,hr.f)(t.up,i),e[3],-Cd.Q4.normalize((0,yt.Vl)(n)),s,t.aboveGround)?Tp(e,t,i,r,-Cd.Q4.normalize((0,yt.Vl)(n)),s,o):xp(e,t,i,r,s,o)}(this._sphere,e,o,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let n=.6**Math.abs(t);const s=t>0?1:-1;(0,hr.d)(this._tmpViewDir,o,e.eye);const l=(0,hr.l)(this._tmpViewDir),c=this.view._stage.renderView.getMinimalDepthForArea(null,i[0],i[1],this.view.state.camera,60);let u=null!=c?c:a;u=r&&t>0?Math.min(u,l):u,(0,hr.h)(this._tmpRayDir.direction,this._tmpRayDir.direction,u),(0,hr.g)(o,this._tmpRayDir.origin,this._tmpRayDir.direction);let h=u*n;const d=Math.max(4,1.01*e.nearFar[0]);if(t>0&&h<d&&(h=d,n=h/u),Math.abs(u-h)<1e-6)return;(0,hr.h)(this._tmpRayDir.direction,this._tmpRayDir.direction,s*(1-n)),e.eye=(0,hr.g)(Wp,e.eye,this._tmpRayDir.direction),e.center=(0,hr.g)(Wp,e.center,this._tmpRayDir.direction)}Dh(this.view,e)}};qp=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],qp);const Wp=(0,Pa.Ue)(),$p=(0,Pa.Ue)();var Yp=n(71961);let Jp=class extends bd{constructor(){super(...arguments),this._zoomLocation=(0,Pa.Ue)(),this._tmpCamera=new _d.Z,this._tmpRayDir=(0,Pa.Ue)(),this._tmpCenter=(0,Pa.Ue)(),this._beginCamera=new _d.Z,this._constraintOptions=new dh(ah.ALL,lh.ZOOM,null,this._beginCamera)}step(e,t){if(!this.running)return;const i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(i.camera);const r=(0,vd.Z8)(this.view.state.viewingMode);let n=!1;e>0?(n=this._intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation,0===this.view.map.ground.opacity?Hd:{}),this._intersectionHelper.intersectRay(this._tmpCamera.ray,r,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this._intersectionHelper.intersectRay(this._tmpCamera.ray,r,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:(0,hr.c)(this._zoomLocation,this._tmpCamera.center);const s=.6**e;let o=this.view._stage.renderView.getMinimalDepthForArea((0,Yp.$L)(this.view),t[0],t[1],this.view.state.camera,60);(0,hr.d)(Qp,this._tmpCamera.eye,this._zoomLocation),(0,hr.n)(Qp,Qp);const a=(0,yt.uZ)(Math.min(8,1/Math.abs((0,hr.f)(Kp,Qp)))*Math.abs(this.view.camera.position.z),200,Vd);if(o=null!=o?o:a,o){const e=(0,Pa.Ue)();(0,hr.d)(e,this._zoomLocation,this._tmpCamera.eye),(o<(0,hr.l)(e)||!n)&&((0,hr.n)(e,e),(0,hr.g)(this._zoomLocation,this._tmpCamera.eye,(0,hr.h)(e,e,o)))}this._updateCamera(this._tmpCamera,s,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:(0,en.HA)(600),easing:Nn}}_updateCamera(e,t,i){(0,hr.d)(this._tmpRayDir,i,e.eye);const r=(0,hr.l)(this._tmpRayDir);let n=r*t;const s=t<=1,o=Math.max(4,1.01*e.nearFar[0]);0!==n&&(s&&n<o&&(n=o,t=n/r),Math.abs(r-n)<1e-6||((0,hr.h)(this._tmpRayDir,this._tmpRayDir,t),e.eye=(0,hr.d)(Xp,i,this._tmpRayDir),e.center=(0,hr.m)(Xp,e.center,i,1-t),Jh(this.view,e,this._constraintOptions)))}};Jp=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.ZoomStepControllerLocal")],Jp);const Xp=(0,Pa.Ue)(),Kp=(0,Pa.al)(0,0,1),Qp=(0,Pa.Ue)();class ef extends tr.a{constructor(e,t){super(!0),this._view=e,this.registerIncoming("double-click",t,(e=>this._handleDoubleClick(e)))}_handleDoubleClick(e){const t=e.data;if(ir(t,"primary")){const i=this._view.state.isGlobal?new qp({view:this._view,mode:"animation"}):new Jp({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.step(Math.log(.5)/Math.log(.6),(0,$e.s1)(t.x,t.y)),e.stopPropagation()}}}var tf=n(56999),rf=n(52721),nf=n(99741);class sf{constructor(e,t){this._elevationProvider=e,this._referenceEllipsoid=(0,_l.Iu)(t),this._unitInMeters=(0,Ma.c9)(t,this._referenceEllipsoid.metersPerDegree)}compute(e,t,i,r,n){n||(n={near:0,far:0});let s=e[2]*this._unitInMeters;const o=s,a=s-r,l=this._elevationProvider?.visibleElevationBounds;l&&(s=a>=0?o-this._unitInMeters*l.min:this._unitInMeters*l.max-o);const c={x:(i=null!=i?i:new Oe.Z({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},u=Math.max(c.x,c.y,c.z);(0,hr.d)(gf,t,e),mf[0]=gf[0]>0?i.xmax:i.xmin,mf[1]=gf[1]>0?i.ymax:i.ymin,mf[2]=gf[2]>0?u/2:-u/2,(0,hr.d)(mf,mf,e),(0,hr.n)(gf,gf);const h=1.1*(0,hr.f)(mf,gf)*this._unitInMeters,d=Math.sqrt(s*(s+2*this._referenceEllipsoid.radius)),p=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),f=p*pf*this._unitInMeters,m=p*ff*this._unitInMeters,g=(0,yt.uZ)((s-m)/(f-m),0,1)**3,y=Math.min((0,yt.t7)(d,h,g),d)*Math.max(Math.log(Math.abs(a)),1);return af(Math.min(y,Math.max(34064e4,u))/this._unitInMeters,uf,this._unitInMeters,n)}}class of{constructor(e){this._referenceEllipsoid=(0,_l.Iu)(e)}compute(e,t,i,r,n){n||(n={near:0,far:0});const s=(0,hr.l)(e),o=s-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,r),l=Math.abs(o-r),c=Math.max(l,Math.abs(o)),u=Math.sqrt(c*(c+2*a)),h=s+this._referenceEllipsoid.radius,d=1.2*(0,yt.t7)(u,h,(0,nf.yx)(c)),p=(Math.log(c)-lf)/(cf-lf);return af(d,(0,yt.uZ)(uf-p*(uf-hf),hf,uf),1,n)}}function af(e,t,i,r){const n=df/i,s=e/t;return s>n?(r.far=e,r.near=s):(r.near=n,r.far=r.near*t),r}const lf=7.983,cf=16.994,uf=2e4,hf=100,df=2,pf=.001,ff=1e-4,mf=(0,Pa.Ue)(),gf=(0,Pa.Ue)();let yf=class extends P.Z{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",(e=>this._handleElevationChangeEvent(e))))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;null!=e.spatialReference&&(0,Lh.lM)(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera((e=>Dh(this.view,e,Ih.EYE_AND_CENTER)))}};(0,i._)([(0,y.Cb)({constructOnly:!0})],yf.prototype,"view",void 0),yf=(0,i._)([(0,v.j)("esri.views.3d.state.SurfaceCollisionConstraint")],yf);let _f=class extends P.Z{constructor(e){super(e),this.nearFarHeuristic=function(e,t,i){return e===$t.JY.Global?new of(i):new sf(t,i)}(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([(0,F.watch)((()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far]),(()=>this._clipDistanceNearFarChanged())),(0,F.watch)((()=>this.view.constraints?.clipDistance?.mode),(()=>this._updateNearFar())),this.view.state.events.on("before-camera-change",(e=>this._updateCameraNearFar(e))),(0,F.watch)((()=>this.view.renderDataExtent),(()=>this._updateNearFar()),F.sync),(0,F.watch)((()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max]),(()=>this._updateAltitude()),F.sync),(0,F.watch)((()=>this.view.constraints?.tilt?.max),(()=>this._updateTiltMax()),F.sync),(0,F.watch)((()=>this.view.constraints?.tilt?.mode),(()=>this._updateTilt()),F.sync),(0,F.watch)((()=>this.view.state?.camera),(()=>this._updateTiltAutoMax()),F.sync),(0,F.watch)((()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled]),(()=>this._updateCollision()),F.sync)]),this.view.state.isLocal&&this.addHandles((0,F.watch)((()=>this.view.renderDataExtent),(e=>this._updateLocalSurfaceDistance(e)),F.initial)),this._updateNearFar(),this.view.state.viewingMode!==$t.JY.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new yf({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&"auto"!==e.mode&&this.view.state.updateCamera((t=>vf(t,e)))}_updateNearFar(){this.view.state.updateCamera((e=>this._updateCameraNearFar(e)))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(t?t.mode:"auto")?vf(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,(0,Lh.wH)(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,t=!e||"stay-above"===e,i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(ah.COLLISION);const e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==$t.JY.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;"manual"===(e?e.mode:"auto")?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt((0,yt.Vl)(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||"auto"!==e.mode)return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate((0,yt.BV)(i))}}_updateLocalSurfaceDistance(e){if(null==e)return;let t=Math.max(e.width,e.height);if(t<=0)return;null!=e.zmax&&null!=e.zmin&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=ah.ALL){this.view.state.updateCamera((t=>Jh(this.view,t,new dh(e,lh.NONE,null))))}};function vf(e,t){t&&(e.near=t.near,e.far=t.far)}(0,i._)([(0,y.Cb)({constructOnly:!0})],_f.prototype,"view",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],_f.prototype,"surfaceCollisionConstraint",void 0),_f=(0,i._)([(0,v.j)("esri.views.3d.state.ConstraintsManager")],_f);var bf=n(62884);let wf=class extends gd{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=md.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",(e=>this._handleElevationChangeEvent(e)))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(null==e.spatialReference||(0,Lh.lM)(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera((e=>{e.copyViewFrom(this.desiredCamera),Dh(this.view,e,Ih.EYE_AND_CENTER)||this.constraintEnabled||(this.state=md.Stopped)}))}};(0,i._)([(0,y.Cb)({constructOnly:!0})],wf.prototype,"desiredCamera",null),wf=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],wf);var xf=n(20031),Tf=n(74304),Cf=n(7845),Sf=n(10369),Ef=n(49757),Mf=n(37116),Af=n(59934),Rf=n(66143);function Of(e){return 360-Cd.BV.normalize(e)}function Pf(e){return Cd.BV.normalize(360-e)}function If(e,t,i){const r=t.camera;if(null!=r)return function(e,t){const i=e.position;let r;try{r=(0,te.tryProjectWithZConversion)(i,t)}catch(e){return null}if(!r)return null;const n=e.clone();return n.position=r.clone(),n}(r,(0,ka.h5)(e));const{targetGeometry:n}=t;if(null==n)return null;const{camera:s,mode:o}=Df(e,t.rotation,i);if("point"===n.type)return function(e,t,i,r,n){const s=e.spatialReference;let o;try{o=(0,te.tryProjectWithZConversion)(i.clone(),s)}catch(e){return null}if(!o)return null;const a=null!=t.scale?(0,ka._U)(e,t.scale):e.state.camera.distance;return(0,ka.Hm)(e,o,a,r,n)}(e,t,n,s,o);const a=n.extent;return null==a?null:(0,ka.S9)(e,a,s.heading,s.tilt,o)}async function Lf(e,t,i,r){const n=t.camera;if(null!=n)return async function(e,t,i){const r=e.position,n=await(0,te.projectWithZConversion)(r,t,{signal:i});(0,g.k_)(i);const s=e.clone();return s.position=n.clone(),s}(n,(0,ka.h5)(e),r);const{targetGeometry:s}=t;if(null==s)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=Df(e,t.rotation,i);if("point"===s.type)return async function(e,t,i,r,n,s){const o=e.spatialReference,a=await(0,te.projectWithZConversion)(i.clone(),o,{signal:s});(0,g.k_)(s);const l=null!=t.scale?(0,ka._U)(e,t.scale):e.state.camera.distance;return(0,ka.gL)(e,a,l,r,n,s)}(e,t,s,o,a,r);const l=s.extent;if(null==l)throw new Error("Target geometry has no extent!");return(0,ka.Ic)(e,l,o.heading,o.tilt,a,r)}function Df(e,t,i){const r=(0,ka.l0)(e,e.state.camera);let n=ka.Q8.ADJUST;return null!=t&&(r.heading=Of(t),n=ka.Q8.LOCKED),null!=i&&(r.tilt=i),{camera:r,mode:n}}async function Nf(e,t,i){const r=function(e,t){if(!t||!e.spatialReference)return null;const i={target:void 0};return"declaredClass"in t||Array.isArray(t)?i.target=t:(Object.assign(i,t),!i.target&&"center"in t&&t.center&&(i.target=t.center)),i}(e,t);if(!r)throw new c.Z("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new Sa.Z({fov:e.camera.fov}),s=new K.Z({camera:n});if(r.target instanceof K.Z)return Gf(await async function(e,t,i,r,n){if(t.camera)return Vf(e,t.camera,r,n);n.scale=t.scale,n.rotation=t.rotation,n.targetGeometry=null!=t.targetGeometry?t.targetGeometry.clone():null,n.camera=null,null!=i.heading?n.rotation=Pf(i.heading):null!=i.rotation&&(n.rotation=i.rotation);const s=Ff(e,i);return null!=s&&(n.scale=s),n.camera=await Lf(e,n,i.tilt,r),n}(e,r.target,r,i,s));if(r.target instanceof Sa.Z)return Gf(await Vf(e,r.target,i,s));const o=null!=r.scale||null!=r.zoom;if(r.target instanceof Oe.Z){const t=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Gf(o||t?await Hf(e,r,r.target.center,n,i,s):await async function(e,t,i,r,n,s){s.targetGeometry=i.clone();const o=(0,Lh.dP)(e);(0,ka.l0)(e,o,r);const a=Uf(r,t)?ka.Q8.LOCKED:ka.Q8.ADJUST;return s.camera=await(0,ka.Ic)(e,i,r.heading,r.tilt,a,n),s}(e,r,r.target,n,i,s))}const a=new jf,l=o?function(e,t){const i=Ff(e,t);return i?(0,Fa.DE)(i):void 0}(e,r):void 0;if(await Bf(e,r.target,l,a,i),isFinite(a.boundingBox[0])){let t;if((0,Mf.be)(a.boundingBox,Zf),em.x=Zf[0],em.y=Zf[1],em.z=Zf[2],em.spatialReference=e.spatialReference,isFinite(em.z)&&a.hasZ?t=(0,Mf.wp)(a.boundingBox):(em.z=void 0,t=(0,Ds.wp)((0,Mf.y8)(a.boundingBox,Yf))),o||t)return Gf(await Hf(e,r,em,n,i,s));const l=function(e,t){const i=.66;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let e=0;e<t.length;e++){const i=t[e].screenSpaceBoundingRect;r=Math.max(r,Math.abs(i[0]),Math.abs(i[1]),Math.abs(i[2]),Math.abs(i[3]))}return i-r/Math.min(e.width,e.height)*2}(e,a.screenSpaceObjects);return Gf(await async function(e,t,i,r,n,s,o,a){a.targetGeometry=i.clone();const l=(0,Lh.dP)(e),c=function(e,t,i,r,n){let s=0;null!=i.z?s=i.z:e.basemapTerrain&&e.elevationProvider&&(s=(0,Rf.KO)(e.elevationProvider,i)),(0,hr.i)(Zf,i.x,i.y,s),(0,Cf.B)(e.spatialReference,Zf,qf,e.renderSpatialReference),(0,gi.xO)(Wf,qf),(0,gi.p4)(Wf,Wf),(0,Mf.cS)($f);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let t=0;t<o.length;t++){const i=o[t];let n=r[i[2]];isFinite(n)||(n=s),(0,hr.i)(Zf,r[i[0]],r[i[1]],n),(0,Ef.S)(Zf,e.spatialReference,Zf,e.renderSpatialReference),(0,Mf.pp)($f,(0,hr.q)(Zf,Zf,Wf))}const a=(0,Mf.bf)($f),l=(0,Mf.Cb)($f),c=(0,Mf.Ye)($f),u=1/Math.tan(t.fovX/2),h=1/Math.tan(t.fovY/2),d=.5*Math.sqrt(a*a+c*c)*Math.max(h,u)+.5*l,p=.5*l*h+.5*Math.max(a,c);return Math.max(d,p)/n}(e,l,i,r,n);(0,ka.l0)(e,l,s);const u=Uf(s,t)?ka.Q8.LOCKED:ka.Q8.ADJUST;return a.camera=await(0,ka.gL)(e,a.targetGeometry,c,s,u,o),a.scale=(0,ka.Xt)(e,c),a}(e,r,em,a.boundingBox,l,n,i,s))}return r.position?Gf(await async function(e,t,i,r,n){const s=(0,Lh.dP)(e);(0,hr.c)(Jf,s.viewForward),(0,ka.t_)(e,s.eye,Jf,s.up,Qf);const o=e.spatialReference,{position:a}=t;if(a){const e=await(0,te.projectWithZConversion)(a,o,{signal:n});i.position=e}else i.position=new wi.Z;return i.heading=null!=t.heading?t.heading:Qf.heading,i.tilt=null!=t.tilt?t.tilt:Qf.tilt,kf(e,null,i,r)}(e,r,n,s,i)):Gf(await async function(e,t,i,r,n){if(null!=t.heading||null!=t.rotation||null!=t.scale||null!=t.tilt||null!=t.zoom||null!=t.zoomFactor){const s=(0,Lh.dP)(e),{spatialReference:o,renderSpatialReference:a}=e,l=new wi.Z({spatialReference:o});return(0,Sf.f)(s.center,a,l)?Hf(e,t,l,i,r,n):n}return n.scale=e.scale,n.camera=e.camera.clone(),Uf(n.camera,t),n}(e,r,n,i,s))}function Ff(e,t){return null==t.scale&&null!=t.zoom?(0,ka.EO)(e,t.zoom):t.scale}function Uf(e,t){let i=!1;return null!=t.heading?(e.heading=t.heading,i=!0):null!=t.rotation&&(e.heading=Of(t.rotation),i=!0),null!=t.tilt&&(e.tilt=t.tilt,i=!0),null!=t.fov&&(e.fov=t.fov),i}function kf(e,t,i,r){const n=e.spatialReference||Ie.Z.WGS84;if(t??=(0,ka.n3)(e,i),null==t)return r;const s=new wi.Z({spatialReference:n});return(0,Sf.f)(t.center,e.renderSpatialReference,s)?(r.targetGeometry=s,r.scale=(0,ka.Xt)(e,t.distance),r.rotation=Pf(i.heading),r.camera=i,r):r}async function zf(e,t,i,r){const n=()=>new c.Z("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!t)throw n();"mesh"===t.type&&(t=t.extent);const s=e.basemapTerrain.spatialReference;if(!t.hasZ&&e.basemapTerrain){let i;switch(t.type){case"point":i=t;break;case"multipoint":case"polyline":i=t.extent?.center;break;case"extent":i=t.center;break;case"polygon":i=t.centroid}null!=i&&s&&e.elevationProvider?(i=await(0,te.projectWithZConversion)(i,s,{signal:r}),Zf[2]=(0,Rf.KO)(e.elevationProvider,i)??0):Zf[2]=0}const o=tm[t.type],a=new Array;if(o(t,t.hasZ?e=>{a.push([e[0],e[1],e[2]])}:e=>{a.push([e[0],e[1]])},Zf),0===a.length)throw n();const l=t.spatialReference,u=e.spatialReference,h=await(0,te.projectWithZConversion)(new Tf.Z({spatialReference:l,hasZ:t.hasZ,hasM:!1,points:a}),u,{signal:r});if(t.hasZ&&(i.hasZ=!0),t.hasZ)for(const[e,t,r]of h.points)Zf[0]=e,Zf[1]=t,Zf[2]=r,(0,Mf.pp)(i.boundingBox,Zf);else for(const[e,t]of h.points)Zf[0]=e,Zf[1]=t,(0,Mf.pp)(i.boundingBox,Zf)}async function Bf(e,t,i,r,n){if(Array.isArray(t)&&2===t.length){const i=t[0],s=t[1];if("number"==typeof i&&"number"==typeof s)return em.x=i,em.y=s,em.z=void 0,em.spatialReference=e.spatialReference?.isGeographic?e.spatialReference:Ie.Z.WGS84,void await zf(e,em,r,n)}t&&"map"in t&&"function"==typeof t.map?await Promise.allSettled(t.map((t=>Bf(e,t,i,r,n)))):t instanceof xf.Z?await zf(e,t,r,n):t instanceof js.Z&&await async function(e,t,i,r,n){const s=await(0,be.q6)(e.whenViewForGraphic(t));if(!1===s.ok||null==s.value||!("whenGraphicBounds"in s.value))return void await zf(e,t.geometry,r,n);const o=s.value,a=await(0,be.q6)(o.whenGraphicBounds(t,{minDemResolution:i}));if(!1===a.ok||!a.value)return void await zf(e,t.geometry,r,n);const{screenSpaceObjects:l,boundingBox:c}=a.value;(0,Mf.TC)(r.boundingBox,c),l&&l.forEach((e=>{r.screenSpaceObjects.push(e)})),isFinite(c[2])&&(r.hasZ=!0)}(e,t,i,r,n)}async function Vf(e,t,i,r){const n=e.spatialReference,s=await(0,te.projectWithZConversion)(t.position,n,{signal:i}),o=t.clone();return o.position=s,kf(e,null,o,r)}async function Hf(e,t,i,r,n,s){s.targetGeometry=i.clone();const o=(0,Lh.dP)(e);if(t.position)return async function(e,t,i,r,n,s,o){const a=e.renderSpatialReference;return await(0,La.U)(t,Kf,a,0,{signal:o}),await(0,La.U)(i,Xf,a,0,{signal:o}),s.targetGeometry=new wi.Z(t),n.position=new wi.Z(i),(0,hr.d)(Jf,Kf,Xf),(0,ka.t_)(e,Xf,Jf,r.up,n),s.scale=(0,ka.Xt)(e,(0,hr.j)(Xf,Kf)),s.rotation=Pf(n.heading),s.camera=n,s}(e,s.targetGeometry,t.position,o,r,s,n);if(t.zoomFactor){const i=o.distance/t.zoomFactor,r=(0,hr.h)(Zf,o.viewForward,-i);o.eye=(0,hr.g)(Zf,o.center,r),s.scale=(0,ka.Xt)(e,i)}(0,ka.l0)(e,o,r);const a=Uf(r,t)?ka.Q8.LOCKED:ka.Q8.ADJUST;if(!t.zoomFactor){const i=Ff(e,t);if(null==i){await(0,La.U)(s.targetGeometry,Zf,e.renderSpatialReference,0,{signal:n});const t=(0,Af.g8)(o.frustum,Zf)?(0,hr.j)(o.eye,Zf):o.distance;s.camera=await(0,ka.gL)(e,s.targetGeometry,t,r,a),s.scale=(0,ka.Xt)(e,t)}else s.scale=i,s.camera=await(0,ka.UI)(e,s.targetGeometry,s.scale,r,a,n)}return s}function Gf(e){return null!=e?.camera&&(e.rotation=Pf(e.camera.heading)),e}class jf{constructor(){this.hasZ=!1,this.boundingBox=(0,Mf.cS)(),this.screenSpaceObjects=new Array}}const Zf=(0,Pa.Ue)(),qf=(0,Cl.Ue)(),Wf=(0,td.Ue)(),$f=(0,Mf.Ue)(),Yf=(0,Ds.Ue)(),Jf=(0,Pa.Ue)(),Xf=(0,Pa.Ue)(),Kf=(0,Pa.Ue)(),Qf={heading:0,tilt:0},em=new wi.Z,tm={point(e,t,i){i[0]=e.x,i[1]=e.y,null!=e.z&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let n=0;n<e.rings.length;n++){const s=e.rings[n];for(let e=0;e<s.length;e++)i[0]=s[e][0],i[1]=s[e][1],r&&(i[2]=s[e][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let n=0;n<e.paths.length;n++){const s=e.paths[n];for(let e=0;e<s.length;e++)i[0]=s[e][0],i[1]=s[e][1],r&&(i[2]=s[e][2]),t(i)}},multipoint(e,t,i){const r=e.points,n=e.hasZ;for(let e=0;e<r.length;e++)i[0]=r[e][0],i[1]=r[e][1],n&&(i[2]=r[e][2]),t(i)},extent(e,t,i){null!=e.zmin&&null!=e.zmax?(t((0,hr.i)(i,e.xmin,e.ymin,e.zmin)),t((0,hr.i)(i,e.xmax,e.ymin,e.zmin)),t((0,hr.i)(i,e.xmin,e.ymax,e.zmin)),t((0,hr.i)(i,e.xmax,e.ymax,e.zmin)),t((0,hr.i)(i,e.xmin,e.ymin,e.zmax)),t((0,hr.i)(i,e.xmax,e.ymin,e.zmax)),t((0,hr.i)(i,e.xmin,e.ymax,e.zmax)),t((0,hr.i)(i,e.xmax,e.ymax,e.zmax))):(t((0,hr.i)(i,e.xmin,e.ymin,i[2])),t((0,hr.i)(i,e.xmax,e.ymin,i[2])),t((0,hr.i)(i,e.xmin,e.ymax,i[2])),t((0,hr.i)(i,e.xmax,e.ymax,i[2])))}};class im{constructor(e,t,i){this._target=e,this._options=t,this.view=i,this.state="pending",this._animationController=null,this.promise=new Promise(((e,t)=>{this._resolveCallback=e,this._rejectCallback=t;const i=new AbortController;null!=this._options.signal&&(0,g.fu)(this._options.signal,(()=>this.abort())),this._abortController=i,this._waitForReady()}))}_resolve(e){if("finished"!==this.state)return this.state="finished",this._resolveCallback(e)}_reject(e){if("finished"!==this.state)return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),"wait-for-animation-finish"===this.state&&!e&&null!=this._animationController&&this.view.state.cameraController===this._animationController&&this._animationController.running&&this._animationController.stopController(),this._reject((0,g.zE)())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await(0,F.whenOnce)((()=>this.view.ready),this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if("finished"!==this.state){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await Nf(this.view,this._target,this._abortController.signal);if("finished"===this.state)return;const t=e?this._getCameraFromViewpoint(e):null;if(null==t)return;if(this._options.animate){if(null==this._animationController)return;this._startAnimation(t,this._animationController)}else this.view.stateManager.setStateCamera(t.camera,{applyConstraints:!t.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){const t=!!(this._target instanceof K.Z&&this._target.camera||this._target instanceof Sa.Z),i=e.camera;if(null==i)return null;if(!this.view.stateManager.isCompatible(i)){const e=i.position,t=e&&e.spatialReference,r=t?t.wkid:"none",n=this.view.spatialReference?.wkid;return this._reject(new c.Z("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${r}, view: ${n})`,{camera:i})),null}const r=(0,ka.n3)(this.view,i);return null==r?(this._reject(new c.Z("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:r,isFullySpecified:t}}_startAnimation(e,t){this.state="wait-for-animation-finish";const i=t.viewAnimation;if(null==i)return void this._reject(new c.Z("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!t.running||null==t.viewAnimation||t.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==t)return this.abort();let r;e.isFullySpecified?(r=new wf({view:this.view,desiredCamera:e.camera}),Dh(this.view,e.camera,Ih.EYE_AND_CENTER)):Jh(this.view,e.camera),t.begin(e.camera,this._options);const n=e=>{if(null!=this.view.state)switch(t.state){case md.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case md.Ready:case md.Rejected:case md.Running:case md.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(e)}}};i.when((()=>{const i=this.view.state.cameraController;r&&(i&&i.running?Td(i)&&null!=i.viewAnimation&&i.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=r):null!=t.viewAnimation&&t.viewAnimation.target===e.viewpoint&&t.state===md.Finished&&(this.view.state.cameraController=r))}),(e=>n(e))),t.asyncResult={resolve:()=>n(),reject:e=>n(e)}}_getAnimationController(){let e=null,t=null;const i=this.view.state.cameraController;return Td(i)&&(i.updateStateFromViewAnimation(),i.running&&(e=i,t=e.viewAnimation)),null==e&&(e=new bd({view:this.view,mode:"animation"}),t=e.viewAnimation,this.view.state.switchCameraController(e),e.state===md.Rejected)?(t?.stop(),this._reject(new c.Z("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null):e}}var rm=n(74533),nm=n(92238),sm=n(13727);let om=class extends P.Z{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=gm,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:e=>this._devicePixelRatioOverride=e,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return null!=this.renderState},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(e){this.viewStateManager._idleTimeout=e?gm:0}},this._propertiesPool=new sm.L({frustum:bf.i},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new am}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([(0,F.on)((()=>this.view.state.events),"before-camera-change",(e=>e&&this._updateElevation(e))),(0,F.watch)((()=>this.view.state?.camera),((e,t)=>this._cameraChangedHandler(e,t)),F.sync)]),(0,F.when)((()=>this.view.state?.camera),(e=>this._updateElevation(e)),{once:!0,sync:!0}),this.addHandles([(0,ue.A)({prepare:()=>this._prepareFrame()}),(0,F.watch)((()=>this.view.state.cameraController),(()=>{this._cameraSetByUser=!0,this.removeHandles(fm)})),(0,F.on)((()=>this.view.state.events),"camera-projection-changed",(()=>this.notifyChange("scale")))])}destroy(){this.exit(),this._propertiesPool=(0,m.SC)(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=(0,ka.l0)(this.view,this.view.state.camera,hm);return t&&e&&t.equals(e)?e:t.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableCache(!0),this.setStateCamera((0,ka.n3)(this.view,e),{applyConstraints:!1})||f.Z.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=(0,ka.l0)(this.view,this.view.state.contentCamera,hm);return t&&e&&t.equals(e)?e:t.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=(0,ka.n3)(this.view,e);null!=t?(this._updateElevation(t),this.view.state.contentCamera=t):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(mm),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=(0,Pa.nI)(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([(0,F.watch)((()=>this.contentCamera),(()=>{e.sticky||(this.removeHandles(mm),this.test.contentCameraResetState.clear())})),(0,F.watch)((()=>this.zoom),(e=>{void 0!==e&&void 0!==t&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(e-t)/2),Math.abs(e-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))})),(0,F.watch)((()=>this.view.state.camera),(e=>{const t=(0,hr.s)(r,e.center);this.test.contentCameraResetState.set("camera.center",t/i),t>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)}))],mm),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():f.Z.getLogger(this).error("#center=","Invalid center",e):f.Z.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):f.Z.getLogger(this).error("#center=","Center may not be null or undefined"))}get visibleArea(){if(!this.ready){const e=this._get("extent");return e?ee.Z.fromExtent(e):null}return(0,ka.ao)(this.view,this.view.pointsOfInterest.focus.renderLocation)}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=(0,ka.HH)(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return null!=t?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||f.Z.getLogger(this).error("#extent=","Invalid extent",e):f.Z.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):f.Z.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){const e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(!this.ready)return this._get("scale");const e=this.view.basemapTerrain.tilingScheme,t=this.view.pointsOfInterest.cameraOnSurface.scale;return e&&t?(0,ka.Br)(this.view,t,this.view.state.contentCamera,e):this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||f.Z.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),n=Math.round(t[rm.Np.TOP]/i),s=Math.round(t[rm.Np.RIGHT]/i),o=Math.round(t[rm.Np.BOTTOM]/i),a=Math.round(t[rm.Np.LEFT]/i);return null!=r&&r.top===n&&r.right===s&&r.bottom===o&&r.left===a?r:{top:n,right:s,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,pm),this.view.state.updateCamera((e=>e.padding=pm)))}_paddingToArray(e,t,i){e?(0,tf.s)(i,e.top||0,e.right||0,e.bottom||0,e.left||0):(0,tf.s)(i,0,0,0,0);for(let e=0;e<4;e++)i[e]=Math.round(i[e]*t)}get screenCenter(){const e=this.padding;return(0,$e.vW)((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?function(e,t,i=null){return null==i&&(i=new K.Z),kf(e,null,t.clone(),i)}(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||f.Z.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const t=null!=e.camera?e.camera.position:e.targetGeometry,i=null!=t&&t.spatialReference;f.Z.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else f.Z.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?(0,ka.sO)(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||void 0===e||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||f.Z.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),t=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*t),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*t);const i=this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;return i&&(0,Fl.d)(this._tmpCanvasSize,i),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:t,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return null!=this._devicePixelRatioOverride?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(nm.Y.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(nm.Y.PhysicalPixelRendering,Pi.n.IDLE)||e.isFeatureEnabled(nm.Y.PhysicalPixelRendering,Pi.n.INTERACTING)||e.isFeatureEnabled(nm.Y.PhysicalPixelRendering,Pi.n.ANIMATING))}preinit(e){return!(this._isOverridden("center")&&!(0,te.isLoadedOrLoadFor)(this.center.spatialReference,e)||this._isOverridden("camera")&&!(0,te.isLoadedOrLoadFor)(this.camera.position.spatialReference,e)||this._isOverridden("extent")&&!(0,te.isLoadedOrLoadFor)(this.extent.spatialReference,e)||!(!this._isOverridden("viewpoint")||(0,te.isLoadedOrLoadFor)(this.viewpoint.targetGeometry?.spatialReference,e)&&(0,te.isLoadedOrLoadFor)(this.viewpoint.camera?.position?.spatialReference,e)))}init(){this._constraintsManager=new _f({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this._cameraSetByUser){const e=this._initialViewpoint||this.view.initialExtent;e&&this.isCompatible(e)?this._setInitialView(e):this.view.state.viewingMode===$t.JY.Local&&this.addHandles((0,F.when)((()=>this.view.basemapTerrain.ready),(()=>{this.removeHandles(fm),this._setInitialView(this.view.dataExtent)}),{once:!0,initial:!0}),fm)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(fm),this._constraintsManager=(0,m.SC)(this._constraintsManager))}async goTo(e,t){return t={animate:!0,...t},null!=this._gotoOperation&&this._gotoOperation.abort(t.animate),this._gotoOperation=new im(e,t,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera((0,Lh.dP)(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t?.cameraController;i&&(t.updateCamera((t=>i.stepController(e,t))),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){null!=this._gotoOperation&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of cm){const n=e.has(i),s=this._isOverridden(i);!n&&s&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||s)&&r.forEach((t=>e.add(t)))}return t}_setInitialView(e){if(null==e||this._cameraSetByUser)return;if(e instanceof Sa.Z)return void this.setStateCamera((0,ka.n3)(this.view,e),{applyConstraints:!1});if(e instanceof K.Z){if(e.targetGeometry instanceof Oe.Z){const t=(0,ka.S9)(this.view,e.targetGeometry,0,.5,ka.Q8.LOCKED);return void(null!=t&&this.setStateCamera((0,ka.n3)(this.view,t),{applyConstraints:!0}))}const t={applyConstraints:!e.camera},i=this._viewpointToCamera(e);return void this.setStateCamera(i,t)}const t=(0,ka.S9)(this.view,e,0,.5,ka.Q8.LOCKED);null!=t&&this.setStateCamera((0,ka.n3)(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&lm.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return null!=e&&(e instanceof K.Z?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Sa.Z?this.isCompatible(e.position):e.spatialReference&&!(0,te.requiresLoad)(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=um){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=dm){const{heading:r,tilt:n}=this._getPreservingHeadingTilt(),s=(0,ka.P$)(this.view,r,n,e,t,ka.Q8.ADJUST);return null==s?null:(i.copyFrom(this.view.state.camera),i.eye=s.eye,i.center=s.center,i.up=s.up,i)}_centerToCamera(e){let t;if(e.hasZ)t=this.view.state.camera.distance;else{const{centerOnContent:e}=this.view.pointsOfInterest;e.runTask(),t=e.distance}return this._centerPointAtDistanceToCamera(e,t)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=(0,ka.S9)(this.view,e,t,i,ka.Q8.ADJUST,hm);return r?(0,ka.n3)(this.view,r):null}_scaleToCamera(e){if(null==e)return null;const t=this.view,i=t.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,n=t.pointsOfInterest.cameraOnSurface.renderLocation,s=(0,ka.cb)(t,e,t.state.contentCamera,r,n);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera((0,ka.EO)(this.view,e))}_viewpointToCamera(e){return(0,ka.n3)(this.view,If(this.view,e))}setStateCamera(e,t){return!(null==e||!this.view.state.stopActiveCameraController()||(this._cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera((i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up,i.fov=e.fov):i.copyFrom(e),t.applyConstraints&&Jh(this.view,i)})),t.applyConstraints||(this.view.state.cameraController=new wf({view:this.view,desiredCamera:e})),0))}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(0!==i.width&&0!==i.height&&(t.width===i.width&&t.height===i.height||(t.width=i.width,t.height=i.height),this.view.state)){const e=this.view.state.camera;e.fullWidth===i.width&&e.fullHeight===i.height&&e.pixelRatio===i.pixelRatio||(dm.copyFrom(e),dm.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,pm),dm.padding=pm),dm.fullWidth=i.width,dm.fullHeight=i.height,dm.pixelRatio=i.pixelRatio,this.view.state.camera=dm),this._updateViewState()}}_updateElevation(e){const t=this.view.basemapTerrain?.spatialReference,i=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,r=t?(0,Lh.wH)(this.view,e.eye):0;e.relativeElevation=i-r}_updateViewState(){null!=this.test.renderState?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Pi.n.ANIMATING:this.view.interacting?this.view.state.mode=Pi.n.INTERACTING:(this.view.state.mode===Pi.n.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Pi.n.INTERACTING:this.view.state.mode=Pi.n.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};(0,i._)([(0,y.Cb)({type:Sa.Z,dependsOn:["view.state.camera","ready"]})],om.prototype,"camera",null),(0,i._)([(0,y.Cb)({type:Sa.Z,dependsOn:["view.state.contentCamera","ready"]})],om.prototype,"contentCamera",null),(0,i._)([(0,y.Cb)({type:wi.Z})],om.prototype,"center",null),(0,i._)([(0,y.Cb)()],om.prototype,"visibleArea",null),(0,i._)([(0,y.Cb)({type:Oe.Z})],om.prototype,"extent",null),(0,i._)([(0,y.Cb)({readOnly:!0})],om.prototype,"frustum",null),(0,i._)([(0,y.Cb)()],om.prototype,"_constraintsManager",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],om.prototype,"constraintsManager",null),(0,i._)([(0,y.Cb)()],om.prototype,"_initialViewpoint",null),(0,i._)([(0,y.Cb)({readOnly:!0})],om.prototype,"hasInitialView",null),(0,i._)([(0,y.Cb)({readOnly:!0,type:Boolean})],om.prototype,"ready",void 0),(0,i._)([(0,y.Cb)({type:Number})],om.prototype,"scale",null),(0,i._)([(0,y.Cb)()],om.prototype,"padding",null),(0,i._)([(0,y.Cb)({readOnly:!0})],om.prototype,"screenCenter",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],om.prototype,"view",void 0),(0,i._)([(0,y.Cb)({type:K.Z})],om.prototype,"viewpoint",null),(0,i._)([(0,y.Cb)({type:Number})],om.prototype,"zoom",null),(0,i._)([(0,y.Cb)({readOnly:!0})],om.prototype,"_rasterPixelRatio",null),(0,i._)([(0,y.Cb)({readOnly:!0})],om.prototype,"_usePhysicalPixelRendering",null),(0,i._)([(0,y.Cb)({readOnly:!0})],om.prototype,"_usePhysicalPixelRenderingAny",null),(0,i._)([(0,y.Cb)()],om.prototype,"_windowDevicePixelRatio",void 0),(0,i._)([(0,y.Cb)()],om.prototype,"_devicePixelRatioOverride",void 0),om=(0,i._)([(0,v.j)("esri.views.3d.state.ViewStateManager")],om);class am{constructor(){this.width=0,this.height=0,this.pixelRatio=1}}const lm=new Set(["camera","viewpoint","extent","scale","center","zoom"]),cm=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],um={heading:0,tilt:0},hm=new Sa.Z,dm=new _d.Z,pm=(0,rf.Ue)(),fm="pending-initial-view",mm="content-camera-reset",gm=300;let ym=class extends gd{constructor(){super(...arguments),this.startCamera=new _d.Z,this.currentCamera=new _d.Z,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<100}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=md.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout((()=>this.notifyChange("isInteractive")),100),this.view.state.updateCamera((e=>this.stepController(0,e))),this.steppingFinished&&this.finishController()}};var _m;(0,i._)([(0,y.Cb)({readOnly:!0})],ym.prototype,"isInteractive",null),(0,i._)([(0,y.Cb)()],ym.prototype,"_lastInteraction",void 0),ym=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.InteractiveController")],ym),function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"}(_m||(_m={}));let vm=class extends ym{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=_m.CENTER,this._rotScale=0,this._lastPoint=(0,ui.Ue)(),this._tmpWorldUp=(0,Pa.Ue)(),this._tmpViewDir=(0,Pa.Ue)(),this._tmpRotCurPoint=(0,ui.Ue)(),this._tmpTransf=(0,Cl.Ue)(),this._tmpAxis=(0,Pa.Ue)(),this._tmpPivotPoint=(0,Pa.Ue)(),this._pivotPos=(0,Pa.Ue)(),this._constraintOptions=new dh(ah.ALL,lh.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===_m.CENTER?3:1.5}begin(e){if(this.running){switch(this.pivot){case _m.EYE:(0,hr.c)(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=lh.LOOK_AROUND,this._constraintOptions.tiltMode=ch.LOOK_AROUND,this._constraintOptions.selection=ah.NONE;break;case _m.CENTER:{const t=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?Hd:{});t||(0,hr.c)(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=lh.TUMBLE,this._constraintOptions.tiltMode=ch.TUMBLE,this._constraintOptions.selection=ah.ALL&~ah.DISTANCE;break}}Gd(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,t){const i=this.startCamera,r=(0,Pa.Ue)();(0,hr.d)(r,this._pivotPos,i.eye);const n=(0,hr.l)(r),s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,wm);let o=Math.max(Math.min(5,1/Math.abs((0,hr.f)(wm,i.viewForward)))*s,10);t&&(o=Math.min(n,o));const a=(0,$e.s1)(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=rp(this.startCamera,a,this.view.renderCoordsHelper,this.view.viewingMode);let c=this.view._stage.renderView.getMinimalDepthForArea((0,Yp.$L)(this.view),i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,225,90),u=this.view._stage.renderView.getMinimalDepthForArea((0,Yp.$L)(this.view),e[0],e[1],i,90);null==c&&null==u||(c=c??u??0,u=null==u||l===Qd.Horizontal?c:u,o=c>u?u:c,o=t?Math.min(o,n):o),(0,hr.n)(r,r),(0,hr.c)(this._pivotPos,(0,hr.g)(this._tmpPivotPoint,i.eye,(0,hr.h)(this._tmpPivotPoint,r,o)))}update(e){if(this.running){switch(this.pivot){case _m.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case _m.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Jh(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.running&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this._tmpWorldUp),Gd(e,t,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,s=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;(0,hr.d)(this._tmpViewDir,i,r);const o=(0,hr.l)(this._tmpViewDir),a=(0,yt.ZF)((0,hr.f)(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===_m.EYE){n*=-.5;const e=.5*Math.PI-a,t=.5*Math.PI*.99;n=e-Math.max(-t,Math.min(t,e+n))}return n=(0,yt.uZ)(n+a,ol.min,ol.max)-a,(0,hr.e)(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===_m.CENTER&&(s=-s),(0,Tl.Us)(this._tmpTransf,s,this._tmpWorldUp),(0,Tl.U1)(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),(0,hr.t)(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=(0,hr.t)(bm,e.up,this._tmpTransf),(0,hr.g)(bm,r,this._tmpViewDir),(0,ci.JG)(this._lastPoint,this._tmpRotCurPoint),bm}};(0,i._)([(0,y.Cb)()],vm.prototype,"pivot",void 0),vm=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.RotateController")],vm);const bm=(0,Pa.Ue)(),wm=(0,Pa.Ue)();class xm extends tr.a{constructor(e,t,i,r){super(!0),this._view=e,this.pointerActions=t,this._pivot=i,this.registerIncoming("drag",r,(e=>this._handleDrag(e)))}_handleDrag(e){const t=e.data;if(t.pointers.size>1)return;if(!nr(e.data,this.pointerActions))return;const i=(0,$e.s1)(t.center.x,t.center.y);switch(t.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new vm({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}}var Tm=n(90551);const Cm="esri-fov-overlay",Sm={base:Cm,outer:`${Cm}-outer`,reset:`${Cm}-reset`,text:`${Cm}-text`};let Em=class extends _o.Z{constructor(e){super(e),this.onReset=()=>{},this._messagesCommon=null,this._messagesUnits=null,this.fov=null}render(){return(0,Ro.u)("div",{class:Sm.outer},(0,Ro.u)("div",{class:Sm.base},(0,Ro.u)("p",{class:Sm.text},this._overlay),(0,Ro.u)("p",{class:Sm.reset,onclick:this.onReset,title:this._messagesCommon.reset},this._reset)))}get _overlay(){const{fov:e,_messagesUnits:t}=this;if(!t||null==e)return"";const i=(0,Tm.L4)((0,yt.BV)(e),"degrees","arithmetic","arithmetic",0),r=Mm/(2*Math.tan(e/2));return`${i} | ${(0,Tm.VG)(t,r,"millimeters",0,"abbr")} |`}get _reset(){return this._messagesUnits&&null!=this.fov?"":""}};(0,i._)([(0,y.Cb)()],Em.prototype,"onReset",void 0),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/t9n/common")],Em.prototype,"_messagesCommon",void 0),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/core/t9n/Units")],Em.prototype,"_messagesUnits",void 0),(0,i._)([(0,y.Cb)()],Em.prototype,"fov",void 0),(0,i._)([(0,y.Cb)()],Em.prototype,"_overlay",null),(0,i._)([(0,y.Cb)()],Em.prototype,"_reset",null),Em=(0,i._)([(0,v.j)("esri.widgets.FovOverlay")],Em);const Mm=Math.sqrt(1872);let Am=class extends ym{constructor(e){super(e),this.onStop=null,this._timeOutId=void 0,this._onReset=()=>{this._startSize=this._lastDrag=null,this._setFov(Rm),this.updateTimeout()},this._center=(0,Pa.Ue)(),this._viewForward=(0,Pa.Ue)(),this._constraints=new dh(ah.ALL,lh.ZOOM)}begin(e){!function(e){return!Array.isArray(e)}(e)?(this._lastDrag=e[1],this._startSize=null,this._ensureStartSize(this.view.state.camera)):this._showOverlay().fov=e.fov}updateTimeout(){clearTimeout(this._timeOutId),this._timeOutId=setTimeout(this.onStop,1500)}update(e){if(null==this._lastDrag)return this._lastDrag=e[1],this._startSize=null,void this._ensureStartSize(this.view.state.camera);const t=-(this._lastDrag-e[1])/2;this._lastDrag=e[1],this.step(t)}step(e){if(!this.running)return void(this._startSize=this._lastDrag=null);const t=this.view.state,i=this.currentCamera.copyFrom(t.camera),r=(0,yt.BV)(i.fov)+e,n=(0,yt.Vl)((0,yt.uZ)(r,Om,Pm));n!==i.fov?this._setFov(n):this._showOverlay().fov=i.fov}finish(){this.running&&(this._startSize=this._lastDrag=null,this.finishController())}destroy(){this.hideOverlay()}onControllerEnd(e){super.onControllerEnd(e),this._startSize=this._lastDrag=null,this.hideOverlay()}_showOverlay(){return this._overlay||(this._overlay=new ro({id:"esri.FovOverlay",node:new Em({onReset:this._onReset})}),this.view.ui.add(this._overlay)),this._overlay.widget}hideOverlay(){this._overlay&&(this.view.ui.remove(this._overlay),this._overlay=(0,m.SC)(this._overlay))}_setFov(e){const t=this.view.state,i=this.currentCamera.copyFrom(t.camera),r=this._ensureStartSize(i)/Math.tan(e/2),n=(0,hr.g)(Im,this._center,(0,hr.h)(Im,this._viewForward,-r));i.eye=n,i.fov=e,this._constraints.interactionStartCamera=t.camera,this._constraints.interactionFactor=Xh(this.currentCamera.height-t.camera.height),Jh(this.view,this.currentCamera,this._constraints),this.begin(i),this.commitCamera()}_ensureStartSize(e){if(null==this._startSize){(0,hr.c)(this._viewForward,e.viewForward);const t=this.view._stage.renderView.getMinimalDepthForArea(null,e.fullWidth/e.pixelRatio*.5,e.fullHeight/e.pixelRatio*.5,e,80),i=(0,hr.j)(e.eye,this.view.pointsOfInterest.centerOnContent.renderLocation),r=t??i;(0,hr.g)(this._center,e.eye,(0,hr.h)(Im,this._viewForward,r)),this._startSize=r*Math.tan(e.fov/2)}return this._startSize}};(0,i._)([(0,y.Cb)()],Am.prototype,"onStop",void 0),Am=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.FovController")],Am);const Rm=(0,yt.Vl)((new Sa.Z).fov),Om=10,Pm=150,Im=(0,Pa.Ue)();let Lm=class extends ym{constructor(){super(...arguments),this._pickPoint=(0,Pa.Ue)(),this._tmpP0=(0,ui.Ue)(),this._panAxisAngle=Rd(),this._tmpRayDir=(0,Pa.Ue)(),this._tmpRayDirPick=(0,Pa.Ue)(),this._targetOnSphere=(0,Pa.Ue)(),this._navMode=Qd.Horizontal,this._tmpRay={origin:(0,Pa.Ue)(),direction:(0,Pa.Ue)()},this.dragBeginPoint=(0,$e.s1)(),this._normalizedAnchorPoint=(0,ui.Ue)(),this._constraintOptions=new dh(ah.ALL_EXCEPT_COLLISION,lh.ZOOM,0,this.startCamera),this._sphere=(0,hh.c)(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;(0,ci.JG)(this.dragBeginPoint,e),Gd(this.startCamera,e,this._normalizedAnchorPoint);const t=(0,_l.Iu)(this.view.spatialReference),i=ip(this._intersectionHelper,this.startCamera,e,t,kd.Ellipsoid,0===this.view.map.ground.opacity?Hd:{});if(this._navMode=rp(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===Qd.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let t;(0,Nd.iE)(this.startCamera,e,this._tmpRay),(0,hr.n)(this._tmpRay.direction,this._tmpRay.direction),null!=i.scenePickPoint&&((0,hr.d)(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),t=(0,hr.l)(this._tmpRayDirPick));const r=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Nm);let n=(0,yt.uZ)(Math.min(30,1/Math.abs((0,hr.f)(Nm,this._tmpRay.direction)))*r,Bd[0],Bd[1]);const s=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,80);n=null!=s?s:n,n=null!=t?Math.min(n,t):n,this._hasPickPoint=!0,(0,hr.h)(this._tmpRay.direction,this._tmpRay.direction,n),(0,hr.g)(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.running){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Qd.Horizontal){(0,hr.d)(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=(0,hr.l)(this._tmpRayDir);Gd(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let r=t*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<n&&(r=n),Math.abs(t-r)<1e-6)return;if(this._hasPickPoint&&r<t){const e=1-(1-r/t)*(1-this._sphere[3]/(0,hr.l)(this.currentCamera.center));this.currentCamera.center=(0,hr.h)(Dm,this.currentCamera.center,e)}(0,hr.h)(this._tmpRayDir,this._tmpRayDir,-r/t),this.currentCamera.eye=(0,hr.g)(Dm,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Xh((0,ci.TE)(this.dragBeginPoint,e)),Jh(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(op(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Id(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Zd(this.currentCamera,(0,hh.a)(this._sphere),this._panAxisAngle))}else{const t=(0,hr.l)(this._tmpRay.direction);Gd(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let r=t*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<n&&(r=n),Math.abs(t-r)<1e-6)return;(0,hr.h)(this._tmpRayDir,this._tmpRay.direction,1-r/t),this.currentCamera.eye=(0,hr.g)(Dm,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=(0,hr.g)(Dm,this.currentCamera.center,this._tmpRayDir)}Dh(this.view,this.currentCamera),this.commitCamera()}}finish(){this.running&&this.finishController()}};Lm=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.ZoomControllerGlobal")],Lm);const Dm=(0,Pa.Ue)(),Nm=(0,Pa.Ue)();let Fm=class extends ym{constructor(){super(...arguments),this._tmpP=(0,Pa.Ue)(),this._tmpDir=(0,Pa.Ue)(),this._tmpN=(0,Pa.Ue)(),this._tmpP0=(0,ui.Ue)(),this._tmpPoi=(0,Pa.Ue)(),this._tmpRayDir=(0,Pa.Ue)(),this.dragBeginPoint=(0,$e.s1)(),this._normalizedAnchorPoint=(0,ui.Ue)(),this._constraintOptions=new dh(ah.ALL,lh.ZOOM,0,this.startCamera,(0,Pa.Ue)()),this._plane=(0,Dd.Ue)()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;(0,ci.JG)(this.dragBeginPoint,e),Gd(this.startCamera,e,this._normalizedAnchorPoint);const t=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,0===this.view.map.ground.opacity?Hd:{});(0,hr.d)(this._tmpDir,this._tmpP,this.startCamera.eye);const i=(0,hr.l)(this._tmpDir);(0,hr.n)(this._tmpDir,this._tmpDir);const r=Math.abs(this.view.camera.position.z);let n=(0,yt.uZ)(Math.min(30,1/Math.abs((0,hr.f)(km,this._tmpDir)))*r,Bd[0],Bd[1]);const s=this.view._stage.renderView.getMinimalDepthForArea((0,Yp.$L)(this.view),e[0],e[1],this.view.state.camera,80);n=null!=s?s:n,n=t?Math.min(n,i):n,(0,hr.h)(this._tmpDir,this._tmpDir,n),(0,hr.g)(this._tmpP,this.startCamera.eye,this._tmpDir),(0,hr.d)(this._tmpN,this.startCamera.eye,this.startCamera.center),(0,hr.n)(this._tmpN,this._tmpN),this._tmpN[1]<0&&(0,hr.v)(this._tmpN,this._tmpN),(0,Dd.Yq)(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.running)return;(function(e,t,i,r){return(0,Dd.BR)(e,(0,Nd.u4)(t,i,jp),r)})(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||(0,hr.c)(this._tmpPoi,this.currentCamera.center),Gd(this.currentCamera,e,this._tmpP0);let t=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);(0,ci.JG)(this._normalizedAnchorPoint,this._tmpP0),(0,hr.d)(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=(0,hr.l)(this._tmpRayDir);let r=i*(1-t);this._constraintOptions.interactionDirection&&((0,hr.c)(this._constraintOptions.interactionDirection,this._tmpRayDir),(0,hr.h)(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(t)/i));const n=this.view.state.constraints.minimumPoiDistance;t>=0&&r<n&&(r=n,t=-(r-i)/i),Math.abs(i-r)<1e-6||((0,hr.h)(this._tmpRayDir,this._tmpRayDir,t),this.currentCamera.eye=(0,hr.g)(Um,this.currentCamera.eye,this._tmpRayDir),(0,hr.m)(Um,this.currentCamera.center,this._tmpPoi,t),this._tmpPoi[2]>this.startCamera.center[2]?Um[2]=Math.max(this.startCamera.center[2],Um[2]):Um[2]=Math.min(this.startCamera.center[2],Um[2]),this.currentCamera.center=Um,this._constraintOptions.interactionFactor=Xh((0,ci.TE)(this.dragBeginPoint,e)),Jh(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}finish(){this.running&&this.finishController()}};Fm=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.ZoomControllerLocal")],Fm);const Um=(0,Pa.Ue)(),km=(0,Pa.al)(0,0,1);class zm extends tr.a{constructor(e,t,i){super(!0),this._view=e,this.pointerActions=t,this._fovModifier=i,this.registerIncoming("drag",[i],(e=>this._handleZoom(e))),this.registerIncoming("drag",(e=>this._handleZoom(e)))}_handleZoom(e){const t=e.data;if(t.pointers.size>1)return;if(!nr(e.data,this.pointerActions))return;const i=(0,$e.s1)(t.center.x,t.center.y);switch(t.action){case"start":{this._cameraController?.finish();const t=this._view,r=e.modifiers.has(this._fovModifier);this._cameraController=r?new Am({view:t,onStop:()=>this._stopController()}):t.state.isGlobal?new Lm({view:t}):new Fm({view:t}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break}case"update":this._cameraController?.update(i);break;case"end":this._cameraController instanceof Am?this._cameraController.updateTimeout():this._stopController()}e.stopPropagation()}_stopController(){this._cameraController?.finish(),this._cameraController=null}}var Bm=n(20101);let Vm=class extends ym{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new _d.Z,this._headingStart=0,this._constraintOptions=new dh(ah.ALL,lh.NONE,0,new _d.Z,null,ch.LOOK_AROUND)}handleEventGamepad(e){const t=pr(e,this.view.navigation.gamepad,this._transformation);("end"===e.action||mr(t))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,fr(this._keysButtonState,this._transformation)}directionActive(e){return 1===this._keysButtonState[e]}countActiveDirections(){return this._keysButtonState.reduce(((e,t)=>t>0?e+1:e),0)}deactivateDirection(e){this._keysButtonState[e]=0;mr(fr(this._keysButtonState,this._transformation))&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z;this._filteredSurfaceElevation+=1*(t-this._filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Ym),this._applyDisabledMovementTypes(Ym),this._applyPan(Ym.pan),this._applyRotate(Ym.rotate),this._applyZoom(Ym.zoom),this._applyAscend(Ym.ascend),this._constraintOptions.interactionType=lh.NONE,this._constraintOptions.selection=ah.COLLISION,Jh(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,t)}_updateStartHeading(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;(0,hr.d)(Jm,t.center,t.eye),(0,hr.t)(Jm,Jm,e.matrix),t.center=(0,hr.g)(Jm,Jm,t.eye),t.up=(0,hr.t)(Jm,t.up,e.matrix),this._constraintOptions.interactionType=lh.LOOK_AROUND,this._constraintOptions.selection=ah.ALL_EXCEPT_COLLISION,Jh(this.view,t,this._constraintOptions)}_applyPan(e,t=this.currentCamera){e.enabled&&(t.eye=(0,hr.t)(Jm,t.eye,e.matrix),t.center=(0,hr.t)(Jm,t.center,e.matrix),this.view.state.isGlobal&&(t.up=(0,hr.t)(Jm,t.up,e.matrix)),this._constraintOptions.interactionType=lh.PAN,this._constraintOptions.selection=ah.ALL,Jh(this.view,t,this._constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=(0,hr.g)(Jm,this.currentCamera.eye,(0,hr.h)(Ad.WM.get(),t,e)),(0,hr.c)(Xm,t),(0,hr.v)(Xm,Xm),this._constraintOptions.interactionDirection=Xm,this._constraintOptions.interactionType=lh.ZOOM,this._constraintOptions.selection=ah.ALL_EXCEPT_COLLISION,Jh(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ad.WM.get());if(this._constraintOptions.interactionDirection=(0,hr.c)(Xm,t),this.view.state.isGlobal){const t=(0,hr.l)(this.currentCamera.eye),i=(t+e)/t;this.currentCamera.eye=(0,hr.h)(Jm,this.currentCamera.eye,i),this.currentCamera.center=(0,hr.h)(Jm,this.currentCamera.center,i)}else{const i=(0,hr.h)(Ad.WM.get(),t,e);this.currentCamera.eye=(0,hr.g)(Jm,this.currentCamera.eye,i),this.currentCamera.center=(0,hr.g)(Jm,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=lh.ASCEND,this._constraintOptions.selection=ah.COLLISION,Jh(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=ah.ALL_EXCEPT_COLLISION,Jh(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){!function(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,(0,Tl.yR)(e.pan.matrix),e.rotate.enabled=!1,(0,Tl.yR)(e.rotate.matrix)}(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,Jm)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:n}=t,s=this._transformation,o=this.view.navigation.gamepad,a=(0,hr.i)(Ad.WM.get(),n[0],n[1],0);(0,hr.n)(a,a);const c=s.translation[0]*e.pan;if(0!==c){const e=(0,hr.h)(Ad.WM.get(),r,c);(0,Tl.Iu)(i.pan.matrix,i.pan.matrix,e),i.pan.enabled=!0}switch(o.mode){case"pan":{const t=-s.translation[1]*e.pan;if(0!==t){const e=(0,hr.h)(Ad.WM.get(),a,t);(0,Tl.Iu)(i.pan.matrix,i.pan.matrix,e),i.pan.enabled=!0}i.zoom=s.zoom*e.zoom;break}case"zoom":i.zoom=(-s.translation[1]+s.zoom)*e.zoom;break;default:(0,l.Bg)(o.mode)}const u=s.translation[2]*e.ascend;i.ascend=u;const h=-s.heading*e.rotate;0!==h&&((0,Tl.U1)(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Ad.WM.get())),i.rotate.enabled=!0);const d=s.tilt*e.rotate,p=(0,Uh.L)(this.view.renderCoordsHelper,t.center,t.eye),f=(0,yt.uZ)(p+d,ol.min,ol.max)-p;f&&((0,Tl.U1)(i.rotate.matrix,i.rotate.matrix,f,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:n}=t,s=this._transformation,o=this.view.navigation.gamepad,a=(0,hr.e)(Ad.WM.get(),n,r);(0,hr.n)(a,a),(0,hr.v)(a,a),Cp(this.startCamera,t,s,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Ym.pan,this._tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=s.translation[2]*e.ascend;i.ascend=c;const u=-s.heading*e.rotate;0!==u&&((0,Tl.U1)(i.rotate.matrix,i.rotate.matrix,u,this._tmpCamera.eye),i.rotate.enabled=!0);const h=s.tilt*e.rotate,d=this._clampTiltDeltaGlobalToValidRange(h,t.ray,l);0!==d&&((0,Tl.U1)(i.rotate.matrix,i.rotate.matrix,d,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=s.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=(0,_l.Iu)(this.view.spatialReference),n=Xd(ol.min,t.origin,i,r);let s=0,o=0;const a=Ad.WM.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){s=Xd((0,Uh.L)(this.view.renderCoordsHelper,a,t.origin),t.origin,i,r),o=Xd(ol.max,t.origin,i,r)}else{(0,hh.k)((0,hh.b)(hh.t,i+r.radius),t,a);s=Kd(Math.PI+(0,Md.EU)(t.direction,a),t.origin,i,r),o=Kd(ol.max,t.origin,i,r)}return(0,yt.uZ)(s+e,n,o)-s}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,n=r.getAltitude(e),s=t+Math.abs(n-t);return r.setAltitude(i,s,e),s}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:n}=(0,ka.kE)(this.view,t,0,Gm,Km),s=i.intersectManifoldClosestSilhouette((0,uh.re)(t,n),e,Ad.WM.get()),o=(0,hr.j)(t,s),a=i.intersectManifoldClosestSilhouette((0,uh.re)(t,(0,hr.o)(Ad.WM.get(),t,r.center)),e,Ad.WM.get()),l=(0,hr.j)(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:n}=i,s=t.intersectManifoldClosestSilhouette(r.ray,this._filteredSurfaceElevation,Ad.WM.get());if(n){const t=(0,hr.d)(Ad.WM.get(),e,s),i=(0,hr.l)(t);(0,hr.h)(t,t,1/i);const r=(0,hr.n)(Ad.WM.get(),e),n=(0,yt.ZF)((0,hr.f)(r,t));return i*Math.sin(Math.min(jm,n))}{const i=(0,hr.c)(Ad.WM.get(),e);return t.setAltitude(i,this._filteredSurfaceElevation),(0,hr.j)(s,i)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:qm}_computeVelocities(e){const t=this._filteredSurfaceElevation,i=t+(0,_l.Iu)(this.view.spatialReference).radius,{camera:r,isGlobal:n}=this.view.state,s=Ad.WM.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,s),a=this._clampedDistanceToSurface(t,s),l=r.width/2,c=Zm*r.width,u=Zm*r.width,h=a*Math.tan(.5*r.fovX)/l,d=h/i,p=h/this._computeHeadingRotateRadius(s),f=o-t;return{pan:(n?d:h)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*f-f),zoom:2**(c*e/l)*a-a,rotate:(0,yt.uZ)(p*u,Wm,$m)*e}}_applyDisabledMovementTypes(e){null==this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&(0,Tl.yR)(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&(0,Tl.yR)(e.rotate.matrix))}static activatesFor(e,t){const i=pr(t,e.navigation.gamepad,Hm);return!("end"===t.action||mr(i))}};(0,i._)([(0,y.Cb)({constructOnly:!0})],Vm.prototype,"gamepadDevice",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Vm.prototype,"disableMovements",void 0),Vm=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.GamepadKeyboardController")],Vm);const Hm={translation:[0,0,0],heading:0,tilt:0,zoom:0},Gm=80,jm=(0,yt.Vl)(Gm),Zm=.75,qm=5,Wm=(0,yt.Vl)(30),$m=(0,yt.Vl)(80),Ym={zoom:0,ascend:0,pan:{enabled:!1,matrix:(0,Cl.Ue)()},rotate:{enabled:!1,matrix:(0,Cl.Ue)()}},Jm=(0,Pa.Ue)(),Xm=(0,Pa.Ue)(),Km=(0,Bm.dp)();class Qm extends tr.a{constructor(e){super(!0),this._view=e,this._watchHandles=new Me.Z,this._handle=this.registerIncoming("gamepad",(e=>this._handleEventGamepad(e))),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([(0,F.watch)((()=>this._view.navigation.gamepad.enabled),(e=>{e?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))}),F.initial),(0,F.watch)((()=>this._view.navigation.gamepad.device),(e=>{this._cameraControllerGamepad&&e&&this._cameraControllerGamepad.gamepadDevice!==e&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)}))])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const t=this._view.navigation.gamepad.device;if(t&&e.data.device!==t)return;const i=this._cameraControllerGamepad?.running;if(i||Vm.activatesFor(this._view,e.data)){if(!i){const t=new Vm({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(t),t.state!==md.Rejected&&(this._cameraControllerGamepad=t)}this._cameraControllerGamepad&&this._cameraControllerGamepad.running&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}}var eg;!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"}(eg||(eg={}));class tg extends tr.a{constructor(e,t){super(!0),this._view=e,this._keyToDirection=new Map,this._keyToAction=new Map,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:$t.JY.Local},this._stickyKeyTimeoutHandle=void 0,this._stickyKeyDuration=200,this._addKeysMapping(t),this.registerIncoming("key-down",null,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",null,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",null,(()=>this._handleStop())),this._visibilityHandle=br((e=>e?null:this._handleStop()))}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}setStickyKeyDuration(e){this._stickyKeyDuration=e}_addKeysMapping(e){this._addKeyMapping(e.pan.left,eg.LEFT),this._addKeyMapping(e.pan.right,eg.RIGHT),this._addKeyMapping(e.pan.forward,eg.FORWARD),this._addKeyMapping(e.pan.backward,eg.BACKWARD),this._addKeyMapping(e.pan.up,eg.UP),this._addKeyMapping(e.pan.down,eg.DOWN),this._addKeyMapping(e.lookAround.headingLeft,eg.HEADINGLEFT),this._addKeyMapping(e.lookAround.headingRight,eg.HEADINGRIGHT),this._addKeyMapping(e.lookAround.tiltUp,eg.TILTUP),this._addKeyMapping(e.lookAround.tiltDown,eg.TILTDOWN),this._addKeyMapping(e.zoom.zoomIn,eg.ZOOMIN),this._addKeyMapping(e.zoom.zoomOut,eg.ZOOMOUT),this._addKeyAction(e.reset.heading,(()=>this._resetHeading())),this._addKeyAction(e.reset.tilt,(()=>this._resetTilt()))}_addKeyMapping(e,t){for(const i of this._eachKey(e))this._keyToDirection.set(i,t)}*_eachKey(e){"string"==typeof e?yield e:yield*e}_addKeyAction(e,t){for(const i of this._eachKey(e))this._keyToAction.set(i,t)}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this._keyToAction.get(e.data.key);if(null!=t)return e.stopPropagation(),void t();const i=this._keyToDirection.get(e.data.key);if(null!=i&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.running||(this._cameraControllerKeyboard=new Vm({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.running)){if(e.stopPropagation(),this._cameraControllerKeyboard.directionActive(i))return;if(this._cameraControllerKeyboard.activateDirection(i),this._cameraControllerKeyboard.countActiveDirections()>1||!this._isPanning(i))return;this._stickyKeyDuration>0&&(this._stickyKeyTimeoutHandle=setTimeout((()=>{this._stickyKeyTimeoutHandle=void 0,null!=this._stickyDirection&&void 0!==this._stickyDirection&&(this._cameraControllerKeyboard?.deactivateDirection(this._stickyDirection),this._stickyDirection=void 0)}),this._stickyKeyDuration))}}_handleStop(){this._cameraControllerKeyboard?.running&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey||!this._cameraControllerKeyboard?.running)return;const t=this._keyToDirection.get(e.data.key);if(null==t)return;e.stopPropagation();const i=void 0===this._stickyKeyTimeoutHandle;void 0===this._stickyKeyTimeoutHandle||1!==this._cameraControllerKeyboard?.countActiveDirections()?(this._cameraControllerKeyboard?.deactivateDirection(t),i&&(this._stickyDirection=void 0)):this._stickyDirection=t}_isPanning(e){return e<=3}_resetHeading(){this._view.goTo({heading:0}).catch((()=>{}))}_resetTilt(){this._view.goTo({tilt:0}).catch((()=>{}))}}class ig extends tr.a{constructor(e,t){super(!0),this._view=e,this.registerIncoming("mouse-wheel",[t],(e=>this._handleFov(e))),this.registerIncoming("mouse-wheel",(e=>this._handleZoom(e)))}_handleZoom(e){if(!this._mouseWheelZoomEnabled)return;const t=e.data;this._zoomController?.running||(this._stopFovController(),this._zoomController=this._view.state.isGlobal?new qp({view:this._view,mode:"interaction"}):new Jp({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._zoomController)),this._zoomController.step(-t.deltaY/60,(0,$e.s1)(t.x,t.y)),e.preventDefault(),e.stopPropagation()}_handleFov(e){this._mouseWheelZoomEnabled&&(this._fovController?.running||(this._zoomController?.finish(),this._fovController?.hideOverlay(),this._fovController=new Am({view:this._view,onStop:()=>this._stopFovController()}),this._view.state.switchCameraController(this._fovController),this._fovController.state!==md.Rejected)?(this._fovController.updateTimeout(),this._fovController.step(e.data.deltaY/20),e.preventDefault(),e.stopPropagation()):this._stopFovController())}get _mouseWheelZoomEnabled(){return"zoom"===this._view.navigation.actionMap.mouseWheel}_stopFovController(){this._fovController?.finish(),this._fovController=null}}class rg{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return void 0===this._value?0:this._value}update(e){void 0===this._value?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}}let ng=class extends yd{constructor(){super(...arguments),this._beginCamera=new _d.Z,this._elapsedTimeSec=0,this.constraintOptions=new dh(ah.ALL,lh.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new Ni}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,t),Jh(this.view,t,this.constraintOptions)}};ng=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.momentum.MomentumController")],ng);let sg=class extends ng{constructor(e){super(e),this.interactionType=lh.PAN,this._tmpPan=(0,Pa.Ue)()}momentumStep(e,t){const i=this.momentum.value(e);(0,hr.h)(this._tmpPan,this.momentum.direction,i),t.eye=(0,hr.d)(og,t.eye,this._tmpPan),t.center=(0,hr.d)(og,t.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};(0,i._)([(0,y.Cb)({constructOnly:!0})],sg.prototype,"momentum",void 0),sg=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],sg);const og=(0,Pa.Ue)(),ag=(0,Pa.Ue)(),lg=(0,Pa.Ue)();let cg=class extends ng{constructor(e){super(e),this.interactionType=lh.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);(0,hr.c)(lg,t.eye),(0,hr.n)(lg,lg),(0,hr.e)(this.momentum.axis2,lg,this.momentum.axis1),mp(t,ag,this.momentum.axis1,i,this.momentum.axis2,r)}};(0,i._)([(0,y.Cb)({constructOnly:!0})],cg.prototype,"momentum",void 0),cg=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],cg);let ug=class extends ng{set center(e){this._set("center",(0,Pa.d9)(e))}set axis(e){this._set("axis",(0,Pa.d9)(e))}constructor(e){super(e),this.interactionType=lh.TUMBLE}momentumStep(e,t){const i=this.momentum.value(e);Zd(t,this.center,Od(this.axis,i))}};(0,i._)([(0,y.Cb)({constructOnly:!0})],ug.prototype,"momentum",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],ug.prototype,"center",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],ug.prototype,"axis",null),ug=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.momentum.RotationMomentumController")],ug);let hg=class extends ng{set zoomCenter(e){this._set("zoomCenter",(0,Pa.d9)(e))}constructor(e){super(e),this.interactionType=lh.ZOOM,this.constraintOptions.interactionDirection=(0,Pa.Ue)()}momentumStep(e,t){const{interactionDirection:i}=this.constraintOptions;if(!i)return;(0,hr.c)(i,t.eye);const r=this.momentum.valueDelta(0,e);Wd(t,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),(0,hr.o)(i,t.eye,i)}};(0,i._)([(0,y.Cb)({constructOnly:!0})],hg.prototype,"momentum",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],hg.prototype,"zoomCenter",null),hg=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],hg);let dg=class extends ng{set screenCenter(e){this._set("screenCenter",(0,$e.s1)(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",(0,Pa.d9)(e))}constructor(e){super(e),this.interactionType=lh.ZOOM,this.radius=0,this._tmpSceneCenter=(0,Pa.Ue)(),this._tmpZoomAxisAngle=Rd(),this._sphere=(0,hh.c)()}initialize(){this._sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);$d(this._sphere,t,i),this.constraintOptions.interactionType=lh.ZOOM,Jh(this.view,t,this.constraintOptions),op(this._sphere,t,this.screenCenter,this._tmpSceneCenter),Id(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Zd(t,(0,hh.a)(this._sphere),this._tmpZoomAxisAngle),this.constraintOptions.interactionType=lh.PAN}};(0,i._)([(0,y.Cb)({constructOnly:!0})],dg.prototype,"momentum",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],dg.prototype,"screenCenter",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],dg.prototype,"sceneCenter",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],dg.prototype,"radius",void 0),dg=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],dg);var pg=n(73578),fg=n(20296);class mg{constructor(e){this._gain=e}update(e){void 0!==this.filteredValue?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}var gg=n(98120);const yg=1e-5;class _g extends gg.X{constructor(e,t,i,r,n,s=0,o){super(e,t,i),this._angularVelocity1=r,this.axis1=n,this.angularVelocity2=s,this.axis2=o}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}}class vg{constructor(e=300,t=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=i,this.enabled=!0,this._tmpAxis1=(0,Pa.Ue)(),this._tmpAxis2=(0,Pa.Ue)(),this._tmpAngles=(0,ui.Ue)(),this._time=new fg.J(.3),this._screen=[new fg.J(.4),new fg.J(.4)],this._angle1=new mg(.6),this._angle2=new mg(.6),this._axis1=(0,Pa.Ue)(),this._axis2=(0,Pa.Ue)(),this._lastScene=(0,Pa.Ue)()}addMomentumDirectRotation(e,t,i,r,n,s){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let e=up(this._lastScene,t,this._tmpAxis2,r,n,s);this._angle2.update(0),(0,hr.k)(this._tmpAxis2)<yg?e=0:(0,hr.n)(this._axis1,this._tmpAxis2),this._angle1.update(e),(0,hr.c)(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,t,i,r,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;pp(this._lastScene,t,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,r,n,s,o,!1),(0,hr.k)(this._tmpAxis2)<yg?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),(0,hr.n)(this._axis1,this._tmpAxis1),(0,hr.n)(this._axis2,this._tmpAxis2)),(0,hr.c)(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,i=null==e||null==t?null:Math.sqrt(e*e+t*t),r=this._time.filteredDelta,n=null==i||null==r?0:i/r;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,t,i){const r=this._time.filteredDelta,n=this._angle1.filteredValue,s=this._angle2.filteredValue,o=null==r||null==s?0:s/r;return new _g(e,t,i,null==r||null==n?0:n/r,this._axis1,o,this._axis2)}}var bg=n(48991),wg=n(5672);let xg=class extends ym{constructor(){super(...arguments),this._smoothRotation=new rg(.05),this._rotationAxis=(0,Pa.Ue)(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=(0,Dd.Ue)(),this._beginRadius=0,this._smoothScaling=new rg(.05),this._zoomCenterScreen=(0,$e.s1)(),this._zoomMomentumEstimator=new wg.D,this._rotationMomentumEstimator=new bg.y,this._panSphericalMomentumEstimator=new vg,this._panPlanarMomentumEstimator=new pg.G,this._adjustedSphere=(0,hh.c)(),this._tmp3d=(0,Pa.Ue)(),this._tmpScreenPointArray=(0,$e.s1)(),this._beginScreenPoint=(0,$e.s1)(),this._beginScenePoint=(0,Pa.Ue)(),this._screenPickPoint=(0,$e.s1)(),this._scenePickPoint=(0,Pa.Ue)(),this._navMode=Qd.Horizontal,this._sphere=(0,hh.c)(),this._pointerCount=0,this._tmpInteractionDirection=(0,Pa.Ue)(),this._beginCamera=new _d.Z,this._constraintOptions=new dh(ah.ALL,lh.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-Cd.Q4.normalize((0,yt.Vl)(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),(0,$e.md)(e.center,this._screenPickPoint),(0,ci.JG)(this._beginScreenPoint,this._screenPickPoint);const t=(0,_l.Iu)(this.view.spatialReference),i=ip(this._intersectionHelper,this.startCamera,this._screenPickPoint,t,kd.Silhouette,0===this.view.map.ground.opacity?Hd:{});null!=i.scenePickPoint&&(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,(0,hr.c)(this._beginScenePoint,this._scenePickPoint),this._navMode=rp(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===Qd.Vertical&&this._preparePlanarPanMode(e,i.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this._navMode===Qd.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return this._navMode===Qd.Horizontal?new dg({view:this.view,momentum:t,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new hg({view:this.view,momentum:t,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new ug({view:this.view,momentum:i,center:(0,hh.a)(this._sphere),axis:this._rotationAxis});if(this._navMode===Qd.Horizontal){const e=this._panSphericalMomentumEstimator.evaluateMomentum();if(e)return new cg({view:this.view,momentum:e})}else{const e=this._panPlanarMomentumEstimator.evaluateMomentum();if(e)return new sg({view:this.view,momentum:e})}return null}_preparePlanarPanMode(e,t){const i=(0,hr.v)(this._tmp3d,this.startCamera.viewForward);(0,Dd.Yq)(this._scenePickPoint,i,this._panningPlane);const r=(0,$e.s1)(this._screenPickPoint[0],0),n=(0,Pa.Ue)(),s=(0,hr.l)(this.startCamera.eye);this._adjustedSphere[3]=s<this._sphere[3]?s-100:this._sphere[3],op(this._adjustedSphere,this.startCamera,r,n);const o=(0,$e.J$)();this.startCamera.projectToRenderScreen(n,o);const a=(0,Pa.Ue)(),l=(0,Pa.Ue)(),c=(0,Pa.Ue)();(0,hr.d)(a,this._scenePickPoint,this.currentCamera.eye);const u=(0,hr.l)(a);(0,hr.n)(a,a);const h=5*Math.max(Math.abs(this.view.camera.position.z),50),d=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,80);let p=null!=d?d:h;p=t?Math.min(p,u):p,(0,hr.c)(c,(0,hr.g)(l,this.currentCamera.eye,(0,hr.h)(l,a,p))),this._panningPlane[3]=-(0,hr.f)((0,Dd.st)(this._panningPlane),c),this.startCamera.center=(0,hr.g)(l,this.startCamera.eye,(0,hr.h)(l,this.startCamera.viewForward,p));const f=(0,$e.md)(e.center,this._tmpScreenPointArray);qd(this._panningPlane,this.startCamera,f,this._beginScenePoint)}_zoomSpherical(e){const t=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(t),$d(this._sphere,this.currentCamera,this._smoothScaling.value),(0,$e.md)(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=lh.ZOOM,this._constraintOptions.interactionFactor=Xh(e.radius-this._beginRadius),Jh(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const t=(0,$e.md)(e.center,this._tmpScreenPointArray);op(this._sphere,this.currentCamera,t,this._tmp3d),wp(this._beginScenePoint,(0,hr.f)(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera.aboveGround)?(Tp(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(xp(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=lh.PAN,this._constraintOptions.interactionFactor=Xh((0,ci.TE)(this._screenPickPoint,t)),Jh(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){(0,hr.n)(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||(0,hr.v)(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value,i=t+jd(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=r,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),Zd(this.currentCamera,(0,hh.a)(this._sphere),Od(this._rotationAxis,n)),this._constraintOptions.interactionType=lh.TUMBLE,this._constraintOptions.interactionFactor=Xh(e.radius*i),Jh(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const t=(0,$e.md)(e.center,this._tmpScreenPointArray);qd(this._panningPlane,this.currentCamera,t,this._tmp3d)&&(np(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(t,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=lh.PAN,this._constraintOptions.interactionFactor=Xh((0,ci.TE)(this._beginScreenPoint,t)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Jh(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(t),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Wd(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=lh.ZOOM,this._constraintOptions.interactionFactor=Xh(e.radius-this._beginRadius),Jh(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){(0,hr.c)(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||(0,hr.v)(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value;let i=e.angle-t;i=jd(i);const r=t+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(r);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),Zd(this.currentCamera,(0,hh.a)(this._sphere),Od(this._rotationAxis,s)),this._constraintOptions.interactionType=lh.TUMBLE,this._constraintOptions.interactionFactor=Xh(e.radius*s),Jh(this.view,this.currentCamera,this._constraintOptions)}};xg=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],xg);const Tg=(0,Pa.al)(0,0,1);let Cg=class extends ym{constructor(){super(...arguments),this._rotationValueSmooth=new rg(.05),this._scalingValueSmooth=new rg(.05),this._planeHorizontal=(0,Dd.Ue)(),this._planeVertical=(0,Dd.Ue)(),this._rotationMomentumEstimator=new bg.y,this._panMomentumEstimator=new pg.G(300,12,.9),this._zoomMomentumEstimator=new wg.D,this._beginRadius=0,this._beginCenter=(0,Pa.Ue)(),this._beginAngle=0,this._tmpPoints=[],this._navMode=Qd.Horizontal,this._beginCenterScreen=(0,$e.s1)(),this._tmpCentroid3d=(0,Pa.Ue)(),this._tmpCentroid2d=(0,$e.s1)(),this._tmp2d=(0,$e.s1)(),this._pointerCount=0,this._beginCamera=new _d.Z,this._constraintOptions=new dh(ah.ALL,lh.NONE,0,this._beginCamera)}begin(e){if(!this.running)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panMomentumEstimator.enabled=t,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),(0,$e.md)(e.center,this._beginCenterScreen),(0,Dd.Oy)(Tg,0,this._planeHorizontal);const i=(0,Pa.Ue)(),r=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,0===this.view.map.ground.opacity?Hd:{}),n=(0,Pa.Ue)();(0,hr.v)(n,this.startCamera.viewForward);const s=(0,Pa.Ue)();(0,hr.c)(s,Tg);const o=(0,hr.f)(n,s);this._navMode=rp(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const a=Math.min(5,1/Math.abs((0,hr.f)(s,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),50);(0,Dd.T5)(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||(0,Dd.tk)(this._planeHorizontal,this._planeHorizontal);const l=(0,Pa.Ue)(),c=(0,Pa.Ue)(),u=(0,Pa.Ue)();(0,hr.d)(l,i,this.currentCamera.eye);const h=(0,hr.l)(l);if((0,hr.n)(l,l),this._navMode===Qd.Vertical){(0,hr.h)(s,s,o),(0,hr.d)((0,Dd.st)(this._planeVertical),n,s),(0,hr.n)((0,Dd.st)(this._planeVertical),(0,Dd.st)(this._planeVertical)),(0,Dd.T5)(this._planeVertical,this._planeVertical,i);const t=this.view._stage.renderView.getMinimalDepthForArea((0,Yp.$L)(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,80);let d=null!=t?t:a;d=r?Math.min(d,h):d,(0,hr.c)(u,(0,hr.g)(c,this.currentCamera.eye,(0,hr.h)(c,l,d))),this._planeVertical[3]=-(0,hr.f)((0,Dd.st)(this._planeVertical),u),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),Jd(this._tmpPoints,this._beginCenter)}else{const t=r?h:a;(0,hr.c)(u,(0,hr.g)(c,this.currentCamera.eye,(0,hr.h)(c,l,t))),this._planeHorizontal[3]=-(0,hr.f)((0,Dd.st)(this._planeHorizontal),u),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),Jd(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this._navMode===Qd.Horizontal?this._planeHorizontal:this._planeVertical,r=this._beginCenter;if(t){const t=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=i,this._scalingValueSmooth.update(t),Wd(this.currentCamera,r,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=lh.ZOOM,this._constraintOptions.interactionFactor=Xh(Math.abs(e.radius-this._beginRadius)),Jh(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),Jd(this._tmpPoints,this._tmpCentroid3d),(0,$e.md)(e.center,this._tmpCentroid2d),np(this.currentCamera,r,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=lh.PAN,this._constraintOptions.interactionFactor=Xh((0,ci.TE)(this._beginCenterScreen,this._tmpCentroid2d)),Jh(this.view,this.currentCamera,this._constraintOptions),t){const t=r,i=this._rotationValueSmooth.value,n=i+jd(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=s,this._rotationValueSmooth.update(n);const o=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp);const a=(0,Dd.st)(this._planeHorizontal);Zd(this.currentCamera,t,Od(a,o)),this._constraintOptions.interactionType=lh.TUMBLE,this._constraintOptions.interactionFactor=Xh(Math.abs(e.radius*o)),Jh(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return new hg({view:this.view,momentum:t,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new ug({view:this.view,momentum:i,center:this._beginCenter,axis:(0,Dd.st)(this._planeHorizontal)});const r=this._panMomentumEstimator.evaluateMomentum();return r?new sg({view:this.view,momentum:r}):null}_computePlanePoints(e,t,i,r){r.length=e.size;const n=this._tmp2d;let s=0;return e.forEach((e=>{n[0]=e.x,n[1]=e.y,void 0===r[s]&&(r[s]=(0,Pa.Ue)()),qd(t,i,n,r[s]),s+=1})),r}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};Cg=(0,i._)([(0,v.j)("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],Cg);class Sg extends tr.a{constructor(e,t,i){super(!0),this._view=e,this.pointerActions=t,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,(e=>this._handleDrag(e)))}_handleDrag(e){if("mouse"===e.data.pointerType&&!nr(e.data,this.pointerActions))return;const t=e.timestamp-this._lastEndTimestamp,i=this._momentum&&this._momentum.running&&t<40;switch(e.data.action){case"start":case"update":if(i)break;this._controller&&this._controller.running?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,t){if(this._controller?.running){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);t&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new xg({view:this._view}):new Cg({view:this._view})}}class Eg extends tr.a{constructor(e,t){super(!0),this.view=e,this.registerIncoming("pointer-down",t,(()=>this.view.state.stopActiveCameraController()))}}class Mg extends tr.a{constructor(e,t=!1){super(!0),this._view=e,this._invert=t,this.registerIncoming("vertical-two-finger-drag",(e=>this._handleTwoFinger(e)))}_handleTwoFinger(e){const t=this._invert?-1:1,i=(0,$e.s1)(0,e.data.delta*t);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new vm({view:this._view,pivot:_m.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController?.update(i);break;case"end":this._cameraController?.end(),this._cameraController=null}}}class Ag extends tr.a{constructor(e=20,t=40){super(!1),this._threshold=e,this._maxDelta=t,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new lr({start:(e,t)=>this._observeStart(e,t),update:(e,t,i)=>this._observeUpdate(e,t,i),end:(e,t)=>this._observeEnd(t)}),this.registerIncoming("drag",(e=>this._dragEventSeparator.handle(e)))}get failed(){return"failed"===this._state}_observeStart(e,t){1===e&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),t.stopPropagation()),this._state=2===e?"ready":"failed"}_observeUpdate(e,t,i){if("failed"!==this._state&&2===e)return"active"===this._state?(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void t.stopPropagation()):void(this._checkMovementWithinLimits(t.data,i.data)?this._checkVerticalThresholdReached(t.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=t.data.center,this._artificalDrag.emit({action:"end",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),t.stopPropagation()):this._state="failed")}_observeEnd(e){"active"===this._state&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,t){let i=-1/0,r=1/0,n=-1/0,s=1/0;for(const{x:e,y:o}of t.pointers.values())i=Math.max(i,e),r=Math.min(r,e),n=Math.max(n,o),s=Math.min(s,o);let o=-1/0,a=1/0,l=-1/0,c=1/0;for(const{x:t,y:i}of e.pointers.values())o=Math.max(o,t),a=Math.min(a,t),l=Math.max(l,i),c=Math.min(c,i);const u=i-r,h=n-s,d=o-a,p=l-c;return Math.abs(e.center.x-t.center.x)<this._threshold&&Math.abs(d-u)<=this._maxDelta&&Math.abs(p-h)<=this._maxDelta}_checkVerticalThresholdReached(e,t){let i=Math.abs(e.center.y-t.center.y);return e.pointers.forEach(((e,r)=>{const n=t.pointers.get(r);i=Math.min(i,Math.abs(e.y-n.y))})),i>=this._threshold}}let Rg=class extends P.Z{constructor(){super(...arguments),this.mode="default",this._updateMode=({mode:e,dragPrimary:t,dragSecondary:i,dragTertiary:r})=>{"pro"===e&&(i="zoom",r="pan"===t?"rotate":"pan");const n={dragPrimary:t,dragSecondary:i,dragTertiary:r};this._modeDragPan&&(this._modeDragPan.pointerActions=sr("pan",n)),this._modeDragRotate&&(this._modeDragRotate.pointerActions=sr("rotate",n)),this._modeDragZoom&&(this._modeDragZoom.pointerActions=sr("zoom",n))}}destroy(){this.disconnect()}get primaryDragAction(){return this.view.navigation.actionMap.dragPrimary}set primaryDragAction(e){const{actionMap:t}=this.view.navigation;t.dragPrimary=e,t.dragSecondary="pan"===e?"rotate":"pan"}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.removeAllHandles(),this.view.viewEvents.disconnect(),this._modeDragPan=null,this._modeDragRotate=null,this._modeDragZoom=null,this._modeKeyboardNavigation=null,this._inputManager=(0,m.SC)(this._inputManager),this._source=(0,m.SC)(this._source)}connect(){const e=this.view;this._source=new Ur(this.view.surface,e.input);const t=[new an,new ln,new un,new tn(this.view.navigation),new Ag],i=new we.$({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new zr],we.f.INTERNAL);const r={fov:"Shift",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:["u","U"],down:["j","J"]},lookAround:{headingLeft:["a","A"],headingRight:["d","D"],tiltUp:["w","W"],tiltDown:["s","S"],modifier:"b"},zoom:{zoomIn:["+","="],zoomOut:["-","_"]},reset:{heading:["n","N"],tilt:["p","P"]}};this._modeDragPan=new Sg(e,["primary"]),this._modeDragRotate=new xm(e,["secondary"],_m.CENTER),this._modeDragZoom=new zm(e,["tertiary"],r.fov),this._modeKeyboardNavigation=new tg(e,r),i.installHandlers("navigation",[new Eg(e),new ef(e),new Qm(e),new ig(e,r.fov),new xm(e,["primary"],_m.EYE,[r.lookAround.modifier]),new xm(e,["secondary"],_m.CENTER,[r.lookAround.modifier]),new Sg(e,["tertiary"],[r.lookAround.modifier]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,this._modeKeyboardNavigation,new Mg(e)],we.f.INTERNAL),this.view.viewEvents.connect(i),this.addHandles([(0,F.watch)((()=>this.view.navigation?.browserTouchPanEnabled),(e=>{this._source.browserTouchPanningEnabled=!e}),F.initial),(0,F.watch)((()=>{const{actionMap:e}=this.view.navigation,{dragPrimary:t,dragSecondary:i,dragTertiary:r}=e;return{mode:this.mode,dragPrimary:t,dragSecondary:i,dragTertiary:r}}),this._updateMode,F.syncAndInitial)])}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}get test(){}};(0,i._)([(0,y.Cb)()],Rg.prototype,"view",void 0),(0,i._)([(0,y.Cb)({type:["default","pro"]})],Rg.prototype,"mode",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Rg.prototype,"updating",null),(0,i._)([(0,y.Cb)()],Rg.prototype,"latestPointerType",null),(0,i._)([(0,y.Cb)()],Rg.prototype,"latestPointerLocation",null),(0,i._)([(0,y.Cb)()],Rg.prototype,"multiTouchActive",null),(0,i._)([(0,y.Cb)()],Rg.prototype,"_inputManager",void 0),Rg=(0,i._)([(0,v.j)("esri.views.3d.input.SceneInputManager")],Rg);const Og=Rg;var Pg=n(17135),Ig=n(3289);let Lg,Dg,Ng=!1,Fg=!1,Ug=!1,kg=!1,zg=null;function Bg(e){Ug=Ig.h.DECONFLICTOR_SHOW_VISIBLE,kg=Ig.h.DECONFLICTOR_SHOW_INVISIBLE,Ng=Ug||kg,Fg=Ig.h.DECONFLICTOR_SHOW_GRID,zg=null,Ng||Fg?zg=()=>function(e){null==Lg&&(Lg=document.createElement("canvas"),Lg.setAttribute("id","debugCanvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Lg));const{state:t}=e,{camera:i,pixelRatio:r}=t,{width:n,height:s}=i,o=n*r,a=s*r;Lg.setAttribute("width",`${o}px`),Lg.setAttribute("height",`${a}px`),Lg.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),Dg=Lg.getContext("2d"),Dg.clearRect(0,0,n,s),Dg.font="12px Arial"}(e):Lg&&(Lg.parentElement.removeChild(Lg),Lg=null)}function Vg(){zg&&(zg(),zg=null)}function Hg(e,t,i,r,n){Vg();const s=Lg.height,o=Dg;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(e,s-i),o.lineTo(t,s-i),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.closePath()}function Gg(e,t){Ng&&(t&&Ug||!t&&kg)&&Hg(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var jg=n(12391),Zg=n(20757),qg=n(72946),Wg=n(98166),$g=n(40353);const Yg=(0,Pa.Ue)(),Jg=(0,Pa.Ue)(),Xg=(0,rf.Ue)(),Kg=(0,rf.Ue)(),Qg=(0,Pa.Ue)(),ey=(0,Cl.Ue)(),ty=(0,hh.c)(),iy=(0,uh.Ue)(),ry=(0,Pa.Ue)(),ny=(0,Ds.Ue)();class sy{constructor(){this.aabr=(0,Ds.Ue)(),this.distance=0,this.distanceToTerrain=0,this.culled=!1,this.visible=!1}}class oy{constructor(e,t){this.graphics3DGraphic=e,this.slicePlaneEnabled=t,this.info={}}}var ay;!function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"}(ay||(ay={}));class ly{constructor(){this.camera=new _d.Z,this.slicePlane=(0,Da.d)(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),(0,Da.a)(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let cy=class extends P.Z{get dirty(){return this._dirty}get state(){return this._state}constructor(e){super(e),this._dirty=!1,this._viewState=new ly,this._state=ay.Idle,this._active=new Map,this._visible=new Map,this._iterators=new dy,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0,this._updatingHandles=new he.R}destroy(){this._updatingHandles.destroy(),this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==ay.Idle||this._dirty||this._updatingHandles.updating}get updatingProgress(){if(!this.updating)return 1;const e=this._state/ay.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(e){switch(this._state){case ay.Idle:this._startUpdate(),e.madeProgress();case ay.Process:if(this._state=ay.Process,!this._processActiveGraphics(e))return;case ay.Sort:if(this._state=ay.Sort,!this._sortVisibleGraphics(e))return;case ay.Deconflict:if(this._state=ay.Deconflict,!this._deconflictVisibleGraphics(e))return;default:(function(e,t){if(!Fg||!Dg)return;Vg();const i=Dg;let r=0;for(let t=0;t<e.accBinsNumX;t++)for(let n=0;n<e.accBinsNumY;n++){const s=e.accBins[t][e.accBinsNumY-1-n];r+=s.length;const o=t*e.accBinsSizeX,a=(t+1)*e.accBinsSizeX,l=n*e.accBinsSizeY,c=(n+1)*e.accBinsSizeY;i.fillText(s.length.toFixed(),o+5,l+15),Hg(o,a,l,c,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)})(this,this._visible),this._state=ay.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach((e=>this.addToActiveGraphics(e))):e.forEach((e=>this.removeFromActiveGraphics(e))),this.setDirty()}layerSupportsDeconfliction(e){if(null==e||"object3d"!==e.type)return!1;const t=e.stageObject;if(1!==(t?.geometries.length??0))return!1;const i=t?.geometries[0],r=i?.material;return r instanceof Wg.A}_startUpdate(){Bg(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._viewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new sy,this._active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._visible.delete(e.graphics3DGraphic.graphic.uid),function(e,t){const i=e.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(t,jg.P.DECONFLICTION,!0)}(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this._active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_createTerrainIntersector(){const e=(0,vd.Z8)(this.view.state.viewingMode);e.options.store=Zg.eC.MIN;const t=this.view.basemapTerrain,i=this.view.state.camera;return(0,Tl.p4)(ey,this._viewState.camera.viewInverseTransposeMatrix),r=>{(0,hr.t)(Jg,r,ey),e.reset(i.eye,Jg,i),t.intersect(e,null,i.eye,Jg);const n=e.results.ground.dist;return null!=n?n*(0,hr.j)(Jg,i.eye):0}}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=this._viewState.camera.inverseProjectionMatrix,r="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this._viewState.camera.relativeElevation>0,n=(0,w.Z)("enable-feature:non-occluded-hud")&&this.view.map.ground.opacity>0?this._createTerrainIntersector():null,s=r?ty:null;let o=0;for(null!=s&&((0,hr.t)((0,hh.a)(s),Pa.AG,this._viewState.camera.viewMatrix),s[3]=(0,_l.Iu)(this.view.spatialReference).radius,o=(0,hh.h)(s,Pa.AG));!e.done;){e.madeProgress();const r=t.next();if(!0===r.done)return this._resetActiveGraphicsIterator(),!0;const a=r.value,l=a?.info[this.visibilityGroup];l&&(this._collectGraphics3DGraphics(a,i,s,o,n),l.culled?(this._setGraphicVisibility(a,!1),this._visible.delete(a.graphics3DGraphic.graphic.uid)):this._visible.set(a.graphics3DGraphic.graphic.uid,a))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),!0===i.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===jg.E.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(!0===r.done)return this._resetVisibleGraphicsIterator(),!0;const n=r.value,s=n.info[this.visibilityGroup];if(!s||s.culled){this._setGraphicVisibility(n,!1);continue}const o=n.graphics3DGraphic,a=!i||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),Gg(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=uy(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=uy(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=function*(e,t,i){t.clear(),e.forEach(((e,r)=>{const n=t.pushNew();n.id=r,n.visible=e.graphics3DGraphic.getVisibilityFlag(i,jg.P.DECONFLICTION);const s=e.info?.[i];n.prio=e.graphics3DGraphic.deconflictionPriority,n.distance=s?s.distance:Number.MAX_VALUE,n.behindTerrain=!!s&&0!==s.distanceToTerrain&&s.distance>s.distanceToTerrain})),yield;const r=t.iterableSort(((e,t)=>e.behindTerrain!==t.behindTerrain?+e.behindTerrain-+t.behindTerrain:e.prio!==t.prio?t.prio-e.prio:e.distance!==t.distance?e.distance-t.distance:e.visible!==t.visible?+t.visible-+e.visible:e.id-t.id));for(let e=r.next();!e.done;e=r.next())yield;t.forAll((t=>{const i=e.get(t.id);i&&(e.delete(t.id),e.set(t.id,i))})),t.clear()}(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r,n){const s=e.graphics3DGraphic;if(s.destroyed)return;const o=e.info[this.visibilityGroup];if(!s.isVisible(jg.E.GRAPHIC,jg.P.DECONFLICTION))return void(o.culled=!0);const a=this.getGraphicsLayers(s);(0,Ds.cS)(o.aabr);let l=null;for(const s of a){if(!this.layerSupportsDeconfliction(s))continue;const a=s.stageObject.geometries[0].material;if(null==l){if(l=my,this._getProjectionInfo(s,t,l),l.isOutsideScreen||this._isCulledBySlice(e,Yg)||null!=i&&fy(l,i,r))return void(o.culled=!0);l.distanceToTerrain=n?.(l.positionView)??0}this._expandBoundingRect(o,s,a,l)}null==l?o.culled=!0:(o.distance=l.distance,o.distanceToTerrain=l.distanceToTerrain,o.culled=!1)}_getProjectionInfo(e,t,i){const r=this._viewState.camera,n=e.stageObject,s=n.geometries[0],o=s.material,a=(0,hh.a)(n.boundingVolumeWorldSpace.bounds);(0,hr.t)(Yg,a,r.viewMatrix);const l=s.attributes,c=l.get(Wl.T.NORMAL).data,u=l.get(Wl.T.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(Yg,c,n.transformation,u,r,i.scaleInfo,Yg),(0,tf.s)(Xg,Yg[0],Yg[1],Yg[2],1),(0,tf.t)(Kg,Xg,r.projectionMatrix),(0,hr.h)(i.positionNDC,Kg,1/Kg[3]),o.applyShaderOffsetsNDC(i.positionNDC,u,r,i.positionNDC,Qg),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(Qg[2]),i.distance=Qg[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),(0,tf.s)(Kg,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),(0,tf.t)(Xg,Kg,t),(0,tf.b)(Xg,Xg,1/Xg[3]),(0,hr.i)(i.positionView,Yg[0],Yg[1],Yg[2])}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&(0,Da.e)(this._viewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:n}){const{fullWidth:s,fullHeight:o,pixelRatio:a}=this._viewState.camera,l=t.getScreenSize(py);(0,qg.TU)(l,n.factor,l),l[0]*=a,l[1]*=a;const c=(0,Ds.cv)(i.calculateRelativeScreenBounds(l,n.factorAlignment.scale*a,ny),(0,yt.t7)(0,s,.5+.5*r[0]),(0,yt.t7)(0,o,.5+.5*r[1])),u=this.marginFactor;if(0!==u){const e=u*Math.min((0,Ds.d_)(c),(0,Ds.Cb)(c));c[0]-=e,c[1]-=e,c[2]+=e,c[3]+=e}(0,Ds.jn)(e.aabr,c,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];let r=!0;for(let e=Math.floor(i.aabr[0]/this._accBinsSizeX);e<=Math.floor(i.aabr[2]/this._accBinsSizeX);e++)if(!(e<0||e>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;r=!1;const s=this._accBins[e][n];for(let e=0;e<s.length;e++){const r=s.data[e],n=r.info[this.visibilityGroup];if(n&&n.visible&&r.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,(0,Ds.kK)(n.aabr,i.aabr)))return!0}}return r}_initBins(e,t){if(null==this._accBins){this._accBins=[];for(let e=0;e<this._accBinsNumX;e++){this._accBins.push([]);const e=this._accBins[this._accBins.length-1];for(let t=0;t<this._accBinsNumY;t++)e.push(new Pg.Z)}}else for(let e=0;e<this._accBinsNumX;e++)for(let t=0;t<this._accBinsNumY;t++)this._accBins[e][t].clear();this._accBinsSizeX=e/this._accBinsNumX,this._accBinsSizeY=t/this._accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this._accBinsSizeX),r=Math.floor(t.aabr[2]/this._accBinsSizeX),n=Math.floor(t.aabr[1]/this._accBinsSizeY),s=Math.floor(t.aabr[3]/this._accBinsSizeY);for(let t=i;t<=r;t++)if(!(t<0||t>=this._accBinsNumX))for(let i=n;i<=s;i++)i<0||i>=this._accBinsNumY||this._accBins[t][i].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,jg.P.DECONFLICTION,t),this.visibilityGroup===jg.E.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function*uy(e){if(Map.prototype.entries){const t=e.entries();for(let e=t.next();!e.done;e=t.next())yield e.value[1]}else yield*e.values()}(0,i._)([(0,y.Cb)({constructOnly:!0})],cy.prototype,"view",void 0),(0,i._)([(0,y.Cb)({type:Boolean,readOnly:!0})],cy.prototype,"updating",null),(0,i._)([(0,y.Cb)({readOnly:!0})],cy.prototype,"_updatingHandles",void 0),cy=(0,i._)([(0,v.j)("esri.views.3d.layers.graphics.Deconflictor")],cy);class hy{constructor(){this.id=0,this.visible=!1,this.behindTerrain=!1,this.prio=0,this.distance=0}}class dy{constructor(e=null,t=null,i=null){this.active=e,this.visible=t,this.sort=i,this.sortArray=new Pg.Z({allocator:e=>e||new hy})}}const py=(0,ui.Ue)();function fy(e,t,i){return(0,hr.c)(iy.direction,e.positionView),(0,hr.i)(iy.origin,0,0,0),!!(0,hh.j)(t,iy,ry)&&e.distanceWithoutPolygonOffset>i}const my=new class{constructor(){this.positionView=(0,Pa.Ue)(),this.positionNDC=(0,Pa.Ue)(),this.distance=0,this.distanceToTerrain=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new $g.G}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1||e[2]>=1}};let gy=class extends cy{constructor(e){super(e),this.visibilityGroup=jg.E.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}initialize(){this._updatingHandles.add((()=>0===(this.view?.map?.ground?.opacity??0)),(()=>this.setDirty()))}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return zl.J;const t=performance.now();if(e.state!==Pi.n.IDLE&&t-this._lastDeconfliction<2e3)return zl.J;super.runTask(e),this.state===ay.Idle&&(this._lastDeconfliction=t)}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};(0,i._)([(0,y.Cb)({constructOnly:!0})],gy.prototype,"parent",void 0),gy=(0,i._)([(0,v.j)("esri.views.3d.layers.graphics.LabelDeconflictor")],gy);let yy=class extends cy{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=jg.E.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._updatingHandles.add((()=>this.view?.state?.camera),(()=>{this._updateViewState(),this.setDirty()})),this._updatingHandles.add((()=>1===this.view?.map?.ground?.opacity),(()=>this.setDirty())),this._updatingHandles.add((()=>this.view?.slicePlane),(()=>{this._updateSlicePlane(),this._slicePlaneChanged()}),F.initial),this._frameTask=this.view.resourceController.scheduler.registerTask(Ii.T8.GRAPHICS_DECONFLICTOR,this),this._labels=new gy({view:this.view,parent:this})}destroy(){this._labels=(0,m.SC)(this._labels),this._frameTask=(0,m.hw)(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;null!=e&&(0,Da.t)(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=null!=e}_slicePlaneChanged(){for(const e of this._contexts.keys())if(e.symbolCreationContext.slicePlaneEnabled)return void this.setDirty()}addGraphicsOwner(e){const t=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:e=>this._removeGraphic(t,e),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic))),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic))),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,n=new oy(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,n),_y(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n);const s=!this._graphicSupportsDeconfliction(i)||!_y(e);i.setVisibilityFlag(jg.E.GRAPHIC,jg.P.DECONFLICTION,s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=_y(e);i||function(e){const t=e.graphics3DGraphics;t&&t.forEach((e=>e.setVisibilityFlag(jg.E.GRAPHIC,jg.P.DECONFLICTION,!0)))}(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach((e=>e.slicePlaneEnabled=i)),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.layers;if(!t?.length)return!1;for(const e of t)if(this.layerSupportsDeconfliction(e))return!0;return!1}_getGraphicsContext(e){const t=this._contexts.get(e);if(t)return t;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function _y(e){const t=e.layer;return!(!t?.featureReduction||"selection"!==t.featureReduction.type)}yy=(0,i._)([(0,v.j)("esri.views.3d.layers.graphics.GraphicsDeconflictor")],yy);var vy=n(77485),by=n(7958),wy=n(49931),xy=n(22349),Ty=n(12487);class Cy{constructor(e,t){this._renderCoordsHelper=e,this.opaqueGround=t,this._cache=new Map,this._cameraForward=(0,Pa.Ue)(),this._cameraEye=(0,Pa.Ue)(),this._cameraFovY=55*Math.PI/180,this._frustumBoundingSphereCenter=(0,Pa.Ue)(),this._frustumBoundingSphereRadius=0,this._frustum=new bf.i(e),this._renderSR=e.spatialReference;const i=(0,fl.rS)(this._renderSR);this._renderSREllipsoidRadius=(0,_l.Iu)(i).radius}setup(e){this._aboveGround=e.aboveGround,this._frustum.update(e),(0,hr.n)(this._cameraForward,e.viewForward),(0,hr.c)(this._cameraEye,e.eye),this._cameraFovY=e.fovY,this._updateFrustumBoundingSphere()}done(){this._cache.clear()}compute(e){if(this._cache.has(e.id))return this._cache.get(e.id);const t=this._isVisibleInFrustum(e);return this._cache.set(e.id,t),t}_isVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===$t.JY.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,t=e.origin,i=jy;(0,hr.n)(i,e.direction);const r=e.points,n=Zy;(0,hr.a)(n,r[4],t);const s=.5*(0,hr.f)(n,n)/(0,hr.f)(i,n),o=this._frustumBoundingSphereCenter;(0,hr.b)(o,t,i,s);const a=1+s;this._frustumBoundingSphereRadius=a}_isTileVisibleInFrustumLocal(e){const t=e.spatialReference,i=e.extent,r=this._renderSR;if(Ny[0]=i[0],Ny[1]=i[1],Ny[2]=0,Ny[3]=i[2],Ny[4]=i[3],Ny[5]=0,!(0,xy.projectBuffer)(Ny,t,0,Ny,r,0))return!1;(0,hr.i)(Fy[0],Ny[0],Ny[1],0),(0,hr.i)(Fy[1],Ny[3],Ny[1],0),(0,hr.i)(Fy[2],Ny[3],Ny[4],0),(0,hr.i)(Fy[3],Ny[0],Ny[4],0),(0,hr.i)(Uy,.5*(Ny[0]+Ny[3]),.5*(Ny[1]+Ny[4]),.5*(Ny[2]+Ny[5]));const n=w_,s=.5*(0,hr.G)(Fy[0],Fy[2]),o=this._frustum,a=this._frustumBoundingSphereRadius,l=this._frustumBoundingSphereCenter,c=Wy;(0,hr.a)(c,l,Uy);const u=(0,hr.f)(n,c),h=qy;if((0,hr.b)(h,Uy,n,u),(0,hr.G)(h,l)>s+a)return!1;const d=this._cameraForward,p=(0,hr.f)(d,w_),f=this._cameraFovY,m=this._cameraEye;if(Math.abs(p)<Math.abs(Math.cos(.5*f))){let e=!0;const t=(0,hr.i)(x_,d[0],d[1],0),i=(0,hr.f)(m,t);for(let r=0;r<4;++r){const n=Fy[r];if((0,hr.f)(n,t)-i>0){e=!1;break}}if(e)return!1}{const e=Fy[0],t=Fy[2];if(e[0]<=m[0]&&m[0]<=t[0]&&e[1]<=m[1]&&m[1]<=t[1])return!0}const g=Dy,y=this.opaqueGround&&this._aboveGround,_=this.opaqueGround&&!this._aboveGround,v=Math.min(_?y_:1/0,u+a),b=Math.max(y?-430:-1/0,u-a);for(let e=0;e<4;++e)(0,hr.b)(g[e],Fy[e],n,v),(0,hr.b)(g[e+4],Fy[e],n,b);if(Oy(o.planes,g,8))return!1;if(Py(o.planes,g,8))return!0;for(let e=0;e<4;++e){const t=g[e],i=g[e+4];if(T_(o.planes,t,i))return!0;const r=g[(e+1)%4];if(T_(o.planes,t,r))return!0;const n=g[4+(e+1)%4];if(T_(o.planes,i,n))return!0}if(E_[0][3]=+Fy[0][0],E_[1][3]=-Fy[2][0],E_[2][3]=+Fy[0][1],E_[3][3]=-Fy[2][1],E_[4][3]=+b,E_[5][3]=-v,Py(E_,o.points))return!0;if(Py(E_,o.points))return!0;for(let e=0;e<4;++e){const t=m,i=o.points[e+4];if(C_(E_,t,i))return!0;const r=o.points[4+(e+1)%4];if(C_(E_,i,r))return!0}return!1}_isTileVisibleInFrustumGlobal(e){if(e.level<Iy)return!0;const t=e.spatialReference,i=e.extent,r=this.opaqueGround&&this._aboveGround,n=this.opaqueGround&&!this._aboveGround,s=Fy,o=.5*(i[0]+i[2]);if((0,hr.i)(s[0],i[0],i[1],0),(0,hr.i)(s[1],i[2],i[1],0),(0,hr.i)(s[2],i[2],i[3],0),(0,hr.i)(s[3],i[0],i[3],0),(0,hr.i)(s[4],o,i[1],0),(0,hr.i)(s[5],o,i[3],0),!function(e,t,i,r,n,s,o=1){const a=(0,Ty.R8)(t,n);if(null==a)return!1;if(a===Ty.iq){if(e===r&&i===s)return!0;const t=i+o;for(let n=i,o=s;n<t;++n,++o)(0,hr.c)(r[o],e[n]);return!0}const l=i+o;for(let t=i,n=s;t<l;++t,++n)a(e[t],0,r[n],0);return!0}(s,t,0,s,this._renderSR,0,6))return!1;const a=s[0][2]>0,l=s[3][2]<0,c=a||l,u=this._renderSREllipsoidRadius;if(c){const e=zy;Sy(e,M_,s[0]);const t=By;if(Sy(t,M_,s[1]),a){const i=ky,r=s[4],n=Vy;Sy(n,r,M_),Sy(i,n,r);const o=s[0];(0,hr.e)(o,e,i),My(o,u);const a=s[1];(0,hr.e)(a,t,i),My(a,u)}else if(l){const i=ky,r=s[5],n=Vy;Sy(n,r,M_),Sy(i,r,n);const o=s[3];(0,hr.e)(o,i,e),My(o,u);const a=s[2];(0,hr.e)(a,i,t),My(a,u)}}const h=Uy,d=(0,hr.a)(Ky,s[3],s[0]);(0,hr.n)(d,d);const p=(0,hr.g)(Qy,s[0],s[3]);(0,hr.h)(p,p,.5);const f=-(0,hr.f)(p,d),m=(0,hr.g)(e_,s[0],s[1]);(0,hr.h)(m,m,.5);const g=(0,hr.g)(t_,s[2],s[3]);(0,hr.h)(g,g,.5);const y=(0,hr.a)(i_,g,m);(0,hr.n)(y,y);const _=-(f+(0,hr.f)(d,m))/(0,hr.f)(d,y);(0,hr.b)(h,m,y,_),My(h,u);const v=this._frustumBoundingSphereRadius,b=this._frustumBoundingSphereCenter,w=this._frustum,x=w.planes,T=Hy;(0,hr.n)(T,h);const C=(0,hr.f)(s[0],T)/(0,hr.H)(s[0]),S=w.origin,E=w.points;let M=!1;if(r){{M=!0;const e=(0,hr.n)(__,S);for(let t=0;t<4;++t){const i=E[4+t],r=(0,hr.a)((0,Pa.Ue)(),i,S);(0,hr.n)(r,r);const n=(0,hr.e)((0,Pa.Ue)(),e,r);(0,hr.n)(n,n);const s=(0,hr.e)((0,Pa.Ue)(),r,n);if((0,hr.n)(s,s),(0,hr.f)(S,s)>u){M=!1;break}}}if(M&&(0,hr.f)(S,T)<u*C-y_)return!1;const e=(0,hr.n)(__,w.origin);if((0,hr.f)(e,T)<0)return!1;{const e=(0,hr.n)(v_,w.direction);if((0,hr.f)(e,T)>b_)return!1}}const A=Math.sqrt(1-C*C);if(A>.9)return!0;let R=!1;const O=(0,hr.f)(T,b),P=(0,hr.H)(b);if(P<=v&&!x.some((e=>(0,Dd.jH)(e,$y)>0))){if(!r)return!0;R=!0}const I=O/P;if(!R&&O<=0&&-O>v)return!1;const L=v/P;if(Math.sqrt(1-I*I)*Math.sqrt(1-L*L)-L*I>A)return!1;if(!M){if(s.some((e=>w.intersectsPoint(e))))return!0;if(w.intersectsPoint(h))return!0}const D=Yy;(0,hr.a)(D,b,$y);const N=(0,hr.f)(D,T),F=Gy;(0,hr.h)(F,T,N);const U=(0,hr.G)(F,b),k=t.isWGS84,z=e.lij,B=k&&z[2]===2**z[0]-1,V=k&&0===z[2],H=V?d_:B?u_:l_,G=V?p_:B?h_:c_;if(!R){const e=s,t=f_,i=r_,r=n_,n=$y;for(const s of H){const o=e[s];if(Ey(i,e[(s+1)%4],o),Ey(r,n,o),Sy(t,r,i),Ly(t,E,1))return!1}}let j=null;if(!r&&N<1.01*v){const e=2.5*v;if(U>C*e+v)return!1;const t=Xy,i=e/C;for(let e=0;e<4;++e)(0,hr.h)(t[e],s[e],i/u);(0,hr.i)(t[4],0,0,0),j=t}else{const e=(n?u+y_:N+v)/C,t=r?u-y_:(N-v)/C,i=Jy;for(let r=0;r<4;++r){const n=s[r];(0,hr.h)(i[r],n,t/u),(0,hr.h)(i[r+4],n,e/u)}j=i}if(Oy(x,j,j.length))return!1;const Z=w.lines,q=s_,W=o_;for(const e of Z){(0,hr.n)(W,e.direction);for(const e of G){const t=j[e];if((0,hr.n)(q,t),g_(W,q,j,E))return!1;const i=(e+1)%4;if(r){const e=j[i];if((0,hr.a)(q,e,t),(0,hr.n)(q,q),g_(W,q,j,E))return!1}if(n){const t=j[4+e],r=j[4+i];if((0,hr.a)(q,r,t),(0,hr.n)(q,q),g_(W,q,j,E))return!1}}}return!0}}function Sy(e,t,i){return(0,hr.e)(e,t,i),(0,hr.n)(e,e),e}function Ey(e,t,i){return(0,hr.a)(e,t,i),(0,hr.n)(e,e),e}function My(e,t){return(0,hr.h)(e,e,t/(0,hr.H)(e)),e}const Ay=[Af.Nu.LEFT,Af.Nu.RIGHT,Af.Nu.BOTTOM,Af.Nu.TOP,Af.Nu.FAR];function Ry(e,t,i){for(let r=0;r<i;++r)if((0,Dd.jH)(e,t[r])<=0)return!1;return!0}function Oy(e,t,i){for(const r of Ay)if(Ry(e[r],t,i))return!0;return!1}function Py(e,t,i=t.length){for(let r=0;r<i;++r){const i=t[r];let n=!0;for(const t of e)if((0,Dd.jH)(t,i)>0){n=!1;break}if(n)return!0}return!1}const Iy=2;function Ly(e,t,i){for(const r of t)if((0,hr.f)(r,e)<i)return!1;return!0}const Dy=[(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)()],Ny=[0,0,0,0,0,0],Fy=[(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)()],Uy=(0,Pa.Ue)(),ky=(0,Pa.Ue)(),zy=(0,Pa.Ue)(),By=(0,Pa.Ue)(),Vy=(0,Pa.Ue)(),Hy=(0,Pa.Ue)(),Gy=(0,Pa.Ue)(),jy=(0,Pa.Ue)(),Zy=(0,Pa.Ue)(),qy=(0,Pa.Ue)(),Wy=(0,Pa.Ue)(),$y=(0,Pa.vV)(0,0,0),Yy=(0,Pa.Ue)(),Jy=[(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)()],Xy=[(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)()],Ky=(0,Pa.Ue)(),Qy=(0,Pa.Ue)(),e_=(0,Pa.Ue)(),t_=(0,Pa.Ue)(),i_=(0,Pa.Ue)(),r_=(0,Pa.Ue)(),n_=(0,Pa.Ue)(),s_=(0,Pa.Ue)(),o_=(0,Pa.Ue)(),a_=(0,Pa.Ue)(),l_=[0,1,2,3],c_=[0,1,2,3],u_=[0,1,3],h_=[0,1,3],d_=[1,2,3],p_=[1,2,3],f_=(0,Pa.Ue)();const m_=[0,0];function g_(e,t,i,r){if(0===i.length||0===r.length)return!0;const n=a_;Sy(n,e,t);const s=r[0]<i[0],o=s?i:r,a=m_;return function(e,t,i){let r=1/0,n=-1/0;for(const e of i){const i=(0,hr.f)(t,e);r=Math.min(r,i),n=Math.max(n,i)}e[0]=r,e[1]=n}(a,n,s?r:i),function(e,t,i,r){let n=1/0,s=-1/0;for(const o of r){const r=(0,hr.f)(i,o);if(n=Math.min(n,r),s=Math.max(s,r),n<=t&&s>=e)return!1}return!0}(a[0],a[1],n,o)}const y_=430,__=(0,Pa.Ue)(),v_=(0,Pa.Ue)(),b_=Math.cos(.25*Math.PI),w_=(0,Pa.al)(0,0,1),x_=(0,Pa.Ue)();function T_(e,t,i){const r={t0:0,t1:1};for(const n of Ay)if(!S_(e[n],t,i,r))return!1;return r.t0<r.t1}function C_(e,t,i){const r={t0:0,t1:1};for(const n of e)if(!S_(n,t,i,r))return!1;return r.t0<r.t1}function S_(e,t,i,r){let{t0:n,t1:s}=r;const o=(0,Dd.jH)(e,t),a=(0,Dd.jH)(e,i);if(o>=0&&a>=0)return!1;if(o<0&&a>=0){const e=-o/(a-o);if(e<n)return!1;e<s&&(s=e)}else if(o>=0&&a<0){const e=o/(o-a);if(e>s)return!1;e>n&&(n=e)}return r.t0=n,r.t1=s,!0}const E_=[(0,Dd.al)(-1,0,0,1),(0,Dd.al)(1,0,0,-1),(0,Dd.al)(0,-1,0,1),(0,Dd.al)(0,1,0,-1),(0,Dd.al)(0,0,-1,1),(0,Dd.al)(0,0,1,-1)],M_=(0,Pa.vV)(0,0,1);class A_{constructor(e,t,i){this._renderCoordsHelper=e,this._tilingScheme=t,this._camera=new _d.Z,this._surfaceElevation=0,this._focusOnMap=[0,0],this._visibility=new Cy(e,i)}set opaqueGround(e){this._visibility.opaqueGround=e}setup(e,t,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=t.x,this._focusOnMap[1]=t.y,this._visibility.setup(this._camera)}done(){this._visibility.done()}update(e){const{measures:t,extent:i,level:r}=e;t.visible=this._visibility.compute(e),t.distance=(0,Ds.TE)(i,this._focusOnMap),t.mergeable=!0,t.lodLevel=Iy,t.splitPriority=Math.max(0,Iy-r),t.visible&&(this._isGlobal?this._updateSplitAndLodGlobal(e):this._updateSplitAndLodLocal(e))}_updateSplitAndLodGlobal(e){const t=e.level,i=this._renderCoordsHelper,{eye:r,fov:n}=this._camera,s=i.referenceEllipsoid.radius,o=(0,hr.H)(r)-s;if(2*Math.atan(s/o)<n&&o>0)return void(e.measures.lodLevel=Math.max(t,Iy));const a=R_,{extent:l}=e,{_surfaceElevation:c}=this;(0,hr.i)(a[0],l[0],l[1],c),(0,hr.i)(a[1],l[2],l[1],c),(0,hr.i)(a[2],l[2],l[3],c),(0,hr.i)(a[3],l[0],l[3],c);const u=(0,hr.i)(O_,.5*(l[0]+l[2]),.5*(l[1]+l[3]),c),h=this._tilingScheme.spatialReference;for(let e=0;e<4;++e)i.toRenderCoords(a[e],h,a[e]);i.toRenderCoords(u,h,u);const d=(0,hr.n)(D_.direction,u),p=(0,hr.f)(r,d),f=(0,hr.h)(I_,d,p);this._updateSplitAndLod(e,a,u,f)}_updateSplitAndLodLocal(e){const t=R_,{extent:i}=e,{_surfaceElevation:r}=this;(0,hr.i)(t[0],i[0],i[1],r),(0,hr.i)(t[1],i[2],i[1],r),(0,hr.i)(t[2],i[2],i[3],r),(0,hr.i)(t[3],i[0],i[3],r);const n=this._tilingScheme.spatialReference;for(let e=0;e<4;++e)this._renderCoordsHelper.toRenderCoords(t[e],n,t[e]);const s=(0,hr.i)(O_,.5*(t[0][0]+t[2][0]),.5*(t[0][1]+t[2][1]),.25*(t[0][2]+t[1][2]+t[2][2]+t[3][2])),o=(0,hr.i)(P_,s[0],s[1],0),{eye:a,far:l}=this._camera,c=(0,hr.i)(I_,o[0],o[1],a[2]);(0,hr.i)(D_.origin,o[0],o[1],a[2]-2*l),(0,hr.c)(D_.direction,L_),this._updateSplitAndLod(e,t,s,c)}_updateSplitAndLod(e,t,i,r){const n=Math.max((0,hr.G)(t[0],t[2]),(0,hr.G)(t[1],t[3]),(0,hr.G)(t[0],i)+(0,hr.G)(i,t[2]),(0,hr.G)(t[1],i)+(0,hr.G)(i,t[3])),{eye:s,near:o,fov:a,viewForward:l,width:c,height:u,pixelRatio:h,frustum:d}=this._camera,p=(0,hr.f)(s,l),f=(0,hr.f)(i,l)-p,m=(0,hr.G)(i,s);let g=f,y=f,_=m,v=m;const b=(e,t)=>t<o?1:Math.sqrt(e*e-t*t)/t;let w=b(m,f);for(const e of t){const t=(0,hr.f)(e,l)-p;g=Math.min(g,t),y=Math.max(y,t);const i=(0,hr.G)(e,s);v=Math.max(v,i),_=Math.min(_,i);const r=b(i,t);w=Math.min(w,r)}if(y<o)return void(e.measures.lodLevel=0);const x=Math.cos(.5*a),T=(0,hr.G)(s,r);w>x&&T>F_*n&&(y=U_*v,g=U_*_);const C=.5*Math.sqrt(c*c+u*u)/h,S=2*Math.tan(.5*a),E=e=>Math.max(o,e)*N_/C*S,M=e.level,A=n*2**M*Math.max(1,S),R=E(g),O=Math.ceil(Math.log2(Math.max(1,A/R)));if(e.measures.lodLevel=Math.max(O,e.measures.lodLevel),e.measures.splitPriority+=e.measures.lodLevel-M,M<O){const i=+(0,Af.g8)(d,t[0])+ +(0,Af.g8)(d,t[1])+ +(0,Af.g8)(d,t[2])+ +(0,Af.g8)(d,t[3]);e.measures.splitPriority+=i}const P=E(y)/R;P>2.5&&(e.measures.splitPriority+=P)}get _isGlobal(){return this._renderCoordsHelper.viewingMode===$t.JY.Global}}const R_=[(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)(),(0,Pa.Ue)()],O_=(0,Pa.Ue)(),P_=(0,Pa.Ue)(),I_=(0,Pa.Ue)(),L_=(0,Pa.vV)(0,0,1),D_=(0,uh.al)(Pa.AG,L_),N_=312,F_=.5,U_=2;var k_=n(76557);let z_=class extends P.Z{constructor(e){super(e),this.tiles=new o.Z,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=(0,yl.t)(!1),this._pendingTiles=(0,yl.t)(null),this._newTiles=new Pg.Z,this._tests=!1,this._measurements=new A_(e.renderCoordsHelper,e.tilingSchemeOwner.tilingScheme,this._opaqueGround)}initialize(){const e=()=>this._setDirty();this.addHandles([(0,F.watch)((()=>this.tileSize),(()=>this._reset()),F.syncAndInitial),(0,F.watch)((()=>this.cameraOnSurface?.location),e,F.syncAndInitial),(0,F.watch)((()=>this.viewState?.contentCamera),e,F.syncAndInitial),(0,F.watch)((()=>this.focus?.location),e,F.syncAndInitial),(0,F.watch)((()=>this.terrain?.baseOpacity??1),e),(0,F.watch)((()=>this.tilingScheme),(e=>{this._reset(),this._measurements=new A_(this.renderCoordsHelper,e,this._opaqueGround)}),F.sync),(0,F.watch)((()=>this._opaqueGround),(e=>this._measurements.opaqueGround=e),F.sync)]),this._frameWorker=this.scheduler?.registerTask(Ii.T8.FEATURE_TILE_TREE,this)}destroy(){this._frameWorker=(0,m.hw)(this._frameWorker)}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(null!=e&&!e.spatialReference.equals(this.viewState.spatialReference))return void f.Z.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||null!=t&&e&&t.equals(e))return;const i=null!=e?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(null==this.filterExtent)return null;const e=(0,Ds.Ue)();return(0,k_.G)(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty.value||!!this._pendingTiles.value}addClient(){const e=(0,by.D)();return this._clients.add(e),1===this._clients.size&&this._setDirty(),(0,N.kB)((()=>this._removeClient(e)))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}get _opaqueGround(){return 1===(this.terrain?.baseOpacity??1)}_setDirty(){this._hasClients&&!this.suspended&&(this._frameWorker?this._dirty.value=!0:this.runTask(Ii.G5))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty.value=!1}get running(){return this.updating}_reset(){this._newTiles.clear(),this._pendingTiles.value=null,this._setDirty()}_getRootTiles(){const e=this.tilingScheme;return this._rootTileIds.map((t=>new wy.Q(t[0],t[1],t[2],e)))}runTask(e){e=this._tests?Ii.G5:e,this._dirty.value=!1,this._pendingTiles.value||(this._startUpdate(e),null!=this._frameWorker&&(this._frameWorker.priority=Ii.T8.FEATURE_TILE_TREE_ACTIVE)),this._splitPendingTiles(e),this._pendingTiles.value||null==this._frameWorker||(this._frameWorker.priority=Ii.T8.FEATURE_TILE_TREE)}_startUpdate(e){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();const{_measurements:t,_filterExtentRect:i,_newTiles:r}=this;t.setup(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles.value=this._getRootTiles().filter((e=>{if(t.update(e),e.measures.visible&&(!i||(0,Ds.kK)(e.extent,i))){if(e.measures.splitPriority>0)return!0;r.push(e)}return!1})).sort(B_),this._newTiles.clear(),e.madeProgress()}_splitPendingTiles(e){const t=this._pendingTiles.value;if(!t)return;const{tilingScheme:i,_filterExtentRect:r,_newTiles:n,_measurements:s}=this;for(;t.length>0&&this._tileBudgetExceeded<1;){const o=t.pop();if(e.madeProgress(),o.measures.splitPriority>0){i.ensureMaxLod(o.level+1);const e=o.createChildren();for(const i of e)s.update(i),!i.measures.visible||r&&!(0,Ds.kK)(i.extent,r)||(i.measures.splitPriority>0?t.push(i):n.push(i));t.sort(B_),this._tileBudgetExceeded>=1&&(this._mergeNewTiles(),this._tileBudgetExceeded>=1&&this._mergeNewTiles(!0))}else n.push(o);if(e.done)return}n.pushArray(t),this._pendingTiles.value=null,this._updateTiles(),n.clear(),s.done()}get _tileBudgetExceeded(){return Math.max(0,(this._newTiles.length+(this._pendingTiles.value?.length??0))/60-1)}_mergeNewTiles(e=!1){const{_newTiles:t,_measurements:i}=this,r=new Map(t.map((e=>[e.id,e])));let n=!1;return r.forEach((s=>{const{lij:o,measures:a}=s;if(!a.mergeable||o[1]%2!=0||o[2]%2!=0||o[0]<=1||s.lodLevelDelta>=4)return;const l=a.lodLevel;let c=l,u=!0;const h=r.get((0,wy.J)(o[0],o[1]+1,o[2]));let d=Math.abs((h?.measures.lodLevel??0)-l),p=0===d||e&&h?.measures.mergeable&&d<=1;if(!h||!p)return;c+=h.measures.lodLevel,u&&=0===d;const f=r.get((0,wy.J)(o[0],o[1],o[2]+1));if(d=Math.abs((f?.measures.lodLevel??0)-l),p=0===d||e&&f?.measures.mergeable&&d<=1,!f||!p)return;c+=f.measures.lodLevel,u&&=0===d;const m=r.get((0,wy.J)(o[0],o[1]+1,o[2]+1));if(d=Math.abs((m?.measures.lodLevel??0)-l),p=0===d||e&&m?.measures.mergeable&&d<=1,!m||!p)return;c+=m.measures.lodLevel,u&&=0===d,t.removeUnordered(s),t.removeUnordered(h),t.removeUnordered(f),t.removeUnordered(m);const g=new wy.Q(o[0]-1,o[1]/2,o[2]/2,this.tilingScheme);i.update(g),g.measures.visible=!0,g.measures.lodLevel=c/4,g.measures.mergeable=u,t.push(g),n=!0})),n}_updateTiles(){for(;this._mergeNewTiles(););for(;this._tileBudgetExceeded&&this._mergeNewTiles(!0););for(const e of this.tiles.items)e.used=!1;let e=!1;const t=this._newTiles.filter((t=>{const i=this._idToTile.get(t.id);return i?(e||=i.measures.lodLevel!==t.measures.lodLevel,i.measures={...t.measures},i.used=!0):this._idToTile.set(t.id,t),!i})),i=this.tiles.items.filter((e=>!e.used&&(this._idToTile.delete(e.id),!0)));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles(),!e||i.length||t.length||this.tiles.emit("change")}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort(((e,t)=>e.measures.distance-t.measures.distance)),this.tiles.forEach(((e,t)=>e.loadPriority=t))}};function B_(e,t){return e.lodLevelDelta-t.lodLevelDelta||e.measures.splitPriority-t.measures.splitPriority||t.measures.distance-e.measures.distance}(0,i._)([(0,y.Cb)({constructOnly:!0})],z_.prototype,"scheduler",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],z_.prototype,"renderCoordsHelper",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],z_.prototype,"tilingSchemeOwner",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],z_.prototype,"cameraOnSurface",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],z_.prototype,"focus",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],z_.prototype,"viewState",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],z_.prototype,"terrain",void 0),(0,i._)([(0,y.Cb)()],z_.prototype,"tiles",void 0),(0,i._)([(0,y.Cb)()],z_.prototype,"tileSize",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],z_.prototype,"tilingScheme",null),(0,i._)([(0,y.Cb)()],z_.prototype,"filterExtent",null),(0,i._)([(0,y.Cb)({readOnly:!0})],z_.prototype,"_filterExtentRect",null),(0,i._)([(0,y.Cb)({readOnly:!0})],z_.prototype,"_rootTileIds",null),(0,i._)([(0,y.Cb)({value:!1})],z_.prototype,"suspended",null),(0,i._)([(0,y.Cb)({readOnly:!0})],z_.prototype,"updating",null),z_=(0,i._)([(0,v.j)("esri.views.3d.layers.support.FeatureTileTree3D")],z_);var V_=n(81509);let H_=class extends P.Z{constructor(e){super(e),this._propertiesPool=new sm.L({camera:_d.Z},this),this._lastSeenCameraProjectionValues=new _d.Z,this.mode=Pi.n.ANIMATING,this._cssCamera=new _d.Z,this._camera=new _d.Z,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.constraints=new nl({state:this}),this.events=new L.Z,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}reset(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new sm.L({camera:_d.Z},this)}destroy(){this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===$t.JY.Global){const e=(0,_l.Iu)(this.spatialReference).radius;this.camera=new _d.Z({eye:(0,Pa.al)(4*e,0,0),center:(0,Pa.al)(e,0,0),up:(0,Pa.al)(0,0,1)})}else this.camera=new _d.Z({eye:(0,Pa.al)(0,0,100),center:(0,Pa.al)(0,0,0),up:(0,Pa.al)(0,1,0)})}get animation(){return this.cameraController instanceof yd&&null!=this.cameraController.viewAnimation?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:t,width:i,pixelRatio:r}=this.camera;return e.pixelRatio=1,e.height=Math.round(t/r),e.width=Math.round(i/r),e}get camera(){return this._camera}set camera(e){e!==j_&&j_.copyFrom(e),j_.computeUp(this.viewingMode),this.events.emit("before-camera-change",j_);const t=this._camera;if(function(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[rm.Np.TOP]!==t.padding[rm.Np.TOP]||e.padding[rm.Np.RIGHT]!==t.padding[rm.Np.RIGHT]||e.padding[rm.Np.BOTTOM]!==t.padding[rm.Np.BOTTOM]||e.padding[rm.Np.LEFT]!==t.padding[rm.Np.LEFT]}(this._lastSeenCameraProjectionValues,j_)&&(this._lastSeenCameraProjectionValues.copyFrom(j_),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!t.equals(j_)&&(this._camera=this._propertiesPool.get("camera").copyFrom(j_),this._cameraChanged=!t.almostEquals(j_),this._cameraChanged)){const e=(0,V_.Fs)((()=>{this._cameraChanged=!1,e.remove()}))}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Pi.n.IDLE}get updating(){return this.mode!==Pi.n.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=null!=e?e.clone():null}get fixedContentCamera(){return null!=this._contentCamera}get isGlobal(){return this.viewingMode===$t.JY.Global}get isLocal(){return this.viewingMode===$t.JY.Local}get viewingMode(){return(0,$t.wg)(this.view.viewingMode)}get spatialReference(){return this.view.spatialReference}get highlights(){const e=this.view.highlights.items.slice(0,At.Ke);for(let t=0;t<e.length;){const i=e[t],r=e.findIndex((e=>e.name===i.name));r>=0&&t>r?e.splice(t,1):++t}return e}get highlightOrderMap(){const e=new Map;return this.highlights.forEach(((t,i)=>e.set(t.name,i))),e}get navigating(){return!!this.cameraController?.isInteractive}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(Z_),this.addHandles((0,F.when)((()=>e.state===md.Finished||e.state===md.Stopped),(()=>{this._set("cameraController",null),this.updateCamera((t=>e.onControllerEnd(t)))}),{sync:!0,once:!0}),Z_),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=md.Rejected)}switchCameraController(e){this.cameraController=e}stopActiveCameraController(){return!this.cameraController||this.cameraController.stopController()}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(0===this._updateQueue.length||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();j_.copyFrom(this._get("camera")),e(j_),this.camera=j_,this._processingUpdates=!1,this._processUpdateQueue()}};(0,i._)([(0,y.Cb)({constructOnly:!0})],H_.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],H_.prototype,"mode",void 0),(0,i._)([(0,y.Cb)({readOnly:!0,type:Ni})],H_.prototype,"animation",null),(0,i._)([(0,y.Cb)({type:_d.Z})],H_.prototype,"cssCamera",null),(0,i._)([(0,y.Cb)()],H_.prototype,"_cssCamera",void 0),(0,i._)([(0,y.Cb)({type:_d.Z})],H_.prototype,"camera",null),(0,i._)([(0,y.Cb)()],H_.prototype,"_camera",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"pixelRatio",null),(0,i._)([(0,y.Cb)()],H_.prototype,"rasterPixelRatio",void 0),(0,i._)([(0,y.Cb)()],H_.prototype,"contentPixelRatio",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"alignPixelEnabled",null),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"updating",null),(0,i._)([(0,y.Cb)({})],H_.prototype,"_contentCamera",void 0),(0,i._)([(0,y.Cb)({type:_d.Z})],H_.prototype,"contentCamera",null),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"fixedContentCamera",null),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"events",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"isGlobal",null),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"isLocal",null),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"viewingMode",null),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"highlights",null),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"highlightOrderMap",null),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"navigating",null),(0,i._)([(0,y.Cb)({readOnly:!0})],H_.prototype,"stationary",null),(0,i._)([(0,y.Cb)()],H_.prototype,"_cameraChanged",void 0),(0,i._)([(0,y.Cb)()],H_.prototype,"cameraController",null),H_=(0,i._)([(0,v.j)("esri.views.3d.state.ViewState")],H_);const G_=H_;const j_=new _d.Z,Z_="ViewStateHandles";var q_=n(83772),W_=n(51809),$_=n(66218);class Y_{constructor(e,t,i){this.viewingMode=e,this._forEachLayer=t,this._view=i,this._externalIntersectionHandlers=new Pg.Z,this._tolerance=vd.jb,this._tmpRay=(0,uh.Ue)(),this._tmpRegion=(0,Ds.Ue)(),this._validateHUDIntersector=(0,vd.Z8)(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,t,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),ev(this.viewingMode),t,i)}intersectScreenFreePointFallback(e,t,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),t,i)}intersectRayFreePointFallback(e,t,i){return this.intersectRay(e,ev(this.viewingMode),t,i)||this._intersectRayFreePointLocal(e,t)}intersectRay(e,t,i,r){return t.options.selectionMode=!1,t.options.store=Zg.eC.MIN,this.computeIntersection(e,t,r),!!t.results.min&&t.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,t,i=.5,r=.5){return e.getRenderCenter(sv,i,r),sv[0]+=.0466,sv[1]-=.0123,(0,Nd.eW)(e,sv,t)}intersectIntersectorScreen(e,t,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),t,i)}intersectToolIntersectorScreen(e,t,i){const r=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(r,t,i)}intersectToolIntersectorRay(e,t,i){t.options.selectionMode=!0,this.computeIntersection(e,t,i);const r=t.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||(0,$_.nn)(r)&&r.intersector!==Zg.q7.TERRAIN||(t.options.selectionMode=!1,this.computeIntersection(e,t,i))}setTolerance(e=vd.jb){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort(((e,t)=>e.type===Zg.q7.TERRAIN?1:t.type===Zg.q7.TERRAIN?-1:0))}removeIntersectionHandler(e){null!=this._externalIntersectionHandlers.removeUnordered(e)&&this._externalIntersectionHandlers.sort(((e,t)=>e.type===Zg.q7.TERRAIN?1:t.type===Zg.q7.TERRAIN?-1:0))}_getPickRay(e,t){const i=this._view.state.camera;return(0,Nd.u4)(i,e,t)}_intersectRayFreePointLocal(e,t){return this.viewingMode!==$t.JY.Local||null==e||(0,hr.g)(t,e.origin,(0,hr.n)(Ad.WM.get(),e.direction)),!1}intersectElevationFromScreen(e,t,i=0,r=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),t,i,r)}_intersectElevation(e,t,i=0,r=null){if(null==e)return null;const n=this._view,{renderCoordsHelper:s}=n,o=(0,Ma._R)(n.spatialReference),a=null!=t?t.mode:"absolute-height",l=(0,q_.fm)(t)/o,c=("on-the-ground"!==a?l+i:0)*o/s.unitInMeters,{camera:u}=n.state;if("absolute-height"===a){const t=s?.getAltitude(u.eye),i=(0,hr.f)((0,hr.n)(rv,e.direction),s.worldUpAtPosition(u.eye,nv));if(t<c&&i<0||t>=c&&i>0)return null;if(s.intersectInfiniteManifold(e,c,rv)){const e=(0,W_.K0)(n,rv);return e.z??=0,e.z-=l,e}return null}const h=(0,$e.Wv)(Ad.WM.get());u.projectToRenderScreen(e.origin,h);const d=new tv(null,this._forEachLayer),{slicePlane:p}=n,f=null!=p?(0,$_.e4)(p):null,m=(0,vd.Z8)(this.viewingMode);m.options.store=Zg.eC.MIN,m.options.verticalOffset=c,m.options.normalRequired=!1;const g=e.origin,y=(0,hr.g)(Ad.WM.get(),g,e.direction);m.reset(g,y,u),m.point=h;const _=r?"type"in r&&"graphics"===r.type?e=>e.layerUid!==r.uid:e=>e.graphicUid!==r.uid:null;switch(a){case"relative-to-scene":{const e=e=>(!_||_(e))&&!!e.lastValidElevationBB;m.intersect(d.layers,h,this._tolerance,null,e),this._externalIntersectionHandlers.forAll((e=>{if(e.type===Zg.q7.I3S||e.type===Zg.q7.TERRAIN||e.type===Zg.q7.TILES3D){const t=e.slicePlaneEnabled?f:null;e.intersect(m,t,m.rayBegin,m.rayEnd,h)}}));break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll((e=>{if(e.isGround){const t=e.slicePlaneEnabled?f:null;e.intersect(m,t,m.rayBegin,m.rayEnd,h)}}))}if(m.results.min.getIntersectionPoint(rv)){const e=(0,W_.K0)(n,rv);return e.z=i,e}return null}computeIntersection(e,t,i,r){if(null==e)return;const n=this._view.state.camera,s=(0,$e.Wv)(Ad.WM.get());n.projectToRenderScreen(e.origin,s);const o=new tv(i,this._forEachLayer);t.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=(0,hr.g)(Ad.WM.get(),e.origin,e.direction);t.reset(a,l,n),t.intersect(o.layers,s,this._tolerance);const c=this._view.slicePlane,u=null!=c?(0,$_.e4)(c):null;t.intersect(o.sliceableLayers,s,this._tolerance,u);const h=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll((e=>{const i=e.layerUid,n=Array.isArray(i),c=n?i:[i];n&&(t.options.filteredLayerUids=[]);let d=!1;for(const e of c)o.filterLayerUid(e)?d=!0:n&&t.options.filteredLayerUids.push(e);if(t.options.isFiltered=!d,e.isGround&&h||!t.options.isFiltered){const i=e.slicePlaneEnabled?u:null;e.intersect(t,i,a,l,s,r)}}));const d=Ad.WM.get(),p=this._view.basemapTerrain;if(i&&i.enableDraped&&null!=p.spatialReference&&t.results.ground.getIntersectionPoint(d)){const e=p.overlayManager.renderer,i=this._view.renderCoordsHelper.spatialReference,r=Ad.WM.get();this._view.renderCoordsHelper.fromRenderCoords(d,r,p.spatialReference),r[2]=this._view.elevationProvider?.getElevation(d[0],d[1],d[2],i,"ground")??0,e.intersect(t,r,t.results.ground,(e=>o.filterRenderGeometry(e)))}t.sortResults(),this._processHUDResults(t)}_processHUDResults(e){const t=e.results.hud;(0,Ds.JG)(this._tmpRegion,Ds.G_);const i=this._view.state.camera,r=[],n=this._tmpRegion,s=e=>{const t=new K_(e),s=t.result.target.object.geometries.every((e=>e.material instanceof Wg.A&&e.material.parameters.occlusionTest));r.push({item:t,occlusionTest:s}),s&&(i.projectToRenderScreen(e.target.center,t.screenPoint),t.screenPoint[0]=Math.floor(t.screenPoint[0]),t.screenPoint[1]=Math.floor(t.screenPoint[1]),(0,Ds.Ho)(n,t.screenPoint))};e.sortResults(t.all),null!=t.min.dist&&s(t.min);for(const e of t.all)t.min.target.object!==e.target.object&&t.max.target.object!==e.target.object&&s(e);if(null!=t.max.dist&&t.max.target.object!==t.min.target.object&&s(t.max),!r.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const o=i.fullWidth,a=i.fullHeight,l=Math.max(0,n[0]-J_),c=Math.max(0,n[1]-J_),u=Math.min((0,Ds.d_)(n)+2*J_,o-l),h=Math.min((0,Ds.Cb)(n)+2*J_,a-c),d=u>0&&h>0?new Uint8Array(u*h*4):null;d&&this._view._stage.renderer.readHUDVisibility(l,c,u,h,d);let p=!0;const f=null==e.results.max.dist;let m=0;for(const{item:t,occlusionTest:i}of r){let r=!i;if(i&&d)for(const e of X_){const i=4*(Math.min(t.screenPoint[0]+e[0],o)-n[0]+(Math.min(t.screenPoint[1]+e[1],a)-n[1])*u);if(i>=0&&i<d.length&&d[i]){r=!0;break}}r&&(p&&(e.results.min.copy(t.result),p=!1),f&&e.results.max.copy(t.result),e.options.store===Zg.eC.ALL&&e.results.all.splice(m++,0,t.result))}}}const J_=1,X_=(()=>{const e=[],t=J_;for(let i=-1;i<=t;i++)for(let r=-1;r<=t;r++)e.push([r+t,i+t]);return e})();class K_{constructor(e){this.result=e,this.screenPoint=(0,$e.J$)()}}let Q_;function ev(e){return Q_&&Q_.viewingMode===e||(Q_=(0,vd.Z8)(e)),Q_}class tv{constructor(e,t){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,t((e=>{e.pickable&&this.filterLayerUid(e.apiLayerUid)&&(e.sliceable?this.sliceableLayers:this.layers).push(e)}))}filterLayerUid(e){const{include:t,exclude:i}=this;return null==e?null==t&&null==i:(null==t||t.has(e))&&(null==i||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}}function iv(e){return"object"==typeof e&&"intersect"in e}const rv=(0,Pa.Ue)(),nv=(0,Pa.Ue)(),sv=(0,$e.J$)();var ov=n(89301),av=n(88038);let lv=class extends(L.Z.EventedMixin(P.Z)){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=(0,m.SC)(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,t,i,r,n){if(this._cacheEnabled&&null!=this.lastElevationQuery){const s=this.lastElevationQuery;if(e===s.x&&t===s.y&&i===s.z&&(0,Le.fS)(r,s.spatialReference)&&n===s.queryContext)return s.result}let s=null;return s=cv(s,this._im,e,t,i,r,n),null==s&&(s=cv(s,this._ground,e,t,i,r,n)),"scene"===n&&(s=cv(s,this._scene,e,t,i,r,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:n,result:s}),s}getSphereElevationBounds(e,t,i){const r=new av.r;function n(n){for(const s of n)if(s.getSphereElevationBounds){const n=s.getSphereElevationBounds(e,t,i);null!=n&&r.expandElevationRangeValues(n.elevationRangeMin,n.elevationRangeMax)}}return n(this._ground),n(this._im),"scene"===i&&n(this._scene),r}getRootElevationBounds(){const e=new av.r;for(const t of[this._im,this._ground,this._scene])t.forEach((t=>{if(t.getRootElevationBounds){const i=t.getRootElevationBounds();null!=i&&e.expandElevationRangeValues(i.elevationRangeMin,i.elevationRangeMax)}}));return e}async queryElevation(e,t,i,r,n,s=null,o=0){const a=this._getElevationQuery(r);try{const l=await a.queryElevation(e,t,s,o);return"scene"===n?cv(l,this._scene,e,t,i,r,n):l}catch(s){return(0,g.r9)(s),this.getElevation(e,t,i,r,n)}}register(e,t){this.addHandles(t.on("elevation-change",(e=>this.emit("elevation-change",e))),t),this._providersFromContext(e).push(t)}unregister(e){this.removeHandles(e);for(const t of[this._im,this._ground,this._scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const t=this._cachedQuery;if(null!=t&&(0,Le.fS)(e,t.spatialReference))return t;t?.destroy({completeTasks:!0});const{wkid:i,wkt:r,wkt2:n,latestWkid:s}=e,o=new ov.K(this.view.resourceController.scheduler,new Ie.Z({wkid:i,wkt:r,wkt2:n,latestWkid:s}),(()=>this.view.map?.ground),{maximumAutoTileRequests:4});return this._cachedQuery=o,o}};function cv(e,t,i,r,n,s,o){for(const a of t){const t=a.getElevation(i,r,n,s,o);null!=t&&(e=null!=e?Math.max(t,e):t)}return e}(0,i._)([(0,y.Cb)({constructOnly:!0})],lv.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],lv.prototype,"spatialReference",null),lv=(0,i._)([(0,v.j)("esri.views.3d.support.CombinedElevationProvider")],lv);class uv{static isValidProfile(e){return e in uv.profiles}static getDefaultProfile(){return(0,w.Z)("esri-iPhone")?"low":"medium"}static apply(e,t){const i=uv.profiles[e];t.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,t.graphics3D.maxNumberOfDrawCalls=i.graphics3D.maxNumberOfDrawCalls,t.graphics3D.maxTotalNumberOfVertices=i.graphics3D.maxTotalNumberOfVertices,t.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,t.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,t.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,t.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods,t.graphics3D.uncompressedTextureDownsamplingEnabled=i.graphics3D.uncompressedTextureDownsamplingEnabled;const r=t.sceneService.object,n=i.sceneService.object;r.lodFactor=n.lodFactor,t.sceneService.point.lodFactor=i.sceneService.point.lodFactor,t.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,t.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,t.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,t.tiledSurface.lodBias=i.tiledSurface.lodBias,t.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,t.tiledSurface.vtlContentZoom=i.tiledSurface.vtlContentZoom,t.tiledSurface.elevationLevelDelta=i.tiledSurface.elevationLevelDelta,t.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,t.heatmap.pixelRatio=i.heatmap.pixelRatio,t.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,t.fadeDuration=i.fadeDuration,t.antialiasingEnabled=i.antialiasingEnabled,t.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,t.highQualityTransparency=i.highQualityTransparency,t.highResolutionAtmosphere=i.highResolutionAtmosphere,t.reflections=i.reflections,t.ambientOcclusion=i.ambientOcclusion,t.memoryLimit=i.memoryLimit,t.additionalCacheMemory=i.additionalCacheMemory,t.frameRate=i.frameRate,t.maximumPixelRatio=i.maximumPixelRatio}}uv.test={reset(){const e=gv();for(const t of Object.keys(e))uv.profiles[t]=e[t]}};const hv=120,dv=200,pv=240,fv=300,mv=430;function gv(){const e=!!(0,w.Z)("esri-mobile"),t=!!(0,w.Z)("ios"),i=(0,en.HA)(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:(0,en.HA)(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+hv,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:e},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!(0,w.Z)("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:e?600+dv:750+pv,additionalCacheMemory:e?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!(0,w.Z)("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:e?900+fv:1500+mv,additionalCacheMemory:e?-150:0,frameRate:0,maximumPixelRatio:e?1:1/0}}}var yv;!function(e){e.profiles=gv()}(uv),function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"}(yv||(yv={}));const _v=[yv.ELEVATION,yv.MAP];var vv=n(19832);async function bv(e,t){const{results:i,ground:r}=await(0,vv.ZV)(e,t),n=(!r.layer||!(0,z.nx)(r.layer.type))&&r.mapPoint,s=[],o=function(e){const t=new Map;for(const i of e.allLayerViews){const e=i.layer.uid;t.set(e,i)}return t}(e),a=n?function(e,t){const i=new Set,r=[];for(let t=e.basemapTerrain.numLayers(yv.MAP)-1;t>=0;t--){const n=e.basemapTerrain.layerViewByIndex(t,yv.MAP);i.add(n.layer.uid),r.push(n)}const n=e.basemapTerrain.overlayManager.renderer.layers;for(const{uid:e}of n){const n=t.get(e);n&&(i.add(e),r.push(n))}return r.reverse(),{layerUids:i,layerViews:r}}(e,o):wv;let l=0,c=0;const u=()=>{const e=a.layerViews[c];n&&e&&"fetchPopupFeaturesAtLocation"in e&&s.push({mapPoint:r.mapPoint,layerView:e}),++c};let h=null;for(;l<i.length||c<a.layerViews.length;){const t=i[l];if(t&&"graphic"!==t.type)++l;else if("scene"!==t?.layer?.type||t?.layer?.parent!==e?.map?.basemap)if(t){const e=t.layer?.uid,i=a.layerUids.has(e)&&t.distance===r.distance,n=o.get(t.layer?.uid);if(h??=t.mapPoint,c<a.layerViews.length&&(i||(t.distance??0)>r.distance)&&a.layerViews[c]!==n){u();continue}s.push({graphic:t.graphic,layerView:n}),++l}else u();else++l}return h??=r.mapPoint,{hits:s,location:h}}const wv={layerUids:new Set,layerViews:[]};let xv=class extends P.Z{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};(0,i._)([(0,y.Cb)()],xv.prototype,"minTotalNumberOfFeatures",void 0),(0,i._)([(0,y.Cb)()],xv.prototype,"maxTotalNumberOfFeatures",void 0),(0,i._)([(0,y.Cb)()],xv.prototype,"maxNumberOfDrawCalls",void 0),(0,i._)([(0,y.Cb)()],xv.prototype,"maxTotalNumberOfVertices",void 0),(0,i._)([(0,y.Cb)()],xv.prototype,"snapshotAvailable",void 0),(0,i._)([(0,y.Cb)()],xv.prototype,"polygonLodFactor",void 0),(0,i._)([(0,y.Cb)()],xv.prototype,"polylineLodFactor",void 0),(0,i._)([(0,y.Cb)()],xv.prototype,"skipHighSymbolLods",void 0),(0,i._)([(0,y.Cb)()],xv.prototype,"uncompressedTextureDownsamplingEnabled",void 0),xv=(0,i._)([(0,v.j)("esri.views.3d.support.QualitySettings.Graphics3DSettings")],xv);let Tv=class extends P.Z{constructor(){super(...arguments),this.lodFactor=1}};(0,i._)([(0,y.Cb)()],Tv.prototype,"lodFactor",void 0),Tv=(0,i._)([(0,v.j)("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Tv);let Cv=class extends P.Z{constructor(){super(...arguments),this.object=new Tv,this.point=new Tv,this.integratedMesh=new Tv,this.pointCloud=new Tv,this.uncompressedTextureDownsamplingEnabled=!1}};(0,i._)([(0,y.Cb)({type:Tv})],Cv.prototype,"object",void 0),(0,i._)([(0,y.Cb)({type:Tv})],Cv.prototype,"point",void 0),(0,i._)([(0,y.Cb)({type:Tv})],Cv.prototype,"integratedMesh",void 0),(0,i._)([(0,y.Cb)({type:Tv})],Cv.prototype,"pointCloud",void 0),(0,i._)([(0,y.Cb)()],Cv.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Cv=(0,i._)([(0,v.j)("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Cv);let Sv=class extends P.Z{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};(0,i._)([(0,y.Cb)()],Sv.prototype,"lodBias",void 0),(0,i._)([(0,y.Cb)()],Sv.prototype,"angledSplitBias",void 0),(0,i._)([(0,y.Cb)()],Sv.prototype,"vtlContentZoom",void 0),(0,i._)([(0,y.Cb)()],Sv.prototype,"elevationLevelDelta",void 0),(0,i._)([(0,y.Cb)()],Sv.prototype,"reduceTileLevelDifferences",void 0),Sv=(0,i._)([(0,v.j)("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Sv);let Ev=class extends P.Z{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};(0,i._)([(0,y.Cb)()],Ev.prototype,"pixelRatio",void 0),(0,i._)([(0,y.Cb)()],Ev.prototype,"maxTotalNumberOfFeatures",void 0),Ev=(0,i._)([(0,v.j)("esri.views.3d.support.QualitySettings.HeatmapSettings")],Ev);let Mv=class extends P.Z{constructor(){super(...arguments),this.graphics3D=new xv,this.sceneService=new Cv,this.tiledSurface=new Sv,this.heatmap=new Ev,this.fadeDuration=(0,en.HA)(400),this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};(0,i._)([(0,y.Cb)({type:xv})],Mv.prototype,"graphics3D",void 0),(0,i._)([(0,y.Cb)({type:Cv})],Mv.prototype,"sceneService",void 0),(0,i._)([(0,y.Cb)({type:Sv})],Mv.prototype,"tiledSurface",void 0),(0,i._)([(0,y.Cb)({type:Ev})],Mv.prototype,"heatmap",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"fadeDuration",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"antialiasingEnabled",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"physicallyBasedRenderingEnabled",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"highQualityTransparency",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"highResolutionAtmosphere",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"reflections",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"ambientOcclusion",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"memoryLimit",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"additionalCacheMemory",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"frameRate",void 0),(0,i._)([(0,y.Cb)()],Mv.prototype,"maximumPixelRatio",void 0),Mv=(0,i._)([(0,v.j)("esri.views.3d.support.QualitySettings")],Mv);const Av=Mv;var Rv=n(43180),Ov=n(25024),Pv=n(8864),Iv=n(66341),Lv=n(15095);class Dv{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}}class Nv{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new Fv}}class Fv{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class Uv{constructor(e,t,i,r){this._workerFunc=e,this._callbackFunc=t,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=r.map((e=>new Nv(e)))}destroy(){this._clients.length=0}hasQuota(e){const t=this._clients[e];return!!t&&(this._totalNumWorkers<this._maxTotalNumWorkers||t.numWorkers+t.tasks.length<t.typeWorkerQuota)}push(e){const t=this._clients[e.client];t&&(this._totalNumWorkers<this._maxTotalNumWorkers?(t.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,((e,t)=>this._taskCallback(e,t)))):t.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const t=this._clients[e.client];this._totalNumWorkers--,t&&(t.numWorkers--,t.statistics.requests++,t.statistics.size+=e.size||0,t.statistics.duration+=e.duration||0,t.statistics.speed=t.statistics.duration>0?t.statistics.size/t.statistics.duration:0,(0,Lv.hu)(t.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),((e,t)=>this._taskCallback(e,t))))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,t){e._cancelled||(this._callbackFunc(e,t),this._taskFinished(e))}getStatsForType(e){const t=this._clients[e];return t?{quota:t.typeWorkerQuota,workers:t.numWorkers,queueSize:t.tasks.length,requestStats:t.statistics}:null}get test(){}}class kv{constructor(e,t){this.element=e,this.type="image+type",this.isOpaque="image/jpeg"===t}}var zv=n(11107);let Bv=class extends P.Z{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new Uv(((e,t)=>this._startLoading(e,t)),((e,t)=>this._doneLoadingCB(e,t)),e,t),i&&(this._frameTask=i.registerTask(Ii.T8.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=(0,m.hw)(this._frameTask),this._tasks.forEach((e=>(0,m.IM)(e.abortController))),this._loadQueue=(0,m.SC)(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const n=(0,g.hh)();n.__signal=null!=r?r.signal:null;const s=this._createOrUpdateTask(e,t,i,r,n);return(0,g.fu)(r,(()=>this._cancelRequest(s,n))),n.promise}_createTask(e,t,i,r,n,s){const o=new Hv(e,t,i,r,n);return this._updateTask(o,s),this._tasks.set(n,o),1===this._tasks.size&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){(0,Xe.e$)(e.resolvers,t),t.reject((0,g.zE)()),0===e.resolvers.length&&(e.status===Gv.DOWNLOADING&&(e.status=Gv.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=Gv.CANCELLED,this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,n){const s=function(e,t,i){return`${e}:${t}:${i}`}(r?.uid||e,t,i),o=this._tasks.get(s);return o?(this._updateTask(o,n),o):this._createTask(e,r,t,i,s,n)}_doneLoadingCB(e,t){this._loadQueue&&((0,Lv.hu)(e.status===Gv.DOWNLOADING),e.status=Gv.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();(0,g.k_)(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==Gv.DOWNLOADED&&(t.err=t.err||(0,g.zE)()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!(0,g.D_)(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=(0,zv.Cm)(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)(0,g.D_)(t)?r.reject(t):r.reject(new c.Z("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const t=i>0?(0,h.d9)(e.result):e.result;r.resolve(t)}this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1)}_startLoading(e,t){if(e.status===Gv.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=Gv.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=(0,Iv.Z)(e.url,{...e.options,responseType:r,timeout:i,signal:n});const s=i=>{e.duration=performance.now()-e.startTime,e.size=i instanceof ArrayBuffer?i.byteLength:e.size||0,e.result=i,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},o=i=>{e.status===Gv.DOWNLOADING&&t(e,i)};return"image+type"!==e.docType?(e.request.then((e=>s(e.data)),o),!0):(e.request.then((t=>{const a=t.data,l=function(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return 137===t[0]&&80===t[1]?"image/png":71===t[0]&&73===t[1]?"image/gif":66===t[0]&&77===t[1]?"image/bmp":255===t[0]&&216===t[1]?"image/jpeg":"unknown"}(a);if(r="image",e.size=a.byteLength,"unknown"===l)return e.request=(0,Iv.Z)(e.url,{responseType:r,timeout:i,signal:n}),void e.request.then((e=>s(e.data)),o);const c=new Blob([a],{type:l}),u=window.URL.createObjectURL(c);e.request=(0,Iv.Z)(u,{responseType:r,timeout:i,signal:n}),e.request.then((e=>s(new kv(e.data,l))),o).finally((()=>window.URL.revokeObjectURL(u)))}),o),!0)}get test(){}};(0,i._)([(0,y.Cb)({readOnly:!0})],Bv.prototype,"updating",void 0),Bv=(0,i._)([(0,v.j)("esri.views.3d.support.StreamDataLoader")],Bv);const Vv=0;class Hv extends Dv{constructor(e,t,i,r,n){super(r),this.url=e,this.options=t,this.docType=i,this.key=n,this.result=null,this.status=Gv.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Vv}}var Gv;!function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"}(Gv||(Gv={}));let jv=class extends P.Z{constructor(){super(...arguments),this.updating=!1}};(0,i._)([(0,y.Cb)({readOnly:!0})],jv.prototype,"updating",void 0),jv=(0,i._)([(0,v.j)("esri.views.3d.support.ResourceController.ResourceControllerMain")],jv);let Zv=class extends jv{constructor(){super(...arguments),this._immediateTask=Ii.sq,this._normalTask=Ii.sq,this._updatingObjects=(0,yl.t)([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=(0,Ii.z4)(),this._memoryController=(0,Pv.c)(this.view),this._streamDataLoader=new Bv,this._streamDataLoader.setup(Ov.NT,Ov.Ty,this._scheduler),this.addHandles([(0,F.watch)((()=>this.view.state?.mode),(e=>{null!=e&&(this._scheduler.state=e)}),F.sync),(0,F.watch)((()=>this.view.stationary),(()=>this._stationaryChangedHandler()))]),this._frameTask=(0,ue.A)({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Ii.T8.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Ii.T8.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=(0,m.hw)(this._frameTask),this._streamDataLoader=(0,m.SC)(this._streamDataLoader),this._memoryController=(0,m.SC)(this._memoryController),this._scheduler=(0,m.SC)(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some((e=>e.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(i,r,n)=>t.request(i,r,e,n),get busy(){return!t.hasDownloadSlots(e)}}}addUpdatingObject(e){const t=this._updatingObjects;return t.value=[...t.value,e],(0,N.kB)((()=>{t.value=t.value.filter((t=>t!==e))}))}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step((0,en.D9)(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.frame(e))}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};(0,i._)([(0,y.Cb)()],Zv.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],Zv.prototype,"_scheduler",void 0),(0,i._)([(0,y.Cb)()],Zv.prototype,"_memoryController",void 0),(0,i._)([(0,y.Cb)()],Zv.prototype,"_streamDataLoader",void 0),(0,i._)([(0,y.Cb)()],Zv.prototype,"_immediateTask",void 0),(0,i._)([(0,y.Cb)()],Zv.prototype,"_normalTask",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Zv.prototype,"updating",null),Zv=(0,i._)([(0,v.j)("esri.views.3d.support.ResourceController")],Zv);var qv=n(25015),Wv=n(70633);class $v{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const t=e.performanceInfo;this.memory=t.usedMemory,this.displayedNumberOfFeatures=t.displayedFeatures,this.maximumNumberOfFeatures=t.maximumFeatures,this.totalNumberOfFeatures=t.totalFeatures}}class Yv{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,null!=e.resourceController){const t=e.resourceController.memoryController;this.totalMemory=(t.maxMemory??0)*qv.Y.MEGABYTES,this.usedMemory=Math.round(t.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=t.usedCacheMemory}this.terrainMemory=e.basemapTerrain?.usedMemory??0,this.edgesMemory=e._stage?.renderer.usedMemory.edges??0,this.fboMemory=e._stage?.renderer.usedMemory.fbos??0,e.allLayerViews?.items.forEach((e=>{(0,Wv.l)(e)&&this.layerPerformanceInfos.push(new $v(e))})),this.layerPerformanceInfos.sort(((e,t)=>t.memory-e.memory))}}var Jv=n(91420),Xv=n(1305);class Kv{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",(()=>{})),this._wosrMemCache=e("wosr-resources",(()=>{}))}destroy(){this._gltfLoading.forEach((e=>e.abortController.abort())),this._wosrLoading.forEach((e=>e.abortController.abort())),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,t,i){const r=i?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(r);return null!=s?Promise.resolve(s):Qv(this._gltfLoading,this._gltfMemCache,r,(async t=>{const{loadGLTF:r}=await Promise.all([n.e(85636),n.e(95970)]).then(n.bind(n,85636));return r(new Jv.C(t.streamDataRequester),e,t,i)}),t)}loadWOSR(e,t){const i=`wosr:${e}:${t.disableTextures}`,r=this._wosrMemCache.get(i);return null!=r?Promise.resolve(r):Qv(this._wosrLoading,this._wosrMemCache,i,(t=>(0,Xv.zD)(e,t)),t)}}async function Qv(e,t,i,r,n){(0,g.k_)(n);const s=(0,g.fu)(n,(()=>function(e,t){const i=e.get(t);if(null!=i&&--i.refCount>0)return;e.delete(t),null!=i&&i.abortController.abort()}(e,i)));let o=e.get(i);if(o)o.refCount++;else{const t=new AbortController;o={refCount:1,abortController:t,promise:r({...n,signal:t.signal})},e.set(i,o)}try{const r=await o.promise;return t.put(i,r),e.delete(i),(0,g.k_)(n),r}finally{(0,m.hw)(s)}}var eb=n(3466);let tb=class extends P.Z{constructor(e,t){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=t?.registerTask(Ii.T8.TEXTURE_UNLOAD)??Ii.sq}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach((e=>this._releaseTextureRequest(e))),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,t){const i=this.makeUid(e);let r=this._textureRequests.get(i);if(!r){const e=new rb;e.texture=t(),this._stage&&(e.texture.load(this._stage.renderView.renderingContext),this._stage.add(e.texture)),this._textureRequests.set(i,e),r=e}return r.referenceCount++,new ib(i,r.texture,(()=>this._release(i)))}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule((()=>this._releaseNow(e)))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(t.texture?.unload(),this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return null!=t?`${e}.${t}px`:e}};(0,i._)([(0,y.Cb)()],tb.prototype,"_frameTask",void 0),(0,i._)([(0,y.Cb)()],tb.prototype,"updating",null),tb=(0,i._)([(0,v.j)("esri.views.3d.support.TextureCollection")],tb);class ib{constructor(e,t,i){this.uid=e,this.texture=t,this.release=i}}class rb{constructor(){this.referenceCount=0}}var nb=n(44101);class sb extends tb{constructor(e,t,i){super(t,i),this._streamDataRequester=e}async fromUrl(e,t,i){(0,g.k_)(i);const r=i?.signal,n=this.makeUid(e,t);let s=this._textureRequests.get(n);if(!s){const i=new AbortController,r=this._streamDataRequester.request(e,"image",{uid:n,signal:i.signal});s=new rb,s.abortController=i;const o=s;this._textureRequests.set(n,s),s.textureAsync=r.then((async i=>{const r=this._createTexture(e,i,t);return o.texture=r,o.abortController=null,await r.load(this._stage.renderView.renderingContext),this._stage.add(r),new ib(n,r,(()=>this._release(n)))}),(e=>{throw o.abortController=null,e}))}s.referenceCount++;try{return await(0,g.Hl)(s.textureAsync,r)}catch(e){throw this._release(n),e}}_createTexture(e,t,i){const r={width:t.width,height:t.height,wrap:{s:Rl.e8.CLAMP_TO_EDGE,t:Rl.e8.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if((0,eb.zd)(e)){if(i||0===t.width&&0===t.height){const e=t.width?t.height/t.width:1;i=i||64,e>1?(t.width=Math.round(i/e),t.height=i):(t.width=i,t.height=Math.round(i*e))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(r.preMultiplyAlpha=!1)}return new nb.x(t,r)}}class ob{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Ov.Bh.SYMBOLOGY),this.objectResourceCache=new Kv(((t,i)=>e.resourceController.memoryController.newCache(t,i))),this.textures=new sb(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const t=(0,_l.Iu)(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=(0,qg.Gw)(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=(0,qg.n9)(e.viewingMode,t)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return(0,N.kB)();this._graphicsOwners.push(e);const t=(0,F.watch)((()=>e.layer?.screenSizePerspectiveEnabled),(()=>this._updateScreenSizePerspectiveEnabled()));return this._updateScreenSizePerspectiveEnabled(),(0,N.kB)((()=>{t.remove(),(0,Xe.e$)(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()}))}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some((e=>!0===e.layer?.screenSizePerspectiveEnabled));if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Me.Z;const e=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([(0,F.watch)((()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance),e,F.sync),this._viewState.events.on("camera-projection-changed",e)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=(0,m.SC)(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;ab.distance=e.centerOnSurfaceInfrequent.distance,ab.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(ab),this.screenSizePerspectiveSettingsLabels.update(ab),this._view._stage.renderView.requestRender()}get test(){}}const ab={distance:0,fovY:0};n(90819);var lb=n(80419),cb=(n(62063),n(60076),n(60378)),ub=n(69996);class hb{constructor(e){this.destination=e}hide(){null!=this.graphic&&(this.destination.remove(this.graphic),this.graphic=null)}}class db extends hb{constructor(e,t,i=""){super(e),this._symbol=new cb.Z({symbolLayers:new o.Z([new lb.Z({material:{color:t},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new ub.Z({text:i,halo:{color:"white",size:1/.75},material:{color:t},size:12})])})}show(e,t){if(!t)return;this.hide();const i=new wi.Z({x:e[0],y:e[1],z:e[2],spatialReference:t});this.graphic=new js.Z({geometry:i,symbol:this._symbol}),this.destination.add(this.graphic)}}let pb=class extends P.Z{constructor(e){super(e)}};(0,i._)([(0,y.Cb)({constructOnly:!0})],pb.prototype,"renderCoordsHelper",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],pb.prototype,"surface",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],pb.prototype,"state",void 0),pb=(0,i._)([(0,v.j)("esri.views.3d.support.pointsOfInterest.PointOfInterest")],pb);const fb=Array;let mb=class extends pb{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new sm.L({location:wi.Z,renderLocation:fb},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=(0,Pa.Ue)(),this._tmpPoint=new wi.Z}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles((0,F.on)((()=>this.map?.ground?.layers),"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=(0,m.SC)(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,t=(0,hr.j)(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return(0,ka.Xt)(i,t)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),zl.J;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const t=(this._tmpPoint.z??0)>yb&&this.renderCoordsHelper.viewingMode===$t.JY.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:t?_b:0}).then((e=>this._updateSurfaceAltitude(e.geometry.z??0))).catch((e=>{(0,g.D_)(e)||this._updateSurfaceAltitude(0)})).catch((()=>{})).then((()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null})),this._pendingElevationQueryController=i,zl.J}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(gb,this._estimatedSurfaceAltitude,this._camera.eye),(0,hr.p)(this._get("renderLocation"),gb)||(this._set("renderLocation",(0,hr.c)(this._propertiesPool.get("renderLocation"),gb)),this.notifyChange("renderLocation"))}};(0,i._)([(0,y.Cb)({constructOnly:!0})],mb.prototype,"scheduler",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],mb.prototype,"cache",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],mb.prototype,"task",void 0),(0,i._)([(0,y.Cb)()],mb.prototype,"location",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],mb.prototype,"map",void 0),(0,i._)([(0,y.Cb)()],mb.prototype,"renderLocation",void 0),(0,i._)([(0,y.Cb)()],mb.prototype,"scale",null),(0,i._)([(0,y.Cb)()],mb.prototype,"updating",null),mb=(0,i._)([(0,v.j)("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],mb);const gb=(0,Pa.Ue)(),yb=1e5,_b=1e6,vb=Array;let bb=class extends pb{constructor(e){super(e),this._propertiesPool=new sm.L({location:wi.Z,renderLocation:vb},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=(0,Pa.Ue)(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=(0,m.hw)(this._frameWorker),this._propertiesPool=(0,m.SC)(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,zl.J}_updateRenderLocation(){const e=xb;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=Tb;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&((0,hr.c)(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=(0,hr.j)(this._camera.eye,e):((0,hr.h)(e,this._camera.viewForward,this._get("distance")),(0,hr.g)(e,e,this._camera.eye)),(0,hr.p)(this._get("renderLocation"),e)||this._set("renderLocation",(0,hr.c)(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=(0,_l.Iu)(this.renderCoordsHelper.spatialReference).radius,n=r+e,s=(0,hr.k)(i.eye),o=s<n*n,a=(0,hr.j)(i.eye,t);if(o&&a>r/4){const e=n-Math.sqrt(s);return(0,hr.h)(t,i.viewForward,e),(0,hr.g)(t,t,i.eye),!0}}else{const e=this.surface?.ready?this.surface.extent:null;null!=e&&(0,Ia.d)(e,this.surface?.spatialReference,Cb,this.renderCoordsHelper.spatialReference)&&(t[0]=(0,yt.uZ)(t[0],Cb[0],Cb[2]),t[1]=(0,yt.uZ)(t[1],Cb[1],Cb[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==e)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Ig.h.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=(0,hr.j)(i,e),n=(0,hr.j)(i,t);if(Math.abs(n-r)/r>wb)return!0}return!1}};(0,i._)([(0,y.Cb)({constructOnly:!0})],bb.prototype,"scheduler",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],bb.prototype,"task",void 0),(0,i._)([(0,y.Cb)()],bb.prototype,"distance",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],bb.prototype,"estimateSurfaceAltitudeAtCenter",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],bb.prototype,"location",null),(0,i._)([(0,y.Cb)({readOnly:!0})],bb.prototype,"renderLocation",void 0),(0,i._)([(0,y.Cb)()],bb.prototype,"updating",void 0),bb=(0,i._)([(0,v.j)("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],bb);const wb=.05,xb=(0,Pa.Ue)(),Tb=(0,Pa.Ue)(),Cb=(0,Ds.Ue)();class Sb{constructor(e){this._handles=new Me.Z,this.events=new L.Z,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",(e=>this._layerViewsChanged(e)))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=(0,m.SC)(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach((e=>{"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&this._handles.add(e.on("visible-geometry-changed",(()=>this._contentChanged())),e.uid)})),e.removed.forEach((e=>this._handles.remove(e.uid)))}_contentChanged(){this.events.emit("request-update",Eb)}}const Eb={},Mb=Array;let Ab=class extends pb{constructor(e){super(e),this._propertiesPool=new sm.L({location:wi.Z,renderLocation:Mb},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([(0,F.watch)((()=>this.centerOnSurface.renderLocation),(()=>this.updateRenderLocation())),(0,F.watch)((()=>this.state.contentCamera),(()=>this.updateRenderLocation()))]),this.scheduler&&this.addHandles(this.scheduler.registerTask(Ii.T8.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=(0,m.SC)(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:t}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/t)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,Rb);const n=Math.max(0,(Math.acos((0,hr.f)(Rb,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!(0,hr.I)(e,t)){const e=this._propertiesPool.get("renderLocation");(0,hr.c)(e,t),this._set("renderLocation",e)}return zl.J}const s=1-(0,yt.uZ)(n/(.5*Math.PI),0,1),o=s*s*s;this._calculateScreenHorizontalEdgeOnSurface(Pb);const a=this._propertiesPool.get("renderLocation");return(0,hr.m)(a,t,Pb,o),e&&(0,hr.I)(e,a)||this._set("renderLocation",a),zl.J}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter((0,$e.J$)());if(i[1]=t.aboveGround?t.padding[rm.Np.BOTTOM]:t.fullHeight-t.padding[rm.Np.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,Ob)){(0,hr.d)(Ob,Ob,t.eye);const i=(0,hr.n)(Ob,Ob);if(this.renderCoordsHelper.intersectInfiniteManifold((0,uh.re)(t.eye,i),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};(0,i._)([(0,y.Cb)()],Ab.prototype,"_dirty",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Ab.prototype,"scheduler",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Ab.prototype,"centerOnSurface",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Ab.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),(0,i._)([(0,y.Cb)()],Ab.prototype,"updating",null),(0,i._)([(0,y.Cb)()],Ab.prototype,"location",null),(0,i._)([(0,y.Cb)()],Ab.prototype,"renderLocation",void 0),(0,i._)([(0,y.Cb)()],Ab.prototype,"worldUnitsPerContentPixel",null),Ab=(0,i._)([(0,v.j)("esri.views.3d.support.pointsOfInterest.Focus")],Ab);const Rb=(0,Pa.Ue)(),Ob=(0,Pa.Ue)(),Pb=(0,Pa.Ue)();let Ib=class extends P.Z{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=(0,Pa.Ue)();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([(0,F.watch)((()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent]),(()=>this._update())),(0,F.on)((()=>this.surface?.layers),"change",(()=>this._update()))]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),null==this.surfaceView?.extent||null==this.surfaceView.spatialReference)return void this._set("location",null);const e=(0,Ds.be)(this.surfaceView.extent),t=new wi.Z({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then((e=>{this._updateController=null,this._set("location",e.geometry)})).catch((e=>{}))):this._set("location",t)}};(0,i._)([(0,y.Cb)({constructOnly:!0})],Ib.prototype,"view",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Ib.prototype,"cache",void 0),(0,i._)([(0,y.Cb)()],Ib.prototype,"surface",null),(0,i._)([(0,y.Cb)()],Ib.prototype,"surfaceView",null),(0,i._)([(0,y.Cb)({readOnly:!0})],Ib.prototype,"location",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Ib.prototype,"renderLocation",null),Ib=(0,i._)([(0,v.j)("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],Ib);let Lb=class extends P.Z{constructor(e){super(e),this._tileGeometryUpdateExtent=(0,Ds.cS)(),this._tileGeometryUpdateSpatialReference=null,this.events=new L.Z,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",(e=>this._tileGeometryChanged(e))),this.scheduler.registerTask(Ii.T8.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating?(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Db),(0,Ds.cS)(this._tileGeometryUpdateExtent),this._set("updating",!1),zl.J):zl.J}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,(0,Ds.jn)(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.contentCamera.eye,r=Ub,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,Nb,t),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,Fb,t),Nb[0]<Fb[0]?(r[0]=Nb[0],r[2]=Fb[0]):(r[0]=Fb[0],r[2]=Nb[0]),Nb[1]<Fb[1]?(r[1]=Nb[1],r[3]=Fb[1]):(r[1]=Fb[1],r[3]=Nb[1]),(0,Ds.kK)(r,e)}};(0,i._)([(0,y.Cb)({constructOnly:!0})],Lb.prototype,"state",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Lb.prototype,"centerOnSurfaces",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Lb.prototype,"renderCoordsHelper",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Lb.prototype,"scheduler",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],Lb.prototype,"surface",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],Lb.prototype,"updating",void 0),Lb=(0,i._)([(0,v.j)("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],Lb);const Db={},Nb=(0,Pa.Ue)(),Fb=(0,Pa.Ue)(),Ub=(0,Ds.cS)();let kb=class extends P.Z{constructor(e){super(e),this.renderPointOfView=(0,Pa.Ue)(),this._pois=new Array,this._debugCenters=null,this._tmpRay=(0,uh.Ue)(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new sm.L({renderPointOfView:zb},this)}initialize(){const{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=(0,vd.Z8)(e.viewingMode),this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Zg.eC.MIN,this._contentIntersector=(0,vd.Z8)(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),s=this.view.resourceController.scheduler,o=this.view.basemapTerrain?.elevationQueryCache,a={state:e,scheduler:s,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new bb({...a,task:Ii.T8.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new bb({...a,task:Ii.T8.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new bb({...a,task:Ii.T8.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new mb({...a,cache:o,task:Ii.T8.POINT_OF_INTEREST_INFREQUENT,map:r})),this._set("surfaceGeometryUpdates",new Lb({...a,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Sb({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new Ib({cache:o,view:this.view})),this._set("focus",new Ab({state:e,scheduler:s,surface:t,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(e,t)=>this._estimateSurfaceIntersectionAtRenderPoint(e,this.view.state.contentCamera,t)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus),this.addHandles([(0,F.watch)((()=>e.contentCamera),(e=>this._cameraChanged(e)),F.sync),(0,F.watch)((()=>t.extent),(()=>this._updateCenterPointsOfInterest())),(0,F.watch)((()=>this.view.map?.ground?.navigationConstraint?.type),(e=>{this._surfaceIntersector.options.backfacesTerrain="none"===e}),F.initial),(0,F.when)((()=>!t.updating),(()=>this._updateCenterPointsOfInterest()),F.sync),(0,F.on)((()=>this.surfaceGeometryUpdates.events),"request-update",(()=>this._updateCenterPointsOfInterest())),(0,F.on)((()=>this.contentGeometryUpdates.events),"request-update",(()=>this._updateCenterOnContent())),(0,F.watch)((()=>Ig.h.SHOW_POI),(e=>this._setDebug(e)),F.initial)]),this._cameraChanged(this.view.state.contentCamera);for(const e of this._pois)e.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some((e=>e.updating)))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return null==e||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Bb,Hb)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Bb):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(null==e)return this._surfaceAltitudeAtCenter;const t=e.origin,i=(0,hr.g)(Bb,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(Bb)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Bb)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=(0,Nd.eW)(t,e,Vb);if(null==r)return null;const n=r.origin,s=(0,hr.g)(Bb,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,s),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;(0,hr.p)(this.renderPointOfView,t)||this._set("renderPointOfView",(0,hr.c)(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters?.forEach((e=>e.hide())),void this.removeHandles("debug");if(!this._debugCenters){this._debugCenters=new Map;const e=this.view.graphics;this._debugCenters.set(this.centerOnContent,new db(e,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new db(e,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new db(e,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new db(e,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new db(e,"green","Focus"))}for(const e of this._pois)this.addHandles((0,F.watch)((()=>e.renderLocation),(t=>this._debugCenters?.get(e)?.show(t,e.renderCoordsHelper.spatialReference)),F.initial),"debug")}get test(){}};(0,i._)([(0,y.Cb)()],kb.prototype,"centerOnContent",void 0),(0,i._)([(0,y.Cb)()],kb.prototype,"centerOnSurfaceFrequent",void 0),(0,i._)([(0,y.Cb)()],kb.prototype,"centerOnSurfaceInfrequent",void 0),(0,i._)([(0,y.Cb)()],kb.prototype,"cameraOnSurface",void 0),(0,i._)([(0,y.Cb)()],kb.prototype,"focus",void 0),(0,i._)([(0,y.Cb)()],kb.prototype,"renderPointOfView",void 0),(0,i._)([(0,y.Cb)()],kb.prototype,"surfaceOrigin",void 0),(0,i._)([(0,y.Cb)()],kb.prototype,"contentGeometryUpdates",void 0),(0,i._)([(0,y.Cb)()],kb.prototype,"surfaceGeometryUpdates",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],kb.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],kb.prototype,"updating",null),kb=(0,i._)([(0,v.j)("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],kb);const zb=Array,Bb=(0,Pa.Ue)(),Vb=(0,uh.Ue)(),Hb={exclude:new Set([zd.xX])};var Gb=n(40366);class jb{constructor(e,t){this._cache=e(t,((e,t,i)=>{switch(t){case Gb.lN.ALL:return e.forEach((e=>e.dispose())),0;case Gb.lN.SOME:{const t=e.shift();return t?(i-=Math.round(t.cachedMemory),t.dispose()):i>0&&(f.Z.getLogger("esri/core/MemCachePool").warn("Encountered empty MemCachePool with non-zero memory."),i=0),i}}}))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const t=this._cache.peek(e);if(!t)return;const i=t.pop();return t.length>0?i&&(t.cachedMemory=this._cache.getSize(e)-Math.round(i.cachedMemory),this._cache.updateSize(e,t)):this._cache.pop(e),i}put(e,t,i=Gb.Jv){const r=this._cache.peek(e);if(r)r.push(t),r.cachedMemory=this._cache.getSize(e)+Math.round(t.cachedMemory),this._cache.updateSize(e,r);else{const r=new Zb(t);this._cache.put(e,r,i)}}}class Zb extends Array{constructor(e){super(),this.item=e,this.cachedMemory=e.cachedMemory,this.push(e)}}var qb=n(34596);class Wb{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,t){this._store.put(e,t)}}var $b=n(92324),Yb=n(57686);class Jb{constructor(e=0,t=0){this.min=e,this.max=t,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}}var Xb=n(73742);class Kb{constructor(e,t,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=t,this.samplerData=new Xb.K(i,t)}computeMinMaxValue(e,t,i,r){r.min=1/0,r.max=-1/0,r.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return r;const s=2**n;if(Math.floor(t/s)!==this.i||Math.floor(i/s)!==this.j)return r;let o=1/0,a=-1/0;const l=this.samplerData.data.width,c=this.samplerData.data.values,u=.5*Ba.zl;let h=(l-1)/s,d=(i-this.j*s)*h,p=(t-this.i*s)*h;if(h<1){const e=Math.floor(d),t=Math.floor(p),i=e+t*l,n=c[i],s=c[i+1],o=c[i+l],a=c[i+l+1];if(n+s+o+a<u){const i=d-e,l=p-t,c=(0,rl.bX)(n,s,o,a,i,l),u=(0,rl.bX)(n,s,o,a,i+h,l),f=(0,rl.bX)(n,s,o,a,i,l+h),m=(0,rl.bX)(n,s,o,a,i+h,l+h);return r.min=Math.min(c,u,f,m),r.max=Math.max(c,u,f,m),r}d=e,p=t,h=1}else d=Math.floor(d),p=Math.floor(p),h=Math.ceil(h);for(let e=d;e<=d+h;e++)for(let t=p;t<=p+h;t++){const i=c[e+t*l];i<u?(o=Math.min(o,i),a=Math.max(a,i)):r.hasNoDataValues=!0}return r.min=o,r.max=a,r}}const Qb=.5*Ba.zl;function ew(e,t,i){if(null==i)return null;for(const r of i){if(!r)continue;const i=r.safeWidth;let n=(0,yt.uZ)(r.dy*(r.y1-t),0,i),s=(0,yt.uZ)(r.dx*(e-r.x0),0,i);const o=Math.floor(n),a=Math.floor(s),l=r.data.width,c=o*l+a,u=r.data.values,h=u[c],d=u[c+1],p=c+l,f=u[p],m=u[p+1];if(h+f+d+m<Qb){n-=o,s-=a;const e=h+(d-h)*s;return e+(f+(m-f)*s-e)*n}}return null}var tw=n(13809);let iw=class extends P.Z{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",(()=>this.notifyChange("stencilEnabledExtents")))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach((t=>{const i=t.layer;if("operationalLayerType"in i&&(0,z.$4)(i.operationalLayerType)&&null!=this.viewSpatialReference){const t=sw(i.fullExtent,this.viewSpatialReference);null!=t&&e.push((0,Ds.oJ)(t))}})),e}};(0,i._)([(0,y.Cb)({readOnly:!0})],iw.prototype,"layerViewsExtent",null),(0,i._)([(0,y.Cb)({readOnly:!0})],iw.prototype,"tiledLayersExtent",null),(0,i._)([(0,y.Cb)({readOnly:!0})],iw.prototype,"stencilEnabledExtents",null),(0,i._)([(0,y.Cb)()],iw.prototype,"viewSpatialReference",void 0),(0,i._)([(0,y.Cb)()],iw.prototype,"tilingScheme",void 0),(0,i._)([(0,y.Cb)()],iw.prototype,"defaultTiledLayersExtent",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],iw.prototype,"layers",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],iw.prototype,"layerViews",void 0),iw=(0,i._)([(0,v.j)("esri.views.3d.terrain.ExtentHelper")],iw);let rw=class extends iw{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?Ba.uU:Ba.JR}};rw=(0,i._)([(0,v.j)("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],rw);let nw=class extends iw{_computeLayerViewsExtent(){const e=(0,Ds.cS)(),t=this.viewSpatialReference;this.layerViews.forEach((i=>{const r=i.layer;if(i.isResolved()&&("graphics"!==r.type||!r.internal)){const r=sw("fullExtentInLocalViewSpatialReference"in i&&i.fullExtentInLocalViewSpatialReference||i.layer.fullExtent,t);(0,Ds.jn)(e,r,e)}}));const i=(0,Ds.sU)(e)?e:null,r=this._get("layerViewsExtent");return(0,Ds.fS)(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=(0,Ds.cS)();this.layers.forEach((r=>{if(r.loaded&&(0,z.iC)(r)){const n=(0,tw.E_)(r,t,$t.JY.Local);if(null==n)return;const{tileInfo:s,fullExtent:o}=n,a="tilemapCache"in r?r.tilemapCache?.effectiveMaxLOD:void 0;null!=s&&null!=o&&((0,tw.x4)(r)||e.compatibleWith(s,a)&&o.spatialReference.equals(e.spatialReference))&&(0,Ds.jn)(i,o,i)}})),(0,Ds.jn)(i,this.defaultTiledLayersExtent,i);const r=(0,Ds.sU)(i)?i:null,n=this._get("tiledLayersExtent");return(0,Ds.fS)(r,n)?n:r}};function sw(e,t){return null==e||e.spatialReference.equals(t)?e:(0,te.projectWithoutEngine)(e,e.spatialReference,t)}nw=(0,i._)([(0,v.j)("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],nw);var ow=n(9812),aw=n(26646),lw=n(58781),cw=n(65075),uw=n(42142);function hw(){const e=globalThis.require?.modules;if(e){const t=Object.keys(e);for(const i of t)i.includes(".glsl")&&delete e[i]}}class dw{constructor(e,t){this.screen=e,this.olid=t}}const pw=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let fw,mw=class extends P.Z{constructor(e){super(e),this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._latestOriginId=0,this._maxResolution=(0,w.Z)("esri-mobile")?2048:4096}initialize(){const e=this.view;this.renderer=new aw.CB({parent:this}),e._stage.renderer.plugins.add(this.renderer);const t=()=>this.requestRender();this._groundIntersector=(0,vd.Z8)(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([(0,F.watch)((()=>this.renderer.hasHighlights),t),this.renderer.events.on("has-water",(()=>e._stage?.renderer.updateHasFlags())),this.renderer.events.on("content-changed",t),(0,F.watch)((()=>e.state.camera.pixelRatio),t),(0,F.watch)((()=>e.state.alignPixelEnabled),t),this.renderer.events.on("textures-disposed",(()=>this.surface.requestRender())),(0,F.watch)((()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location]),(()=>this.setPlacementDirty())),(0,F.watch)((()=>[e.state?.pixelRatio,e.state?.contentPixelRatio]),(()=>this.setPlacementDirty()),F.sync),this.surface.on("elevation-change",(()=>this.setPlacementDirty())),e.on("resize",(()=>this.setPlacementDirty())),e.resourceController.scheduler.registerTask(Ii.T8.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",(e=>{this._updateOverlays(Ii.G5,e.camera,tc.Xx.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(tc.Xx.BACKGROUND,e)}))]),e._stage.renderer.overlay=this}destroy(){this.view?._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.overlay=null),fw&&(fw.hide(),fw=null),this.renderer=(0,m.SC)(this.renderer)}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.renderer.longitudeCyclical=null;const t=this.view.renderSpatialReference;null!=e&&null!=t?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this.renderer.longitudeCyclical=e.isWebMercator?new Cd.pE(-20037508.342787,20037508.342787):new Cd.pE(-180,180))):this.renderer.disposeOverlays()}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Ig.h.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get worldToPCSRatio(){return null!=this._spatialReference&&this._spatialReference.isGeographic&&!this.view.state.isLocal?(0,_l.Iu)(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return 1.3/this.view.resolutionScale}get _longitudeCyclical(){return this.renderer.longitudeCyclical}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}render(){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._precompileShaders()?this._drawOverlays(tc.Xx.UPDATE):null}get hasOverlays(){return this.renderer.hasOverlays}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,cw.S)}_updateDrapeSourceExtent(e){2===this.renderer.overlays.length&&null!=e.setDrapingExtent&&null!=this._spatialReference&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.requestRender()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,tc.Xx.UPDATE)}_updateOverlays(e,t,i){if(!this._spatialReference)return zl.J;const r=this._computeOverlayResolution(t);this._computeOverlayExtents(t,r,_w),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,_w.stretch);const n=this._updateOverlay(ow.fu.INNER,_w.inner,r,1*_w.pixelRatioAdjustment,_w.mapUnitsPerPixel),s=(0,Ds.d_)(_w.inner)/(0,Ds.d_)(_w.outer),o=this._updateOverlay(ow.fu.OUTER,_w.outer,r,s*_w.pixelRatioAdjustment,_w.mapUnitsPerPixel);n!==xw.EXTENT&&o!==xw.EXTENT||(this._drapeSources.forEach((e=>this._updateDrapeSourceExtent(e))),this.updateOverlayParameters(i)),n===xw.NONE&&o===xw.NONE||this.requestRender(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const t=this.view.state.contentPixelRatio*this.view.resolutionScale,i=e.fullWidth/e.pixelRatio*t,r=e.fullHeight/e.pixelRatio*t,n=Math.ceil(1.5*Math.max(i,r));return Math.min((0,uw.nq)(n),this._maxResolution)}_updateOverlay(e,t,i,r,n){if(0===this.renderer.overlays.length)return xw.NONE;const s=this.renderer.overlays[e],o=s.mapUnitsPerPixel;if(s.mapUnitsPerPixel=n,s.pixelRatio=r,function(e,t){const i=1e-5,r=Ig.h.TESTS_DISABLE_OPTIMIZATIONS?0:i*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}(t,s.extent)&&i===s.resolution)return o===n?xw.NONE:xw.RERENDER_ONLY;(0,Ds.JG)(s.extent,t),s.resolution=i;const a=(0,Ds.be)(s.extent);return s.renderLocalOrigin=(0,lw.a)(a[0],a[1],0,"OV_"+this._latestOriginId++),xw.EXTENT}updateOverlayParameters(e){this.surface.allTiles.forAll((e=>this.updateTileOverlayParameters(e))),this.surface.requestRender(e)}updateTileOverlayParameters(e){if(!e.renderData)return;const t=e.renderData.overlay;if(0===this.renderer.overlays.length)this._clearTileOverlayData(ow.fu.INNER,t),this._clearTileOverlayData(ow.fu.OUTER,t);else{const[i,r]=this.renderer.overlays,n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,r.extent)?(this._setTileOverlayData(n,ow.fu.INNER,t),this._setTileOverlayData(n,ow.fu.OUTER,t)):(this._clearTileOverlayData(ow.fu.INNER,t),this._clearTileOverlayData(ow.fu.OUTER,t))}}overlayPixelSizeInMapUnits(e,t){if(0===this.renderer.overlays.length)return t();const i=this.renderer.overlays[ow.fu.INNER],r=this.renderer.overlays[ow.fu.OUTER],n=this._pointIsInExtent(e,i.extent)?i:r;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,t,i){if(0===this.renderer.overlays.length)return;const r=this.renderer.overlays[t].extent,n=(0,Ds.d_)(r),s=(0,Ds.Cb)(r);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);const t=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>t&&(o=t-(e[2]-e[0]))}i.setScale(t,(0,Ds.d_)(e)/n,(0,Ds.Cb)(e)/s),i.setOffset(t,(o-r[0])/n,(e[1]-r[1])/s)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}reloadShaders(){hw(),this.requestRender(),this.runTask(Ii.G5)}requestRender(e=tc.Xx.UPDATE){this.renderer.hasOverlays?(e===tc.Xx.UPDATE?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this._drawTexturesAnimateDirty=!0,this.view._stage.renderView.requestRender(e)):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r,n){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,ww,t,i);if(null==s)return!1;const o=s.origin,a=(0,hr.g)(yw,s.origin,s.direction);this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a);const l=this._groundIntersector.results.min;return l.getIntersectionPoint(n)&&l.withinDistance(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),s=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=(0,yt.uZ)(s.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+o,e.aboveGround?n-o:1/0),l=e.aboveGround;if("global"===this.view.viewingMode){const t=yw;(0,hh.k)((0,hh.b)(hh.t,(0,_l.Iu)(this.view.spatialReference).radius+a),(0,uh.re)(e.eye,e.viewForward),t),(0,hr.d)(t,t,e.eye);const n=Cd.Q4.normalize((0,Md.cp)(e.viewForward,t,e.viewRight))/e.fovY+.5,s=n<=0||n>=1?.5:r;i=l?s*n:n+s*(1-n)}else{const t=.5*Math.PI-Math.acos(-e.viewForward[2]),n=Math.tan(t),s=(0,rf.al)(0,n,1,0),o=(0,tf.t)(s,s,e.projectionMatrix)[1],a=(0,yt.uZ)(.5+.5*o,0,1);i=1===a||0===a?.5:l?a*r:1-(1-a)*r}return this._intersectGroundFromView(e,.5,i,s.distance,t)}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=(0,Pa.Ue)();this._findHorizonBasedPointOfInterest(e,n)||(0,hr.c)(n,r),Ig.h.OVERLAY_SHOW_CENTER?(null==fw&&(fw=new db(this.view.graphics,"red")),fw.show(n,this._renderSR)):null!=fw&&fw.hide();const s=Math.max(.1,(0,hr.j)(e.eye,n)),o=(0,Uh.L)(this.view.renderCoordsHelper,r,e.eye);this._overlaySREqualsRenderSR||(0,Ef.S)(n,this._renderSR,n,this._spatialReference);const a=this.surface.extent,l=!this._isSpherical&&this._spatialReference?.isGeographic,c=l&&this._spatialReference?1/(0,_l.Iu)(this._spatialReference).metersPerDegree:1,u=this.view.state.contentPixelRatio,h=e.perScreenPixelRatio/u*s*c;i.mapUnitsPerPixel=h/this.worldToPCSRatio,i.stretch=this._overlayStretch;let d=t*h/2*i.stretch,p=!1,f=l?90:1/0;this._isSpherical&&a&&this._spatialReference&&(this._spatialReference.isWebMercator?(d/=Math.cos((0,vo.mZ)(n[1])),f=a[3]):(p=!0,d/=(0,_l.Iu)(this._spatialReference).metersPerDegree,f=90),d>=f&&(d=f,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let m=1;p&&(m=1/Math.max(.2,Math.cos(Math.abs((0,yt.Vl)(n[1])))),d*m>180&&(m=180/d),i.mapUnitsPerPixel*=m);const g=Math.log(2)/12;d=Math.exp(Math.round(Math.log(d)/g)*g);const y=d*m,_=.5*t/(32*y),v=.5*t/(32*d);n[0]=Math.round(n[0]*_)/_,n[1]=Math.round(n[1]*v)/v;const b=i.inner;b[0]=n[0]-y,b[1]=n[1]-d,b[2]=n[0]+y,b[3]=n[1]+d,this._isSpherical&&this._shiftExtentToFitBounds(b,1/0,f);const w=i.outer;if(6*y>(0,Ds.d_)(a))(0,Ds.JG)(w,a);else if(Math.PI/2-Math.abs(o-Math.PI/2)<=.25*Math.PI)w[0]=b[0]-y,w[1]=b[1]-d,w[2]=b[2]+y,w[3]=b[3]+d;else{(0,Ef.S)(e.eye,this._renderSR,yw,this._spatialReference),(0,ci.$X)(gw,n,yw);let t=-Math.atan2(gw[1],gw[0])+.125*Math.PI;t<0&&(t+=2*Math.PI);const i=Math.floor(t/(.25*Math.PI));(0,tf.b)(gw,pw[i],2*d),gw[0]*=m,gw[2]*=m,(0,tf.g)(w,b,gw)}if(this._isSpherical)w[0]=this._longitudeCyclical.clamp(w[0]),w[2]=this._longitudeCyclical.clamp(w[2]),w[1]=Math.max(w[1],-f),w[3]=Math.min(w[3],f);else{const e=(0,Ds.jV)(b,a,vw),t=(0,Ds.jV)(w,a,bw);(0,Ds.r3)(e,t)&&(w[2]=w[0],w[3]=w[1])}const x=Math.abs(b[2]-b[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,x),i.pixelRatioAdjustment=i.mapUnitsPerPixel/x}_precompileShaders(){return!!this.renderer.hasOverlays&&(this.renderer.precompileShaders(this.view.state),!0)}_drawOverlays(e,t=this.view.state){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const i=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const r=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(t),r!==this.renderer.computeValidity()&&this.updateOverlayParameters(tc.Xx.UPDATE),i?(this.surface.requestRender(e),e===tc.Xx.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(tc.Xx.BACKGROUND),this.renderer}_rectanglesOverlap(e,t){return null!=e&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):(0,Ds.kK)(e,t))}_rectInsideRect(e,t){return null!=t&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:(0,Ds.r3)(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,n=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),(0,Ds.cv)(e,r,n)}get test(){}};(0,i._)([(0,y.Cb)()],mw.prototype,"_spatialReference",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],mw.prototype,"running",null),(0,i._)([(0,y.Cb)()],mw.prototype,"_placementDirty",void 0),(0,i._)([(0,y.Cb)()],mw.prototype,"_contentUpdated",void 0),(0,i._)([(0,y.Cb)()],mw.prototype,"_isSpherical",null),(0,i._)([(0,y.Cb)()],mw.prototype,"worldToPCSRatio",null),(0,i._)([(0,y.Cb)()],mw.prototype,"renderer",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],mw.prototype,"view",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],mw.prototype,"surface",void 0),(0,i._)([(0,y.Cb)()],mw.prototype,"suspended",null),(0,i._)([(0,y.Cb)()],mw.prototype,"updating",null),(0,i._)([(0,y.Cb)({type:Boolean})],mw.prototype,"rendersOccludedDraped",null),mw=(0,i._)([(0,v.j)("esri.views.3d.terrain.OverlayManager")],mw);const gw=(0,rf.Ue)(),yw=(0,Pa.Ue)(),_w=new class{constructor(){this.inner=(0,Ds.Ue)(),this.outer=(0,Ds.Ue)(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=1.3}},vw=(0,Ds.Ue)(),bw=(0,Ds.Ue)(),ww=(0,uh.Ue)();var xw;!function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"}(xw||(xw={}));var Tw=n(23147),Cw=n(59633);class Sw{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=(0,Mf.cS)(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=(0,m.RY)(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,(0,Mf.cS)(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,t){return this.getEdgeAttributeIndex(e,t)}getEdgeVertexPosition(e,t,i,r){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,r),t),(0,hr.g)(t,t,i)}getEdgeNormal(e,t,i){const{typedBuffer:r,typedBufferStride:n}=this.vertexAttributes.normalCompressed;(0,Cw.rc)(t,r,this.getEdgeAttributeIndex(e,i),n)}setEdgeNormalFromValues(e,t,i,r,n){this._setNormal(this.getEdgeAttributeIndex(e,t),i,r,n)}setEdgeVertexFromValuesRawPositionUV(e,t,i,r,n,s,o){const a=this.getEdgeAttributeIndex(e,t);this.vertexAttributes.position.setValues(a,i,r,n),this._setUV(a,s,o)}setEdgeVertexFromValuesRawPositionUVNormal(e,t,i,r,n,s,o,a,l,c){const u=this.getEdgeAttributeIndex(e,t);this.vertexAttributes.position.setValues(u,i,r,n),this._setUV(u,s,o),this._setNormal(u,a,l,c)}_getEdgeVertexRaw(e,t){this.vertexAttributes.position.getVec(e,t)}_setNormal(e,t,i,r){const{typedBuffer:n,typedBufferStride:s}=this.vertexAttributes.normalCompressed;(0,Cw.hd)(n,e,t,i,r,s)}_setUV(e,t,i){Ew(this.vertexAttributes.uv0,e,t,i)}getEdgeAttributeIndex(e,t){return(0,tw.Fp)(0<=t&&t<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+t}}function Ew(e,t,i,r){e.setValues(t,16384*i,16384*r)}class Mw{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}}class Aw{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=(0,m.SC)(this._current),this._next=(0,m.SC)(this._next),this._waiting=(0,m.SC)(this._waiting),this._delayed=(0,m.SC)(this._delayed)}get current(){if(null==this._current)return null;if(!this._isFadingEnabled){const e=this._delayed||this._waiting||this._next||this._current;e!==this._current&&(this._current=null,this.clear(),this._current=e)}let e=Aw.test.fadeMoment;if(null!=this._delayed&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Rw.Immediate),this._delayed=null)),null!=this._next){e=e||performance.now();const t=this._fadeDuration,i=null!=this._current&&this._next.texture===this._current.texture,r=this._next.type!==ow.Ns.FADING,n=e-this._fadeStart>=t;(i||r||n)&&((0,m.SC)(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(null==this._next)return 1;const e=Aw.test.fadeMoment||performance.now(),t=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return t>i?0:1-t/i}get isFading(){return null!=this._next||null!=this._delayed}push(e,t=Rw.Immediate){this._delayed=(0,m.SC)(this._delayed),this._push(e,t)}_push(e,t){if(this._isFadingEnabled||this.clear(),null==this._current)return void(this._current=e);const i=Aw.test.fadeMoment||performance.now();return t!==Rw.Immediate?(this._delayed=e,void(this._delayedTime=i+t)):null==this._next?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(null!=e&&((0,m.SC)(this._waiting),this._waiting=e))}get _fadeDuration(){const e=this._getFadeDuration();return this._waiting?.5*e:e}_alignFadeStart(e){const t=this._getFadeDuration();return e+t-e%t}get _isFadingEnabled(){return this._getFadeDuration()>0}}var Rw;Aw.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(Rw||(Rw={}));class Ow{constructor(e,t,i,r,n,s){this.texture=e,this.type=t,this.offsetAndScale=i,e.retain(),this.opacities=(0,Pa.al)(r,n,s)}destroy(){this.texture.release()}}class Pw{constructor(){this._scales=(0,rf.al)(-1,-1,-1,-1),this._offsets=(0,rf.al)(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,t,i){this._scales[2*e]=t,this._scales[2*e+1]=i}setOffset(e,t,i){this._offsets[2*e]=t,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}}var Iw=n(30220),Lw=n(35031),Dw=n(79040),Nw=n(8106);class Fw extends Al.A{constructor(e,t){super(e,t,new Ml.J(Nw.a,(()=>n.e(83036).then(n.bind(n,83036)))),Uw),this.type="TerrainTechnique",this.useStencil=!1}initializePipeline(e){return this._stencilPipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}_createPipeline(e,t){const{renderOccluded:i,output:r}=e,n=e.backfaceCullingEnabled&&!i;return(0,Ol.sm)({blending:i?Ol.xW:null,culling:n?Ol.Rd:null,depthTest:i?null:{func:Rl.wb.LESS},depthWrite:i?null:Ol.ck,colorWrite:Ol.gf,stencilTest:t?(0,Dw.iV)(tc.hU.IntegratedMeshMaskExcluded):null,drawBuffers:r===Lw.H_.Depth?{buffers:[Rl.Xg.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}}const Uw=new Map([[Wl.T.POSITION,0],[Wl.T.UV0,1],[Wl.T.NORMALCOMPRESSED,2]]);class kw{constructor(){this.geometry=new Sw,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureOpacity=1,this._textureRef=new Aw((()=>this._tile.surface.fadeDuration)),this.overlay=new Pw,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,t){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new Mw,this._localOrigin=t,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),tw.T9&&this.tile.intersectsClippingArea)for(let e=0;e<4;++e)(0,tw.Fp)(this.geometry.getEdgeCount(e)===this.geometryState.edgeResolutions[e]+1)}_calculateEdgeResolution(e,t){const i=this.tile,r=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const t=i.surface.extent;if(null!=t&&(0===e&&i.extent[3]>t[3]||1===e&&i.extent[2]>t[2]||2===e&&i.extent[1]<t[1]||3===e&&i.extent[0]<t[0]))return r}const n=i.level,s=tw.OC[e];if(!t)return(0,tw.Fp)(null==i.surface?.rootTiles||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(s)),r;if(t.loaded){const i=t,s=i.renderData.geometryState,o=n-i.level;if((0,tw.Fp)(o>=0),0===o){const e=s.numVerticesPerSide-1;return Math.max(e,r)}const a=2**o,l=s.edgeResolutions[(e+2)%4]/a;return Math.max(1,l)}(0,tw.Fp)(!t.leaf);let o=r;return t.forAllSubtreeOnSide((0,tw._F)(s),(e=>e===i||(e.loaded?(o=Math.max(o,2**(e.level-n)),!0):((0,tw.Fp)(!e.leaf),!1)))),o}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const t=e.renderData.geometryState,i=t=>(t.loaded||t.level===e.level)&&t?.intersectsClippingArea,r=t.edgePeerNeighbors,n=t.edgePeerNeighborSamplerVersions;for(let s=0;s<4;++s){const o=e.findNeighborTile(tw.OC[s],i),a=Ww(e,o),l=a?.renderData?.geometryState.samplerDataVersion??-1,c=r[s],u=a!==Ww(e,c),h=n[s]!==l;tw.T9&&o&&((0,tw.Fp)(e.level>=o.level),(0,tw.Fp)(e.level-o.level<=Ba.qC)),r[s]=o,(u||h)&&(n[s]=l,this._markEdgeDirty(s));const d=t.edgeResolutions[s],p=this._calculateEdgeResolution(s,o);(0,tw.Fp)((0,yt.wt)(p)),(0,tw.Fp)(p>=1),t.edgeResolutions[s]=p,d!==p&&this._markEdgeResolutionDirty(s)}for(let n=0;n<4;++n){const s=e.findNeighborTile(tw.cA[n],i);t.cornerPeerNeighbors[n]=s;const o=Ww(e,r[n]),a=Ww(e,r[(n+1)%4]),l=Ww(e,s);qw[n]=l,qw[(n+1)%4]=a,qw[(n+2)%4]=e,qw[(n+3)%4]=o,(0,tw.Fp)(qw.some((t=>t?.loaded||t===e)));const c=qw.reduce(((e,t)=>Math.min(e,t?.level??1/0)),1/0);qw.forEach(((e,t)=>{e&&e?.level>c&&(qw[t]=null)})),(0,tw.Fp)(qw.some((t=>t?.loaded||t===e)));const u=t.cornerNeighborCornerTiles,h=t.cornerNeighborCornerTileSamplerVersions;for(let e=0;e<4;++e){const t=qw[e],i=t?.renderData.geometryState.samplerDataVersion??-1,r=4*n+e,s=u[r]!==t,o=!s&&h[r]!==i;(s||o)&&(u[r]=t,h[r]=i,this._markCornerDirty(n))}tw.T9&&(0,tw.Fp)(tx.some((t=>u[4*n+t]?.loaded||u[4*n+t]===e)))}tw.T9&&(0,tw.Fp)(this.geometryState.edgeResolutions.every((e=>e>0)));for(let e=0;e<4;++e)qw[e]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;tw.T9&&(0,tw.Fp)(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every((e=>e>0))),this.intersectionData=null;const{tile:t,_vao:i,geometry:r,geometryState:n}=this,s=!i||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,o=0!==this.dirtyEdgeResolutions,a=n.edgeResolutions.reduce(((e,t)=>e+t+1),0),l=s||o&&a>(r?.maxEdgeVertexCount??0),c=!l&&o,u=!c&&(0!==this.dirtyEdges||o),h=!u&&0!==this.dirtyCorners;l?(this.releaseGeometry(),this._createGeometry(e)):c?t.updateEdgeElevationsAndResolutions():u||h?t.updateEdgeElevations():h?t.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=(0,m.M2)(this._vao),this.geometry.release(),!0)}ensureTexture(e,t,i,r){const n=t?Rl.VI.RGBA:Rl.VI.RGB;return null!=this._texture&&(i===ow.Ns.FADING&&this._tile.surface.fadeDuration>0&&this._isTextureVisible(this._texture)||this._texture.descriptor.width!==e||this._texture.descriptor.pixelFormat!==n)&&this.releaseTexture(),null==this._texture&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){null!=this._texture&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}reuseTexture(e,t){return!(!e||!this._texture||(e.setTextureReference(new Ow(this._texture,ow.Ns.FADING,t,this._textureOpacity,0,1)),0))}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&$w)}get samplerDataChanged(){return!!(this._modifiedFlags&Yw)}get clippingAreaChanged(){return!!(this._modifiedFlags&Jw)}get wireframeChanged(){return!!(this._modifiedFlags&Xw)}get dirtyEdges(){return this._modifiedFlags>>Kw&15}get dirtyCorners(){return this._modifiedFlags>>Qw&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>ex&15}_markCornerDirty(e){const t=1<<e<<Qw;this._modifiedFlags|=t}_markEdgeDirty(e){const t=1<<e<<Kw;this._modifiedFlags|=t,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const t=1<<e<<ex;this._modifiedFlags|=t,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<Qw|15<<Kw|15<<ex}updateGeometryState(){const e=this._elevationInfo,t=this.tile,i=e.samplerData?t.getElevationVerticesPerSide(e.maxTileLevel):t.minimumVerticesPerSide,r=Math.max(i,5);let n=t.clippingArea;t.intersectsClippingArea&&!t.withinClippingArea||(n=null);const s=this.geometryState;let o=!1;s.numVerticesPerSide!==r&&(this._modifiedFlags|=1,s.numVerticesPerSide=r,s.samplerDataVersion++,o=!0),e.changed&&(this._modifiedFlags|=2,s.samplerData=e.samplerData,s.samplerDataVersion++,o=!0),(0,Xe.fS)(s.clippingArea,n)||(this._modifiedFlags=4,s.clippingArea=n,o=!0);const a=t.surface.wireframe;return s.wireframe!==a&&(this._modifiedFlags=8,s.wireframe=a,o=!0),this._geometryStateChangedSinceLastUpdate||=o,o&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const t=this.geometry.vertexAttributes,i=this.geometry.indices,r=e.gl;this._vao=new ic.U(e,Uw,new Map([["geometry",(0,Kl.K)(t.layout)]]),new Map([["geometry",rc.f.createVertex(e,r.STATIC_DRAW,t.buffer)]]),rc.f.createIndex(e,r.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,t=Rw.Immediate){e?.texture===this._texture?this._textureOpacity=e.opacities[0]:this.releaseTexture(),this._textureRef.push(e,t)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_isTextureVisible(e){return this._textureRef.current?.texture===e||this._textureRef.next?.texture===e&&this._textureRef.fadeFactor<1}get _elevationInfo(){const e=this.geometryState.samplerData,t=this.tile.layerInfo[yv.ELEVATION],i=t.length,r=new Array(i);let n=0,s=0,o=!1;for(let a=0;a<i;a++){const i=t[a],l=i.upsampleInfo?.tile;if(l){const t=l.layerInfo[yv.ELEVATION][a].data,i=t&&t.samplerData;e&&e[n]===i||(o=!0),r[n++]=i,s=Math.max(s,l.lij[0])}else if(i.data){const t=this.tile.surface.layerViewByIndex(a,yv.ELEVATION);if((0,Iw.W4)(this.tile,t)){const t=i.data;e&&e[n]===t.samplerData||(o=!0),r[n++]=t.samplerData,s=this.tile.level}}}null!=e&&e.length!==n&&(o=!0);const a=n>0,l=a?r:null;return a&&(r.length=n),{changed:o,samplerData:l,maxTileLevel:s}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!tw.T9)return;const e=this.tile;if(!e.loaded||!e.intersectsClippingArea||0===e.level)return void(0,tw.Fp)(e?.loaded);const t=e.surface.extent;if(null!=t&&!e.intersectsExtent(t))return;const i=tw.OC.map(((i,r)=>null!=t&&(r<2?-1:1)*(e.extent[3-r]-t[3-r])<0)),r=e.level;(0,tw.Fp)(0===this.dirtyCorners),(0,tw.Fp)(0===this.dirtyEdges),(0,tw.Fp)(0===this.dirtyEdgeResolutions),(0,tw.Fp)(!this.numVerticesPerSideChanged),(0,tw.Fp)(!this.samplerDataChanged),(0,tw.Fp)(!this.clippingAreaChanged),(0,tw.Fp)(!this.wireframeChanged);const n=tw.cA.map((t=>e.findNeighborCornerTileExact(t,(t=>!t.intersectsClippingArea||t.loaded||t.level===e.level))??null)).map((e=>e?.intersectsClippingArea?e:null)),s=this.geometryState;for(let t=0;t<4;++t){const i=s.cornerPeerNeighbors[t],r=n[t];(0,tw.Fp)(r===i,`Tile[${e.lij}].corner[${t}] out of date: cur=[${i?.lij}] exp=[${r?.lij}]`)}tw.OC.forEach(((t,n)=>{if(i[n])return;const s=e.findNeighborTile(t,(e=>(e.level===r||e?.loaded)&&e?.intersectsClippingArea));if(!s){const i=!e.surface.updatingRootTiles&&null!=e.surface.rootTiles&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(t);return void(0,tw.Fp)(!i)}(0,tw.Fp)(s.loaded||s.level===e.level),(0,tw.Fp)(s===this.geometryState.edgePeerNeighbors[n]);const o=r-s.level;if(!s.loaded)return(0,tw.Fp)(!s.leaf),void(0,tw.Fp)(0===o);const a=s.renderData;(0,tw.Fp)(e.isEdgeNeighbor(s,t)),(0,tw.Fp)(o>=0);const l=2**o;if(o<0)return void(0,tw.Fp)(!1);const c=e.renderData,u=c.geometry,h=c.localOrigin,d=u.getEdgeCount(n),p=u.numVerticesPerSide-1,f=a.geometry;if(!f)return void(0,tw.Fp)(!1);const m=a.localOrigin,g=this.geometryState.edgePeerNeighbors[n];if(g?.loaded){const e=g.renderData;(0,tw.Fp)(c.geometryState.edgePeerNeighborSamplerVersions[n]===e.geometryState.samplerDataVersion),(0,tw.Fp)(this.geometryState.edgePeerNeighborSamplerVersions[n]===e.geometryState.samplerDataVersion)}const y=(n+2)%4,_=f.getEdgeCount(y),v=d-1,b=_-1;(0,tw.Fp)(v*l===b,`Tile[${e.lij}]:e${n},res=${v} edgeRes mismatch with Neighbor[${s.lij}]:e${y},res=${b} (expected:${v*l})`);const w=e.extent,x=t===Tw.X.NORTH||t===Tw.X.SOUTH,T=_-1,C=T>>o,S=d-1;if(C<1)return void(0,tw.Fp)(1===S);(0,tw.Fp)(C===S),(0,tw.Fp)((0,yt.wt)(C));const E=f.numVerticesPerSide-1;(0,tw.Fp)(o>0||C===Math.max(E,p));const M=e.getNeighborEdgeStartVertexIndex(n,s);(0,tw.Fp)(0<=M&&M<l);const A=M*C;(0,tw.Fp)(0<=A&&A<=T-C);let R=0,O=A;u.getEdgeVertexPosition(n,zw,h,0),u.getEdgeVertexPosition(n,Bw,h,d-1);const P=(0,hr.j)(zw,Bw),I=Math.max(Zw,1e-4*P);for(let i=0;i<=C;++i){u.getEdgeVertexPosition(n,zw,h,R),f.getEdgeVertexPosition(y,Bw,m,O);const r=i/C,o=x?w[0]+r*(w[2]-w[0]):t===Tw.X.WEST?w[0]:w[2],l=x?t===Tw.X.SOUTH?w[1]:w[3]:w[1]+r*(w[3]-w[1]),p=e.surface.extent;if(null==p||(0,Ds.jE)(p,o,l)){const t=(0,hr.G)(zw,Bw),i=(0,hr.H)(zw)-il.sv.radius,r=(0,hr.H)(Bw)-il.sv.radius,g=t<I;if(!g){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${n}[${R}/${d}] and [${s.lij}].edge${y}[${O}/${_}]`),null!=p&&console.warn("  surface extent= ",p," x,y=",o,",",l);const v=(0,Pa.Ue)();(0,hr.d)(v,c.localOrigin,a.localOrigin),(0,hr.H)(v)>0&&console.warn(`   localOrigins: ${c.localOrigin} vs ${a.localOrigin} d=${(0,hr.H)(v)} [${v}]`),(()=>{const t=(0,Pa.d9)(zw),i=(0,Pa.d9)(Bw);e.updateEdgeElevations(),s.updateEdgeElevations(),u.getEdgeVertexPosition(n,zw,h,R),f.getEdgeVertexPosition(y,Bw,m,O);const r=(0,Pa.Ue)();(0,hr.a)(r,zw,t),(0,hr.H)(r)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${t} vs ${zw} d=${(0,hr.H)(r)} [${r}]`),(0,hr.a)(r,Bw,i),(0,hr.H)(r)>0&&console.warn(`  XXX Neighbor[${s.lij}] edge out of date: ${i} vs ${Bw} d=${(0,hr.H)(r)} [${r}]`)})();const b=u.getEdgeCount(n),w=f.getEdgeCount(_);(0,tw.Fp)(g,`Mismatch in tile [${e.lij}].edge[${n}][${R}/${b}] vs neighbor [${s.lij}].edge[${y}][${O}/${w}] ${(0,tw.zT)(zw)} vs ${(0,tw.zT)(Bw)}  dist=${t} h(t|n|d)=${i}|${r}|${r-i}`)}u.getEdgeNormal(n,Vw,R),f.getEdgeNormal(y,Hw,O),(0,hr.n)(Gw,Vw),(0,hr.n)(jw,Hw);const v=(0,hr.f)(Gw,jw),b=1-v<.01||e===s;if(!b){const t=(0,Pa.Ue)();(0,hr.a)(t,Vw,Hw);const i=()=>`Mismatch in tile edge normal ${(0,tw.sP)(e.lij)} (${R}/${d-1}) edge ${n} vs neighbor ${(0,tw.sP)(s.lij)}  (${O}/${_-1}) nedge ${y} :${(0,tw.zT)(Vw)} vs ${(0,tw.zT)(Hw)}  dot = ${v} : ${(0,tw.zT)(t)}`;console.warn("Mismatch in tile edge normal: ",i());{e.updateEdgeElevations(),s.updateEdgeElevations();const t=(0,Pa.Ue)(),i=(0,Pa.Ue)();u.getEdgeNormal(n,t,R),f.getEdgeNormal(y,i,O),(0,hr.I)(Vw,t)||console.warn("Missing update in tile normal: ",(0,tw.zT)(Vw)," => ",(0,tw.zT)(t)),(0,hr.I)(Hw,i)||console.warn("Missing update in neighbor normal: ",(0,tw.zT)(Hw)," => ",(0,tw.zT)(i))}(0,tw.Fp)(b,i())}}R+=1,O+=1}}))}}const zw=(0,Pa.Ue)(),Bw=(0,Pa.Ue)(),Vw=(0,Pa.Ue)(),Hw=(0,Pa.Ue)(),Gw=(0,Pa.Ue)(),jw=(0,Pa.Ue)(),Zw=1,qw=[null,null,null,null];function Ww(e,t){return t?.loaded||t===e?t:null}const $w=1,Yw=2,Jw=4,Xw=8,Kw=4,Qw=8,ex=12,tx=[0,1,2,3];class ix{get updating(){return!!this._tileRequested}init(e,t,i,r){this.tile=e,this._layerIdx=t,this._layerClass=i,this._suspended=r,this._tileLayerInfo=e.getLayerInfo(t,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,t){this._setUpsampleTile(e,t),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,ow.Ns.FADING,t):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return null!=e?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,t=this._layerClass,i=this.tile.surface.layerViewByIndex(e,t),{minLevel:r,maxLevel:n}=i.dataLevelRange,s=this._desiredMinLevelDelta,o=this._progressiveLevelModulo+s,a=this._scaleRangeEnabled?Iw.W4:()=>!0;let l=this.tile;const c=l.level;let u;const h=this._tileLayerInfo.upsampleInfo,d=h?.tile?.level??-1,p=null!=h&&d-c>=s,f=(0,Iw.Ay)(i),m="vector-tile-3d"===i.type?i.schemaHelper:null;for(;l&&a(l,i)&&l.level>=r;){const i=l.level,a=c-i,h=l.layerInfo[t][e];if(h.data&&a>=s){(!p||i>d)&&this._setUpsampleTile(l),h.dataInvalidated&&(u=l);break}const g=m?.getLevelRowColumn(l.lij)??l.lij;if("unavailable"!==f?.getAvailability(g[0],g[1],g[2])&&i<=n&&!h.data&&!h.dataMissing&&((!u||l.level===r||i%Ba.GZ==0||c-u.level<s)&&(u=l),a>=o))break;l=l.parent}if(null!=u&&c-u.level<s)if(h)u=null;else{const i=this._findAncestorWithData();null!=i&&(this._setUpsampleTile(i),u=i.layerInfo[t][e].dataInvalidated?i:null)}return u}_findAncestorWithData(){const e=this.tile.elevationLevel,t=this._desiredMinLevelDelta;let i;for(let r=this.tile;r;r=r.parent)if(r.hasLayerData(this._layerIdx,this._layerClass)){if(e-r.level>=t)return r;i=r}return i}_setUpsampleTile(e,t){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,ow.Ns.FADING,t)}get test(){}}const rx=new Error("Abstract method called on TileAgent"),nx=new class extends ix{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw rx}get _progressiveLevelModulo(){throw rx}dispose(){}};var sx;!function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"}(sx||(sx={}));class ox{constructor(){this.waitingAgents=new Pg.Z,this.pendingUpdates=0}static acquire(e){const t=ax.acquire();return t._init(e),t}release(){this.dispose(),lx.delete(this),ax.release(this)}dispose(){this.loadingAgent=(0,m.M2)(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=(0,tw.ep)(this._data)}static prune(){ax.prune(0)}_init(e){this.waitingAgents.clear(),this._data=(0,tw.ep)(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=(0,m.IM)(this.requestAbort),this.requestPromise=null}_unsetUpsampleInfo(){this.upsampleInfo&&(this.upsampleInfo.tile?.unrefMapData(),this._pool.release(this.upsampleInfo),this.upsampleInfo=null)}setUpsampleInfo(e,t){if(e!==t&&null!=t){if(null==this.upsampleInfo)this.upsampleInfo=this._pool.acquire();else{if(this.upsampleInfo.tile===t)return;this.upsampleInfo.tile?.unrefMapData()}t.refMapData(),(0,Iw.QT)(e,t,this.upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){(0,tw.ep)(this._data),this._data=e}}const ax=new qb.Z(ox,null,(()=>{})),lx=new Map;var cx;!function(e){e[e.NONE=0]="NONE",e[e.SPLIT=1]="SPLIT",e[e.ELEVATION=2]="ELEVATION",e[e.MERGE=4]="MERGE",e[e.GEOMETRY=8]="GEOMETRY",e[e.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=32]="TEXTURE_FADING"}(cx||(cx={}));class ux{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=(0,Ds.Ue)(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=(0,Ds.Ue)(),this.centerAtSeaLevel=(0,Pa.Ue)(),this._center=[(0,Pa.Ue)(),(0,hh.c)(),(0,Pa.Ue)()],this.up=(0,Pa.tN)(),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=0,this._rasterTileMemory=0,this._vectorTileMemory=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=(0,Pa.Ue)(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){px.prune(0),fx.prune(0),ox.prune()}get _cached(){return!this.leaf&&this._mapDataRefCount<=0}get withinClippingArea(){return this._withinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[gx.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent?.frustumVisibility??sx.INTERSECTS;this._frustumVisibility=e===sx.INSIDE?sx.INSIDE:e===sx.OUTSIDE?sx.OUTSIDE:this._calculateFrustumVisibility(this.surface.frustum);const t=this._frustumVisibility!==sx.OUTSIDE&&this._intersectsClippingArea;t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get _loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,t,i,r,n){this._lij[0]=e,this._lij[1]=t,this._lij[2]=i,this.ellipsoid=(0,_l.Iu)(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,t,i,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[gx.MIDDLE][3]=0,this.elevationLevel=e,r&&!Number.isNaN(r.elevationBoundsMin)?(this._elevationBoundsMin=r.elevationBoundsMin,this._elevationBoundsMax=r.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.clearChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const e of _v){const t=n.numLayers(e),i=this.layerInfo[e];for(const e of i)e.release();i.length=t;for(let r=0;r<t;r++)i[r]=ox.acquire(this._surface.upsampleInfoPool),e===yv.ELEVATION&&this.findElevationBoundsForLayer(r,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,Ba.Cf)}dispose(){null!=this._surface&&((0,tw.wu)(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key),this.layerInfo.forEach((e=>{e.forEach((e=>e.release())),e.length=0})),this._surface=this._parent=null,this.clearChildren(),this.setMemoryDirty())}refMapData(){++this._mapDataRefCount,this._cached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount,this._cached&&this.cachedMemory>0&&this._surface.upsampleMapCache.put(this.key,this)}setMemoryDirty(){this._usedMemory=0}get usedMemory(){return this._ensureUsedMemory()+(this._cached?0:this._mapTileMemory)}get cachedMemory(){return this._ensureUsedMemory(),null==this._surface?this.usedMemory:this._cached?this._mapTileMemory:0}get _mapTileMemory(){return this._rasterTileMemory+this._vectorTileMemory}get _cpuImageMemorySize(){const e=this._surface.tilingScheme.pixelSize;return e*e*4}_ensureUsedMemory(){if(this._usedMemory>0)return this._vectorTileMemory=this.layerInfo[yv.MAP].reduce(((e,{data:t})=>e+((0,zv.AK)(t)?t.usedMemoryPerReference:0)),0),this._usedMemory;this._usedMemory=this._baseUsedMemory,this._rasterTileMemory=0,this._vectorTileMemory=0;for(const{data:e}of this.layerInfo[yv.MAP])(0,zv.AK)(e)?this._vectorTileMemory+=e.usedMemoryPerReference:this._rasterTileMemory+=this.getTerrainDataMemory(e);for(const e of this.layerInfo[yv.ELEVATION])this._usedMemory+=e.data?this._cpuImageMemorySize:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._rasterTileMemory+=this.renderData.texture?.cachedMemory??0),this._cached&&this._surface.upsampleMapCache.updateSize(this.key,this),this._usedMemory}getUsedMemoryForLayer(e,t){const i=this.layerInfo[e][t];return i?.data?e===yv.MAP?this._cached?0:this.getTerrainDataMemory(i.data):e===yv.ELEVATION?this._cpuImageMemorySize:0:0}getTerrainDataMemory(e){return(0,zv.Q_)(e)?e.texture.usedMemory:(0,zv.yd)(e)?e.memoryUsage:(0,zv.AK)(e)?e.usedMemoryPerReference:(0,zv.Cm)(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const t=this._center[gx.MIDDLE],i=e,r=t[0],n=t[1],s=t[2],o=i[2]*r+i[6]*n+i[10]*s+i[14];this.screenDepth=o<0?0:o/(i[3]*r+i[7]*n+i[11]*s+i[15])}shouldSplit(e,t,i){if(!this.visible)return cx.NONE;if(e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibility(e.frustum)===sx.OUTSIDE))return cx.NONE;const r=this.level;(0,hr.d)(xx,(0,hh.a)(this._center[gx.MIDDLE]),t);let n=(0,hr.k)(xx),s=xx,o=(0,hh.a)(this._center[gx.MIDDLE]);(0,hr.d)(Tx,this._center[gx.TOP],t);const a=(0,hr.k)(Tx);a<n&&(n=a,s=Tx,o=this._center[gx.TOP]),(0,hr.d)(Cx,this._center[gx.BOTTOM],t);const l=(0,hr.k)(Cx);if(l<n&&(n=l,s=Cx,o=this._center[gx.BOTTOM]),this._edgeLen2>n&&r<e.maxLod)return cx.SPLIT;const c=Math.sqrt(n),u=e.fovX*c*2,h=this._edgeLen/u,d=()=>{if(r<e.maxLod)return this.elevationLevel=r,cx.NONE;const t=r+Math.ceil(-Math.log2(e.relativeWidthLimit/h));return t!==this.elevationLevel?(this.elevationLevel=t,cx.ELEVATION):cx.NONE},p=null!=i?i-r:1/0;if(p<=.5)return d();const f=(0,hr.f)(this.up,xx),m=this._elevationBoundsMax-this._elevationBoundsMin,g=m/this.edgeLen;if(e.aboveGround&&f>0&&g<.001&&f/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-g>0)return cx.NONE;const y=null!=i?3-Math.min(p,2):1;if(h*y<e.relativeWidthLimit||r>=e.maxLod)return d();if(r<7)return cx.SPLIT;(0,hr.h)(Sx,this.up,f),(0,hr.d)(Sx,Sx,s);const _=(0,hr.k)(Sx);if(_<=this.radius*this.radius)return cx.SPLIT;(0,hr.h)(Sx,Sx,this.radius/Math.sqrt(_)),(0,hr.g)(Sx,Sx,o),(0,hr.d)(Sx,t,Sx);const v=Math.min(1,(Math.abs((0,hr.f)(Sx,this.up))+.5*m+this._curvatureHeight)/(0,hr.l)(Sx)),b=.1/e.angledSplitBias,w=e.fovY*c*2;return v*(this._edgeLen/w*y)<b*e.relativeHeightLimit?cx.NONE:cx.SPLIT}createChildren(){const e=this._children,t=this.lij[0]+1,i=2*this.lij[1],r=2*this.lij[2];return e[0]=this.surface.createTile(t,i,r,this),e[1]=this.surface.createTile(t,i,r+1,this),e[2]=this.surface.createTile(t,i+1,r,this),e[3]=this.surface.createTile(t,i+1,r+1,this),e}clearChildren(){this._children[0]=this._children[1]=this._children[2]=this._children[3]=null}get loaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of _v)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(){this.renderData&&this.unrefMapData(),this.surface.renderer.unloadTile(this);for(const e of _v){const t=this.layerInfo[e];for(const e of t)e.loadingAgent&&e.loadingAgent!==nx&&(dx(e.loadingAgent),e.loadingAgent=null),e.pendingUpdates=0}this.resetPendingUpdate(cx.GEOMETRY),this.resetPendingUpdate(cx.TEXTURE_NOFADING),this.resetPendingUpdate(cx.TEXTURE_FADING)}unloadMapData(){const e=this.layerInfo[yv.MAP];for(const t of e)t.loadingAgent&&t.loadingAgent!==nx&&(dx(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0,t.invalidateSourceData();this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if((0,Ds.fS)(e,this._clippingArea))return!1;const t=this._intersectsClippingArea,i=this._withinClippingArea;null!=e?(this._intersectsClippingArea=this.intersectsExtent(e),this._withinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._withinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const r=i&&this._withinClippingArea,n=!(i||t||this._withinClippingArea||this._intersectsClippingArea);return!this.renderData||r||n||this.setPendingUpdate(cx.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,t){return this.layerInfo[t][e]}hasLayerData(e,t){const i=this.layerInfo[t][e];return!(!i?.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of _v){const t=this.layerInfo[e];for(const e of t)if(e.loadingAgent&&e.loadingAgent!==nx&&e.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(cx.SPLIT)||e!==yv.ELEVATION&&!this._loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const t=this._pendingUpdates;return this._pendingUpdates|=e,e===cx.SPLIT||e===cx.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),t!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,t,i){const r=this.layerInfo[t][e];if(r.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),i.tile.lij.toString(),t,e),!0;if(r.waitingAgents.push(i),r.data&&!r.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),i.tile.lij.toString(),t,e);const n=(0,zv.AK)(r.data);return i.dataArrived(this,n),!0}if(r.requestPromise)return!0;(0,m.IM)(r.requestAbort),r.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,t,r.requestAbort);if(!n)return r.requestAbort=null,!1;const s=()=>{r.requestPromise===n&&(r.requestPromise=null,r.requestAbort=null)};return r.requestPromise=n,n.then(s,s),!0}get leaf(){return null==this._children[0]}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const t=this._children;return t[0]?t[0].findByLij(e)||t[1].findByLij(e)||t[2].findByLij(e)||t[3].findByLij(e):null}distanceToSquared(e){return(0,hr.k)((0,hr.d)(Sx,(0,hh.a)(this._center[gx.MIDDLE]),e))}containsPoint(e){const t=this.extent;return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[2]&&e[1]<=t[3]}containsPointXY(e,t){const i=this.extent;return e>=i[0]&&t>=i[1]&&e<=i[2]&&t<=i[3]}unrequestLayerData(e,t,i){const r=this.layerInfo[t][e],n=r.waitingAgents,s=null!=n.removeUnordered(i);(0,tw.wu)(s,"agent has not requested this piece of map data"),n.length<1&&(r.abortRequest(),this.setMemoryDirty())}dataArrived(e,t,i){const r=(0,zv.AK)(i),n=this.layerInfo[t][e];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll((e=>e.dataArrived(this,r))),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,t){const i=this.layerInfo[t][e];i.dataMissing=!0,i.waitingAgents.forAll((e=>e.dataMissing())),i.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,t,i){switch(i&&this.forEachLoadedNeighbor((i=>i.updateRenderData(e,t))),e){case yv.MAP:return this._updateTexture(t);case yv.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===ow.Ns.FADING?cx.TEXTURE_NOFADING:cx.TEXTURE_FADING),this.setPendingUpdate(e===ow.Ns.FADING?cx.TEXTURE_FADING:cx.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(cx.GEOMETRY);for(const e of this.layerInfo[yv.ELEVATION])e.pendingUpdates|=cx.GEOMETRY}invalidateLayerData(e,t){this.layerInfo[t][e].invalidateSourceData(),this.restartAgents(t)}computeElevationBounds(){const e=this._elevationBoundsMin,t=this._elevationBoundsMax;let i=1/0,r=-1/0;const n=this.layerInfo[yv.ELEVATION];let s=!0;for(const e of n)null!=e.elevationBounds&&(i=Math.min(i,e.elevationBounds.min),r=Math.max(r,e.elevationBounds.max),e.elevationBounds.hasNoDataValues||(s=!1));s&&(i=Math.min(i,0),r=Math.max(r,0)),e===i&&t===r||(this._elevationBoundsMin=i,this._elevationBoundsMax=r,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,t=this._elevationBoundsMax,i=.5*(e+t),r=this._center;(0,hr.h)(Sx,this.up,i),(0,hr.g)((0,hh.a)(r[gx.MIDDLE]),this.centerAtSeaLevel,Sx),(0,hr.h)(Sx,this.up,e),(0,hr.g)(r[gx.TOP],this.centerAtSeaLevel,Sx),(0,hr.h)(Sx,this.up,t),(0,hr.g)(r[gx.BOTTOM],this.centerAtSeaLevel,Sx)}findElevationBoundsForLayer(e,t){const i=this.layerInfo[yv.ELEVATION][e],r=this.elevationLevelDelta,n=Math.max(this.elevationLevel-r,0),s=i.elevationBounds;if(null!=s&&s.level>=t&&s.level<=n)return;const o=this._surface.layerViewByIndex(e,yv.ELEVATION);if(!(0,Iw.W4)(this,o))return;const a=mx;let l=!1;const c=i.data;if(c&&c.level<=n){const e=i.data;a.min=e.samplerData.data.minValue,a.max=e.samplerData.data.maxValue,a.hasNoDataValues=e.samplerData.data.hasNoDataValues,a.level=this.level,l=!0}else{let t,i,s=0;for(let o=this._parent;o&&(!i||s<r)&&(s=this.elevationLevel-o.level,t=i||t,i=o.layerInfo[yv.ELEVATION][e].data,!(!i&&t&&o.level<=n));o=o.parent);i=i||t,i&&(i.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],a),a.min!==1/0&&(a.level=i.level,l=!0))}l&&(null==i.elevationBounds&&(i.elevationBounds=new Jb),i.elevationBounds.copyFrom(a))}modifyLayers(e,t,i){const r=this.layerInfo[i];for(const e of r)e.loadingAgent&&e.loadingAgent!==nx&&(dx(e.loadingAgent),e.loadingAgent=null),e.waitingAgents.clear();for(let t=0;t<r.length;++t)void 0===e[t]&&r[t].release();const n=new Array(...r),s=t.length;r.length=s;for(let e=0;e<s;e++){const i=t[e];r[e]=i>-1?n[i]:ox.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,ow.Ns.FADING))}updateAgents(e){if(this.renderData){const t=this.layerInfo[e];for(const e of t)e.loadingAgent===nx&&(e.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of _v){const t=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==nx&&(i.loadingAgent.setSuspension(t),i.loadingAgent===nx&&this.updateRenderData(e,ow.Ns.FADING))}}removeLayerAgent(e,t){const i=this.layerInfo[t][e];i.loadingAgent&&i.loadingAgent!==nx&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,t){const i=this.layerInfo[t][e];i.loadingAgent=nx,i.data||null!=i.upsampleInfo||this._createOrUpdateAgents(e+1,t)}_hasBlendableAncestor(e){return"normal"!==e.blendMode||(0,z.CY)(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,t,i){for(let r=e;r<t;++r){const e=this._surface.layerViewByIndex(r,i);if((0,tw.TK)(e)&&"normal"!==e?.layer?.blendMode||(0,z.CY)(e?.layer?.parent)&&this._hasBlendableAncestor(e?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,t){const i=this.layerInfo[t];if(0===i.length)return;const r=this._isSuspended(t);for(let n=e;n<i.length;++n){const s=i[n],o=this._surface.layerViewByIndex(n,t);let a=!1;if(s.loadingAgent?(0,Iw.W4)(this,o)?(s.loadingAgent!==nx&&s.loadingAgent.setSuspension(r),s.loadingAgent!==nx&&(a=s.loadingAgent.update())):s.dispose():(0,Iw.W4)(this,o)&&(s.loadingAgent=hx(this,n,t,r),a=s.loadingAgent.startLoading(),a?s.loadingAgent===nx&&this.setPendingUpdate(cx.GEOMETRY):(dx(s.loadingAgent),s.loadingAgent=nx)),s.loadingAgent===nx&&this.updateRenderData(t,ow.Ns.FADING),!this._hasBlendModes(e,i.length,t)&&a&&o.isOpaque)return}}_isWithinExtent(e){const t=this.extent;return t[0]>=e[0]&&e[2]>=t[2]&&t[1]>=e[1]&&e[3]>=t[3]}intersectsExtent(e){const t=this.extent;return t[2]>=e[0]&&e[2]>=t[0]&&t[3]>=e[1]&&e[3]>=t[1]}getElevationVerticesPerSide(e){const t=this.elevationLevel-this.level,i=Math.max(this.level-e,this.elevationLevelDelta-t),r=(0,yt.uZ)(1+(this._maxTesselation>>i),2,this._maxTesselation+1),n=this.minimumVerticesPerSide;return Math.max(r,n)}_findLIJ(e,t){if(!e)return null;const i=this.surface.rootTiles;if(null!=i)for(const r of i)if(yx(r,e)){let i=r,n=e[0]-i.level-1;for(;n>=0&&!i.leaf&&!t(i);){const t=e[1]>>n&1,r=e[2]>>n&1;i=i.children[2*t+r],n--}return t(i)?i:null}return null}findNeighborTile(e,t){const i=this._lij,r=this._getNeighborLIJ(i,e);return r?_x(i,r)?t(this)?this:null:this._findLIJ(r,t):null}findCorner(e,t){const i=e===Tw.X.NORTH_EAST?1:e===Tw.X.NORTH_WEST?0:e===Tw.X.SOUTH_WEST?2:3;let r=this;for(;r.children[0]&&(!t||!t(r));)r=r.children[i];return r}findNeighborCornerTileExact(e,t){return this.findNeighborTile(e,(e=>t(e)||e.level===this.level))?.findCorner((0,tw.$v)(e),t)||null}forAllSubtreeOnSide(e,t){const i=e===Tw.X.NORTH?[0,1]:e===Tw.X.NORTH_EAST?[1]:e===Tw.X.EAST?[1,3]:e===Tw.X.SOUTH_EAST?[3]:e===Tw.X.SOUTH?[2,3]:e===Tw.X.SOUTH_WEST?[2]:e===Tw.X.WEST?[0,2]:[0],r=e=>{const n=e.children;!t(e)&&n[0]&&i.forEach((e=>r(n[e])))};r(this)}getNeighborEdgeStartVertexIndex(e,t){if(!t)return 0;const i=this.level-t.level;if((0,tw.Fp)(!tw.T9||i>=0),0===i)return 0;const r=2**i,n=!(1&~e),s=n?0:1,o=t.lij[s+1]*r,a=this._lij[s+1],l=a-o,c=n?r-1-l:l;return tw.T9&&((0,tw.Fp)(o<=a&&a<o+r),(0,tw.Fp)(0<=c&&c<r)),c}forEachLoadedNeighbor(e){const t=this.level,i=e=>e.level===t||e.loaded;tw.OC.forEach((t=>{const r=this.findNeighborTile(t,i);null!=r&&r!==this&&r.forAllSubtreeOnSide((0,tw._F)(t),(i=>!!i.loaded&&(e(i,t),!0)))})),tw.cA.forEach((t=>{const r=this.findNeighborTile(t,i)?.findCorner((0,tw.$v)(t),(e=>e.loaded));(0,tw.Fp)(!r||vx(this,r,t)),r?.loaded&&e(r,t)}))}_getNeighborLIJ(e,t){const i=(0,tw.Mw)(t)?-1:(0,tw.uv)(t)?1:0,r=(0,tw.OD)(t)?-1:(0,tw.Eu)(t)?1:0,n=[e[0],e[1]+i,e[2]+r];return n[1]<0?null:this.surface.isGlobal?this._wrapLIJ(n):n[2]<0?null:n}_wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}isEdgeNeighbor(e,t){if(null==e)return!1;if(0===this.level&&0===e.level){if(this._eastEnd&&e._westEnd&&t===Tw.X.EAST)return!0;if(this._westEnd&&e._eastEnd&&t===Tw.X.WEST)return!0}const i=Math.max(1e-6*(this.extent[2]-this.extent[0]),1);switch(t){case Tw.X.NORTH:return(0,tw.Wq)(this.extent[3],e.extent[1],i);case Tw.X.SOUTH:return(0,tw.Wq)(this.extent[1],e.extent[3],i);case Tw.X.EAST:return(0,tw.Wq)(this.extent[2],e.extent[0],i)||(0,tw.Wq)(this.extent[2],-e.extent[0],i);case Tw.X.WEST:return(0,tw.Wq)(this.extent[0],e.extent[2],i)||(0,tw.Wq)(this.extent[0],-e.extent[2],i)}}get _eastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get _westEnd(){return 0===this._lij[2]}checkGeometryWaterproofness(){tw.V0&&((0,tw.Fp)(this.loaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const t=this.extent,i=this.surface.rootTilesExtent,r=.25*(t[2]-t[0]);if((0,tw.Mw)(e)&&t[3]+r>=i[3])return!1;if((0,tw.uv)(e)&&t[1]-r<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&(0,tw.OD)(e)&&t[0]-r<=i[0]||!n&&(0,tw.Eu)(e)&&t[2]+r>=i[2])}updateDistanceToPOI(e){const t=this._lastPOI;if(this.distanceToPOI>=0&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return;(0,hr.c)(this._lastPOI,e);const i=this._center[gx.MIDDLE],r=e[0]-i[0],n=e[1]-i[1],s=e[2]-i[2];this.distanceToPOI=r*r+n*n+s*s}}function hx(e,t,i,r){const n=i===yv.ELEVATION?fx.acquire():px.acquire();return n.init(e,t,i,r),n}function dx(e){e.dispose(),function(e){return"elevation"===e.type}(e)?fx.release(e):function(e){return"map"===e.type}(e)&&px.release(e)}const px=new qb.Z(class extends ix{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Ba.GZ}}),fx=new qb.Z(class extends ix{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}),mx=new Jb;var gx;function yx(e,t){const i=e.lij,r=t[0]-i[0];return!(r<0)&&t[1]>>r===i[1]&&t[2]>>r===i[2]}function _x(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function vx(e,t,i){return null!=e&&null!=t&&t!==e&&(e.level>=t.level?bx(e,t,i):bx(t,e,(0,tw.$v)(i)))}function bx(e,t,i){(0,tw.Fp)(e.level>=t.level);const r=(0,tw._0)(i),n=(0,tw.wt)(i),s=e.extent,o=t.extent,a=[r?s[0]:s[2],n?s[3]:s[1]],l=[r?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),u=(0,tw.Wq)(a[0],l[0],c)||e.surface.isGlobal&&(0,tw.Wq)(a[0],-l[0],c),h=(0,tw.Wq)(a[1],l[1],c);if(u&&h)return!0;if(e.level===t.level)return(0,tw.Fp)(!1),!1;if(!u&&!h)return(0,tw.Fp)(!1),!1;const d=u?wx(o[1],o[3],s[1],s[3],c):wx(o[0],o[2],s[0],s[2],c);return(0,tw.Fp)(d),d}function wx(e,t,i,r,n){return e-n<=i&&i<=r&&r<=t+n}!function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"}(gx||(gx={}));const xx=(0,Pa.Ue)(),Tx=(0,Pa.Ue)(),Cx=(0,Pa.Ue)(),Sx=(0,Pa.Ue)();function Ex(e,t){const{tile:i,geometry:r,geometryState:n}=e,{extentInRadians:s,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:u}=n,h=c-1,d=(c-2)**2,p=a&&(t===ow.tk.HAS_SOUTH_POLE||t===ow.tk.HAS_BOTH_POLES),f=a&&(t===ow.tk.HAS_NORTH_POLE||t===ow.tk.HAS_BOTH_POLES),m=((p?1:0)+(f?1:0))*sT*c,g=iT(n),y=d+m+4*g,_=l.tileGeometryCache.acquire(y);r.numVerticesPerSide=c,r.vertexAttributes=_,r.maxEdgeVertexCount=g;const{boundingBox:v}=r;(0,Mf.cS)(v);const b=Px(e);Yx.update(h,s,b),function(e){const{tile:t}=e;if(!t.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:n}=e,{numVerticesPerSide:s,samplerData:o}=r,a=s-2,l=s-1,{vertexAttributes:c,boundingBox:u}=i,h=c.position,d=c.uv0,{typedBuffer:p,typedBufferStride:f}=c.normalCompressed,{extent:m}=t,g=m[0],y=m[2],_=m[1],v=m[3],b=t.ellipsoid.radius,w=n[0],x=n[1],T=n[2],C=h.typedBuffer,S=h.typedBufferStride,E=1/l;let M=0;if(1<=a){const e=E,t=_*(1-e)+v*e,i=Yx.sinLatLUT[1],r=Yx.cosLatLUT[1];for(let n=1;n<=a;n++){const s=n*E,a=g*(1-s)+y*s,l=Yx.sinLonLUT[n],c=Yx.cosLonLUT[n],h=b+ew(a,t,o),p=h*c*r-w,f=h*l*r-x,m=h*i-T;tT(p,f,m,u);const _=(n-1)*S;C[_]=p,C[_+1]=f,C[_+2]=m,Ew(d,n-1,s,e)}}for(let e=1;e<=a;e++){const t=e*E,i=_*(1-t)+v*t,r=Yx.sinLatLUT[e],n=Yx.cosLatLUT[e],s=e+1,c=s*E,h=_*(1-c)+v*c,m=Yx.sinLatLUT[s],A=Yx.cosLatLUT[s],R=Yx.sinLonLUT[0],O=Yx.cosLonLUT[0],P=b+ew(g,i,o);let I=O*n*P-w,L=R*n*P-x,D=r*P-T;const N=M*S;let F=C[N],U=C[N+1],k=C[N+2];for(let t=1;t<=a;t++){const s=t*E,v=g*(1-s)+y*s,R=Yx.sinLonLUT[t],O=Yx.cosLonLUT[t];let P=0,N=0,z=0;if(t<a){const e=(M+1)*S;P=C[e],N=C[e+1],z=C[e+2]}else{const e=Yx.sinLonLUT[l],t=Yx.cosLonLUT[l],s=b+ew(y,i,o);P=t*n*s-w,N=e*n*s-x,z=r*s-T}const B=I,V=L,H=D;I=F,L=U,D=k,F=P,U=N,k=z;const G=P-B,j=N-V,Z=z-H;let q=0,W=0,$=0;if(e>1){const e=(M-a)*S;q=C[e],W=C[e+1],$=C[e+2]}else{const e=Yx.sinLatLUT[0],t=Yx.cosLatLUT[0],i=b+ew(v,_,o);q=O*t*i-w,W=R*t*i-x,$=e*i-T}const Y=b+ew(v,h,o),J=O*A*Y-w,X=R*A*Y-x,K=m*Y-T;if(e<a){const e=M+a,t=e*S;C[t]=J,C[t+1]=X,C[t+2]=K,tT(J,X,K,u),Ew(d,e,s,c)}const Q=q-J,ee=W-X,te=$-K;let ie=O*n,re=R*n,ne=r;ne*ne<.999&&(ie=Z*ee-j*te,re=G*te-Z*Q,ne=j*Q-G*ee);const se=1/Math.sqrt(ie*ie+re*re+ne*ne);(0,Cw.hd)(p,M,ie*se,re*se,ne*se,f),++M}}}(e),r.poleVerticesStartIndex=d;const w=function(e,t,i){const{tile:r,localOrigin:n,geometry:s}=e,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:u,poleVerticesStartIndex:h}=s,d=c-1,p=n[0],f=n[1],m=n[2],g=a.radius,y=o[1],_=o[3],v=[];let b=h;const w=(e,t)=>{const i=t*c;tT(-p,-f,e*g-m,l),v.push(new Wx(1===e,i,1===e?0:2,b,sT));const r=Ox(-1===e?y:_,g),n=e*Math.PI/2-r,s=.99*(1===e?1:-1),o=g+0,{position:a,uv0:h}=u,{typedBuffer:w,typedBufferStride:x}=u.normalCompressed;for(let e=1;e<=sT;++e){const t=r+n*(e/sT),i=Math.cos(t),c=Math.sin(t);for(let e=0;e<=d;e++){const t=e/d,r=Yx.sinLonLUT[e],n=Yx.cosLonLUT[e]*i,u=r*i,g=c,y=n*o-p,_=u*o-f,v=g*o-m;tT(y,_,v,l),a.setValues(b,y,_,v),Ew(h,b,t,s),(0,Cw.hd)(w,b,n,u,g,x),++b}}};return t&&w(-1,0),i&&w(1,d),v}(e,p,f);r.edgeVerticesStartIndex=d+m,Bx(e),Mx(e),Ux(r,w,u),e.intersectionData=null}function Mx(e){e.tile.intersectsClippingArea&&(Rx(e),Ax(e))}function Ax(e,t=!1){const{geometry:i,geometryState:r,tile:n,localOrigin:s}=e,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=n,u=c.radius,h=l[0],d=l[2],p=l[1],f=l[3],{samplerData:m}=r,g=a[0],y=a[2],_=a[1],v=a[3],b=Px(e),{boundingBox:w,vertexAttributes:x}=i,T=s[0],C=s[1],S=s[2],E=x.position,M=E.typedBuffer,A=E.typedBufferStride,R=x.uv0;for(let s=0;s<4;++s){const l=1===s||3===s,c=r.edgeResolutions[s];(0,tw.Fp)((0,yt.wt)(c));const x=c+1,E=Ww(n,r.edgePeerNeighbors[s]);if(Kx(n,E,s)){Hx(e,s,E);continue}const O=null!=E;(0,tw.Fp)(!O||E.level===n.level),(0,tw.Fp)(!O||(0,Iw.gl)(n,E)<=0);const P=E?.renderData,I=P?.geometryState;if(tw.T9){const e=n.surface;if(!E&&e&&!e.updatingRootTiles){const t=tw.OC[s],i=n.findNeighborTile(t,(e=>e.loaded||e.leaf||e.level===n.level));i?i.intersectsClippingArea&&((0,tw.Fp)(!i.loaded),(0,tw.Fp)(!i.leaf),(0,tw.Fp)(i.level===o)):(0,tw.Fp)(null==e?.rootTiles||!n.shouldHaveNeighbor(t))}}const L=1===s?a[2]:a[0],D=E?.extent,N=D&&l?1===s?D[0]:D[2]:L,F=0===s?a[3]:a[1],U=1===s?1:0,k=0===s?1:0,z=1===s?d:h,B=0===s?f:p,V=Math.sin(z),H=Math.cos(z),G=Math.sin(B),j=Math.cos(B),Z=I?.samplerData,q=O?(e,t,i)=>.5*(ew(e,t,m)+ew(i,t,Z)):(e,t,i)=>ew(e,t,m),W=i.outerEdgesOffsetAndLength[2*s+0],$=t&&x>3?x-3:1,Y=null!=m&&m.some((e=>null!=e)),J=null!=Z&&Z.some((e=>null!=e)),X=Y||J,K=1/c,Q=W;(0,tw.Fp)(!D||(0,tw.Wq)(D[2]-D[0],a[2]-a[0])),(()=>{const e=1===s?-1:3===s?1:0,t=0===s?-1:2===s?1:0,r=(a[2]-a[0])*K,n=e*r,o=t*r,c=l?e*((d-h)*K):0,p=l?0:t*K,f=k,E=l?z+c:z,P=l?Math.sin(E):V,I=l?Math.cos(E):H,D=l?z-c:z,W=l?Math.sin(D):V,Y=l?Math.cos(D):H,J=l?B:b(f+p),ee=l?G:Math.sin(J),te=l?j:Math.cos(J),ie=l?B:b(f-p),re=l?G:Math.sin(ie),ne=l?j:Math.cos(ie);let se=0,oe=0,ae=0;{const e=0*K,t=l?L:g*(1-e)+y*e,i=l?N:t,r=l?_*(1-e)+v*e:F,n=l?z:h*(1-e)+d*e,s=l?V:Math.sin(n),o=l?H:Math.cos(n),a=l?b(e):B,c=l?Math.sin(a):G,p=l?Math.cos(a):j,f=u+q(t,r,i);se=o*p*f,oe=s*p*f,ae=c*f}let le=0,ce=0,ue=0;{const e=1*K,t=l?L:g*(1-e)+y*e,i=l?N:t,r=l?_*(1-e)+v*e:F,n=l?z:h*(1-e)+d*e,s=l?V:Math.sin(n),o=l?H:Math.cos(n),a=l?b(e):B,c=l?Math.sin(a):G,p=l?Math.cos(a):j,f=u+q(t,r,i);le=o*p*f,ce=s*p*f,ue=c*f}for(let e=1;e<x-1;e+=$){let t=0,r=0,a=0;{const i=(e+1)*K,n=l?L:g*(1-i)+y*i,s=l?N:n,o=l?_*(1-i)+v*i:F,c=l?z:h*(1-i)+d*i,p=l?V:Math.sin(c),f=l?H:Math.cos(c),m=l?b(i):B,w=l?Math.sin(m):G,x=l?Math.cos(m):j,T=u+q(n,o,s);t=f*x*T,r=p*x*T,a=w*T}const c=t,p=r,f=a,x=le,E=ce,D=ue;le=c,ce=p,ue=f;{const t=Q+e,i=t*A,r=x-T,n=E-C,s=D-S;M[i]=r,M[i+1]=n,M[i+2]=s,tT(r,n,s,w);const o=e*K;Ew(R,t,l?U:o,l?o:k)}const $=se,J=oe,ie=ae;se=x,oe=E,ae=D;const he=x,de=E,pe=D,fe=1/Math.sqrt(he*he+de*de+pe*pe),me=pe*fe;let ge=0,ye=0,_e=0;if(X&&me*me<.999){let t=0,i=0,r=0;{const e=0===s?-1:1;t=e*(c-$),i=e*(p-J),r=e*(f-ie)}{const a=e*K,c=l?L:g*(1-a)+y*a,p=l?N:c,f=l?_*(1-a)+v*a:F,w=l?z:h*(1-a)+d*a,x=l?V:Math.sin(w),T=l?H:Math.cos(w),C=l?b(a):B,S=l?Math.sin(C):G,E=l?Math.cos(C):j;let M=he,A=de,R=pe;if(O){const e=u+ew(p-n,f-o,Z),t=l?E:ne;M=(l?Y:T)*t*e,A=(l?W:x)*t*e,R=(l?S:re)*e}{const e=u+ew(c+n,f+o,m),a=l?E:te,h=(l?I:T)*a*e,d=(l?P:x)*a*e,p=(l?S:ee)*e;O||(M=2*he-h,A=2*de-d,R=2*pe-p);const g=3===s?-1:1,y=g*(M-h),_=g*(A-d),v=g*(R-p);ge=r*_-i*v,ye=t*v-r*y,_e=i*y-t*_;const b=1/Math.sqrt(ge*ge+ye*ye+_e*_e);ge*=b,ye*=b,_e*=b}}}else ge=he*fe,ye=de*fe,_e=pe*fe;i.setEdgeNormalFromValues(s,e,ge,ye,_e)}})()}}function Rx(e){Gx(e)}function Ox(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function Px(e){const{tile:t}=e;if(t.surface.isWebMercator){const e=t.extent,i=t.ellipsoid.radius;return t=>function(e,t,i,r){return Ox(e*(1-r)+t*r,i)}(e[1],e[3],i,t)}const i=t.extentInRadians;return e=>function(e,t,i){return e*(1-i)+t*i}(i[1],i[3],e)}function Ix(e,t){const{tile:i,geometryState:r,geometry:n}=e,{extent:s,surface:o}=i,{wireframe:a}=r,l=s[0],c=s[1],u=s[2]-l,h=s[3]-c,{numVerticesPerSide:d,clippingArea:p}=r,f=null!=p?Math.max(0,(p[0]-l)/u):0,m=null!=p?Math.max(0,(p[1]-c)/h):0,g=null!=p?Math.min(1,(p[2]-l)/u):1,y=null!=p?Math.min(1,(p[3]-c)/h):1,_=(d-2)**2,v=iT(r),b=_+4*v,w=o.renderer.tileGeometryCache.acquire(b),{boundingBox:x}=n;(0,Mf.cS)(x),n.numVerticesPerSide=d,n.vertexAttributes=w,n.maxEdgeVertexCount=v,n.minu=f,n.minv=m,n.maxu=g,n.maxv=y,function(e){const t=e.tile;if(!t.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:n}=e,{samplerData:s,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:c,ellipsoid:u}=t,{isWebMercatorOnPlateCarree:h}=l,d=null!=o?o:Jx,p=c[0],f=c[1],m=c[2],g=c[3],y=Math.max(p,d[0]),_=Math.min(m,d[2]),v=Math.max(f,d[1]),b=Math.min(g,d[3]),w=u.radius,x=t.horizontalScale,T=a-1,C=a-2,{minu:S,minv:E,maxu:M,maxv:A,boundingBox:R,vertexAttributes:O}=i,P=O.position,I=O.uv0,{typedBuffer:L,typedBufferStride:D}=O.normalCompressed,N=n[0],F=n[1],U=n[2],k=P.typedBuffer,z=P.typedBufferStride;let B=0;const V=(0,yt.uZ)(f,v,b),H=h?(Math.PI/2-2*Math.atan(Math.exp(-V/w)))*w:V*x,G=1/T,j=(0,yt.uZ)(f*(1-G)+g*G,v,b);let Z=H,q=h?(Math.PI/2-2*Math.atan(Math.exp(-j/w)))*w:j*x;for(let e=1;e<=C;e++){const t=e/T,i=(0,yt.uZ)(f*(1-t)+g*t,v,b),r=(0,yt.uZ)(t,E,A),n=q,o=(e-1)/T,a=(0,yt.uZ)(f*(1-o)+g*o,v,b),l=Z,c=(e+1)/T,u=(0,yt.uZ)(f*(1-c)+g*c,v,b),d=h?(Math.PI/2-2*Math.atan(Math.exp(-u/w)))*w:u*x,O=(0,yt.uZ)(c,E,A);Z=q,q=d;const P=(0,yt.uZ)(p,y,_);let V=P*x,H=ew(P,i,s);const G=1/T,j=(0,yt.uZ)(G,S,M),W=(0,yt.uZ)(p*(1-j)+m*j,y,_);let $=j,Y=W,J=W*x,X=ew(W,i,s);if(1===e){const e=J-N,t=Z-F,i=X-U,n=0*z;k[n]=e,k[n+1]=t,k[n+2]=i,tT(e,t,i,R);Ew(I,B,(0,yt.uZ)(G,S,M),r)}for(let t=1;t<=C;t++){const o=J,c=X,h=(t+1)/T,f=(0,yt.uZ)(h,S,M),g=(0,yt.uZ)(p*(1-h)+m*h,y,_),v=Y;Y=g;{const o=B+1,a=o*z;if(1===e||t===C){const l=g*x,c=ew(g,i,s);if(1===e&&t<C){const e=l-N,t=n-F,i=c-U;k[a]=e,k[a+1]=t,k[a+2]=i,tT(e,t,i,R),Ew(I,o,f,r)}J=l,X=c}else J=k[a]+N,X=k[a+2]+U}const b=J,w=X,E=V,A=H;V=o,H=c;const P=(B-C)*z,G=1===e?ew(v,a,s):k[P+2]+U,j=ew(v,u,s);if(e<C){const e=B+C,t=e*z,i=o-N,r=d-F,n=j-U;k[t]=i,k[t+1]=r,k[t+2]=n,tT(i,r,n,R);const s=$;$=f,Ew(I,e,s,O)}{const e=b-E,t=l-d,i=t*(w-A),r=e*(G-j),n=-t*e,s=i*i+r*r+n*n;if(0===s)(0,Cw.hd)(L,B,0,0,1,D);else{const e=1/Math.sqrt(s);(0,Cw.hd)(L,B,i*e,r*e,n*e,D)}}++B}}}(e),n.edgeVerticesStartIndex=_,Bx(e),Lx(e),Ux(n,[],a),e.intersectionData=null}function Lx(e,t){e.tile.intersectsClippingArea&&(Nx(e),Dx(e,!1))}function Dx(e,t){const{geometry:i,geometryState:r,localOrigin:n}=e,s=e.tile,{surface:o,extent:a}=s,{clippingArea:l,samplerData:c}=r,u=null!=l?l:Jx,h=a[0],d=a[2],p=a[1],f=a[3],m=[f>u[3],d>u[2],p<u[1],h<u[0]],g=s.horizontalScale,y=Fx(o.isWebMercatorOnPlateCarree,s.ellipsoid.radius,g),{minu:_,minv:v,maxu:b,maxv:w,boundingBox:x}=i,T=Math.max(h,u[0]),C=Math.min(d,u[2]),S=Math.max(p,u[1]),E=Math.min(f,u[3]),M=n[0],A=n[1],R=n[2];for(let n=0;n<4;++n){const a=1===n||3===n,l=r.edgeResolutions[n];(0,tw.Fp)((0,yt.wt)(l));const u=l+1,O=m[n],P=Ww(s,r.edgePeerNeighbors[n]);if(!O&&Kx(s,P,n)){Hx(e,n,P);continue}const I=null!=P&&!O,L=P?.renderData,D=L?.geometryState;if(tw.T9&&((0,tw.Fp)(!I||P.level===s.level),(0,tw.Fp)(!I||(0,Iw.gl)(s,P)<=0),s&&!P&&!o.updatingRootTiles)){const e=tw.OC[n],t=s.findNeighborTile(e,(e=>e.loaded||e.leaf||e.level===s.level));o.updatingRootTiles||(t?t.intersectsClippingArea&&((0,tw.Fp)(!t.loaded),(0,tw.Fp)(!t.leaf),(0,tw.Fp)(t.level===s.level)):(0,tw.Fp)(null==o?.rootTiles||!s.shouldHaveNeighbor(e)))}const N=(0,yt.uZ)(1===n?d:h,T,C),F=(0,yt.uZ)(0===n?f:p,S,E),U=D?.samplerData,k=t&&u>3?u-3:1,z=(0,yt.uZ)(1===n?1:0,_,b),B=(0,yt.uZ)(0===n?1:0,v,w),V=I?(e,t)=>.5*(ew(e,t,U)+ew(e,t,c)):(e,t)=>ew(e,t,c),H=(d-h)/l,G=a?1===n?H:-H:0,j=a?0:0===n?H:-H,Z=-G,q=-j;let W=0,$=0,Y=0;{const e=0/l,t=a?N:(0,yt.uZ)(h*(1-e)+d*e,T,C),i=a?(0,yt.uZ)(p*(1-e)+f*e,S,E):F,r=V(t,i);W=t*g,$=y(i),Y=r}let J=0,X=0,K=0;{const e=1/l,t=a?N:(0,yt.uZ)(h*(1-e)+d*e,T,C),i=a?(0,yt.uZ)(p*(1-e)+f*e,S,E):F,r=V(t,i);J=t*g,X=y(i),K=r}for(let e=1;e<u-1;e+=k){const t=e/l,r=J,s=X,o=K;{const l=a?z:(0,yt.uZ)(t,_,b),c=a?(0,yt.uZ)(t,v,w):B,u=r-M,h=s-A,d=o-R;tT(r,h,d,x),i.setEdgeVertexFromValuesRawPositionUV(n,e,u,h,d,l,c)}{const t=(e+1)/l,i=a?N:(0,yt.uZ)(h*(1-t)+d*t,T,C),r=a?(0,yt.uZ)(p*(1-t)+f*t,S,E):F,n=V(i,r);J=i*g,X=y(r),K=n}const u=J,m=K,O=W,P=$,L=Y;W=r,$=s,Y=o;let D=0,k=0,H=0;if(a){const e=X-s,i=m-o,a=P-s,l=L-o,u=(0,yt.uZ)(p*(1-t)+f*t,S,E),h=N+Z,d=h*g-r,y=ew(h,u,c)-o,_=3===n?-1:1;if(D=_*(-a+e)*y,k=_*d*(-l+i),H=-_*d*(-a+e),I){const t=N+G,n=t*g-r;D=(-a+e)*(y-(ew(t,u,U)-o)),k=(d-n)*(-l+i),H=-(d-n)*(-a+e)}}else{const e=u-r,i=m-o,a=O-r,l=L-o,p=(0,yt.uZ)(h*(1-t)+d*t,T,C),f=F+q,g=ew(p,f,c)-o,_=y(f)-s,v=2===n?-1:1;if(D=v*_*(-l+i),k=v*(-a+e)*g,H=-v*_*(-a+e),I){const t=p,r=F+j,n=y(r)-s;D=(-_+n)*(-l+i),k=(-a+e)*(-g+(ew(t,r,U)-o)),H=-(-_+n)*(-a+e)}}const Q=1/Math.sqrt(D*D+k*k+H*H);i.setEdgeNormalFromValues(n,e,D*Q,k*Q,H*Q)}}}function Nx(e,t){Gx(e)}function Fx(e,t,i){return e?e=>function(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}(e,t):e=>function(e,t){return e*t}(e,i)}function Ux(e,t,i){const{numVerticesPerSide:r,vertexAttributes:n,maxEdgeVertexCount:s}=e,o=r-1,a=n.count,l=2*(r-3)*(r-3),c=4*(o+s-3),u=tx.reduce(((t,i)=>t+(o+e.getEdgeCount(i)-3)),0),h=t.reduce(((e,t)=>e+o*(2*(t.latitudeResolution-1)+1)),0),d=3*(i?2:1),p=(l+c+h)*d,f=a>=65536?new Uint32Array(p):new Uint16Array(p);for(let e=0;e<p;++e)f[e]=0;e.indices=f,e.indexCount=(l+u+h)*d,e.poleIndicesStartIndex=l*d,e.edgeIndicesStartIndex=(l+h)*d,i?(function(e){const{indices:t,numVerticesPerSide:i,vertexAttributes:r}=e,{position:n}=r,{typedBuffer:s,typedBufferStride:o}=n,a=i-2;let l=0;for(let e=0;e<i-3;++e){const r=e*a;for(let n=0;n<i-3;++n){const i=e*a+n,c=i+1,u=c+a,h=u-1,d=r+n,p=d+1,f=p+a;rT(d,p,f,f-1,o,s)?(nT(t,l,i,c,u),l+=6,nT(t,l,u,h,i)):(nT(t,l,i,c,h),l+=6,nT(t,l,h,u,c)),l+=6}}}(e),function(e,t){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:n}=e,s=r-1;let o=n;for(const n of t){const t=n.connectedOuterEdgeOffset;let a=e.getEdgeVertexIndex(t,0),l=1;for(let e=0;e<n.latitudeResolution;++e){const t=0===e?n.rowOffset:a+r;for(let r=0;r<s;r++)nT(i,o,a,a+1,t+r),o+=6,e<n.latitudeResolution-1&&(nT(i,o,a+1,t+r+1,t+r),o+=6),a+=l;a=t,l=1}}}(e,t),zx(e)):(function(e){const{numVerticesPerSide:t,indices:i,vertexAttributes:r}=e,{position:n}=r,{typedBuffer:s,typedBufferStride:o}=n,a=t-2,l=t-3,c=0,u=t-3;let h=0;for(let e=0;e<l;++e){const t=e*a;for(let e=c;e<u;++e){const r=t+e,n=r+1,l=n+a,c=l-1;rT(r,n,l,c,o,s)?(i[h]=r,i[h+1]=n,i[h+2]=l,i[h+3]=l,i[h+4]=c,i[h+5]=r):(i[h]=r,i[h+1]=n,i[h+2]=c,i[h+3]=c,i[h+4]=n,i[h+5]=l),h+=6}}}(e),function(e,t){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:n}=e,s=i-1;let o=n;for(const n of t){const t=n.isNorth?1:2,a=n.isNorth?2:1,l=n.isNorth?3:4,c=n.isNorth?4:3;let u=e.getEdgeVertexIndex(n.connectedOuterEdgeOffset,0),h=1;for(let e=0;e<n.latitudeResolution;++e){const d=0===e?n.rowOffset:u+i;for(let i=0;i<s;i++){const s=d+i;r[o]=u,r[o+t]=u+1,r[o+a]=s,e<n.latitudeResolution-1?(r[o+l]=u+1,r[o+c]=s+1,r[o+5]=s,o+=6):o+=3,u+=h}u=d,h=1}}}(e,t),kx(e))}function kx(e){const{indices:t,numVerticesPerSide:i,edgeIndicesStartIndex:r}=e,n=i-1,s=n-2;let o=r;for(let i=0;i<4;++i){const r=eT[i];let a=0,l=0;const c=e.getEdgeCount(i),u=r.count;(0,tw.Fp)(u===n-1);const h=1===i||2===i,d=h?1:2,p=h?2:1,f=e.getEdgeFirstVertexIndex(i),m=1,g=r.vertex0Index,y=r.stride;for(;a<c-1||l<u-1;){const e=g+l*y,i=f+a*m,r=a<c-1,h=l<u-1,_=r&&(!h||(r?0+n*(a+.5)/(c-1):0)<=(h?1+s*(l+.5)/(u-1):0));_?++a:++l;const v=_?i+m:e+y;t[o]=e,t[o+d]=i,t[o+p]=v,o+=3}}e.indexCount=o}function zx(e){const{indices:t,numVerticesPerSide:i,edgeIndicesStartIndex:r}=e,n=i-1,s=n-2;let o=r;for(let i=0;i<4;++i){const r=eT[i];let a=0,l=0;const c=e.getEdgeCount(i),u=r.count;(0,tw.Fp)(u===n-1);const h=1===i||2===i,d=h?1:3,p=h?3:1,f=e.getEdgeFirstVertexIndex(i),m=1,g=r.vertex0Index,y=r.stride;for(;a<c-1||l<u-1;){const e=g+l*y,i=f+a*m,r=a<c-1,h=l<u-1,_=r&&(!h||(r?0+n*(a+.5)/(c-1):0)<=(h?1+s*(l+.5)/(u-1):0));_?++a:++l;const v=_?i+m:e+y;t[o]=e,t[o+d]=i,t[o+d+1]=i,t[o+p]=v,t[o+p+1]=v,t[o+5]=e,o+=6}}e.indexCount=o}function Bx(e){const{geometry:t,geometryState:i}=e,{edgeResolutions:r}=i,{numVerticesPerSide:n,edgeVerticesStartIndex:s}=t,o=n-2;let a=s;for(let e=0;e<4;++e){{const t=0===e||2===e,i=(0===e?o-1:0)*o+(1===e?o-1:0),r=(t?0:1)*o+(t?1:0),n=eT[e];n.vertex0Index=i,n.stride=r,n.count=o}{const i=r[e]+1;t.outerEdgesOffsetAndLength[2*e+0]=a,t.outerEdgesOffsetAndLength[2*e+1]=i,a+=i}}}function Vx(e){Bx(e),e.geometryState.wireframe?zx(e.geometry):kx(e.geometry)}function Hx(e,t,i){const{geometryState:r,geometry:n,tile:s,localOrigin:o}=e,a=1===t||3===t,l=r.edgeResolutions[t];(0,tw.Fp)((0,yt.wt)(l));const c=l+1,{boundingBox:u,minu:h,minv:d,maxu:p,maxv:f,vertexAttributes:m}=n,g=(0,yt.uZ)(1===t?1:0,h,p),y=(0,yt.uZ)(0===t?1:0,d,f),_=i.renderData,v=_.geometryState,b=_.geometry,w=(t+2)%4,x=b.getEdgeCount(w),T=s.getNeighborEdgeStartVertexIndex(t,i)*l,C=l*2**(s.level-i.level);(0,tw.Fp)(v.edgeResolutions[w]===C),(0,tw.Fp)(x-1===C);const S=_.localOrigin[0]-o[0],E=_.localOrigin[1]-o[1],M=_.localOrigin[2]-o[2],A=n.getEdgeFirstVertexIndex(t),R=m.position,O=R.typedBuffer,P=R.typedBufferStride,I=m.normalCompressed,L=I.typedBuffer,D=I.typedBufferStride,N=m.uv0,F=b.vertexAttributes,U=b.getEdgeFirstVertexIndex(w),k=F.position.typedBuffer,z=F.position.typedBufferStride,B=F.normalCompressed.typedBuffer,V=F.normalCompressed.typedBufferStride;for(let e=1;e<c-1;++e){const t=A+e,i=U+(T+e),r=t*P,n=i*z,s=k[n]+S,o=k[n+1]+E,c=k[n+2]+M;O[r]=s,O[r+1]=o,O[r+2]=c,tT(s,o,c,u);const m=t*D,_=i*V;L[m]=B[_],L[m+1]=B[_+1];const v=e/l;Ew(N,t,a?g:(0,yt.uZ)(v,h,p),a?(0,yt.uZ)(v,d,f):y)}}function Gx(e){const{geometry:t,geometryState:i,localOrigin:r}=e,{clippingArea:n,samplerData:s}=i,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:u,vertexAttributes:h}=t,d=e.tile,{surface:p,ellipsoid:f,extent:m,extentInRadians:g,horizontalScale:y}=d,_="local"===p.view?.viewingMode,v=f.radius;let b=0,w=0,x=0;const T=_?(()=>{const e=n,t=null!=e&&(m[3]>e[3]||m[2]>e[2]||m[1]<e[1]||m[0]<e[0]),i=Fx(p.isWebMercatorOnPlateCarree,v,y);return(r,n,s)=>{const o=0===r?m[0]:m[2],a=0===n?m[1]:m[3],l=t?(0,yt.uZ)(o,e[0],e[2]):o,c=t?(0,yt.uZ)(a,e[1],e[3]):a,u=s;b=l*y,w=i(c),x=u}})():(e,t,i)=>{const r=g[0===t?1:3],n=g[0===e?0:2],s=Math.cos(r),o=Math.sin(r),a=Math.sin(n),l=Math.cos(n),c=v+i;b=l*s*c,w=a*s*c,x=o*c};let C=0,S=0,E=0,M=0,A=0,R=0,O=0,P=0,I=0;const L=_&&p.isWebMercatorOnPlateCarree,D=(e,t,i,r,n)=>{let s=0,o=0,a=0;if(_){const e=t*y,n=L?(Math.PI/2-2*Math.atan(Math.exp(-i/v)))*v:i*y;s=e-b,o=n-w,a=r-x}else{const n=Px(e),l=e.tile,c=l.extent,u=l.extentInRadians,h=(t-c[0])/(c[2]-c[0]),d=(i-c[1])/(c[3]-c[1]),p=u[0]*(1-h)+u[2]*h,f=n(d),m=Math.cos(f),g=Math.sin(f),y=Math.sin(p),_=Math.cos(p),T=v+r;s=_*m*T-b,o=y*m*T-w,a=g*T-x}switch(n){case 0:O+=s,P+=o,I+=a;break;case 1:M-=s,A-=o,R-=a;break;case 2:O-=s,P-=o,I-=a;break;case 3:M+=s,A+=o,R+=a}},N=n??Jx,F=m[0],U=m[2],k=m[1],z=m[3],B=[z>N[3],U>N[2],k<N[1],F<N[0]],V=Math.max(F,N[0]),H=Math.min(U,N[2]),G=Math.max(k,N[1]),j=Math.min(z,N[3]),Z=e=>Math.max(N[0],Math.min(N[2],e)),q=e=>Math.max(N[1],Math.min(N[3],e)),W=e=>{const t=i.cornerNeighborCornerTiles;C=0,S=0,E=1,M=0,A=0,R=0,O=0,P=0,I=0;let r=1/0;for(let i=0;i<4;++i){const n=t[4*e+i];r=Math.min(r,n?.level??1/0)}for(let i=0;i<4;++i){const n=t[4*e+i];Xx[i]=n?.level===r?n:null}let n=1,s=0;for(let e=0;e<4;++e){const t=Xx[e];t&&(n=Math.max(n,t?.renderData.geometryState.numVerticesPerSide),s=t.extent[2]-t.extent[0])}const o=s,a=n;(0,tw.Fp)(a>1);const l=o/a;for(let e=0;e<4;++e){const t=Xx[(e+3)%4],i=Xx[e%4];if(!t&&!i)continue;const r=0===e?1:1===e?2:2===e?3:0,n=0===e?2:1===e?3:2===e?0:1;if(t&&i){const s=$x[e][0]*l,o=$x[e][1]*l,a=t.extent,c=Z(a[0===r||1===r?2:0]+s),u=q(a[0===r||3===r?3:1]+o),h=i.extent,d=Z(h[0===n||1===n?2:0]+s),p=q(h[0===n||3===n?3:1]+o),f=t.renderData,m=i.renderData,g=ew(c,u,f.geometryState.samplerData),y=ew(d,p,m.geometryState.samplerData);D(f,c,u,.5*(g+y),e)}else{const s=t??i,o=t?r:n,a=s.extent,c=$x[e],u=Z(a[0===o||1===o?2:0]+c[0]*l),h=q(a[0===o||3===o?3:1]+c[1]*l),d=s.renderData,p=ew(u,h,d.geometryState.samplerData);D(d,u,h,p,e)}}if(!_){const e=Math.sqrt(b*b+w*w+x*x);C=b/e,S=w/e,E=x/e}if(_||E*E<.999){const e=Math.sqrt(M*M+A*A+R*R);M/=e,A/=e,R/=e;const t=Math.sqrt(O*O+P*P+I*I);O/=t,P/=t,I/=t,C=R*P-A*I,S=M*I-R*O,E=A*O-M*P;const i=1/Math.sqrt(C*C+S*S+E*E);C*=i,S*=i,E*=i}},$=i.cornerNeighborCornerTiles;for(let e=0;e<4;++e){const n=e,p=(e+1)%4,f=0===e||1===e?1:0,m=0===e||3===e?1:0,g=(0,yt.uZ)(f,o,l),y=(0,yt.uZ)(m,a,c),_=t.getEdgeFirstVertexIndex(n),v=t.getEdgeCount(n),M=0===e||3===e?v-1:0,A=t.getEdgeFirstVertexIndex(p),R=t.getEdgeCount(p),O=0===e||1===e?R-1:0;let P=-1;for(let t=0;t<4;++t){const i=$[4*e+t],r=$[4*e+P];i&&(-1===P||(0,Iw.gl)(r,i)>0)&&(P=t)}const I=P,L=$[4*e+I];if(L!==d){const t=d.level-L.level,n=2**t,s=[L.lij[0]+t,L.lij[1]*n,L.lij[2]*n],o=[s[1]+n===d.lij[1],0===e&&(1===I||0===I&&L!==$[4*e+3])||1===e&&(0===I||1===I&&L!==$[4*e+2]),s[1]===d.lij[1]+1,2===e&&(3===I||2===I&&L!==$[4*e+1])||3===e&&(2===I||3===I&&L!==$[4*e+0])],a=o.reduce(((e,t)=>e+(t?1:0)),0);(0,tw.Fp)(1===a||2===a);let l=-1,c=-1;const p=L.renderData;if(1===a){const t=o.findIndex((e=>e));(0,tw.Fp)(0<=t&&t<=3),l=(t+2)%4;const r=i.edgeResolutions[t];c=d.getNeighborEdgeStartVertexIndex(t,L)*r+r*(0===t&&0===e||1===t&&0===e||2===t&&1===e||3===t&&3===e?1:0)}else{(0,tw.Fp)(o[1]||o[3]),l=o[1]?3:1;const t=p.geometryState.edgeResolutions[l];c=0===e||3===e?0:t}const f=p.geometry;{const e=_+M,t=A+O,i=f.getEdgeFirstVertexIndex(l)+c,n=f.vertexAttributes,s=p.localOrigin;{const o=n.position,a=o.typedBuffer,l=i*o.typedBufferStride,c=a[l]+s[0]-r[0],d=a[l+1]+s[1]-r[1],p=a[l+2]+s[2]-r[2];tT(c,d,p,u);const f=h.position,m=f.typedBuffer;{const t=e*f.typedBufferStride;m[t]=c,m[t+1]=d,m[t+2]=p}{const e=t*f.typedBufferStride;m[e]=c,m[e+1]=d,m[e+2]=p}}const o=h.uv0;Ew(o,e,g,y),Ew(o,t,g,y);{const r=n.normalCompressed.typedBuffer,s=i*n.normalCompressed.typedBufferStride,o=h.normalCompressed,a=o.typedBuffer;{const t=e*o.typedBufferStride;a[t]=r[s],a[t+1]=r[s+1]}{const e=t*o.typedBufferStride;a[e]=r[s],a[e+1]=r[s+1]}}}}else{let i;if(B[n]||B[p]){i=ew((0,yt.uZ)(F*(1-f)+U*f,V,H),(0,yt.uZ)(k*(1-m)+z*m,G,j),s)}else i=jx($,e);T(f,m,i),W(e);const o=b-r[0],a=w-r[1],l=x-r[2];tT(o,a,l,u),t.setEdgeVertexFromValuesRawPositionUVNormal(n,M,o,a,l,g,y,C,S,E),t.setEdgeVertexFromValuesRawPositionUVNormal(p,O,o,a,l,g,y,C,S,E)}}for(let e=0;e<4;++e)Xx[e]=null}function jx(e,t){const i=4*t,r=tx.reduce(((t,r)=>Math.min(t,e[i+r]?.level??1/0)),1/0);tw.T9&&((0,tw.Fp)(!e[i+0]||!e[i+2]||vx(e[i+0],e[i+2],Tw.X.SOUTH_WEST)),(0,tw.Fp)(!e[i+1]||!e[i+3]||vx(e[i+1],e[i+3],Tw.X.NORTH_WEST)));let n=0,s=0;for(let t=0;t<4;++t){const o=e[i+t];if(o&&o.level===r){const e=0===t||1===t,i=0===t||3===t,r=o.extent,a=r[e?0:2],l=r[i?1:3],c=o.renderData?.geometryState?.samplerData;s+=ew(a,l,c),n++}}const o=n?s/n:0;return(0,tw.Fp)(null!=o),o}function Zx(e){const{vao:t,geometry:i}=e,{vertexAttributes:r,edgeVerticesStartIndex:n}=i,s=r.position.typedBuffer;t.vertexBuffers.get("geometry").setSubData(s,n,n,s.length)}function qx(e){const{vao:t,geometry:i}=e,{indices:r,indexCount:n,edgeIndicesStartIndex:s}=i;t.indexBuffer.setSubData(r,s,s,n)}class Wx{constructor(e,t,i,r,n){this.isNorth=e,this.connectedRowOffset=t,this.connectedOuterEdgeOffset=i,this.rowOffset=r,this.latitudeResolution=n}}const $x=[[0,1],[1,0],[0,-1],[-1,0]],Yx=new class{constructor(){this.sinLonLUT=new Array(Ba.Cf+1),this.cosLonLUT=new Array(Ba.Cf+1),this.sinLatLUT=new Array(Ba.Cf+1),this.cosLatLUT=new Array(Ba.Cf+1)}update(e,t,i){const r=t[0],n=t[2];for(let t=0;t<=e;t++){const s=t/e,o=r*(1-s)+n*s;this.sinLonLUT[t]=Math.sin(o),this.cosLonLUT[t]=Math.cos(o);const a=i(s);this.sinLatLUT[t]=Math.sin(a),this.cosLatLUT[t]=Math.cos(a)}}},Jx=(0,Ds.al)(-1/0,-1/0,1/0,1/0),Xx=[null,null,null,null];function Kx(e,t,i){if(!t)return!1;const r=(0,Iw.gl)(e,t);return r>0||0===r&&i>=2}class Qx{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return(0,tw.Fp)(0<=e&&e<this.count),this.vertex0Index+this.stride*e}}const eT=[new Qx,new Qx,new Qx,new Qx];function tT(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function iT(e){const{edgeResolutions:t,numVerticesPerSide:i}=e,r=1+Math.max(...t);return Math.max(i,r)}function rT(e,t,i,r,n,s){const o=e*n,a=s[o],l=s[o+1],c=s[o+2],u=t*n,h=s[u],d=s[u+1],p=s[u+2],f=i*n,m=s[f],g=s[f+1],y=s[f+2],_=r*n,v=s[_],b=s[_+1],w=s[_+2];return(h-v)*(h-v)+(d-b)*(d-b)+(p-w)*(p-w)>(a-m)*(a-m)+(l-g)*(l-g)+(c-y)*(c-y)}function nT(e,t,i,r,n){e[t]=i,e[t+1]=r,e[t+2]=r,e[t+3]=n,e[t+4]=n,e[t+5]=i}const sT=6;var oT=n(85906);class aT extends ux{constructor(e,t,i,r,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=(0,Ds.Ue)(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,t,i,r,n)}init(e,t,i,r,n){super.init(e,t,i,r,n);const s=n.view.renderSpatialReference,o=n.spatialReference,a=null!=s&&(0,Le.QM)(s)&&null!=o&&o.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=a;const{isWebMercatorOnPlateCarree:l}=n,c=this._extentInRenderSR,u=this.extent;if(l){const e=(0,Pa.al)(u[0],u[1],0);(0,Ef.S)(e,Ie.Z.WebMercator,e,Ie.Z.PlateCarree);const t=(0,Pa.al)(u[2],u[3],0);(0,Ef.S)(t,Ie.Z.WebMercator,t,Ie.Z.PlateCarree),c[0]=e[0],c[1]=e[1],c[2]=t[0],c[3]=t[1]}else for(let e=0;e<4;++e)c[e]=u[e]*a;this.centerAtSeaLevel[0]=.5*(c[0]+c[2]),this.centerAtSeaLevel[1]=.5*(c[1]+c[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(c[2]-c[0],c[3]-c[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,t=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),r=Math.sqrt(t*t+i*i),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),s=Math.max(r,n);this._center[gx.MIDDLE][3]=s}_calculateFrustumVisibility(e){const t=this._aabb(),i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5];let l=!0;for(let t=0;t<6;t++){const c=e[t],u=c[0],h=c[1],d=c[2],p=c[3];if(u*(u>0?i:s)+h*(h>0?r:o)+d*(d>0?n:a)+p>=0)return sx.OUTSIDE;l=l&&u*(u<0?i:s)+h*(h<0?r:o)+d*(d<0?n:a)+p<=0}return l?sx.INSIDE:sx.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return(0,Mf.re)(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,t,i,r){return lT[0]=1/t[0],lT[1]=1/t[1],lT[2]=1/t[2],(0,oT.Fw)(this._aabb(),e,lT,i,r)}createGeometry(){Ix(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,t=this._subtreeGeometryElevationBoundMax,i=this.renderData;let r=e,n=t;if(i){const e=i.geometry.boundingBox;r=e[2],n=e[5]}else if(!this.leaf){r=1/0,n=-1/0;for(const e of this.children){const t=e;r=Math.min(r,t._subtreeGeometryElevationBoundMin),n=Math.max(n,t._subtreeGeometryElevationBoundMax)}}if(r!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax){this._subtreeGeometryElevationBoundMin=r,this._subtreeGeometryElevationBoundMax=n;this.parent?._updateSubtreeGeometryElevationsBounds()}}get minimumVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){(function(e,t){e.tile.intersectsClippingArea&&(Nx(e),Dx(e,!0),Zx(e),e.intersectionData=null)})(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){(function(e,t){e.tile.intersectsClippingArea&&(Lx(e),Zx(e),e.intersectionData=null)})(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){(function(e,t){e.tile.intersectsClippingArea&&(Vx(e),Lx(e),Zx(e),qx(e),e.intersectionData=null)})(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}}const lT=(0,Pa.Ue)();var cT=n(57410);class uT{constructor(){this.extent=(0,rf.Ue)(),this.minLevel=0,this.maxLevel=0,this.callback=null}}let hT=class extends P.Z{constructor(){super(...arguments),this._queries=new Pg.Z({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Pg.Z({initialSize:30}),this._queryPool=new qb.Z(uT)}queryVisibleLevelRange(e,t,i,r){const n=this._queryPool.acquire();(0,tf.c)(n.extent,e),n.minLevel=t??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=r,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return 0!==this._queryQueue.length}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const t=e.level;let i=0;for(;i<this._queriesInvPtr;){const r=this._queries.data[i],n=r.extent;t>=r.minLevel&&t<=r.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};(0,i._)([(0,y.Cb)()],hT.prototype,"updating",null),hT=(0,i._)([(0,v.j)("esri.views.3d.terrain.ScaleRangeQueries")],hT);var dT=n(92570);class pT extends ux{constructor(e,t,i,r,n){super(),this._convexHull=new Array(24),this._boundingSphere=(0,hh.c)(),this._baseUsedMemory=1816,this.init(e,t,i,r,n)}init(e,t,i,r,n){super.init(e,t,i,r,n);const s=this.ellipsoid.radius,o=this.extentInRadians[0],a=this.extentInRadians[1],l=this.extentInRadians[2],c=this.extentInRadians[3],u=(0,yt.t7)(a,c,.5),h=(0,yt.t7)(o,l,.5),d=0===e?0:Math.min(Math.abs(a),Math.abs(c));this._edgeLen=(l-o)*Math.cos(d)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),function(e,t,i,r){const n=Math.cos(i);e[0]=Math.cos(t)*n*r,e[1]=Math.sin(t)*n*r,e[2]=Math.sin(i)*r}(this.centerAtSeaLevel,h,u,this.ellipsoid.radius),(0,hr.n)(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(0===this.lij[0])(0,hr.i)((0,hh.a)(e[gx.MIDDLE]),0,0,0),(0,hr.i)(e[gx.TOP],0,0,0),(0,hr.i)(e[gx.BOTTOM],0,0,0),e[gx.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const t=e[gx.MIDDLE],i=this.convexHull;let r=0;for(let e=0;e<8;++e)r=Math.max(r,mT((0,hh.a)(t),i,3*e));e[gx.MIDDLE][3]=Math.sqrt(r)}}_calculateFrustumVisibility(e){if(!(0,Af.hr)(e,this._boundingSphere))return sx.OUTSIDE;if(this.lij[0]<10)return sx.INTERSECTS;const t=this.convexHull,i=this.surface.view.state.camera.near;let r=!0;for(let n=0;n<Af.N9;n++){const s=n===Af.Nu.NEAR,o=e[n],a=o[0],l=o[1],c=o[2],u=o[3]-(s?i:0);let h=!1;for(let e=0;e<8;++e){const i=3*e;if(a*t[i]+l*t[i+1]+c*t[i+2]+u<0){if(h=!0,!r)break}else r=!1}if(!h)return sx.OUTSIDE}return r?sx.INSIDE:sx.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){Ex(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),tw.T9&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,t=(0,hh.a)(e),i=this.elevationBoundsMin,r=this.elevationBoundsMax,n=this.ellipsoid.radius,s=r;if(0===this.level)(0,hr.i)(t,0,0,0),e[3]=n+s;else{const s=this.extentInRadians,o=.5*(s[0]+s[2]),a=s[1],l=s[3];yT(vT,o,a,n),yT(bT,o,l,n),(0,hr.g)(t,vT,bT),(0,hr.h)(t,t,(n+.5*(i+r))/(0,hr.H)(t));const c=this.convexHull;let u=0;const h=(e,t)=>{const i=e[0]-c[3*t],r=e[1]-c[3*t+1],n=e[2]-c[3*t+2];return Math.sqrt(i*i+r*r+n*n)};for(let e=0;e<8;++e){const i=h(t,e);u=Math.max(u,i)}const d=u;e[3]=d+2}}_updateConvexHull(){const e=this.extentInRadians,t=this.ellipsoid.radius;if(0===this.level)return;const i=this.elevationBoundsMin,r=this.elevationBoundsMax,n=this._getPatchType(),s=this.surface.isWebMercator,o=s&&n===ow.tk.HAS_NORTH_POLE,a=s&&n===ow.tk.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,u=e[0],h=e[2],d=a?-c:e[1],p=o?c:e[3],f=.5*(u+h),m=i,g=t+(l?Math.min(0,m-1):m),y=(e,t,i)=>yT(e,t,i,g),_=(0,Pa.Ue)(),v=(0,Pa.Ue)(),b=(0,Pa.Ue)(),w=(0,Pa.Ue)();y(_,u,d),y(v,u,p),y(b,h,p),y(w,h,d);const x=(e,t)=>{for(let i=0;i<3;++i)this._convexHull[3*t+i]=e[i]};x(_,0),x(v,1),x(b,2),x(w,3);const T=r,C=t+(l?Math.max(0,T+1):T),S=(0,Pa.Ue)(),E=(0,Pa.Ue)(),M=(0,Pa.Ue)();yT(E,f,p,g),yT(M,f,d,g),(0,hr.g)(S,E,M),(0,hr.n)(S,S);const A=(0,Pa.Ue)(),R=(0,Pa.Ue)(),O=(e,t)=>{(0,hr.a)(R,e,t),(0,hr.n)(R,R);const i=-(0,hr.f)(e,A)/(0,hr.f)(R,A);(0,tw.Fp)(i>=0),(0,hr.h)(R,R,i),(0,hr.g)(e,e,R)};if(2**this.lij[0]>2*this.lij[1]){const e=M,t=(0,Pa.Ue)();(0,hr.e)(t,_T,e),(0,hr.n)(t,t),(0,hr.e)(A,e,t),(0,hr.n)(A,A),(0,tw.Fp)((0,tw.Wq)((0,hr.f)(A,e)/(0,hr.H)(e),0)),O(_,v),O(w,b),x(_,0),x(w,3)}else if(2**this.lij[0]!==2*this.lij[1]){const e=E,t=(0,Pa.Ue)();(0,hr.e)(t,_T,e),(0,hr.n)(t,t),(0,hr.e)(A,t,e),(0,hr.n)(A,A),O(v,_),O(b,w),x(v,1),x(b,2)}const P=(e,t)=>{const i=C/(0,hr.f)(t,S);for(let r=0;r<3;++r)this._convexHull[3*e+r]=t[r]*i};P(4,_),P(5,v),P(6,b),P(7,w)}_getPatchType(){const e=this.lij[1],t=0===e,i=e===(1<<this.level)-1;return t?i?ow.tk.HAS_BOTH_POLES:ow.tk.HAS_NORTH_POLE:i?ow.tk.HAS_SOUTH_POLE:ow.tk.REGULAR}intersectsRay(e,t,i,r){const n=this._boundingSphere,s=n[3]+i,o=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],a=n[0]-e[0],l=n[1]-e[1],c=n[2]-e[2],u=(a*t[0]+l*t[1]+c*t[2])/o,h=t[0]*u-a,d=t[1]*u-l,p=t[2]*u-c;return h*h+d*d+p*p<s*s}get minimumVerticesPerSide(){return this.level<fT.length?fT[this.level]+1:2}updateCornerElevations(){(function(e){e.tile.intersectsClippingArea&&(Rx(e),Ax(e,!0),Zx(e),e.intersectionData=null)})(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){(function(e){e.tile.intersectsClippingArea&&(Mx(e),Zx(e),e.intersectionData=null)})(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){(function(e){e.tile.intersectsClippingArea&&(Vx(e),Mx(e),Zx(e),qx(e),e.intersectionData=null)})(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!tw.T9)return;if(this.level<=2)return;const e=this._boundingSphere,t=e[3],i=(0,hh.a)(e),r=(0,Pa.Ue)(),n=this.ellipsoid.radius,s=this.elevationBoundsMin,o=this.elevationBoundsMax,a=n+s,l=this._center[gx.MIDDLE][3],c=this.convexHull,u=(e,t)=>{for(let i=0;i<3;++i)e[i]=c[3*t+i]};{const e=(0,Pa.Ue)(),t=(0,Pa.Ue)(),i=(0,Pa.Ue)(),r=(0,Pa.Ue)(),n=(0,Pa.Ue)(),s=(s,o,a,l)=>{u(t,s),u(i,o),u(r,a),(0,hr.a)(t,t,i),(0,hr.a)(r,r,i),(0,hr.e)(e,t,r),(0,hr.n)(e,e);const c=(0,hr.f)(e,i);u(n,l);const h=(0,hr.f)(e,n),d=Math.abs(h-c);(0,tw.Fp)((0,tw.Wq)(d,0),`Non coplanar ${s},${o},${a},${l} diff = ${d}`)};s(0,1,2,3),s(4,5,6,7),s(0,1,4,5),s(1,2,5,6),s(2,3,6,7),s(3,0,7,4)}const h=(0,dT.bg)(24),d=(0,Pa.Ue)(),p=(0,Pa.Ue)(),f=(0,Pa.Ue)(),m=(0,Pa.Ue)(),g=(e,t,i,r)=>{u(d,t),u(p,i),u(f,r),(0,hr.a)(d,d,p),(0,hr.n)(d,d),(0,hr.a)(f,f,p),(0,hr.n)(f,f),(0,hr.e)(m,d,f),(0,hr.n)(m,m);const n=(0,hr.f)(m,p);((e,t,i)=>{const r=4*e;for(let e=0;e<3;++e)h[r+e]=t[e];h[r+3]=i})(e,m,n)};g(0,0,1,2),g(1,1,0,4),g(2,1,5,2),g(3,3,2,6),g(4,4,0,3),g(5,4,6,5);const y=(e,t,i,r)=>{const n=4*e;return h[n]*t+h[n+1]*i+h[n+2]*r-h[n+3]},_=(e,t,i,r)=>y(e,t,i,r)>=-1,v=(e,t)=>_(e,t[0],t[1],t[2]),b=2**this.lij[0]>2*this.lij[1],w=(e,r,n)=>Math.sqrt(gT(e,r,n,i[0],i[1],i[2]))<t,x=e=>w(e[0],e[1],e[2]),T=(e,t)=>w(e[t],e[t+1],e[t+2]),C=this.extentInRadians,S=.5*(C[0]+C[2]),E=C[1],M=C[3],A=(0,Pa.Ue)(),R=(0,Pa.Ue)();yT(A,S,M,a),yT(R,S,E,a);const O=b?"Upper":"Lower";let P=!0;for(let e=0;e<6;++e){for(let t=0;t<8;++t){const i=3*t,r=_(e,c[i],c[i+1],c[i+2]);P&&=r,(0,tw.Fp)(r,`Tile[${this.lij}] Convex hull point ${t} outside of plane ${e}`)}(0,tw.Fp)(v(e,R),`Tile[${this.lij}] (${O}) bottom mid outside of plane ${e}`),(0,tw.Fp)(v(e,A),`Tile[${this.lij}] (${O}) top mid outside of plane ${e}`)}(0,tw.Fp)(P,"Not all convex hull points are inside  convex hull polyhedron"),(0,tw.Fp)(x(R),`Tile[${this.lij}] (${O}) bottom mid outside of bounding sphere`),(0,tw.Fp)(x(A),`Tile[${this.lij}] (${O}) top mid outside of bounding sphere`);for(let e=0;e<8;++e){const t=T(c,3*e);(0,tw.Fp)(t,`Tile[${this.lij}] Convex hull point ${e} outside of bounding sphere`)}for(let e=0;e<6;++e)for(let t=0;t<8;++t){const i=3*t;_(e,c[i],c[i+1],c[i+2])||console.error(`Tile[${this.lij}] Convex hull point ${t} outside of plane ${e}`)}const{extentInRadians:I}=this,L=Math.max(I[2]-I[0],I[3]-I[1]),D=Math.round(L*n),{renderData:N}=this;if(!N)return;const{geometry:F,geometryState:U,localOrigin:k}=N,z=F.vertexAttributes?.position;if(!z)return;const B=(0,Pa.Ue)(),V=F.numVerticesPerSide-2,{indices:H,indexCount:G,edgeVerticesStartIndex:j,poleVerticesStartIndex:Z}=F;if(!H)return;const q=new Set;for(let e=0;e<G;++e){const a=H[e];if(q.has(a))continue;q.add(a);const c=a<Z,u=a>=j;let h=!1,d=-1;if(u){let e=j;for(let t=0;t<4;++t){const i=U.edgeResolutions[t];if(a===e||a===e+i-1){h=!0;break}if(e+=i,a<e){d=t;break}}}const p=u?U.edgePeerNeighbors[d]:null,f=u&&p&&(0,Iw.gl)(this,p)>0;z.getVec(a,r),(0,hr.g)(B,r,k);const m=(0,hr.H)(B)-n;let g=0,v=!1;const b=s-m,w=m-o,x=b>1,T=w>1,C=x||T,S=()=>{const e=c?"internal":u&&!h?"edge":h?"corner":"pole";return`Tile[${this.lij}].vertex[${a}]:${e}`+(x?"(below)":T?"(above)":"")+(f?"(Neighbor)":"")},E=(0,hr.G)(B,i);if(E>=t+0){const e=E-t;C||(console.error(`${S()} is out of the bounding sphere by ${e.toFixed(0)} / ${t.toFixed(0)}[tol=0] h=${m.toFixed(0)} / [${s.toFixed(0)}..${o.toFixed(0)}] (${(e/t).toFixed(0)})`),v=!0)}for(let e=0;e<6;++e)if(!_(e,B[0],B[1],B[2])){const i=y(e,B[0],B[1],B[2]),r=a%V,n=(a-r)/V;0===e&&b||5===e&&w||(console.error(`${S()} (${r},${n})|${V}] is out of the bounding trapezoid plane ${e} h=${Math.round(m)} / [${Math.round(s)}..${Math.round(o)}] dist=${Math.round(i)} radii = ${Math.round(t)}/${Math.round(l)}} : maxL = ${D}`),++g)}if(v||g>0)break}}get convexHull(){return this._convexHull}}const fT=[128,64,64,32,16,8,8,4];function mT(e,t,i){return gT(e[0],e[1],e[2],t[i],t[i+1],t[i+2])}function gT(e,t,i,r,n,s){const o=r-e,a=n-t,l=s-i;return o*o+a*a+l*l}const yT=(e,t,i,r)=>{const n=Math.cos(t),s=Math.sin(t),o=Math.cos(i),a=Math.sin(i);e[0]=r*o*n,e[1]=r*o*s,e[2]=r*a},_T=[0,0,1],vT=(0,Pa.Ue)(),bT=(0,Pa.Ue)();let wT=class extends P.Z{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};(0,i._)([(0,y.Cb)()],wT.prototype,"fovX",void 0),(0,i._)([(0,y.Cb)()],wT.prototype,"fovY",void 0),(0,i._)([(0,y.Cb)()],wT.prototype,"relativeWidthLimit",void 0),(0,i._)([(0,y.Cb)()],wT.prototype,"relativeHeightLimit",void 0),(0,i._)([(0,y.Cb)()],wT.prototype,"maxLod",void 0),(0,i._)([(0,y.Cb)()],wT.prototype,"angledSplitBias",void 0),(0,i._)([(0,y.Cb)()],wT.prototype,"aboveGround",void 0),(0,i._)([(0,y.Cb)()],wT.prototype,"frustum",void 0),wT=(0,i._)([(0,v.j)("esri.views.3d.terrain.SplitLimits")],wT);var xT=n(81936),TT=n(33401);const CT=(0,Ql.U$)().vec3f(Wl.T.POSITION).vec2i16(Wl.T.UV0).vec2i16(Wl.T.NORMALCOMPRESSED,{glNormalized:!0});class ST{constructor(e){this._storage=new jb(((t,i)=>e.newCache(t,i)),"TileGeometry")}acquire(e){const t=4*Math.ceil(e/4),i=this._storage,r=function(e){return e.toString()}(t),n=i.pop(r);if(n)return n;const s=CT.createBuffer(t);return s.release=()=>i.put(r,s),s}clear(){this._storage.clear()}destroy(){this._storage.destroy()}}var ET=n(73721),MT=n(33803);class AT extends ET.R{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Pa.AG}}class RT extends Al.A{constructor(e,t){super(e,t,new Ml.J(MT.B,(()=>n.e(59387).then(n.bind(n,59387)))))}}var OT=n(84342),PT=n(11069),IT=n(1563),LT=n(61741),DT=n(19390),NT=n(84099),FT=n(93712);const UT=(0,yi.Ue)();var kT=n(8556),zT=n(38779);class BT{constructor(){this._renderParams={reshuffleManager:new zT.y,context:null,drawPhase:1,state:new VT,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new kT.H(new Is.Z(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,t,i,r,n,s,o,a,l,c){const u=this._backgroundTile;this._updateRenderParameters(e,t,u,i,n,s,o,a,l,c),this._renderParams.stencilSymbols=!1,i.drawBackground(this._renderParams,u,r)}renderContent(e,t,i,r,n,s,o,a,l,c,u,h){this._declutter(i),r.forAll((({sourceLayerInfo:{data:e}})=>this._declutter(e)));const d=r.length>0;d&&this._stencilSymbols(e,t,i,r,n,s,o,a,l,c,u,h);let p=1;i.stencilRef=d?p:0,e.setStencilFunction(Rl.wb.EQUAL,i.stencilRef,255),this._render(e,t,i,n,s,o,a,l,c,u,h),r.forAll((({sourceLod:t,offset:i,sourceLayerInfo:{data:r}})=>{r.stencilRef=++p,this._renderSymbols(e,t,r,n,s,o,a,i,c,u,h)}))}_stencilSymbols(e,t,i,r,n,s,o,a,l,c,u,h){let d=1;i.stencilRef=d,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(Rl.xS.KEEP,Rl.xS.KEEP,Rl.xS.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Rl.wb.ALWAYS,i.stencilRef,255),this._stencilTileSymbols(e,t,i,n,s,o,a,l,c,u,h),r.forAll((({sourceLod:t,offset:i,sourceLayerInfo:{data:r}})=>{r.stencilRef=++d,e.setStencilFunction(Rl.wb.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,t,r,n,s,o,a,i,c,u,h)})),e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,t,i,r,n,s,o,a,l,c,u){e.setStencilFunction(Rl.wb.EQUAL,i.stencilRef,255),this._render(e,t,i,r,n,s,o,a,l,c,u,FT.fR.SYMBOL)}_render(e,t,i,r,n,s,o,a,l,c,u,h){this._updateRenderParameters(e,t,i,r,s,o,a,l,c,u),this._renderParams.stencilSymbols=!1,r.drawTile(this._renderParams,i,n,h)}_stencilTileSymbols(e,t,i,r,n,s,o,a,l,c,u){this._updateRenderParameters(e,t,i,r,s,o,a,l,c,u),this._renderParams.stencilSymbols=!0,i.triangleCount=0,r.drawSymbols(this._renderParams,i,n)}_updateRenderParameters(e,t,i,r,n,s,o,a,l,c){"type"in i&&"vector-tile"===i.type&&!i.stage&&i.attachWithContext(e);const u=t[0]-n.getLevelShift(t[0]),h=this._renderParams;h.context=e,h.painter=r,h.glyphMosaic=r.glyphMosaic,h.spriteMosaic=r.spriteMosaic,h.pixelRatio=l*c,h.displayLevel=u,h.requiredLevel=u;const d=n.getScale(t[0]),[p,f]=n.getOffset(t,s*d),m=.125*s*d/a,g=i.transforms.displayViewScreenMat3;g[0]=m,g[4]=-m,g[6]=-1-p-o[0]*s*2,g[7]=1+f+(1-o[1])*s*2-2;const y=h.state,_=a/c;y.size[0]=_,y.size[1]=_,y.pixelRatio=c,y.rotation=(360-this._heading)%360;const v=2/_;(0,gi.t8)(y.displayViewMat3,v,0,0,0,-v,0,-1,1,1);const b=(0,gi.yR)(y.displayMat3),w=(0,di.c$)(this._heading);(0,gi.Iu)(b,b,[_/2,_/2]),(0,gi.U1)(b,b,w),(0,gi.Iu)(b,b,[-_/2,-_/2]),(0,gi.Jp)(b,y.displayViewMat3,b)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(function(e,t){const i=e.transforms.tileUnitsToPixels,r=(0,di.c$)(t),n=Math.cos(r),s=Math.sin(r),o=Math.ceil(512*(Math.abs(s)+Math.abs(n)));(0,gi.yR)(UT),(0,gi.Iu)(UT,UT,[o/2,o/2]),(0,gi.U1)(UT,UT,r),(0,gi.Iu)(UT,UT,[-256,-256]),(0,gi.bA)(UT,UT,[1/8,1/8,1]),e.transforms.tileUnitsToPixels=UT;const a=[],l=new DT.L(4096,a,(()=>new PT.J)),c=new LT.g(a,l,((i,r,n)=>new IT.f(i,r,n,e.styleRepository,e.key.level,t)),((e,t)=>{(0,NT.C$)(e,t,!1)}),(()=>0),(t=>{const i=e.styleRepository.getStyleLayerByUID(t).getLayoutProperty("visibility");return!i||i.getValue()!==FT.EE.NONE}));a.push(e),l.add(e),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(e),e.transforms.tileUnitsToPixels=i}(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}}class VT{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=(0,td.Ue)(),this.displayViewMat3=(0,td.Ue)(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}}var HT=n(23998),GT=n(12907);class jT extends GT.m{constructor(){super(...arguments),this.blendMode=HT.iM.Normal}}(0,i._)([(0,GT.o)({count:HT.iM.COUNT})],jT.prototype,"blendMode",void 0);var ZT=n(66818),qT=n(91238),WT=n(58343);class $T extends jT{constructor(){super(...arguments),this.output=qT.l.Composite,this.baseOpacityMode=ZT.I.NotRequired,this.premultipliedSource=WT.m.Off}}(0,i._)([(0,GT.o)({count:qT.l.COUNT})],$T.prototype,"output",void 0),(0,i._)([(0,GT.o)({count:ZT.I.COUNT})],$T.prototype,"baseOpacityMode",void 0),(0,i._)([(0,GT.o)({count:WT.m.COUNT})],$T.prototype,"premultipliedSource",void 0);class YT extends $T{constructor(){super(...arguments),this.background=MT.a.BelowLayer}}(0,i._)([(0,GT.o)({count:MT.a.COUNT})],YT.prototype,"background",void 0);var JT=n(28624);class XT extends Al.A{constructor(e,t){super(e,t,new Ml.J(JT.R,(()=>n.e(36145).then(n.bind(n,36145)))))}}class KT extends $T{constructor(){super(...arguments),this.colorizerType=OT.U.Stretch,this.stretchType=OT.H.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}}(0,i._)([(0,GT.o)({count:OT.U.COUNT})],KT.prototype,"colorizerType",void 0),(0,i._)([(0,GT.o)({count:OT.H.COUNT})],KT.prototype,"stretchType",void 0),(0,i._)([(0,GT.o)()],KT.prototype,"applyColormap",void 0),(0,i._)([(0,GT.o)()],KT.prototype,"requireBilinearWithNN",void 0);var QT=n(56109);class eC{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach((e=>e.dispose())),this._fbos.clear()}_getPool(e){const t=this._fbos.get(e);if(t)return t;const i=new Fl.X(this._rctx,new Ul.X(e),new QT.Y(Rl.Tg.DEPTH24_STENCIL8,e));return this._fbos.set(e,i),i}}var tC=n(85211),iC=n(62039),rC=n(43487);class nC{constructor(e,t){this._rctx=e,this._techniques=t,this._fbos=[],this._vectorTileHelper=new BT,this._bindParameters=new tC.p(null),this._blendLayersTechniqueConfig=new YT,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=(0,iC.ow)(this._rctx,iC.Ar.Pos2Tex)}dispose(){this._fbos.forEach(m.M2),this._fbos=null,this._vtFBO=(0,m.M2)(this._vtFBO),this._vaoQuad=(0,m.M2)(this._vaoQuad),this._vectorTileHelper=(0,m.M2)(this._vectorTileHelper)}updateHeading(e){this._vectorTileHelper?.updateHeading(e)}_acquireBlendLayersTechnique(e,t,i,r=WT.m.Off,n=MT.a.BelowLayer){return this._blendLayersTechniqueConfig.output=t,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=r,this._blendLayersTechniqueConfig.background=n,this._techniques.precompile(RT,this._blendLayersTechniqueConfig),this._techniques.get(RT,this._blendLayersTechniqueConfig)}drawBackground(e,t){const i=this._acquireBlendLayersTechnique(HT.iM.Normal,t?qT.l.ColorComposite:qT.l.GridComposite,ZT.I.NotRequired,WT.m.Off,MT.a.Only),r=this._rctx.bindTechnique(i,this._bindParameters,e);this._render(r)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Rl.MX.TRIANGLE_STRIP,0,(0,nc._V)(this._vaoQuad,"geometry"))}drawGroup(e,t,i,r,n=WT.m.On){t===qT.l.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const s=e.baseOpacity<1?ZT.I.Required:ZT.I.NotRequired,o=this._acquireBlendLayersTechnique(r,t,s,n),a=this._rctx.bindTechnique(o,this._bindParameters,e);this._render(a)}drawImageData(e,t,i,r,n=WT.m.Off){if(null==e.texture)return;const s=e.baseOpacity<1?ZT.I.Required:ZT.I.NotRequired;e.fboTexture=t===qT.l.GroupBackgroundComposite||r===HT.iM.Normal&&s===ZT.I.NotRequired&&n===WT.m.Off?null:this.switch(i).colorTexture;const o=this._acquireBlendLayersTechnique(r,t,s,n),a=this._rctx.bindTechnique(o,this._bindParameters,e);this._render(a)}drawRasterData(e,t,i,r,n){const s=n.sourceLayerInfo.data;if(!s.source)return;if(n.tile.surface.layerViewByIndex(n.layerIndex,yv.MAP).ensureSymbolizerParameters(s),!s.bind(this._rctx))return;const o=e.baseOpacity<1?ZT.I.Required:ZT.I.NotRequired;e.fboTexture=r===HT.iM.Normal&&o===ZT.I.NotRequired?null:this.switch(i).colorTexture;const a=this._acquireRasterColorizerTechnique(s,t,r,o);s.opacity=e.opacity;const l=s.getUniforms();l.scale=n.scale,l.offset=n.offset,l.backgroundColor=e.backgroundColor,l.fboTexture=e.fboTexture,l.baseOpacity=e.baseOpacity;const c=this._rctx.bindTechnique(a,this._bindParameters,l);this._render(c)}_acquireRasterColorizerTechnique(e,t,i,r){const n=e.symbolizerParameters,s=["stretch","lut","hillshade"].indexOf(n.type);return null==this._rasterColorizerConfig&&(this._rasterColorizerConfig=new KT,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=t,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=r,this._rasterColorizerConfig.colorizerType=s,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?OT.H.Noop:OT.H.PerBand,this._techniques.precompile(XT,this._rasterColorizerConfig),this._techniques.get(XT,this._rasterColorizerConfig)}drawVectorData(e,t,i,r,n,s,o,a){const l=this._rctx,c=n.sourceLayerInfo.data,u=n.tile.surface.layerViewByIndex(n.layerIndex,yv.MAP),h=e.baseOpacity<1?ZT.I.Required:ZT.I.NotRequired,d=h===ZT.I.Required||e.opacity<1||r!==HT.iM.Normal||t!==qT.l.Composite,p=d?WT.m.On:WT.m.Off,m=this._acquireBlendLayersTechnique(r,t,h,p);l.setPipelineState(m.getPipeline());let g=null,y=null;d?(y=this.currentFBO(i),null==this._vtFBO&&(this._vtFBO=new eC(this._rctx)),g=this._vtFBO.get(i),l.bindFramebuffer(g),this._clearCurrentFBO()):a&&l.clear(Rl.Hf.DEPTH);try{this._vectorTileHelper.renderBackground(l,n.sourceLod,u.painter,u.layer.styleRepository,u.schemaHelper,Math.round(1/n.scale),n.offset,o,s,u.contentZoom),c&&this._vectorTileHelper.renderContent(l,n.sourceLod,c,n.vtlNeighborInfos,u.painter,u.layer.styleRepository,u.schemaHelper,Math.round(1/n.scale),n.offset,o,s,u.contentZoom)}catch(e){f.Z.getLogger("esri.views.3d.terrain").warnOnce("A render call containing vector tiles did not resolve correctly.",e)}return!g||(l.bindFramebuffer(y),e.texture=g.colorTexture,e.offset=ui.AG,e.scale=1,this.drawImageData(e,t,i,r,p),a)}copyFBOToTexture(e){const t=this._rctx,i=t.bindTexture(e.texture,rC.x.TEXTURE_UNIT_FOR_UPDATES),r=e.descriptor;t.gl.copyTexImage2D(Rl.No.TEXTURE_2D,0,r.pixelFormat,0,0,r.width,r.height,0),e.generateMipmap(),t.bindTexture(i,rC.x.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(Rl.Hf.COLOR|Rl.Hf.DEPTH|Rl.Hf.STENCIL)}_initFBO(e,t,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,t,t),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,t=0,i=!0){if(this._current=t,t>=this._fbos.length)for(let e=this._fbos.length;e<=t;e++)this._fbos.push(new eC(this._rctx));this._initFBO(this._fbos[t].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const t=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),t}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const t=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(t),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}}class sC{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}}var oC=n(85289);class aC{constructor(e,t){this._texture=e,this._cache=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,0===this._refCount&&(this._cache?(this._texture.isCompressing&&this._texture.abortCompression(),this._cache.put(this._generateCacheKey(),this)):this.dispose())}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}_generateCacheKey(){return`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`+((0,oC.p6)(this._texture)?"compressed":"")}get descriptor(){return this._texture.descriptor}get cachedMemory(){return this._texture.usedMemory}}var lC=n(12916);function cC(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement}class uC extends lC.q{constructor(e){super("TextureCompressionWorker","compress",{compress:e=>[e.data]},e)}isCompressible(e){return cC(e)}}class hC{constructor(e,t,i,r,n,s){this.start=e,this.end=t,this.blendMode=i,this.opacity=r,this.output=n,this.baseOpacity=s}}let dC=class extends P.Z{constructor(e){super(e),this._passParameters=new AT,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1}initialize(){this._maxAnisotropy=this.rctx.parameters.maxMaxAnisotropy,this._compositor=new nC(this.rctx,this.techniques),this._ensureBackgroundTexture(this.tileSize),this.texturesBeingCompressed=0}dispose(){this._compositor=(0,m.M2)(this._compositor),this._backgroundTexture=(0,m.RY)(this._backgroundTexture)}get backgroundIsGrid(){return null==this._backgroundColor}get backgroundColor(){return this._backgroundColor}updateHeading(e){this._compositor?.updateHeading(e)}updateTileTexture(e,t){if(!e.renderData)return;const i=e.surface,r=i.baseOpacity;let n=0,s=0,o=this.tileSize,a=!1,l=!1;const c=i.view.state.contentPixelRatio;let u=!1;yC.clear(),_C.length=0;const h=e.layerInfo[yv.MAP];let d=0,p=null;for(;d<h.length;d++){const t=i.layerViewByIndex(d,yv.MAP),f=t.layer,m=!(0,Iw.W4)(e,t),g=f.opacity,y=t.fullOpacity;if(l=l||(0,z.sy)(f),(0,tw.TK)(t)){let e="normal"!==t.layer.blendMode;if((0,z.CY)(f.parent)){const t=f.parent.uid;null!=t&&""!==t&&(e=mC(f.parent)||e)}e&&(u=e,a=!1)}if((m||0===g)&&!u){h[d].pendingUpdates&=~(cx.TEXTURE_NOFADING&cx.TEXTURE_FADING);continue}++s;const _=(0,tw.Q)(t),v=pC(e,d,_);if(v){if(h[d].pendingUpdates&=~(cx.TEXTURE_NOFADING&cx.TEXTURE_FADING),(0,z.CY)(f.parent)){const e=f.parent.uid;null!=e&&""!==e&&gC(f.parent,d)}_?o=Math.max(o,this.tileSize*c):1===r&&1===y&&(t.isOpaque||this._dataToTexture(v)&&v.sourceLayerInfo.data.descriptor.isOpaque)&&(a=!0),++n,null===p&&(p=d)}}const f=o/this.tileSize,m=this._ensureBackgroundTexture(this.tileSize);0!==n&&null!==p?1===n&&!u&&this._useLayerTexture(e,p)||this._composeLayers(e,t,d-1,l,o,f,!a||u,yC,u):function(e,t,i,r){const n=e.renderData,s=!r&&null!=n.textureReference&&(e.surface.view.layerViewManager.updating||t>0)?Rw.Delayed:Rw.Immediate;n.setTextureReference(new Ow(i,ow.Ns.FADING,bC,e.surface.baseOpacity,0,1),s)}(e,s,m,t!==ow.Ns.FADING)}_ensureBackgroundTexture(e){return null==this._backgroundTexture&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=ui.AG,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,null!=this.backgroundColor),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,t){const i=e.surface.layerViewByIndex(t,yv.MAP),r=(0,z.sy)(i.layer),n=r?e.surface.baseOpacity:1,s=r?1:e.surface.baseOpacity,o=i.fullOpacity,a=pC(e,t,!1);return!!this._dataToTexture(a)&&(e.renderData.setTextureReference(new Ow(a.sourceLayerInfo.data,ow.Ns.FADING,(0,rf.al)(a.offset[0],a.offset[1],a.scale,a.scale),n,s,o)),!0)}_composeLayers(e,t,i,r,n,s,o,a,l){this._compositor.ensureBuffer(n);const c=e.surface.baseOpacity;let u=!1,h=Rl.cw.LINEAR_MIPMAP_LINEAR,d=!1,p=0;for(let t=i;t>=0;t--){const i=e.surface.layerViewByIndex(t,yv.MAP),f=i.layer,m=(0,tw.Q)(i),g=pC(e,t,m),y=f.opacity,_=!(0,Iw.W4)(e,i);if(!g||(0===y||_)&&!l)continue;const v=!(0,z.sy)(f)&&!u;v&&(u=!0);let b=!1;a.forEach((e=>{e.start===t&&(e.output=r?qT.l.Composite:o&&v?this.backgroundIsGrid?qT.l.GridComposite:qT.l.ColorComposite:qT.l.Composite,e.baseOpacity=v?c:1,_C.push(e),this._compositor.openGroup(n),b=!0)}));const w=0===p,x=b?qT.l.GroupBackgroundComposite:o&&w?this.backgroundIsGrid?qT.l.GridComposite:qT.l.ColorComposite:qT.l.Composite,T=HT.pU[(0,tw.TK)(i)?i.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=v&&!b&&c<1?c:1,this._passParameters.opacity=y,(0,tw.Ke)(g)?d=this._compositor.drawVectorData(this._passParameters,x,n,T,g,s,this.tileSize,d):(0,tw.Ay)(g)?(this._compositor.drawRasterData(this._passParameters,x,n,T,g),fC(g)&&(h=Rl.cw.NEAREST)):this._dataToTexture(g)&&(this._passParameters.texture=g.sourceLayerInfo.data.texture,this._passParameters.offset=g.offset,this._passParameters.scale=g.scale,this._compositor.drawImageData(this._passParameters,x,n,T));_C.length>0&&_C[_C.length-1].end===t;){const e=_C.pop();this._passParameters.baseOpacity=e.baseOpacity,this._passParameters.opacity=e.opacity,this._passParameters.offset=ui.AG,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,e.output,n,HT.pU[e.blendMode])}p++}const f=e.renderData,m=l||u&&c<1,g=f.ensureTexture(n,m,t,(()=>this._buildTexture(n,m,h)));this._compositor.copyFBOToTexture(g),this._compositor.unbind(),f.setTextureReference(new Ow(g,t,bC,u?1:c,0,1))}_dataToTexture(e){if((0,tw.S3)(e)){const t=e.sourceLayerInfo,i=1===e.scale;t.data=this._buildTexture(t.data,!0,i),e.tile.setMemoryDirty()}return(0,tw.z7)(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,t,i=Rl.cw.LINEAR_MIPMAP_LINEAR){if(null==e)return null;const r=new Ul.X;r.wrapMode=Rl.e8.CLAMP_TO_EDGE,r.samplingMode="boolean"==typeof i?Rl.cw.LINEAR_MIPMAP_LINEAR:i,r.maxAnisotropy=this._maxAnisotropy,r.preMultiplyAlpha=!0,r.flipped=!0,r.hasMipmap=!0,t||(r.pixelFormat=Rl.VI.RGB);const n=this.rctx,s="boolean"==typeof i&&i;let o;if("number"==typeof e)r.width=r.height=e,o=this._buildTileTexture(r,e);else if((0,zv.Cm)(e))r.isOpaque=e.isOpaque,r.isOpaque&&(r.pixelFormat=Rl.VI.RGB),o=this._buildTileTexture(r,e.element.width,s,e.element);else try{r.width=e.width,r.height=e.height,o=this._buildTileTexture(r,e.width,s,e)}catch(e){o=new aC((0,iC.l_)(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=n.bindTexture(o.texture,rC.x.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),n.bindTexture(a,rC.x.TEXTURE_UNIT_FOR_UPDATES),o}_buildTileTexture(e,t,i=!1,r){const n=`${t} ${e.pixelFormat}`,s=this.cache.pop(n)??this.cache.pop(n+"compressed");if(i&&=cC(r),s)return s.retain(),i&&s.texture.enableCompression(!0),s.texture.setData(r),s;e.shouldCompress=i;const o=new rC.x(this.rctx,e,r);return o.isCompressing&&(this.texturesBeingCompressed++,this.addHandles([(0,F.watch)((()=>o.isCompressing),(e=>{e?this.texturesBeingCompressed++:this.texturesBeingCompressed--}),F.sync)])),new aC(o,this.cache)}get test(){}};function pC(e,t,i){vC.layerIndex=t,vC.vtlNeighborInfos.clear();const r=e.layerInfo[yv.MAP][t];if((0,ci.t8)(vC.offset,0,0),vC.tile=e,vC.scale=1,vC.sourceLod=e.lij,vC.sourceLayerInfo=r,vC.isVTLBackground=i,r.data)return i&&e.forEachLoadedNeighbor(((i,n)=>{if(i.level!==e.level)return;const s=i.layerInfo[yv.MAP][t];if(!(0,tw.B9)(s)||r.data===s.data)return;const o=vC.vtlNeighborInfos.pushNew();o.offset=wC[n],o.sourceLod=i.lij,o.sourceLayerInfo=s})),vC;const n=r.upsampleInfo,s=n?.tile?.layerInfo[yv.MAP][t];return s&&n.tile?(vC.tile=n.tile,(0,ci.JG)(vC.offset,n.offset),vC.scale=n.scale,vC.sourceLod=n.tile.lij,vC.sourceLayerInfo=s,vC):i?vC:null}function fC(e){const t=e.sourceLayerInfo.data;return!!t.source&&"nearest"===t.interpolation}function mC(e){let t="normal"!==e.blendMode;return(0,z.CY)(e.parent)&&(t=mC(e.parent)||t),t}function gC(e,t){(0,z.CY)(e.parent)&&gC(e.parent,t);const i=e.uid;if(null!=i&&""!==i){const r=yC.get(i);r?r.start=t:yC.set(i,new hC(t,t,e.blendMode,e.opacity,qT.l.Composite,1))}}(0,i._)([(0,y.Cb)({constructOnly:!0})],dC.prototype,"rctx",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],dC.prototype,"techniques",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],dC.prototype,"cache",void 0),(0,i._)([(0,y.Cb)()],dC.prototype,"tileSize",void 0),(0,i._)([(0,y.Cb)()],dC.prototype,"texturesBeingCompressed",void 0),dC=(0,i._)([(0,v.j)("esri.views.3d.terrain.TileRenderer")],dC);const yC=new Map,_C=new Array,vC=new class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Pg.Z({allocator:e=>e||new sC})}},bC=(0,rf.al)(0,0,1,1),wC=new Array;wC[Tw.X.NORTH]=[0,-1],wC[Tw.X.NORTH_EAST]=[-1,-1],wC[Tw.X.EAST]=[-1,0],wC[Tw.X.SOUTH_EAST]=[-1,1],wC[Tw.X.SOUTH]=[0,1],wC[Tw.X.SOUTH_WEST]=[1,1],wC[Tw.X.WEST]=[1,0],wC[Tw.X.NORTH_WEST]=[1,-1];var xC=n(51428);const TC=1e-6;class CC{constructor(e,t,i,r,n){this.aabb=e,this.axis=t,this.d=i,this.midStartIndex=r,this.rightStartIndex=n}}class SC{constructor(e,t,i,r){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=t,this.positions=r,this._rayDirection=(0,Pa.Ue)(),this._callback=PC,this._intersectionOptions=OC,this.bspNodeTree=new Array;const n=i-t,s=new(n<AC?Uint8Array:n<RC?Uint16Array:Uint32Array)(n);this.triangleIndexMap=s;for(let e=0;e<n;++e)s[e]=e;{const o=function(e,t,i,r,n){const s=i-t,o=new Float32Array(6*s);for(let i=0;i<s;++i){const s=3*(i+t),a=e[s]*n,l=e[s+1]*n,c=e[s+2]*n;for(let e=0;e<3;++e){const t=r[a+e],n=r[l+e],s=r[c+e];o[6*i+e]=Math.min(t,n,s),o[6*i+3+e]=Math.max(t,n,s)}}return o}(e,t,i,r.data,r.stride),a=(0,yt.uZ)(Math.log2(n/40),2,10),l=(e,t,i)=>{const r=function(e,t,i,r){if(r<=i)return(0,Mf.al)(NaN,NaN,NaN,NaN,NaN,NaN);{const r=6*e[i];for(let e=0;e<3;++e)EC[e]=t[r+0+e],MC[e]=t[r+3+e]}for(let n=i+1;n<r;++n){const i=6*e[n];for(let e=0;e<3;++e)EC[e]=Math.min(EC[e],t[i+0+e]),MC[e]=Math.max(MC[e],t[i+3+e])}return(0,Mf.al)(EC[0],EC[1],EC[2],MC[0],MC[1],MC[2])}(s,o,e,t),n=t-e;if(n<=40){const i=new CC(r,void 0,0,e,t);return this.bspNodeTree.push(i),i}const{axis:c,midValue:u}=function(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],n=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:n,midValue:(e[n]+e[n+3])/2}}(r),h=function(e,t,i,r,n,s){let o=i,a=r;for(;o<a;){const i=e[o];t[6*i+n+3]<=s?++o:(--a,e[o]=e[a],e[a]=i)}let l=o;for(a=r;l<a;){const i=e[a-1];t[6*i+n]>=s?--a:(e[a-1]=e[l],e[l]=i,++l)}return{next:o,mid:l}}(s,o,e,t,c,u),d=(e,t)=>{if(i>a)return;const r=t-e;return r<40||r>=.8*n?void 0:l(e,t,i+1)},p=new CC(r,c,u,h.next,h.mid);return this.bspNodeTree.push(p),p.leftNode=d(e,h.next),p.rightNode=d(h.mid,t),p};l(0,n,0)}}intersectRayTriangleRange(e,t){if(e>=t)return;const i=this.positions;(0,oT.ET)(this._rayFrom,this._rayDirection,e,t,this.globalTriangleVertexIndices,i.data,i.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),SC.numFacesTested+=t-e}intersectRay(e,t,i,r){SC.numFacesTested=0;const n=e,s=t,o=s[0]-n[0],a=s[1]-n[1],l=s[2]-n[2];if(o*o+a*a+l*l<TC)return;this._rayFrom=n;const c=this._rayDirection;c[0]=o,c[1]=a,c[2]=l;const u=this.triangleIndexMap.length;this._callback=r,this._intersectionOptions=i,this.intersectRayBSP(this.bspNodeTree[0],0,u),this._callback=PC,this._intersectionOptions=OC}intersectRayBSP(e,t,i){const r=this._rayFrom,n=this._rayDirection;if(!function(e,t,i){const r=t,n=i;let s=0,o=1/0;for(let t=0;t<3;++t){{const i=e[t];if(r[t]<i){if(n[t]<=TC)return!1;const e=(i-r[t])/n[t];s=Math.max(s,e)}else if(n[t]<=-1e-6){const e=(i-r[t])/n[t];o=Math.min(o,e)}if(s>o)return!1}{const i=e[t+3];if(r[t]>i){if(n[t]>=-1e-6)return!1;const e=(i-r[t])/n[t];s=Math.max(s,e)}else if(n[t]>=TC){const e=(i-r[t])/n[t];o=Math.min(o,e)}if(s>o)return!1}}return!0}(e.aabb,r,n))return;const s=e.axis,o=e.d;if(r[s]<o||n[s]<0){const i=t,r=e.midStartIndex;if(i<r){const t=e.leftNode;void 0!==t?this.intersectRayBSP(t,i,r):this.intersectRayTriangleRange(i,r)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),r[s]>o||n[s]>0){const t=e.rightStartIndex,r=i;if(t<r){const i=e.rightNode;void 0!==i?this.intersectRayBSP(i,t,r):this.intersectRayTriangleRange(t,r)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}}SC.numFacesTested=0;const EC=[1/0,1/0,1/0],MC=[-1/0,-1/0,-1/0];const AC=255,RC=65535,OC=new oT.sT,PC=()=>{};var IC=n(52191),LC=n(85799),DC=n(7358),NC=n(46378),FC=n(22456),UC=n(7792),kC=n(82082),zC=n(3864),BC=n(97582),VC=n(22957);class HC extends VC.W{constructor(e){super(),this.spherical=e,this.overlayMode=BC.gT.Disabled,this.tileBlendInput=IC.R.LayerOnly,this.transparencyMode=xC.w.Opaque,this.pbrMode=zC.f7.Simplified,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.screenSpaceReflections=!1,this.cloudReflections=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.normalType=UC.r.Compressed,this.textureCoordinateType=kC.I.Compressed,this.highStepCount=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!1,this.hasColorTexture=!0,this.canHaveOverlay=!0}}(0,i._)([(0,GT.o)({count:BC.gT.COUNT})],HC.prototype,"overlayMode",void 0),(0,i._)([(0,GT.o)({count:IC.R.COUNT})],HC.prototype,"tileBlendInput",void 0),(0,i._)([(0,GT.o)({count:xC.w.COUNT})],HC.prototype,"transparencyMode",void 0),(0,i._)([(0,GT.o)({count:zC.f7.COUNT})],HC.prototype,"pbrMode",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"receiveShadows",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"backfaceCullingEnabled",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"textureFadingEnabled",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"renderOccluded",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"screenSpaceReflections",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"cloudReflections",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"tileBorders",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"visualizeNormals",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"screenSizePerspective",void 0),(0,i._)([(0,GT.o)()],HC.prototype,"receiveAmbientOcclusion",void 0);const GC=(0,Mf.Ue)();let jC=class extends uc.tY{get _isGlobal(){return this._stage.viewingMode===$t.JY.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,t,i,r,n){super({}),this._overlayRenderer=e,this._stage=t,this._allTiles=i,this._ellipsoidRadius=r,this.type=Zg.q7.TERRAIN,this.isGround=!0,this._passParameters=new Nw.T,this._drawParameters=new FC.w,this._renderDataPool=new qb.Z(kw),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new Iw.AA,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=DC.yD.Occlude,this.produces=new Map([[NC.r.OPAQUE_TERRAIN,()=>this._produces()&&this.transparency===xC.w.Opaque],[NC.r.TRANSPARENT_TERRAIN,()=>this._produces()&&(this.transparency===xC.w.Transparent||this.transparency===xC.w.InvisibleWithDraped)],[NC.r.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileSize=256,this._configuration=new HC(t.viewingMode===$t.JY.Global),this._tileTextureCache=new jb(((e,t)=>n.newCache(e,t)),"TileTexture"),this.tileGeometryCache=new ST(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles((0,F.watch)((()=>this._overlayRenderer.rendersOccludedDraped),(e=>{this.renderOccludedFlags=e?aw.Qi:DC.yD.Occlude,this.setNeedsRender()}),F.sync))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?uc.of:uc.jt}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){this._tileRenderer?.updateHeading(e)}set transparency(e){this._configuration.transparencyMode!==e&&(this._configuration.transparencyMode=e,this.setNeedsRender())}get transparency(){return this._configuration.transparencyMode}get tileRenderer(){return this._tileRenderer}get texturesBeingCompressed(){return this._tileRenderer?this._tileRenderer?.texturesBeingCompressed:null}get renderPatchBorders(){return this._configuration.tileBorders}set renderPatchBorders(e){this._configuration.tileBorders!==e&&(this._configuration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return this._configuration.visualizeNormals}set visualizeNormals(e){this._configuration.visualizeNormals!==e&&(this._configuration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._configuration.backfaceCullingEnabled}set cullBackFaces(e){this._configuration.backfaceCullingEnabled!==e&&(this._configuration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return zd.xX}get slicePlaneEnabled(){return this._configuration.hasSlicePlane}set slicePlaneEnabled(e){this._configuration.hasSlicePlane!==e&&(this._configuration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._configuration.textureFadingEnabled!==e&&(this._configuration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._configuration.pbrMode!==e&&(this._configuration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._configuration.screenSizePerspective!==e&&(this._configuration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}set tileSize(e){this._tileSize=e,null!=this._tileRenderer&&(this._tileRenderer.tileSize=e),this.setDirty()}get tileSize(){return this._tileSize}_ensureRenderData(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._ensureRenderData(e),this.updateTileGeometryState(e),this.reuseTextureFromParent(e)||this.updateTileTexture(e,cx.TEXTURE_FADING)}reuseTextureFromParent(e){const t=e.parent;if(!t)return!1;const i=(0,rf.al)(1&e.lij[2]?.5:0,1&e.lij[1]?0:.5,.5,.5);return t.renderData?.reuseTexture(e.renderData,i)??!1}updateTileTexture(e,t){null!=this._tileRenderer&&(this._tileRenderer.updateTileTexture(e,t===cx.TEXTURE_FADING?ow.Ns.FADING:ow.Ns.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){for(const t of e.layerInfo[yv.ELEVATION])t.pendingUpdates&=~cx.GEOMETRY;e.resetPendingUpdate(cx.GEOMETRY);const t=e.renderData.updateGeometryState();return t&&this.setDirty(),t}updateGeometryIfNeeded(e){e.loaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this._renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const t=Math.max(0,7*Math.floor((e.level-3)/7));if(this._isGlobal&&0===t)return Pa.AG;for(;e.parent&&e.level>t;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=tc.Xx.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=tc.Xx.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=tc.Xx.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new dC({rctx:this._rctx,tileSize:this._tileSize,techniques:this._techniques,cache:this._tileTextureCache}),this.updateTileBackground(),this._emptyTex=(0,iC.l_)(this._rctx)}uninitializeRenderContext(){this._emptyTex=(0,m.M2)(this._emptyTex),this._tileRenderer=(0,m.M2)(this._tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==xC.w.Opaque)return;const n=ZC,s=qC;(0,hr.d)(n,r,i),(0,hr.i)(s,1/n[0],1/n[1],1/n[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===Zg.eC.MIN,u=!!e.results.ground.target,h=(0,zd.lV)(e.verticalOffset),d=e.tolerance;let p,f=c&&null!=o.dist?o.dist:1/0;const m=e.options,g=m.normalRequired||!m.backfacesTerrain,y=new oT.sT(!1,g),_=u=>{const _=u.renderData;if(!_?.vao)return;const v=_.geometry;(0,Mf.t8)(GC,v.boundingBox);const b=_.localOrigin;null!=h&&(h.localOrigin=b,h.applyToAabb(GC));const w=GC;if(WC[0]=i[0]-b[0],WC[1]=i[1]-b[1],WC[2]=i[2]-b[2],!(0,oT.Fw)(w,WC,s,d,f))return;const x=(e,t,i)=>{e.set(this.type,u,t,i,Cl.Wd),f=c&&null!=o.dist?o.dist:1/0},T=(s,c,u)=>{if((!g||null!=u)&&s>=0&&(m.backfacesTerrain||(0,hr.f)(u,n)<0)&&(m.invisibleTerrain||!m.selectionMode||null==t||t(i,r,s))){if((null==l.dist||s<l.dist)&&x(l,s,u),m.isFiltered)return;m.store===Zg.eC.ALL&&(null==p?(p=(0,vd.LP)(e.ray),x(p,s,u),e.results.all.push(p)):s<p.dist&&x(p,s,u)),(null==o.dist||s<o.dist)&&x(o,s,u),m.store!==Zg.eC.MIN&&(null==a.dist||s>a.dist)&&x(a,s,u)}},C=$C;(0,hr.d)(C,r,b);const{indices:S,indexCount:E}=v,M=v.vertexAttributes,A=M.getField(Wl.T.POSITION,xT.ct),R=new LC.U(A.typedBuffer,3,M.stride/4),O=E/3;if(!h&&O>200){const e=u.renderData;null==e.intersectionData&&(e.intersectionData=new SC(S,0,O,R)),e.intersectionData.intersectRay(WC,C,y,T)}else(0,oT.CN)(WC,C,0,O,S,R,h,y,T)},v=this._rootTiles;null!=v&&(()=>{const t=this._tileIterator;t.reset(v);const r=e.options.invisibleTerrain;for(let e=t.next();e;e=t.next())!(e.visible||r&&e.intersectsClippingArea)||null==h&&!e.intersectsRay(i,n,d,f)||u&&this._useStencilForTile(e)?t.skipSubtree():_(e)})()}processScaleRangeQueries(e,t){if(!t.done)for(this._updatePatchGroups();e.updating&&!t.done;){e.prepare();for(const t of this._visiblePatchesByOrigin.values())for(const i of t)null!=i.renderData?.textureReference&&e.queriesForTile(i);e.process(),t.madeProgress()}}acquireTechniques(e){const t=!!(0,w.Z)("enable-feature:terrain-shadows")&&e.bind.shadowMap.enabled;t!==this._castShadows&&(this._castShadows=t,this._patchesByOriginDirty=!0);const i=e.bind.viewshedEnabled;if(this._inViewshed!==i&&(this._inViewshed=i,this._patchesByOriginDirty=!0),e.bind.slot===NC.r.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&aw.Qi))return null}else{const t=this.transparency===xC.w.Opaque?NC.r.OPAQUE_TERRAIN:NC.r.TRANSPARENT_TERRAIN;if(e.bind.slot!==t)return null}if(this.transparency===xC.w.Invisible)return null;switch(this._configuration.screenSpaceReflections=this._configuration.cloudReflections=this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1,this._configuration.overlayMode=this._overlayRenderer.mode,e.output){case Lw.H_.Color:case Lw.H_.ColorEmission:return this._configuration.screenSpaceReflections=null!=e.bind.ssr.lastFrameColor,this._configuration.cloudReflections=null!=e.bind.clouds.data,this._configuration.receiveShadows=e.bind.shadowMap.ready,this._configuration.receiveAmbientOcclusion=null!=e.bind.ssao,this._acquireTechnique(e.output,e.bind.slot===NC.r.OCCLUDED_TERRAIN);case Lw.H_.Shadow:case Lw.H_.ShadowExcludeHighlight:return this._castShadows?this._acquireTechnique(Lw.H_.Shadow,!1):null;case Lw.H_.ViewshedShadow:return this._inViewshed?this._acquireTechnique(Lw.H_.ViewshedShadow,!1):null;case Lw.H_.Depth:case Lw.H_.Normal:return this._acquireTechnique(e.output,!1);case Lw.H_.ObjectAndLayerIdColor:return this._acquireTechnique(Lw.H_.ObjectAndLayerIdColor,!1);case Lw.H_.Highlight:return this._overlayRenderer.hasHighlights?this._acquireTechnique(Lw.H_.Highlight,!1):null}return null}render(e,t){switch(this._updatePatchGroups(),t.useStencil=!1,e.output){case Lw.H_.Color:case Lw.H_.ColorEmission:{const i=e.bind.slot===NC.r.OCCLUDED_TERRAIN?TT.D.Occluded:TT.D.Color;this._renderMaterialPass(e,t,i);break}case Lw.H_.Depth:case Lw.H_.Normal:this._renderAuxiliaryPass(e,t,TT.D.Color,this._visiblePatchesByOrigin);break;case Lw.H_.Highlight:{const i=e.bind.highlight?.name;i&&this._overlayRenderer.hasHighlights&&this._overlayRenderer.renders(TT.D.Highlight)&&this._overlayRenderer.hasHighlightOptions(i)&&this._renderAuxiliaryPass(e,t,TT.D.Highlight,this._visiblePatchesByOrigin);break}case Lw.H_.Shadow:case Lw.H_.ShadowExcludeHighlight:case Lw.H_.ViewshedShadow:this._renderAuxiliaryPass(e,t,null,this._allPatchesByOrigin);break;case Lw.H_.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,t,TT.D.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(null==this._tileRenderer)return;const t=this._tileRenderer;let i;if(null!=e){const t=s.Z.toUnitRGBA(e);i=(0,Pa.al)(t[0]||0,t[1]||0,t[2]||0)}t.setBackground(i),this._allTiles.forAll((e=>t.updateTileTexture(e,ow.Ns.FADING))),this._configuration.tileBlendInput=t.backgroundIsGrid?IC.R.GridComposite:null!=t.backgroundColor?IC.R.ColorComposite:IC.R.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==cT.z.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),t=this._stencilEnabledLayerExtents;for(const i of e)(0,Iw.zW)(this.renderOrder,i,t);e.sort(((e,t)=>(0,Iw.dF)(e[0],t[0],this.renderOrder))),this._visiblePatchesByOrigin=new Map(e.map((e=>[e[0].renderData.localOrigin,e]))),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(null!=e){e[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const t of e)this._rebuildPatchGroupsForRootTile(t)}}_rebuildPatchGroupsForRootTile(e){const t=this._tileIterator;for(t.resetOne(e);!t.done;){const e=t.next(),i=e.renderData;if(!i){this._numTilesCulled++;continue}const r=i.localOrigin;if(this._castShadows||this._inViewshed){let t=this._allPatchesByOrigin.get(r);t||(t=[],this._allPatchesByOrigin.set(r,t)),t.push(e)}if(!e.visible){this._numTilesCulled++,t.skipSubtree();continue}let n=this._visiblePatchesByOrigin.get(r);n||(n=[],this._visiblePatchesByOrigin.set(r,n)),n.push(e),t.skipSubtree()}}_useStencilForTile(e){for(const t of this._stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderAuxiliaryPass(e,t,i,r){const n=e.rctx;this._passParameters.overlayContent=i,n.bindTechnique(t,e.bind,this._passParameters);const s=this._stencilEnabledLayerExtents.length>0;r.forEach((r=>{this._drawParameters.origin=r[0].renderData.localOrigin,t.program.bindDraw(e.bind,this._passParameters,this._drawParameters);for(let n=0;n<r.length;n++)this._renderPatch(e,t,r[n],Rl.MX.TRIANGLES,s,i)})),e.rctx.bindVAO(null)}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._passParameters.overlayContent=i,r.bindTechnique(t,e.bind,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=e.bind.camera,s=t.program;if(this._configuration.screenSizePerspective&&this.pointsOfInterest){const e=(0,qg.Gw)(this._stage.viewingMode,this._ellipsoidRadius),t=this.pointsOfInterest.centerOnSurfaceFrequent.distance;e.update({distance:t,fovY:n.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===TT.D.Occluded;a&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",Pa.AG),s.setUniform4fv("texOffsetAndScale",rf.AG));const l=null!=this._tileRenderer?.backgroundColor?this._tileRenderer.backgroundColor:Pa.AG;this._configuration.tileBlendInput===IC.R.ColorComposite&&s.setUniform3fv("backgroundColor",l);const c=this.wireframe?Rl.MX.LINES:Rl.MX.TRIANGLES;this._configuration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const u=this._visiblePatchesByOrigin;for(const r of u.values()){const n=r[0].renderData.localOrigin;this._drawParameters.origin=n,t.program.bindDraw(e.bind,this._passParameters,this._drawParameters),this._numOriginsRendered++;for(const n of r){const r=n.renderData,l=r.textureReference;if(null!=l){if(!a){s.setUniform4fv("texOffsetAndScale",l.offsetAndScale),s.bindTexture("tex",l.texture.texture);const e=r.textureFadeFactor,t=e<1?r.nextTextureReference:null;this._configuration.textureFadingEnabled&&null!=t&&e<1?(s.setUniform1f("fadeFactor",e),s.setUniform4fv("nextTexOffsetAndScale",t.offsetAndScale),s.setUniform3fv("nextTexOpacities",t.opacities),s.bindTexture("texNext",t.texture.texture)):s.setUniform1f("fadeFactor",1),r.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",l.opacities)}this._renderPatch(e,t,n,c,o,i),n.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,t,i,r,n,s){const o=i.renderData,a=o.vao,l=a?.indexBuffer;if(!a||null==l)return void(tw.T9&&console.error("Rendered tile with no indices: ",i.lij," : ",o));const c=t.program;null==s||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(c,o.overlay),n&&(t.useStencil=this._useStencilForTile(i),e.rctx.setPipelineState(t.getPipeline()));const u=o.geometry.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,u,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_acquireTechnique(e,t){return this._configuration.output=e,this._configuration.renderOccluded=t,this._techniques.get(Fw,this._configuration)}get test(){}hasHighlightOptions(e){return this._overlayRenderer.hasHighlightOptions(e)}};(0,i._)([(0,y.Cb)({readOnly:!0})],jC.prototype,"_isGlobal",null),(0,i._)([(0,y.Cb)()],jC.prototype,"renderOccludedFlags",void 0),(0,i._)([(0,y.Cb)({value:!1})],jC.prototype,"renderingDisabled",null),(0,i._)([(0,y.Cb)({value:!0})],jC.prototype,"visible",null),(0,i._)([(0,y.Cb)()],jC.prototype,"texturesBeingCompressed",null),(0,i._)([(0,y.Cb)()],jC.prototype,"renderPatchBorders",null),(0,i._)([(0,y.Cb)()],jC.prototype,"visualizeNormals",null),(0,i._)([(0,y.Cb)()],jC.prototype,"cullBackFaces",null),(0,i._)([(0,y.Cb)({value:cT.z.FRONT_TO_BACK})],jC.prototype,"renderOrder",null),(0,i._)([(0,y.Cb)()],jC.prototype,"wireframe",null),jC=(0,i._)([(0,v.j)("esri.views.3d.terrain.TerrainRenderer")],jC);const ZC=(0,Pa.Ue)(),qC=(0,Pa.Ue)(),WC=(0,Pa.Ue)(),$C=(0,Pa.Ue)();class YC{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}var JC=n(65401),XC=n(56545);let KC=class extends P.Z{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",(()=>this._update())),(0,F.watch)((()=>this.extentHelper.layerViewsExtent),(()=>this._setAdHocTilingScheme()))]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some((t=>!(!(0,z.iC)(t)||t.isRejected()||t.isFulfilled()&&!function(e,t,i){return null!=(0,tw.E_)(e,t,i)}(t,this.viewSpatialReference,this.viewingMode)||(e=t,"vector-tile"===t?.type||(0,tw.x4)(t))))),e)if(e.isResolved()){const t=(0,tw.E_)(e,this.viewSpatialReference,this.viewingMode);if(null!=t){const e=new XC.t(t.tileInfo);this._lockTilingScheme(e)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch((()=>{})).then((()=>{t!==this._waitTask||this.destroyed||this._update()}));this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===$t.JY.Global){const t=e.levels.length-1,i=e.spatialReference;i.isWebMercator?e=XC.t.makeWebMercatorAuxiliarySphere(t):(0,JC.O)(i)&&(e=XC.t.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles((0,F.watch)((()=>this.extentHelper.tiledLayersExtent),(()=>this._updateTiledLayerExtent())))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===$t.JY.Global){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=XC.t.WebMercatorAuxiliarySphere:(0,JC.M)(e)&&(this.tilingScheme=XC.t.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;null==e||(0,Ds.fS)(e,this.extent)||(this.tilingScheme=XC.t.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};(0,i._)([(0,y.Cb)()],KC.prototype,"tilingScheme",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],KC.prototype,"extent",void 0),(0,i._)([(0,y.Cb)({value:!1})],KC.prototype,"tilingSchemeLocked",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],KC.prototype,"viewSpatialReference",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],KC.prototype,"layers",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],KC.prototype,"extentHelper",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],KC.prototype,"viewingMode",void 0),KC=(0,i._)([(0,v.j)("esri.views.3d.terrain.TilingSchemeLogic")],KC);class QC{constructor(){this._offset=(0,ui.Ue)(),this.scale=0}get offset(){return this._offset}init(e,t,i,r){this.tile=e,this._offset[0]=t,this._offset[1]=i,this.scale=r}dispose(){this.tile=null,this._offset[0]=0,this._offset[1]=0,this.scale=0}}var eS;let tS=eS=class extends(L.Z.EventedMixin(P.Z)){get allTiles(){return this._allTiles}constructor(e){super(e),this._scaleRangeQueries=new hT,this._iteratorPool=new qb.Z(Iw.AA,(e=>e.remove=()=>this._iteratorPool.release(e))),this._postorderIterator=new Iw.rv,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new YC,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=(0,Pa.Ue)(),this._eyePosSurfaceSR=(0,Pa.Ue)(),this._splitLimits=new wT,this._frustum=(0,Af.Ue)(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new he.R,this._frameTask=Ii.sq,this._allTiles=new Pg.Z,this._upsampleInfoPool=new qb.Z(QC),this._shouldEmitChangeEvent=!1,this._destroying=!1,this._rootTilesExtent=(0,Ds.Ue)(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ie.Z.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new Jb(1/0,-1/0),this.rootTileElevationBounds=new Jb(1/0,-1/0),this._projectorCache=new Map,this._radiusModifier=Math.cos(Math.PI/16/16),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new mw({...e,surface:this}),this._isGlobal=!e.view?.state?.isLocal,this._isGeographic=this._spatialReference?.isGeographic??!1,this._tileConstructor=this._isGlobal?pT:aT,this._ellipsoid=(0,_l.Iu)(e.view.spatialReference)}initialize(){const e=this.view,t=e.resourceController,i=t.memoryController;this._tileCache=new jb(((e,t)=>i.newCache(e,t)),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",(e=>e.unloadMapData())),this._elevationQueryCache=new Wb(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new jC(r.renderer,e._stage,this._allTiles,this._ellipsoid.radius,i),this.addHandles([(0,F.watch)((()=>r.renderer.isEmpty),(()=>this._evaluateTransparency())),(0,F.watch)((()=>this.renderer.visible),(e=>this.suspended=!e)),(0,F.watch)((()=>this.heading),(e=>{this._renderer.updateHeading(e),this._updateTileTextures(ow.Ns.FADING)})),(0,F.watch)((()=>({heading:e.camera?.heading,state:e.state?.mode})),(({heading:e,state:t})=>{if(null==e)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(e/90)%360);const i=Math.round(e)%360,r=Math.abs(i-this.heading);(t===Pi.n.IDLE||Math.min(r,360-r)>=30)&&(this.heading=i)}))],"overlayManager"),this.addHandles([(0,F.watch)((()=>this.baseOpacity),(()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?ow.Ns.UNFADED:ow.Ns.IMMEDIATE)}),F.syncAndInitial),(0,F.watch)((()=>this.hasCompositeBlendMode),(()=>this._updateTileTextures(this._evaluateTransparency()?ow.Ns.UNFADED:ow.Ns.IMMEDIATE)),F.syncAndInitial),(0,F.watch)((()=>this.backgroundColor),((e,t)=>{e?.equals(t)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(e))}),F.sync),(0,F.watch)((()=>this.snapLevel),(()=>this._viewChanged=!0),F.sync),(0,F.watch)((()=>this.view.pointsOfInterest),(e=>{this._renderer.pointsOfInterest=e,this._watchUpdatingTracking.removeAll(),e&&this._watchUpdatingTracking.add((()=>e.focus.renderLocation),(()=>this._allTilesSorted=!1))})),(0,F.watch)((()=>Ig.h.TERRAIN_TILE_TREE_SHOW_TILES),(t=>{t&&!this._treeDebugger?n.e(66532).then(n.bind(n,66532)).then((({TerrainTileTree3DDebugger:t})=>{!this._treeDebugger&&Ig.h.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new t({view:e}))})):t||(this._treeDebugger=(0,m.SC)(this._treeDebugger))}),F.initial)]),this.addHandles([(0,F.watch)((()=>this._renderer.tileRenderer?.texturesBeingCompressed),((e,t)=>{t&&e<t&&(this.setMemoryDirty(),this._allTiles.forAll((e=>e.setMemoryDirty())))}))]),this.addHandles([(0,F.watch)((()=>this._renderer.texturesBeingCompressed),((e,t)=>{0===e&&e!==t&&this.requestRender()}))]);const{spatialReference:s}=e;this._extentHelper=function(e,t){return e===$t.JY.Global?new rw(t):new nw(t)}(this.viewingMode,{layers:e.map.allLayers,layerViews:e.allLayerViews,viewSpatialReference:s});const o=new I.Z({getCollections:()=>e.defaultsFromMap?.mapCollections?.map((({layers:e})=>e)),getChildrenFunction:e=>e&&"layers"in e?e.layers:null}),a=new KC({layers:o,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",a),this._updateTilingScheme(),this._elevationDataRequester=t.createStreamDataRequester(Ov.Bh.ELEVATION),this._mapDataRequester=t.createStreamDataRequester(Ov.Bh.BASEMAP);const l=t.scheduler;this._frameTask=l.registerTask(Ii.T8.TERRAIN_SURFACE,this),this.addHandles([(0,F.watch)((()=>this._extentHelper.stencilEnabledExtents),(e=>this._renderer.setStencilEnabledLayerExtents(e)),F.initial),(0,F.watch)((()=>this.tilingSchemeLogic.tilingScheme),(()=>this._updateTilingScheme()),F.sync),(0,F.watch)((()=>this.extent),(()=>this._updateRootTiles()),F.initial),e.on("resize",(()=>this._viewChangeUpdate())),(0,F.watch)((()=>{const t=e.state;return[this._lodBias,this.lodSnappingEnabled,e.quality,t.camera,t.contentCamera,t.fixedContentCamera]}),(()=>this._viewChangeUpdate()),F.syncAndInitial),(0,F.watch)((()=>e.qualitySettings?.fadeDuration),(e=>this._renderer.textureFadingEnabled=e>0),F.initial),(0,F.watch)((()=>e.qualitySettings?.physicallyBasedRenderingEnabled),(e=>this._renderer.pbrMode=e?zC.f7.Simplified:zC.f7.Disabled),F.initial),(0,F.watch)((()=>e.qualitySettings?.tiledSurface.elevationLevelDelta),(()=>this._updateAllTileGeometries())),(0,F.watch)((()=>this._userClippingExtent),(()=>this._updateClippingExtent()),F.sync)]),this.addHandles(e.allLayerViews.on("after-changes",(()=>this._layerViewsDirty=!0))),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._destroying=!0,this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",(0,m.SC)(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach(((e,t)=>this._unregisterTiledLayerView(t))),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",(0,m.SC)(this.overlayManager)),this._tileCache=(0,m.SC)(this._tileCache),ux.prune(),this._treeDebugger=(0,m.SC)(this._treeDebugger),this._renderer=(0,m.SC)(this._renderer),this._iteratorPool=(0,m.SC)(this._iteratorPool),this._upsampleMapCache=(0,m.SC)(this._upsampleMapCache),this._elevationQueryCache=(0,m.SC)(this._elevationQueryCache),this._set("view",null),this._extentHelper=(0,m.SC)(this._extentHelper),this._upsampleInfoPool=(0,m.SC)(this._upsampleInfoPool),lx.size>0&&(console.log(`${lx.size} live TilePerLayerInfo allocations:`),lx.forEach((e=>console.log(e,"\n"))))}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnappingEnabled){const{view:e,tilingScheme:t}=this,i=e.scale;if(t&&i){const r=t.levelAtScale(i)+e.qualitySettings.tiledSurface.lodBias,n=t.getMaxLod();return r<=0?null:Math.min(r,n||1/0)}}return null}get lodSnappingEnabled(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get hasStencilEnabledExtents(){return this._extentHelper.stencilEnabledExtents.length>0}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(null==t||null==e)return null;const i=(0,Ds.Ue)(),r=(0,k_.G)(t,i,e)?i:null,n=this._get("extent");return(0,Ds.fS)(r,n)?n:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=(0,Ds.jV)(this.groundExtent,this._userClippingExtent,(0,Ds.Ue)()),t=this._get("extent");return(0,Ds.fS)(e,t)?t:e}get groundExtent(){return null!=this._tilingSchemeExtent?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating||this.renderer.texturesBeingCompressed)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return null!=this._rootTiles}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===xC.w.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevationLevelDelta(e){return e<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(e,t,i,r){const n=this._rootTiles;if(!n?.length)return null;if(0===n[0].layerInfo[yv.ELEVATION].length)return null;let s=this._elevationProjectorCache.get(r);if(void 0===s&&(s=(0,Ty.R8)(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,s)),null==s)return f.Z.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=(0,hr.i)(rS,e,t,i);return s(o,0,o,0),lS(n,o[0],o[1])}getElevations(e,t,i){const r=this._rootTiles,n=r?r[0].layerInfo[yv.ELEVATION].length:0;if(r?.length&&0!==n)for(let n=0;n<t;++n){const t=3*n;i(n,lS(r,e[t],e[t+1]))}else for(let e=0;e<t;++e)i(e,null)}getScale(e){if(!this.tilingScheme)return null;if(!(0,La.K)(e,rS,this.spatialReference))return f.Z.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this._rootTiles;if(null!=t)for(const e of t)if(e?.containsPoint(rS)){let t=e;for(;t.children[0]&&!t.rendered;){const e=t.children[0].extent;let i=0;rS[0]>e[2]&&(i+=1),rS[1]<e[1]&&(i+=2),t=t.children[i]}return this._getLodBiasCorrectedScale(t.level)}return 1/0}_ensureProjector(e){const t=this._projectorCache.get(e);if(t)return t;const i=(0,Ty.R8)(e,this._tilingSchemeSpatialReference)??null;return this._projectorCache.set(e,i),i}getSphereElevationBounds(e,t){const i=this._ensureProjector(t);if(null==i)return f.Z.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;(0,hh.e)(e,nS);const r=(0,hh.a)(nS);i(r,0,r,0);const n=new av.r,s=this._rootTiles;if(null!=s){const e=[];for(const t of s)e.push(t);let t=0;for(;t<e.length;){const i=e[t];if(++t,!(0,Ds.hr)(i.extent,nS))continue;const r=i.children;if(null==r[0]||i.rendered)n.expandElevationRangeValues(i.elevationBoundsMin,i.elevationBoundsMax);else for(const t of r)e.push(t)}}return n}getRootElevationBounds(){return new av.r(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getLowerBoundRadius(){const e=(this._ellipsoid.radius+this.visibleElevationBounds.min)*this._radiusModifier;return Math.min(e,this._ellipsoid.radius)}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!(0,La.K)(e,(0,hh.a)(nS),this.spatialReference))return f.Z.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;nS[3]=t;let i=null;const r=e=>{if(e&&(0,Ds.hr)(e.extent,nS)){const t=e.children;if(t[0]&&!e.rendered)for(const e of t)r(e);else{const t=this._getLodBiasCorrectedScale(e.level);i=null==i?t:Math.min(i,t)}}},n=this._rootTiles;if(null!=n)for(const e of n)r(e);return i}queryVisibleScaleRange(e,t,i,r){const n=t?this.tilingScheme.levelAtScale(t):0,s=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+o,s+o,r)}_evaluateTransparency(){const e=this.baseOpacity,t=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?t?xC.w.Invisible:xC.w.InvisibleWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?xC.w.Opaque:xC.w.Transparent;return this._renderer.transparency=r,i!==r}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;(0,tw.wu)(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const t=e?.spatialReference??Ie.Z.WebMercator;this._spatialReference=t,this._isWebMercator=!!t?.isWebMercator,this._isWebMercatorOnPlateCarree=this._isWebMercator&&(0,Le.QM)(this.view?.renderSpatialReference),this._isGeographic=t?.isGeographic??!1,this._set("tilingScheme",e),this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference,this._projectorCache.clear(),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.tileSize=e.pixelSize,this.overlayManager.spatialReference=e.spatialReference,this._updateRootTiles())}_acquireTile(e,t,i,r){const n=this._tileCache.pop(eS._tileMemcacheKey);return n?(n.init(e,t,i,r,this),n):new this._tileConstructor(e,t,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=sS;let r=t.rootTilesInExtent(e,i,5*Ba.$X);if(null!=this._rootTiles){if(r.length>Ba.$X)return void f.Z.getLogger(this).warn(Ba.C5);const e=this._rootTiles.map((e=>e.lij)),t=(0,Xe.e5)(e,r,_x);if(this._updatingRootTiles=!0,t.removed.length>0||t.added.length>0){const e=this._rootTiles.filter((e=>!(t.removed.findIndex((t=>_x(t,e.lij)))>-1&&(this._purgeTile(e),1))));t.added.forEach((t=>e.push(this._newRootTile(t)))),this._setRootTiles(e)}}else this._updatingRootTiles=!0,r.length>Ba.$X&&(f.Z.getLogger(this).warn(Ba.p1),r=t.rootTilesInExtent(e,i,Ba.$X)),this._setRootTiles(r.map((e=>this._newRootTile(e))));(0,Ds.fS)(i,this._rootTilesExtent)||(this._rootTilesExtent=(0,Ds.Ue)(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter((e=>e.loaded&&e.intersectsClippingArea));e.sort(Iw.gl),e.forEach((e=>this._renderer.updateTileGeometryState(e))),e.forEach((e=>e.renderData.updateNeighborData())),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(0===e.length)return;e.sort(Iw.gl);const t=this.renderer;e.forEach((e=>t.updateGeometryIfNeeded(e))),e.forEach((e=>this._pendingTilesForElevationUpdateEvent.add(e)))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===cx.SPLIT}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(t)&&t.setPendingUpdate(cx.SPLIT),this._loadTile(t),this._markTileToUpdate(t),this._updateRootTileElevationBounds(),t}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),null!=e){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(cx.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(null==e)return;const t=(0,Iw.t8)(e),i=this.visibleElevationBounds;let r=t?i.min:1/0,n=t?i.max:-1/0;const s=this.extent,o=this.view.state.contentCamera.viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const e=a.next();e.updateClippingStatus(s)&&e.resetPendingUpdate(cx.GEOMETRY)&&this._updateTileGeometryState(e),e.computeVisibility(),e.updateScreenDepth(o),e.renderData&&(r=Math.min(e.elevationBoundsMin,r),n=Math.max(e.elevationBoundsMax,n))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(n)&&(i.min!==r||i.max!==n)&&(this.visibleElevationBounds=new Jb(r,n))}_updateRootTileElevationBounds(){let e=1/0,t=-1/0;const i=this._rootTiles;null!=i&&i.forEach((({elevationBoundsMin:i,elevationBoundsMax:r})=>{e=Math.min(e,i),t=Math.max(t,r)}));const r=this.rootTileElevationBounds;r.min===e&&r.max===t||(this.rootTileElevationBounds=new Jb(e,t))}_updateViewDependentParameters(){const{camera:e,contentCamera:t}=this.view.state,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),n=this.tilingScheme.pixelSize,s=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=(0,Af.JG)(this._splitLimits.frustum??(0,Af.Ue)(),t.frustum):this._splitLimits.frustum=null,(0,Af.JG)(this._frustum,e.frustum),(0,hr.c)(this._eyePosRenderSR,t.eye),(0,Ef.S)(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this.setMemoryDirty()}_markAllTileNeighborsForUpdate(e){e.forEachLoadedNeighbor((e=>{this._layerViews[yv.MAP].some(tw.Q)&&e.setPendingUpdate(cx.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)}))}_updateTileTexture(e,t){const i=e.resetPendingUpdate(cx.TEXTURE_FADING)?cx.TEXTURE_FADING:!!e.resetPendingUpdate(cx.TEXTURE_NOFADING)&&cx.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const e=oS.extent;(0,Ds.cS)(e),this._pendingTilesForElevationUpdateEvent.forEach((t=>(0,Ds.jn)(e,t.extent,e))),this._pendingTilesForElevationUpdateEvent.clear(),oS.spatialReference=this.spatialReference,this.emit("elevation-change",oS),this._shouldEmitChangeEvent=!1}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(e,t),this._updateElevation(e),this._updateTextures(e),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),tw.T9&&this._checkTileInvariant(),!e.hasProgressed)return zl.J}_checkTileInvariant(){const e=new Map;this._allTiles.forAll((t=>e.set(t,new Set))),this._allTiles.forAll((t=>{if((0,tw.wu)(t.rendered===t.leaf,` rendered ${t.rendered} != ${t.leaf} leaf`),!t.leaf){const e=e=>0===e.unmergableChildCount&&0===e.maxLevelDeltaNeighborCount,i=t.children.reduce(((t,i)=>t+(e(i)?0:1)),0);if((0,tw.wu)(t.unmergableChildCount===i,` Tile[${t.lij.toString()}] unmergeable child count mismatch: actual ${t.unmergableChildCount} vs ${i}`),t.hasPendingUpdate(cx.MERGE)){(0,tw.wu)(!t.hasPendingUpdate(cx.SPLIT),"Tile can be both split and merge at the same time");for(const e of t.children)(0,tw.wu)(e.leaf||e.hasPendingUpdate(cx.MERGE),"Child of tile to merge must also merge")}}for(let i=0;i<4;++i){if(t.rendered){const e=t.renderData?.geometryState.edgePeerNeighbors[i];if(null!=e){{const r=t.level-e.level<=Ba.qC;r||(console.log(`tile level delta [${t.lij.toString()}] vs [${e.lij.toString()}] > ${Ba.qC}  (edge[${i}])`),(0,tw.wu)(r,`tile level delta [${t.level}] vs [${e.level}] > ${Ba.qC}`))}(0,tw.wu)(t.level-e.level<=Ba.qC,`Max tile lod delta exceeded: [${t.lij.toString()}] vs [${e.lij.toString()}]`)}}const r=t.level-Ba.qC,n=e=>e.leaf||e.level===t.level,s=t.findNeighborTile(tw.OC[i],n);if(null!=s){if(t.leaf&&t.level>=Ba.qC){let i=s;for(;t.level-i.level<Ba.qC;)i=i.parent;if(!_x([r,t.lij[1]>>Ba.qC,t.lij[2]>>Ba.qC],i.lij)){const r=e.get(i);(0,tw.wu)(!r.has(t),"Cannot already have neighbor"),r.add(t)}}(0,tw.wu)(s.rendered||s.level===t.level,"Non-same-level-neighbor of rendered must be rendered"),(0,tw.wu)(t.level-s.level<=Ba.qC,`Tile level delta [${t.level}] vs [${s.level}] > ${Ba.qC}`)}}})),this._allTiles.forAll((t=>{const i=t.maxLevelDeltaNeighborCount,r=e.get(t);(0,tw.wu)(i===r.size,`Tile[${t.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)}))}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const t=new cS(this._allTiles.length);t.pushAll(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,n=this._eyePosRenderSR;this._allTiles.forAll((e=>{e.maxLevelDeltaNeighborCount=0,e.unmergableChildCount=0}));const s=this.view.state.contentCamera.viewProjectionMatrix;for(;!t.empty;){const e=t.pop(),o=e.parent,a=null!=o&&o.hasPendingUpdate(cx.MERGE),l=a?cx.MERGE:e.shouldSplit(r,n,i),c=l===cx.SPLIT;e.leaf?uS(e,c):t.pushAll(e.children),a?(e.resetPendingUpdate(cx.SPLIT),e.leaf||e.setPendingUpdate(cx.MERGE),this._updateClippingStatus(e),e.updateVisibility(),e.updateScreenDepth(s)):c?(e.resetPendingUpdate(cx.MERGE),e.leaf&&e.setPendingUpdate(cx.SPLIT)):(e.resetPendingUpdate(cx.SPLIT)&&e.updateAgentSuspension(),l===cx.ELEVATION&&e.updateAgents(yv.ELEVATION),e.leaf||(e.setPendingUpdate(cx.MERGE),e.resetPendingUpdate(cx.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||((0,Iw.b)(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){(0,tw.Fp)(e.loaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForUpdate(e))}_updatePendingTileGeometries(){const e=this._pendingTilesToUpdate,t=Array.from(e.keys()).filter((e=>e.loaded&&e.intersectsClippingArea));if(0===t.length)return void e.clear();const i=(i,r)=>{!r?.loaded||!r.intersectsClippingArea||r.level<i.level||e.has(r)||(e.add(r),t.push(r),r.renderData.updateNeighborData())};t.sort(Iw.gl);const r=t.length;for(let n=0;n<r;++n){const r=t[n];(0,tw.Fp)(r.loaded),(0,tw.Fp)(r.intersectsClippingArea);const s=r.renderData;s.updateNeighborData();const o=s.dirtyEdgeResolutions,a=s.geometryState,l=e=>{const t=tw.cA[e];i(r,a.cornerPeerNeighbors[e]?.findCorner((0,tw.$v)(t),(e=>e.loaded)))};for(let t=0;t<4;++t)if(o&1<<t){const n=s.geometryState.edgePeerNeighbors[t];n&&n?.level>=r.level&&n.forAllSubtreeOnSide((0,tw._F)(tw.OC[t]),(t=>!(!t.loaded||!t.intersectsClippingArea||((0,tw.Fp)(e.has(t)||(0,Iw.gl)(r,t)<0),i(r,t),0)))),l((t+1)%4),l(t)}}e.clear(),this._updateTilesGeometries(t),this._shouldEmitChangeEvent=!0,tw.T9&&tw.V0&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let s=!1;const o=!this._allTiles.some((n=>{if(!i&&!r&&!n.visible)return e.done;let o=n;if(n.hasPendingUpdate(cx.MERGE)){if(!t||n.unmergableChildCount>0)return e.done;for(n.resetPendingUpdate(cx.MERGE);null!=o.parent&&0===o.parent.unmergableChildCount&&o.parent.resetPendingUpdate(cx.MERGE);)o=o.parent;this._mergeTile(o),s=!0,e.madeProgress()}else if(n.resetPendingUpdate(cx.SPLIT)){let t=!0;const i=n.level;if(i>=Ba.qC){const e=e=>e.leaf||i-e.level<Ba.qC;for(let r=0;r<4;++r){const s=n.findNeighborTile(tw.OC[r],e);null!=s&&i-s.level===Ba.qC&&(t=!1,tw.T9&&((0,tw.Fp)(s.leaf),(0,tw.Fp)(s.hasPendingUpdate(cx.SPLIT))))}}t?(this._splitTile(n),e.madeProgress(),s=!0):n.setPendingUpdate(cx.SPLIT)}return e.done}));if(s&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!s)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some((t=>(t.resetPendingUpdate(cx.GEOMETRY)&&(this._updateTileGeometryState(t),this._shortBatches&&this._updatePendingTileGeometries(),e.madeProgress()),e.done))),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some((t=>(this._updateTileTexture(t,e),e.done)))}_updateClippingExtent(){this.spatialReference&&(this.overlayManager?.updateOverlayParameters(tc.Xx.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Ba.if}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=(0,yt.uZ)(e-this._lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){null!=this._rootTiles&&(this._rootTiles.forEach((e=>this._purgeTile(e))),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeSubtree(e){const t=e.children;t[0]&&(this._purgeTile(t[0]),this._purgeTile(t[1]),this._purgeTile(t[2]),this._purgeTile(t[3]),e.clearChildren())}_purgeTile(e){e.leaf?dS(e):this._purgeSubtree(e),this._allTiles.removeUnordered(e),this._unloadTile(e),e.dispose(),this._tileCache.put(eS._tileMemcacheKey,e)}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload()}_splitTile(e){(0,tw.wu)(e.leaf,"Tile that is already split should not be split again!"),(0,tw.wu)(e.rendered,"Tile marked to split is not rendered"),dS(e);const t=e.createChildren();this._allTiles.pushArray(t),e.updateAgentSuspension(),(0,tw.wu)(e.rendered,"parent should be rendered"),t.forEach((e=>this._loadTile(e))),t.forEach((e=>this._pendingTilesToUpdate.add(e))),this._unloadTile(e),this._markAllTileNeighborsForUpdate(e),this._emitTileScaleChange(e,e.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),t.forEach((e=>uS(e,e.hasPendingUpdate(cx.SPLIT)))),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){aS.spatialReference=this.spatialReference,aS.extent=e.extent,aS.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",aS)}createTile(e,t,i,r){(0,tw.wu)(!!r,"createTile sanity check");const n=this._acquireTile(e,t,i,r);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this.view.state.contentCamera.viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(cx.SPLIT),n}get _shortBatches(){return this.view.state.mode!==Pi.n.IDLE}_mergeTile(e){(0,tw.wu)(!e.hasPendingUpdate(cx.SPLIT),"_mergeTile sanity check"),(0,tw.wu)(!e.leaf,"Cannot merge a leaf"),e.leaf||(this._purgeSubtree(e),(0,tw.wu)(!e.renderData,"Merging tile with existing render data?"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this._shortBatches&&this._updatePendingTileGeometries(),uS(e,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(e){e.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager?.hasOverlays&&this.overlayManager.updateTileOverlayParameters(e)}_handleLayerViewChanges(e=Ii.G5){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(let e=this.view.allLayerViews.length-1;e>=0;e--){const n=this.view.allLayerViews.items[e];if(i.add(n.uid),(0,tw.wP)(n)||(0,tw.a_)(n))if(this._basemapLayerViewHandles.has(n.uid)&&!(0,tw.a_)(n)){const e=this._layerClassFromLayerView(n),i=this._getLayerIdxByUID(e,n.uid);null!=i&&((i<r||null==r)&&(t=!0),r=i)}else this._registerTiledLayerView(n),n.layer.loaded&&(t=!0)}this._basemapLayerViewHandles.forEach(((e,r)=>{i.has(r)||(this._unregisterTiledLayerView(r),t=!0)})),t&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){let e=0===this.view.map?.ground?.opacity;for(const t of this.view.allLayerViews.items)if((0,tw.GL)(t)&&!(0,z.sy)(t.layer)&&0!==t.fullOpacity)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(((0,tw.TK)(e)||(0,tw.a_)(e))&&(0,HT.MV)(HT.pU[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return(0,tw._1)(e)?yv.ELEVATION:yv.MAP}_registerTiledLayerView(e){const t=[];if(((0,tw.TK)(e)||(0,tw.a_)(e))&&t.push((0,F.watch)((()=>e.layer.blendMode),(()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(ow.Ns.UNFADED)}))),!(0,tw.a_)(e)){const i=this._layerClassFromLayerView(e);t.push((0,F.watch)((()=>e.suspended),(()=>this._updateTiledLayers()))),t.push((0,F.watch)((()=>e.fullOpacity),(()=>this._updateTileTextures(ow.Ns.UNFADED)))),t.push((0,F.watch)((()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null),(()=>this._restartAllAgents(i)))),t.push(e.on("data-changed",(()=>{const t=this._getLayerIdxByUID(i,e.uid);null!=t&&this._invalidateLayerData(t,i)})))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(const e of t)e.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;e.forEach((e=>{if(!e.layer||e.suspended||!(0,tw.wP)(e)||!e.fullExtent)return;const r=this._layerClassFromLayerView(e);if(r===yv.MAP){const t=e.displayLevelRange.maxLevel;t!==1/0&&(null===i||t>i)&&(i=t)}t[r].push(e)}));for(const e of _v){const i=this._layerViews[e],r=t[e];r.reverse();const n=r.length;let s=i.length!==n;const o=new Array(n),a=new Array(i.length);this._layerIndexByUid[e].clear();for(let t=0;t<n;t++){const n=r[t].uid;this._layerIndexByUid[e].set(n,t);const l=i.indexOf(r[t]);o[t]=l,t!==l&&(s=!0),l>-1&&(a[l]=t)}if(s){const t=this._postorderIterator;for(t.reset(this._rootTiles);!t.done;)t.next().modifyLayers(a,o,e);this._layerViews[e]=r,this._restartAllAgents(e),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this._rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===yv.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll((t=>{t.updateAgents(yv.MAP),e===ow.Ns.IMMEDIATE?this.renderer.updateTileTexture(t,cx.TEXTURE_NOFADING):t.updateRenderData(yv.MAP,e)})),this._evaluateTransparency()}_invalidateLayerData(e,t){this._allTiles.forAll((i=>i.removeLayerAgent(e,t))),this._allTiles.forAll((i=>i.invalidateLayerData(e,t)))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=tc.Xx.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){1==++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const n=this.layerViewByIndex(t,i),s=n.layer;return!s.tilemapCache||(0,tw.Q)(n)?this._requestTileData(e,i,n,r):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(e.level,e.lij[1],e.lij[2],{...r,timeout:6e3}).then((()=>--this._asyncWorkItems)).catch((t=>{throw--this._asyncWorkItems,(0,g.k_)(r),(0,g.D_)(t)||this._dataMissing(e,i,n),t})).then((()=>this._frameTask.schedule((()=>this._requestTileData(e,i,n,r)),r.signal))))}_requestTileData(e,t,i,r){if(this._destroying)return Promise.resolve();const n=t===yv.ELEVATION;return r.requester??=n?this._elevationDataRequester:this._mapDataRequester,n?(0,tw._1)(i)?this._requestElevationTileData(e,i,r):Promise.reject():(0,tw.GL)(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;const r=r=>{!(0,g.Hc)(i)&&r&&(this.setMemoryDirty(),this.requestUpdate(),this._elevationDataArrived(e,t,r))};return t.fetchTile(e.lij,i).then((e=>this._frameTask.schedule((()=>r(e)))),(i=>{(0,g.D_)(i)||(f.Z.getLogger(this).error(`Tile ${e.lij.toString()} layer ${yv.ELEVATION}/${t.uid} error ${i}`),this._dataMissing(e,yv.ELEVATION,t),this.requestUpdate())})).finally((()=>--this._asyncWorkItems))}_elevationDataArrived(e,t,i){const r=this._layerIndexByUid[yv.ELEVATION].get(t.uid);if(null==r)return void f.Z.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",yv.ELEVATION,e.lij.toString());const n=new Kb(e.lij,e.extent,i);e.dataArrived(r,yv.ELEVATION,n);const s=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const e=a.next();e.findElevationBoundsForLayer(r,o),e.computeElevationBounds()}0===o&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_requestMapTileData(e,t,i){++this._asyncWorkItems;const r=(r,n)=>{(0,tw.ep)(n),(0,g.Hc)(i)||(console.error(`Tile ${e.lij.toString()} layer ${yv.MAP}/${t.uid} error ${r}`),this._dataMissing(e,yv.MAP,t),this.requestUpdate())},n=e=>t=>r(t,e);return t.fetchTile(e.lij,i).then((r=>this._frameTask.schedule((()=>{this.requestUpdate(),(0,g.Hc)(i)?(0,tw.ep)(r):this._mapTileDataArrived(e,t,r)}),i.signal,n(r)).catch(n(r))),((e,t=null)=>this._frameTask.schedule((()=>r(e,t))))).finally((()=>--this._asyncWorkItems))}_mapTileDataArrived(e,t,i){const r=this._getLayerIdxByUID(yv.MAP,t.uid);if(null==r)return(0,tw.ep)(i),void f.Z.getLogger(this).warn("TerrainSurface: received data from unknown layer");e.dataArrived(r,yv.MAP,i)}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i){const r=this._getLayerIdxByUID(t,i.uid);null!=r?e.dataMissing(r,t):f.Z.getLogger(this).warn("TerrainSurface: received data from unknown layer")}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll((t=>{t.leaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))})),e}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this.tilingScheme?(null==this._usedMemory&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce(((e,t)=>e+t.usedMemory),0)):null}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return null!=r&&this._allTiles.forAll((e=>t+=e.getUsedMemoryForLayer(i,r))),t}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){}checkAllTilesWaterproofness(){if(!tw.V0)return;const e=this._rootTiles;if(null==e)return;const t=e=>e?.renderData?.geometry?.indices?.length>0,i=(e,i)=>{t(e)&&console.error("Tile[",e.lij,"] has geometry although parent[",i.lij,"] has geom")},r=e=>{if(e.intersectsClippingArea)if(e.renderData&&!e.renderData.geometryState&&console.error("Tile[",e.lij,"] has renderData but not geometryState"),e.renderData&&!e.renderData.geometry&&console.error("Tile[",e.lij,"] has renderData but not geometryInfo"),!e.renderData?.geometry||(e.renderData.geometry.indices?.length??0)>0||console.error("Tile[",e.lij,"] has renderData but no indices - geometryInfo: ",e.renderData.geometry),t(e)){e.checkGeometryWaterproofness();for(const t of e.children)i(t,e)}else if(e.leaf)console.error("Tile[",e.lij,"] has no geometry and no children, from root to leaf");else for(const t of e.children)r(t)},n=e=>{const t=e.parent?.visible??!0,i=e.visible;e.computeVisibility();const r=e.visible;if(i!==r&&t&&console.error(" Tile[",e.lij,"] has out of date visibility: ",i," instead of ",r),!e.leaf)for(const t of e.children)n(t)};for(const t of e)r(t),n(t)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(e){return this._isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this._isGlobal&&0===e[2]}lijEastEnd(e){return 1<<e+(this._isGeographic?1:0)}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this._isGlobal)return null;const r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}enableInternalChecks(e){(0,tw.qA)(e)}enableWaterproofnessChecks(e){(0,tw.HK)(e)}};tS._tileMemcacheKey="TerrainTileMemcache",(0,i._)([(0,y.Cb)()],tS.prototype,"_renderer",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],tS.prototype,"_scaleRangeQueries",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],tS.prototype,"view",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],tS.prototype,"overlayManager",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"_hasPendingUpdates",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"_asyncWorkItems",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"_allTilesDirty",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"_allTilesSorted",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"_viewChanged",void 0),(0,i._)([(0,y.Cb)({type:Number})],tS.prototype,"heading",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"_splitLimits",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"_watchUpdatingTracking",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"_frameTask",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"snapLevel",null),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"lodSnappingEnabled",null),(0,i._)([(0,y.Cb)()],tS.prototype,"_userClippingExtent",null),(0,i._)([(0,y.Cb)()],tS.prototype,"_rootTilesExtent",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"extent",null),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"groundExtent",null),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"_tilingSchemeExtent",null),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"updating",null),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"running",null),(0,i._)([(0,y.Cb)(Yb.q)],tS.prototype,"updatingProgress",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"updatingProgressValue",null),(0,i._)([(0,y.Cb)()],tS.prototype,"_maxNumUpdating",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"baseOpacity",null),(0,i._)([(0,y.Cb)()],tS.prototype,"hasCompositeBlendMode",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"viewingMode",null),(0,i._)([(0,y.Cb)()],tS.prototype,"maxTextureScale",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"ready",null),(0,i._)([(0,y.Cb)({value:cT.z.FRONT_TO_BACK})],tS.prototype,"renderOrder",null),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"rootTiles",null),(0,i._)([(0,y.Cb)()],tS.prototype,"_rootTiles",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"spatialReference",null),(0,i._)([(0,y.Cb)({type:s.Z})],tS.prototype,"backgroundColor",null),(0,i._)([(0,y.Cb)({value:!1})],tS.prototype,"slicePlaneEnabled",null),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"tilingScheme",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"tilingSchemeLocked",null),(0,i._)([(0,y.Cb)({readOnly:!0})],tS.prototype,"tilingSchemeLogic",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"wireframe",null),(0,i._)([(0,y.Cb)({value:!1})],tS.prototype,"suspended",null),(0,i._)([(0,y.Cb)()],tS.prototype,"fadeDuration",null),(0,i._)([(0,y.Cb)()],tS.prototype,"visibleElevationBounds",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"rootTileElevationBounds",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"_layerViewsDirty",void 0),(0,i._)([(0,y.Cb)()],tS.prototype,"renderPatchBorders",null),(0,i._)([(0,y.Cb)()],tS.prototype,"visualizeNormals",null),(0,i._)([(0,y.Cb)()],tS.prototype,"renderingDisabled",null),tS=eS=(0,i._)([(0,v.j)("esri.views.3d.terrain.TerrainSurface")],tS);const iS=tS,rS=(0,Pa.Ue)(),nS=(0,hh.c)(),sS=(0,Ds.Ue)();new Pg.Z;const oS=new $b.c("ground"),aS={spatialReference:null,extent:null,scale:0};function lS(e,t,i){for(const r of e){if(!r.containsPointXY(t,i))continue;let e=r;for(;e&&!e.renderData;){const r=(t>e.extentMidX?1:0)+(i<e.extentMidY?2:0);e=e.children[r]}return ew(t,i,e?.renderData?.geometryState.samplerData??null)}return null}class cS{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const t=this._tail;if(!(t<this.capacity))throw new Error("Queue full");this._data[t]=e,this._tail=t+1}pushAll(e){const t=e.length;if(0===t)return;const i=this._tail;if(!(i+t<=this.capacity))throw new Error("Queue full");for(let r=0;r<t;++r)this._data[i+r]=e[r];this._tail=i+t}pop(){const e=this._head;if(e<this._tail){const t=this._data[e];return this._head=e+1,t}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function uS(e,t){!e.leaf||e.level<Ba.qC||fS(e,(e=>{t&&hS(e);const i=pS(e);if(e.maxLevelDeltaNeighborCount++,i){let t=e.parent;for(;t;){const e=pS(t);if(t.unmergableChildCount++,!e)break;t=t.parent}}}))}function hS(e){if(e.hasPendingUpdate(cx.SPLIT))return;let t=e.parent;for(;t?.resetPendingUpdate(cx.MERGE);)t=t.parent;e.resetPendingUpdate(cx.MERGE),e.leaf&&e.setPendingUpdate(cx.SPLIT),e.level<Ba.qC||fS(e,(e=>{hS(e)}))}function dS(e){e.level<Ba.qC||fS(e,(e=>{if(e.maxLevelDeltaNeighborCount--,0===e.maxLevelDeltaNeighborCount&&0===e.unmergableChildCount){let t=e.parent;for(;t&&(t.unmergableChildCount--,pS(t));)t=t.parent}}))}function pS(e){return 0===e.maxLevelDeltaNeighborCount&&0===e.unmergableChildCount}function fS(e,t){if(e.level<Ba.qC)return;const i=e.level-Ba.qC,r=e.lij[1]>>Ba.qC,n=e.lij[2]>>Ba.qC,s=e=>e.leaf||e.level===i;for(let o=0;o<4;++o){const a=e.findNeighborTile(tw.OC[o],s);if(!a||a.level!==i)continue;const l=a.lij;l[1]===r&&l[2]===n||t(a)}}var mS=n(2236),gS=n(53448),yS=n(26982),_S=n(95399),vS=n(53464),bS=n(79341);class wS{constructor(e,t,i,r){this.operation=e,this.geometry=t,this.states=i,this.sync=r}}let xS=class extends P.Z{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyRecordCount=0}get dirty(){return this._dirtyRecordCount>0}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);if(!i)return;let r=0;i.forEach(((i,n)=>{const s=this._ensureGeomRecord(e,n);r+=i.size,i.forEach((({geometry:e,operation:i,states:r},o)=>{let a=!1;if(i===bS.T.UPDATE){const i=s.get(o);if(i){if(r&bS.$.TRANSFORMATION){const t=this.model.getObject(n);this.model.updateRenderGeometryTransformation(t,e,i)&&(a=!0)}a||t.updates.push({renderGeometry:i,updateType:r})}else(0,Lv.hu)(!1,"ModelDirtySet.commitLayer: invalid update")}if(i===bS.T.REMOVE||a){const e=s.get(o);e?(t.removes.push(e),s.delete(o)):i===bS.T.REMOVE&&(0,Lv.hu)(!1,"ModelDirtySet.commitLayer: invalid remove")}if(i===bS.T.ADD||a){const i=this.model.getObject(n);if(null!=i){const r=this.model.getRenderGeometry(i,e);t.adds.push(r),s.set(o,r)}}})),0===s.size&&this._residentGeomRecords.get(e).delete(n)})),0===this._residentGeomRecords.get(e).size&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this._dirtyRecordCount-=r}commitSyncUpdates(e,t){const i=this._dirtyGeomRecords.get(e);i&&i.forEach(((i,r)=>{const n=this._ensureGeomRecord(e,r);i.forEach((({geometry:e,operation:i,states:s,sync:o},a)=>{let l=!1;if(i===bS.T.UPDATE&&o){const i=n.get(a);if(i){if(s&bS.$.TRANSFORMATION){const t=this.model.getObject(r);this.model.updateRenderGeometryTransformation(t,e,i)&&(l=!0)}l||t.updates.push({renderGeometry:i,updateType:s})}else(0,Lv.hu)(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}}))}))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach((e=>e.forEach((e=>t.push(e)))))}_objectStateChanged(e,t){for(const i of t.geometries)this._updateOrCreateDirtyRecord(t,i,null,bS.T.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(bS.$.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(bS.$.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(bS.$.OCCLUDEE,e)}attributesChanged({object:e,geometry:t,sync:i}){this._updateOrCreateDirtyRecord(e,t,null,bS.T.UPDATE,bS.$.GEOMETRY,i)}layerAdded(e){e.objects.forAll((t=>this._layerObjectAdded(e,t)))}layerRemoved(e){e.objects.forAll((t=>this._layerObjectRemoved(e,t)))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const e of t.geometries)this._geometryAdded(t,e,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const e of t.geometries)this._geometryRemoved(t,e,i)}transformationChanged(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach((i=>{this._updateOrCreateDirtyRecord(e,i.geometry,t,bS.T.UPDATE,bS.$.TRANSFORMATION)}))}shaderTransformationChanged(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach((t=>{t.objectShaderTransformationChanged(e.shaderTransformation)}))}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,bS.T.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,bS.T.REMOVE)}_updateOrCreateDirtyRecord(e,t,i,r,n=bS.$.NONE,s=!1){i=i??this._getParentLayerId(e);const o=e.id,a=t.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const e=c.operation;e===bS.T.REMOVE&&r===bS.T.ADD&&c.states!==bS.$.NONE?c.operation=bS.T.UPDATE:e===bS.T.REMOVE&&r===bS.T.ADD||e===bS.T.ADD&&r===bS.T.REMOVE?(l.delete(a),this._dirtyRecordCount--):e!==bS.T.UPDATE||r!==bS.T.REMOVE&&r!==bS.T.UPDATE?((0,Lv.hu)((e===bS.T.REMOVE||e===bS.T.ADD)&&r===bS.T.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=r,c.states|=n),c.sync=c.sync||s}else l.set(a,new wS(r,t,n,s)),this._dirtyRecordCount++}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:by.J}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach(((i,r)=>{i.forEach(((i,n)=>{t.length>0&&(t+="\n"),t+=r+"."+n;const s=[];i.forEach((e=>{const t=e.operation;s[t]||(s[t]=[]),s[t].push(e.geometry.id)}));for(let i=0;i<s.length;i++)if(s[i]){t+=" "+e[i-1]+": ";for(let e=0;e<s[i].length;e++)t+=s[i][e]+", "}}))})),t}get test(){}};(0,i._)([(0,y.Cb)()],xS.prototype,"_dirtyRecordCount",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],xS.prototype,"model",void 0),xS=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.lib.ModelDirtySet")],xS);const TS=xS;var CS=n(13304);let SS=class extends P.Z{constructor(){super(...arguments),this.dirtySet=new TS({model:this}),this._content=new Map,this._originFactory=new vS.C(null)}getObject(e){return this._content.get(e)}add(e){const t=e.id;(0,Lv.hu)(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),(0,yS.e)(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),(0,yS.e)(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const t of e)t&&((0,Lv.hu)(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)t&&((0,Lv.hu)(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id))}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach((i=>{i.type===e&&t(i)}))}getRenderGeometry(e,t){const i=new CS.z(t,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});i.transformation=e.getCombinedStaticTransformation(t,ES);const{localOrigin:r}=t;return i.localOrigin=null!=r?r:this._originFactory.getOrigin((0,hh.a)(i.boundingSphere)),i}updateRenderGeometryTransformation(e,t,i){if(null==e)return!1;i.transformation=e.getCombinedStaticTransformation(t,ES);const r=this._originFactory.getOrigin((0,hh.a)(i.boundingSphere));return i.localOrigin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<_S.U.COUNT;++i)e[i]=t.filter((e=>e.type===i)).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};(0,i._)([(0,y.Cb)({constructOnly:!0})],SS.prototype,"dirtySet",void 0),SS=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.parts.Model")],SS);const ES=(0,Cl.Ue)();var MS=n(73534),AS=n(39043),RS=n(56011),OS=n(53737);class PS extends RS.o{constructor(){super(...arguments),this.innerFadeDistance=0,this.altitudeFade=0,this.backgroundColor=(0,Pa.Ue)()}}class IS extends Al.A{constructor(e,t){super(e,t,new Ml.J(OS.C,(()=>n.e(37686).then(n.bind(n,37686)))))}initializePipeline(e){return(0,Ol.sm)({blending:e.reduced?Ol.di:(0,Ol.if)(Rl.zi.SRC_ALPHA,Rl.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.reduced?Rl.wb.ALWAYS:Rl.wb.LEQUAL},colorWrite:Ol.gf})}}class LS extends GT.m{constructor(){super(...arguments),this.reduced=!1}}(0,i._)([(0,GT.o)()],LS.prototype,"reduced",void 0);var DS=n(37503);let NS=class extends ec.Z{constructor(){super(...arguments),this.produces="disabled",this.consumes={required:[Zl.CM.OPAQUE_ENVIRONMENT]}}_enable(){this.produces=Zl.CM.OPAQUE_ENVIRONMENT,this.requestRender(tc.Xx.UPDATE)}_disable(){this.produces="disabled",this.requestRender(tc.Xx.UPDATE)}};(0,i._)([(0,y.Cb)()],NS.prototype,"produces",void 0),(0,i._)([(0,y.Cb)()],NS.prototype,"consumes",void 0),NS=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.effects.OpaqueEnvironment")],NS);var FS=n(83232);class US extends Al.A{constructor(e,t){super(e,t,new Ml.J(FS.a,(()=>n.e(1542).then(n.bind(n,1542)))))}initializePipeline(){return(0,Ol.sm)({blending:(0,Ol.if)(Rl.zi.SRC_ALPHA,Rl.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Rl.wb.ALWAYS},colorWrite:Ol.gf})}}let kS=class extends NS{constructor(){super(...arguments),this.requireGeometryDepth=!0,this._compositingPassParameters=new FS.A,this._vao=null,this._passParameters=new PS,this._configuration=new LS}initialize(){this.techniques.precompile(IS,this._configuration),this.techniques.precompile(US),this._configuration.reduced=!0,this.techniques.precompile(IS,this._configuration),this._configuration.reduced=!1,this.addHandles([(0,F.watch)((()=>this.view.environment.background),(e=>{const t=e instanceof Xu?(0,AS.O)(e.color):rf.AG;(0,hr.i)(this._passParameters.backgroundColor,t[0]*t[3],t[1]*t[3],t[2]*t[3])}),F.syncAndInitial),(0,F.watch)((()=>this.view._stage?.renderer?.fullResolutionAtmosphere),(e=>this._configuration.reduced=!e),F.syncAndInitial),(0,F.watch)((()=>this.view.environment.atmosphereEnabled),(e=>e?this._enable():this._disable()),F.syncAndInitial)])}destroy(){this._vao=(0,m.M2)(this._vao)}render(e){const t=e.find((({name:e})=>e===Zl.CM.OPAQUE_ENVIRONMENT));if(!this.bindParameters.mainDepth)return t;const i=this.renderingContext;this._vao??=(0,iC.ow)(i,iC.Ar.Pos2Tex);const r=t.getAttachment(i.gl.DEPTH_STENCIL_ATTACHMENT);this._update();const n=this.techniques.get(IS,this._configuration);if(!n.compiled)return this.requestRender(tc.Xx.UPDATE),t;if(!this._configuration.reduced)return t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(n,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(Rl.MX.TRIANGLE_STRIP,0,4),t.attachDepth(r),t;const s=this.techniques.get(US);if(!s.compiled)return this.requestRender(tc.Xx.UPDATE),t;const o=i.getViewport(),a=this.bindParameters.camera,l=(0,hr.l)(a.eye)-il.sv.radius;let c;const u=il.sv.atmosphereHeight;if(l<u){const e=Math.min(1,Math.max(0,l/u));c=(0,yt.t7)(.2,.3,e)}else{const e=Math.min(1,Math.max(0,(l-u)/(15*u)));c=(0,yt.t7)(.3,.6,e)}const h=(0,uw.nq)(Math.round(c*a.fullViewport[2])),d=(0,uw.nq)(Math.round(c*a.fullViewport[3]));i.setViewport(0,0,h,d);const p=this.fboCache.acquire(h,d,"chapman",DS.q.RGBA);return i.bindFramebuffer(p.fbo),i.clearFramebuffer([0,0,0,1],!0,!0),i.bindTechnique(n,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(Rl.MX.TRIANGLE_STRIP,0,4),i.setViewport(o.x,o.y,o.width,o.height),this._compositingPassParameters.color=p.getTexture(),t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(s,this.bindParameters,this._compositingPassParameters),i.screen.draw(),t.attachDepth(r),p.release(),t}_update(){const e=this.bindParameters.camera,t=(0,hr.k)(e.eye),i=Math.sqrt(t),r=t-this._passParameters.radii[1]**2,n=(0,yt.uZ)((i-this._passParameters.radii[0])/il.sv.atmosphereHeight,0,1);(0,tf.s)(this._passParameters.heightParameters,i,t,r,n);const s=this.view.basemapTerrain?.getLowerBoundRadius()??0;(0,ci.t8)(this._passParameters.radii,s,s+il.sv.atmosphereHeight),this._passParameters.innerFadeDistance=2*Math.sqrt((2*s-nf.Tk)*nf.Tk),this._passParameters.altitudeFade=(0,nf.yx)(i-s)}};kS=(0,i._)([(0,v.j)("esri.views.3d.environment.ChapmanAtmosphere")],kS);var zS=n(35127);class BS extends Al.A{constructor(e,t){super(e,t,new Ml.J(zS.C,(()=>n.e(47068).then(n.bind(n,47068)))))}initializePipeline(){return(0,Ol.sm)({blending:(0,Ol.wK)(Rl.zi.ONE,Rl.zi.ZERO,Rl.zi.SRC_ALPHA,Rl.zi.ONE),depthTest:{func:Rl.wb.LEQUAL},colorWrite:Ol.gf})}}let VS=class extends NS{constructor(e){super(e),this._planetRadius=(0,_l.Iu)(e.view.spatialReference).radius}initialize(){this.techniques.precompile(BS),this.addHandles([(0,F.watch)((()=>null!=this.view.environment.weather&&this.view.environment.atmosphereEnabled),(e=>e?this._enable():this._disable()),F.initial)])}destroy(){this._vao=(0,m.M2)(this._vao)}render(e){const t=e.find((({name:e})=>e===Zl.CM.OPAQUE_ENVIRONMENT)),i=this.bindParameters.clouds;if(!i.data)return t;const r=this.techniques.get(BS);if(!r.compiled)return this.requestRender(tc.Xx.UPDATE),t;const n=this.renderingContext;this._vao??=(0,iC.ow)(n);const s=n.bindTechnique(r,this.bindParameters);return n.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),n.drawArrays(Rl.MX.TRIANGLE_STRIP,0,4),i.isFading&&this.requestRender(tc.Xx.UPDATE),t}};VS=(0,i._)([(0,v.j)("esri.views.3d.environment.CloudsComposition")],VS);var HS=n(28539);class GS extends Al.A{constructor(e,t){super(e,t,new Ml.J(HS.a,(()=>n.e(43154).then(n.bind(n,43154)))))}initializePipeline(){return(0,Ol.sm)({blending:(0,Ol.wK)(Rl.zi.SRC_ALPHA,Rl.zi.ZERO,Rl.zi.ONE_MINUS_SRC_ALPHA,Rl.zi.ONE),colorWrite:Ol.gf})}}let jS=class extends NS{constructor(){super(...arguments),this.consumes={required:[Zl.CM.TRANSPARENT_ENVIRONMENT]}}_enable(){this.produces=Zl.CM.TRANSPARENT_ENVIRONMENT,this.requestRender(tc.Xx.UPDATE)}};(0,i._)([(0,y.Cb)()],jS.prototype,"consumes",void 0),jS=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.effects.TransparentEnvironment")],jS);let ZS=class extends jS{constructor(e){super(e),this.requireGeometryDepth=!0,this._newParameters=new qS,this._oldParameters=new qS,this._fadedParameters=new qS,this._parameters=this._newParameters,this._passParameters=new HS.F;const t=(0,_l.Iu)(e.view.spatialReference);this._planetRadius=t.radius,this._atmosphereRadius=t.radius+t.atmosphereHeight,e.view._stage.renderView.techniques.precompile(GS)}toogle(){this.view.environment.atmosphereEnabled&&this.view.environment.weather?this._enable():this._disable()}initialize(){this.addHandles([(0,F.watch)((()=>this.view.environment.atmosphereEnabled),(()=>this.toogle()),F.syncAndInitial),(0,F.watch)((()=>this.view.environment.weather),(()=>this.toogle()),F.syncAndInitial),(0,F.watch)((()=>this._updateFogParameters()),(()=>{}),F.syncAndInitial)]),this.addHandles((0,F.watch)((()=>this._fadeFactor),(e=>this._fade(e)),F.syncAndInitial))}get _fadeFactor(){return this.view._stage?.renderer.renderContext.bind.clouds.fadeFactor??1}_fade(e){const{_newParameters:t,_oldParameters:i}=this;e>=1?(this._parameters=t,this._oldParameters.copyFrom(this._newParameters)):e<=0?this._parameters=i:(this._fadedParameters.lerp(i,t,e),this._parameters=this._fadedParameters)}_updateFogParameters(){const e=this.view.environment.weather,t="foggy"===e.type||"snowy"===e.type||"rainy"===e.type;this._newParameters.strength="foggy"===e.type?(0,yt.t7)(3e-5,.005,e.fogStrength**3):"snowy"===e.type||"rainy"===e.type?(0,yt.t7)(4e-6,2e-4,(e.precipitation??0)**3):0,this._newParameters.amount=t?1:0,"foggy"!==e.type&&"snowy"!==e.type||(0,hr.c)(this._newParameters.color,JS),"rainy"===e.type&&(0,hr.c)(this._newParameters.color,YS),this._fadeFactor>=1&&this._oldParameters.copyFrom(this._newParameters),this.requestRender(tc.Xx.UPDATE)}render(e){const t=e.find((({name:e})=>e===Zl.CM.TRANSPARENT_ENVIRONMENT));if(0===this._parameters.amount)return t;if(this._update(),this._passParameters.amount<=0)return t;const i=this.techniques.get(GS);if(!i.compiled)return this.requestRender(tc.Xx.UPDATE),t;const r=this.renderingContext,n=t.getAttachment(r.gl.DEPTH_STENCIL_ATTACHMENT);return t.attachDepth(null),r.bindFramebuffer(t.fbo),r.bindTechnique(i,this.bindParameters,this._passParameters),r.screen.draw(),t.attachDepth(n),t}_update(){const e=this.bindParameters.camera;(0,hr.n)(WS,e.eye);const t=Math.max(0,(0,hr.f)(WS,this.bindParameters.lighting.mainLight.direction)),i=this._parameters.color;(0,hr.h)($S,i,.1),(0,hr.m)(this._passParameters.color,$S,i,t);const r=(0,hr.l)(e.eye);this._passParameters.atmosphereC=r**2-this._atmosphereRadius**2,this._passParameters.amount=(1-(0,yt.CW)(.95*cc.rm,1*cc.rm,Math.abs(r-this._planetRadius)))*this._parameters.amount,this._passParameters.strength=this._parameters.strength}};ZS=(0,i._)([(0,v.j)("esri.views.3d.environment.Fog")],ZS);class qS{constructor(){this.color=(0,Pa.Ue)(),this.strength=0,this.amount=0}copyFrom(e){this.amount=e.amount,this.strength=e.strength,(0,hr.c)(this.color,e.color)}lerp(e,t,i){this.amount=(0,yt.t7)(e.amount,t.amount,i),this.strength=(0,yt.t7)(e.strength,t.strength,i),(0,hr.m)(this.color,e.color,t.color,i)}}const WS=(0,Pa.Ue)(),$S=(0,Pa.Ue)(),YS=(0,Pa.al)(.5,.5,.5),JS=(0,Pa.al)(1.5,1.5,1.5);var XS=n(41938),KS=n(28876);class QS extends Al.A{constructor(e,t){super(e,t,new Ml.J(XS.a,(()=>n.e(43456).then(n.bind(n,43456)))))}initializePipeline(e){const t=e.geometry===KS.n.Cylinder;return(0,Ol.sm)({blending:Ol.Dh,culling:t?Ol.Rd:void 0,depthTest:{func:Rl.wb.LEQUAL},colorWrite:Ol.gf})}}const eE=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);var tE=n(5474),iE=n(6087);let rE=class extends NS{constructor(){super(...arguments),this._configuration=new KS.f,this._passParameters=new XS.S,this._vao=null,this._vaoCount=0}initialize(){this._configuration.geometry=KS.n.Cylinder,this.addHandles([(0,F.watch)((()=>this.view.environment.atmosphereEnabled),(e=>e?this._enable():this._disable()),F.initial)])}destroy(){this._passParameters.texture=(0,m.M2)(this._passParameters.texture),this._vao=(0,m.M2)(this._vao)}precompile(){this.techniques.precompile(QS,this._configuration)}render(e){const t=e.find((({name:e})=>e===Zl.CM.OPAQUE_ENVIRONMENT)),i=this.techniques.get(QS,this._configuration);if(!i.compiled)return this.requestRender(tc.Xx.UPDATE),t;const r=this.renderingContext;if(this._vao||(this._vao=function(e){const t=(0,iE.xu)(1,2,!1),{data:i,indices:r}=t[0][1],n=sE.createBuffer(r.length),s=n.position;for(let e=0;e<r.length;++e){const t=3*r[e%3==0?e+2:e%3==2?e-2:e];s.set(e,0,i[t]),s.set(e,1,i[t+1]),s.set(e,2,i[t+2])}return new ic.U(e,tE.i,new Map([["geometry",(0,Kl.K)(sE)]]),new Map([["geometry",rc.f.createVertex(e,Rl.l1.STATIC_DRAW,n.buffer)]]))}(r),this._vaoCount=(0,nc._V)(this._vao,"geometry")),!this._passParameters.texture){const e=new Ul.X;e.wrapMode=Rl.e8.CLAMP_TO_EDGE,e.flipped=!0,e.width=1,e.height=512,this._passParameters.texture=new rC.x(r,e,eE)}const n=r.bindTechnique(i,this.bindParameters,this._passParameters);return function(e,t){(0,Tl.JG)(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}(nE,this.bindParameters.camera.viewMatrix),n.setUniformMatrix4fv("view",nE),r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Rl.MX.TRIANGLES,0,this._vaoCount),t}};rE=(0,i._)([(0,v.j)("esri.views.3d.environment.LocalAtmosphere")],rE);const nE=(0,Cl.Ue)(),sE=(0,Ql.U$)().vec3f(Wl.T.POSITION);var oE=n(31725);const aE=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),lE=128,cE=-1e4,uE=(0,rl.uV)([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let hE=class extends NS{constructor(e){super(e),this._passParameters=new XS.S,this._configuration=new KS.f,this._vao=null,this._vaoCount=0,this._fadeVao=null,this._fadeVaoCount=0,this._texV1=1;const t=e.view,i=(0,_l.Iu)(t.spatialReference),{outerAtmosphereRimWidth:r,radius:n}=i;this._planetRadius=n,this._innerRimFactor=1+cE/n,this._middleRimFactor=1+0/n,this._outerRimFactor=1+r/n,this._texV0=0/r,this._texVScale=this._texV1-this._texV0;const s=t._stage.renderView.techniques;s.precompile(QS,this._configuration),this._configuration.geometry=KS.n.Underground,s.precompile(QS,this._configuration)}initialize(){this.addHandles((0,F.watch)((()=>this.view.environment.atmosphereEnabled),(e=>e?this._enable():this._disable()),F.initial))}destroy(){this._passParameters.texture=(0,m.M2)(this._passParameters.texture),this._fadeVao=(0,m.M2)(this._fadeVao),this._vao=(0,m.M2)(this._vao)}render(e){const t=e.find((({name:e})=>e===Zl.CM.OPAQUE_ENVIRONMENT));this._update();const i=this.renderingContext;if(!this._passParameters.texture){const e=new Ul.X;e.wrapMode=Rl.e8.CLAMP_TO_EDGE,e.flipped=!0,e.width=1,e.height=512,this._passParameters.texture=new rC.x(i,e,aE)}if(this._passParameters.undergroundFadeAlpha<1){this._vao||(this._vao=this._createRibbon(i),this._vaoCount=(0,nc._V)(this._vao,"geometry")),this._configuration.geometry=KS.n.Cone;const e=this.techniques.get(QS,this._configuration);if(!e.compiled)return this.requestRender(tc.Xx.UPDATE),t;i.bindTechnique(e,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(Rl.MX.TRIANGLES,0,this._vaoCount)}if(this._passParameters.undergroundFadeAlpha>0){this._fadeVao||(this._fadeVao=(0,iC.ow)(i),this._fadeVaoCount=(0,nc._V)(this._fadeVao,"geometry")),this._configuration.geometry=KS.n.Underground;const e=this.techniques.get(QS,this._configuration);if(!e.compiled)return this.requestRender(tc.Xx.UPDATE),t;i.bindTechnique(e,this.bindParameters,this._passParameters),i.bindVAO(this._fadeVao),i.drawArrays(Rl.MX.TRIANGLE_STRIP,0,this._fadeVaoCount)}return t}_update(){const e=this.bindParameters.camera,t=(0,Pa.Ue)(),i=this._planetRadius,r=(0,hr.l)(e.eye),n=r-i;if(n<0){const e=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=e}else this._passParameters.undergroundFadeAlpha=0;const s=Math.max(50,n),o=i+cE;this._passParameters.innerScale=function(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}(i+s,i,o)-1,this._passParameters.altitudeFade=(0,nf.yx)(n),(0,hr.h)(t,e.eye,(i+50)/r),dE(t,e.center,e.up,i,this._passParameters.silhouette);const a=this._computeScreenRimWidth(e,t,e.up,this._passParameters.silhouette),l=1-511/512,c=uE(n);let u=this._texV0+l*this._texVScale,h=this._texV0+a*c*this._texVScale;if(n>50){dE(e.eye,e.center,e.up,i,this._passParameters.silhouette);const t=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),r=(0,yt.uZ)((t-1.5)/(a-1.5),0,1);u=this._texV0+r*l*this._texVScale,h=this._texV0+(0,yt.t7)(this._texV1,a*c,r)*this._texVScale}(0,ci.t8)(this._passParameters.texV,u,h)}_createRibbon(e){const t=(0,oE.xx)(1155),i=new Uint32Array(1920);t[0]=0,t[1]=0,t[2]=-1;for(let e=0;e<lE;e++){const r=9*e+3;t[r]=e,t[r+1]=this._innerRimFactor,t[r+2]=-1,t[r+3]=e,t[r+4]=this._middleRimFactor,t[r+5]=0,t[r+6]=e,t[r+7]=this._outerRimFactor,t[r+8]=1;const n=3*e+1,s=127===e?1:n+3,o=15*e;i[o]=n,i[o+1]=n+1,i[o+2]=s+1,i[o+3]=s+1,i[o+4]=s,i[o+5]=n,i[o+6]=n+1,i[o+7]=n+2,i[o+8]=s+2,i[o+9]=s+2,i[o+10]=s+1,i[o+11]=n+1,i[o+12]=n,i[o+13]=s,i[o+14]=0}const r=gE.createBuffer(i.length),n=r.position;for(let e=0;e<i.length;++e){const r=3*i[e];n.set(e,0,t[r]),n.set(e,1,t[r+1]),n.set(e,2,t[r+2])}return new ic.U(e,tE.i,new Map([["geometry",(0,Kl.K)(gE)]]),new Map([["geometry",rc.f.createVertex(e,Rl.l1.STATIC_DRAW,r.buffer)]]))}_computeScreenRimWidth(e,t,i,r){return(0,hr.g)(fE,r.center,r.v2),(0,hr.h)(mE,fE,this._outerRimFactor),(0,Tl.zB)(pE,t,fE,i),(0,Lv.iV)(fE,pE,e.projectionMatrix,e.viewport,fE),(0,Lv.iV)(mE,pE,e.projectionMatrix,e.viewport,mE),(0,hr.j)(fE,mE)/e.height}};function dE(e,t,i,r,n){const s=(0,hr.l)(e),o=r*Math.sqrt(s*s-r*r)/s,a=Math.sqrt(r*r-o*o),l=n.v1,c=n.v2;return(0,hr.h)(n.center,e,a/s),(0,hr.e)(l,e,t),(0,hr.k)(l)<1&&(0,hr.e)(l,e,i),(0,hr.h)(l,l,o/(0,hr.l)(l)),(0,hr.e)(c,l,e),(0,hr.h)(c,c,o/(0,hr.l)(c)),o}hE=(0,i._)([(0,v.j)("esri.views.3d.environment.MarsAtmosphere")],hE);const pE=(0,Cl.Ue)(),fE=(0,Pa.Ue)(),mE=(0,Pa.Ue)();const gE=(0,Ql.U$)().vec3f(Wl.T.POSITION),yE=hE;var _E=n(86098),vE=n(35914),bE=n(6766),wE=n(14789),xE=n(66352),TE=n(47850);class CE{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return 0===this._indexRanges.length}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const t=this._indexRanges;let i=0,r=t.length/2;if(e<t[2*i]||e>t[2*r]+t[2*r+1])return!1;for(;r-i>0;){const n=Math.floor(.5*(i+r)),s=t[2*n];if(e<s){if(r-i==1)return!1;r=n}else{if(e<s+t[2*n+1])return!0;if(r-i==1)return!1;i=n+1}}return!1}}get componentCount(){if(-1===this._componentCountCache){const e=this._indexRanges;let t=0;for(let i=0;i<e.length;i+=2)t+=e[i+1];this._componentCountCache=t}return this._componentCountCache}reset(e){"all"===e||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=function(e){const t=new Array;if(0===e.length)return t;let i=e[0],r=1;for(let n=1;n<e.length;n++){const s=e[n];i+r===s?r+=1:(t.push(i),t.push(r),i=s,r=1)}return t.push(i),t.push(r),t}(e),this._componentCountCache=-1}forEachComponent(e){const t=this._indexRanges;for(let i=0;i<t.length;i+=2){const r=t[i],n=r+t[i+1];for(let t=r;t<n;t++)if(!e(t))return!1}return!0}forEachComponentRange(e){const t=this._indexRanges;for(let i=0;i<t.length;i+=2){const r=t[i];if(!e(r,r+t[i+1]))return!1}return!0}computeOffsetRanges(e){const t=new Array(this._indexRanges.length),i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r],s=n+i[r+1],o=e[n],a=e[s];t[r]=o,t[r+1]=a-o}return t}}class SE{constructor(e,t){this.offsets=t,this._highlightsInOrder=[],this.pickability=null,this.componentHighlights=new Map,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRangesMap=null,this.cachedShadowmapRanges=null;const i=this.count;this.visibility=new CE(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let e=0;e<i;e++)this.materialDataIndices[e]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRangesMap(){return 0===this.componentHighlights.size?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRangesMap)}get shadowmapRanges(){return 0===this.componentHighlights.size?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedShadowmapRanges)}markHighlightsDirty(){this.cachedHighlightRangesMap=null,this.cachedShadowmapRanges=null}markVisibilityDirty(){this.cachedGeometryRanges=null,this.markHighlightsDirty()}updateHighlights(e){this._updateHighlightOrder(e)&&(this.markHighlightsDirty(),this._updateCachedHighlightRanges())}_updateHighlightOrder(e){const{_highlightsInOrder:t}=this;let i=t.length!==e.length;t.length=Math.min(e.length,8);for(let r=0;r<e.length;++r){const n=e.at(r).name;t.length<r?(i=!0,t.push(n)):t[r]!==n&&(t[r]=n,i=!0)}return i}_updateCachedHighlightRanges(){if(null==this.cachedHighlightRangesMap||null==this.cachedShadowmapRanges){const{highlightRangesMap:e,shadowmapRangesMap:t}=function(e,t,i,r){const n=new Map,s=[];if(e.size>0){let o=i.length;t.forEachComponent((t=>{let a=!1;for(let s=r.length-1;s>=0;--s){const o=r[s];if((e.get(o)?.[t]??0)>0){const e=(0,Ve.s1)(n,o,(()=>[])),r=i[t],s=i[t+1];e.push(r),e.push(s-r),a||=o===At.b;break}}return a||(o!==t-1&&(s.length>0&&s.push(i[o+1]-s[s.length-1]),s.push(i[t])),o=t),!0})),s.length>0&&s.push(i[o+1]-s[s.length-1])}return{highlightRangesMap:n,shadowmapRangesMap:s}}(this.componentHighlights,this.visibility,this.offsets,this._highlightsInOrder);this.cachedHighlightRangesMap=e,this.cachedShadowmapRanges=t}}}class EE{constructor(e,t,i,r,n,s){this.transform=e,this.toMapSpace=t,this.obb=i,this.componentData=r,this.renderable=n,this.intersectionGeometry=s,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=(0,m.SC)(this.intersectionGeometry),this.renderable=(0,m.SC)(this.renderable),this.componentData=(0,m.SC)(this.componentData)}}function ME(e,t){return new(function(e){return e<128?Uint8Array:e<32768?Uint16Array:e<1<<31?Uint32Array:Array}(e))(t)}class AE{constructor(e,t){this.elementCount=e,this.model=t,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=t.localMode,this.planetCenterZ=t.planetCenterZ,this.geometryMinZ=t.geometryMinZ,this.planetCenter=(0,Pa.al)(0,0,this.planetCenterZ),this.maxBspNodeDepth=t.maxBspNodeDepth??8,this.minElementCountForBVH=t.minElementCountForBVH??15,this.minBspNodeElementCount=t.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||0===this._bspNodes.length&&this._generateBsp()}intersectRay(e,t,i){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(i):this._intersectRayWithBVH(e,t,i))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,t){this.model.intersectRange(e,t)}_intersectRayWithBVH(e,t,i){this._ensureBVH(),i?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,t)}_intersectGeometryWithBVHVerticalRay(e){let t=e[0],i=e[1];if(!this.localMode){const{geometryMinZ:r,planetCenterZ:n}=this,s=(r-n)/(e[2]-n);t=e[0]*s,i=e[1]*s}const{_bspNodes:r}=this;let n=0;for(;n>=0;){const e=r[n],{d:s,dim:o,minIndexIndex:a,minMidIndexIndex:l,maxMidIndexIndex:c,maxIndexIndex:u,aabb2D:h}=e;if(t<h[0]||t>h[2]||i<h[1]||i>h[3])break;if(-1===o||-1===e.child0&&-1===e.child1){this._intersectRange(a,u);break}{this._intersectRange(l,c);const r=(0===o?t:i)-s;if(r<0){if(-1===e.child0){this._intersectRange(a,l);break}n=e.child0}else{if(!(r>0))break;if(-1===e.child1){this._intersectRange(c,u);break}n=e.child1}}}}_intersectGeometryWithBVHGeneralRay(e,t){let i=e[0],r=e[1],n=t[0],s=t[1];const{geometryMinZ:o}=this;if(!this.localMode){let a=0,l=1;const c=Math.min(.5*this.planetCenterZ,o),u=e[2],h=t[2];if(u<c&&h<c)return;if(u<c&&(a=(c-u)/(h-u)),h<c&&(l=(c-u)/(h-u)),a>l)return;const d=(1-a)*e[0]+a*t[0],p=(1-a)*e[1]+a*t[1],f=(1-a)*e[2]+a*t[2],m=(1-l)*e[0]+l*t[0],g=(1-l)*e[1]+l*t[1],y=(1-l)*e[2]+l*t[2],{planetCenterZ:_}=this,v=o-_,b=v/(f-_);i=d*b,r=p*b;const w=v/(y-_);n=m*w,s=g*w}const a=n-i,l=s-r,c=this._bspNodes;let u=1;{const{aabb2D:e}=c[0],t=(e,t,i,r)=>{if(Math.abs(t)<1e-5*Math.max(r-i,1))return!1;const n=t>0,s=n?r:i,o=e+u*t;return(n?o<s:o>s)&&(u=Math.max((s-e)/t,u),!0)},n=()=>t(i,a,e[0],e[2]),s=()=>t(r,l,e[1],e[3]);Math.abs(a)>=Math.abs(l)?n()||s():s()||n()}const h=[0,0,u];let d=0;for(;d<h.length;){const e=h[d];let t=h[d+1],n=h[d+2];if(d+=3,t>n)continue;const s=c[e],{minIndexIndex:o,maxIndexIndex:p}=s,{child0:f,child1:m,minMidIndexIndex:g,maxMidIndexIndex:y,aabb2D:_,d:v,dim:b}=s;{const e=i+t*a,r=i+n*a,s=Math.min(e,r),o=Math.max(e,r),l=_[0],c=_[2];if(o<l||c<s)continue;if(s<l){const e=(l-i)/a;a>0?t=Math.max(t,e):n=Math.min(n,e)}if(c<o){const e=(c-i)/a;a>0?n=Math.min(n,e):t=Math.max(t,e)}}{const e=r+t*l,i=r+n*l,s=Math.min(e,i),o=Math.max(e,i),a=_[1],c=_[3];if(o<a||c<s)continue;if(s<a){const e=(a-r)/l;l>0?t=Math.max(t,e):n=Math.min(n,e)}if(c<o){const e=(c-r)/l;l>0?n=Math.min(n,e):t=Math.max(t,e)}}if(-1===f&&-1===m)this._intersectRange(o,p);else{const e=0===b?i:r,s=0===b?a:l,c=e+t*s,d=e+n*s,_=Math.min(c,d),w=Math.max(c,d),x=(0,yt.uZ)((v-e)/s,0,u);o<g&&_<=v&&(-1!==f?(h.push(f),h.push(s>=0?t:Math.max(t,x)),h.push(s>=0?Math.min(n,x):n)):this._intersectRange(o,g)),this._intersectRange(g,y),y<p&&v<=w&&(-1!==m?(h.push(m),h.push(s>=0?Math.max(t,x):t),h.push(s>=0?n:Math.min(n,x))):this._intersectRange(y,p))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const t=ME(e,e);this._elementIndexMap=t;for(let i=0;i<e;++i)t[i]=i;const i=this.model.getAabbs2D();let r=0;const n=this._bspNodes;n.length=0;const{localMode:s}=this;let o=!1;if(!s){const{planetCenterZ:e,geometryMinZ:t}=this;o=e>=0||t<.5*e}const a=[],l=(e,t,i,r,n)=>{a.push(e),a.push(t),a.push(i),a.push(r<0?-1:(n?0:1)+2*r)},{maxBspNodeDepth:c,minBspNodeElementCount:u}=this,h=(e,r,a,h,d)=>{const p=n.length;if(p>0&&(o||a>=c||r-e<u))return;const f=[0,0,0,0];!function(e,t,i,r,n){let s=1/0,o=1/0,a=-1/0,l=-1/0;for(let e=t;e<i;++e){const t=4*r[e];s=Math.min(s,n[t+0]),o=Math.min(o,n[t+1]),a=Math.max(a,n[t+2]),l=Math.max(l,n[t+3])}e[0]=s,e[1]=o,e[2]=a,e[3]=l}(f,e,r,t,i);const{d:m,dim:g}=s?function(e){const t=e[0],i=e[1],r=e[2],n=e[3];let s,o;return r-t>=n-i?(o=.5*(t+r),s=0):(o=.5*(i+n),s=1),{d:o,dim:s}}(f):function(e){const t=e[0],i=e[1],r=e[2],n=e[3];let s,o;return r-t>=n-i?(s=0,o=.5*(t+r)):(s=1,o=.5*(i+n)),{dim:s,d:o}}(f),{rangeMidStart:y,rangeMidEnd:_}=function(e,t,i,r,n,s){let o=e;{let e=t;for(;o<e;){const t=n[o];RE(t,i,r,s)<0?++o:(--e,n[o]=n[e],n[e]=t)}}const a=o;let l=o,c=t;for(;l<c;){const e=n[c-1];RE(e,i,r,s)>0?--c:(n[c-1]=n[l],n[l]=e,++l)}return{rangeMidStart:a,rangeMidEnd:c}}(e,r,g,m,t,i),v=a===c-1,b=!v&&y>=e+u,w=!v&&r>=_+u;if(b||w||0===p){const t=new OE(e,y,_,r,g,m,f);if(b&&l(e,y,a+1,p,!0),w&&l(_,r,a+1,p,!1),n.push(t),-1!==h){const e=n[h];d?e.child0=p:e.child1=p}}};for(l(0,e,0,-1,!1);r<a.length;){const e=a[r],t=a[r+1],i=a[r+2],n=a[r+3];r+=4;const s=n>>1;h(e,t,i,s,n-(s<<1)==0)}this._generatedBVH=!0}}function RE(e,t,i,r){const n=4*e,s=r[n+0+t];return r[n+2+t]<i?-1:s>i?1:0}class OE{constructor(e,t,i,r,n,s,o){this.minIndexIndex=e,this.minMidIndexIndex=t,this.maxMidIndexIndex=i,this.maxIndexIndex=r,this.dim=n,this.d=s,this.aabb2D=o,this.child0=-1,this.child1=-1}}class PE{constructor(e,t,i,r,n,s,o,a,l){this.componentIndex=e,this.vertexData=t,this.vertexStride=i,this.indexData=r,this.startTriangleNumber=n,this.endTriangleNumber=s,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=(0,Pa.Ue)(),this.ray0=(0,Pa.Ue)(),this.isVerticalRay=!1,this._triangleHitCallback=LE,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new AE(s-n,this)}getAabbs2D(){return this.localMode?function(e,t,i,r,n){const s=t-e,o=new Float64Array(4*s);for(let t=0;t<s;++t){const s=3*(t+e),a=n*i[s+0],l=r[a+0],c=r[a+1],u=n*i[s+1],h=r[u+0],d=r[u+1],p=n*i[s+2],f=r[p+0],m=r[p+1],g=4*t;o[g+0]=Math.min(l,h,f),o[g+1]=Math.min(c,d,m),o[g+2]=Math.max(l,h,f),o[g+3]=Math.max(c,d,m)}return o}(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):function(e,t,i,r,n,s,o){const a=s-o,l=t-e,c=new Float64Array(4*l);for(let t=0;t<l;++t){const s=3*(t+e),l=n*i[s+0],u=r[l+0],h=r[l+1],d=a/(r[l+2]-o),p=u*d,f=h*d,m=n*i[s+1],g=r[m+0],y=r[m+1],_=a/(r[m+2]-o),v=g*_,b=y*_,w=n*i[s+2],x=r[w+0],T=r[w+1],C=a/(r[w+2]-o),S=x*C,E=T*C,M=4*t;c[M+0]=Math.min(p,v,S),c[M+1]=Math.min(f,b,E),c[M+2]=Math.max(p,v,S),c[M+3]=Math.max(f,b,E)}return c}(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,t,i,r,n,s){(0,hr.c)(this.ray0,e),(0,hr.a)(this.rayDirection,t,e),this.isVerticalRay=i,this.totalElevationOffset=r,this.normalRequired=s,this._triangleHitCallback=n,this._bvh.intersectRay(e,t,i),this._triangleHitCallback=LE}intersectRange(e,t){const i=this._bvh.elementIndexMap;IE(this.ray0,this.rayDirection,e,t,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,i,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}}function IE(e,t,i,r,n,s,o,a,l,c,u,h=null,d=0){0!==a?(0,oT.ko)(e,t,i,r,n,s,o,a,l,c,u,h,d):(0,oT.ET)(e,t,i,r,n,s,o,c,u,h,d)}function LE(){}function DE(e,t,i,r){if(i>=t)return e;null==e&&(e=function(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}());const n=e.isVisibleBit;let s=e.data;const o=FE(s),a=i/o|0,l=i-o*a,c=(t-1)/o|0,u=s,h=r===n;if(!(i<u.length*o)&&h){const e=a+1,t=Math.ceil(u.length*Xe._x),i=c+1;let r=Math.max(e,t);r=Math.min(r,i),s=new Uint32Array(r),s.set(u)}return a<s.length&&(s[a]=function(e,t,i){return e&~(1<<t)|(i?1:0)<<t}(s[a],l,h)),e.data=s,e}function NE(e,t){if(null==e)return!0;const{isVisibleBit:i,data:r}=e,n=FE(r);return t<r.length*n?function(e,t,i,r){const n=i/r|0,s=i-n*r;return function(e,t){return!!(e&1<<t)}(t[n],s)===e}(i,r,t,n):!e.isVisibleBit}function FE(e){return 8*e.BYTES_PER_ELEMENT}class UE{constructor(e,t,i,r,n,s,o,a){this.vertexData=e,this.vertexStride=t,this.indexData=i,this._components=r,this._componentAabbs3D=n,this.geometryMinZ=s,this.planetCenterZ=o,this.localMode=a,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=VE,this._ray1=HE,this._invDir=(0,Pa.Ue)(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=jE,this._callback=GE,this.rayDirectionC=(0,Pa.Ue)(),this._componentIndexMap=null,this._bvh=new AE(r.count,this),this.componentIntersectionData=new Array(r.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:t,minZGlobal:i}=this,r=new Float64Array(4*e),n=this._componentAabbs3D;for(let s=0;s<e;++s){const e=6*s,o=n[e+0],a=n[e+1],l=n[e+2],c=n[e+3],u=n[e+4],h=i/(l-t),d=i/(n[e+5]-t),p=Math.min(o*h,o*d),f=Math.min(a*h,a*d),m=Math.max(c*h,c*d),g=Math.max(u*h,u*d),y=4*s;r[y+0]=p,r[y+1]=f,r[y+2]=m,r[y+3]=g}return r}getAabbs2DLocal(){const{numComponents:e}=this,t=new Float64Array(4*e),i=this._componentAabbs3D;for(let r=0;r<e;++r){const e=6*r,n=i[e+0],s=i[e+1],o=i[e+3],a=i[e+4],l=4*r;t[l+0]=n,t[l+1]=s,t[l+2]=o,t[l+3]=a}return t}intersectRay(e,t,i,r,n,s,o){const{isVerticalRay:a}=o;this._ray0=e,this._ray1=t,this._componentVerticalOffsets=i,this._verticalOffset=r,this._tolerance=s,this._intersectionOptions=o,this._componentIndexMap=this._bvh.elementIndexMap,(0,oT.Ue)(e,t,this._invDir),this._callback=n,this._bvh.intersectRay(e,t,a),this._callback=GE}intersectRange(e,t){const i=this._componentIndexMap,r=this._components,n=r.pickability,s=r.visibility;for(let r=e;r<t;++r){const e=i?i[r]:r;NE(n,e)&&s.isVisible(e)&&this._intersectComponent(e)}}getComponentTriangleCount(e){const t=this._components.offsets,i=t[e]/3;return t[e+1]/3-i}getComponentAabb3D(e,t){const i=this._componentAabbs3D,r=6*e;return t[0]=i[r],t[1]=i[r+1],t[2]=i[r+2],t[3]=i[r+3],t[4]=i[r+4],t[5]=i[r+5],t}_intersectComponent(e){if(!NE(this._components.pickability,e))return;const t=this.getComponentAabb3D(e,kE);let i=!1;const{localMode:r,_componentVerticalOffsets:n,_verticalOffset:s,_ray0:o,_ray1:a,_invDir:l,planetCenterZ:c,_tolerance:u,rayDirectionC:h,componentIntersectionData:d}=this,{isVerticalRay:p}=this._intersectionOptions,f=this._components.offsets,m=(0,hr.c)(zE,o),g=(0,hr.c)(BE,a),y=n?.[e]??0,_=y+(s?.offset??0);if(0!==_&&(r?(m[2]=o[2]-_,g[2]=a[2]-_,i=!0):null!=s&&(s.componentOffset=y)),null==s||i||0===_||s.applyToAabb(t),!(0,oT.Tw)(t,m,l,u))return;(0,hr.a)(h,g,m);const v=f[e]/3,b=f[e+1]/3,w=b-v,x=(t,i,r)=>{this._callback(t,i,e,r)},{vertexData:T,vertexStride:C,indexData:S,_intersectionOptions:E}=this,{normalRequired:M}=E;if(w>ZE){let t=d[e];null==t&&(t=new PE(e,T,C,S,v,b,this.geometryMinZ,c,r),d[e]=t),t.intersectRay(m,g,p,i?0:_,x,M)}else IE(m,h,v,b,S,T,C,i?0:_,c,M,x)}}const kE=(0,Mf.Ue)(),zE=(0,Pa.Ue)(),BE=(0,Pa.Ue)(),VE=(0,Pa.Ue)(),HE=(0,Pa.Ue)(),GE=()=>{},jE=new oT.sT,ZE=40;class qE{constructor(e,t,i){this.viewingMode=e,this.positionData=t,this._components=i,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=(0,Pa.Ue)(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=t.indices?(0,vE.mi)(t.indices):(0,vE.KF)(t.positions.length/3),this._positions=t.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,t){const i=this._ensureComponentAabbs(),r=6*e;return t[0]=i[r],t[1]=i[r+1],t[2]=i[r+2],t[3]=i[r+3],t[4]=i[r+4],t[5]=i[r+5],t}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,t){t.indices=this._indices,t.data=this._positions,t.stride=3,t.startIndex=this._components.offsets[e],t.endIndex=this._components.offsets[e+1]}intersect(e,t,i,r,n,s,o,a){this.verticalOffset=r,this.componentVerticalOffsets=n;const{position:l}=s,c=(0,hr.a)(WE,e,l),u=(0,hr.a)($E,t,l),h=(0,gi.U_)(YE,s.rotationScale);(0,hr.q)(c,c,h),(0,hr.q)(u,u,h);const d=(0,gi.p4)(XE,h);if(this.viewingMode===$t.JY.Global){const e=this._planetCenter;(0,hr.v)(e,l),(0,hr.q)(e,e,h)}this._intersectComponents(c,u,n,r,((e,t,i,r)=>{a(i,e,r?(0,hr.q)(JE,r,d):null,t)}),i,o)}_computePerComponentAabbs(){const e=this._aabb,t=.5*(e[0]+e[3]),i=.5*(e[1]+e[4]),r=.5*(e[2]+e[5]),n=this._components.count,s=(0,oE.xx)(6*n),o=this._indices,a=this._positions,l=this._components.offsets;let c=0,u=1/0,h=1/0,d=1/0,p=-1/0,f=-1/0,m=-1/0;for(let e=0;e<n;e++){const n=l[e],g=l[e+1];let y=1/0,_=1/0,v=1/0,b=-1/0,w=-1/0,x=-1/0;if(n<g)for(let e=n;e<g;e++){const t=3*o[e],i=a[t],r=a[t+1],n=a[t+2];y=Math.min(y,i),_=Math.min(_,r),v=Math.min(v,n),b=Math.max(b,i),w=Math.max(w,r),x=Math.max(x,n)}else y=t,_=i,v=r,b=t,w=i,x=r;s[c++]=y,s[c++]=_,s[c++]=v,s[c++]=b,s[c++]=w,s[c++]=x,u=Math.min(u,y),h=Math.min(h,_),d=Math.min(d,v),p=Math.max(p,b),f=Math.max(f,w),m=Math.max(m,x)}return this._aabb[0]=u,this._aabb[1]=h,this._aabb[2]=d,this._aabb[3]=p,this._aabb[4]=f,this._aabb[5]=m,s}_intersectComponents(e,t,i,r,n,s,o){let a=this._componentBvh;null==a&&(a=new UE(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=a),a.intersectRay(e,t,i,r,n,s,o)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===$t.JY.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}}const WE=(0,Pa.Ue)(),$E=(0,Pa.Ue)(),YE=(0,td.Ue)(),JE=(0,Pa.Ue)(),XE=(0,td.Ue)();class KE{constructor(e,t,i){this.material=e,this.geometry=t,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}}class QE{constructor(e,t,i,r){this.vao=e,this.primitiveType=t,this.parameters=i,this.indexed=r}dispose(){this.vao.dispose()}}var eM=n(19453);function tM(e,t){const i=new eM.P,{eye:r,frustum:n,viewForward:s}=e;t.forAll((e=>{const t=null!=e.offsetObb?e.offsetObb:e.obb,o=(0,hr.f)((0,hr.a)(gM,t.center,r),s),a=t.projectedRadius(s);if(i.within(o-a)&&i.within(o+a))return;const l=function(e,t){let i=0;for(let r=0;r<pM;r++){const n=e.intersectPlane(t[r]);if(n>0)return-1;0===n&&(i|=1<<r)}return i}(t,n);if(-1===l)return;if(0===l)return rM.far=o+a,rM.near=o-a,void i.union(rM);const c=iM.pushNew();c.near=o-a,c.far=o+a,c.mask=l,c.object=e}));for(let e=0;e<iM.length;e++){const t=iM.data[e];if(i.within(t.near)&&i.within(t.far))continue;rM.far=t.far,rM.near=1/0;const o=hM(null!=t.object.offsetObb?t.object.offsetObb:t.object.obb,r,oM,(e=>{let i=aM;for(let r=0;r<pM&&e.length>0;r++){if(!(t.mask&1<<r))continue;lM(n[r],e,i);const s=e;e=i,i=s}for(let t=0;t<e.length;t+=3){(0,hr.i)(nM,e.data[t],e.data[t+1],e.data[t+2]);const i=(0,hr.f)((0,hr.a)(nM,nM,r),s);rM.near=Math.min(rM.near,i)}}));0===o&&(rM.near=0),i.union(rM)}return iM.length=0,i}const iM=new Pg.Z({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),rM=new eM.P,nM=(0,Pa.Ue)(),sM=(0,Pa.Ue)(),oM=new Pg.Z({deallocator:null}),aM=new Pg.Z({deallocator:null});function lM(e,t,i){i.length=0;const r=t.length-3;cM(nM,t,r);const n=(0,Dd.jH)(e,nM);n<=0&&(i.push(nM[0]),i.push(nM[1]),i.push(nM[2]));let s=0,o=n;for(;s<r;s+=3){cM(sM,t,s);const r=(0,Dd.jH)(e,sM);o*r<0&&((0,hr.m)(nM,sM,nM,r/(r-o)),uM(i,nM)),r<=0&&uM(i,sM),o=r,(0,hr.c)(nM,sM)}o*n<0&&(cM(sM,t,r),(0,hr.m)(nM,sM,nM,n/(n-o)),uM(i,nM))}function cM(e,t,i){return(0,hr.i)(e,t.data[i],t.data[i+1],t.data[i+2])}function uM(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function hM(e,t,i,r){(0,Sd.Kx)(mM,e.quaternion),(0,hr.a)(gM,t,e.center),(0,hr.w)(gM,gM,mM);const n=e.halfSize,s=8*((gM[0]<-n[0]?-1:gM[0]>n[0]?1:0)+3*(gM[1]<-n[1]?-1:gM[1]>n[1]?1:0)+9*(gM[2]<-n[2]?-1:gM[2]>n[2]?1:0)+13),o=dM[s];if(0===o)return o;(0,gi.en)(fM,e.quaternion),(0,gi.bA)(fM,fM,e.halfSize);const a=(t,i)=>{const r=dM[s+i+1];return(0,hr.i)(t,((1&r)<<1)-1,(2&r)-1,((4&r)>>1)-1),(0,hr.q)(t,t,fM),(0,hr.g)(t,e.center,t)};return i.length=0,uM(i,a(yM,0)),uM(i,a(_M,1)),uM(i,a(gM,2)),uM(i,a(vM,3)),r(i),1===o||(i.length=0,uM(i,yM),uM(i,vM),uM(i,a(gM,4)),uM(i,a(bM,5)),r(i),2===o||(i.length=0,uM(i,yM),uM(i,bM),uM(i,a(gM,6)),uM(i,_M),r(i))),o}const dM=(()=>{const e=new Array(216);let t=0;const i=i=>{for(let r=0;r<i.length;r++)e[t+r]=i[r];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),pM=4;const fM=(0,td.Ue)(),mM=(0,Ed.Ue)(),gM=(0,Pa.Ue)(),yM=(0,Pa.Ue)(),_M=(0,Pa.Ue)(),vM=(0,Pa.Ue)(),bM=(0,Pa.Ue)();class wM{constructor(e){this._objects=e}submit(e,t){this._objects.preSubmit(t),this._objects.visibleObjects.forAll((i=>i.renderable.material.submit(e,t,i)))}queryDepthRange(e){return this._objects.visibleObjects.length?tM(e,this._objects.visibleObjects):null}get hasEmissions(){return this._objects.visibleObjects.some((e=>e.renderable.material.hasEmissions))}hasHighlightOptions(e){return this._objects.hasHighlightOptions(e)}}var xM=n(67920);class TM{constructor(){this.externalColor=(0,rf.Ue)(),this.externalColorMixMode=xE.a9.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}}var CM=n(95944),SM=n(24174),EM=n(22919),MM=n(43338),AM=n(405),RM=n(29620);const OM=()=>f.Z.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class PM{constructor(e,t){this._renderManager=e,this._viewingMode=t,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._activeHighlightOptions=new Map,this._visible=new Pg.Z,this._hidden=new Pg.Z,this._renderSubmit=new wM(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new AM.g(e.rctx,2+((0,MM.B)()?1:0))}destroy(){(0,Lv.hu)(0===this._hidden.length&&0===this._visible.length,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll((e=>e.destroy())),this._hidden.forAll((e=>e.destroy())),this._visible.clear(),this._hidden.clear()}createObject(e){const t=e.geometry,i=new SE(this._componentBufferManager,(0,vE.mi)(t.componentOffsets)),r=this._createRenderable(e,i),n=new qE(this._viewingMode,t.positionData,i),s=new EE(e.transform,e.toMapSpace,e.obb.clone(),i,r,n);return(s.visible?this._visible:this._hidden).push(s),s}destroyObject(e){const t=e;(t.visible?this._visible:this._hidden).removeUnordered(t),t.destroy(),this._notifyDirty()}setObjectVisibility(e,t){const i=e;t!==i.visible&&(t?(this._hidden.removeUnordered(i),this._visible.push(i)):(this._visible.removeUnordered(i),this._hidden.push(i)),i.visible=t,this._notifyDirty())}preSubmit(e){const t=e.camera.eye;this.visibleObjects.forAll((e=>e.renderable.meta.cameraDepthSquared=(0,hr.s)(t,e.obb.center)))}getMaterial(e){return e.renderable.material}updateMaterial(e,t){const i=e.renderable.material;t(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,t){const i=e;i.componentData.visibility.reset(t),i.componentData.markVisibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,t){return e.componentData.visibility.forEachComponent(t)}getComponentCount(e){const t=e,i=t.componentData.visibility.componentCount;return{visible:i,invisible:t.componentData.count-i}}setComponentData(e,t){const i=e,{renderable:r,componentData:n}=i,s=r.material,o=n.materialDataBuffer,a=n.materialDataIndices,l=new TM,c=o.textureBuffer,u=new Uint8Array(4),h=new Uint32Array(u.buffer);let d=0,p=0,f=0,m=n.verticalOffsets,g=1/0,y=-1/0,_=!1,v=!1,b=0;for(let e=0;e<n.count;e++){t(e,l),d+=+(l.externalColor[3]<1),p+=+(l.externalColorMixMode===xE.a9.Replace&&1===l.externalColor[3]),f+=+l.castShadows,(0,xE.HB)(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[e],0,u[0],u[1],u[2],u[3]),_||=e>0&&b!==h[0],b=h[0],v||=0!==l.elevationOffset,v&&null==m&&(m=new Array(e).fill(0)),null!=m&&(m[e]=l.elevationOffset),g=Math.min(g,l.elevationOffset),y=Math.max(y,l.elevationOffset),(0,EM.nO)(l.elevationOffset,u),c.setData(a[e],1,u[0],u[1],u[2],u[3]);const i=l.objectAndLayerIdColor;null!=i&&c.setData(a[e],2,i[0],i[1],i[2],i[3]),l.pickable!==NE(n.pickability,e)&&(n.pickability=DE(n.pickability,n.count,e,l.pickable))}n.verticalOffsets=v?m:null,i.offsetObb=v?(0,TE.gI)(i.obb,g,y,this._viewingMode,i.offsetObb??i.obb.clone()):null,_||v||(0,MM.B)()?(s.componentParameters=new CM.Qu,s.componentParameters.castShadows=LM(f,n.count),s.componentParameters.transparent=LM(d,n.count),s.componentParameters.opaqueOverride=LM(p,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new CM.zO,s.componentParameters.castShadows=l.castShadows?CM.ws.All:CM.ws.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,t,i,r=!1){e.intersectionGeometry.getComponentAabb(t,i);const n=e,s=n.componentData.verticalOffsets;if(r||null==s)return i;const o=s[t];if(this._viewingMode===$t.JY.Local||0===o)return i[2]+=o,i[5]+=o,i;const a=(0,zd.iO)(o);return a.localOrigin=n.transform.position,a.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,t,i){return e.intersectionGeometry.getComponentPositions(t,i)}expandRangeWithComponentObjectElevationRange(e,t,i,r){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==t||r.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,s=n.componentData,o=s.count,a=s.verticalOffsets,l=n.intersectionGeometry,c=this._viewingMode===$t.JY.Local,u=l.getComponentAabbs(),h=DM;let d=1/0,p=-1/0;for(let e=0;e<o;e++){const s=6*e,o=a?.[e]??0;let l=1/0,f=-1/0;if(c)l=u[s+2]+o+t,f=u[s+5]+o+t;else{if(h[0]=u[s],h[1]=u[s+1],h[2]=u[s+2],h[3]=u[s+3],h[4]=u[s+4],h[5]=u[s+5],0!==o){const e=(0,zd.iO)(o);e.localOrigin=n.transform.position,e.applyToAabb(h)}const e=Math.max(Math.abs(h[3]),Math.abs(h[0])),a=Math.max(Math.abs(h[4]),Math.abs(h[1])),l=t+h[5]+i;r.expandElevationRangeValues(t+h[2],Math.sqrt(e*e+a*a+l*l)-i)}r.expandElevationRangeValues(l,f),d=Math.min(d,l),p=Math.max(p,f)}this._elevationRangeCacheVerticalOffset=t,this._elevationRangeCacheMin=d,this._elevationRangeCacheMax=p}intersect(e,t,i,r,n,s,o){const a=e,{transform:l}=a,{position:c}=l;return null!=n&&(n.localOrigin=c),a.intersectionGeometry.intersect(t,i,r,n,a.componentData.verticalOffsets,l,s,o)}addEdges(e,t,i,r,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.componentData.offsets;return t.addComponentObject(s,a,o,l,i,r,n)}async extractEdgeInformation(e,t,i){const r=e,s=r.componentData.visibility;if(s.allInvisible()){const{extractComponentsEdgeLocationsLayout:e}=await n.e(76386).then(n.bind(n,76386));return{buffer:e.createBuffer(0),origin:[0,0,0]}}const{indices:o,positions:a}=r.intersectionGeometry,l=r.componentData.offsets,{EdgeInputBufferLayout:c}=await n.e(82976).then(n.bind(n,82976)),u=c.createBuffer(a.length/3);(0,wE.c)(u.position.typedBuffer,a,u.position.typedBufferStride,3),(0,bE.c)(u.position,u.position,r.transform.rotationScale),this._setComponentIndices(u.componentIndex,o,l);const h=u.count,d=this._computeVisibilityIndices(o,s,l,h);return{origin:(0,Pa.d9)(r.transform.position),buffer:await t.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:u,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,t,i){let r=0;for(let n=0;n<i.length-1;n++){const s=i[n],o=i[n+1];for(let i=s;i<o;i++){const n=t?t[i]:i;e.set(n,r)}r++}}_computeVisibilityIndices(e,t,i,r){if(e&&t.allVisible())return e;let n=0;t.forEachComponentRange(((e,t)=>(n+=i[t]-i[e],!0)));const s=(0,_E.fU)(e)?2===e?.BYTES_PER_ELEMENT||r<=65536?new Uint16Array(n):new Uint32Array(n):new Array(n);let o=0;return t.forEachComponentRange(((t,r)=>{const n=i[t],a=i[r];for(let t=n;t<a;t++)s[o++]=e?e[t]:t;return!0})),s}addComponentHighlight(e,t,i){const r=e.componentData,n=(0,Ve.s1)(r.componentHighlights,i,(()=>new Uint32Array(r.count+1)));{const e=this._activeHighlightOptions.get(i)??0;this._activeHighlightOptions.set(i,e+1)}0==n[t]++&&(r.markHighlightsDirty(),this._notifyDirty()),n[r.count]++}removeComponentHighlight(e,t,i){const{componentData:r}=e,n=r.componentHighlights.get(i);if(void 0===n)return void OM().warn("Removing non-existing highlight.");const s=n[t];if(0===s)return void OM().warn("Removing non-existing highlight.");this._removeActiveHighlight(i);const o=n[r.count];if(s>1)return n[t]=s-1,void(n[r.count]=o-1);n[t]=0,1===o?r.componentHighlights.delete(i):n[r.count]=o-1,r.markHighlightsDirty(),this._notifyDirty()}_removeActiveHighlight(e,t=1){const i=this._activeHighlightOptions.get(e);if(void 0===i)OM().warn("Removing non-existing highlight.");else{const r=i-t;r<0&&OM().warn("Removing non-existing highlight."),r<=0?this._activeHighlightOptions.delete(e):this._activeHighlightOptions.set(e,r)}}clearHighlights(e){const{componentData:t}=e,{componentHighlights:i}=t;if(i.size>0){for(const e of i)this._removeActiveHighlight(e[0],e[1][t.count]);i.clear(),t.markHighlightsDirty(),this._notifyDirty()}}hasHighlightOptions(e){return this._activeHighlightOptions.has(e)}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,t){const i=this._renderManager.rctx,r=e.geometry,n=r.vertices.layoutParameters,s=rc.f.createVertex(i,Rl.l1.STATIC_DRAW,r.vertices.data),o=r.indices?rc.f.createIndex(i,Rl.l1.STATIC_DRAW,r.indices):null,a=(0,Kl.K)((0,xM.N)(n)),l=new Uint16Array(r.vertices.count);for(let e=0;e<t.count;e++){const i=t.offsets[e],n=t.offsets[e+1],s=t.materialDataIndices[e];if(null!=r.indices)for(let e=i;e<n;e++)l[r.indices[e]]=s;else for(let e=i;e<n;e++)l[e]=s}const c=rc.f.createVertex(i,Rl.l1.STATIC_DRAW,l.buffer),u=new CM.Un(e.transform,e.toMapSpace),h=new RM.U(i,SM.k,new Map([["data",a],["componentIndices",IM]]),new Map([["data",s],["componentIndices",c]]),o),d=new QE(h,Rl.MX.TRIANGLES,n,null!=o),p={cameraDepthSquared:.5,gpuMemoryEstimate:s.usedMemory+c.usedMemory+(null!=o?o.usedMemory:0)};return new KE(u,d,p)}_notifyDirty(){this._renderManager.notifyDirty()}}const IM=(0,Kl.K)((0,Ql.U$)().u16(Wl.T.COMPONENTINDEX));function LM(e,t){return e===t?CM.ws.All:0===e?CM.ws.None:CM.ws.Some}const DM=(0,Mf.Ue)();class NM{constructor(e,t,i,r,n){this.rctx=e,this.viewingMode=t,this.stippleTextures=i,this.waterTextures=r,this.markerTextures=n}get spherical(){return this.viewingMode===$t.JY.Global}get doublePrecisionRequiresObfuscation(){return this.rctx.driverTest.doublePrecisionRequiresObfuscation.result}}var FM=n(18841),UM=n(55803);let kM=class extends ec.Z{constructor(e){super(e),this.consumes={required:["olid"]},this.produces="olid"}destroy(){}render(e){const t=e.find((({name:e})=>"olid"===e)),i=this.renderingContext;return i.bindFramebuffer(t.fbo),i.clearFramebuffer(rf.AG,!0,!0),this.view._stage.renderer.renderAllGeometry(Lw.H_.ObjectAndLayerIdColor),i.clear(Rl.Hf.DEPTH|Rl.Hf.STENCIL),this.view._stage.renderer.renderHUD(UM.U.NotOccluded),t}};(0,i._)([(0,y.Cb)()],kM.prototype,"consumes",void 0),(0,i._)([(0,y.Cb)()],kM.prototype,"produces",void 0),kM=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.effects.geometry.ObjectAndLayerIDRenderNode")],kM);var zM=n(62058),BM=n(42199);let VM=class extends ec.Z{constructor(e){super(e),this.consumes={required:[Zl.CM.OCCLUDED]},this.produces=Zl.CM.OCCLUDED,this._blit=new zM.N(e.view._stage.renderView.techniques,BM.J.PremultipliedAlpha)}precompile(){const e=this.view._stage.renderer;e.plugins.plugins.forAll((t=>{e.precompileSlots(t,NC.r.OCCLUDED_TERRAIN,NC.r.TRANSPARENT_OCCLUDER_MATERIAL),t.material&&e.precompileOccludedSlots(t,GM)}))}render(e){const t=e.find((({name:e})=>e===this.produces)),i=this.view._stage.renderer;let r=0;if(HM.clear(),i.plugins.plugins.forAll((e=>{e.material&&e.queryRenderOccludedState(DC.yD.OccludeAndTransparentStencil)&&(r|=DC.yD.OccludeAndTransparentStencil,HM.push(e))})),HM.length>0&&(i.renderSlots(HM,NC.r.OCCLUDER_MATERIAL),r&DC.yD.OccludeAndTransparentStencil&&this._renderAndComposite(t,.5,(()=>i.renderSlots(HM,NC.r.TRANSPARENT_OCCLUDER_MATERIAL)),!1,!1)),HM.clear(),i.plugins.plugins.forAll((e=>{if(!e.material)return;const t=e.queryRenderOccludedState(DC.yD.OccludeAndTransparent),i=e.queryRenderOccludedState(DC.yD.Transparent),n=e.queryRenderOccludedState(DC.yD.Opaque);(t||i||n)&&(r|=t?DC.yD.OccludeAndTransparent:i?DC.yD.Transparent:DC.yD.Opaque,HM.push(e))})),r|=i.plugins.renderOccludedFlags,!r)return t;for(const e of GM)r&e&&this._renderAndComposite(t,e===DC.yD.Opaque?1:.5,(()=>i.renderOccludedSlots(HM,e)),!0,tc.hU.OutlineVisualElementMask);return HM.clear(),t}_renderAndComposite(e,t,i,r,n){const s=this.renderingContext,{width:o,height:a}=e.fbo,l=this.fboCache.acquire(o,a,"tmp color"),c=r?this.fboCache.acquireDepth(DS.m.DEPTH_STENCIL_TEXTURE,o,a,"tmp depth"):e.getAttachment(Rl.Lu);l.attachDepth(c),s.bindFramebuffer(l.fbo),s.clearFramebuffer(rf.AG,r,n),i(),l.detachDepth(),this._blit.blend(s,l,e,this.bindParameters,t),r&&c.release(),l.release()}};(0,i._)([(0,y.Cb)()],VM.prototype,"consumes",void 0),(0,i._)([(0,y.Cb)()],VM.prototype,"produces",void 0),VM=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.effects.geometry.RenderOccludedRenderNode")],VM);const HM=new Pg.Z,GM=[DC.yD.OccludeAndTransparent,DC.yD.Transparent,DC.yD.Opaque];var jM=n(30345);class ZM extends Al.A{constructor(e,t){super(e,t,new Ml.J(jM.a,(()=>n.e(11417).then(n.bind(n,11417)))))}initializePipeline(){return(0,Ol.sm)({blending:(0,Ol.wK)(Rl.zi.ONE,Rl.zi.ZERO,Rl.zi.ONE_MINUS_SRC_COLOR,Rl.zi.ONE),depthTest:{func:Rl.wb.ALWAYS},colorWrite:Ol.gf})}}var qM=n(446);class WM extends RS.o{constructor(){super(...arguments),this.hazeStrength=1}}class $M extends Al.A{constructor(e,t){super(e,t,new Ml.J(qM.H,(()=>n.e(71317).then(n.bind(n,71317)))))}initializePipeline(e){return e.reduced?(0,Ol.sm)({blending:Ol.di,depthTest:{func:Rl.wb.ALWAYS},colorWrite:Ol.gf}):(0,Ol.sm)({blending:(0,Ol.wK)(Rl.zi.ONE,Rl.zi.ZERO,Rl.zi.ONE_MINUS_SRC_COLOR,Rl.zi.ONE),colorWrite:Ol.gf})}}class YM extends GT.m{constructor(){super(...arguments),this.reduced=!1}}(0,i._)([(0,GT.o)()],YM.prototype,"reduced",void 0);let JM=class extends jS{constructor(e){super(e),this._compositingPassParameters=new jM.H,this._passParameters=new WM,this._hazeConfiguration=new YM,this._vao=null,this.requireGeometryDepth=!0,this._oldAmount=1,this._newAmount=1,this._amount=this._newAmount;const t=e.view._stage.renderView.techniques;t.precompile($M,new YM);const i=new YM;i.reduced=!0,t.precompile($M,i),t.precompile(ZM)}initialize(){this.addHandles([(0,F.watch)((()=>this.view.environment.atmosphereEnabled),(e=>e?this._enable():this._disable()),F.syncAndInitial),(0,F.watch)((()=>this.view._stage?.renderer.renderContext.bind.clouds.fadeFactor??1),(e=>this._fade(e)),F.syncAndInitial),(0,F.watch)((()=>this.view.environment.weather.type),(e=>this._newAmount="rainy"===e?0:1),F.syncAndInitial),(0,F.watch)((()=>this.view._stage.renderer?.fullResolutionAtmosphere),(e=>this._hazeConfiguration.reduced=!e),F.syncAndInitial)])}_fade(e){e>=1?(this._amount=this._newAmount,this._oldAmount=this._newAmount):this._amount=e<=0?this._oldAmount:(0,yt.t7)(this._oldAmount,this._newAmount,e)}destroy(){this._vao=(0,m.M2)(this._vao)}render(e){const t=e.find((({name:e})=>e===Zl.CM.TRANSPARENT_ENVIRONMENT));if(!this.bindParameters.mainDepth)return t;const i=this.renderingContext;this._vao??=(0,iC.ow)(i,iC.Ar.Pos2Tex);const r=this.techniques.get($M,this._hazeConfiguration);if(!r.compiled)return t;const n=t.getAttachment(i.gl.DEPTH_STENCIL_ATTACHMENT);if(this._update(),!this._hazeConfiguration.reduced)return t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(r,this.bindParameters,this._passParameters),this._renderCommon(i),t.attachDepth(n),t;const s=this.techniques.get(ZM);if(!s.compiled)return t;const o=i.getViewport(),a=this.camera,l=(0,hr.l)(a.eye)-il.sv.radius;let c;const u=il.sv.atmosphereHeight;if(l<u){const e=Math.min(1,Math.max(0,l/u));c=(0,yt.t7)(.4,.5,e)}else{const e=Math.min(1,Math.max(0,(l-u)/(15*u)));c=(0,yt.t7)(.5,1,e)}const h=(0,uw.nq)(Math.round(c*a.fullViewport[2])),d=(0,uw.nq)(Math.round(c*a.fullViewport[3]));i.setViewport(0,0,h,d);const p=this.fboCache.acquire(h,d,"haze",DS.q.RGBA);return i.bindFramebuffer(p.fbo),i.clearFramebuffer([0,0,0,1],!0,!0),i.bindTechnique(r,this.bindParameters,this._passParameters),this._renderCommon(i),i.setViewport(o.x,o.y,o.width,o.height),this._compositingPassParameters.color=p.getTexture(),t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(s,this.bindParameters,this._compositingPassParameters),i.screen.draw(),t.attachDepth(n),p.release(),t}_renderCommon(e){null!=this._vao&&(e.bindVAO(this._vao),e.drawArrays(Rl.MX.TRIANGLE_STRIP,0,4))}_update(){const e=this.bindParameters.camera,t=(0,hr.k)(e.eye),i=Math.sqrt(t),r=t-this._passParameters.radii[1]*this._passParameters.radii[1],n=(0,yt.uZ)((i-this._passParameters.radii[0])/il.sv.atmosphereHeight,0,1);(0,tf.s)(this._passParameters.heightParameters,i,t,r,n);const s=this.view.basemapTerrain?.getLowerBoundRadius()??0;(0,ci.t8)(this._passParameters.radii,s,s+il.sv.atmosphereHeight),this._passParameters.hazeStrength=(0,yt.t7)((0,yt.t7)(.6,1,(0,yt.CW)(9500,10500,i-il.sv.radius)),1,this._amount)}};JM=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.effects.haze.Haze")],JM);var XM=n(2914),KM=n(60532),QM=n(23839);class eA extends KM.nj{constructor(){super(...arguments),this.shadowColor=(0,rf.al)(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class tA extends Al.A{constructor(e,t){super(e,t,new Ml.J(QM.S,(()=>n.e(32420).then(n.bind(n,32420))))),this.primitiveType=Rl.MX.TRIANGLE_STRIP}initializePipeline(){return(0,Ol.sm)({blending:Ol.Dh,colorWrite:Ol.gf,depthTest:null,depthWrite:null})}}let iA=class extends ec.Z{constructor(e){super(e),this.produces=Zl.lu.COMPOSITE,this.consumes={required:[Zl.lu.COMPOSITE,"highlights"]},this._passParameters=new eA,this._maxOpacity=1,this._shadowDifference=.2}initialize(){this.addHandles([(0,F.watch)((()=>this.view.highlightOptions.shadowOpacity),(e=>{this._passParameters.shadowOpacity=e??At.CN,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()}),F.syncAndInitial),(0,F.watch)((()=>this.view.highlightOptions.shadowDifference),(e=>{this._shadowDifference=e??At.oH,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()}),F.syncAndInitial),(0,F.watch)((()=>this.view.highlightOptions.shadowColor),(e=>{this._passParameters.shadowColor=(0,AS.O)(e??At.NU),this._ensureMaxOpacity()}),F.syncAndInitial)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_ensureMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3],this.requestRender(tc.Xx.UPDATE)}precompile(){this.techniques.precompile(tA)}render(e){const t=e.find((({name:e})=>e===Zl.lu.COMPOSITE)),i=this.bindParameters;if(!i.shadowHighlightsVisible||!i.depth||!this._ensureIfVisible(i.camera,i.lighting.mainLight.direction))return t;const r=this.techniques.get(tA);if(r.compiled){this._passParameters.highlight=e.find((({name:e})=>"highlights"===e))?.getTexture(),this._passParameters.origin=i.camera.center;const n=this.renderingContext;n.bindFramebuffer(t.fbo),n.bindTechnique(r,i,this._passParameters),n.screen.draw()}else this.requestRender(tc.Xx.UPDATE);return t}_ensureIfVisible(e,t){this._passParameters.opacityElevation=1-(0,yt.CW)(4e4,5e4,e.relativeElevation);const i=this.viewingMode===$t.JY.Global?(0,hr.n)(rA,e.center):(0,hr.i)(rA,0,0,1),r=(0,hr.f)(i,t);return this._passParameters.dayNightTerminator=(0,yt.CW)(0,1,(0,yt.uZ)(30*r,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=.001953125}};(0,i._)([(0,y.Cb)()],iA.prototype,"produces",void 0),(0,i._)([(0,y.Cb)()],iA.prototype,"consumes",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],iA.prototype,"viewingMode",void 0),iA=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],iA);const rA=(0,Pa.Ue)();var nA=n(44883),sA=n(5869);class oA extends Al.A{constructor(e,t){super(e,t,new Ml.J(sA.a,(()=>n.e(54831).then(n.bind(n,70240)))))}initializePipeline(){return(0,Ol.sm)({blending:Ol.xW,depthTest:null,depthWrite:null,colorWrite:Ol.gf})}}var aA=n(43761);let lA=class extends ec.Z{constructor(){super(...arguments),this.produces=Zl.CM.MAGNIFIER,this.consumes={required:[Zl.CM.MAGNIFIER]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new sA.M,this._vao=null,this._magnifier=null,this._tmpScreenPoint=(0,$e.s1)(),this._tmpRenderPoint=(0,$e.gX)()}initialize(){this.addHandles([(0,F.watch)((()=>this.view.magnifier),(e=>this._update(e)),F.syncAndInitial)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const t=()=>{const e=this._validMagnifier;e?(this._loadResources(e),this.produces=Zl.CM.MAGNIFIER):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles((0,F.watch)((()=>this._magnifier?.version),t)),t()}get _validMagnifier(){return this._magnifier?.visible&&this._magnifier?.position&&this._magnifier?.size>0?this._magnifier:null}get _factor(){return this._magnifier?.factor||1}destroy(){this._magnifier=null,null!=this._imageLoadTask&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=(0,m.M2)(this._vao)}_disposeTextures(){this._passParameters.mask=(0,m.M2)(this._passParameters.mask),this._passParameters.overlay=(0,m.M2)(this._passParameters.overlay),this._passParameters.input=(0,m.M2)(this._passParameters.input)}precompile(){this._imageSources&&this.techniques.precompile(oA)}render(e){const t=this._validMagnifier,i=e.find((({name:e})=>e===Zl.CM.MAGNIFIER));if(null==t)return i;if(null==this._imageSources)return this.requestRender(tc.Xx.UPDATE),i;const r=this.renderingContext,n=this.camera.pixelRatio,s=Math.ceil(n*t.size);this._vao??=(0,iC.ow)(r,iC.Ar.Pos2,tE.i,0,1);const o=this.techniques.get(oA);if(this._ensureTextureResources(r,s),!o.compiled||!this._passParameters.input)return this.requestRender(tc.Xx.UPDATE),i;const a=Math.ceil(1/this._factor*s),l=this._passParameters.input;l.resize(a,a),(0,$e.md)(t.position,this._tmpScreenPoint);const c=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),u=this.camera.fullWidth,h=this.camera.fullHeight,d=.5*a,p=.5*a;c[0]=(0,yt.uZ)(c[0],d,u-d-1),c[1]=(0,yt.uZ)(c[1],p,h-p-1);const f=Math.floor(c[0]-d),m=Math.floor(c[1]-p);return r.bindFramebuffer(i.fbo),o.program.bindTexture("textureInput",l),r.gl.copyTexImage2D(l.descriptor.target,0,l.descriptor.pixelFormat,f,m,a,a,0),this._passParameters.magnifier=t,r.bindTechnique(o,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Rl.MX.TRIANGLE_STRIP,0,4),i}_loadResources(e){const{maskUrl:t,overlayUrl:i}=e;this._imageLoadTask?.maskUrl===t&&this._imageLoadTask?.overlayUrl===i||(this._imageLoadTask?.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:(0,be.vr)((async e=>{const r=null==t||null==i?(0,aA.e)(e):null,n=null!=t?(0,nA.t)(t,{signal:e}):r.then((e=>e.mask)),s=null!=i?(0,nA.t)(i,{signal:e}):r.then((e=>e.overlay));this._imageSources={mask:await n,overlay:await s}}))})}_ensureTextureResources(e,t){if(null==this._imageSources||this._passParameters.size===t&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=t,this._imageSources.overlay.height=this._imageSources.mask.height=t;const i=new Ul.X;i.internalFormat=Rl.VI.RGBA,i.wrapMode=Rl.e8.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!(0,eb.zd)(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new rC.x(e,i,this._imageSources.overlay),i.pixelFormat=i.internalFormat=Rl.VI.ALPHA,i.preMultiplyAlpha=!1,this._passParameters.mask=new rC.x(e,i,this._imageSources.mask),i.pixelFormat=i.internalFormat=Rl.VI.RGBA,i.flipped=!1,this._passParameters.input=new rC.x(e,i)}};(0,i._)([(0,y.Cb)()],lA.prototype,"produces",void 0),(0,i._)([(0,y.Cb)()],lA.prototype,"consumes",void 0),(0,i._)([(0,y.Cb)()],lA.prototype,"_imageSources",void 0),(0,i._)([(0,y.Cb)()],lA.prototype,"_imageLoadTask",void 0),lA=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.effects.magnifier.Magnifier")],lA);var cA=n(4257);class uA extends Al.A{constructor(e,t){super(e,t,new Ml.J(cA.B,(()=>n.e(86443).then(n.bind(n,86443)))))}initializePipeline(){return(0,Ol.sm)({colorWrite:Ol.gf})}}var hA=n(24532);class dA extends Al.A{constructor(e,t){super(e,t,new Ml.J(hA.B,(()=>n.e(36279).then(n.bind(n,36279)))))}initializePipeline(){return(0,Ol.sm)({colorWrite:Ol.gf})}}var pA=n(96109);class fA extends Al.A{constructor(e,t){super(e,t,new Ml.J(pA.E,(()=>n.e(11505).then(n.bind(n,11505)))))}initializePipeline(){return(0,Ol.sm)({colorWrite:Ol.gf})}}class mA extends $l.K{}let gA=class extends ec.Z{constructor(e){super(e),this.produces="disabled",this.consumes={required:[Zl.CM.ANTIALIASING],optional:[Zl.lu.COMPOSITE]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new mA}initialize(){this.addHandles([(0,F.watch)((()=>this.isEnabled()),(e=>e?this.enable():this.disable()),F.syncAndInitial)])}async enable(){if(this.produces=Zl.CM.ANTIALIASING,this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const e=this._abortController.signal;try{const t=await n.e(13446).then(n.bind(n,13446));await this._loadTextures(t,e),this.requestRender(tc.Xx.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,t){(0,g.k_)(t);const[i,r]=await Promise.allSettled([(0,nA.t)(e.areaTexture,{signal:t}),(0,nA.t)(e.searchTexure,{signal:t})]);if((0,g.k_)(t),"fulfilled"!==i.status||"fulfilled"!==r.status)return;const n=this.renderingContext;this._areaTexture=yA(n,Rl.cw.LINEAR,Rl.VI.RGB,i.value),this._searchTexture=yA(n,Rl.cw.NEAREST,Rl.VI.LUMINANCE,r.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=(0,m.M2)(this._searchTexture),this._areaTexture=(0,m.M2)(this._areaTexture)}precompile(){this.techniques.precompile(fA),this.techniques.precompile(uA),this.techniques.precompile(dA)}render(e){const t=e.find((({name:e})=>e===Zl.CM.ANTIALIASING));if(!this._areaTexture||!this._searchTexture)return this.requestRender(tc.Xx.UPDATE),t;const i=this.techniques.get(fA),r=this.techniques.get(uA),n=this.techniques.get(dA);if(!i.compiled||!r.compiled||!n.compiled)return this.requestRender(tc.Xx.UPDATE),t;const s=e.find((({name:e})=>e===Zl.lu.COMPOSITE));if(!s)return t;const o=s.fbo.width,a=s.fbo.height,l=this.renderingContext;l.setViewport(0,0,o,a);const c=this.fboCache.acquire(o,a,"smaa edges",DS.q.RG);l.bindFramebuffer(c.fbo),l.setClearColor(0,0,0,1),l.clear(Rl.Hf.COLOR),this._smaaParameters.color=s.getTexture();const u=this.bindParameters;l.bindTechnique(i,u,this._smaaParameters),l.screen.draw();const h=this.fboCache.acquire(o,a,"smaa blend");return l.bindFramebuffer(h.fbo),l.setClearColor(0,0,1,1),l.clear(Rl.Hf.COLOR),this._smaaParameters.inputTexture=c.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,l.bindTechnique(r,u,this._smaaParameters),l.screen.draw(),c.release(),l.bindFramebuffer(t.fbo),l.setClearColor(0,1,0,1),l.clear(Rl.Hf.COLOR),this._smaaParameters.inputTexture=h.getTexture(),l.bindTechnique(n,u,this._smaaParameters),l.screen.draw(),h.release(),t}};function yA(e,t,i,r){const n=new Ul.X;return n.pixelFormat=i,n.wrapMode=Rl.e8.CLAMP_TO_EDGE,n.width=r.width,n.height=r.height,n.samplingMode=t,new rC.x(e,n,r)}(0,i._)([(0,y.Cb)()],gA.prototype,"produces",void 0),(0,i._)([(0,y.Cb)()],gA.prototype,"consumes",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],gA.prototype,"isEnabled",void 0),(0,i._)([(0,y.Cb)()],gA.prototype,"_abortController",void 0),gA=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.effects.smaa.SMAA")],gA);var _A=n(77738),vA=n(36567),bA=n(26761);class wA extends $l.K{constructor(){super(...arguments),this.modelMatrix=(0,Cl.Ue)()}}class xA extends Al.A{constructor(e,t){super(e,t,new Ml.J(bA.S,(()=>n.e(21203).then(n.bind(n,21203)))))}initializePipeline(){return(0,Ol.sm)({blending:Ol.Dh,depthTest:{func:Rl.wb.LEQUAL},colorWrite:Ol.gf})}}let TA=class extends NS{constructor(){super(...arguments),this._starData=null,this._loadDataTask=null,this._numPoints=0,this._passParameters=new wA}initialize(){this.addHandles([(0,F.watch)((()=>this.view.environment.starsEnabled),(e=>e?this._enable():this._disable()),F.initial),(0,F.watch)((()=>"virtual"===this.view.environment.lighting.type?null:this.view.environment.lighting.date),(e=>this._update(e)),F.syncAndInitial)])}_enable(){super._enable(),this._loadDataTask=this._createLoadDataTask()}get loading(){return!!this._loadDataTask&&!this._loadDataTask.finished}destroy(){this._loadDataTask=(0,m.IM)(this._loadDataTask),this._numPoints=0,this._vao=(0,m.M2)(this._vao),this._starData=null}precompile(){this.techniques.precompile(xA)}render(e){const t=e.find((({name:e})=>e===Zl.CM.OPAQUE_ENVIRONMENT)),i=this.renderingContext;if(this.loading)return this.requestRender(tc.Xx.UPDATE),t;if(!this._starData)return t;this._vao??=this._ensureResources(this._starData,i);const r=this.techniques.get(xA);return r.compiled?(i.bindTechnique(r,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(Rl.MX.POINTS,0,this._numPoints),t):(this.requestRender(tc.Xx.UPDATE),t)}_ensureResources(e,t){return this._numPoints=e.byteLength/RA,function(e,t,i,r){const n=OA.createBuffer(r),s=n.position,o=n.color,a=n.size;for(let e=0;e<r;e++){const r=t[2*e],n=t[2*e+1];s.set(e,0,-Math.cos(r)*Math.sin(n)),s.set(e,1,-Math.sin(r)*Math.sin(n)),s.set(e,2,-Math.cos(n));const l=SA(i[e]),c=CA(EA[l[1]]);o.set(e,0,255*c[0]),o.set(e,1,255*c[1]),o.set(e,2,255*c[2]),o.set(e,3,255),a.set(e,l[0])}return new ic.U(e,tE.i,new Map([["geometry",(0,Kl.K)(OA)]]),new Map([["geometry",rc.f.createVertex(e,Rl.l1.STATIC_DRAW,n.buffer)]]))}(t,new Float32Array(e,0,2*this._numPoints),new Uint8Array(e,2*this._numPoints*4,this._numPoints),this._numPoints)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*function(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}(e),r=(0,Tl.JG)(this._passParameters.modelMatrix,AA);(0,Tl.jI)(r,r,-i*Math.PI),(0,Tl.Jp)(r,MA,r),(0,Tl.jI)(r,r,-t*Math.PI),this.requestRender(tc.Xx.UPDATE)}_createLoadDataTask(){if(this._starData)return null;const e=(0,be.vr)((async e=>{const{data:t}=await(0,vA.b)("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:e});(function(e){if(!e)throw new c.Z("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/RA;if(t%1!=0||t>5e4||t<5e3)throw new c.Z("stars:invalid-data","Failed to create stars because star catalogue data is invalid")})(t),this._starData=t}));return e.promise.catch((e=>{(0,g.D_)(e)||f.Z.getLogger(this).error(e)})).then((()=>{this.destroyed||this.requestRender(tc.Xx.UPDATE)})),e}};function CA(e){return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function SA(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}TA=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.effects.stars.Stars")],TA);const EA=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],MA=(0,Cl.al)(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),AA=(0,Cl.al)(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),RA=9,OA=(0,Ql.U$)().vec3f(Wl.T.POSITION).vec4u8(Wl.T.COLOR).f32(Wl.T.SIZE);var PA=n(73487),IA=n(3995),LA=n(54831);class DA extends Al.A{constructor(e,t){super(e,t,new Ml.J(LA.a,(()=>n.e(75024).then(n.bind(n,75024)))))}initializePipeline(){return(0,Ol.sm)({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}class NA{constructor(e,t){this._rctx=e,this._techniques=t,this._configuration=new BM.Z,this._passParameters=new PA.C,this._hudParameters=new LA.H,this._configuration.blitMode=BM.J.PremultipliedAlpha,this._techniques.precompile(IA.l,this._configuration),this._configuration.hasOpacityFactor=!0,this._techniques.precompile(IA.l,this._configuration),this._configuration.hasOpacityFactor=!1,this._configuration.blitMode=BM.J.Alpha,this._techniques.precompile(IA.l,this._configuration),this._configuration.blitMode=BM.J.Depth,this._techniques.precompile(IA.l,this._configuration),this._techniques.precompile(DA)}compositeHUD(e,t){this._hudParameters.texture=t;const i=this._techniques.get(DA);this._rctx.bindTechnique(i,e,this._hudParameters),this._rctx.screen.draw()}compositePreMultipliedAlpha(e,t,i=1){this._composite(e,t,BM.J.PremultipliedAlpha,i)}composite(e,t){this._composite(e,t,BM.J.Alpha,1)}blitDepthToLinearDepth(e,t){this._composite(e,t,BM.J.Depth,1)}_composite(e,t,i,r){this._configuration.blitMode=i,this._configuration.hasOpacityFactor=1!==r,this._passParameters.texture=t,this._passParameters.opacity=r;const n=this._techniques.get(IA.l,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw()}}var FA=n(55982),UA=n(22445);class kA{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new xT.mc(new ArrayBuffer(4)),this._layerToOidToColor=new UA.r,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new UA.r,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,t,i,r,n,s=null,o=null,a=null){e&&t&&i&&r&&(this._layerUidToId.set(r,i),this._layerUidToPopupEnabled.set(r,n),n&&this._layerUidToGraphicsUidToObjectId.set(r,t,{objectId:e,attributeNodeId:s,attributeIndex:o,subLayerId:a}))}getObjectAndLayerIdColor(e){const t=this.getObjectAndLayerIdColorArray(e);return(0,rf.al)(t.get(0,1),t.get(0,2),t.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const t=this._layerUidToPopupEnabled.get(e.layerUid);if(void 0===t)return this.colorZero;if(!1===t)return this.colorZero;const i=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid)?.objectId;if(!i)return this.colorZero;let r=this._layerToOidToColor.get(e.layerUid,i);if(!r){if((0,w.Z)("enable-feature:objectAndLayerId-screenshot-testing"))r=i;else for(;!r;){const e=Math.floor(16777214*Math.random())+1;this._colorToUID.has(e)||(r=e)}if(r>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,i,r),this._colorToUID.set(r,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,r,!1),new xT.mc(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[t,i]of this._colorToUID.entries()){const r=this._layerUidToGraphicsUidToObjectId.get(i.layerUid,i.graphicUid),n=this._layerUidToId.get(i.layerUid);r&&n&&e.set(t,r.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:r.objectId,lid:n,attrId:r.attributeNodeId,attrIdx:r.attributeIndex,subLayerId:r.subLayerId}:{type:"object-and-layer-id",olid:r.objectId,lid:n})}return e}}n(66175),n(38488);var zA,BA=n(55939);class VA{constructor(e,t){this.key=e,this.free=t,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return 0===this._refCount?(console.log(`Releasing already released FBO attachment "${this.name}" in ${(new Error).stack}`),!0):(--this._refCount,0===this._refCount&&(this.free(),!0))}}!function(e){e[e.FBO=0]="FBO",e[e.DEPTH=1]="DEPTH",e[e.COLOR=2]="COLOR"}(zA||(zA={}));class HA extends VA{constructor(e,t,i){super(e,i),this.attachment=t,this.name=""}dispose(){this.attachment.dispose()}get cachedMemory(){return this.attachment.usedMemory}}class GA extends HA{constructor(e,t,i){super(e,t,i),this.attachment=t,this.type=zA.COLOR}}class jA extends HA{constructor(){super(...arguments),this.type=zA.DEPTH}}var ZA=n(43106);class qA extends VA{constructor(e,t,i,r,n,s){super(e,s),this.type=zA.FBO,this._colors=new Map,this._name=Zl.lu.COMPOSITE,this.acquireDepth=null,this.acquireColor=null,this._name=t,this.fbo=i,this.acquireDepth=r,this.acquireColor=n}dispose(){this.fbo?.dispose()}get cachedMemory(){return this.fbo?.usedMemory||0}get numberOfColorAttachments(){return this._colors.size}get name(){return this._name}setName(e){this._name=e}getTexture(e=Rl.VY.COLOR_ATTACHMENT0){return e===Rl.Lu?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(e)}getAttachment(e=Rl.VY.COLOR_ATTACHMENT0){return e===Rl.Lu?this._depth:this._colors.get(e)}hasAttachment(e){return(0,Ve.oE)(this._colors,(t=>t.name===e))}attachDepth(e){return e?.retain(),this.detachDepth(),e&&this.fbo?.attachDepthStencil(e.attachment),this._depth=e,this}detachDepth(){this.fbo?.detachDepthStencilTexture(),this.fbo?.detachDepthStencilBuffer(),this._depth=(0,m.RY)(this._depth)}obtainDepthTexture(){const e=this._depth;return function(e){return e?.attachment.type===ZA.B.Texture}(e)?(this.fbo?.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,t){return e.retain(),this.detachColor(t),this.fbo?.attachColorTexture(e.attachment,t),this._colors.set(t,e),this}detachColor(e){this.fbo?.detachColorTexture(e);const t=this._colors.get(e);this._colors.delete(e),t?.release()}detachAll(){this._colors.forEach(((e,t)=>this.detachColor(t))),this.detachDepth()}}class WA{constructor(e,t){this._last=new Pg.Z,this._incarnation=0,this._cache=new jb(e,t)}destroy(){this._last?.forAll((e=>e.dispose())),this._last=null,this._cache.destroy()}set interactive(e){e&&!this._last?this._last=new Pg.Z:e||(this._last?.forAll((e=>e.dispose())),this._last=null)}clean(){this._last?.filterInPlace((e=>!(e.incarnation<this._incarnation&&(this._cache.put(e.key,e),1))))}frame(){++this._incarnation}pop(e){if(this._last){const t=this._last.find((t=>t.key===e));if(t)return this._last.removeUnordered(t),t}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){return this._last?.reduce(((e,t)=>e+t.cachedMemory),0)??0}}var $A=n(37165);class YA{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new WA(e.newCache,"FBOCache"),this._depthCache=new WA(e.newCache,"DepthAttachmentCache"),this._colorCache=new WA(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback?.()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach((t=>t.type===zA.FBO&&e(t.name,t.fbo,t.numberOfColorAttachments)))}get usedMemory(){return Array.from(this._acquired.values()).reduce(((e,t)=>e+("getTexture"in t?t.getTexture()?.usedMemory??0:t.cachedMemory)),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,t,i,r=DS.q.RGBA){const n=XA(r,e,t);let s=this._cache.pop(n);if(s){s.retain(),s.setName(i);const e=this.rctx.getBoundFramebufferObject();if(this.rctx.bindFramebuffer(s.fbo),this.rctx.setDrawBuffers([Rl.VY.COLOR_ATTACHMENT0]),!s.fbo)throw new c.Z("attempt to use a not existing framebuffer");this.rctx.unbindTexture(s.fbo.colorTexture),this.rctx.bindFramebuffer(e)}else s=new qA(n,i,new Fl.X(this.rctx,{...sR[r],width:e,height:t}),(e=>{e??=DS.m.DEPTH_STENCIL_TEXTURE;const t=this._acquireDepth(e,s.fbo.width,s.fbo.height,`${s.name} depth`);return s.attachDepth(t),t.release(),s}),((i,r,n)=>{r??=DS.q.RGBA;const o=this._acquireColor(r,e,t,n??`${s.name} color ${i}`);return this.rctx.unbindTexture(o.attachment),s.attachColor(o,i),o.release(),s}),(()=>{this.debugCallback?.(s.name,s.fbo,s.numberOfColorAttachments),this._acquired.delete(s),s.detachAll(),this._cache.put(s)}));return this._trackHandle(s)}acquireDepth(e,t,i,r){return this._acquireDepth(e,t,i,r)}_acquireDepth(e,t,i,r){const n=XA(e,t,i),s=this._depthCache.pop(n);if(s)return s.retain(),s.name=r,this._trackHandle(s);const o=e===DS.m.DEPTH_STENCIL_TEXTURE?new jA(n,new rC.x(this.rctx,{...aR[e],width:t,height:i}),(()=>{this._acquired.delete(o),this._depthCache.put(o)})):new jA(n,new $A.r(this.rctx,{...aR[e],width:t,height:i}),(()=>{this._acquired.delete(o),this._depthCache.put(o)}));return o.name=r,this._trackHandle(o)}_acquireColor(e,t,i,r){const n=XA(e,t,i),s=this._colorCache.pop(n);if(s)return s.retain(),s.name=r,this._trackHandle(s);const o=new GA(n,new rC.x(this.rctx,{...sR[e],width:t,height:i}),(()=>{this._acquired.delete(o),this._colorCache.put(o)}));return o.name=r,this._trackHandle(o)}_trackHandle(e){return this._acquired.add(e),e}}const JA=new qA("default","default",null,(()=>JA),(()=>JA),(()=>{}));function XA(e,t,i){return`${e}x${t}x${i}`}JA.release=()=>!1;const KA=new Ul.X;KA.pixelFormat=Rl.VI.RED,KA.internalFormat=Rl.lP.R8,KA.wrapMode=Rl.e8.CLAMP_TO_EDGE;const QA=new Ul.X;QA.pixelFormat=Rl.VI.RG,QA.internalFormat=Rl.lP.RG8,QA.wrapMode=Rl.e8.CLAMP_TO_EDGE;const eR=new Ul.X;eR.internalFormat=Rl.lP.RGBA4,eR.dataType=Rl.Br.UNSIGNED_SHORT_4_4_4_4,eR.wrapMode=Rl.e8.CLAMP_TO_EDGE;const tR=new Ul.X;tR.wrapMode=Rl.e8.CLAMP_TO_EDGE;const iR=new Ul.X;iR.wrapMode=Rl.e8.CLAMP_TO_EDGE,iR.samplingMode=Rl.cw.LINEAR_MIPMAP_LINEAR,iR.hasMipmap=!0,iR.maxAnisotropy=8;const rR=new Ul.X;rR.pixelFormat=Rl.VI.RED,rR.dataType=Rl.Br.HALF_FLOAT,rR.internalFormat=Rl.lP.R16F,rR.samplingMode=Rl.cw.NEAREST;const nR=new Ul.X;nR.dataType=Rl.Br.HALF_FLOAT,nR.internalFormat=Rl.lP.RGBA16F,nR.samplingMode=Rl.cw.NEAREST;const sR={[DS.q.RED]:KA,[DS.q.RG]:QA,[DS.q.RGBA4]:eR,[DS.q.RGBA]:tR,[DS.q.RGBA_MIPMAP]:iR,[DS.q.R16F]:rR,[DS.q.RGBA16F]:nR},oR=new Ul.X;oR.pixelFormat=Rl.VI.DEPTH_STENCIL,oR.dataType=Rl.Br.UNSIGNED_INT_24_8,oR.samplingMode=Rl.cw.NEAREST,oR.wrapMode=Rl.e8.CLAMP_TO_EDGE,oR.internalFormat=Rl.VI.DEPTH24_STENCIL8;const aR={[DS.m.DEPTH_STENCIL_TEXTURE]:oR,[DS.m.DEPTH16_BUFFER]:new QT.Y(Rl.Tg.DEPTH_COMPONENT16,4)};var lR,cR=n(34790),uR=n(97994);!function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"}(lR||(lR={}));class hR{constructor(e,t,i=lR.FrontToBack){this._rctx=e,this._techniques=t,this._sorting=i,this._draws=new Pg.Z({allocator:e=>e??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,t,i,r,n){const s=this._draws.pushNew();s.geometry=t,s.geometryRanges=i,s.material=e,s.depthSquaredHint=r,s.indexType=(t.indexed?t.vao.indexBuffer.indexType:null)??0,s.highlightName=n}acquire(e,t){return this._draws.map((i=>i.material.acquireTechnique(this._techniques,e,t,i.geometry.parameters)))}dispatch(e,t,i){const r=this._rctx;this._previouslyBoundDraw.clear();let n=null;const s=this._draws.length,o=t.highlight?.name;for(let a=0;a<s;a++){const s=this._draws.data[a];if(e.identifier===cR.o.Highlight){const e=s.highlightName;if(e){if(e!==o)continue}else if(!o||!t.overlay?.hasHighlightOptions(o))continue}const l=i[a];l===n&&t.oitPass===uR.M.NONE||(r.bindTechnique(l,t,e),n=l);const{geometryRanges:c,indexType:u,geometry:h,material:d}=s;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==d&&(l.program.bindDraw(t,e,d),this._previouslyBoundDraw.set(l,d));const p=c.length,{primitiveType:f}=h;for(let e=0;e<p;e+=2){const t=c[e],i=c[e+1];if(0!==u){const e=dR.get(u);r.drawElements(f,i,u,t*e)}else r.drawArrays(f,t,i)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===lR.FrontToBack?1:-1;this._draws.sort(((t,i)=>{const r=e*(t.depthSquaredHint-i.depthSquaredHint);return 0!==r?r:t.geometry.vao.byteSize-i.geometry.vao.byteSize}))}get count(){return this._draws.length}}const dR=new Map;dR.set(Rl.g.UNSIGNED_BYTE,1),dR.set(Rl.g.UNSIGNED_SHORT,2),dR.set(Rl.g.UNSIGNED_INT,4);var pR=n(78549);class fR{constructor(e){const t=e.renderContext.rctx,i=e.techniques;this.opaque=new hR(t,i),this.transparent=new hR(t,i,lR.BackToFront),this.integratedMesh=new hR(t,i),this.shadowMap=new hR(t,i),this.highlight=new hR(t,i),this.highlightIntegratedMesh=new hR(t,i),this.highlightShadowMap=new hR(t,i),this.viewshedShadowMap=new hR(t,i),this.nonHighlightShadowMap=new hR(t,i)}}class mR extends pR.d4{constructor(){super(...arguments),this.slicePlaneLocalOrigin=(0,Pa.Ue)(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}}class gR extends mR{constructor(){super(...arguments),this.identifier=cR.o.Material,this.output=Lw.H_.Color,this.transparent=!1}}class yR extends mR{constructor(){super(...arguments),this.identifier=cR.o.ShadowMap}}class _R extends mR{constructor(){super(...arguments),this.identifier=cR.o.Highlight}}class vR extends mR{constructor(){super(...arguments),this.identifier=cR.o.ViewshedShadowMap}}var bR=n(2653);let wR=class extends uc.tY{constructor(){super({}),this.produces=new Map([[NC.r.OPAQUE_MATERIAL,e=>this._produces(e,NC.r.OPAQUE_MATERIAL)],[NC.r.TRANSPARENT_MATERIAL,e=>this._produces(e,NC.r.TRANSPARENT_MATERIAL)],[NC.r.INTEGRATED_MESH,e=>this._produces(e,NC.r.INTEGRATED_MESH)]]),this._materialPassParameters=new gR,this._shadowPassParameters=new yR,this._highlightPassParameters=new _R,this._viewshedPassParameters=new vR,this._systems=new Set}initializeRenderContext(e){this._context=e,this._passes=new fR(e)}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e,t){return!!this._invoke(e,t,(e=>e.count>0))}prepareRender(e){if(0!==this._systems.size&&null!=this._passes){for(const e of Object.values(this._passes))e.prepareSubmit();this._systems.forEach((t=>t.submit(this._passes,e.bind)));for(const e of Object.values(this._passes))e.finishSubmit()}}acquireTechniques(e){if(0===this._systems.size)return null;const t=e.output===Lw.H_.Shadow||e.output===Lw.H_.ShadowHighlight||e.output===Lw.H_.ShadowExcludeHighlight?this._shadowPassParameters:e.output===Lw.H_.ViewshedShadow?this._viewshedPassParameters:e.output===Lw.H_.Highlight?this._highlightPassParameters:this._materialPassParameters,i=e.bind;return this._updateParameters(i.camera,t,i.slot===NC.r.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e.output,e.bind.slot,((t,i)=>t.acquire(i,e.bind)))}render(e,t){this._invoke(e.output,e.bind.slot,((i,r)=>i.dispatch(r,e.bind,t)))}_invoke(e,t,i){if(null==this._passes)return null;switch(t){case NC.r.OPAQUE_MATERIAL:switch(e){case Lw.H_.Color:case Lw.H_.ColorEmission:case Lw.H_.Depth:case Lw.H_.Normal:case Lw.H_.ObjectAndLayerIdColor:return i(this._passes.opaque,this._materialPassParameters);case Lw.H_.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case Lw.H_.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case Lw.H_.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case Lw.H_.ShadowExcludeHighlight:return i(this._passes.nonHighlightShadowMap,this._shadowPassParameters);case Lw.H_.ViewshedShadow:return i(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case NC.r.TRANSPARENT_MATERIAL:switch(e){case Lw.H_.Color:case Lw.H_.ColorEmission:case Lw.H_.Depth:case Lw.H_.Normal:case Lw.H_.ObjectAndLayerIdColor:return i(this._passes.transparent,this._materialPassParameters)}break;case NC.r.INTEGRATED_MESH:switch(e){case Lw.H_.Color:case Lw.H_.ColorEmission:case Lw.H_.Depth:case Lw.H_.Normal:case Lw.H_.ObjectAndLayerIdColor:return i(this._passes.integratedMesh,this._materialPassParameters);case Lw.H_.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const t=new eM.P;return this._systems.forEach((i=>t.union(i.queryDepthRange(e)))),t}get hasEmissions(){let e=!1;return this._systems.forEach((t=>e=t.hasEmissions||e)),e}_updateParameters(e,t,i){const r=e.viewInverseTransposeMatrix;(0,hr.i)(xR,r[3],r[7],r[11]),CR.set(xR),(0,hr.c)(t.transformWorldFromViewTH,CR.high),(0,hr.c)(t.transformWorldFromViewTL,CR.low),(0,hr.c)(t.slicePlaneLocalOrigin,xR),(0,gi.xO)(t.transformViewFromCameraRelativeRS,e.viewMatrix),(0,Tl.JG)(t.transformProjFromView,e.projectionMatrix),t.identifier===cR.o.Material&&(this._materialPassParameters.transparent=i,(0,gi.p4)(TR,t.transformViewFromCameraRelativeRS),(0,gi.U_)(t.transformNormalViewFromGlobal,TR))}hasHighlightOptions(e){for(const t of this._systems)if(t.hasHighlightOptions(e))return!0;return!1}};wR=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],wR);const xR=(0,Pa.Ue)(),TR=(0,td.Ue)(),CR=new bR.I;var SR=n(37414);var ER=n(6174);class MR{constructor(e){this._context=e,this._nodes=new Pg.Z}destroy(){this._nodes.forEach((e=>e.destroy())),this._nodes.clear()}add(e){this._nodes.push(e),ER.CM&&console.log(`Registered render nodes: ${this._nodes.map((({declaredClass:e})=>e)).join(", ")}`)}remove(e){this._nodes.remove(e),ER.CM&&console.log(`Registered render nodes: ${this._nodes.map((({declaredClass:e})=>e)).join(", ")}`)}produces(e){return this._nodes.some((({produces:t})=>t===e))}require(e,...t){const i=this._nodes,r=t=>i.reduce(((i,{consumes:r,produces:n})=>i+(!r.required.includes(e)||null!=t&&n!==t?0:1)),0);return 0===t.length?r():t.reduce(((e,t)=>e+r(t)),0)}optional(e,...t){const i=this._nodes,r=t=>i.reduce(((i,{consumes:r,produces:n})=>i+(!r.optional?.includes(e)||null!=t&&n!==t?0:1)),0);return 0===t.length?r():t.reduce(((e,t)=>e+r(t)),0)}updateAnimation(e){return this._nodes.reduce(((t,i)=>i.updateAnimation(e)||t),!1)}precompile(...e){++this._context.techniques.precompiling;for(const t of e)this._nodes.forEach((e=>{e.produces===t&&e.precompile()}));--this._context.techniques.precompiling}render(e,t,i=(()=>{})){const r=e.name,n=this._nodes.filter((({produces:e})=>e===r));return 0===n.length?function(e){return e.name}(e)?e:JA:(n.forEach((n=>{const s=[e];for(const e of n.consumes.required){if(e===r)continue;const n=t.get(e);if(n)s.push(n);else if("emissive"!==e||!t.get(r)?.hasAttachment(e))return void(i&&i(s))}if(n.consumes.optional)for(const e of n.consumes.optional){if(e===r)continue;const i=t.get(e);i&&s.push(i)}try{const i=n.doRender(s);i&&i!==e&&(r!==i.name&&(f.Z.getLogger(n).errorOnce(`RenderNode produced ${i.name}, expected ${r}`),i.setName(r)),e.release(),e=i,t.set(r,e))}catch(e){f.Z.getLogger(n).errorOnce(e)}i&&i(s)})),this._context.rctx.enforceState(),e)}requireGeometryDepth(){return this._nodes.some((e=>"disabled"!==e.produces&&e.requireGeometryDepth))}get test(){return{nodes:this._nodes}}}class AR{constructor(e){this.context=e,this._renderPlugins=new Pg.Z,this._slots=new Array,this._version=(0,yl.t)(0);for(let e=0;e<NC.r.MAX_SLOTS;++e)this._slots[e]=[]}destroy(){this._renderPlugins.forEach((e=>e.destroy())),this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(e,t){const i=()=>{if(t?.aborted)throw e.uninitializeRenderContext(),(0,g.zE)();this._renderPlugins.push(e),e.produces.forEach(((t,i)=>this._slots[i].push(e))),this.context.requestRender(),this._version.value++},r=e.initializeRenderContext(this.context,t);if((0,g.y8)(r))return r.then(i);i()}remove(e){this._renderPlugins.removeUnordered(e),e.uninitializeRenderContext();for(let t=0;t<this._slots.length;++t)this._slots[t]=this._slots[t].filter((t=>t!==e));this.context.requestRender(),this._version.value++}prepareRender(){this._renderPlugins.forAll((e=>{e.prepareRender&&e.prepareRender(this.context.renderContext)}))}updateAnimation(e){let t=!1;return this._renderPlugins.forAll((i=>t=i.updateAnimation?.(e)||t)),t}precompile(...e){++this.context.techniques.precompiling;const t=this.context.renderContext.bind.slot;for(const t of e)this.context.renderContext.bind.slot=t,this._forEachRender((()=>{}));this.context.renderContext.bind.slot=t,--this.context.techniques.precompiling}render(e,...t){for(const i of t)this.context.renderContext.bind.slot=i,this._forEachRender(((t,i)=>t.render(this.context.renderContext,i,e)))}_forEachRender(e){const t=this.context.renderContext.bind.slot,i=this.context.renderContext.output;this._slots[t].forEach((r=>{if(!r.produces.get(t)?.(i)||r.isDecoration&&!this.context.renderContext.bind.decorations)return;const n=r.acquireTechniques(this.context.renderContext);n&&e(r,n)}))}queryDepthRange(e){const t=new eM.P;return this._renderPlugins.forAll((i=>{const r=i.queryDepthRange?.(e);t.union(r)})),t}get updating(){return this._version.value>=0&&this._renderPlugins.some((e=>e.running))}produces(e,...t){return t.some((t=>this._slots[t].some((i=>{const r=i.produces.get(t);return!!r&&r(e)}))))}consumes(e){return this._renderPlugins.some((t=>t.consumes().required.includes(e)))}hasHighlightOptions(e){return RR.some((t=>this._slots[t].some((t=>t.hasHighlightOptions(e)))))}get hasDecorations(){return this._renderPlugins.some((e=>e.isDecoration))}get hasOccludees(){return this._renderPlugins.some((e=>e.hasOccludees))}get hasEmissions(){return this._renderPlugins.some((e=>e.hasEmissions))}get renderOccludedFlags(){return this._renderPlugins.reduce(((e,t)=>e|t.renderOccludedFlags),DC.yD.None)}get usedMemory(){return this._renderPlugins.reduce(((e,t)=>t.material?e:e+(t.usedMemory??0)),0)}get test(){}}const RR=[NC.r.OPAQUE_MATERIAL,NC.r.TRANSPARENT_MATERIAL,NC.r.DRAPED_MATERIAL,NC.r.HUD_MATERIAL,NC.r.LABEL_MATERIAL];var OR=n(76818);class PR extends Al.A{constructor(e,t){super(e,t,new Ml.J(OR.a,(()=>n.e(7294).then(n.bind(n,7294)))))}initializePipeline(e){return(0,Ol.sm)({blending:Ol.Dh,colorWrite:Ol.gf,drawBuffers:e.hasEmission?{buffers:[Rl.VY.COLOR_ATTACHMENT0,Rl.VY.COLOR_ATTACHMENT1]}:{buffers:[Rl.VY.COLOR_ATTACHMENT0]}})}}class IR extends GT.m{constructor(){super(...arguments),this.hasEmission=!1}}(0,i._)([(0,GT.o)()],IR.prototype,"hasEmission",void 0);class LR{constructor(e){this._techniques=e,this._parameters=new OR.O,this._configuration=new IR,e.precompile(PR,this._configuration),this._configuration.hasEmission=!0,e.precompile(PR,this._configuration)}blend(e,t,i,r,n){this._parameters.colorTexture=t.getTexture(),n&&(this._parameters.emissionTexture=t.getTexture(Rl.VY.COLOR_ATTACHMENT1),this._parameters.emissionFrontFaceTexture=i.getTexture(Rl.VY.COLOR_ATTACHMENT1)),this._parameters.alphaTexture=t.getTexture(n?Rl.VY.COLOR_ATTACHMENT2:Rl.VY.COLOR_ATTACHMENT1),this._parameters.frontFaceTexture=i.getTexture(),this._configuration.hasEmission=n;const s=this._techniques.get(PR,this._configuration);e.bindTechnique(s,r,this._parameters),e.screen.draw()}}class DR{constructor(e,t){this._camera=e,this._dt=(0,en.HA)(0),this._time=(0,en.HA)(0),this._lastUpdate=(0,en.HA)(0),this._lastUpdate=t,this._time=t}advance(e,t,i){const r=(0,en.HA)(t-this._lastUpdate);this._dt=(0,en.HA)(r/i),this._time=(0,en.HA)(this._time+r),this._lastUpdate=t,this._camera=e}forceTime(e){this._lastUpdate=this._time=e,this._dt=(0,en.HA)(0)}get camera(){return this._camera}get dt(){return this._dt}get time(){return this._time}}class NR{constructor(){this._step=VR,this._dilation=1,this._firstIdleTime=(0,en.HA)(0)}frame(e,t){if(t?0===this._firstIdleTime&&(this._firstIdleTime=(0,en.HA)(performance.now())):this._firstIdleTime=(0,en.HA)(0),(0,w.Z)("disable-feature:high-quality-idle"))this._dilation=1;else{const e=t?performance.now()-this._firstIdleTime:0;if(e>=UR+kR)return this._step=(0,en.HA)(1/0),void(this._dilation=1);this._dilation=e>=UR?zR:1}const i=(0,yt.uZ)(e/FR,VR,HR);this._step===1/0?this._step=(0,en.HA)(i):this._step=(0,en.HA)(this._step*BR+i*(1-BR))}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=(0,en.HA)(0)}}const FR=.5,UR=(0,en.HA)(12e4),kR=(0,en.HA)(1e4),zR=10,BR=.9,VR=(0,en.HA)(1e3),HR=(0,en.HA)(1e3/30);var GR,jR=n(34106),ZR=n(20766);!function(e){e[e.SHADOW_CASTERS=0]="SHADOW_CASTERS",e[e.FULL_SCENE=1]="FULL_SCENE"}(GR||(GR={}));function qR(e,t,i,r=GR.SHADOW_CASTERS){let n=0;if(!t.some((e=>!!e.material&&(n+=e.numGeometries,n>=1e4))))return nO.compute(e,t,r);const s=new eM.P;return i.forAll((t=>s.union(function(e,t){if(!t.visible)return;const i=new eM.P,r=t.getSpatialQueryAccelerator();return r?function(e,t,i){const{eye:r,viewForward:n,frustum:s}=t,o=e=>e.visible,a=i.objectCount;if(a<500)iO.set(t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,n,ZR.Z.DepthOrder.FRONT_TO_BACK,iO,((i,r)=>{WR(e,t,i),iO.far=e.near,r.setRange(iO)}),s,o),iO.set(Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,n,ZR.Z.DepthOrder.BACK_TO_FRONT,iO,((i,r)=>{WR(e,t,i),iO.near=e.far,r.setRange(iO)}),s,o);else{const r=Math.max(Math.min(a,500),Math.ceil(.1*a)),l=i.findClosest(n,ZR.Z.DepthOrder.FRONT_TO_BACK,s,o,r),c=i.findClosest(n,ZR.Z.DepthOrder.BACK_TO_FRONT,s,o,r);l&&c&&(YR(e,t,l.boundingVolumeWorldSpace.bounds),YR(e,t,c.boundingVolumeWorldSpace.bounds))}}(i,e,r):function(e,t,i){rO.clear(),i.forAll((e=>{e.visible&&0!==e.geometries.length&&rO.add(e)})),rO.empty||(rO.sort(t),iO.set(t.near,Math.min(e.near,t.far)),rO.forEachInDepthRange(iO,ZR.Z.DepthOrder.FRONT_TO_BACK,((i,r)=>{r<e.near&&WR(e,t,i)})),iO.set(Math.max(e.far,t.near),t.far),rO.forEachInDepthRange(iO,ZR.Z.DepthOrder.BACK_TO_FRONT,((t,i,r)=>{e.far=Math.max(e.far,r)})))}(i,e,t.objects),i}(e,t)))),s}function WR(e,t,i){if(!i.visible)return;if(!(0,Af.hr)(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,n=tO;i.geometries.forEach((i=>{(0,Tl.Jp)(n,r,i.transformation);const s=(0,rl.u1)(n);$R(e,t,i.boundingInfo,n,s)}))}function $R(e,t,i,r,n){if(null==i)return;(0,hr.t)((0,hh.a)(eO),i.center,r);const{eye:s,viewForward:o}=t,a=o[0]*(eO[0]-s[0])+o[1]*(eO[1]-s[1])+o[2]*(eO[2]-s[2]);if(eO[3]=i.radius*n,!(a-eO[3]>e.near&&a+eO[3]<e.far)&&(0,Af.hr)(t.frustum,eO))if(i.radius>100&&i.getChildren())for(const s of i.getChildren())$R(e,t,s,r,n);else sO.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function YR(e,t,i){const r=t.eye,n=t.viewForward,s=(i[0]-r[0])*n[0]+(i[1]-r[1])*n[1]+(i[2]-r[2])*n[2];e.near=Math.min(e.near,s-i[3]),e.far=Math.max(e.far,s+i[3])}function JR(e,t,i){let r=[e,t,i];for(let e=0;e<4;++e){const t=r;r=[];for(let i=0;i<t.length;++i){const n=t[i],s=t[(i+1)%t.length];XR(s,e)?(XR(n,e)||r.push(KR(n,s,e)),r.push(s)):XR(n,e)&&r.push(KR(n,s,e))}}return r}function XR(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void(0,Lv.hu)(!1)}function KR(e,t,i){let r=0;return 0===i?r=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===i?r=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===i?r=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===i&&(r=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),(0,tf.l)((0,rf.Ue)(),e,t,r)}const QR=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],eO=(0,hh.c)(),tO=(0,Cl.Ue)(),iO=new eM.P,rO=new class{constructor(){this._items=new Pg.Z({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const t=e.eye,i=e.viewForward;this._items.forAll((e=>{const r=e.object.boundingVolumeWorldSpace.bounds,n=(r[0]-t[0])*i[0]+(r[1]-t[1])*i[1]+(r[2]-t[2])*i[2];e.distance=n,e.near=n-r[3],e.far=n+r[3]})),this._items.sort(((e,t)=>e.distance-t.distance))}forEachInDepthRange(e,t,i){if(t===ZR.Z.DepthOrder.FRONT_TO_BACK)for(let t=0;t<this._items.length;++t){const r=this._items.data[t];r.far<e.near||r.near>e.far||i(r.object,r.near,r.far)}else for(let t=this._items.length-1;t>=0;--t){const r=this._items.data[t];r.far<e.near||r.near>e.far||i(r.object,r.near,r.far)}}},nO=new class{constructor(){this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange=new eM.P(0,0)}compute(e,t,i){this._reset();const{viewMatrix:r}=e;t.forAll((e=>{e.forEachGeometry((e=>{if(!e.visible||i===GR.SHADOW_CASTERS&&!e.castShadow)return;const t=e.boundingSphere,n=r[2]*t[0]+r[6]*t[1]+r[10]*t[2]+r[14],s=n-t[3],o=n+t[3];this._geometries.push(e),this._near.push(-o),this._far.push(-s)}))}));const n=new eM.P;if(0===this._geometries.length)return n;for(let e=0;e<this._geometries.length;++e)this._near[e]>n.far&&(n.far=this._near[e]),this._near[e]>2&&this._far[e]<n.near&&(n.near=this._far[e]);const s=this._looseRange;s.near=Math.max(.5*n.near,2),s.far=2*n.far;let o=0,a=0;for(let e=0;e<this._geometries.length;++e)this._near[e]<n.near&&(this._near[e]>=s.near?n.near=this._near[e]:this._nearCandidates[o++]=e),this._far[e]>n.far&&(this._far[e]<=s.far?n.far=this._far[e]:this._farCandidates[a++]=e);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return n;this._nearCandidates.sort(((e,t)=>this._near[e]<this._near[t]?-1:this._near[e]>this._near[t]?1:0)),this._farCandidates.sort(((e,t)=>this._far[e]<this._far[t]?1:this._far[e]>this._far[t]?-1:0));for(let t=0;t<this._nearCandidates.length;++t){const i=this._nearCandidates[t];if(this._near[i]<n.near){const t=this._geometries[i],{boundingInfo:r,shaderTransformation:s}=t;this._includeNearBoundingInfoRec(e,r,s,n)}}for(let t=0;t<this._farCandidates.length;++t){const i=this._farCandidates[t];if(this._far[i]>n.far){const t=this._geometries[i],{boundingInfo:r,shaderTransformation:s}=t;this._includeFarBoundingInfoRec(e,r,s,n)}}return this._reset(),n}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_isOutsideSidePlanes(e,t){const i=(0,hh.a)(e),r=(0,hh.g)(e);return t[0][0]*i[0]+t[0][1]*i[1]+t[0][2]*i[2]+t[0][3]>r||t[1][0]*i[0]+t[1][1]*i[1]+t[1][2]*i[2]+t[1][3]>r||t[2][0]*i[0]+t[2][1]*i[1]+t[2][2]*i[2]+t[2][3]>r||t[3][0]*i[0]+t[3][1]*i[1]+t[3][2]*i[2]+t[3][3]>r}_includeNearBoundingInfoRec(e,t,i,r){if(null==t)return;const n=t.center;(0,hr.t)((0,hh.a)(eO),n,i),eO[3]=t.radius*(0,rl.u1)(i);const{frustum:s}=e;if(this._isOutsideSidePlanes(eO,s))return;const o=eO[0],a=eO[1],l=eO[2],c=eO[3],{viewMatrix:u}=e,h=u[2]*o+u[6]*a+u[10]*l+u[14],d=h+c;if(!(-(h-c)<2||-d>=r.near))if(-d>this._looseRange.near)r.near=-d;else{if(c>100){const n=t.getChildren();if(void 0!==n){for(const t of n)this._includeNearBoundingInfoRec(e,t,i,r);return}}sO.unionDepthRangeWithAABB(r,e.viewProjectionMatrix,i,t.bbMin,t.bbMax)}}_includeFarBoundingInfoRec(e,t,i,r){if(null==t)return;const n=t.center;(0,hr.t)((0,hh.a)(eO),n,i),eO[3]=t.radius*(0,rl.u1)(i);const{frustum:s}=e;if(this._isOutsideSidePlanes(eO,s))return;const[o,a,l,c]=eO,{viewMatrix:u}=e,h=u[2]*o+u[6]*a+u[10]*l+u[14]-c;if(!(-h<=r.far))if(-h<this._looseRange.far)r.far=-h;else{if(c>100){const n=t.getChildren();if(void 0!==n){for(const t of n)this._includeFarBoundingInfoRec(e,t,i,r);return}}sO.unionDepthRangeWithAABB(r,e.viewProjectionMatrix,i,t.bbMin,t.bbMax)}}},sO=new class{constructor(){this._modelViewProj=(0,Cl.Ue)(),this._clipPosition=[(0,rf.Ue)(),(0,rf.Ue)(),(0,rf.Ue)(),(0,rf.Ue)(),(0,rf.Ue)(),(0,rf.Ue)(),(0,rf.Ue)(),(0,rf.Ue)()]}unionDepthRangeWithAABB(e,t,i,r,n){const s=this._modelViewProj;(0,Tl.Jp)(s,t,i);let o=!1;for(let e=0;e<8;++e){const t=this._clipPosition[e],i=0===e||3===e||4===e||7===e?r[0]:n[0],o=0===e||1===e||4===e||5===e?r[1]:n[1],a=e<4?r[2]:n[2];t[0]=s[0]*i+s[4]*o+s[8]*a+s[12],t[1]=s[1]*i+s[5]*o+s[9]*a+s[13],t[2]=s[2]*i+s[6]*o+s[10]*a+s[14],t[3]=s[3]*i+s[7]*o+s[11]*a+s[15]}for(let t=0;t<12;++t){const i=JR(this._clipPosition[QR[t][0]],this._clipPosition[QR[t][1]],this._clipPosition[QR[t][2]]);let r=!0;for(let e=0;e<i.length;++e)if(i[e][3]>=2){r=!1;break}if(!r){o=!0;for(let t=0;t<i.length;++t){const r=i[t][3];Number.isFinite(r)&&(e.near=Math.min(r,e.near),e.far=Math.max(r,e.far))}}}return o}},oO={idleOpacity:.8,navigatingOpacity:.4,maxDelta:.1,tiltFadeStart:20,tiltFadeEnd:30,altitudeStart:1e4,altitudeEnd:2e4};class aO{constructor(e){this._fbos=e,this._requiresEmission=!1,this._size=new tC.Z(0,0),this._clearColor=(0,rf.Ue)()}dispose(){this._color=(0,m.RY)(this._color),this.releaseDepth()}initialize(e,t,i,r){this._size.width=e,this._size.height=t,(0,Fl.d)(this._size,this._fbos.rctx.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseDepth(),this._requiresEmission=r,(0,tf.c)(this._clearColor,i),n}releaseDepth(){this._color?.detachDepth(),this._depth=(0,m.RY)(this._depth)}update(e){const t=this._ensureColor();t.attachDepth(this.depth),this._color=e(t)}bind(){const e=null==this._color;if(this.color.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(this.color.fbo),e){const e=this._fbos.rctx;e.setClearStencil(0),e.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),e.clear(Rl.Hf.COLOR|Rl.Hf.DEPTH|Rl.Hf.STENCIL),this._requiresEmission&&e.gl.clearBufferfv(e.gl.COLOR,1,BA.AG)}}_acquireColor(){return this._requiresEmission?this._fbos.acquire(this._size.width,this._size.height,"acquired-color").acquireColor(Rl.VY.COLOR_ATTACHMENT1,DS.q.RGBA,"emissive"):this._fbos.acquire(this._size.width,this._size.height,"acquired-color")}_acquireDepth(){return this._fbos.acquireDepth(DS.m.DEPTH_STENCIL_TEXTURE,this._size.width,this._size.height,"depth")}get size(){return this._size}get color(){return this._ensureColor()}get depth(){return this._depth??=this._acquireDepth(),this._depth}_ensureColor(){return this._color??=this._acquireColor(),this._color}}var lO=n(4051);class cO{constructor(){this._inputs=new Map}set(e,t){this._inputs.set(e,t)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){this._inputs.get(e)?.release()&&this._inputs.delete(e)}}var uO=n(52436);class hO extends Al.A{constructor(e,t){super(e,t,new Ml.J(uO.a,(()=>n.e(65441).then(n.bind(n,65441))))),this.primitiveType=Rl.MX.TRIANGLE_STRIP}initializePipeline(){return(0,Ol.sm)({blending:Ol.Dh,colorWrite:Ol.gf,depthTest:null,depthWrite:null})}}var dO=n(50740);const pO=1/512;let fO=class extends P.Z{constructor(e,t,i,r){super({}),this._techniques=e,this._rctx=t,this._data=i,this._requestRender=r,this._passParameters=new uO.S(this._data),this._configuration=new dO.l,this._enabled=!1,this._vao=(0,iC.ow)(t)}dispose(){this._stop(),this._vao=(0,m.M2)(this._vao)}precompile(){this._showVisualization&&this._techniques.precompile(hO,this._configuration)}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const t=this._techniques.get(hO,this._configuration);this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,e,this._passParameters),this._rctx.drawArrays(t.primitiveType,0,(0,nc._V)(this._vao,"geometry"))}setOptions(e){void 0!==e.enabled&&this._setEnabled(e.enabled),void 0!==e.color&&this._setColor(e.color),void 0!==e.threshold&&(this._threshold=e.threshold),void 0!==e.visualization&&(this._visualization=e.visualization),void 0!==e.bandSize&&(this._bandSize=e.bandSize),void 0!==e.bandsEnabled&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>pO}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfEnabled())}get _visualization(){return this._configuration.visualization}set _visualization(e){e!==this._visualization&&(this._configuration.visualization=e,this._requestRenderIfEnabled())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfEnabled())}get _bandsEnabled(){return this._configuration.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._configuration.bandsEnabled=e,this._requestRenderIfEnabled())}_setColor(e){const t=this._passParameters.color;(0,tf.a)(e,t)||((0,tf.c)(this._passParameters.color,e),this._requestRenderIfEnabled())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};(0,i._)([(0,y.Cb)()],fO.prototype,"opacityFromElevation",null),fO=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],fO);var mO=n(95524),gO=n(89417);class yO extends Al.A{constructor(e,t){super(e,t,new Ml.J(gO.a,(()=>n.e(16614).then(n.bind(n,16614))))),this.primitiveType=Rl.MX.TRIANGLE_STRIP}initializePipeline(){return(0,Ol.sm)({blending:Ol.JI,colorWrite:Ol.gf,depthTest:null,depthWrite:null})}}let _O=class extends P.Z{constructor(e,t,i,r,n,s){super({}),this.fbos=e,this._techniques=t,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=n,this._requestRender=s,this._progress=0,this._sampleCount=0,this._passParameters=new KM.nj,this._cachedLightDirections=[],this._depthRange=eM.P.zero,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new tC.p(new mO.l(e,i.viewingMode)),this._bindParameters.shadowMap.enabled=!0,this._vao=(0,iC.ow)(this._rctx),this._accumulationRenderer=new fO(t,this._rctx,this,s);const o=this._stage.view.resourceController.scheduler;this.addHandles([o.registerTask(Ii.T8.SHADOW_ACCUMULATOR,this),(0,F.watch)((()=>i.renderView),(e=>{this.removeHandles(bO),null!=e&&this.addHandles(e.events.on("force-camera-for-screenshot",(()=>this._cameraForcedForScreenshot=!0)),bO)}),F.syncAndInitial),(0,F.watch)((()=>this._previewing),(()=>this._requestRenderIfEnabled()),F.sync)],this._shadowAccumulatorKey),t.precompile(yO)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=(0,m.M2)(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=(0,m.M2)(this._fbo),this._vao=(0,m.M2)(this._vao),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get accumulating(){return this._active&&this._previewing||this._refining}get _refining(){return this._active&&!this._doneAccumulating&&!this._previewing}get _active(){return null!=this._fbo&&this._sampleCount>0}get canAccumulate(){return null!=this._bindParameters.depth&&this._depthRange!==eM.P.zero&&this._opacityFromElevation>pO}get _doneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if((0,Xe.fS)(t,e,hr.I))return;const i=Math.min(gO.S,e.length);t.length=i,this._sampleCount=i;for(let r=0;r<i;++r)t[r]=(0,hr.c)(t[r]??(0,Pa.Ue)(),e[r]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._refining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._doneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.accumulating||!this.canAccumulate)return!1;(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();let n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(vO,this._sampleCount);n-=this._progress;for(let e=0;e<n;++e)this._accumulateShadow(),this._requestRender();return this._cameraForcedForScreenshot=!1,n>0}precompile(){this._accumulationRenderer.precompile()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(void 0!==e.enabled){const t=null!=this._fbo;e.enabled!==t&&(e.enabled?this._enable():this._disable())}void 0!==e.previewing&&(this._previewing=e.previewing),void 0!==e.lightDirections&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,t){return!this._active||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||t<0||t>=this._fbo.height?0:(this._fbo.readPixels(e,t,1,1,Rl.VI.RGBA,Rl.Br.UNSIGNED_BYTE,wO),wO[0]/this._progress)}_enable(){this._progress=0;const e=new Ul.X;e.pixelFormat=Rl.VI.RED,e.internalFormat=Rl.lP.R8,e.wrapMode=Rl.e8.CLAMP_TO_EDGE,this._fbo=new Fl.X(this._rctx,e),this._requestRender()}_disable(){this._fbo=(0,m.M2)(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(Rl.Hf.COLOR),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._techniques.get(yO);this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,(0,nc._V)(this._vao,"geometry"))}_updateCamera(e){const t=this._fbo;if(null==t)return;const i=this._bindParameters.camera;e.equals(i)||i.copyFrom(e),t.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-(0,yt.CW)(4e4,5e4,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};(0,i._)([(0,y.Cb)()],_O.prototype,"_progress",void 0),(0,i._)([(0,y.Cb)()],_O.prototype,"_sampleCount",void 0),(0,i._)([(0,y.Cb)()],_O.prototype,"_fbo",void 0),(0,i._)([(0,y.Cb)()],_O.prototype,"_depthRange",void 0),(0,i._)([(0,y.Cb)()],_O.prototype,"_previewing",void 0),(0,i._)([(0,y.Cb)()],_O.prototype,"_accumulationRenderer",void 0),(0,i._)([(0,y.Cb)()],_O.prototype,"_refining",null),(0,i._)([(0,y.Cb)()],_O.prototype,"_active",null),(0,i._)([(0,y.Cb)()],_O.prototype,"canAccumulate",null),(0,i._)([(0,y.Cb)()],_O.prototype,"_doneAccumulating",null),(0,i._)([(0,y.Cb)()],_O.prototype,"_opacityFromElevation",null),(0,i._)([(0,y.Cb)()],_O.prototype,"running",null),_O=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],_O);const vO=6,bO="renderView",wO=new Uint8Array(4),xO=(0,Da.d)();class TO{constructor(){this._plane=(0,Da.d)()}get plane(){return this._plane}set plane(e){(0,Da.a)(e||xO,this._plane)}}var CO,SO=n(75427),EO=n(40846),MO=n(31168),AO=n(33679);class RO{constructor(e,t){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,t.forEach((e=>{const t=this._timer.createQuery(),i=this._timer.createQuery();this._queryPool.push(t,i),this._queryResults.set(e,null)}))}start(){AO.P9||(this._currentQuery=this._queryPool.pop(),null!=this._currentQuery&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||null==this._currentQuery||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const t=this._queryResults.get(e);if(null==t)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(t))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(t)/1e6;return this._queryPool.unshift(t),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){null!=this._currentQuery&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){null!=this._currentQuery&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach((e=>{this._timer.deleteQuery(e)})),this._queryResults.forEach((e=>{null!=e&&this._timer.deleteQuery(e)}))}}!function(e){e.OVERLAY="overlay",e.PREPARE="prepare",e.SHADOW_MAP="shadow map",e.DEPTH="depth",e.ACCUMULATED_SHADOWS="accumulated shadows",e.APPLY_ACCUMULATED_SHADOWS="apply accumulated shadows",e.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",e.NORMALS="normals",e.SSAO="SSAO",e.HIGHLIGHTS="highlights",e.OPAQUE_EDGES="opaque edges",e.VOXEL="voxel",e.TRANSPARENT="transparent",e.TRANSPARENT_EDGES="transparent edges",e.HUD_VISIBILITY="HUD visibility",e.TRANSPARENT_TERRAIN="transparent terrain",e.TRANSPARENT_MATERIAL_WITHOUT_DEPTH="transparent material without depth",e.OPAQUE_ENVIRONMENT="opaque environment",e.TRANSPARENT_ENVIRONMENT="transparent environment",e.OCCLUDED="occluded",e.HUD="HUD",e.HUD_OCCLUDED="HUD occluded",e.FINISH="finish",e.FOCUS_AREA_MASK="focus area mask"}(CO||(CO={}));const OO=Object.values(Zl.lu).concat(Object.values(Zl.CM)).concat(Object.values(CO)),PO="Total";class IO{constructor(e){this._rctx=e,this._startTimeStampCPU=(0,en.HA)(0),this._lastTimeStampCPU=(0,en.HA)(0),this._totalCPUTime=new MO.Z(PO),this._cpuTimeSamplers=new Map(OO.map((e=>[e,new MO.Z(e)]))),this._enableGPUTimer=0,this._totalGPUTime=new MO.Z("GPU"),this._gpuTimeSamplers=new Map(OO.map((e=>[e,new MO.Z(e)]))),this._totalTime=(0,en.HA)(0),this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return null!=this._gpuTimerPool}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return(0,en.HA)(performance.now()-this._startTimeStampCPU)}enableGPUPerformanceInfo(){if(null==this._gpuTimerPool){const e=[...OO,PO];this._gpuTimerPool=function(e,t){const i=e.capabilities.disjointTimerQuery;return null==i?null:new RO(i,t)}(this._rctx,e)}if(null==this._gpuTimerPool)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=(0,m.M2)(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=(0,en.HA)(performance.now()),this._gpuTimerPool&&(this._gpuTimeSamplers.forEach((e=>e.push(0))),this._gpuTimerPool.start())}advance(e){const t=(0,en.HA)(performance.now());if(this._cpuTimeSamplers.get(e).push(t-this._lastTimeStampCPU),this._lastTimeStampCPU=t,this._gpuTimerPool){const t=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).set(t),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const e=this._gpuTimerPool.stop(CO.FINISH);this._gpuTimeSamplers.get(CO.FINISH).set(e),this._rctx.gl.flush()}const e=(0,en.HA)(performance.now()-this._startTimeStampCPU);this._totalTime=(0,en.HA)(this._totalTime+e),this._totalCPUTime.push(e),this._gpuTimerPool&&this._totalGPUTime.push(this.gpuTimeSamplers.reduce(((e,t)=>e+(t.last||0)),0)),++this._totalFrameCount}}class LO{constructor(e,t,i,r,n,s){this._stage=e,this._techniques=i,this._rctx=r,this._compositingHelper=n,this._requestRender=s,this._pluginsHas={hudElements:!1,water:!1},this._renderers=new Map,this.renderPassManager=new wR,this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=(0,rf.al)(0,0,0,1),this._sliceHelper=new TO,this._blit=null,this._oitblend=null,this._state=(0,yl.t)(Pi.n.IDLE),this._highQualityTransparencyEnabled=!0,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new NR,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=(0,yl.t)(0),this._lastFrameTime=(0,en.HA)(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new cO,this._releaseNormals=e=>{e.some((({name:e})=>"normals"===e))&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new YA(r),this._renderStateFeatures=(0,yl.t)((0,nm.n)(!(0,w.Z)("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._framebuffer=new aO(this.fboCache),this.performanceInfo=new IO(this._rctx),this._shadowMap=new mO.l(this.fboCache,e.viewingMode),this._shadowAccumulator=new _O(this.fboCache,i,e,(e=>{const t=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(e.camera,e.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=t}),((e,t,i)=>{const r=this._stage.view.qualitySettings.maximumPixelRatio;e.shadowMap.start(e.camera,t,i,!0,r),this._renderShadowCascades(Lw.H_.Shadow,e.shadowMap),e.shadowMap.finish(),e.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(e.camera,e.contentCamera)}),s),this._renderContext=new lO.V1(this._rctx,this._shadowMap,i),this._nodes=new MR(this._renderContext),this._plugins=new AR({renderContext:this._renderContext,techniques:i,materials:t,requestRender:s,controller:e,fbos:this.fboCache,isFeatureEnabled:e=>this.isFeatureEnabled(e)}),this._plugins.add(this.renderPassManager),this._handles=[(0,F.watch)((()=>this._stage.view.state.camera),(()=>s()),F.syncAndInitial),(0,F.watch)((()=>Ig.h.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES),(e=>{this._renderHiddenTransparentEdges=e?()=>this._renderEdges(SO.i.TRANSPARENT):()=>{},s()}),F.initial),(0,F.watch)((()=>this._stage.view.environment.background?.color),(e=>{const t=e?(0,AS.O)(e):rf.AG;(0,tf.s)(this._backgroundColor,t[0]*t[3],t[1]*t[3],t[2]*t[3],t[3]),s()}),F.syncAndInitial),(0,F.watch)((()=>this._stage.view.state.camera.relativeElevation),(e=>this._inGlobeView=(e??1/0)>=SR.o),F.syncAndInitial),(0,F.watch)((()=>this._bindParameters.clouds.fadeFactor),(()=>this._bindParameters.fadeLighting()),F.sync),(0,F.watch)((()=>this._bindParameters.clouds.data?.state),(()=>s()),F.sync),(0,F.watch)((()=>this._stage.view.state.highlights),(e=>{this._bindParameters.highlights=e,this._updateHighlights(),s()}),F.initial)]}destroy(){this._handles.forEach((e=>e.remove())),this._gpuTimerHandle=(0,m.hw)(this._gpuTimerHandle),this._nodes.destroy(),this._framebuffer.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=(0,m.IM)(this._loadEdgeViewTask),this._edgeView=(0,m.SC)(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),this._renderers.clear(),this._blit=null,this._oitblend=null,jR.j.prune(),EO.A.prune(),(0,vE.WV)()}get renderContext(){return this._renderContext}get _bindParameters(){return this._renderContext.bind}get _framebufferSize(){return this._framebuffer.size}updateRenderFeatures(e=null,t=!(0,w.Z)("disable-feature:high-quality-idle")){this._renderStateFeatures.value=(0,nm.n)(t,e),this._requestRender()}isFeatureEnabled(e,t=this._state.value){return this._renderStateFeatures.value.get(t,e)??!1}setFeatureEnabled(e,t,i){this._renderStateFeatures.mutate((r=>r.set(t,e,i))),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(nm.Y.HighQualityTransparency)}get hasReflections(){return this._pluginsHas.water&&(this._ssrEnabled||this.isFeatureEnabled(nm.Y.WaterReflection))}get _hasHighlights(){return this._plugins.produces(Lw.H_.Highlight,NC.r.OPAQUE_MATERIAL,NC.r.TRANSPARENT_MATERIAL,NC.r.DRAPED_MATERIAL,NC.r.HUD_MATERIAL,NC.r.LABEL_MATERIAL)}hasHighlightOptions(e){return this._plugins.hasHighlightOptions(e)}get _hasHUDHighlights(){return this._plugins.produces(Lw.H_.Highlight,NC.r.HUD_MATERIAL,NC.r.LABEL_MATERIAL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(nm.Y.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(nm.Y.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(nm.Y.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=(0,m.RY)(this._bindParameters.ssr.lastFrameColor),this._bindParameters.terrainDepth=(0,m.RY)(this._bindParameters.terrainDepth),this._bindParameters.geometryDepth=(0,m.RY)(this._bindParameters.geometryDepth)}_disposeOffscreenBuffers(){this._framebuffer.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=(0,m.RY)(this._bindParameters.depth),this._bindParameters.hudVisibility=(0,m.RY)(this._bindParameters.hudVisibility)}get updating(){return null!=this._edgeView&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=(0,be.vr)((async e=>{const{EdgeView:t}=await n.e(95631).then(n.bind(n,95631));(0,g.k_)(e);const i=this._edgeView=new t({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:ZO(this._stage.view.resourceController)});return this._handles.push((0,F.watch)((()=>i.updating),(()=>this._requestRender()),F.sync)),this._requestRender(),this._edgeViewCallbacks.forEach((e=>e(i))),this._edgeViewCallbacks.length=0,i}))),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),null==this._edgeView?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&(0,Tl.fS)(this._bindParameters.ssr.reprojectionMatrix,Cl.Wd)}set _reprojectionMatrix(e){(0,Xe.Vx)(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(e){const{_shadowMap:t,_bindParameters:i}=this;if(void 0!==e.qualitySettings?.reflections&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),void 0!==e.shadowMap&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),void 0!==e.shadowMapMaxCascades&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),null!=e.environment){null!=e.environment.weather&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const t="virtual"!==e.environment.lighting.type;i.enableFillLights!==t&&(i.enableFillLights=t,this._requestRender())}void 0!==e.highQualityTransparency&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),void 0!==e.shadowCast&&this._shadowAccumulator.setOptions(e.shadowCast)}set slicePlane(e){this._sliceHelper.plane!==e&&(this._sliceHelper.plane=e,this._requestRender())}get plugins(){return this._plugins}getMaterialRenderer(e){return this._renderers.get(e)}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,t){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:r,updates:n}=e;0===i.length&&0===r.length&&0===n.length||((0,rm.q9)(e).forEach(((i,r)=>{if(t.done)return;let n=this._renderers.get(r);null==n&&i.adds.length>0&&(n=new EO.A({material:r,highlightOrderMap:this._stage.view.state.highlightOrderMap}),n.initializeRenderContext(this._plugins.context),this._plugins.add(n),this._renderers.set(r,n)),n&&(n.modify(i),n.updateHighlights(this._stage.view.state.highlightOrderMap),0===n.numGeometries&&(this._renderers.delete(n.material),this._plugins.remove(n),n.destroy())),i.removes.forEach((t=>e.removes.removeUnordered(t))),i.adds.forEach((t=>e.adds.removeUnordered(t))),i.updates.forEach((t=>e.updates.removeUnordered(t))),t.madeProgress()})),this.updateHasFlags())}updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(Lw.H_.Color,...BO),e.water=this._plugins.produces(Lw.H_.Normal,NC.r.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees,this._requestRender()}updateAnimation(e,t){this._animationTimer??=new DR(e.camera,t),this._animationTimer.advance(e.camera,t,this._animationTimeDilation),null!=e.forcedAnimationTime&&this._animationTimer.forceTime(e.forcedAnimationTime);const i=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(this._animationTimer),this._hasAnimations=this._nodes.updateAnimation(this._animationTimer)||this._hasAnimations,this._hasAnimations!==i&&(this._gpuTimerHandle=i?(0,m.hw)(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get _animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,t,i=rm.YE.Default,r=!1){try{return this._isRendering=!0,this._render(e,t,i,r)}catch(e){console.error(`Exception during rendering: ${e}`)}finally{this._isRendering=!1}return new dw(this._pluginInput.get(Zl.lu.FINAL),null)}_updateHUDOccludedFragmentOpacity(e,t){const{idleOpacity:i,navigatingOpacity:r,maxDelta:n,tiltFadeStart:s,tiltFadeEnd:o,altitudeStart:a,altitudeEnd:l}=oO,c=this._stage.view,u=c.stateManager.camera,h=c.qualitySettings.fadeDuration,d=e===Pi.n.IDLE?i:r,p=(0,yt.uZ)((u.tilt-s)/(o-s),0,1),f=(0,yt.uZ)((u.position.z??0-a)/(l-a),0,1),m=(0,yt.t7)((0,yt.t7)(1,d,p),1,f),g=this._bindParameters.hudOccludedFragmentOpacity;if(h<=0||g===m||0===this._lastFrameTime||this._lastFrameTime>t)return this._bindParameters.hudOccludedFragmentOpacity=m,void(this._lastFrameTime=t);const y=t-this._lastFrameTime;this._lastFrameTime=t;const _=Math.min(Math.abs(i-r)*y/h,n);_>=Math.abs(m-g)?this._bindParameters.hudOccludedFragmentOpacity=m:(this._bindParameters.hudOccludedFragmentOpacity=g+Math.sign(m-g)*_,this._requestRender())}_render(e,t,i=rm.YE.Default,r){this.performanceInfo.startFrame(),this.fboCache.frameStart(),this.fboCache.interactive=i===rm.YE.Default,this._disposeBindBuffers();const{camera:n,contentCamera:s,mode:o,alignPixelEnabled:a}=e;this._state.value=o;const l=this._nodes.produces("magnifier-color"),c=this._nodes.produces(Zl.lu.FINAL),u=this._nodes.require("emissive",Zl.lu.FINAL,Zl.lu.COMPOSITE)>0&&this._plugins.hasEmissions,h=u?Lw.H_.ColorEmission:Lw.H_.Color;this._renderContext.time=t,this._renderContext.output=h,this._bindParameters.oitPass=uR.M.NONE,this._bindParameters.alignPixelEnabled=a,this._bindParameters.decorations=!r,this._bindParameters.mainDepth=null,this._bindParameters.slicePlane=this._sliceHelper.plane,this._bindParameters.viewshedEnabled=this._nodes.produces(Zl.CM.VIEWSHED),this._renderOverlay(t),n.setGLViewport(this._rctx);const d=this._framebuffer,p=d.initialize(n.fullWidth,n.fullHeight,this._backgroundColor,u);this.hasReflections?(p?.setName("last frame color"),this._bindParameters.ssr.lastFrameColor=p):p?.release(),this._ensureBindParametersCamera(n,s),this._updateHUDOccludedFragmentOpacity(o,t),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&!r;const f=this._highQualityTransparency&&this._hasTransparentTerrain,g=this._plugins.produces(Lw.H_.Color,...kO);this._precompilePrepasses(),this.performanceInfo.advance(CO.PREPARE);const y=this._computeDepthRange(n);this._renderShadowMap(n,this._bindParameters.lighting.mainLight.direction,y),this._ensureBindParametersCamera(n,s),this._pluginInput.set("normals",this._renderNormals()),this._renderRemainingGeometryDepth(),this._renderShadowAccumulation(y,n,s),this._ensureBindParametersSSR(t),this._precompileShaders(f,g,h),this._renderContext.output=h,d.bind(),this._bindParameters.mainDepth=d.depth.attachment;const _=this.plugins.produces(Lw.H_.Color,...UO);_&&this._renderOpaqueGeometry(),d.update((e=>this._renderNodes(Zl.lu.OPAQUE,e,_))),this.fboCache.debugCallback?.(Zl.lu.OPAQUE,d.color.fbo),d.update((e=>this._renderNodes(Zl.CM.OPAQUE_ENVIRONMENT,e))),this.fboCache.debugCallback?.(Zl.CM.OPAQUE_ENVIRONMENT,d.color.fbo),this._renderTerrainDepth(f),this._renderEdges(SO.i.OPAQUE),d.bind(),this._renderPlugins(NC.r.VOXEL,CO.VOXEL),this._renderHiddenTransparentEdges(),g&&(this._oitEnabled?this._renderOIT(DO.Geometry,h):this._renderTransparentGeometry()),d.update((e=>this._renderNodes(Zl.lu.TRANSPARENT,e,g))),this.fboCache.debugCallback?.(Zl.lu.TRANSPARENT,d.color.fbo),this._renderGeometryDepth(f),this._renderHUDVisibility(),f||this._plugins.render(this._pluginInput,NC.r.LINE_CALLOUTS),this._renderEdges(SO.i.TRANSPARENT);const v=this._hasTransparentTerrain?this._renderTransparentTerrain():null;v&&(this.performanceInfo.advance(CO.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(f?this._renderLineCallouts(UM.U.Occluded):(this._rctx.bindFramebuffer(this._bindParameters.hudVisibility?.fbo),this._compositingHelper.compositeHUD(this._bindParameters,v.getTexture())),this._renderHUD(UM.U.Occluded,d.color,h))),this._bindParameters.cullAboveTerrain=!1,v&&(d.bind(),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,v.getTexture()),v.release(),f&&(this._renderEdges(SO.i.OPAQUE),g&&(this._oitEnabled?this._renderOIT(DO.Geometry,h):this._renderTransparentGeometry(),this.performanceInfo.advance(CO.TRANSPARENT)),this._renderEdges(SO.i.TRANSPARENT))),this._bindParameters.ssao=(0,m.RY)(this._bindParameters.ssao),f&&this._renderLineCallouts(UM.U.NotOccluded),this._bindParameters.terrainDepthTest=!1,this._renderTransparentEnvironment(),this._pluginInput.set(Zl.CM.FOCUSAREA,this._renderFocusAreaGeometry()),d.update((e=>this._renderNodes(Zl.CM.TRANSPARENT_ENVIRONMENT,e))),d.update((e=>this._renderNodes(Zl.CM.VIEWSHED,e))),d.update((e=>this._renderNodes(Zl.CM.LASERLINES,e))),d.update((e=>this._renderNodes(Zl.CM.OCCLUDED,e))),this._pluginInput.set("highlights",this._renderHighlightPrepass());const b=i===rm.YE.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;d.update((e=>this._renderNodes(Zl.lu.COMPOSITE,e))),this._pluginInput.release(Zl.CM.FOCUSAREA);const w=!(i!==rm.YE.Default||c||l&&!r),x=this._pluginInput.get(Zl.lu.COMPOSITE),T=w?JA:this.fboCache.acquire(x.fbo.width,x.fbo.height,Zl.CM.ANTIALIASING),C=this._nodes.produces(Zl.CM.ANTIALIASING)?this._renderNodes(Zl.CM.ANTIALIASING,T):this._blitFBO(x,T,!1);let S;this._pluginInput.set(Zl.CM.ANTIALIASING,C),this._hasHUDHighlights?(this._renderHUD(UM.U.NotOccluded,C,h),S=this._renderNodes(Zl.CM.HIGHLIGHTS,C)):(S=this._renderNodes(Zl.CM.HIGHLIGHTS,C),this._renderHUD(UM.U.NotOccluded,S,h));const E=this._renderNodes(Zl.CM.MAGNIFIER,S);return l&&!r&&i===rm.YE.Default&&!c&&this._blitFBO(E),c?(E.attachDepth(d.depth),this._blitFBO(this._renderNodes(Zl.lu.FINAL,E)),E.detachDepth()):this._pluginInput.set(Zl.lu.FINAL,E),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),d.releaseDepth(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),i!==rm.YE.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),new dw(this._pluginInput.get(Zl.lu.FINAL),b)}_precompileShaders(e,t,i){if(++this._plugins.context.techniques.precompiling,this._renderContext.output=i,this._precompileOpaqueGeometry(),this._nodes.precompile(Zl.CM.OPAQUE_ENVIRONMENT),this._bindParameters.terrainDepthTest=e,this._bindParameters.cullAboveTerrain=e,this._renderContext.output=Lw.H_.Depth,this._plugins.precompile(NC.r.TRANSPARENT_TERRAIN),e&&(this._precompileOpaqueGeometry(),this._precompileTransparentGeometry()),this._renderContext.output=i,this._plugins.precompile(NC.r.TRANSPARENT_TERRAIN),t&&(this._precompileTransparentGeometry(),this._hasTransparentTerrain&&(this._bindParameters.cullAboveTerrain=!1,this._precompileTransparentGeometry(),this._bindParameters.cullAboveTerrain=e)),this._nodes.precompile(Zl.CM.FOCUSAREA),this._needsHUDVisibility&&this._plugins.precompile(NC.r.OCCLUSION_PIXELS),this._plugins.precompile(NC.r.LINE_CALLOUTS),this._precompileHUD(UM.U.Occluded),this._bindParameters.terrainDepthTest=!1,this._bindParameters.cullAboveTerrain=!1,this._nodes.precompile(Zl.CM.VIEWSHED,Zl.CM.LASERLINES,Zl.CM.OCCLUDED,Zl.CM.ANTIALIASING,Zl.CM.HIGHLIGHTS),this._precompileHUD(UM.U.NotOccluded),this._hasHighlights){const e=this._bindParameters;e.highlights.forEach(((t,i)=>{e.highlightLevel=i,this._precompileAllGeometry(Lw.H_.Highlight)})),e.highlightLevel=null}this._nodes.precompile(Zl.lu.COMPOSITE,Zl.CM.MAGNIFIER),this._shadowAccumulator.precompile(),this._plugins.precompile(NC.r.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),--this._plugins.context.techniques.precompiling}_updateHighlights(){const e=this._stage.view.state;this._renderers.forEach((t=>t.updateHighlights(e.highlightOrderMap)))}_renderFocusAreaGeometry(){if(!this._nodes.produces(Zl.CM.FOCUSAREA))return null;const{width:e,height:t}=this._framebufferSize;let i=this.fboCache.acquire(e,t,Zl.CM.FOCUSAREA);return i=this._nodes.render(i,this._pluginInput),this.performanceInfo.advance(CO.FOCUS_AREA_MASK),i}_renderObjectAndLayerIdColor(){if(!this._nodes.produces("olid"))return null;const e=this._renderContext.output;++this._techniques.precompiling;const t=this._framebufferSize;let i=this.fboCache.acquire(t.width,t.height,"olid");return i.acquireDepth(DS.m.DEPTH_STENCIL_TEXTURE),i=this._nodes.render(i,this._pluginInput),--this._techniques.precompiling,this.performanceInfo.advance(CO.OBJECT_AND_LAYER_ID_COLOR),this._renderContext.output=e,i}finish(e){this._hasAnimations||this._animationTimestep.clear();const t=this.performanceInfo.gpuSamplingEnabled,i=e===tc.Xx.BACKGROUND;if(i||t){const e=i?this.performanceInfo.elapsedTime:0;let r=0;t?r=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.finish();const n=Math.max(e,r);this._animationTimestep.frame(n,i)}}readMainDepth(e,t){const{mainDepth:i,camera:r}=this._bindParameters;if(!i)return;const n=this.fboCache.acquire(this._framebufferSize.width,this._framebufferSize.height,"linear-depth");this._rctx.bindFramebuffer(n.fbo),r.setGLViewport(this._rctx),this._rctx.setScissorRect(e[0],e[1],e[2],e[3]),this._rctx.setScissorTestEnabled(!0),this._rctx.clearFramebuffer(rf.AG),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,i),this._rctx.setScissorTestEnabled(!1),this._rctx.setScissorRect(0,0,this._rctx.gl.canvas.width,this._rctx.gl.canvas.width),n.fbo?.readPixels(e[0],e[1],e[2],e[3],Rl.VI.RGBA,Rl.Br.UNSIGNED_BYTE,t),n.release()}readHUDVisibility(e,t,i,r,n){this._bindParameters.hudVisibility?.fbo?.readPixels(e,t,i,r,Rl.VI.RGBA,Rl.Br.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_renderEdges(e){const t=this._edgeView;if(!t?.shouldRender())return;const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"edges"),n=this._bindParameters.geometryDepth;this.renderToTargets((()=>t.render(this._bindParameters,e)),r,n??this._framebuffer.depth,rf.AG),this._framebuffer.bind(),this._compositingHelper.composite(this._bindParameters,r.getTexture()),r.release(),this.performanceInfo.advance(e===SO.i.OPAQUE?CO.OPAQUE_EDGES:CO.TRANSPARENT_EDGES)}_renderOverlay(e){this._bindParameters.overlay=this.overlay?.render(e),this._bindParameters.overlay&&this.performanceInfo.advance(CO.OVERLAY)}_renderShadowMap(e,t,i){if(!this.shadowsEnabled)return;const r=this._shadowMap;r.start(e,t,i,this.isFeatureEnabled(nm.Y.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(Lw.H_.ShadowHighlight,this._shadowMap),r.moveSnapshot(mO.i.Highlight),this._renderShadowCascades(Lw.H_.ShadowExcludeHighlight,this._shadowMap),r.copySnapshot(mO.i.ExcludeHighlight),this._renderShadowCascades(Lw.H_.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(Lw.H_.Shadow),r.finish(),e.setGLViewport(this._rctx),this.performanceInfo.advance(CO.SHADOW_MAP)}_precompileShadowCascades(e){for(const t of this._shadowMap.cascades)t.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(t.camera,t.camera),this._precompileAllGeometry(e)}_renderShadowCascades(e,t=this._shadowMap){for(const i of t.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this.renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(Lw.H_.Depth)||this._nodes.requireGeometryDepth()||this.hasReflections||this._needsShadowHighlight||this._needsShadowAccumulation||this._debugNeedsDepth}_renderRemainingGeometryDepth(){const e=this._pluginInput.get("normals");if(e){const t=this._needsDepth?e.getAttachment(Rl.Lu):null;t?.retain(),this._pluginInput.set(Zl.CM.SSAO,this._renderSSAO()),this._renderGeometryWithoutNormalsDepth(t)}else this._renderAllGeometryDepth()}_renderGeometryWithoutNormalsDepth(e){if(!this._needsDepth||!e)return void(this._bindParameters.depth=(0,m.RY)(this._bindParameters.depth));const t=this._framebufferSize,i=this.fboCache.acquire(t.width,t.height,"depth");i.attachDepth(e),e.release(),this._rctx.bindFramebuffer(i.fbo),this._rctx.clear(Rl.Hf.STENCIL),this._renderGeometryWithoutNormals(Lw.H_.Depth),(0,m.RY)(this._bindParameters.depth),this._bindParameters.depth=i.obtainDepthTexture(),i.release(),this.performanceInfo.advance(CO.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=(0,m.RY)(this._bindParameters.depth));const e=this._framebufferSize,t=this.fboCache.acquire(e.width,e.height,"depth").acquireDepth(DS.m.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(t.fbo),this._rctx.clear(Rl.Hf.DEPTH|Rl.Hf.STENCIL),this.renderAllGeometry(Lw.H_.Depth),(0,m.RY)(this._bindParameters.depth),this._bindParameters.depth=t.obtainDepthTexture(),t.release(),this.performanceInfo.advance(CO.DEPTH)}_renderTerrainDepth(e){if(this._bindParameters.terrainDepthTest=e,this._bindParameters.cullAboveTerrain=e,!e)return void(this._bindParameters.terrainDepth=(0,m.RY)(this._bindParameters.terrainDepth));const t=this._renderContext.output;this._renderContext.output=Lw.H_.Depth;const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"terrain depth").acquireDepth(DS.m.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(r.fbo),this._rctx.clear(Rl.Hf.DEPTH|Rl.Hf.STENCIL),this._renderTransparentTerrain(),(0,m.RY)(this._bindParameters.terrainDepth),this._bindParameters.terrainDepth=r.obtainDepthTexture(),this._renderContext.output=t,r.release()}_renderGeometryDepth(e){if(!e)return void(this._bindParameters.geometryDepth=(0,m.RY)(this._bindParameters.geometryDepth));const t=this._renderContext.output,{width:i,height:r}=this._framebufferSize,n=this.fboCache.acquire(i,r,"geometry depth").acquireDepth(DS.m.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clear(Rl.Hf.DEPTH|Rl.Hf.STENCIL),this._renderOpaqueAndTransparentGeometry(Lw.H_.Depth),this._renderContext.output=t,(0,m.RY)(this._bindParameters.geometryDepth),this._bindParameters.geometryDepth=n.obtainDepthTexture(),n.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowAccumulation}_computeDepthRange(e){if(!this._needsDepthRange)return eM.P.zero;const t=qR(e,this._plugins.plugins,this._stage.layers);return t.union(this._plugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}get _normalsRequired(){const e=this._nodes.require("normals",Zl.lu.FINAL,Zl.lu.COMPOSITE,Zl.lu.OPAQUE,Zl.lu.TRANSPARENT,Zl.CM.VIEWSHED,Zl.CM.LASERLINES);return(this.hasSSAO?1:0)+e}_precompilePrepasses(){this._normalsRequired&&this._precompileAllGeometry(Lw.H_.Normal),this._needsDepth&&this._precompileAllGeometry(Lw.H_.Depth),this.shadowsEnabled&&(this._needsShadowHighlight?(this._precompileShadowCascades(Lw.H_.ShadowHighlight),this._precompileShadowCascades(Lw.H_.ShadowExcludeHighlight),this._precompileShadowCascades(Lw.H_.ShadowHighlight)):this._precompileShadowCascades(Lw.H_.Shadow)),this._needsShadowAccumulation&&this._precompileAllGeometry(Lw.H_.Shadow)}_renderNormals(){const e=this._normalsRequired;if(0===e)return;const t=this._framebufferSize,i=this.fboCache.acquire(t.width,t.height,"normals",DS.q.RGBA);i.acquireDepth(DS.m.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(i.fbo),this._rctx.clearFramebuffer(rf.AG,!0,!0),this._renderGeometryWithNormals(Lw.H_.Normal);const r=this._nodes.optional("normals",Zl.lu.FINAL,Zl.lu.COMPOSITE,Zl.lu.OPAQUE,Zl.lu.TRANSPARENT,Zl.CM.VIEWSHED);return i.retain(e+r-1),this.performanceInfo.advance(CO.NORMALS),i}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return void e?.detachDepth();JA.setName(Zl.CM.SSAO);const t=this._nodes.render(JA,this._pluginInput);return this._bindParameters.ssao=t,e.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(CO.SSAO),t}_precompileAllGeometry(e){const t=this._renderContext.output;this._renderContext.output=e,this._precompileOpaqueGeometry(),this._precompileTransparentGeometry(),this._plugins.precompile(NC.r.TRANSPARENT_TERRAIN),this._renderContext.output=t}renderAllGeometry(e){this._renderContext.output=e,this._renderOpaqueAndTransparentGeometry(e),this._renderTransparentTerrain()}precompileSlots(e,...t){for(const i of t)this._bindParameters.slot=i,e.precompile(this._renderContext)}precompileOccludedSlots(e,t){for(const i of t)this._renderContext.renderOccludedMask=i,this.precompileSlots(e,...zO);this._renderContext.renderOccludedMask=lO.C9}renderSlots(e,...t){for(const i of t)this._bindParameters.slot=i,e.forAll((e=>{const t=e.acquireTechniques(this._renderContext);t&&e.render(this._renderContext,t,this._pluginInput)}))}renderOccludedSlots(e,t){this._renderContext.renderOccludedMask=t,this.plugins.renderOccludedFlags>DC.yD.Occlude&&this._plugins.render(this._pluginInput,NC.r.OCCLUDED_TERRAIN),this.renderSlots(e,...zO),this._renderContext.renderOccludedMask=lO.C9}renderHUD(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(this._pluginInput,NC.r.HUD_MATERIAL)}precompileViewshedShadowMap(){this._precompileAllGeometry(Lw.H_.ViewshedShadow)}renderViewshedShadowMap(e){const{camera:t,contentCamera:i}=this._bindParameters,r=this._renderContext.output;e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,e),this.renderAllGeometry(Lw.H_.ViewshedShadow),this._ensureBindParametersCamera(t,i),this._bindParameters.camera.setGLViewport(this._rctx),this._renderContext.output=r}_renderOpaqueAndTransparentGeometry(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderGeometryWithNormals(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,...NO),this._renderTransparentTerrain()}_renderGeometryWithoutNormals(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,...FO)}_precompileOpaqueGeometry(){this._plugins.precompile(...UO)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...UO)}_renderTransparentGeometry(){this._plugins.render(this._pluginInput,...kO)}get _hasTransparentTerrain(){return this._plugins.produces(Lw.H_.Color,NC.r.TRANSPARENT_TERRAIN)}_renderTransparentTerrain(){const e=()=>this._plugins.render(this._pluginInput,NC.r.TRANSPARENT_TERRAIN);if(!(0,Lw.c1)(this._renderContext.output))return void e();const t=this._framebufferSize,i=this.fboCache.acquire(t.width,t.height,"transparent terrain");return this.renderToTargets(e,i,this._framebuffer.depth,rf.AG),i}get _needsHUDVisibility(){return this._plugins.produces(this._renderContext.output,NC.r.OCCLUSION_PIXELS)}_renderHUDVisibility(){if(!this._needsHUDVisibility)return void(this._bindParameters.hudVisibility=(0,m.RY)(this._bindParameters.hudVisibility));const{width:e,height:t}=this._framebufferSize;let i=this._bindParameters.hudVisibility;i?.fbo?.width===e&&i?.fbo?.height===t||(i?.release(),i=this.fboCache.acquire(e,t,"hud visibility",DS.q.RGBA4),this._bindParameters.hudVisibility=i);const r=this._bindParameters.geometryDepth;i.attachDepth(r||this._framebuffer.depth),this._rctx.bindFramebuffer(i.fbo),this._rctx.clearFramebuffer([0,1,0,1]),this._plugins.render(this._pluginInput,NC.r.OCCLUSION_PIXELS),i.detachDepth(),this._framebuffer.bind(),this.performanceInfo.advance(CO.HUD_VISIBILITY)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===UM.U.Occluded){const e=()=>this._plugins.render(this._pluginInput,NC.r.LINE_CALLOUTS),t=this._framebufferSize,i=this.fboCache.acquireDepth(DS.m.DEPTH16_BUFFER,t.width,t.height,"line callouts");this.renderToTargets(e,this._framebuffer.color,i,void 0,!0,!0),i.release()}else this._plugins.render(this._pluginInput,NC.r.LINE_CALLOUTS)}_precompileHUD(e){if(this._precompileHUDOutput(e),this._hasHighlights){const t=this._renderContext.output;this._renderContext.output=Lw.H_.Highlight,this._precompileHUDOutput(e),this._renderContext.output=t}}_precompileHUDOutput(e){const t=this._bindParameters.hudRenderStyle;this._bindParameters.hudRenderStyle=e,this._oitEnabled&&(0,Lw.c1)(this._renderContext.output)?(this._bindParameters.oitPass=uR.M.ColorAlpha,this._plugins.precompile(...BO),this._bindParameters.oitPass=uR.M.FrontFace,this._plugins.precompile(...BO),this._bindParameters.oitPass=uR.M.NONE):this._plugins.precompile(...BO),this._bindParameters.hudRenderStyle=t}_renderHUD(e,t,i){if(this._pluginsHas.hudElements){if(this._oitEnabled){const r=this._renderOIT(DO.HUD,i,e);this._rctx.bindFramebuffer(t.fbo),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,r.getTexture()),r.release()}else if(this._renderContext.output=i,e===UM.U.Occluded){const t=()=>this._renderHUDElements(e),i=this._framebufferSize,r=this.fboCache.acquireDepth(DS.m.DEPTH16_BUFFER,i.width,i.height,"hud");this.renderToTargets(t,this._framebuffer.color,r,void 0,!0,!0),r.release()}else t.acquireDepth(DS.m.DEPTH16_BUFFER),this._rctx.bindFramebuffer(t.fbo),this._renderHUDElements(e),t.detachDepth();this.performanceInfo.advance(e===UM.U.Occluded?CO.HUD_OCCLUDED:CO.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(this._pluginInput,...BO)}get _needsShadowHighlight(){return this.shadowsEnabled&&this._plugins.produces(Lw.H_.ShadowHighlight,NC.r.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this._hasHighlights)return;const{fboCache:e,_rctx:t,_bindParameters:i}=this,r=this._framebufferSize,n=e.acquire(r.width,r.height,"highlights",DS.q.RG);return n.acquireDepth(DS.m.DEPTH_STENCIL_TEXTURE),t.bindFramebuffer(n.fbo),t.clearFramebuffer(rf.AG,!0),this._renderContext.output=Lw.H_.Highlight,t.bindFramebuffer(n.fbo),(0,XM.m7)(t,e,r,i,(()=>this._renderHighlightGeometries())),this.performanceInfo.advance(CO.HIGHLIGHTS),n}_renderHighlightGeometries(){this._plugins.render(this._pluginInput,...VO),this._rctx.clear(Rl.Hf.DEPTH),this._renderHUDElements(UM.U.Both)}get _needsShadowAccumulation(){return this._shadowAccumulator.accumulating}_renderShadowAccumulation(e,t,i){this._needsShadowAccumulation&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,e,t,i)&&this.performanceInfo.advance(CO.ACCUMULATED_SHADOWS)}_precompileTransparentGeometry(){this._oitEnabled&&(0,Lw.c1)(this._renderContext.output)?(this._bindParameters.oitPass=uR.M.ColorAlpha,this._plugins.precompile(...kO),this._bindParameters.oitPass=uR.M.FrontFace,this._plugins.precompile(...kO),this._bindParameters.oitPass=uR.M.NONE):this._plugins.precompile(...kO)}_renderOIT(e,t,i=UM.U.Both){const r=e===DO.HUD,n=this._framebufferSize,s=r?this.fboCache.acquire(n.width,n.height,"oit hud composite"):null,o=r?()=>this._renderHUDElements(i):()=>this._renderTransparentGeometry(),a=this._bindParameters,l=this._renderContext.output;this._renderContext.output=t,a.oitPass=uR.M.ColorAlpha;const c=s?"oit hud color+alpha":"oit color+alpha",u=this.fboCache.acquire(n.width,n.height,c,DS.q.RGBA16F),h=t===Lw.H_.ColorEmission;h&&u.acquireColor(Rl.VY.COLOR_ATTACHMENT1,DS.q.RGBA16F,"emissive"),u.acquireColor(h?Rl.VY.COLOR_ATTACHMENT2:Rl.VY.COLOR_ATTACHMENT1,DS.q.R16F),s||u.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(u.fbo),this._rctx.clearFramebuffer([0,0,0,1]),h&&this._rctx.gl.clearBufferfv(this._rctx.gl.COLOR,1,BA.AG),o(),u.detachDepth(),a.oitPass=uR.M.FrontFace;const d=this.fboCache.acquire(n.width,n.height,s?"oit hud front":"oit front");return h&&d.acquireColor(Rl.VY.COLOR_ATTACHMENT1,DS.q.RGBA,"emissive"),s?d.acquireDepth(DS.m.DEPTH16_BUFFER):d.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(d.fbo),this._rctx.clearFramebuffer(rf.AG,!!s),o(),d.detachDepth(),a.oitPass=uR.M.NONE,s?(this._rctx.bindFramebuffer(s.fbo),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clear(Rl.Hf.COLOR)):this._framebuffer.bind(),this._oitblend??=new LR(this._techniques),this._oitblend.blend(this._rctx,u,d,a,h),s?.detachDepth(),d.release(),u.release(),this._renderContext.output=l,s}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this.performanceInfo.advance(CO.APPLY_ACCUMULATED_SHADOWS),this._framebuffer.bind(),this._plugins.render(this._pluginInput,NC.r.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),this.performanceInfo.advance(CO.TRANSPARENT_MATERIAL_WITHOUT_DEPTH)}_renderPlugins(e,t){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(this._pluginInput,e),this.performanceInfo.advance(t))}_renderNodes(e,t,i=!1){if(t.setName(e),this._pluginInput.set(e,t),!this._nodes.produces(e))return i&&this.performanceInfo.advance(e),t;const r=this._nodes.render(t,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),r}_blitFBO(e,t=JA,i=!0){return this._blit??=new zM.N(this._techniques),this._blit.blit(this._rctx,e,t,this._bindParameters),this._pluginInput.set(e.name,t),i&&e.release(),t}_ensureBindParametersCamera(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){null==this._ssrEnableTime&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Cl.Wd:((0,Tl.U_)(GO,this._bindParameters.camera.viewMatrix),(0,Tl.U_)(HO,this._bindParameters.camera.projectionMatrix),(0,Tl.Jp)(jO,GO,HO),(0,Tl.Jp)(jO,this._renderContext.lastFrameCamera.viewMatrix,jO),(0,Tl.Jp)(jO,this._renderContext.lastFrameCamera.projectionMatrix,jO),this._reprojectionMatrix=jO);const t=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=t>0?Math.min(t,e-this._ssrEnableTime)/t:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Cl.Wd,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}updateLighting(e,t,i,r){this._bindParameters.updateLighting(e,t,i,r),this._requestRender(tc.Xx.UPDATE)}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}renderToTargets(e,t,i,r,n=!1,s=!1){t.attachDepth(i),this._rctx.bindFramebuffer(t.fbo),this._rctx.clearFramebuffer(r,n,s),e(),t.detachDepth()}get test(){}}var DO;(0,i._)([(0,y.Cb)({readOnly:!0})],LO.prototype,"fullResolutionAtmosphere",null),(0,i._)([(0,y.Cb)()],LO.prototype,"_edgeView",void 0),(0,i._)([(0,y.Cb)()],LO.prototype,"updating",null),function(e){e[e.Geometry=0]="Geometry",e[e.HUD=1]="HUD"}(DO||(DO={}));const NO=[NC.r.INTEGRATED_MESH,NC.r.OPAQUE_TERRAIN,NC.r.OPAQUE_MATERIAL,NC.r.TRANSPARENT_MATERIAL],FO=[NC.r.OPAQUE_MATERIAL_WITHOUT_NORMALS,NC.r.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],UO=[NC.r.INTEGRATED_MESH,NC.r.OPAQUE_TERRAIN,NC.r.OPAQUE_MATERIAL,NC.r.OPAQUE_MATERIAL_WITHOUT_NORMALS],kO=[NC.r.TRANSPARENT_MATERIAL,NC.r.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],zO=[NC.r.OPAQUE_MATERIAL,NC.r.TRANSPARENT_MATERIAL,NC.r.TRANSPARENT_MATERIAL_WITHOUT_DEPTH],BO=[NC.r.LINE_CALLOUTS_HUD_DEPTH,NC.r.HUD_MATERIAL,NC.r.LABEL_MATERIAL],VO=[NC.r.TRANSPARENT_MATERIAL,NC.r.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,NC.r.OPAQUE_MATERIAL,NC.r.OPAQUE_MATERIAL_WITHOUT_NORMALS,NC.r.TRANSPARENT_TERRAIN,NC.r.INTEGRATED_MESH,NC.r.OPAQUE_TERRAIN],HO=(0,Cl.Ue)(),GO=(0,Cl.Ue)(),jO=(0,Cl.Ue)();function ZO(e){return t=>e.immediate.schedule(t)}var qO=n(71299);class WO{constructor(e){this._rctx=e,this._vao=function(e,t=qO.QI,i=tE.i){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new ic.U(e,i,new Map([["geometry",t]]),new Map([["geometry",rc.f.createVertex(e,Rl.l1.STATIC_DRAW,r)]]))}(e)}destroy(){this._vao=(0,m.M2)(this._vao)}draw(){null!=this._vao&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Rl.MX.TRIANGLES,0,3))}get test(){}}class $O{constructor(e,t,i){this._rctx=e,this._locations=t,this._layout=i,this._cache=new jb(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const t=e.toString();let i=this._cache.pop(t);return i||(i=new ic.U(this._rctx,this._locations,new Map([["geometry",this._layout]]),new Map([["geometry",rc.f.createVertex(this._rctx,Rl.l1.STATIC_DRAW)]])),i.vertexBuffers.get("geometry")?.setSize(e),i)}deleteVao(e){if(null==e)return;const t=e.byteSize.toString();this._cache.put(t,e)}}var YO=n(24818),JO=n(31812);class XO extends JO.x{constructor(e,t){super(e,t),this._vaoCaches=new UA.r,this._appleAmdDriverHelper=null,this._refCount=1,this._newCache=t.newCache,this.screen=new WO(this)}configure(e){super.configure(e),this._newCache=e.newCache}destroy(){this._vaoCaches?.forAll((e=>e.dispose())),this._vaoCaches?.clear(),--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose(),this.screen.destroy(),this._vaoCaches.forAll((e=>e.dispose())),this._vaoCaches.clear()}get newCache(){return this._newCache}getVaoCache(e,t){const i=Array.from(e).join("."),r=JSON.stringify(t),n=this._vaoCaches.get(i,r);if(n)return n;const s=new $O(this,e,t);return this._vaoCaches.set(i,r,s),s}bindTechnique(e,t,i,r){return this.useProgram(e.program),this.setPipelineState(e.getPipeline()),e.program.bind(t),i&&(e.program.bindPass(i,t),r&&e.program.bindDraw(t,i,r)),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??=new YO.E(this),this._appleAmdDriverHelper.run())}get test(){}}function KO(e){return!!e.frameUpdate}let QO=class extends P.Z{constructor(e){super({}),this._stage=e,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new L.Z,this._frameTask=e.view.resourceController.scheduler.registerTask(Ii.T8.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(_S.U.Texture,(e=>e.unload()))}get updating(){return this._loadingCount>0||this._frameTask.updating}acquire(e){const t=this._textures.get(e);return t?(t.ref(),t.loadingPromise??t):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach((t=>{const i=t.texture.frameUpdate(t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)})),e&&this.events.emit("changed",tc.Xx.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(null==t)return null;const i=t.events.on("unloaded",(()=>{i.remove(),this._onTextureUnloaded(e)})),r=new eP(e,(()=>{this._frameTask.schedule((()=>{r.isUnreferenced&&t.unload()}))}));return this._textures.set(e,r),r.ref(),t.glTexture?(this._updateGLTexture(r,t.glTexture),KO(t)&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule((()=>{const i=t.load(this._stage.renderView.renderingContext),n=i=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,i),KO(t)&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r);return(0,g.y8)(i)?i.then(n,(e=>(this._loadingCount--,r.loadingPromise=null,(0,g.D_)(e)||f.Z.getLogger(this).error(e),null))):n(i)})),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",tc.Xx.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};(0,i._)([(0,y.Cb)()],QO.prototype,"_loadingCount",void 0),(0,i._)([(0,y.Cb)()],QO.prototype,"_frameTask",void 0),(0,i._)([(0,y.Cb)()],QO.prototype,"updating",null),QO=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.lib.TextureRepository")],QO);class eP{constructor(e,t){this.id=e,this._release=t,this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(0!==this._refCount?(f.Z.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}var tP=n(6411),iP=n(19663);var rP=n(33195);let nP=class extends P.Z{constructor(){super(...arguments),this._passParameters=new sP,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=(0,m.IM)(this._resourcesTask),this._passParameters.waveNormal=(0,m.M2)(this._passParameters.waveNormal),this._passParameters.wavePerturbation=(0,m.M2)(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=(0,be.vr)((async t=>{await Promise.allSettled([this._loadImageResource(e,(0,vA.V)("esri/images/materials/water/normals.jpg"),(e=>this._passParameters.waveNormal=e),t),this._loadImageResource(e,(0,vA.V)("esri/images/materials/water/perturbation.jpg"),(e=>this._passParameters.wavePerturbation=e),t)])}))),this._resourcesTask.finished?tc.Rw.LOADED:tc.Rw.LOADING}async _loadImageResource(e,t,i,r){try{const n=await(0,nA.t)(t,{signal:r});(0,g.k_)(r);const s=new Ul.X(n.width,n.height);s.pixelFormat=Rl.VI.RGB,s.samplingMode=Rl.cw.LINEAR_MIPMAP_LINEAR,s.hasMipmap=!0,s.maxAnisotropy=8,i(new rC.x(e,s,n))}catch(e){f.Z.getLogger(this).error("Failed to load water material normal texture.",e)}}};(0,i._)([(0,y.Cb)()],nP.prototype,"_resourcesTask",void 0),(0,i._)([(0,y.Cb)({type:Boolean,readOnly:!0})],nP.prototype,"updating",null),nP=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],nP);class sP extends $l.K{}const oP=new Map;function aP(){return oP}var lP=n(8955);class cP{constructor(e,t){this.parameters=e,this.fbos=t}}class uP{constructor(e,t,i){this._rctx=e,this._renderFunctions=t,this._forceCameraHook=i,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(tc.Xx.BACKGROUND);const t=(0,g.hh)();return this._screenshotQueue.push({settings:e,resolver:t}),t.promise}update(e,t){for(const i of this._screenshotQueue){if(null==this._rctx){i.resolver.reject();continue}const r={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,r,t);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,t,i){e.width=t.width,e.height=t.height;const r=e.getContext("2d"),n=i.pixelRatio;return r.save(),r.translate(0,t.height),r.scale(1,-1),i.region&&r.translate(-i.region.x,-i.region.y),r.scale(n,n),t=this._renderFunctions.renderOverlay(e,i.disableDecorations,t),r.restore(),t}_readbackScreenshot(e,t){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},t):this._readbackScreenshotImmediate(e,t)}_readbackScreenshotResampled(e,t){const{framebufferWidth:i,framebufferHeight:r,region:n,resample:s}=e,o=this._ensureScreenshotEncodeCanvas();let a=(0,lP.r7)(i,r,o);this._rctx.gl.readPixels(0,0,i,r,Rl.VI.RGBA,Rl.g.UNSIGNED_BYTE,new Uint8Array(a.data.buffer)),t(),a=this._renderScreenshotOverlay(o,a,{...e,region:void 0});const l=(0,lP.r7)(n.width,n.height,o);return(0,Ys.resampleHermite)(a,l,!0,s.region.x,r-(s.region.y+s.region.height),s.region.width,s.region.height)}_readbackScreenshotImmediate(e,t){const{framebufferHeight:i,region:r}=e,n=this._ensureScreenshotEncodeCanvas(),s=(0,lP.r7)(r.width,r.height,n);return this._rctx.gl.readPixels(r.x,i-(r.y+r.height),r.width,r.height,Rl.VI.RGBA,Rl.g.UNSIGNED_BYTE,new Uint8Array(s.data.buffer)),t(),this._renderScreenshotOverlay(n,s,e)}_renderScreenshot(e,t,i){const r=e.parameters.camera,n={width:t.framebufferWidth,height:t.framebufferHeight};(0,Fl.d)(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let s=!1;const o=n.width!==r.fullWidth||n.height!==r.fullHeight,a=t.ignorePadding&&r.pixelRatio!==t.pixelRatio,l=o||t.disableDecorations||a||t.objectAndLayerIdColor;let c=null,u=null;if(l){const o=r.clone();if(t.ignorePadding){const e=(0,rf.d9)(o.padding);for(let i=0;i<4;i++)e[i]=Math.round(e[i]/o.pixelRatio*t.pixelRatio);o.padding=e}o.fullWidth=n.width,o.fullHeight=n.height,o.pixelRatio=t.pixelRatio;const a=r.fovX-o.fovX,l=r.fovY-o.fovY;a<0&&a<l?o.fovX=r.fovX:l<0&&l<a&&(o.fovY=r.fovY);const h={camera:o,contentCamera:o,mode:Pi.n.IDLE,alignPixelEnabled:!0,contentPixelRatio:o.pixelRatio,forcedAnimationTime:e.parameters.forcedAnimationTime};this._forceCameraHook(h),s=!0;const d=this._renderFunctions.renderScene(h,i,t.objectAndLayerIdColor?rm.YE.ObjectAndLayerID:rm.YE.Screenshot,t.disableDecorations);u=d.screen,c=d.olid}this._rctx.bindFramebuffer(u?.fbo);const h=this._readbackScreenshot(t,(()=>{this._rctx.bindFramebuffer(null),u?.release()}));let d=null;if(t.objectAndLayerIdColor){const e=()=>{this._rctx.bindFramebuffer(null),c?.release()};this._rctx.bindFramebuffer(c?.fbo),d=this._readbackScreenshot(t,e),this._rctx.bindFramebuffer(null)}if(l&&!this._rctx.contextAttributes.alpha)for(let e=3;e<h.data.length;e+=4)h.data[e]=255;if(d&&!this._rctx.contextAttributes.alpha)for(let e=3;e<d.data.length;e+=4)d.data[e]=255;return s&&this._forceCameraHook(e.parameters),[h,d]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas??=document.createElement("canvas"),this._screenshotEncodeCanvas}}const hP=!1;let dP=class extends P.Z{constructor(e){super(e),this.events=new L.Z,this.waterTextures=new nP,this.olidRenderHelper=(0,MM.B)()?new kA:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._savedFadeDuration=(0,en.HA)(0);const t=e.stage;try{this._initializeContext(t)}catch(e){return void console.error("Failed to initialize context",e)}const{memoryController:i}=t.view.resourceController;this.stippleTextures=(0,rP.kW)(this._rctx,i),this.markerTextures=function(e,t){return new iP.t((t=>(0,tP.LM)(t,e)),(e=>e),t)}(this._rctx,i),this._techniques=new FM.M(new NM(this._rctx,t.viewingMode,this.stippleTextures,this.waterTextures,this.markerTextures)),this._textures=new QO(t),this.addHandles(this._textures.events.on("changed",(e=>this.requestRender(e)))),this._materials=new FA.h(this._textures,this._techniques,(()=>this.requestRender()),(()=>this.requestRender())),this._compositingHelper=new NA(this._rctx,this._techniques),this.renderer=new LO(t,this._materials,this._techniques,this._rctx,this._compositingHelper,(e=>this.requestRender(e))),this.addHandles([(0,F.watch)((()=>t.view.ready),(e=>{e&&this._createRenderNodes()}),F.initial),(0,F.watch)((()=>this.waterTextures?.updating),(()=>this.requestRender()),F.initial),(0,F.watch)((()=>t.view.qualityProfile),(e=>this.renderer?.updateRenderFeatures(e)),F.syncAndInitial)]);const r={renderScene:(e,t,i,r)=>this.renderer.render(e,t,i,r),requestRenderScene:e=>this.requestRender(e),prepareOverlay:()=>t.options.screenshot.prepareOverlay(),renderOverlay:(e,i,r)=>t.options.screenshot.renderOverlay(e,i,r)};this._screenshotManager=new uP(this._rctx,r,(e=>this.events.emit("force-camera-for-screenshot",e))),this._registerFrameTask(t)}destroy(){const e=this.stage?.container;e?.contains(this._canvas)&&e.removeChild(this._canvas),this._frameTask=(0,m.hw)(this._frameTask),this._techniques=(0,m.SC)(this._techniques),this._componentObjects=(0,m.SC)(this._componentObjects),this._screenshotManager=(0,m.SC)(this._screenshotManager),(0,m.SC)(this.renderer),this._textures=(0,m.SC)(this._textures),(0,m.SC)(this.waterTextures),(0,m.SC)(this.markerTextures),(0,m.SC)(this.stippleTextures),this._canvas=null,this._rctx=(0,m.SC)(this._rctx)}_createRenderNodes(){const{view:e,viewingMode:t}=this.stage;new TA({view:e}),(0,Le.V2)(e.spatialReference)||(t===$t.JY.Local?new rE({view:e}):(0,Le.BZ)(e.spatialReference)?new yE({view:e}):(new kS({view:e}),new VS({view:e}),new JM({view:e}),new ZS({view:e}))),new _A.K({view:e,isEnabled:()=>this.renderer.hasSSAO}),new gA({view:e,isEnabled:()=>this.renderer.hasSMAA}),new lA({view:e}),new XM.y$({view:e}),new iA({view:e,viewingMode:t}),new VM({view:e}),(0,MM.B)()&&new kM({view:e})}requestRender(e=tc.Xx.UPDATE){this._needsRender=!0,e===tc.Xx.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get techniques(){return this._techniques}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then((e=>e[0]))}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,t,i,r,n,s=n){const o=r.constrainWindowSize(t,i,n*r.pixelRatio,s*r.pixelRatio),a=this._ensureLinearDepthArrayBuffer(o);this.renderer.readMainDepth(o,a);const l=(e,t,i)=>(0,MS.v)(t,e)*(i[1]-i[0])+i[0];let c=Number.MAX_VALUE;for(let e=0;e<o[2]*o[3];e++){const t=l(4*e,a,r.nearFar);c>t&&t!==r.nearFar[0]&&t!==r.nearFar[1]&&(c=t)}if(e){const n=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);null!=n&&c>n&&n!==r.nearFar[0]&&n!==r.nearFar[1]&&(c=n)}return c===Number.MAX_VALUE?void 0:c}_ensureLinearDepthArrayBuffer(e){const t=4*e[2]*e[3];return(null==this._tmpDepthBuffer||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}async reloadShaders(){hw(),await this._techniques.reloadAll(),this.renderer.overlay?.reloadShaders(),this.requestRender()}_registerFrameTask(e){const t=e.view.state;let i=!1,r=tc.Xx.BACKGROUND,n=!1;const s={preRender:({time:n})=>{i=this.updating,r=this._needsUpdate?tc.Xx.UPDATE:tc.Xx.BACKGROUND,e.commitSyncLayers(),n=this._testTime??n,((0,en.HA)(n-this._lastAnimationUpdate)>this.renderer.animationTimestep||null!=t.forcedAnimationTime||i||this._needsRender)&&(this.renderer.updateAnimation(t,n)&&this.requestRender(tc.Xx.BACKGROUND),this._lastAnimationUpdate=n)},render:({time:e})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const i=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,e=this._testTime??e,this.renderer.render(t,e),n=!0,i&&this.renderer.hasReflections&&(this.requestRender(tc.Xx.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:e})=>{this._textures.update();const i=new cP(t,this.renderer.fboCache);e=this._testTime??e,this._screenshotManager.update(i,e)},finish:()=>{n&&(this.renderer.finish(t.mode===Pi.n.IDLE?r:tc.Xx.UPDATE),n=!1)}};this._frameTask=(0,ue.A)(s)}_initializeContext(e){const{options:t}=e,i=t.canvas??document.createElement("canvas");i.setAttribute("style","width: 100%; height:100%; display:block;"),this._canvas=i;const r={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:t.preserveDrawingBuffer??!1},n=i.getContext("webgl2",r);if(null==n)return void f.Z.getLogger(this).error("A WebGL2 context could not be created.");this._rctx=function(e,t){const i=(e,i)=>t.view.resourceController.memoryController.newCache(e,i),r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8,newCache:i};if(hP){let t=pP.get(e);return t?(t.configure(r),t.ref(),t):(t=new XO(e,r),pP.set(e,t),t.ref(),t)}return new XO(e,r)}(n,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&f.Z.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested");const{container:s}=e;!this._rctx.contextAttributes.alpha&&(0,w.Z)("safari")>=11&&(s.style.backgroundColor="black"),s.contains(i)||s.appendChild(i)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}get _viewingMode(){return this.stage.viewingMode}getObjectAndLayerIdColor(e){return this.olidRenderHelper?.getObjectAndLayerIdColor(e)}get componentObjectCollection(){return null==this._componentObjects&&(this._componentObjects=new PM(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}updateQualitySettings(e){null!=this._testTime&&(this._savedFadeDuration=e.fadeDuration,e.fadeDuration=(0,en.HA)(0))}set testTime(e){this._testTime=e,null==e?this.stage.view.qualitySettings.fadeDuration=this._savedFadeDuration:this.updateQualitySettings(this.stage.view.qualitySettings)}get testTime(){return this._testTime}};(0,i._)([(0,y.Cb)({type:Boolean,readOnly:!0})],dP.prototype,"updating",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],dP.prototype,"stage",void 0),(0,i._)([(0,y.Cb)()],dP.prototype,"_rctx",void 0),(0,i._)([(0,y.Cb)()],dP.prototype,"_canvas",void 0),(0,i._)([(0,y.Cb)()],dP.prototype,"stippleTextures",void 0),(0,i._)([(0,y.Cb)()],dP.prototype,"markerTextures",void 0),(0,i._)([(0,y.Cb)()],dP.prototype,"waterTextures",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],dP.prototype,"olidRenderHelper",void 0),(0,i._)([(0,y.Cb)()],dP.prototype,"_textures",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],dP.prototype,"renderer",void 0),(0,i._)([(0,y.Cb)()],dP.prototype,"_screenshotManager",void 0),(0,i._)([(0,y.Cb)()],dP.prototype,"componentObjectCollection",null),(0,i._)([(0,y.Cb)()],dP.prototype,"_componentObjects",void 0),(0,i._)([(0,y.Cb)()],dP.prototype,"_needsUpdate",void 0),(0,i._)([(0,y.Cb)()],dP.prototype,"_needsWaterReflectionUpdate",void 0),dP=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.parts.RenderView")],dP);const pP=aP();let fP=class extends P.Z{constructor(e){super(e),this._model=new SS,this._layers=new Pg.Z,this._asyncChangeSet=new mS.as,this._syncChangeSet=new mS.as,this._layerSyncSet=new Set}initialize(){this._set("renderView",new dP({stage:this})),this._frameTask=this.view.resourceController.scheduler.registerTask(Ii.T8.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),(0,yS.e)(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){null!=e&&!this.destroyed&&this._model.remove(e)&&((0,yS.e)(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){null!=e&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){null!=e&&(this._model?.removeMany(e),this.renderView?.requestRender())}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return zl.J}_commit(e){const t=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll((i=>{if(e.done)return;const r=this._layerSyncSet.has(i.id)||i.updatePolicy===gS.j.SYNC,n=r?this._syncChangeSet:this._asyncChangeSet;t.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,r?Ii.G5:e),this.renderView.requestRender(),e.madeProgress())})),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Ii.G5),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll((i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==gS.j.ASYNC||(t.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))})),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll((t=>{this._layerSyncSet.has(t.id)||t.updatePolicy===gS.j.SYNC?(e.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id)):e.commitSyncUpdates(t.id,this._syncChangeSet)}));for(const t of this._layerSyncSet)e.commitLayer(t,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Ii.G5),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Ii.G5),this.renderView.requestRender())}schedule(e,t){return this._frameTask.schedule(e,t)}reschedule(e,t){return this._frameTask.reschedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),null!=this._layers.removeUnordered(e)&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Ii.G5))}addRenderPlugin(e,t){const i=this.renderer.plugins.add(e,t),r=()=>{iv(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if((0,g.y8)(i))return i.then(r);r()}removeRenderPlugin(e){this.destroyed||(iv(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};(0,i._)([(0,y.Cb)({constructOnly:!0})],fP.prototype,"view",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],fP.prototype,"options",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],fP.prototype,"viewingMode",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],fP.prototype,"container",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],fP.prototype,"updating",null),(0,i._)([(0,y.Cb)({constructOnly:!0})],fP.prototype,"_model",void 0),(0,i._)([(0,y.Cb)()],fP.prototype,"renderView",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],fP.prototype,"renderer",null),(0,i._)([(0,y.Cb)({readOnly:!0})],fP.prototype,"running",null),fP=(0,i._)([(0,v.j)("esri.views.3d.webgl-engine.Stage")],fP);var mP=n(42780),gP=n(14029),yP=n(39346);const _P=new Set,vP=()=>f.Z.getLogger("esri/views/support/TextureCompressionHelper");let bP=class extends aa{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};(0,i._)([(0,y.Cb)()],bP.prototype,"components",void 0),bP=(0,i._)([(0,v.j)("esri.views.ui.3d.DefaultUI3D")],bP);const wP=bP;let xP=class extends(ae(Ce(ve(ai)))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._overrideDefaultEnvironmentOnly=!0,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new sm.L({slicePlane:Da.B},this),this._resourceController=function(e){return new Zv({view:e})}(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new yy({view:this}),this.labeler=new vy.S({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new De,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new pl,this.environment=new oh,this.environmentManager=new Eu,this.floors=new o.Z,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new tl({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new G_({view:this}),this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new wP,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.focusAreas=new Ua.J({view:this}),(0,Q.j2)();const t=(e=null)=>{null!=e&&e.type===Ea.y.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach((async e=>{try{await e.when()}catch{}this._updatingChanged()})))};this.addHandles([(0,F.on)((()=>this.map?.allLayers),"after-changes",(e=>t(e)),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",(e=>this._updateUpdatingMonitors(e))),(0,F.watch)((()=>this.map),(e=>{e&&"load"in e&&e.load&&e.load().catch((()=>{}))}))]),this.inputManager=new Og({view:this}),this.stateManager=new om({view:this})}initialize(){if((0,w.Z)("enable-feature:esri-compress-textures")){const e=function(e,t){return rC.x.compressionWorkerHandle??=new uC((0,yP.H)(t)),_P.has(e)?vP().warn("Repeated texture compression worker initialization by the same view."):_P.add(e),rC.x.compressionWorkerHandle}(this,this.resourceController);this.addResolvingPromise(e.promise)}this.groundView=new ja({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.addHandles((0,F.on)((()=>this.map?.allLayers),"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add((()=>this.qualitySettings.memoryLimit),(e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)}),F.initial),this.updatingHandles.add((()=>this.qualitySettings.additionalCacheMemory),(e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)}),F.initial),this.updatingHandles.add((()=>this.qualitySettings.frameRate??0),(e=>(0,ue.bP)(e>0?1e3/Math.ceil(e):0)),F.initial),this.updatingHandles.add((()=>this.map?.ground),e,F.syncAndInitial),this.updatingHandles.add((()=>this.map?.ground?.opacity),(()=>this._updateDefaultHitTestOptions()),F.syncAndInitial),this.addHandles((0,F.watch)((()=>this.spatialReference),(()=>this.notifyChange("clippingArea")),F.sync))}destroy(){this.destroyed||(function(e){rC.x.compressionWorkerHandle&&(_P.delete(e)||vP().warn("Unknown view attempted to destroy the texture compression worker."),_P.size||((0,m.SC)(rC.x.compressionWorkerHandle),rC.x.compressionWorkerHandle=null))}(this),this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._set("analysisViewManager",(0,m.SC)(this.analysisViewManager)),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=(0,m.SC)(this.sharedSymbolResources),this._set("labeler",(0,m.SC)(this.labeler)),this._set("deconflictor",(0,m.SC)(this.deconflictor)),this._resourceController=(0,m.SC)(this._resourceController),this._set("stateManager",(0,m.SC)(this.stateManager)),this._set("inputManager",(0,m.SC)(this.inputManager)),this.state.destroy(),this.highlights.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",(0,m.SC)(this.environmentManager)),this._set("environment",(0,m.SC)(this.environment)),this.groundView=(0,m.SC)(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper?.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get center(){return this.stateManager?.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){if("global"===this.viewingMode)return null;const e=this.map;let t=this._userClippingArea||(0,m.aF)(e,"clippingArea");return!this._userClippingArea&&!(0,m.aF)(e,"clippingEnabled")||null==t?(this._clippingArea=null,null):t instanceof Oe.Z?this.spatialReference&&(t=TP(t,this.spatialReference),null==t)?(f.Z.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),null==t.intersection(this._groundAndLayersExtent)&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(f.Z.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&"global"===this.viewingMode&&null!=e?f.Z.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===$t.JY.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return null==t||null==e||t.spatialReference.equals(e)?t:TP(t,e)}get tileInfo(){return this.basemapTerrain?.tilingScheme?.toTileInfo()}get dataExtent(){let e=this._groundAndLayersExtent;const t=this.spatialReference||Ie.Z.WGS84,i=TP(this.clippingArea,t);null!=i&&(e=null!=e?e.intersection(i):i);const r=this._get("dataExtent");return null!=e&&e.equals(r)?r:e}get _groundAndLayersExtent(){const e=this.spatialReference||Ie.Z.WGS84;let t;const i=i=>{const r=TP(i,e);null!=r&&(null!=t?t.union(r):t=r.clone())},r=this.basemapTerrain;if(r?.spatialReference){const e=r.groundExtent;i(new Oe.Z({xmin:e[0],ymin:e[1],zmin:0,xmax:e[2],ymax:e[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const e=e=>{null==e.fullExtent||"graphics"===e.type&&e.internal||i(e.fullExtent)};this.map.allLayers.forEach((t=>e(t)))}if(null==t)return null;t.hasZ?(t.zmin=Math.min(0,t.zmin??0),t.zmax=Math.max(0,t.zmax??0)):(t.zmin=0,t.zmax=0);const n=this._get("_groundAndLayersExtent");return t.equals(n)?n:t}castEnvironment(e){return e?e instanceof oh?e:e instanceof rh?this.environment?.cloneWithWebsceneEnvironment(e)??oh.fromWebsceneEnvironment(e):(0,_.se)(oh,e):new oh}get extent(){return this.stateManager?.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state?.stationary??!0)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}set qualityProfile(e){uv.isValidProfile(e)&&(uv.apply(e,this.qualitySettings),this._stage?.renderView.updateQualitySettings(this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||uv.getDefaultProfile()}set slicePlane(e){if(null!=this._stage&&(this._stage.renderer.slicePlane=e),null==e)return void this._set("slicePlane",null);const t=this._propertiesPool.get("slicePlane");(0,Da.a)(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&!!this.stateManager?.preinit(this.spatialReference)}get resolution(){return null!=this.spatialReference?(0,Fa.dp)(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return null!=e?Pe.Z.deriveUnitFromSR(e,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach((r=>{if(r.isFulfilled()){if(r.updating){if(t=!0,r.suspended||(0,tw.wP)(r))return;++i,e+=r.updatingProgress}}else++i}));for(const t of this._updatingObjects)if(null!=t&&t.updating){const t=.1;i+=t,e+=.5*t}for(const t of this._updatingObjectsWithProgress)null!=t&&t.updating&&(++i,e+=t.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some((e=>!e.isFulfilled()))||this.textures?.updating),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const i=performance.now();if(e<1){const t=Math.min((i-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-t)+e*t}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?i:0}return t}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const e=this._predeterminedViewingMode;if(null!=e)return(0,$t.M7)(e);const t=this.spatialReference;return t?null!=this.defaultsFromMap?.viewingMode&&t.equals(this.defaultsFromMap.spatialReference)?(0,$t.M7)(this.defaultsFromMap.viewingMode):(0,gP.D)(t,$t.JY.Global)?"global":"local":"global"}set viewingMode(e){this.ready?f.Z.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get visibleArea(){return this.stateManager?.visibleArea}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get highlightOptions(){return this.highlights.find((({name:e})=>e===At.b))??new Rt.Z}set highlightOptions(e){for(let t=0;t<this.highlights.length;++t)if(this.highlights.at(t).name===At.b)return void this.highlights.items[t].assignFrom(e)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Yv(this)}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return f.Z.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=(0,_t.Rw)(e)?(0,_t.s6)(this,e):e;return(0,W_.qL)(this,i,t,this._defaultToMapOptions)}toScreen(e){if(!this.ready)return f.Z.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=(null==e.z?(0,Rf.KO)(this.elevationProvider,e):null)??0;return(0,La.K)(e,CP,this.renderSpatialReference,t),this.state.camera.projectToScreen(CP,SP),(0,$e.vW)(SP[0],SP[1])}pixelSizeAt(e,t){if(!this.ready)return f.Z.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!e)return 0;const i=this.renderSpatialReference;(0,La.K)(e,CP,i);const r=this.state.camera.computeScreenPixelSizeAt(CP);return t&&i!==t?r*(0,Ma.c9)(i)/(0,Ma.c9)(t):r}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e,(()=>this.pixelSizeAt(e))):1}hitTest(e,t){if(!this.ready)return f.Z.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=(0,_t.Rw)(e)?(0,_t.s6)(this,e):e;return(0,W_.wX)(this,i,t,this._defaultHitTestOptions)}async popupHitTest(e){return bv(this,e)}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(null==e.parent)throw new c.Z("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":case"viewshed":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=await this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return(await Promise.resolve().then(n.bind(n,994))).encode(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=await this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return(await Promise.resolve().then(n.bind(n,994))).encodeData(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(e){const t=await this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(t),{encodeData:r}=await Promise.resolve().then(n.bind(n,994));return[r(i[0],this._pixelFormat()),r(i[1],this._pixelFormat())]}async _completeSettings(e){const{toRenderSettings:t,screenshotSuperSampleSettings:i}=await Promise.resolve().then(n.bind(n,994)),r=t(e,this);return r.pixelRatio/=this.state.pixelRatio,i(r,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(e){if(!(0,MM.B)())throw new c.Z("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true");const{encode:t}=await Promise.resolve().then(n.bind(n,994)),i=await this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(i),s=t(r[0],i,this._pixelFormat()),o=await this._completeSettings(e);return o.format="png",[s,t(r[1],o,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){const e=this._stage.renderView.olidRenderHelper;if(e)return e.getColorToObjectAndLayerIdMapping();throw new c.Z("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true")}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return Ya(e)}hasLayerViewModule(e){return $a(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let e=eo(this.type);const t=(0,w.Z)("safari");if(t&&t<9&&(e=new c.Z("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:t})),null!=e)throw f.Z.getLogger(this).warn("#validate()",e.message),e}get _predeterminedViewingMode(){const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return null!=e?(0,$t.wg)(e):null}getSpatialReferenceSupport(e,t){const i=this._predeterminedViewingMode;if(null!=i)return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,$t.JY.Local),n=this._validateSpatialReferenceForViewingMode(e,t,$t.JY.Global);return r||n?r&&n?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,$t.JY.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,$t.JY.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!(!(0,gP.D)(e,i)||null!=t&&!(0,z.Am)(t)&&((0,z.iC)(t)&&null==(0,tw.E_)(t,e,i)||(0,z.Tv)(t)&&i===$t.JY.Global))}_makeSpatialReferenceConstraints(e,t,i){if(null==t)return[{spatialReference:e,viewingMode:i}];const{isWebMercator:r,isWGS84:n}=e;return(0,z.Am)(t)&&(r||n)?n&&i!==$t.JY.Local&&null!==(0,tw.er)(t.tileInfo,t.fullExtent,e,$t.JY.Global)?[{spatialReference:r?Ie.Z.WGS84:Ie.Z.WebMercator,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:Ie.Z.WebMercator,viewingMode:i}]:(0,z.iC)(t)||(0,z.Tv)(t)||!r&&!n?(0,z.iC)(t)&&r&&i!==$t.JY.Global?[{spatialReference:e,viewingMode:i},{spatialReference:Ie.Z.WGS84,viewingMode:$t.JY.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?Ie.Z.WGS84:Ie.Z.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=null!=this.getSpatialReferenceSupport(e),i=this._predeterminedViewingMode;return t||(null!=i?f.Z.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${(0,$t.M7)(i)} viewing mode.`):e.isGeographic&&f.Z.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise((e=>{this.ready?e(this):this._resolveWhenReady.push(e)}))}trackGraphicState(e){if(!e.graphic)return f.Z.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const n=t=>{!r&&null!=t&&"processor"in t&&"graphics-3d"===t.processor?.type&&t.processor.graphicsCore&&(i=t.processor.graphicsCore.trackGraphicState(e))};return null!=t?n(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then((e=>n(e)),(()=>{})).catch((()=>{})),(0,N.kB)((()=>{r=!0,null!=i&&(i.remove(),i=null)}))}maskOccludee(e){if(!e)return f.Z.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const n=t=>{!r&&null!=t&&(0,mP._1)(t)&&(i=t.maskOccludee(e))};return null!=t?n(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then((e=>n(e)),(()=>{})).catch((()=>{})),(0,N.kB)((()=>{r=!0,null!=i&&(i.remove(),i=null)}))}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.filter((e=>"media-3d"!==e.type)).find((t=>t.layer===e.layer)):null}graphicChanged(e){null!=this.graphicsView&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await(0,F.whenOnce)((()=>this.graphicsView)),this.graphicsView;if(!e.layer||!this.map)throw new c.Z("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise(((t,i)=>{const r=this.map.allLayers.on("change",(n=>{n.added.includes(e.layer)&&(r.remove(),this.whenLayerView(e.layer).then(t,i))}))})):this.whenLayerView(e.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new iS({view:this})),this._set("elevationProvider",new lv({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new kb({view:this})),this._set("featureTiles",new z_({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const e=null!=this.basemapTerrain.extent&&null!=this.basemapTerrain.spatialReference?(0,te.project)((0,Ds.HH)(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea?this.featureTiles.filterExtent=this.clippingArea.intersection(e):this.featureTiles.filterExtent=e}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add((()=>Ig.h.FEATURE_TILE_TREE_SHOW_TILES),(e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(n.e(60770).then(n.bind(n,60770))).then((({FeatureTileTree3DDebugger:e})=>{!this._featureTreeDebugger&&Ig.h.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new e({view:this}))})):e||!this._featureTreeDebugger||Ig.h.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)}),F.syncAndInitial),this.updatingHandles.add((()=>this.clippingArea),e,F.syncAndInitial),this.updatingHandles.add((()=>this.basemapTerrain.extent),e,F.syncAndInitial)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.featureTiles&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this._set("featureTiles",(0,m.SC)(this.featureTiles)),this._set("pointsOfInterest",(0,m.SC)(this.pointsOfInterest)),this._exitBasemapTerrain(),this.state.reset(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference,t=this.state.isGlobal,i=(0,Na.E2)(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Rv.Z.create(this.state.viewingMode,i)),t||this.addHandles((0,F.watch)((()=>this.basemapTerrain?.extent),(e=>{const t=this.renderCoordsHelper.spatialReference;null==e||0===e[0]&&0===e[1]&&0===e[2]&&0===e[3]||!(0,Ia.d)(e,this.basemapTerrain.spatialReference,EP,t)||(this.renderCoordsHelper.extent=EP)}),F.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(vd.jb/this.renderCoordsHelper.unitInMeters))}else this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null)}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){null!=e&&e.type===Ea.y.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach((e=>{e.destroyed||(this.addHandles((0,F.watch)((()=>[e.updating,e.updatingProgress]),(()=>this._updatingChanged()),F.sync),"updatingMonitors"),e.when((()=>this._updatingChanged()),(()=>this._updatingChanged())))})),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,t,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=e.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(e,{disableDecorations:t}),r.getImageData(0,0,i.width,i.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(e,t,i)=>this._renderScreenshotOverlay(e,t,i)}},t=new Y_(this.state.viewingMode,(e=>this._stage.layers.forAll(e)),this);this._set("sceneIntersectionHelper",t);const i=(0,le.L)(this.surface);this._stage=new fP({view:this,options:e,container:i}),this._stage.renderer.slicePlane=this.slicePlane,this.addHandles([this.updatingHandles.add((()=>this.qualitySettings.highQualityTransparency),(e=>this._stage.renderer.setParameters({highQualityTransparency:e})),F.initial),this.on("pointer-move",(()=>this._stage?.renderer.resetAnimation())),(0,ce.on)(this._stage.renderView.canvas,"webglcontextlost",(e=>{this.fatalError=new c.Z("webgl-context-lost",e.statusMessage)}))],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(vd.jb/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=(0,m.SC)(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new ob({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController)return;if(0===this.graphics.length)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await Promise.all([n.e(66445),n.e(95484),n.e(16249)]).then(n.bind(n,16249))).default;(0,g.k_)(e),await(0,F.whenOnce)((()=>this.basemapTerrain?.ready),e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),null!=this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=(0,$t.wg)(this.viewingMode);e===$t.JY.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.addHandles((0,F.on)((()=>this.graphics),"after-changes",(()=>this._createGraphicsViewIfNeeded())),"graphics-view"),this._createGraphicsViewIfNeeded();const t=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,i=t?.environment;i&&(this._overrideDefaultEnvironmentOnly?Oa(this.environment,i):this.environment=this.environment.cloneWithWebsceneEnvironment(i)),this.timeExtent=t?.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new tb(this._stage,this.resourceController.scheduler));const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach((e=>e(this)))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this._overrideDefaultEnvironmentOnly=!1,this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",(0,m.SC)(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(zd.xX);for(const e of this.map.allLayers.items)(0,z.nx)(e.type)&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(zd.xX);for(const e of this.map.allLayers.items)(0,z.nx)(e.type)&&e.opacity<1&&this._defaultHitTestOptions.exclude.add(e.uid)}}};function TP(e,t){return null!=e&&(0,te.canProjectWithoutEngine)(e.spatialReference,t)?(0,te.project)(e,t):null}xP.type="3d",(0,i._)([(0,y.Cb)()],xP.prototype,"_userClippingArea",void 0),(0,i._)([(0,y.Cb)()],xP.prototype,"_resourceController",void 0),(0,i._)([(0,y.Cb)()],xP.prototype,"_stage",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"deconflictor",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"labeler",void 0),(0,i._)([(0,y.Cb)((0,Re.z)(De,"analyses"))],xP.prototype,"analyses",void 0),(0,i._)([(0,y.Cb)({type:Ni,readOnly:!0})],xP.prototype,"animation",null),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"basemapTerrain",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"elevationProvider",void 0),(0,i._)([(0,y.Cb)()],xP.prototype,"camera",null),(0,i._)([(0,y.Cb)({type:Sa.Z})],xP.prototype,"contentCamera",null),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"canvas",void 0),(0,i._)([(0,y.Cb)({type:wi.Z})],xP.prototype,"center",null),(0,i._)([(0,y.Cb)({type:Oe.Z})],xP.prototype,"clippingArea",null),(0,i._)([(0,y.Cb)({type:pl})],xP.prototype,"constraints",void 0),(0,i._)([(0,y.Cb)({type:Oe.Z,readOnly:!0})],xP.prototype,"renderDataExtent",null),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"tileInfo",null),(0,i._)([(0,y.Cb)({type:Oe.Z,readOnly:!0})],xP.prototype,"dataExtent",null),(0,i._)([(0,y.Cb)({type:Oe.Z,readOnly:!0})],xP.prototype,"_groundAndLayersExtent",null),(0,i._)([(0,y.Cb)({type:oh})],xP.prototype,"environment",void 0),(0,i._)([(0,D.p)("environment")],xP.prototype,"castEnvironment",null),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"environmentManager",void 0),(0,i._)([(0,y.Cb)({type:Oe.Z})],xP.prototype,"extent",null),(0,i._)([(0,y.Cb)({type:o.Z})],xP.prototype,"floors",void 0),(0,i._)([(0,y.Cb)()],xP.prototype,"screenCenter",null),(0,i._)([(0,y.Cb)()],xP.prototype,"frustum",null),(0,i._)([(0,y.Cb)({type:Number,readOnly:!0})],xP.prototype,"fullOpacity",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"graphicsView",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"analysisViewManager",void 0),(0,i._)([(0,y.Cb)()],xP.prototype,"groundView",void 0),(0,i._)([(0,y.Cb)({type:Boolean})],xP.prototype,"initialExtentRequired",null),(0,i._)([(0,y.Cb)()],xP.prototype,"defaultsFromMapSettings",null),(0,i._)([(0,y.Cb)()],xP.prototype,"interacting",null),(0,i._)([(0,y.Cb)()],xP.prototype,"stationary",null),(0,i._)([(0,y.Cb)()],xP.prototype,"navigating",null),(0,i._)([(0,y.Cb)()],xP.prototype,"map",void 0),(0,i._)([(0,y.Cb)()],xP.prototype,"padding",null),(0,i._)([(0,y.Cb)({type:kb,readOnly:!0})],xP.prototype,"pointsOfInterest",void 0),(0,i._)([(0,y.Cb)({type:z_,readOnly:!0})],xP.prototype,"featureTiles",void 0),(0,i._)([(0,y.Cb)()],xP.prototype,"_featureTreeDebugger",void 0),(0,i._)([(0,y.Cb)({type:Boolean})],xP.prototype,"screenSizePerspectiveEnabled",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],xP.prototype,"deactivatedWebGLExtensions",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],xP.prototype,"debugWebGLExtensions",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],xP.prototype,"renderCanvas",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],xP.prototype,"state",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"inputManager",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"stateManager",void 0),(0,i._)([(0,y.Cb)({type:["low","medium","high"]})],xP.prototype,"qualityProfile",null),(0,i._)([(0,y.Cb)({type:Av,get(){let e=this._get("qualitySettings");return e||(e=new Av,uv.apply(this.qualityProfile,e)),e}})],xP.prototype,"qualitySettings",void 0),(0,i._)([(0,y.Cb)()],xP.prototype,"slicePlane",null),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"typeSpecificPreconditionsReady",null),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"renderCoordsHelper",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"sceneIntersectionHelper",void 0),(0,i._)([(0,y.Cb)({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],xP.prototype,"resolution",null),(0,i._)([(0,y.Cb)({type:Number})],xP.prototype,"scale",null),(0,i._)([(0,y.Cb)()],xP.prototype,"heightModelInfo",null),(0,i._)([(0,y.Cb)()],xP.prototype,"spatialReference",void 0),(0,i._)([(0,y.Cb)({type:Boolean,constructOnly:!0})],xP.prototype,"alphaCompositingEnabled",void 0),(0,i._)([(0,y.Cb)({constructOnly:!0})],xP.prototype,"preserveDrawingBufferEnabled",void 0),(0,i._)([(0,y.Cb)({type:Boolean})],xP.prototype,"supersampleScreenshotsEnabled",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"type",void 0),(0,i._)([(0,y.Cb)(),(0,D.p)((e=>e instanceof aa?e:(0,_.TJ)(wP,e)))],xP.prototype,"ui",void 0),(0,i._)([(0,y.Cb)({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],xP.prototype,"updating",null),(0,i._)([(0,y.Cb)()],xP.prototype,"_updatingObjects",null),(0,i._)([(0,y.Cb)()],xP.prototype,"_updatingObjectsWithProgress",null),(0,i._)([(0,y.Cb)({type:Number,readOnly:!0,dependsOn:["updating"]})],xP.prototype,"updatingProgress",void 0),(0,i._)([(0,y.Cb)({type:["global","local"]})],xP.prototype,"viewingMode",null),(0,i._)([(0,y.Cb)({type:K.Z})],xP.prototype,"viewpoint",null),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"visibleArea",null),(0,i._)([(0,y.Cb)({type:Number})],xP.prototype,"zoom",null),(0,i._)([(0,y.Cb)({type:Rt.Z})],xP.prototype,"highlightOptions",null),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"quality",null),(0,i._)([(0,y.Cb)({readOnly:!0})],xP.prototype,"resolutionScale",null),(0,i._)([(0,y.Cb)()],xP.prototype,"textures",void 0),xP=(0,i._)([(0,v.j)("esri.views.SceneView")],xP);const CP=(0,Pa.Ue)(),SP=(0,$e.s1)(),EP=(0,Ds.Ue)(),MP=xP;var AP=n(81506);const RP="esri-elevation-profile",OP={base:`${RP}`,portrait:`${RP}--portrait`,refined:`${RP}--refined`,mainContainer:`${RP}__main-container`,promptContainer:`${RP}__prompt-container`,header:`${RP}__header`,zoomOutButton:`${RP}__zoom-out-button`,clearButton:`${RP}__clear-button`,actionButton:`${RP}__action-button`,sketchButton:`${RP}__sketch-button`,sketchCancelButton:`${RP}__sketch-cancel-button`,sketchDoneButton:`${RP}__sketch-done-button`,selectButton:`${RP}__select-button`,selectCancelButton:`${RP}__select-cancel-button`,chartContainer:`${RP}__chart-container`,chartSpinner:`${RP}__chart-spinner`,chartSpinnerVisible:`${RP}__chart-spinner--visible`,chartSpinnerSmall:`${RP}__chart-spinner--small`,footer:`${RP}__footer`},PP="esri-elevation-profile-legend",IP="esri-elevation-profile-legend-item",LP={base:IP,disabled:`${IP}--disabled`,expanded:`${IP}--expanded`,colorIndicator:`${IP}__color-indicator`,header:`${IP}__header`,content:`${IP}__content`,collapseToggle:`${IP}__collapse-toggle`,label:`${IP}__label`,checkbox:`${IP}__checkbox`},DP="esri-elevation-profile-statistics",NP={base:DP,statistic:`${DP}__statistic`,statisticLabel:`${DP}__statistic__label`,statisticValue:`${DP}__statistic__value`,slopeValue:`${DP}__slope-value`},FP="esri-elevation-profile-settings",UP={base:`${FP}`,popoverContent:`${FP}__popover-content`,uniformChartScalingLabel:`${FP}__uniform-scaling-label`,uniformChartScalingCheckbox:`${FP}__uniform-scaling-checkbox`};var kP=n(55854),zP=n(71197),BP=n(618),VP=n(89815),HP=n(28179),GP=n(46284);const jP=Symbol("line-change");let ZP=class extends P.Z{constructor(e){super(e),this._updateTask=null,this._paramsPerProfile=new Map,this._getUpdateParametersMemoized=(0,AP.H)(((e,t,i)=>({stationary:e,visibleProfiles:t,generationParameters:i}))),this._getGenerationParametersMemoized=(0,AP.H)(((e,t,i,r,n,s,o)=>(0,HP.l9)(t)&&(0,HP.G9)(t)&&null!=r?{view:e,geometry:t,elevationInfo:i,options:s,queue:r,cache:n,slicePlane:o}:null)),this._getElevationInfoMemoized=(0,AP.H)(((e,t)=>({mode:e,offset:t}))),this._getOptionsMemoized=(0,AP.H)(((e,t)=>{const{densificationMaxSamples:i,maxTotalSamples:r}=(0,VP.iE)();return{samplingDistance:e,densificationMaxSamples:Math.round(i/t),maxTotalSamples:r}})),this._updateThrottled=(0,BP.P)((e=>(0,g.R8)(this._update(e))),(0,VP.iE)().updateThrottleMillis)}initialize(){const e=this.viewModel;this.addHandles([(0,F.watch)((()=>({visible:e.visible,profiles:e.profiles.toArray()})),(({visible:e,profiles:t})=>{this._abortUpdate(),this._paramsPerProfile.clear(),this.removeHandles(jP),e&&0!==t.length&&this.addHandles([...t.map((e=>(0,N.AL)([e.attach(this.viewModel),e.on("change",(()=>{this._invalidateProfile(e)}))]))),(0,F.watch)((()=>this._updateParameters),this._updateThrottled,F.syncAndInitial),this._updateThrottled],jP)}),F.syncAndInitial)])}destroy(){this._paramsPerProfile.clear()}get _updateParameters(){const{viewModel:e}=this,t=e.view;return this._getUpdateParametersMemoized(null==t||t.stationary,this.viewModel.visibleProfiles,this._generationParameters)}get _generationParameters(){const{view:e,input:t,queue:i,tileCache:r}=this.viewModel;return null!=e&&e.ready?this._getGenerationParametersMemoized(e,t?.geometry,this._elevationInfo,i,r,this._options,"3d"===e.type?e.slicePlane:null):null}get _elevationInfo(){const e=this.viewModel.input,t=e?(0,q_.Lt)(e)?null:(0,q_.RL)(e):null;return null!=t?this._getElevationInfoMemoized(t.mode,t.offset):null}get _options(){const e=this.viewModel,t=e.visibleProfiles.length;let i=e.minDemResolution??(0,VP.iE)().defaultDemResolution;return i=parseFloat(i.toFixed(2)),this._getOptionsMemoized(i,t)}async _update({stationary:e,visibleProfiles:t,generationParameters:i}){this._abortUpdate(),e&&(null!=i?this._updateTask=(0,be.vr)((async e=>{this.viewModel.error=null;const r=t.filter((e=>!this._isProfileValid(e,i))),n=(0,GP.m7)({...i,providers:r},{signal:e});try{for await(const t of n){(0,g.k_)(e),this._clearInvalidResults(i);for(let e=0;e<r.length;e++)r[e].result=t[e]}for(const e of r)this._paramsPerProfile.set(e,i)}catch(e){(0,g.r9)(e),this._abortUpdate(),this.viewModel.error=e,r.forEach((e=>{e.result=null}))}})):this._clearResults())}_abortUpdate(){this._updateTask=(0,m.IM)(this._updateTask)}_isProfileValid(e,t){return this._paramsPerProfile.has(e)&&this._paramsPerProfile.get(e)===t}_invalidateProfile(e){this._paramsPerProfile.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(const t of this.viewModel.profiles.items)this._isProfileValid(t,e)||(t.result=null,this._paramsPerProfile.delete(t))}_clearResults(){for(const e of this.viewModel.profiles.items)e.result=null,this._paramsPerProfile.delete(e)}};(0,i._)([(0,y.Cb)({nonNullable:!0})],ZP.prototype,"viewModel",void 0),(0,i._)([(0,y.Cb)()],ZP.prototype,"_updateParameters",null),(0,i._)([(0,y.Cb)()],ZP.prototype,"_generationParameters",null),(0,i._)([(0,y.Cb)()],ZP.prototype,"_elevationInfo",null),(0,i._)([(0,y.Cb)()],ZP.prototype,"_options",null),ZP=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.ElevationProfileController")],ZP);var qP=n(12173);function WP(e,t,i){return null==e?null:(0,Ma.En)(e*t,"meters",i)}function $P(e,t,i){return null==e?null:(0,Ma.En)(e*t,"meters",i)}let YP=class extends L.Z.EventedAccessor{constructor(e){super(e),this.type=null,this.id=(0,qP.DO)(),this.title=null,this.color=new s.Z("#000000"),this.visible=!0,this._getSamplesMemoized=(0,AP.H)(((e,t)=>function(e,t){if(null==e||null==t)return null;const{samples:i,spatialReference:r}=e,{distance:n,elevation:s}=t,o=(0,Ma.c9)(r),a=(0,Ma._R)(r),l=i.length,c=new Array(l);for(let e=0;e<l;++e){const t=i[e],r=t.sampledZ,l=t.coordinate;c[e]={x:l[0],y:l[1],z:r,distance:WP(t.distance,o,n),elevation:$P(r,a,s)}}return c}(e,t))),this._getStatisticsMemoized=(0,AP.H)(((e,t)=>function(e,t){if(null==e||null==t||null==e.statistics||null==e.spatialReference)return null;const{distance:i,elevation:r}=t,{statistics:n,spatialReference:s}=e,o=(0,Ma.c9)(s),a=(0,Ma._R)(s);return{maxDistance:WP(n.maxDistance,o,i),minElevation:$P(n.minElevation,a,r),maxElevation:$P(n.maxElevation,a,r),avgElevation:$P(n.avgElevation,a,r),elevationGain:$P(n.elevationGain,a,r),elevationLoss:$P(n.elevationLoss,a,r),maxPositiveSlope:n.maxPositiveSlope,maxNegativeSlope:n.maxNegativeSlope,avgPositiveSlope:n.avgPositiveSlope,avgNegativeSlope:n.avgNegativeSlope}}(e,t))),this.viewVisualizationEnabled=!0,this.result=null,this.effectiveUnits=null,this.numSamplesForPreview=30,this.numSamplesPerChunk=200,this.chartFillEnabled=!0,this.chartStrokeWidth=1.5,this.chartStrokeOffsetY=0,this._viewModel=null}get progress(){return null!=this.result&&this.visible?this.result.progress:0}get samples(){return this._getSamplesMemoized(this.result,this.effectiveUnits)}get statistics(){return this._getStatisticsMemoized(this.result,this.effectiveUnits)}get hoveredPoint(){const e=this._viewModel?.hoveredChartPosition;return null!=e?this._getPoint(e):null}get available(){return!0}get hasZ(){const e=this.result;return null!=e&&e.hasZ}get minDemResolution(){return(0,VP.iE)().defaultDemResolution}queryElevation(){throw new Error("not implemented")}attach(e){return this._viewModel=e,(0,N.AL)([(0,F.watch)((()=>e.effectiveUnits),(e=>{this.effectiveUnits=e}),F.syncAndInitial),(0,F.watch)((()=>[e.input]),(()=>this._onChange()),F.sync)])}toggleVisibility(e){this.visible=void 0===e?!this.visible:e}_onChange(){this.emit("change")}_getPoint(e){const{samples:t,result:i}=this;if(null==t||null==i)return null;const r=t.length;if(0===r)return null;const n=t[r-1].distance,s=(0,GP.hG)(t,e*n,(e=>e.distance));if(null==s)return null;const{x:o,y:a,z:l}=s;return null==l?null:new wi.Z({x:o,y:a,z:l,spatialReference:i.spatialReference})}};(0,i._)([(0,y.Cb)({nonNullable:!0})],YP.prototype,"id",void 0),(0,i._)([(0,y.Cb)({nonNullable:!0})],YP.prototype,"title",void 0),(0,i._)([(0,y.Cb)({type:s.Z,nonNullable:!0})],YP.prototype,"color",void 0),(0,i._)([(0,y.Cb)({nonNullable:!0})],YP.prototype,"visible",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],YP.prototype,"progress",null),(0,i._)([(0,y.Cb)({readOnly:!0})],YP.prototype,"samples",null),(0,i._)([(0,y.Cb)({readOnly:!0})],YP.prototype,"statistics",null),(0,i._)([(0,y.Cb)()],YP.prototype,"hoveredPoint",null),(0,i._)([(0,y.Cb)()],YP.prototype,"viewVisualizationEnabled",void 0),(0,i._)([(0,y.Cb)()],YP.prototype,"available",null),(0,i._)([(0,y.Cb)()],YP.prototype,"result",void 0),(0,i._)([(0,y.Cb)()],YP.prototype,"effectiveUnits",void 0),(0,i._)([(0,y.Cb)()],YP.prototype,"numSamplesForPreview",void 0),(0,i._)([(0,y.Cb)()],YP.prototype,"numSamplesPerChunk",void 0),(0,i._)([(0,y.Cb)()],YP.prototype,"chartFillEnabled",void 0),(0,i._)([(0,y.Cb)()],YP.prototype,"chartStrokeWidth",void 0),(0,i._)([(0,y.Cb)()],YP.prototype,"chartStrokeOffsetY",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],YP.prototype,"hasZ",null),(0,i._)([(0,y.Cb)({readOnly:!0})],YP.prototype,"minDemResolution",null),(0,i._)([(0,y.Cb)()],YP.prototype,"_viewModel",void 0),YP=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.ElevationProfileLine")],YP);const JP=YP;function XP(e){if(null==e)return null;if(function(e){return null!=e&&"object"==typeof e&&C in e}(e))return KP(e);const t=e.tileInfo;if(null==t)return null;const i=t.lods?.at(-1);return null==i?null:i.resolution*(0,Ma.c9)(t.spatialReference)}function KP(e){if(null==e)return null;const t=e.layers.items.map(QP).filter(Xe.pC);return(0,Xe.VV)(t)??null}function QP(e){return e&&"tileInfo"in e?XP(e):null}let eI=class extends JP{constructor(e){super(e),this.type="ground",this.color=new s.Z("#ff7f00"),this.viewVisualizationEnabled=!0,this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getQueryElevationDependencies=(0,AP.H)(((e,t)=>({ground:e,groundLayers:t})))}get available(){const e=this._ground;return null!=e&&e.layers.some((e=>e.visible))}get minDemResolution(){return KP(this._ground)}get _queryElevationDependencies(){return this._getQueryElevationDependencies(this._ground,this._groundLayers)}get _ground(){return this._viewModel?.view?.map?.ground}get _groundLayers(){return this._ground?.layers?.toArray()??[]}async queryElevation(e,t){const i=this._queryElevationDependencies;if(null==i)throw new Error("ElevationProfileLineGround: no dependencies");const{ground:r}=i;if(null==r)throw new Error("No ground configured in the view");const n=await r.queryElevation(e,t),s=(0,Ma._R)(e.spatialReference),o=(0,Ma._R)(r.layers.at(0).spatialReference);if(s!==o){const e=n.geometry;e.points=e.points.map((([e,i,r])=>[e,i,r===t.noDataValue?r:r*o/s]))}return n}attach(e){return(0,N.AL)([super.attach(e),(0,F.watch)((()=>this._queryElevationDependencies),(()=>this._onChange()))])}};(0,i._)([(0,y.Cb)({type:s.Z,nonNullable:!0})],eI.prototype,"color",void 0),(0,i._)([(0,y.Cb)()],eI.prototype,"viewVisualizationEnabled",void 0),(0,i._)([(0,y.Cb)()],eI.prototype,"available",null),(0,i._)([(0,y.Cb)({readOnly:!0})],eI.prototype,"minDemResolution",null),(0,i._)([(0,y.Cb)()],eI.prototype,"_queryElevationDependencies",null),(0,i._)([(0,y.Cb)()],eI.prototype,"_ground",null),(0,i._)([(0,y.Cb)()],eI.prototype,"_groundLayers",null),eI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.ElevationProfileLineGround")],eI);const tI=eI;var iI=n(8184);let rI=class extends JP{constructor(e){super(e),this.type="input",this.color=new s.Z("#00c8c8"),this.viewVisualizationEnabled=!1,this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this.chartFillEnabled=!1,this.chartStrokeOffsetY=-1,this._getQueryElevationDependencies=(0,AP.H)(((e,t,i,r,n)=>e?{elevationInfo:e,visibleLayers:t,view:i,stationary:r,spatialReference:n}:null))}get queryElevationDependencies(){const e=this._viewModel?.view;return null==e?null:this._getQueryElevationDependencies(this._elevationInfo,this._visibleLayers,e,e.stationary,e.spatialReference)}get available(){return!this._viewModel?.inputIsSketched}get _elevationInfo(){const e=this._viewModel?.input;return e?(0,q_.RL)(e):null}get _visibleLayers(){return this._viewModel?.view?.map?.allLayers?.filter((e=>e.visible)).toArray()??[]}async queryElevation(e,{noDataValue:t,signal:i}){const r=this.queryElevationDependencies;if(null==r)throw new Error("ElevationProfileLineInput: no dependencies");const{view:n,elevationInfo:s,spatialReference:o}=r;if("on-the-ground"===s.mode&&"3d"===n.type&&o){const r=await iI.GeometryDescriptor.fromGeometry(e).project(o,i);if(!r)return{geometry:e,noDataValue:t};const s=n.elevationProvider;return r.coordinates.forEach((e=>{e.z=s.getElevation(e.x,e.y,0,o,"ground")??0})),{geometry:r.export(),noDataValue:t}}return{geometry:e,noDataValue:t}}attach(e){const t=()=>this._onChange();return(0,N.AL)([super.attach(e),(0,F.watch)((()=>this.queryElevationDependencies),t),(0,F.on)((()=>e.elevationProvider),"elevation-change",t,{onListenerAdd:t,onListenerRemove:t})])}};(0,i._)([(0,y.Cb)({type:s.Z,nonNullable:!0})],rI.prototype,"color",void 0),(0,i._)([(0,y.Cb)()],rI.prototype,"viewVisualizationEnabled",void 0),(0,i._)([(0,y.Cb)()],rI.prototype,"queryElevationDependencies",null),(0,i._)([(0,y.Cb)()],rI.prototype,"available",null),(0,i._)([(0,y.Cb)()],rI.prototype,"_elevationInfo",null),(0,i._)([(0,y.Cb)()],rI.prototype,"_visibleLayers",null),rI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.ElevationProfileLineInput")],rI);const nI=rI;let sI=class extends JP{constructor(e){super(e),this.type="query",this.color=new s.Z("#db334a"),this.viewVisualizationEnabled=!0,this.source=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return XP(this.source)}get available(){const e=this.source;return!!e&&(null==e.visible||e.visible)&&(null==e.layers||e.layers.some((e=>e.visible)))}queryElevation(e,t){if(!this.source)throw new Error("No source configured for the elevation profile line");return this.source.queryElevation(e,t)}attach(e){return(0,N.AL)([super.attach(e),(0,F.watch)((()=>this.source),(()=>this._onChange()),F.sync)])}};(0,i._)([(0,y.Cb)({type:s.Z,nonNullable:!0})],sI.prototype,"color",void 0),(0,i._)([(0,y.Cb)()],sI.prototype,"viewVisualizationEnabled",void 0),(0,i._)([(0,y.Cb)()],sI.prototype,"source",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],sI.prototype,"minDemResolution",null),(0,i._)([(0,y.Cb)()],sI.prototype,"available",null),sI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.ElevationProfileLineQuery")],sI);const oI=sI;var aI=n(84523);let lI=class extends JP{constructor(e){super(e),this.type="view",this.color=new s.Z("#cf4ccf"),this.viewVisualizationEnabled=!0,this.include=null,this.exclude=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getQueryElevationDependencies=(0,AP.H)(((e,t,i,r,n,s,o)=>({inputGraphicUid:null!=e?uI(e):null,visibleLayers:t,maxIntersectionDistance:i,intersectOptions:r,view:n,stationary:s,spatialReference:o}))),this._vecA=(0,Pa.Ue)(),this._vecB=(0,Pa.Ue)(),this._ray=(0,uh.Ue)()}get minDemResolution(){const e=this._viewModel?.view;if(null==e||"3d"!==e.type)return null;const t=e.pointsOfInterest?.focus?.worldUnitsPerContentPixel;return null==t?null:t*(0,Ma._R)(e.spatialReference)}get queryElevationDependencies(){const e=this._view;return e?this._getQueryElevationDependencies(this._viewModel?.input,this._visibleLayers,this._maxIntersectionDistance,this._intersectOptions,e,e.stationary,e.spatialReference):null}get _visibleLayers(){return this._view?.map?.allLayers?.filter((e=>e.visible)).toArray()??[]}get _intersectOptions(){const e=this._view;if(null==e||e.destroyed)return{};const t=(0,W_.us)(e,{include:this.include,exclude:this.exclude}),i=(0,W_.us)(e,{exclude:this._pointCloudLayers});return t.exclude=(0,Qe.G0)(t.exclude,i.exclude),t}get _pointCloudLayers(){const e=this._view;return null==e?[]:e.allLayerViews.toArray().filter((e=>"point-cloud"===e.layer?.type)).map((e=>e.layer))}get _view(){const e=this._viewModel?.view;return null!=e&&"3d"===e.type?e:null}get _maxIntersectionDistance(){const e=this._view;return e?.renderCoordsHelper?(0,_l.Iu)(e.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const e=this._view;if(null==e)return null;const t=(0,vd.Z8)(e.state.viewingMode),i=t.options;return i.hud=!1,i.invisibleTerrain=!1,i.backfacesTerrain=!1,i.selectionMode=!1,i.store=Zg.eC.ALL,t}async queryElevation(e,{noDataValue:t,signal:i}){const r=this.queryElevationDependencies;if(null==r)throw new Error("ElevationProfileLineInput: no dependencies");const n=this._intersector;if(null==n)throw new Error("ElevationProfileLineInput: no view");const{intersectOptions:s,view:o,spatialReference:a}=r,l=o.renderCoordsHelper,c=o.sceneIntersectionHelper,u=this._vecA,h=this._vecA,d=this._vecB,p=this._ray;if(!a)return{geometry:e,noDataValue:t};const f=await iI.GeometryDescriptor.fromGeometry(e).project(a,i);if(!f)return{geometry:e,noDataValue:t};const m=f.coordinates,g=m.length;for(let e=0;e<g;++e){const i=m[e];(0,hr.i)(d,i.x,i.y,i.z??0),l.toRenderCoords(d,a,d),l.setAltitude(u,2e5,d);const o=(0,uh.zk)(u,d,p);c.computeIntersection(o,n,s,!0);const f=cI(r,n.results.all);f?(f.getIntersectionPoint(h),l.fromRenderCoords(h,h,a),i.z=h[2]):i.z=t}return{geometry:f.export(),noDataValue:t}}attach(e){const t=()=>this._onChange();return(0,N.AL)([super.attach(e),(0,F.watch)((()=>this.queryElevationDependencies),t),(0,F.on)((()=>e.elevationProvider),"elevation-change",t,{onListenerAdd:t,onListenerRemove:t})])}};function cI({view:e,inputGraphicUid:t,maxIntersectionDistance:i},r){for(const n of r){if(!n.withinDistance(i))continue;const r=(0,aI.tB)(n,e);if(null==r||uI(r)!==t)return n}return null}function uI(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}(0,i._)([(0,y.Cb)({type:s.Z,nonNullable:!0})],lI.prototype,"color",void 0),(0,i._)([(0,y.Cb)()],lI.prototype,"viewVisualizationEnabled",void 0),(0,i._)([(0,y.Cb)()],lI.prototype,"include",void 0),(0,i._)([(0,y.Cb)()],lI.prototype,"exclude",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],lI.prototype,"minDemResolution",null),(0,i._)([(0,y.Cb)()],lI.prototype,"queryElevationDependencies",null),(0,i._)([(0,y.Cb)()],lI.prototype,"_visibleLayers",null),(0,i._)([(0,y.Cb)()],lI.prototype,"_intersectOptions",null),(0,i._)([(0,y.Cb)()],lI.prototype,"_pointCloudLayers",null),(0,i._)([(0,y.Cb)()],lI.prototype,"_view",null),(0,i._)([(0,y.Cb)()],lI.prototype,"_maxIntersectionDistance",null),(0,i._)([(0,y.Cb)()],lI.prototype,"_intersector",null),lI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.ElevationProfileLineView")],lI);const hI={base:JP,key:"type",typeMap:{ground:tI,input:nI,query:oI,view:lI},errorContext:"elevation-profile-line"},dI=o.Z.ofType(hI);var pI,fI,mI=n(45857),gI=n(62589),yI=n(15498),_I=n(94203);!function(e){e.Ready="ready",e.Creating="creating",e.Reshaping="reshaping",e.ReshapingDisabled="reshaping-disabled",e.Selecting="selecting",e.Selected="selected"}(pI||(pI={})),function(e){e.View="view",e.Main="main",e.Interaction="interaction"}(fI||(fI={}));let vI=class extends P.Z{constructor(e){super(e),this.state=pI.Ready,this._pendingStartOptions=null,this._previousInputInfo=null,this._shouldRemoveLastPoint=!1,this._sketchedGraphics=new WeakSet,this._creationToolPromise=null,this._updateToolPromise=null,this._updateDisabled=!1}initialize(){this.addHandles((0,F.watch)((()=>({view:this.tool.viewModel.view,visible:this.tool.visible})),(({view:e,visible:t})=>{null!=e&&t?this._attach(e):this._detach()}),F.syncAndInitial),fI.View)}destroy(){this._detach()}get canStopCreating(){const e=this._geometry,t=this._shouldRemoveLastPoint?3:2;return(0,HP.l9)(e)&&e.paths.length>0&&e.paths[0].length>=t}get _input(){return this.tool.viewModel.input}set _input(e){this.tool.viewModel.input=e}get _geometry(){return this._input?.geometry}get _visibleAndEditable(){return this.tool.visible&&this.tool.editable}get _view(){return this.tool.viewModel.view}get test(){}start(e={mode:"sketch"}){if(!this.tool.editable)return;const t=this._view;if(null!=t&&t.ready)switch(this._pendingStartOptions=null,this._stopInteraction(),null==this._previousInputInfo&&this._storePreviousInput(this._input),this._setSketchedGraphic(null),e.mode){case"sketch":this._set("state",pI.Creating),this._startCreationInteraction();break;case"select":this._set("state",pI.Selecting),this._startSelectionInteraction()}else this._pendingStartOptions=e}stop(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._clearPreviousInput()}cancel(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._restorePreviousInput()}clear(){this._stopInteractionAndUpdate(),this._set("state",pI.Ready),this._clearPreviousInput(),this._input=null,this._pendingStartOptions=null}isSketchedGraphic(e){return null!=e&&this._sketchedGraphics.has(e)}_attach(e){this._detach();const t={mode:"3d"===e.type?"relative-to-ground":"on-the-ground",offset:null};this._graphicsLayer=new mI.Z({listMode:"hide",internal:!0,elevationInfo:t});const i=function(e){return"2d"===e?new gI.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[0,0,0,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[255,255,255,255]}]}}}):new yI.Z({color:[0,0,0,0]})}(e.type);this._sketchVM=new _I.Z({layer:this._graphicsLayer,view:e,defaultCreateOptions:{mode:"click",hasZ:!1},updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{shapeOperation:"none"},enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:i,activeLineSymbol:i}),this.addHandles([(0,F.when)((()=>e.ready),(()=>{const e=this._pendingStartOptions;e&&this.start(e)}),F.syncAndInitial),(0,F.watch)((()=>[this._input,this._visibleAndEditable]),(()=>this._update()),F.syncAndInitial),(0,F.watch)((()=>({map:e.map,graphicsLayer:this._graphicsLayer})),(({map:e,graphicsLayer:t})=>{null!=e&&null!=t&&e.add(t),this._update()}),F.syncAndInitial)],fI.Main)}_detach(){this.removeHandles(fI.Main),this._sketchVM=(0,m.SC)(this._sketchVM),this._creationToolPromise=null,this._updateToolPromise=null;const e=this._view?.map,t=this._graphicsLayer;null!=e&&null!=t&&e.remove(t),this._graphicsLayer=(0,m.SC)(this._graphicsLayer),this._shouldRemoveLastPoint=!1,this._set("state",pI.Ready)}_startCreationInteraction(){this._stopInteractionAndUpdate();const e=this._view,t=this._sketchVM;if(null==e||null==t)return;this._shouldRemoveLastPoint=!1;const i=t.on("create",(e=>{const t=e.graphic;switch(e.state){case"complete":this._shouldRemoveLastPoint=!1,this._setSketchedGraphic(t),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"cancel":this.cancel();break;case"active":this._setSketchedGraphic(t),"cursor-update"===e.toolEventInfo?.type&&(this._shouldRemoveLastPoint=!0);break;case"start":this._setSketchedGraphic(t)}}));this.removeHandles(fI.Interaction),this.addHandles((0,N.kB)((()=>{i.remove();const e=this.canStopCreating,r=this._geometry?.clone();t.cancel(),this._creationToolPromise=null,null!=r&&e?this._shouldRemoveLastPoint&&this._setSketchedGraphic(new js.Z({geometry:bI(r)})):this._input=null})),fI.Interaction),this._creationToolPromise=(0,g.R8)(t.create("polyline"))}_startReshapeInteraction(){this._stopInteraction();const e=this._view,t=this._sketchVM;if(null==e||null==t)return;const i=t.on("update",(e=>{const t=e.graphics[0];switch(e.state){case"complete":this._setSketchedGraphic(t),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"active":case"start":this._setSketchedGraphic(t)}}));this.removeHandles(fI.Interaction),this.addHandles((0,N.kB)((()=>{i.remove(),t.cancel(),this._updateToolPromise=null})),fI.Interaction);const r=this._input;r&&(r.visible=!0,this._updateToolPromise=(0,g.R8)(t.update(r,{tool:"reshape"})))}_startSelectionInteraction(){this._stopInteraction();const e=this._view;if(null==e)return;const t=e.cursor,i=(0,N.kB)((()=>e.cursor=t));e.cursor="crosshair",e.closePopup();let r=null;const n=(0,N.kB)((()=>(0,m.IM)(r))),s=e.on("immediate-click",(t=>{t.async((async()=>{(0,m.IM)(r),r=(0,be.vr)((async i=>{const{results:r}=await e.hitTest(t);(0,g.k_)(i);const n=r.filter((e=>"graphic"===e.type)).map((e=>e.graphic)).find((e=>null!=e.geometry&&"polyline"===e.geometry.type));n&&(t.preventDefault(),t.stopPropagation(),this._input=n,this._clearPreviousInput(),this._stopInteractionAndUpdate())})),await r.promise}))}),we.f.TOOL),o=e.on("key-down",(e=>{"Escape"===e.key&&this.cancel()}));this.removeHandles(fI.Interaction),this.addHandles([s,o,n,i],fI.Interaction),e.ready&&e.focus()}_stopInteraction(){this.removeHandles(fI.Interaction)}_stopInteractionAndUpdate(){this.hasHandles(fI.Interaction)&&(this._updateDisabled=!0,this._stopInteraction(),this._updateDisabled=!1,this._triggerUpdate())}_triggerUpdate(){this._set("state",pI.Ready),this._update()}_update(){if(this._updateDisabled)return;const e=this.state;if(e!==pI.Selecting){if(this._visibleAndEditable){if(e===pI.Creating||e===pI.Reshaping&&this.isSketchedGraphic(this._input))return}else this.cancel();this._set("state",this._getNextState()),this._updateVisuals()}else this.stop()}_getNextState(){return null==this._input?pI.Ready:this.isSketchedGraphic(this._input)?this.state===pI.Creating?pI.Creating:this._visibleAndEditable?pI.Reshaping:pI.ReshapingDisabled:pI.Selected}_updateVisuals(){switch(this.state){case pI.Creating:break;case pI.Reshaping:this._startReshapeInteraction();break;case pI.ReshapingDisabled:{this._stopInteractionAndUpdate();const e=this._input;null!=e&&this.isSketchedGraphic(e)&&(e.visible=!1);break}case pI.Ready:case pI.Selected:this._stopInteractionAndUpdate();case pI.Selecting:}this._updateSketchedGraphic()}_storePreviousInput(e){this._previousInputInfo={graphic:e}}_restorePreviousInput(){const e=this._previousInputInfo;null!=e&&(this._clearPreviousInput(),this._input=e.graphic,this._triggerUpdate())}_clearPreviousInput(){this._previousInputInfo=null}_updateSketchedGraphic(){const e=this._graphicsLayer;if(null==e)return;const t=e.graphics,i=this._input;if(null!=i&&this.isSketchedGraphic(i)){if(-1===t.indexOf(i))t.removeAll(),t.add(i);else if(1!==t.length){const e=t.filter((e=>e!==i));t.removeMany(e)}}else t.removeAll()}_setSketchedGraphic(e){null!=e&&this._sketchedGraphics.add(e),this._input=e,this._updateSketchedGraphic()}};function bI(e){if((0,HP.l9)(e)){const t=e.clone();return t.paths=[t.paths[0].slice(0,-1)],t}return e}(0,i._)([(0,y.Cb)({nonNullable:!0})],vI.prototype,"state",void 0),(0,i._)([(0,y.Cb)({nonNullable:!0})],vI.prototype,"tool",void 0),(0,i._)([(0,y.Cb)()],vI.prototype,"canStopCreating",null),(0,i._)([(0,y.Cb)()],vI.prototype,"_graphicsLayer",void 0),(0,i._)([(0,y.Cb)()],vI.prototype,"_sketchVM",void 0),(0,i._)([(0,y.Cb)()],vI.prototype,"_input",null),(0,i._)([(0,y.Cb)()],vI.prototype,"_geometry",null),(0,i._)([(0,y.Cb)()],vI.prototype,"_visibleAndEditable",null),(0,i._)([(0,y.Cb)()],vI.prototype,"_view",null),(0,i._)([(0,y.Cb)()],vI.prototype,"_shouldRemoveLastPoint",void 0),vI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.ElevationProfileInteraction")],vI);let wI=class extends P.Z{constructor(e){super(e),this._implementation=null,this._loadingTask=null}initialize(){this.addHandles((0,F.watch)((()=>({tool:this.tool,view:this.tool.viewModel.view,visible:this.tool.visible&&!!this.tool.viewModel.view?.ready})),(({tool:e,view:t,visible:i})=>{null!=t&&i?this._show(t,e):this._hide()}),F.syncAndInitial))}destroy(){this._hide()}_show(e,t){this._loadingTask=(0,m.IM)(this._loadingTask),this._loadingTask=(0,be.vr)((async i=>{if("2d"===e.type){const r=n.e(94136).then(n.bind(n,94136)),s=(await(0,g.Hl)(r,i)).ElevationProfileView2D;this._implementation=new s(e,t)}else if("3d"===e.type){const r=Promise.all([n.e(54221),n.e(13540),n.e(45224)]).then(n.bind(n,63084)),s=(await(0,g.Hl)(r,i)).ElevationProfileView3D;this._implementation=new s(e,t)}}))}_hide(){this._loadingTask=(0,m.IM)(this._loadingTask),this._implementation=(0,m.SC)(this._implementation)}};(0,i._)([(0,y.Cb)()],wI.prototype,"tool",void 0),wI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.support.ElevationProfileView")],wI);let xI=class extends P.Z{constructor(e){super(e),this.editable=!0,this.visible=!0,this.highlightEnabled=!0}initialize(){this.view=new wI({tool:this}),this.interaction=new vI({tool:this})}destroy(){this.interaction.destroy(),this.view.destroy()}get state(){const e=this.interaction?.state;switch(e){case pI.Ready:return VP.dd.Ready;case pI.Creating:return VP.dd.Creating;case pI.Selecting:return VP.dd.Selecting;case pI.Selected:return VP.dd.Selected;case pI.Reshaping:case pI.ReshapingDisabled:return VP.dd.Created}}};(0,i._)([(0,y.Cb)({nonNullable:!0})],xI.prototype,"viewModel",void 0),(0,i._)([(0,y.Cb)()],xI.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],xI.prototype,"interaction",void 0),(0,i._)([(0,y.Cb)()],xI.prototype,"editable",void 0),(0,i._)([(0,y.Cb)()],xI.prototype,"visible",void 0),(0,i._)([(0,y.Cb)()],xI.prototype,"highlightEnabled",void 0),xI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.ElevationProfileTool")],xI);var TI=n(50201),CI=n(84322);let SI=class extends P.Z{constructor(e){super(e),this.view=null,this.input=null,this._getEffectiveUnitsMemoized=(0,AP.H)(((e,t)=>({distance:e,elevation:t}))),this.hoveredChartPosition=null,this.uniformChartScaling=!1,this.defaultUnit=null,this.queue=null,this._currentTileCache=null,this.error=null,this._defaultProfileLineGround=new tI,this._userUnitOptions=null,this._userUnit=null,e?.profiles||(this.profiles=new o.Z([this._defaultProfileLineGround]))}initialize(){this.addHandles((0,F.watch)((()=>this.view),(e=>{if(null==e)return void f.Z.getLogger(this).warnOnce("no view. Widget will be disabled until a view is provided.");this.removeHandles(EI);const t="3d"===e.type?e.resourceController:void 0;this.queue?.destroy(),this.queue=(0,GP.Qr)(t?.scheduler);const i=t?.addUpdatingObject(this);i&&this.addHandles(i,EI)}),F.syncAndInitial)),this.tool=new xI({viewModel:this}),this._controller=new ZP({viewModel:this})}destroy(){this._defaultProfileLineGround=(0,m.SC)(this._defaultProfileLineGround),this._controller=(0,m.SC)(this._controller),this._currentTileCache=(0,m.SC)(this._currentTileCache),this.tool=(0,m.SC)(this.tool),this.queue=(0,m.SC)(this.queue)}get profiles(){return this._get("profiles")}set profiles(e){const t=this._get("profiles"),i=e??new o.Z;this._set("profiles",(0,a.Z)(i,t))}get state(){const e=this.view;return null!=e&&e.ready?this.tool.state:VP.dd.Disabled}get progress(){let e=0,t=0;for(const i of this.visibleProfiles)e++,t+=i.progress;return e>0?t/e:0}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}get effectiveUnits(){const e=(0,CI.lg)(this.visibleProfiles.map((e=>e.result))),t=(0,Ma.wd)(e.maxDistance,"meters",this.unit),i=(0,Ma.yv)(e.maxElevation,"meters",this.unit);return this._getEffectiveUnitsMemoized(t,i)}get highlightEnabled(){return this.tool.highlightEnabled}set highlightEnabled(e){this.tool.highlightEnabled=e}get hasVertices(){const e=this.input?.geometry;return(0,HP.l9)(e)&&e.paths.reduce(((e,t)=>e+t.length),0)>0}get hoveredPoints(){return null!=this.input&&this.visible&&this.tool.editable?this.visibleProfiles.map((e=>{const t=e.hoveredPoint;return null!=t?{hoveredPoint:t,color:e.color}:null})).filter(Xe.pC):[]}get statistics(){return(0,CI.Ds)(this.visibleProfiles.map((e=>e.statistics)))}get chartData(){if(null==this.input)return null;const{effectiveUnits:e,progress:t,statistics:i,visibleProfiles:r,uniformChartScaling:n}=this,s=r.filter((e=>e.hasZ)).map((e=>({id:e.id,type:e.type,title:e.title,color:e.color,samples:e.samples,progress:e.progress,chartFillEnabled:e.chartFillEnabled,chartStrokeWidth:e.chartStrokeWidth,chartStrokeOffsetY:e.chartStrokeOffsetY,viewVisualizationEnabled:e.viewVisualizationEnabled})));return 0===s.length?null:{lines:s,effectiveUnits:e,statistics:i,refined:1===t,dynamicElevationRange:r.some((e=>"view"===e.type)),uniformScaling:n}}get visibleProfiles(){return this.profiles.toArray().filter((e=>e.available&&e.visible))}get minDemResolutions(){const e=[];for(const{minDemResolution:t}of this.visibleProfiles)null!=t&&e.push(t);return e}get minDemResolution(){return(0,Xe.VV)(this.minDemResolutions)}get errorState(){const e=this.input?.geometry;if(!(0,HP.G9)(e))return VP.J8.NoValidInput;if(null!=this.error){if((0,TI.eq)(this.error))switch(this.error.cause){case TI.k2.TooComplex:return VP.J8.TooComplex;case TI.k2.InvalidGeometry:return VP.J8.InvalidGeometry;case TI.k2.InvalidElevationInfo:return VP.J8.InvalidElevationInfo;case TI.k2.ElevationQueryError:return VP.J8.NoValidInput}return VP.J8.UnknownError}return 0===this.visibleProfiles.length?VP.J8.NoVisibleProfiles:null==this.chartData&&1===this.progress?VP.J8.RefinedButNoChartData:VP.J8.None}get tileCache(){this._currentTileCache=(0,m.SC)(this._currentTileCache);const e=this.view;if(null!=e&&"3d"===e?.type){const t=e.basemapTerrain?.elevationQueryCache;if(null!=t)return t}return null==this._currentTileCache&&(this._currentTileCache=new Wb(new kP.z(20*qv.Y.MEGABYTES))),this._currentTileCache}get visible(){return this.tool.visible}set visible(e){this.tool.visible=e}get selectAvailable(){for(const e of this.view?.map?.allLayers??[]){if("graphics"===e.type&&!e.internal&&e.graphics.some((e=>"polyline"===e.geometry?.type)))return!0;if("geometryType"in e&&"polyline"===e.geometryType)return!0}return!!this.view?.graphics?.some((e=>"polyline"===e.geometry?.type))}get inputIsSketched(){return this.tool.interaction.isSketchedGraphic(this.input)}get elevationProvider(){const e=this.view;return null!=e&&"3d"===e.type?e.elevationProvider:null}get updating(){const{progress:e}=this,t=!!this.queue?.updating;return e>0&&e<1||t}start(e){this.tool.interaction.start(e)}stop(){this.tool.interaction.stop()}cancel(){this.tool.interaction.cancel()}clear(){this.tool.interaction.clear()}_findSelectableUnit(e,t){const i=this.unitOptions;return null!=e&&i.includes(e)?e:t?this._findSelectableUnit(t):i[0]}_filteredOrAllUnits(e){const t=(null!=e?e:[]).filter((e=>Ma.oD.includes(e)));return 0===t.length?Ma.oD.slice():t}};(0,i._)([(0,y.Cb)()],SI.prototype,"view",void 0),(0,i._)([(0,y.Cb)({type:js.Z})],SI.prototype,"input",void 0),(0,i._)([(0,y.Cb)({type:dI,nonNullable:!0})],SI.prototype,"profiles",null),(0,i._)([(0,y.Cb)({readOnly:!0})],SI.prototype,"state",null),(0,i._)([(0,y.Cb)({readOnly:!0})],SI.prototype,"progress",null),(0,i._)([(0,y.Cb)()],SI.prototype,"unitOptions",null),(0,i._)([(0,y.Cb)()],SI.prototype,"unit",null),(0,i._)([(0,y.Cb)({readOnly:!0})],SI.prototype,"effectiveUnits",null),(0,i._)([(0,y.Cb)()],SI.prototype,"hoveredChartPosition",void 0),(0,i._)([(0,y.Cb)()],SI.prototype,"uniformChartScaling",void 0),(0,i._)([(0,y.Cb)()],SI.prototype,"highlightEnabled",null),(0,i._)([(0,y.Cb)({readOnly:!0})],SI.prototype,"hoveredPoints",null),(0,i._)([(0,y.Cb)({readOnly:!0})],SI.prototype,"statistics",null),(0,i._)([(0,y.Cb)()],SI.prototype,"chartData",null),(0,i._)([(0,y.Cb)()],SI.prototype,"visibleProfiles",null),(0,i._)([(0,y.Cb)()],SI.prototype,"minDemResolutions",null),(0,i._)([(0,y.Cb)({readOnly:!0})],SI.prototype,"minDemResolution",null),(0,i._)([(0,y.Cb)({readOnly:!0})],SI.prototype,"errorState",null),(0,i._)([(0,y.Cb)(zP.Y)],SI.prototype,"defaultUnit",void 0),(0,i._)([(0,y.Cb)()],SI.prototype,"queue",void 0),(0,i._)([(0,y.Cb)()],SI.prototype,"tileCache",null),(0,i._)([(0,y.Cb)()],SI.prototype,"tool",void 0),(0,i._)([(0,y.Cb)()],SI.prototype,"visible",null),(0,i._)([(0,y.Cb)()],SI.prototype,"error",void 0),(0,i._)([(0,y.Cb)()],SI.prototype,"selectAvailable",null),(0,i._)([(0,y.Cb)()],SI.prototype,"inputIsSketched",null),(0,i._)([(0,y.Cb)()],SI.prototype,"elevationProvider",null),(0,i._)([(0,y.Cb)()],SI.prototype,"updating",null),(0,i._)([(0,y.Cb)()],SI.prototype,"_defaultProfileLineGround",void 0),(0,i._)([(0,y.Cb)()],SI.prototype,"_userUnitOptions",void 0),(0,i._)([(0,y.Cb)()],SI.prototype,"_controller",void 0),(0,i._)([(0,y.Cb)()],SI.prototype,"_userUnit",void 0),SI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.ElevationProfileViewModel")],SI);const EI=Symbol("updating-object"),MI=SI;let AI=class extends P.Z{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};(0,i._)([(0,y.Cb)()],AI.prototype,"legend",void 0),(0,i._)([(0,y.Cb)()],AI.prototype,"chart",void 0),(0,i._)([(0,y.Cb)()],AI.prototype,"clearButton",void 0),(0,i._)([(0,y.Cb)()],AI.prototype,"settingsButton",void 0),(0,i._)([(0,y.Cb)()],AI.prototype,"sketchButton",void 0),(0,i._)([(0,y.Cb)()],AI.prototype,"selectButton",void 0),(0,i._)([(0,y.Cb)()],AI.prototype,"unitSelector",void 0),(0,i._)([(0,y.Cb)()],AI.prototype,"uniformChartScalingToggle",void 0),AI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],AI);const RI=AI;let OI=class extends _o.Z{constructor(e,t){super(e,t),this._updateLayout=e=>{const t=e.parentElement,i=e.style.display;t?.removeChild(e),document.body.appendChild(e),e.style.display="block";let r=80;for(const t of e.childNodes)t instanceof HTMLElement&&(r=Math.max(r,t.offsetWidth));document.body.removeChild(e),t?.appendChild(e),e.style.display=i,e.style.setProperty("--max-width",`${r}px`)},this._updateLayoutThrottled=(0,BP.P)(this._updateLayout,100)}loadDependencies(){return(0,Bo.h)({icon:()=>n.e(45748).then(n.bind(n,45748))})}initialize(){this.addHandles(this._updateLayoutThrottled)}render(){return(0,Ro.u)("div",{afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled,bind:this,class:NP.base},this._renderStatistics())}_renderStatistics(){const e=this._messages?.statistics;return e?[this._renderDistanceStatistic("maxDistance",e.maxDistance),this._renderElevationStatistic("elevationGain",e.gain),this._renderElevationStatistic("elevationLoss",e.loss),this._renderElevationStatistic("minElevation",e.minElevation),this._renderElevationStatistic("maxElevation",e.maxElevation),this._renderElevationStatistic("avgElevation",e.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",e.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",e.avgSlope)]:[]}_renderDistanceStatistic(e,t){const i=(0,VP.iE)().formatPrecision,r=this._renderValue(e,(e=>{const t=this.effectiveUnits.distance;return(0,Tm.VG)(this._messagesUnits,e,t,i)}));return this._renderStatistic(t,r)}_renderElevationStatistic(e,t){const i=(0,VP.iE)().formatPrecision,r=this._renderValue(e,(e=>{const t=this.effectiveUnits.elevation;return(0,Tm.VG)(this._messagesUnits,e,t,i)}));return this._renderStatistic(t,r)}_renderSlopeStatistic(e,t,i){const r=(0,VP.iE)().formatPrecision,n=(0,Ro.u)("div",{class:NP.slopeValue,key:"slope-up"},(0,Ro.u)("calcite-icon",{icon:"arrow-up",scale:"s"}),this._renderValue(e,(e=>(0,Tm.L4)(e,"degrees","geographic","geographic",r))),(0,Ro.u)("calcite-icon",{icon:"arrow-down",scale:"s"}),this._renderValue(t,(e=>(0,Tm.L4)(e,"degrees","geographic","geographic",r))));return this._renderStatistic(i,n)}_renderStatistic(e,t){return(0,Ro.u)("div",{class:NP.statistic},(0,Ro.u)("label",{class:NP.statisticLabel},e),(0,Ro.u)("div",{class:NP.statisticValue},t))}_renderValue(e,t){const i=this.line,r=(1===i.progress?i.statistics:null)?.[e];return null!=r?t(r):VP.h8}};(0,i._)([(0,y.Cb)()],OI.prototype,"effectiveUnits",void 0),(0,i._)([(0,y.Cb)()],OI.prototype,"line",void 0),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/widgets/ElevationProfile/t9n/ElevationProfile")],OI.prototype,"_messages",void 0),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/core/t9n/Units")],OI.prototype,"_messagesUnits",void 0),OI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.components.Statistics")],OI);var PI=n(29214),II=n(61547);let LI=class extends _o.Z{constructor(e,t){super(e,t),this.checkboxVisible=!0,this.expanded=!1}loadDependencies(){return(0,Bo.h)({action:()=>Promise.all([n.e(58982),n.e(92583)]).then(n.bind(n,58982)),checkbox:()=>n.e(91046).then(n.bind(n,91046)),label:()=>n.e(91142).then(n.bind(n,91142))})}initialize(){this._statistics=new OI(this._statisticsProps),this.addHandles((0,F.watch)((()=>this._statisticsProps),(e=>this._statistics.set(e))))}destroy(){this._statistics=(0,m.SC)(this._statistics)}render(){const e=this.expanded;return(0,Ro.u)("div",{class:this.classes(LP.base,{[LP.disabled]:this.disabled,[LP.expanded]:e}),key:this},this._renderColorIndicator(),(0,Ro.u)("div",{class:LP.header,key:"header"},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),e?(0,Ro.u)("div",{class:LP.content,key:"content"},this._statistics.render()):null)}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return(0,Ro.u)("div",{class:LP.colorIndicator,key:"color-indicator",styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const{expanded:e,messages:t}=this,i=e?t.hideDetails:t.showDetails;return(0,Ro.u)("calcite-action",{appearance:"transparent",bind:this,class:LP.collapseToggle,"data-testid":"legend-toggle",icon:e?"chevron-up":"chevron-down",key:"collapse-toggle",onclick:this._onCollapseToggleClick,scale:"s",text:i,title:i})}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:e,checkboxVisible:t,disabled:i,messages:r}=this;return(0,Ro.u)("calcite-label",{class:LP.label,disabled:i,key:`label-${e.id}`,layout:"inline"},t?this._renderCheckbox():null,(0,PI.f)(e,r))}_renderCheckbox(){const{disabled:e,line:t,messages:i}=this,r=t.visible,n=r?i.hideProfile:i.showProfile,s=(0,II.n)(n,{name:(0,PI.f)(t,i)});return(0,Ro.u)("calcite-checkbox",{checked:r,class:LP.checkbox,disabled:e,title:s,onCalciteCheckboxChange:()=>t.toggleVisibility()})}};(0,i._)([(0,y.Cb)()],LI.prototype,"checkboxVisible",void 0),(0,i._)([(0,y.Cb)()],LI.prototype,"disabled",null),(0,i._)([(0,y.Cb)({nonNullable:!0})],LI.prototype,"effectiveUnits",void 0),(0,i._)([(0,y.Cb)()],LI.prototype,"expanded",void 0),(0,i._)([(0,y.Cb)({nonNullable:!0})],LI.prototype,"line",void 0),(0,i._)([(0,y.Cb)()],LI.prototype,"messages",void 0),(0,i._)([(0,y.Cb)()],LI.prototype,"onExpandedToggle",void 0),(0,i._)([(0,y.Cb)()],LI.prototype,"_statistics",void 0),LI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.components.LegendItem")],LI);let DI=class extends _o.Z{constructor(){super(...arguments),this._expandedLine=null}render(){const{profiles:e,messages:t,effectiveUnits:i,_expandedLine:r}=this;return(0,Ro.u)("div",{class:PP},e.map((n=>(0,Ro.u)(LI,{checkboxVisible:e.length>1,effectiveUnits:i,expanded:n===r,line:n,messages:t,onExpandedToggle:()=>this._onExpandedToggle(n)}))))}_onExpandedToggle(e){this._expandedLine=e===this._expandedLine?null:e}};(0,i._)([(0,y.Cb)()],DI.prototype,"effectiveUnits",void 0),(0,i._)([(0,y.Cb)()],DI.prototype,"messages",void 0),(0,i._)([(0,y.Cb)()],DI.prototype,"profiles",void 0),(0,i._)([(0,y.Cb)()],DI.prototype,"_expandedLine",void 0),DI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.components.Legend")],DI);const NI="esri-unit-select",FI={base:NI,label:`${NI}__label`,select:`${NI}__select`};let UI=class extends _o.Z{constructor(e,t){super(e,t),this._onSelectChange=e=>{this.onChange(e.currentTarget.value)}}loadDependencies(){return(0,Bo.h)({label:()=>n.e(91142).then(n.bind(n,91142)),option:()=>n.e(3343).then(n.bind(n,3343)),select:()=>Promise.all([n.e(49457),n.e(67198)]).then(n.bind(n,67198))})}render(){const{messages:e,options:t,selectLabel:i,value:r,_onSelectChange:n}=this;return(0,Ro.u)("div",{class:FI.base,key:"units"},(0,Ro.u)("calcite-label",{class:FI.label},i,(0,Ro.u)("calcite-select",{class:FI.select,label:i,onCalciteSelectChange:n},t.map((t=>(0,Ro.u)("calcite-option",{key:t,selected:t===r,value:t},(0,Ma.ZO)(t)?e.systems[t]:e.units[t]?.pluralCapitalized))))))}};(0,i._)([(0,y.Cb)()],UI.prototype,"options",void 0),(0,i._)([(0,y.Cb)()],UI.prototype,"onChange",void 0),(0,i._)([(0,y.Cb)()],UI.prototype,"selectLabel",void 0),(0,i._)([(0,y.Cb)()],UI.prototype,"value",void 0),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/core/t9n/Units")],UI.prototype,"messages",void 0),UI=(0,i._)([(0,v.j)("esri.widgets.support.UnitSelect")],UI);let kI=class extends _o.Z{constructor(){super(...arguments),this.messages=null,this._popoverIsOpen=!1,this._referenceElement=null,this._onUniformChartScalingChange=e=>{this.onUniformChartScalingChange(e.currentTarget.checked)}}loadDependencies(){return(0,Bo.h)({action:()=>Promise.all([n.e(58982),n.e(92583)]).then(n.bind(n,58982)),checkbox:()=>n.e(91046).then(n.bind(n,91046)),label:()=>n.e(91142).then(n.bind(n,91142)),popover:()=>Promise.all([n.e(92599),n.e(12495),n.e(58982),n.e(54157)]).then(n.bind(n,54157))})}render(){const{id:e,messages:t,visibleElements:i}=this,{unitSelector:r,uniformChartScalingToggle:n}=i;if(!t||!r&&!n)return(0,Ro.u)("div",{key:`${e}-empty`});const s=this._popoverIsOpen?t.hideSettings:t.showSettings;return(0,Ro.u)("div",{class:UP.base,key:this},(0,Ro.u)("calcite-action",{afterCreate:e=>{this._referenceElement=e},appearance:"transparent","data-testid":"settings-button",icon:"gear",scale:"s",text:s,title:s}),this._referenceElement?(0,Ro.u)("calcite-popover",{autoClose:!0,label:s,placement:"bottom-end",referenceElement:this._referenceElement,onCalcitePopoverClose:()=>{this._popoverIsOpen=!1},onCalcitePopoverOpen:()=>{this._popoverIsOpen=!0}},this._renderPopoverContent()):null)}_renderPopoverContent(){const{unitSelector:e,uniformChartScalingToggle:t}=this.visibleElements;return(0,Ro.u)("div",{class:UP.popoverContent},e?this._renderUnitSelector():null,t?this._renderUniformChartScalingToggle():null)}_renderUnitSelector(){const{messages:e}=this;return(0,Ro.u)(UI,{key:"unit-selector-label",options:this.unitOptions,selectLabel:e?.unitSelectLabel??"",value:this.unit,onChange:this.onUnitChange})}_renderUniformChartScalingToggle(){const{messages:e}=this,t=this.uniformChartScaling,i=e?.[t?"uniformChartScalingDisable":"uniformChartScalingEnable"]??"";return(0,Ro.u)("calcite-label",{class:UP.uniformChartScalingLabel,key:"uniform-chart-scaling-label",layout:"inline"},(0,Ro.u)("calcite-checkbox",{checked:t,class:UP.uniformChartScalingCheckbox,title:i,onCalciteCheckboxChange:this._onUniformChartScalingChange}),e?.uniformChartScalingLabel)}};var zI;(0,i._)([(0,y.Cb)()],kI.prototype,"messages",void 0),(0,i._)([(0,y.Cb)()],kI.prototype,"onUniformChartScalingChange",void 0),(0,i._)([(0,y.Cb)()],kI.prototype,"onUnitChange",void 0),(0,i._)([(0,y.Cb)()],kI.prototype,"uniformChartScaling",void 0),(0,i._)([(0,y.Cb)()],kI.prototype,"unit",void 0),(0,i._)([(0,y.Cb)()],kI.prototype,"unitOptions",void 0),(0,i._)([(0,y.Cb)()],kI.prototype,"visibleElements",void 0),(0,i._)([(0,y.Cb)()],kI.prototype,"_popoverIsOpen",void 0),(0,i._)([(0,y.Cb)()],kI.prototype,"_referenceElement",void 0),kI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile.components.SettingsButton")],kI),function(e){e.Sketch="sketch",e.SketchCancel="sketch-cancel",e.SketchDone="sketch-done",e.Select="select",e.SelectCancel="select-cancel"}(zI||(zI={}));const BI=[{type:zI.Select},{type:zI.Sketch}],VI={[VP.J8.None]:null,[VP.J8.NoValidInput]:"noProfile",[VP.J8.NoVisibleProfiles]:"noProfile",[VP.J8.RefinedButNoChartData]:"noProfile",[VP.J8.TooComplex]:"tooComplex",[VP.J8.UnknownError]:"unknown",[VP.J8.InvalidGeometry]:"invalidGeometry",[VP.J8.InvalidElevationInfo]:"invalidElevationInfo"};let HI=class extends _o.Z{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new RI,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=(0,AP.H)(((e,t,i,r)=>({chart:e,data:t,stationary:i,messages:r}))),this._onZoomOutButtonClick=()=>{this._chart?.zoomOut()},this._onClearButtonClick=()=>{this.viewModel.clear()},e?.viewModel||(this._defaultViewModel=new MI({view:e?.view}),this.viewModel=this._defaultViewModel)}loadDependencies(){return(0,Bo.h)({action:()=>Promise.all([n.e(58982),n.e(92583)]).then(n.bind(n,58982)),button:()=>n.e(14625).then(n.bind(n,14625)),loader:()=>n.e(47940).then(n.bind(n,47940))})}postInitialize(){this.addHandles([(0,F.watch)((()=>({container:this._chartContainer})),(({container:e})=>{this._destroyChart(),null!=e&&this._initializeChart(e)}),F.initial),(0,F.watch)((()=>this._chartUpdateParams),(()=>this._updateChart(this._chartUpdateParams)),F.initial)])}destroy(){this._destroyChart(),null!=this._defaultViewModel&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get input(){return this.viewModel.input}set input(e){this.viewModel.input=e}get profiles(){return this.viewModel.profiles}set profiles(e){this.viewModel.profiles=e}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(e){this.viewModel.unitOptions=e}get unit(){return this.viewModel.unit}set unit(e){this.viewModel.unit=e}get icon(){return"altitude"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}get test(){return{chart:this._chart}}get _selectButtonVisible(){return!0===this.visibleElements.selectButton&&this.viewModel.selectAvailable}get _chartUpdateParams(){const e=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,null==e||e.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _profilesArray(){return this.profiles.toArray()}render(){const{viewModel:e,visible:t}=this;return(0,Ro.u)("div",{"aria-label":this.messages.widgetLabel,class:this.classes({[OP.base]:t,[Eo.z.widget]:t,[Eo.z.panel]:t,[Eo.z.widgetDisabled]:t&&"disabled"===e.state,[OP.refined]:1===e.progress}),key:this},(0,Ro.u)("div",{bind:this,key:"content-wrapper"},t?this._renderContentForState():null))}_renderContentForState(){switch(this.viewModel.state){case VP.dd.Ready:return this._renderContentForReadyState();case VP.dd.Selecting:return this._renderContentForSelectingState();case VP.dd.Creating:return this._renderContentForCreatingState();case VP.dd.Selected:return this._renderContentForSelectedState();case VP.dd.Created:return this._renderContentForCreatedState();case VP.dd.Disabled:return this._renderContentForReadyState()}}_renderContentForReadyState(){const{messages:e,visibleElements:t,_selectButtonVisible:i}=this,{sketchButton:r}=t;let n;return n=r&&i?e.readyPrompt:r?e.readyPromptCreateOnly:i?e.readyPromptSelectOnly:e.errors?.noProfile,this._renderContent({prompt:n,chart:!1,actions:BI})}_renderContentForSelectingState(){const{view:e}=this;if(null==e)return null;const t=this.messages[`selectingPrompt-${e.type}`];return this._renderContent({prompt:t,chart:!1,actions:[{type:zI.SelectCancel}]})}_renderContentForCreatingState(){const{view:e,viewModel:t}=this;if(null==e)return null;const i=t.hasVertices?[{type:zI.SketchCancel},{type:zI.SketchDone,disabled:!t.tool.interaction.canStopCreating}]:[{type:zI.Select},{type:zI.Sketch,disabled:!0}];if(t.errorState===VP.J8.NoValidInput){const t=this.messages[`creatingPrompt-${e.type}`];return this._renderContent({chart:!1,actions:i,prompt:t})}const r=this._getErrorMessage();return r?this._renderContent({chart:!1,actions:i,prompt:r}):this._renderContent({chart:!0,actions:i})}_renderContentForSelectedState(){const e=this._getErrorMessage();return e?this._renderContent({chart:!1,actions:BI,prompt:e}):this._renderContent({chart:!0,actions:BI})}_renderContentForCreatedState(){const e=this._getErrorMessage();return e?this._renderContent({chart:!1,actions:BI,prompt:e}):this._renderContent({chart:!0,actions:BI})}_getErrorMessage(){const e=VI[this.viewModel.errorState];return e?this.messages?.errors?.[e]:null}_renderContent(e){const t=null!=e.prompt?this._renderPrompt(e.prompt):e.chart&&this._renderChart(),{viewModel:i}=this,r=null!=i.input;return(0,Ro.u)(Ro.D,null,(0,Ro.u)("header",{class:OP.header,key:"header"},this._zoomOutButtonVisible?this._renderZoomOutButton():null,this.visibleElements.clearButton&&r?this._renderClearButton():null,this.visibleElements.settingsButton?(0,Ro.u)(kI,{messages:this.messages,uniformChartScaling:i.uniformChartScaling,unit:i.unit,unitOptions:i.unitOptions,visibleElements:this.visibleElements,onUniformChartScalingChange:e=>i.uniformChartScaling=e,onUnitChange:e=>i.unit=e}):null),(0,Ro.u)("div",{class:OP.mainContainer,key:"main-container"},t),this.visibleElements.legend?(0,Ro.u)(DI,{effectiveUnits:i.effectiveUnits,messages:this.messages,profiles:this._profilesArray}):null,this._renderActions(e))}_renderZoomOutButton(){const e=this.messages.zoomOut;return(0,Ro.u)("calcite-action",{appearance:"transparent",class:OP.zoomOutButton,"data-testid":"zoom-out-button",icon:"magnifying-glass-minus",key:"zoom-out",onclick:this._onZoomOutButtonClick,scale:"s",text:e,title:e})}_renderClearButton(){const e=this.messages.clearProfile;return(0,Ro.u)("calcite-action",{appearance:"transparent",class:OP.clearButton,"data-testid":"clear-button",icon:"trash",key:"clear-profile",onclick:this._onClearButtonClick,scale:"s",text:e,title:e})}_renderPrompt(e){return[(0,Ro.u)("div",{bind:this,class:OP.promptContainer,key:"prompt-container"},(0,Ro.u)("p",null,e))]}_renderChart(){if(!this.visibleElements.chart)return(0,Ro.u)("div",{class:OP.chartContainer,key:"empty-chart-container"});const{chartData:e,progress:t}=this.viewModel,i=this._chartIsRefined||this._canRenderChart(),r=null!=e&&t<1;return i?(0,Ro.u)(Ro.D,null,this._renderSpinner({size:i?"small":"large",visible:r}),(0,Ro.u)("div",{afterCreate:this._onChartContainerUpdate,afterRemoved:this._onChartContainerRemoved,afterUpdate:this._onChartContainerUpdate,bind:this,class:OP.chartContainer,key:"chart-container"})):(0,Ro.u)(Ro.D,null,this._renderSpinner({size:"large",visible:r}),(0,Ro.u)("div",{class:OP.chartContainer,key:"chart-container-empty"}))}_renderSpinner(e){const t="small"===e.size,i=e.visible??!0;return(0,Ro.u)("calcite-loader",{class:this.classes(OP.chartSpinner,t&&OP.chartSpinnerSmall,i&&OP.chartSpinnerVisible),"data-testid":"chart-spinner",inline:t,key:"spinner",label:"",scale:"s"})}_canRenderChart(){const e=this.viewModel.chartData;if(null==e)return!1;if(!this.viewModel.inputIsSketched)return e.refined;let t=0;for(const{samples:i}of e.lines)t+=null!=i?i.length:0;return e.refined||t<=(0,VP.iE)().largeChartSamples}_renderActions({actions:e}){const t=e.map((e=>{switch(e.type){case zI.Sketch:return this.visibleElements.sketchButton&&this._renderAction({action:e,className:OP.sketchButton,label:this.messages.sketchButtonLabel,onClick:this._onSketchButtonClick,primary:!0});case zI.SketchCancel:return this.visibleElements.sketchButton&&this._renderAction({action:e,onClick:this._onCancelButtonClick,className:OP.sketchCancelButton,label:this.messagesCommon.cancel,primary:!1});case zI.SketchDone:return this.visibleElements.sketchButton&&this._renderAction({action:e,onClick:this._onDoneButtonClick,className:OP.sketchDoneButton,label:this.messagesCommon.done,primary:!0});case zI.Select:return this._selectButtonVisible&&this._renderAction({action:e,onClick:this._onSelectButtonClick,className:OP.selectButton,label:this.messages.selectButtonLabel,primary:!1});case zI.SelectCancel:return this._selectButtonVisible&&this._renderAction({action:e,onClick:this._onCancelButtonClick,className:OP.selectCancelButton,label:this.messagesCommon.cancel,primary:!1})}})).filter(Boolean);return t.length?(0,Ro.u)("footer",{class:OP.footer,key:"footer"},t):null}_renderAction({action:e,className:t,label:i,onClick:r,primary:n}){return(0,Ro.u)("calcite-button",{appearance:n?"solid":"outline-fill",bind:this,class:this.classes(OP.actionButton,t),disabled:e.disabled,key:`action-${e.type}`,onclick:r},i)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_updateChart(e){const{data:t,chart:i,messages:r,stationary:n}=e;null!=i&&null!=r&&n&&this._canRenderChart()&&(i.update(e),this._chartIsRefined=null!=t&&t.refined)}_onChartContainerUpdate(e){this._chartContainer=e}_onChartContainerRemoved(){this._chartContainer=null}_initializeChart(e){(0,m.IM)(this._chartInitTask),this._chartInitTask=(0,be.vr)((async t=>{const{createChart:i}=await Promise.all([n.e(3027),n.e(83711),n.e(49484),n.e(20155),n.e(99698)]).then(n.bind(n,99698));(0,g.k_)(t);const r=await i({container:e,abortOptions:{signal:t},onRangeChange:(e,t)=>{this._zoomOutButtonVisible=1!==e||1!==t},onCursorPositionChange:e=>{this.viewModel.hoveredChartPosition=e}});if(t.aborted)throw(0,m.SC)(r),(0,g.zE)();this._chart=r,this._updateChart(this._chartUpdateParams)}))}_destroyChart(){this._chartInitTask=(0,m.IM)(this._chartInitTask),this._chart=(0,m.SC)(this._chart),this._chartIsRefined=!1}};(0,i._)([(0,y.Cb)({type:MI})],HI.prototype,"viewModel",void 0),(0,i._)([(0,y.Cb)()],HI.prototype,"view",null),(0,i._)([(0,y.Cb)()],HI.prototype,"input",null),(0,i._)([(0,y.Cb)()],HI.prototype,"profiles",null),(0,i._)([(0,y.Cb)()],HI.prototype,"unitOptions",null),(0,i._)([(0,y.Cb)()],HI.prototype,"unit",null),(0,i._)([(0,y.Cb)({type:RI,nonNullable:!0})],HI.prototype,"visibleElements",void 0),(0,i._)([(0,y.Cb)()],HI.prototype,"icon",null),(0,i._)([(0,y.Cb)()],HI.prototype,"label",null),(0,i._)([(0,y.Cb)()],HI.prototype,"visible",null),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/widgets/ElevationProfile/t9n/ElevationProfile")],HI.prototype,"messages",void 0),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/t9n/common")],HI.prototype,"messagesCommon",void 0),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/core/t9n/Units")],HI.prototype,"messagesUnits",void 0),(0,i._)([(0,y.Cb)()],HI.prototype,"_chartContainer",void 0),(0,i._)([(0,y.Cb)()],HI.prototype,"_chart",void 0),(0,i._)([(0,y.Cb)()],HI.prototype,"_chartInitTask",void 0),(0,i._)([(0,y.Cb)()],HI.prototype,"_chartIsRefined",void 0),(0,i._)([(0,y.Cb)()],HI.prototype,"_zoomOutButtonVisible",void 0),(0,i._)([(0,y.Cb)()],HI.prototype,"_selectButtonVisible",null),(0,i._)([(0,y.Cb)()],HI.prototype,"_chartUpdateParams",null),(0,i._)([(0,y.Cb)()],HI.prototype,"_chartMessages",null),(0,i._)([(0,y.Cb)()],HI.prototype,"_profilesArray",null),HI=(0,i._)([(0,v.j)("esri.widgets.ElevationProfile")],HI);const GI=HI;let jI=class extends P.Z{constructor(e){super(e),this._basemapCache={},this._loadingProjectionEngine=!1,this.nextBasemap=Z("hybrid",this._basemapCache),this.view=null}initialize(){(0,F.watch)((()=>this.nextBasemap),(e=>{e&&!e.loaded&&e.load().catch((()=>{}))}),F.initial)}destroy(){this.view=null,j(this._basemapCache),this._basemapCache=null}get _nextBasemapSpatialReferenceTask(){return(0,H.Us)(this.view,this.nextBasemap)}get _viewSpatialReferenceLocked(){const{view:e}=this;return!e||!("spatialReferenceLocked"in e)||e.spatialReferenceLocked}get activeBasemap(){return Z(this.view?.map?.basemap??"topo-vector",this._basemapCache)}castNextBasemap(e){return Z(e,this._basemapCache)}get state(){const{view:e}=this;if(!e?.ready)return"disabled";if(this._nextBasemapSpatialReferenceTask.updating)return"disabled";const{spatialReference:t}=this._nextBasemapSpatialReferenceTask;return this._viewSpatialReferenceLocked&&null!=t&&!e.spatialReference.equals(t)?"incompatible-next-basemap":this._loadingProjectionEngine?"loading":"ready"}async toggle(){const{activeBasemap:e,nextBasemap:t,state:i,view:r}=this;if(!r||"disabled"===i||"incompatible-next-basemap"===i)return;const n=this._viewSpatialReferenceLocked;if(!n){if(await(0,F.whenOnce)((()=>!this._nextBasemapSpatialReferenceTask.updating)),t!==this.nextBasemap||e!==this.activeBasemap)return;const{spatialReference:i}=this._nextBasemapSpatialReferenceTask;if(null==i||(0,Le.fS)(r.spatialReference,i)||(0,te.isLoaded)()||(0,te.canProjectWithoutEngine)(r.spatialReference,i)||(this._loadingProjectionEngine=!0,await(0,te.load)(),this._loadingProjectionEngine=!1),t!==this.nextBasemap||e!==this.activeBasemap)return}r.map.basemap=t,n||null==this._nextBasemapSpatialReferenceTask.spatialReference||(0,Le.fS)(r.spatialReference,this._nextBasemapSpatialReferenceTask.spatialReference)||(r.spatialReference=this._nextBasemapSpatialReferenceTask.spatialReference),this.nextBasemap=e}static getThumbnailUrl(e){return(0,H.Qs)(e)}};(0,i._)([(0,y.Cb)()],jI.prototype,"_loadingProjectionEngine",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],jI.prototype,"_nextBasemapSpatialReferenceTask",null),(0,i._)([(0,y.Cb)({readOnly:!0})],jI.prototype,"_viewSpatialReferenceLocked",null),(0,i._)([(0,y.Cb)({readOnly:!0})],jI.prototype,"activeBasemap",null),(0,i._)([(0,y.Cb)()],jI.prototype,"nextBasemap",void 0),(0,i._)([(0,D.p)("nextBasemap")],jI.prototype,"castNextBasemap",null),(0,i._)([(0,y.Cb)({readOnly:!0})],jI.prototype,"state",null),(0,i._)([(0,y.Cb)()],jI.prototype,"view",void 0),(0,i._)([(0,y.Cb)()],jI.prototype,"toggle",null),jI=(0,i._)([(0,v.j)("esri.widgets.BasemapToggle.BasemapToggleViewModel")],jI);const ZI=jI,qI="esri-basemap-toggle",WI="esri-basemap-thumbnail",$I={base:qI,secondaryBasemapImage:`${qI}__image--secondary`,container:`${WI} ${qI}__container`,image:`${WI}__image ${qI}__image`,imageLoading:`${qI}__image--loading`,overlay:`${WI}__overlay ${qI}__image-overlay`,title:`${WI}__title ${qI}__title`,overlayScrim:`${WI}__overlay-scrim`};function YI(e){const t=(0,H.Qs)(e);return t?{backgroundImage:"url("+t+")"}:{backgroundImage:""}}const JI={title:!1};let XI=class extends _o.Z{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new ZI,this.visibleElements={...JI},this.toggle=()=>this.viewModel.toggle(),(0,zt.Pq)(f.Z.getLogger(this),"Basemap Toggle","arcgis-basemap-toggle",{version:"4.32"})}loadDependencies(){return(0,Bo.h)({button:()=>n.e(14625).then(n.bind(n,14625)),icon:()=>n.e(45748).then(n.bind(n,45748)),scrim:()=>n.e(26685).then(n.bind(n,26685))})}get activeBasemap(){return this.viewModel.activeBasemap}get icon(){return"layer-basemap"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get nextBasemap(){return this.viewModel.nextBasemap}set nextBasemap(e){this.viewModel.nextBasemap=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...JI,...e}}render(){const e=this.viewModel,t="disabled"===e.state?null:e.activeBasemap,i="disabled"===e.state?null:e.nextBasemap,r="loading"===e.state,n="incompatible-next-basemap"===e.state,s=i?.title??"",o=i&&"loaded"!==i.loadStatus;let a;const l=this.visibleElements.title&&s,c=n;return(l||c)&&(a=(0,Ro.u)("div",{class:$I.overlay,key:"overlay"},l?(0,Ro.u)("span",{class:$I.title,title:s},s):null,c?(0,Ro.u)("calcite-scrim",{class:$I.overlayScrim,title:this.messages.incompatibleSpatialReference},(0,Ro.u)("calcite-icon",{icon:"exclamation-mark-triangle"})):null)),(0,Ro.u)("div",{class:this.classes($I.base,Eo.z.widget)},(0,Ro.u)("calcite-button",{appearance:"transparent","data-basemap-id":i?i.id:"",disabled:n,kind:"neutral",label:this.label,onclick:()=>{this.toggle()},title:this.label},(0,Ro.u)("div",{class:this.classes($I.container,$I.secondaryBasemapImage)},(0,Ro.u)("div",{class:$I.image,styles:YI(t)})),(0,Ro.u)("div",{class:$I.container},(0,Ro.u)("div",{class:this.classes($I.image,o?$I.imageLoading:null),styles:YI(i)},o||r?(0,Ro.u)("calcite-scrim",null,(0,Ro.u)("span",{"aria-hidden":"true",class:Eo.z.loaderAnimation,role:"presentation"})):null),a)))}};(0,i._)([(0,y.Cb)({readOnly:!0})],XI.prototype,"activeBasemap",null),(0,i._)([(0,y.Cb)()],XI.prototype,"icon",null),(0,i._)([(0,y.Cb)()],XI.prototype,"label",null),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/widgets/BasemapToggle/t9n/BasemapToggle")],XI.prototype,"messages",void 0),(0,i._)([(0,y.Cb)()],XI.prototype,"nextBasemap",null),(0,i._)([(0,y.Cb)()],XI.prototype,"view",null),(0,i._)([(0,y.Cb)({type:ZI})],XI.prototype,"viewModel",void 0),(0,i._)([(0,y.Cb)()],XI.prototype,"visibleElements",void 0),(0,i._)([(0,D.p)("visibleElements")],XI.prototype,"castVisibleElements",null),XI=(0,i._)([(0,v.j)("esri.widgets.BasemapToggle")],XI);const KI=XI;var QI=n(97949);async function eL(e,t={}){const{basemap:i,view:r}=e;await i.load(t),function(e){if(0===e.baseLayers.length&&0===e.referenceLayers.length)return;const t=e.baseLayers.concat(e.referenceLayers).toArray().filter((e=>!(0,z.fE)(e))).map((e=>function(e){return new c.Z("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})}(e)));if(t.length)throw t[0]}(i),await async function(e,t,i){if(0===e.baseLayers.length)return;const r=e.baseLayers.at(0);if((0,z.fg)(r)){try{await r.load(i)}catch(e){const t="basemap-compatibility:unknown-error",i="Unknown basemap compatibility error",{name:r=t,message:n=i,details:s}=e;throw new c.Z(r,n,s)}!function(e,t){const i=t.state.viewingMode;if(!i)return;let r,n;if("wmts"===e?.type){const s=(0,tw.O1)(e,t.spatialReference,i);if(null==s.tileInfo)throw new c.Z("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");r=s.tileInfo,n=s.fullExtent}else r=e.tileInfo,n=e.fullExtent;if(null==r)return;if(!(0,gP.D)(r.spatialReference,i))throw new c.Z(`basemapgalleryitem:spatial-reference-unsupported-${(0,$t.M7)(i)}`,`Basemap spatial reference is unsupported in ${(0,$t.M7)(i)} mode`);const s="vector-tile"===e?.type?r.getCompatibleForVTL(256):null;if(i===$t.JY.Global){let t=(0,tw.er)(r,n,null,i);if(t&&"vector-tile"===e?.type&&null!=n&&s&&!(0,tw.er)(s,n,null,i)&&(t=null),t){const e=r.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new c.Z(`basemapgalleryitem:tiling-scheme-unsupported-${e}-global`,"Basemap tiling scheme is unsupported in global mode",{error:t})}}else if(XC.t.checkUnsupported(r))throw new c.Z("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const o=t.basemapTerrain?.tilingScheme;if(o&&!o.compatibleWith(r)&&("vector-tile"!==e?.type||!s||!o.compatibleWith(s)))throw new c.Z("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}(r,t)}}(i,r,t),(0,g.k_)(t)}async function tL(e,t={}){const{basemap:i,view:r}=e;(0,g.k_)(t);const n=i.baseLayers.find((e=>"unknown"===e.type))?.loadError;if(null!=n)throw n;if(!r||"spatialReferenceLocked"in r&&!r.spatialReferenceLocked)return;if(await i.load(t),(0,g.k_)(t),0===i.baseLayers.length)return;const s=i.baseLayers.at(0);if(!(0,z.iC)(s))return;if(i.spatialReference){if(r.spatialReference.equals(i.spatialReference))return;iL()}await s.load(t),(0,g.k_)(t);const o=(("supportedSpatialReferences"in s?s.supportedSpatialReferences:null)||["tileInfo"in s?s.tileInfo?.spatialReference:null]).filter(Xe.pC);0!==o.length&&o.every((e=>!r.spatialReference.equals(e)))&&iL()}function iL(){throw new c.Z("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}let rL=class extends(zi.Z.IdentifiableMixin(P.Z)){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.addHandles([(0,F.watch)((()=>this.basemap?.loadStatus),e),(0,F.watch)((()=>this.compatibilityFunction),e),(0,F.watch)((()=>this.view&&"basemapTerrain"in this.view&&this.view.basemapTerrain?.tilingScheme),e),(0,F.watch)((()=>this.view?.ready),e),(0,F.watch)((()=>this.view?.spatialReference),e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return(0,H.Us)(this.view,this.basemap)}set basemap(e){e&&e.load().catch((()=>{})),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){this._cancelRefresh(),this._set("state","loading");const e=this.basemap?.loadStatus;if("loaded"!==e&&"failed"!==e)return;if(!this.compatibilityFunction)return void("loaded"===e?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const t=new AbortController,{signal:i}=t;this.compatibilityFunction(this,{signal:i}).then((()=>(0,F.whenOnce)((()=>!this._spatialReferenceTask.updating),i))).then((()=>{this._set("state","ready"),this._set("error",null)})).catch((e=>{(0,g.D_)(e)||(this._set("state","error"),this._set("error",e))})),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};(0,i._)([(0,y.Cb)({readOnly:!0})],rL.prototype,"_spatialReferenceTask",null),(0,i._)([(0,y.Cb)()],rL.prototype,"basemap",null),(0,i._)([(0,y.Cb)()],rL.prototype,"compatibilityFunction",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],rL.prototype,"error",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],rL.prototype,"spatialReference",null),(0,i._)([(0,y.Cb)({readOnly:!0})],rL.prototype,"state",void 0),(0,i._)([(0,y.Cb)()],rL.prototype,"view",void 0),rL=(0,i._)([(0,v.j)("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],rL);const nL=rL,sL=o.Z.ofType(r.default);let oL=class extends P.Z{constructor(e){super(e),this.basemaps=new sL}destroy(){this.basemaps.forEach((e=>e.destroy()))}get state(){return"ready"}refresh(){}};(0,i._)([(0,y.Cb)({type:sL})],oL.prototype,"basemaps",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],oL.prototype,"state",null),oL=(0,i._)([(0,v.j)("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],oL);const aL=oL;var lL=n(93968);const cL=o.Z.ofType(r.default);let uL=class extends(d.Z.LoadableMixin(Ae.Z.EsriPromiseMixin(aL))){constructor(e){super(e),this._lastPortalBasemapFetchController=null,this.basemaps=new cL,this.filterFunction=null,this.portal=lL.Z.getDefault(),this.query=null,this.updateBasemapsCallback=null,this.viewType=null}initialize(){this.addHandles((0,F.watch)((()=>[this.filterFunction,this.loadStatus,this.portal?.basemapGalleryGroupQuery,this.portal?.basemapGalleryGroupQuery3D,this.portal?.user,this.query,this.updateBasemapsCallback]),(()=>this.refresh()),F.initial))}destroy(){this.filterFunction=null,this.portal=null,this.basemaps.forEach((e=>e.destroy()))}get state(){return"not-loaded"===this.loadStatus?"not-loaded":"loading"===this.loadStatus||this._lastPortalBasemapFetchController?"loading":"ready"}load(e){return this.addResolvingPromise(this.portal.load(e)),Promise.resolve(this)}async refresh(){if("loaded"!==this.loadStatus)return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const e=this.portal,t=new AbortController;this._lastPortalBasemapFetchController=t,this.notifyChange("state");try{const i=await e.fetchBasemaps(this._toQueryString(this.query),{signal:t.signal,include3d:"3d"===this.viewType||void 0});await this._updateBasemaps(i)}catch(e){if((0,g.D_)(e))throw e;f.Z.getLogger(this).warn(new c.Z("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:e})),await this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(e){return e&&"string"!=typeof e?Object.keys(e).map((t=>`${t}:${e[t]}`)).join(" AND "):e}async _updateBasemaps(e=[]){let t=await this._filterBasemaps(e);t=this.updateBasemapsCallback?await this.updateBasemapsCallback(t):t,this.basemaps.removeAll(),this.basemaps.addMany(t)}async _filterBasemaps(e){if(!this.filterFunction)return e;const t=e.map(this.filterFunction),i=await Promise.all(t);return e.filter(((e,t)=>i[t]))}};(0,i._)([(0,y.Cb)({readOnly:!0,type:cL})],uL.prototype,"basemaps",void 0),(0,i._)([(0,y.Cb)()],uL.prototype,"filterFunction",void 0),(0,i._)([(0,y.Cb)({type:lL.Z})],uL.prototype,"portal",void 0),(0,i._)([(0,y.Cb)()],uL.prototype,"query",void 0),(0,i._)([(0,y.Cb)({readOnly:!0})],uL.prototype,"state",null),(0,i._)([(0,y.Cb)()],uL.prototype,"updateBasemapsCallback",void 0),(0,i._)([(0,y.Cb)()],uL.prototype,"viewType",void 0),uL=(0,i._)([(0,v.j)("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],uL);const hL=uL,dL=o.Z.ofType(nL);let pL=class extends d.Z{constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new dL,this.source=new hL,this.view=null}initialize(){const e=()=>this._recreateItems();this.addHandles([(0,F.watch)((()=>"ready"===this.state?this.compatibilityFunction:null),(()=>this._updateItems())),(0,F.on)((()=>this.source?.basemaps),"change",e,{onListenerAdd:e}),(0,F.when)((()=>this.view),(()=>{this.source instanceof hL&&(this.source.viewType=this.view?.type)}),{once:!0})])}destroy(){const e=this.source.basemaps.find((e=>e===this.activeBasemap));e&&this.source.basemaps.remove(e),this.source?.destroy()}get activeBasemap(){return this.view?.map?.basemap??null}set activeBasemap(e){const t=this.view;if(!t?.map)return;if(!e||!t.ready)return t.map.basemap=e,void this._clearOverride("activeBasemap");const i=e.spatialReference||this.items?.find((t=>this.basemapEquals(e,t.basemap)))?.spatialReference;if(i&&"spatialReferenceLocked"in t&&!t.spatialReferenceLocked){const r=t.spatialReference;if(null!=i&&!(0,Le.fS)(r,i)&&!(0,te.canProjectWithoutEngine)(t.spatialReference,i)&&!(0,te.isLoaded)())return this._override("activeBasemap",e),this._loadingProjectionEngine=!0,void(0,te.load)().then((()=>{this._get("activeBasemap")===e&&(t.map.basemap=e,t.spatialReference=i,this._clearOverride("activeBasemap"))}),(()=>{})).then((()=>{this._loadingProjectionEngine=!1}));t.map.basemap=e,this._clearOverride("activeBasemap"),null==i||(0,Le.fS)(t.spatialReference,i)||(t.spatialReference=i)}else t.map.basemap=e,this._clearOverride("activeBasemap")}castActiveBasemap(e){return Z(e)}get activeBasemapIndex(){const{state:e,activeBasemap:t}=this;return"ready"!==e?-1:this._findBasemapIndex(t)}get compatibilityFunction(){return"3d"===this.view?.type?eL:tL}set compatibilityFunction(e){this._overrideIfSome("compatibilityFunction",e)}castSource(e){return Array.isArray(e)||o.Z.isCollection(e)?new aL({basemaps:Array.isArray(e)?new o.Z(e):e}):function(e){return e&&"esri.portal.Portal"===e.declaredClass}(e)?new hL({portal:e}):function(e){return e&&!(e instanceof hL)&&(!!e.portal||!!e.query)}(e)?new hL(e):function(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}(e)?e:null}get state(){return this.view?.ready&&this.source?(0,QI.T)(this.view)&&!this.view.inGeographicLayout?"unsupported":this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return(0,H.Bj)(e,t)}refresh(){this._recreateItems()}load(){return this.loadSource()}loadSource(e){return this.addResolvingPromise(d.Z.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_findBasemapIndex(e){const{items:t}=this,i=t.findIndex((t=>t.basemap===e));return-1===i?t.findIndex((t=>this.basemapEquals(t.basemap,e))):i}_recreateItems(){const e=this.source?.basemaps??[],{view:t,compatibilityFunction:i}=this,r=new Map(this.items.map((e=>[e.basemap,e]))),n=e.map((e=>{const n=r.get(e);return n?(r.delete(e),n):new nL({basemap:e,compatibilityFunction:i,view:t})}));this.items.removeAll(),this.items.addMany(n),r.forEach((e=>e.destroy()))}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};(0,i._)([(0,y.Cb)()],pL.prototype,"_loadingProjectionEngine",void 0),(0,i._)([(0,y.Cb)({type:r.default})],pL.prototype,"activeBasemap",null),(0,i._)([(0,D.p)("activeBasemap")],pL.prototype,"castActiveBasemap",null),(0,i._)([(0,y.Cb)({readOnly:!0})],pL.prototype,"activeBasemapIndex",null),(0,i._)([(0,y.Cb)()],pL.prototype,"compatibilityFunction",null),(0,i._)([(0,y.Cb)({readOnly:!0,type:dL})],pL.prototype,"items",void 0),(0,i._)([(0,y.Cb)()],pL.prototype,"source",void 0),(0,i._)([(0,D.p)("source")],pL.prototype,"castSource",null),(0,i._)([(0,y.Cb)({readOnly:!0})],pL.prototype,"state",null),(0,i._)([(0,y.Cb)()],pL.prototype,"view",void 0),pL=(0,i._)([(0,v.j)("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],pL);const fL=pL,mL="esri-basemap-gallery",gL={base:mL,sourceLoading:`${mL}--source-loading`,loader:`${mL}__loader`,item:`${mL}__item`,itemContainer:`${mL}__item-container`,itemContent:`${mL}__item-content`,itemTitle:`${mL}__item-title`,itemTagsContainer:`${mL}__item-tags-container`,itemThumbnail:`${mL}__item-thumbnail`,selectedItem:`${mL}__item--selected`,itemError:`${mL}__item--error`};var yL=n(62199);let _L=class extends _o.Z{constructor(e,t){super(e,t),this.disabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new fL,this._focusBasemapItemEnabled=!1,(0,zt.Pq)(f.Z.getLogger(this),"Basemap Gallery","arcgis-basemap-gallery",{version:"4.32"})}initialize(){this.addHandles((0,F.when)((()=>this.source),(()=>this.viewModel.loadSource()),{sync:!0,initial:!0}))}loadDependencies(){return(0,Bo.h)({scrim:()=>n.e(26685).then(n.bind(n,26685)),chip:()=>n.e(83982).then(n.bind(n,83982))})}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get icon(){return"basemap"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e="loading"===this.source.state,t=this.disabled||"disabled"===this.viewModel.state,i={[gL.sourceLoading]:e,[Eo.z.disabled]:t};return(0,Ro.u)("div",{class:this.classes(gL.base,Eo.z.widget,Eo.z.panel,i),key:"container"},this._getContext())}_getContext(){if("unsupported"===this.viewModel.state)return(0,Ro.u)("div",{class:Eo.z.empty,key:"empty-message"},(0,Ro.u)(yL.X,{level:this.headingLevel},this.messages.unsupported));if("loading"===this.source.state)return(0,Ro.u)("div",{class:gL.loader,key:"loader"});const e=this.viewModel.items;return e.length>0?(0,Ro.u)("ul",{"aria-disabled":this.disabled,"aria-label":this.label,bind:this,class:gL.itemContainer,key:"item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},e.map(((e,t)=>this._renderBasemapGalleryItem(e,t))).toArray()):(0,Ro.u)("div",{class:Eo.z.empty,key:"empty-message"},(0,Ro.u)(yL.X,{level:this.headingLevel},this.messages.noBasemaps))}_getRoundRobinIndex(e,t){return(e+t)%t}_handleKeyDown(e){const{key:t}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t))return;e.preventDefault();const{items:i,activeBasemapIndex:r}=this.viewModel,n="ArrowUp"===t||"ArrowLeft"===t?this._getRoundRobinIndex(Math.max(r-1,-1),i.length):this._getRoundRobinIndex(r+1,i.length),s=i.at(n);"ready"===s?.state&&(this.viewModel.activeBasemap=s.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&0===e.tabIndex&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){const t=e.currentTarget["data-item"];"ready"===t.state&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e,t){const i=(0,H.Qs)(e.basemap)||(0,vA.V)("esri/themes/base/images/basemap-toggle-64.svg"),r=e.basemap.title,n=e.basemap.portalItem?.snippet,s=e.error?.message||n||r,{viewModel:{state:o,activeBasemapIndex:a}}=this,l=this.disabled||"disabled"===o,c=a===t,u=c||-1===a&&0===t?0:-1,h="loading"===o,d={[gL.selectedItem]:c,[gL.itemError]:"error"===e.state},p=`basemapgallery-item-${e.uid}`;return(0,Ro.u)("li",{afterUpdate:this._focusBasemapItem,"aria-checked":c.toString(),"aria-disabled":l.toString(),"aria-labelledby":p,bind:this,class:this.classes(gL.item,d),"data-item":e,key:e.uid,onclick:this._handleClick,onkeydown:this._handleClick,role:"radio",tabIndex:u,title:s},(0,Ro.u)("img",{alt:"",class:gL.itemThumbnail,src:i}),(0,Ro.u)("div",{class:gL.itemContent,key:"content"},(0,Ro.u)("div",{class:gL.itemTitle,key:"title"},(0,Ro.u)("span",{id:p},r)),(0,H.iG)(e.basemap)?this._renderTags(e.basemap):null),"loading"===e.state||c&&h?(0,Ro.u)("calcite-scrim",null,(0,Ro.u)("span",{"aria-hidden":"true",class:Eo.z.loaderAnimation,key:"loader",role:"presentation"})):null)}_renderTags(e){return(0,Ro.u)("div",{class:gL.itemTagsContainer,key:"tag"},this._render3DTag(),(0,H.vZ)(e)?this._renderBetaTag():null)}_render3DTag(){const{messages:e}=this;return(0,Ro.u)("calcite-chip",{key:"tag-3d",label:e.tag3D,scale:"s"},this.messages.tag3D)}_renderBetaTag(){const{messages:e}=this;return(0,Ro.u)("calcite-chip",{appearance:"outline-fill",key:"tag-beta",label:e.tagBeta,scale:"s"},this.messages.tagBeta)}};(0,i._)([(0,y.Cb)()],_L.prototype,"activeBasemap",null),(0,i._)([(0,y.Cb)()],_L.prototype,"disabled",void 0),(0,i._)([(0,y.Cb)()],_L.prototype,"headingLevel",void 0),(0,i._)([(0,y.Cb)()],_L.prototype,"icon",null),(0,i._)([(0,y.Cb)()],_L.prototype,"label",null),(0,i._)([(0,y.Cb)(),(0,Ao.H)("esri/widgets/BasemapGallery/t9n/BasemapGallery")],_L.prototype,"messages",void 0),(0,i._)([(0,y.Cb)()],_L.prototype,"source",null),(0,i._)([(0,y.Cb)()],_L.prototype,"view",null),(0,i._)([(0,y.Cb)()],_L.prototype,"viewModel",void 0),(0,i._)([(0,y.Cb)()],_L.prototype,"_focusBasemapItemEnabled",void 0),(0,i._)([(0,Mo.h)()],_L.prototype,"_handleClick",null),_L=(0,i._)([(0,v.j)("esri.widgets.BasemapGallery")],_L);const vL=_L;var bL=n(16358),wL=n(92955);window.esri={core:{Map:X,config:t.Z,views:{MapView:Ca,SceneView:MP},geometry:{Point:wi.Z,Extent:Oe.Z},widgets:{Attribution:Lo,BasemapToggle:KI,BasemapGallery:vL,Compass:Ho,ElevationProfile:GI},layers:{VectorTileLayer:bL.default,SceneLayer:wL.default,GraphicsLayer:mI.Z},Basemap:r.default,intl:no,reactiveUtils:F}},window.loadGraphicsLayer=()=>new Promise((function(e){n.e(66254).then(n.bind(n,66254)).then((t=>{t.load(),e()}))})),window.loadSceneLayer=()=>new Promise((function(e){n.e(74211).then(n.bind(n,74211)).then((t=>{t.load(),e()}))})),window.loadFeatureLayer=()=>new Promise((function(e){Promise.all([n.e(41984),n.e(63789),n.e(12926),n.e(53529)]).then(n.bind(n,92469)).then((t=>{t.load(),e()}))})),window.loadMapImageLayer=()=>new Promise((function(e){Promise.all([n.e(96027),n.e(2769),n.e(22570)]).then(n.bind(n,24211)).then((t=>{t.load(),e()}))}))})()})();