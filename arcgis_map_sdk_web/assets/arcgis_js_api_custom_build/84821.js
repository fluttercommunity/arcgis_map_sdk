"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[84821],{10739:(e,t,n)=>{n.d(t,{x:()=>r});var i=n(82308),s=n(7062),a=n(82366);class r extends s.a{constructor(e){super({...e,constraint:new i.Hk(e.targetPoint)})}get hints(){return[new a.n(this.targetPoint,this.isDraped,this.domain)]}}},84821:(e,t,n)=>{n.r(t),n.d(t,{FeatureCollectionSnappingSource:()=>_});var i=n(36663),s=n(74396),a=n(81506),r=n(78668),o=n(76868),c=n(84684),l=n(81977),u=(n(39994),n(13802),n(4157),n(40266)),p=n(83772),h=n(22519),d=n(84713),y=n(26590),g=n(35347),f=n(79287);let _=class extends s.Z{get availability(){return 1}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,n=null!=e&&"3d"===e.type;if(!n||"subtype-group"===t.type)return(0,y.p)();return(0,y.p)(n,{elevationInfo:t.elevationInfo,alignPointsInFeatures:async(n,i)=>(await(0,r.Hl)(e.whenLayerView(t),i)).elevationAlignPointsInFeatures(n,i)})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&"3d"===e.type&&"subtype-group"!==this.layerSource.layer.type;return(0,g.c)(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&"3d"===e.type&&"subtype-group"!==t.type?(0,f.k)(this._symbologySnappingSupported,(async(n,i)=>{const s=await e.whenLayerView(t);return(0,r.k_)(i),s.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},i)})):(0,f.k)()}get _layerView(){const{view:e}=this;if(null==e)return null;const{layer:t}=this.layerSource;return e.allLayerViews.find((e=>e.layer===t))}get _layerView3D(){const{view:e}=this;return null==e||"2d"===e.type?null:this._layerView}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&"3d"===e.type&&"subtype-group"!==t.type&&this.addHandles([e.elevationProvider.on("elevation-change",(({context:e})=>{const{elevationInfo:n}=t;(0,p.W_)(e,n)&&this._snappingElevationAligner.notifyElevationSourceChange()})),(0,o.watch)((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),o.initial),(0,o.watch)((()=>null!=this._layerView3D?this._layerView3D.layer?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),o.initial),(0,o.on)((()=>this._layerView3D?.layer),["edits","apply-edits","graphic-update"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=(0,a.H)(d.g)}refresh(){}async fetchCandidates(e,t){const{layer:n}=this.layerSource,i=n.source;if(!i?.querySnapping)return[];const s=n.createQuery();this._layerView&&"effectiveDisplayFilter"in this._layerView&&(s.where=(0,c._$)(s.where,this._layerView.effectiveDisplayFilter?.where));const a=(0,h.rh)(e,this.view?.type??"2d",s),o=await i.querySnapping(a,{signal:t});(0,r.k_)(t);const l=e.coordinateHelper.spatialReference,u=await this._snappingElevationAligner.alignCandidates(o.candidates,l,t);(0,r.k_)(t);const p=await this._symbologySnappingFetcher.fetch(u,t);(0,r.k_)(t);const y=0===p.length?u:[...u,...p],g=this._snappingElevationFilter.filter(a,y),f=this._memoizedMakeGetGroundElevation(this.view,l);return g.map((e=>(0,d.X)(e,f)))}};(0,i._)([(0,l.Cb)({constructOnly:!0})],_.prototype,"layerSource",void 0),(0,i._)([(0,l.Cb)({constructOnly:!0})],_.prototype,"view",void 0),(0,i._)([(0,l.Cb)()],_.prototype,"_snappingElevationAligner",null),(0,i._)([(0,l.Cb)()],_.prototype,"_snappingElevationFilter",null),(0,i._)([(0,l.Cb)()],_.prototype,"_symbologySnappingFetcher",null),(0,i._)([(0,l.Cb)()],_.prototype,"_layerView",null),(0,i._)([(0,l.Cb)()],_.prototype,"_layerView3D",null),(0,i._)([(0,l.Cb)()],_.prototype,"_symbologySnappingSupported",null),_=(0,i._)([(0,u.j)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],_)},84713:(e,t,n)=>{n.d(t,{X:()=>c,g:()=>l});var i=n(51633),s=n(1834),a=n(46455),r=n(10739);function o({x:e,y:t,z:n}){return(0,i.al)(e,t,n??0)}function c(e,t){switch(e.type){case"edge":return e.draped?new s.k({edgeStart:o(e.start),edgeEnd:o(e.end),targetPoint:(0,i.s)(o(e.target)),objectId:e.objectId,getGroundElevation:t}):new a.L({edgeStart:o(e.start),edgeEnd:o(e.end),targetPoint:(0,i.s)(o(e.target)),objectId:e.objectId,isDraped:!1});case"vertex":return new r.x({targetPoint:(0,i.s)(o(e.target)),objectId:e.objectId,isDraped:!1})}}function l(e,t){return null!=e&&"3d"===e.type?(n,i)=>e.elevationProvider.getElevation(n,i,0,t,"ground"):()=>null}},26590:(e,t,n)=>{n.d(t,{p:()=>c});n(39994);var i=n(55854),s=n(86114),a=n(78668),r=n(17321),o=n(91478);function c(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:n}=t;return new u(e,n)}return new l}class l{async alignCandidates(e,t,n){return e}notifyElevationSourceChange(){}}class u{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new i.z(1024),this._cacheVersion=0}async alignCandidates(e,t,n){const i=this._elevationInfo;return null==i||"absolute-height"!==i.mode||i.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,n):(function(e,t,n){const{offset:i,unit:s}=n;if(null==i)return;const a=(0,r._R)(t),c=i*((0,o.Z7)(s??"meters")/a);for(const t of e)switch(t.type){case"edge":t.start.z+=c,t.end.z+=c;continue;case"vertex":t.target.z+=c;continue}}(e,t,i),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,t,n){const i=new Map;for(const t of e)(0,s.s1)(i,t.objectId,d).push(t);const[r,o,c]=this._prepareQuery(i,t),l=await this._alignPointsInFeatures(r,n);if((0,a.k_)(n),c!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,n);this._applyCacheAndResponse(r,l,o);const{drapedObjectIds:u,failedObjectIds:p}=l,h=[];for(const t of e){const{objectId:e}=t;u.has(e)&&"edge"===t.type&&(t.draped=!0),p.has(e)||h.push(t)}return h}_prepareQuery(e,t){const n=[],i=[];for(const[t,s]of e){const e=[];for(const n of s)this._addToQueriesOrCachedResult(t,n.target,e,i),"edge"===n.type&&(this._addToQueriesOrCachedResult(t,n.start,e,i),this._addToQueriesOrCachedResult(t,n.end,e,i));0!==e.length&&n.push({objectId:t,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:n},i,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,n,i){const s=h(e,t),a=this._alignmentsCache.get(s);null==a?n.push(t):i.push(new p(t,a))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:n,failedObjectIds:i},s){for(const e of s)e.apply();let a=0;const r=this._alignmentsCache;for(const{objectId:s,points:o}of e.pointsInFeatures){if(i.has(s)){a+=o.length;continue}const e=!n.has(s);for(const n of o){const i=h(s,n),o=t[a++];n.z=o,e&&r.put(i,o,1)}}}}class p{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function h(e,{x:t,y:n,z:i,spatialReference:s}){return`${e}-${t}-${n}-${i??0}}-wkid:${s?.wkid}`}function d(){return[]}},35347:(e,t,n)=>{n.d(t,{c:()=>r});n(39994);class i{filter(e,t){return t}notifyElevationSourceChange(){}}class s{filter(e,t){const{point:n,distance:i}=e,{z:s}=n;if(null==s)return t;if(0===t.length)return t;const r=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(i),o=this._updateCandidatesTo3D(t,n,r).filter(a);return o.sort(l),o}_updateCandidatesTo3D(e,t,n){for(const i of e)switch(i.type){case"edge":o(i,t,n);continue;case"vertex":c(i,t,n);continue}return e}}function a(e){return e.distance<=1}function r(e=!1){return e?new s:new i}function o(e,t,{x:n,y:i,z:s}){const{start:a,end:r,target:o}=e;e.draped||function(e,t,n,i){const s=i.x-n.x,a=i.y-n.y,r=i.z-n.z,o=s*s+a*a+r*r,c=(t.x-n.x)*s+(t.y-n.y)*a+r*(t.z-n.z),l=Math.min(1,Math.max(0,c/o)),u=n.x+s*l,p=n.y+a*l,h=n.z+r*l;e.x=u,e.y=p,e.z=h}(o,t,a,r);const c=(t.x-o.x)/n,l=(t.y-o.y)/i,u=(t.z-o.z)/s;e.distance=Math.sqrt(c*c+l*l+u*u)}function c(e,t,{x:n,y:i,z:s}){const{target:a}=e,r=(t.x-a.x)/n,o=(t.y-a.y)/i,c=(t.z-a.z)/s,l=Math.sqrt(r*r+o*o+c*c);e.distance=l}function l(e,t){return e.distance-t.distance}},79287:(e,t,n)=>{n.d(t,{k:()=>o});n(39994);var i=n(67134),s=n(55854),a=n(78668),r=n(21130);function o(e=!1,t){return e?new l(t):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}class l{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new s.z(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const n=[],s=[],r=this._candidatesCache;for(const t of e){const e=u(t),a=r.get(e);if(a)for(const e of a)s.push((0,i.d9)(e));else n.push(t),r.put(e,[],1)}if(0===n.length)return s;const o=this._cacheVersion,{candidates:c,sourceCandidateIndices:l}=await this._getSymbologyCandidates(n,t);if((0,a.k_)(t),o!==this._cacheVersion)return this.fetch(e,t);const p=[],{length:h}=c;for(let e=0;e<h;++e){const t=c[e],s=u(n[l[e]]),a=r.get(s);a.push(t),r.put(s,a,a.length),p.push((0,i.d9)(t))}return s.concat(p)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function u(e){switch(e.type){case"vertex":{const{objectId:t,target:n}=e,i=`${t}-vertex-${n.x}-${n.y}-${n.z??0}`;return(0,r.hP)(i).toString()}case"edge":{const{objectId:t,start:n,end:i}=e,s=`${t}-edge-${n.x}-${n.y}-${n.z??0}-to-${i.x}-${i.y}-${i.z??0}`;return(0,r.hP)(s).toString()}default:return""}}},82366:(e,t,n)=>{n.d(t,{n:()=>a});var i=n(86717),s=n(9650);class a extends s.r{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof a&&(0,i.p)(this.point,e.point)}}}}]);