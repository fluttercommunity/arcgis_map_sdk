"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[2059,57970,28432],{19849:(e,t,r)=>{r.d(t,{Z:()=>a});var i=r(69079),s=r(8955);class a{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const r=this._resourceMap.get(e);if(r)return{width:r.width,height:r.height};let i=this._inFlightResourceMap.get(e);return i?i.then((e=>({width:e.width,height:e.height}))):(i=(0,s.n$)(e,t),this._inFlightResourceMap.set(e,i),i.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,i.mx)(e)}}},2059:(e,t,r)=>{r.r(t),r.d(t,{CIMSymbolRasterizer:()=>l});var i=r(19849),s=r(70271),a=r(95215),o=r(57970),n=r(7937),c=r(60789);class l{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new i.Z}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,r,i,s,l,p,f,m,y){if(!e)return null;const{data:u}=e;if(!u||"CIMSymbolReference"!==u.type||!u.symbol)return null;const{symbol:d}=u;l||(l=(0,c.JW)(d));const g=await o.OverrideHelper.resolveSymbolOverrides(u,t,this._spatialReference,s,l,p,f),v=this._cimResourceManager,M=[];a.B$.fetchResources(g,v,M),a.B$.fetchFonts(g,v,M),M.length>0&&await Promise.all(M);const{width:b,height:w}=r;let x=h(l,b,w,i,y);const C=a.B$.getEnvelope(g,x,v);if(!C)return null;C.x===1/0&&(C.x=b+2),C.y===1/0&&(C.y=-w/2),C.width===-1/0&&(C.width=b),C.height===-1/0&&(C.height=w);let I=1,S=0,k=0;switch(d.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;C.width>b&&(e=b/C.width);let t=1;C.height>w&&(t=w/C.height),"preview"===i&&(C.width<b&&(e=b/C.width),C.height<w&&(t=w/C.height)),I=Math.min(e,t),S=C.x+C.width/2,k=C.y+C.height/2}break;case"CIMLineSymbol":if(y){k=C.y+C.height/2,S=C.x+C.width/2;const e=C.width-b,t=C.height-w;x={paths:(0,n.bA)(x.paths,{xmin:-1*C.width/2+e,xmax:C.width/2-e,ymin:-1*C.height/2+t,ymax:C.height/2-t,width:C.width-2*e,height:C.height-2*t})}}else{(m||C.height>w)&&(I=w/C.height),k=C.y+C.height/2;const e=C.x*I+b/2,t=(C.x+C.width)*I+b/2,{paths:r}=x;r[0][0][0]-=e/I,r[0][2][0]-=(t-b)/I}break;case"CIMPolygonSymbol":if(y){k=C.y+C.height/2,S=C.x+C.width/2;const e=C.width-b,t=C.height-w;x={paths:(0,n.bA)(x.rings,{xmin:-1*C.width/2+e,xmax:C.width/2-e,ymin:-1*C.height/2+t,ymax:C.height/2-t,width:C.width-2*e,height:C.height-2*t})}}else{S=C.x+C.width/2,k=C.y+C.height/2;const e=C.x*I+b/2,t=(C.x+C.width)*I+b/2,r=C.y*I+w/2,i=(C.y+C.height)*I+w/2,{rings:s}=x;e<0&&(s[0][0][0]-=e,s[0][3][0]-=e,s[0][4][0]-=e),r<0&&(s[0][0][1]+=r,s[0][1][1]+=r,s[0][4][1]+=r),t>b&&(s[0][1][0]-=t-b,s[0][2][0]-=t-b),i>w&&(s[0][2][1]+=i-w,s[0][3][1]+=i-w)}}const O={type:"cim",data:{type:"CIMSymbolReference",symbol:g}};return this.rasterize(O,b,w,S,k,I,l,1,x)}rasterize(e,t,r,i,a,o,n,l=0,p=null,f=window.devicePixelRatio||1){const{data:m}=e;if(!m||"CIMSymbolReference"!==m.type||!m.symbol)return null;const{symbol:y}=m,u=this._canvas,d=1.3333333333333333*f;u.width=t*d,u.height=r*d,n||(n=(0,c.JW)(y)),p||(p=h(n,t,r,"legend")),u.width+=2*l,u.height+=2*l;const g=u.getContext("2d",{willReadFrequently:!0}),v=s.zA.createIdentity();return v.translate(-i,-a),v.scale(o*d,-o*d),v.translate(t*d/2+l,r*d/2+l),g.clearRect(0,0,u.width,u.height),new s.cD(g,this._cimResourceManager,v,!0).drawSymbol(y,p),g.getImageData(0,0,u.width,u.height)}}function h(e,t,r,i,s){const a=-t/2+1,o=t/2-1,c=r/2-1,l=-r/2+1;if(s&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const i=function(e,t,r,i){return"esriGeometryPolygon"===t?{rings:(0,n.Iu)((0,n.bA)(e.rings,{xmin:0,ymin:0,xmax:r,ymax:i,width:r,height:i}),-1*r/2,-1*i/2)}:"esriGeometryPolyline"===t?{paths:(0,n.Iu)((0,n.bA)(e.paths,{xmin:0,ymin:0,xmax:r,ymax:i,width:r,height:i}),-1*r/2,-1*i/2)}:null}(s,e,t,r);if(i)return i}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[a,0],[0,0],[o,0]]]};default:return"legend"===i?{rings:[[[a,c],[o,0],[o,l],[a,l],[a,c]]]}:{rings:[[[a,c],[o,c],[o,l],[a,l],[a,c]]]}}}},57970:(e,t,r)=>{r.r(t),r.d(t,{OverrideHelper:()=>h});var i=r(30936),s=r(39043),a=r(67134),o=r(30879),n=r(60789),c=r(28432);const l=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:i,a:s}=e;return[t,r,i,255*s]};class h{static findApplicableOverrides(e,t,r){if(e&&t){if(e.primitiveName){let i=!1;for(const t of r)if(t.primitiveName===e.primitiveName){i=!0;break}if(!i)for(const i of t)i.primitiveName===e.primitiveName&&r.push(i)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const i of e.effects)h.findApplicableOverrides(i,t,r);if(e.symbolLayers)for(const i of e.symbolLayers)h.findApplicableOverrides(i,t,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const i of e.effects)h.findApplicableOverrides(i,t,r);if(e.markerPlacement&&h.findApplicableOverrides(e.markerPlacement,t,r),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const i of e.markerGraphics)h.findApplicableOverrides(i,t,r),h.findApplicableOverrides(i.symbol,t,r)}else"CIMCharacterMarker"===e.type?h.findApplicableOverrides(e.symbol,t,r):"CIMHatchFill"===e.type?h.findApplicableOverrides(e.lineSymbol,t,r):"CIMPictureMarker"===e.type&&h.findApplicableOverrides(e.animatedSymbolProperties,t,r)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,n.hU)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=(0,n.Ml)(e),i=e.primitiveName,s=[];for(const e of t)e.primitiveName===i&&s.push((0,n.Ml)(e));return{type:"cim-effect-param",effect:r,overrides:(0,n.Ul)(s)}}static async resolveSymbolOverrides(e,t,r,i,s,o,c){if(!e?.symbol)return null;let{symbol:l,primitiveOverrides:p}=e;const f=!!p;if(!f&&!i)return l;l=(0,a.d9)(l),p=(0,a.d9)(p);let m=!0;if(t||(t={attributes:{}},m=!1),f){if(m||(p=p.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),c||(p=p.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),p.length>0){const e={spatialReference:r,fields:(0,n.Qf)(t.attributes),geometryType:s};await h.createRenderExpressions(p,e),h.evaluateOverrides(p,t,s??"esriGeometryPoint",o,c)}h.applyOverrides(l,p)}return i&&h.applyDictionaryTextOverrides(l,t,i,null),l}static async createRenderExpressions(e,t){const r=[];for(const i of e){const e=i.valueExpressionInfo;if(!e||h._expressionToRenderExpression.has(e.expression))continue;const s=(0,o.Yi)(e.expression,t.spatialReference,t.fields);r.push(s),s.then((t=>h._expressionToRenderExpression.set(e.expression,t)))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,t,r,i,a){const o={$view:{scale:a?.scale}};for(const a of e){a.value&&"object"==typeof a.value&&(0,s.jQ)(a.value)&&("Color"===a.propertyName||"StrokeColor"===a.propertyName)&&(a.value=l(a.value));const e=a.valueExpressionInfo;if(!e)continue;const n=h._expressionToRenderExpression.get(e.expression);n&&(a.value=(0,c.default)(n,t,o,r,i))}}static applyDictionaryTextOverrides(e,t,r,i,s="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const a=e.symbolLayers;if(!a)return;for(const o of a)o&&"CIMVectorMarker"===o.type&&h.applyDictionaryTextOverrides(o,t,r,i,"CIMTextSymbol"===e.type?e.textCase:s)}break;case"CIMVectorMarker":{const s=e.markerGraphics;if(!s)return;for(const e of s)e&&h.applyDictionaryTextOverrides(e,t,r,i)}break;case"CIMMarkerGraphic":{const a=e.textString;if(a&&a.includes("[")){const o=(0,n.H1)(a,r);e.textString=(0,n.E_)(t,o,i,s)}}}}static applyOverrides(e,t,r,i){if(e.primitiveName)for(const s of t)if(s.primitiveName===e.primitiveName){const t=(0,n.Le)(s.propertyName);if(i&&i.push({cim:e,nocapPropertyName:t,value:e[t]}),r){let t=!1;for(const i of r)i.primitiveName===e.primitiveName&&(t=!0);t||r.push(s)}null!=s.value&&(e[t]=s.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)h.applyOverrides(s,t,r,i);if(e.symbolLayers)for(const s of e.symbolLayers)h.applyOverrides(s,t,r,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const s of e.effects)h.applyOverrides(s,t,r,i);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const s of e.markerGraphics)h.applyOverrides(s,t,r,i),h.applyOverrides(s.symbol,t,r,i)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const r of e)void 0!==r.value&&(t+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new i.Z(t).toRgba();return e[3]*=255,e}return t}}h._expressionToRenderExpression=new Map},28432:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var i=r(70375),s=r(13802),a=r(7505);function o(e,t,r,i,a){if(null==e)return null;const o=e.references("geometry")&&a?c(t,i,a):t,n=e.repurposeFeature(o);try{return e.evaluate({...r,$feature:n},e.services)}catch(e){return s.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}const n=new Map;function c(e,t,r){const{transform:o,hasZ:c,hasM:l}=r;n.has(t)||n.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,i,s)=>(0,a.U1)(r,t,e,i,s);case"esriGeometryPolygon":return(e,r,i,s)=>(0,a.Ie)(r,t,e,i,s);case"esriGeometryPolyline":return(e,r,i,s)=>(0,a.G6)(r,t,e,i,s);case"esriGeometryMultipoint":return(e,r,i,s)=>(0,a.J9)(r,t,e,i,s);default:return s.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new i.Z("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const h=n.get(t)(e.geometry,o,c,l);return{...e,geometry:h}}}}]);