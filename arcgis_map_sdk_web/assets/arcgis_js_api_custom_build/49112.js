"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[49112],{12408:(e,t,a)=>{a.d(t,{L:()=>n});var r=a(40371);class n{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}async fetchServiceMetadata(e,t){const a=this._serviceMetadatas.get(e);if(a)return a;const n=await(0,r.T)(e,t);return this._serviceMetadatas.set(e,n),n}async fetchItemData(e){const{id:t}=e;if(!t)return null;const{_itemDatas:a}=this;if(a.has(t))return a.get(t);const r=await e.fetchData();return a.set(t,r),r}async fetchCustomParameters(e,t){const a=await this.fetchItemData(e);return a&&"object"==typeof a&&(t?t(a):a.customParameters)||null}}},8308:(e,t,a)=>{a.d(t,{V:()=>s,W:()=>p});var r=a(40371);const n=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function s(e,t){const{loadContext:a,...n}=t||{},s=a?await a.fetchServiceMetadata(e,n):await(0,r.T)(e,n);y(s),u(s);const l={serviceJSON:s};if((s.currentVersion??0)<10.5)return l;const o=`${e}/layers`,c=a?await a.fetchServiceMetadata(o,n):await(0,r.T)(o,n);return y(c),u(c),l.layersJSON={layers:c.layers,tables:c.tables},l}function l(e){const{type:t}=e;return!!t&&n.has(t)}function o(e){return"Table"===e.type}function u(e){e.layers=e.layers?.filter(l),e.tables=e.tables?.filter(o)}function c(e){e.type||="Feature Layer"}function i(e){e.type||="Table"}function y(e){e.layers?.forEach(c),e.tables?.forEach(i)}function p(e){switch(e){case"Feature Layer":case"Table":return"FeatureLayer";case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},49112:(e,t,a)=>{a.r(t),a.d(t,{load:()=>f});var r=a(70375),n=a(20692),s=a(8308),l=a(12408),o=a(93968),u=a(84513),c=a(91362),i=a(31370),y=a(16603),p=a(40371);async function f(e,t){const a=e.instance.portalItem;if(a?.id)return await a.load(t),function(e){const t=e.instance.portalItem;if(!t?.type||!e.supportedTypes.includes(t.type))throw new r.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t?.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(a),async function(e,t){const a=e.instance,n=a.portalItem;if(!n)return;const{url:o,title:f}=n,m=(0,u.h)(n,"portal-item");if("group"===a.type)return async function(e,t,a){const n=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:o,type:y}=n;if("Group Layer"===y){if(!(0,i._$)(n,"Map"))throw new r.Z("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return async function(e,t){const a=e.portalItem,n=await a.fetchData("json");if(!n)return;if(!t.populateGroupLayer)throw new r.Z("portal:missing-populate-group-layer","Missing populate group layer");const s=(0,u.h)(a,"web-map");e.read(n,s),await t.populateGroupLayer(e,n,{context:s}),e.resourceReferences={portalItem:a,paths:s.readResourcePaths??[]}}(e,a)}return e.read({title:o},t),async function(e,t){let a;const{portalItem:n}=e;if(!n)return;const o=n.type,u=t.layerModuleTypeMap;if(!u)throw new r.Z("portal:missing-layer-module-type-map","Layer module type map is required to construct sub layers");switch(o){case"Feature Service":case"Feature Collection":a=u.FeatureLayer;break;case"Stream Service":a=u.StreamLayer;break;case"Scene Service":a=u.SceneLayer;break;default:throw new r.Z("portal:unsupported-item-type-as-group",`The item type '${o}' is not supported as a 'IGroupLayer'`)}const i=new l.L;let[y,f]=await Promise.all([a(),h(t,i)]),m=()=>y;if("Feature Service"===o){const t=(0,c.uE)(f)?.customParameters;f=n.url?await(0,c.$O)(f,n.url,i):{},m=await async function(e,t){const{layers:a,tables:r}=e,n=[...a??[],...r??[]];if(!n.length)return;const s=new Set,l=[];for(const{layerType:e}of n){const a=e??"ArcGISFeatureLayer";if(s.has(a))continue;s.add(a);const r=t[(0,c.qT)(a)];l.push(r())}const o=await Promise.all(l),u=new Map;return Array.from(s).forEach(((e,t)=>{u.set(e,o[t])})),({layerType:e})=>{const t=e??"ArcGISFeatureLayer";return u.get(t)}}(f,u)||m;const a=await async function(e,t){const{layersJSON:a}=await(0,s.V)(e,t);if(!a)return null;const r=[...a.layers,...a.tables];return e=>r.find((t=>t.id===e.id))}(n.url,{customParameters:t,loadContext:i});return await d(e,m,m,f,u,a)}return"Scene Service"===o&&n.url&&(f=await(0,c.CD)(n,f,i)),(0,c.Q4)(f)>0?await d(e,m,null,f,u):await async function(e,t,a){const{portalItem:r}=e;if(!r?.url)return;const n=await(0,p.T)(r.url);n&&d(e,t,null,{layers:n.layers?.map(c.bS),tables:n.tables?.map(c.bS)},a)}(e,m,u)}(e,a)}(a,m,e);o&&"media"!==a.type&&a.read({url:o},m);const w=new l.L,b=await h(e,w,t);return b&&a.read(b,m),a.resourceReferences={portalItem:n,paths:m.readResourcePaths??[]},"subtype-group"!==a.type&&a.read({title:f},m),(0,y.y)(a,m)}(e,t)}async function d(e,t,a,r,n,s){let l=r.layers||[];const o=r.tables||[];if("Feature Collection"===e.portalItem?.type?(l.forEach(((e,t)=>{e.id=t,"Table"===e?.layerDefinition?.type&&o.push(e)})),l=l.filter((e=>"Table"!==e?.layerDefinition?.type))):(l.reverse(),o.reverse()),l.forEach((a=>{const n=s?.(a);if(n||!s){const s=m(e,t(a),r,a,n);e.add(s)}})),o.length){const t=a?null:await n.FeatureLayer();o.forEach((n=>{const l=s?.(n);if(l||!s){const s=m(e,a?a(n):t,r,n,l);e.tables.add(s)}}))}}function m(e,t,a,r,n){const s=e.portalItem,l={portalItem:s.clone(),layerId:r.id};null!=r.url&&(l.url=r.url);const u=new t(l);if("sourceJSON"in u&&(u.sourceJSON=n),"subtype-group"!==u.type&&"catalog"!==u.type&&(u.sublayerTitleMode="service-name"),"Feature Collection"===s.type){const e={origin:"portal-item",portal:s.portal||o.Z.getDefault()};u.read(r,e);const t=a.showLegend;null!=t&&u.read({showLegend:t},e)}return u}async function h(e,t,a){if(!1===e.supportsData)return;const r=e.instance,s=r.portalItem;if(!s)return;let l=null;try{l=await s.fetchData("json",a)}catch(e){}if(function(e){return"stream"!==e.type&&"layerId"in e}(r)){let e=null;const a=await async function(e,t,a){if(t?.layers&&t?.tables)return(0,c.Q4)(t);const r=(0,n.Qc)(e.url);if(!r)return 1;const s=await a.fetchServiceMetadata(r.url.path,{customParameters:(0,c.uE)(t)?.customParameters}).catch((()=>null));return(t?.layers?.length??s?.layers?.length??0)+(t?.tables?.length??s?.tables?.length??0)}(s,l,t);if((l?.layers||l?.tables)&&a>0){if(null==r.layerId){const e=(0,c.on)(r.type),t=e?.length?(0,c.r9)(l,e)[0]:(0,c.uE)(l);t&&(r.layerId=t.id)}e=function(e,t){const{layerId:a}=t,r=e.layers?.find((e=>e.id===a))||e.tables?.find((e=>e.id===a));return r&&function(e,t){const a="layerType"in e&&e.layerType,{type:r}=t;return!("feature"===r&&a&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===r&&!a||"oriented-imagery"===r&&!a||"subtype-group"===r&&!a)}(r,t)?r:null}(l,r),"OrientedImageryLayer"===e?.layerType&&"oriented-imagery"===r.type&&r.supportedSourceTypes.add("Feature Layer"),e&&null!=l.showLegend&&(e.showLegend=l.showLegend)}return a>1&&"sublayerTitleMode"in r&&"service-name"!==r.sublayerTitleMode&&(r.sublayerTitleMode="item-title-and-service-name"),e}return l}},91362:(e,t,a)=>{a.d(t,{$O:()=>l,CD:()=>f,Q4:()=>i,bS:()=>s,hq:()=>u,on:()=>y,qT:()=>p,r9:()=>c,uE:()=>o});var r=a(53264),n=a(8308);function s(e){const t={id:e.id,name:e.name},a=(0,n.W)(e.type);return"FeatureLayer"!==a&&(t.layerType=a),t}async function l(e,t,a){if(null==e?.layers||null==e?.tables){const r=await a.fetchServiceMetadata(t,{customParameters:o(e)?.customParameters});(e=e||{}).layers=e.layers||r?.layers?.map(s),e.tables=e.tables||r?.tables?.map(s)}return e}function o(e){if(!e)return null;const{layers:t,tables:a}=e;return t?.length?t[0]:a?.length?a[0]:null}function u(e,t){return null==t?null:[...e.layers||[],...e.tables||[]].find((e=>e.id===t))}function c(e,t){return[...e.layers||[],...e.tables||[]].filter((({layerType:e})=>e?t.includes(e):t.includes("ArcGISFeatureLayer")))}function i(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function y(e){switch(e){case"catalog":return["CatalogLayer"];case"feature":return["ArcGISFeatureLayer"];case"oriented-imagery":return["OrientedImageryLayer"];case"subtype-group":return["SubtypeGroupLayer","SubtypeGroupTable"]}return null}function p(e){switch(e){case"CatalogLayer":return"CatalogLayer";case"OrientedImageryLayer":return"OrientedImageryLayer";case"SubtypeGroupLayer":case"SubtypeGroupTable":return"SubtypeGroupLayer"}return"FeatureLayer"}async function f(e,t,a){if(!e?.url)return t??{};if(t??={},!t.layers){const r=await a.fetchServiceMetadata(e.url);t.layers=r.layers?.map(s)}const{serverUrl:n,portalItem:l}=await(0,r.w)(e.url,{sceneLayerItem:e,customParameters:o(t)?.customParameters}).catch((()=>({serverUrl:null,portalItem:null})));if(null==n)return t.tables=[],t;if(!t.tables&&l){const e=await l.fetchData().catch((()=>null));if(e?.tables)t.tables=e.tables.map(s);else{const r=await a.fetchServiceMetadata(n,{customParameters:o(e)?.customParameters}).catch((()=>null));t.tables=r?.tables?.map(s)}}if(t.tables)for(const e of t.tables)e.url=`${n}/${e.id}`;return t}},40371:(e,t,a)=>{a.d(t,{T:()=>n});var r=a(66341);async function n(e,t){const{data:a}=await(0,r.Z)(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return a}}}]);