"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[6397],{6397:(e,t,i)=>{i.r(t),i.d(t,{default:()=>N});var r=i(36663),s=i(80085),n=i(13802),l=i(61681),a=i(61242),o=i(76868),u=i(81977),d=(i(39994),i(4157),i(40266)),c=i(85491),h=i(15553),y=i(21586),p=i(14626),g=i(32646),f=i(57676),_=i(78186),b=i(28800),w=i(57533),F=i(11399),v=i(19141),m=i(79946),E=i(4574),I=i(61498),S=i(5002),C=i(57602),O=i(78565),x=i(7933),R=i(3917),j=i(44613),Q=i(37495),A=i(35990),M=i(57686),q=i(21808),D=i(59439),G=i(67235),H=i(42780),T=i(22167);const Z=(0,R.v)();let k=class extends((0,f.N)((0,A.q)((0,x.l)((0,j.i)((0,b.A)(q.Z)))))){constructor(){super(...arguments),this.type="scene-layer-3d",this._setVisibilityHiddenObjectIds=new a.Z,this.progressiveLoadFactor=1,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!0,this._pendingEditsQueue=Promise.resolve(),this._interactiveEditingSessions=new Map,this._queryEngine=null}get i3slayer(){return this.layer}tryRecycleWith(e,t){return e.url===this.layer.url&&this.i3sOverrides.isEmpty?e.load(t).then((()=>{(0,O.tq)(this.layer,e,this.i3sOverrides),this.layer=e,this.i3sOverrides.destroy();const t=this.view.resourceController?.memoryController;this.i3sOverrides=new E.v({view:this.view,layer:e,memoryController:t}),this.resetHighlights()})):null}get layerPopupEnabledAndHasTemplate(){return this.layer.popupEnabled&&(0,D.zc)(this.layer,this.view.popup?.defaultPopupTemplateEnabled)}get filter(){return this._get("filter")}set filter(e){this._set("filter",v.z.checkSupport(e)?e:null)}get viewFilter(){const e=this.mergedFilter,t=this.layerFilter;if(null==e&&null==t)return null;const i=this._get("viewFilter");return null==i?new v.z({layerFilter:t,viewFilter:e,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:e=>this._loadAsyncModule(e),addSqlFilter:(e,t)=>this.addSqlFilter(e,t,this.logError),addTimeFilter:(e,t)=>this.addTimeFilter(e,t)}):(i.viewFilter=e,i.layerFilter=t,i)}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get _floorFilterClause(){const e=(0,y.c)(this);return null!=e?c.default.create(e,{fieldsIndex:this.layer.fieldsIndex}):null}get _excludeObjectIdsSorted(){const e=this.layer.excludeObjectIds.toArray();return e.length?e.sort(((e,t)=>e-t)):null}get _setVisibilityHiddenObjectIdsSorted(){return this._setVisibilityHiddenObjectIds.size?Array.from(this._setVisibilityHiddenObjectIds).sort(((e,t)=>e-t)):null}get lodFactor(){return this.view?.qualitySettings?.sceneService?.object?.lodFactor??1}get lodCrossfadeUncoveredDuration(){return this.view?.qualitySettings?.fadeDuration??0}get updatingProgressValue(){return this._controller?.updatingProgress??0}get visibleAtCurrentScale(){return(0,H.GB)(this.i3slayer.effectiveScaleRange,this.view.scale)}initialize(){this._fieldsHelper=new Q.K({layerView:this}),this._updatingHandles.add((()=>this.layer.rangeInfos),(e=>this._rangeInfosChanged(e)),o.initial),this._updatingHandles.add((()=>this.layer.renderer),(e=>this._updatingHandles.addPromise(this._rendererChange(e))),o.initial);const e=()=>this._filterChange();this._updatingHandles.add((()=>this.parsedDefinitionExpression),e),this._updatingHandles.add((()=>this.mergedFilter),e),this._updatingHandles.add((()=>this._floorFilterClause),e),this._updatingHandles.add((()=>this._excludeObjectIdsSorted),e),this._updatingHandles.add((()=>this._setVisibilityHiddenObjectIdsSorted),e),this._updatingHandles.add((()=>this.viewFilter?.sortedObjectIds),e),this._updatingHandles.add((()=>this.viewFilter?.parsedWhereClause),e),this._updatingHandles.add((()=>this.getTimeFilterDependencies()),e),this._updatingHandles.add((()=>[this.viewFilter?.parsedGeometry,this.mergedFilter?.spatialRelationship,this.layer.filter?.spatialRelationship]),(()=>this._geometryFilterChange())),this.i3sOverrides.is3DOFL&&this._updatingHandles.add((()=>this.i3sOverrides.sortedGeometryChangedObjectIds),e),this.addHandles(this.layer.on("apply-edits",(e=>this._updatingHandles.addPromise(e.result)))),this.addHandles(this.layer.on("edits",(e=>{const t=this._pendingEditsQueue.then((()=>this._handleEdits(e))).then();this._pendingEditsQueue=t,this._updatingHandles.addPromise(t)})))}destroy(){this._fieldsHelper=(0,l.SC)(this._fieldsHelper)}_rangeInfosChanged(e){null!=e&&e.length>0&&n.Z.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return this.mergedFilter?.createQuery(e)??new p.Z(e)}queryExtent(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),t?.signal)}queryFeatureCount(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),t?.signal)}queryFeatures(e,t){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),t?.signal).then((e=>{if(!e?.features)return e;const t=this.layer;for(const i of e.features)i.layer=t,i.sourceLayer=t;return e}))}async queryObjectIds(e,t){return(await this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),t?.signal)).filter(g.hj)}_ensureQueryEngine(){return this._queryEngine??=this._createQueryEngine(),this._queryEngine}_createQueryEngine(){const e=(0,F.gz)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new I.u({layerView:this,priority:T.T8.FEATURE_QUERY_ENGINE,spatialIndex:new C.I({featureAdapter:new S.u({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo??[],getFeatureExtent:e}),forAllFeatures:(e,t)=>this._forAllFeatures(((t,i,r)=>e(new S.w(t,i,r))),t,_.p1.QUERYABLE),getFeatureExtent:e,sourceSpatialReference:(0,O.tp)(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(e,t){const i=this._highlights,r=t?.name??G.b;if(e instanceof p.Z){const{set:t,handle:s}=i.acquireSet(r);return this.queryObjectIds(e).then((e=>i.setFeatureIds(t,e))),s}return super.highlight(e,t)}createInteractiveEditSession(e){return(0,w.sw)(this._attributeEditingContext,e)}_createLayerGraphic(e){return new s.Z({attributes:e,layer:this.layer,sourceLayer:this.layer})}getFilters(){const e=super.getFilters();this.i3sOverrides.is3DOFL&&this.i3sOverrides.sortedGeometryChangedObjectIds.length>0&&e.push(((e,t)=>{t.node.index>=0&&(0,O.Yb)(this.i3sOverrides.sortedGeometryChangedObjectIds,!1,e)}));const t=this._setVisibilityHiddenObjectIdsSorted;null!=t&&e.push((e=>(0,O.Yb)(t,!1,e)));const i=this._excludeObjectIdsSorted;return null!=i&&e.push((e=>(0,O.Yb)(i,!1,e))),this._floorFilterClause&&this.addSqlFilter(e,this._floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),null!=this.viewFilter&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}setVisibility(e,t){t?this._setVisibilityHiddenObjectIds.delete(e):this._setVisibilityHiddenObjectIds.add(e)}isUpdating(){return super.isUpdating()||this.layerFilterUpdating||null!=this.viewFilter&&this.viewFilter.updating||null!=this.i3sOverrides&&this.i3sOverrides.updating}_ensureQuery(e){return this._addDefinitionExpressionToQuery(null==e?this.createQuery():p.Z.from(e))}get _attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),globalIdField:this._getGlobalIdField(),forEachNode:e=>this._forAllNodes((t=>null!=t?e(t.node,t.featureIds):null)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this.i3sOverrides,getAttributeData:e=>this.getAttributeData(e),setAttributeData:(e,t)=>this.setAttributeData(e,t),clearMemCache:()=>this.clearMemCache()}}async _handleEdits(e){const t=this._attributeEditingContext,i=await(0,w.Qw)(t,e);(0,w.ZS)(t,i),(0,w.Z6)(t,i)}get hasGeometryFilter(){return null!=this.viewFilter?.parsedGeometry}computeNodeFiltering(e){const t=this.viewFilter;return null==t||!this.view.spatialReference||t.isMBSGeometryVisible(e,this.view.spatialReference,this._controller.crsIndex)?m.U_.Unmodified:m.U_.Culled}};(0,r._)([(0,u.Cb)()],k.prototype,"i3slayer",null),(0,r._)([(0,u.Cb)(M.q)],k.prototype,"updatingProgress",void 0),(0,r._)([(0,u.Cb)({type:h.Z})],k.prototype,"filter",null),(0,r._)([(0,u.Cb)({readOnly:!0})],k.prototype,"viewFilter",null),(0,r._)([(0,u.Cb)(Z.requiredFields)],k.prototype,"requiredFields",null),(0,r._)([(0,u.Cb)(Z.availableFields)],k.prototype,"availableFields",void 0),(0,r._)([(0,u.Cb)()],k.prototype,"_fieldsHelper",void 0),(0,r._)([(0,u.Cb)()],k.prototype,"_floorFilterClause",null),(0,r._)([(0,u.Cb)()],k.prototype,"_excludeObjectIdsSorted",null),(0,r._)([(0,u.Cb)()],k.prototype,"_setVisibilityHiddenObjectIds",void 0),(0,r._)([(0,u.Cb)()],k.prototype,"_setVisibilityHiddenObjectIdsSorted",null),(0,r._)([(0,u.Cb)()],k.prototype,"lodFactor",null),(0,r._)([(0,u.Cb)()],k.prototype,"updatingProgressValue",null),(0,r._)([(0,u.Cb)({readOnly:!0})],k.prototype,"visibleAtCurrentScale",null),k=(0,r._)([(0,d.j)("esri.views.3d.layers.SceneLayerView3D")],k);const N=k},19141:(e,t,i)=>{i.d(t,{z:()=>A});var r=i(36663),s=i(74396),n=i(7753),l=i(13802),a=i(19431),o=i(9489),u=i(76868),d=i(17321),c=i(81977),h=(i(39994),i(40266)),y=i(86717),p=i(81095),g=i(85491),f=i(69442),_=i(90472),b=i(14685),w=i(20586),F=i(49757),v=i(37116),m=i(24568),E=i(92570),I=i(14260),S=i(35925),C=i(73687),O=i(39536),x=i(15553),R=i(78565);const j="esri.views.3d.layers.i3s.I3SMeshViewFilter",Q=()=>l.Z.getLogger(j);let A=class extends s.Z{constructor(e){super(e),this._projectionEngineLoaded=!1}initialize(){(0,u.whenOnce)((()=>this.viewFilter?.geometry||null!=this.layerFilter)).then((()=>this.loadAsyncModule(Promise.all([i.e(89067),i.e(16233)]).then(i.bind(i,17700)).then((e=>{this.destroyed||(this._geometryEngine=e)})))))}get sortedObjectIds(){if(null==this.viewFilter?.objectIds)return null;const e=(0,E.QZ)(this.viewFilter.objectIds);return e.sort(),e}get parsedWhereClause(){const e=this.viewFilter?.where;if(null==e||!e)return null;try{return g.default.create(e,{fieldsIndex:this.layerFieldsIndex})}catch(e){Q().error(`Failed to parse filter where clause: ${e}`)}return null}addFilters(e,t,i,r){const s=this.sortedObjectIds;null!=s&&e.push((e=>(0,R.Yb)(s,!0,e))),this.addSqlFilter(e,this.parsedWhereClause),this.addTimeFilter(e,this.viewFilter?.timeExtent);const n=(0,o.lK)(this._layerMaskGeometries),l=this._geometryEngine;if(null!=n&&null!=this.layerFilter&&null!=l){const s=this.layerFilter.spatialRelationship;e.push(((e,a)=>T(l,e,a,r,t,i,n,s)))}const a=(0,o.lK)(this._viewMaskGeometries);if(null!=a&&null!=this.viewFilter&&null!=l){const s=this.viewFilter.spatialRelationship;e.push(((e,n)=>T(l,e,n,r,t,i,a,s)))}}isMBSGeometryVisible(e,t,i){const r=(0,o.lK)(this._layerMaskGeometries),s=this._geometryEngine;if(null!=r&&null!=this.layerFilter&&null!=s){const n=this.layerFilter.spatialRelationship,l=r[0].spatialReference||t;return(0,w.s)(e,i,Z,l)?H(s,Z,r,l,n):(Q().warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}const n=(0,o.lK)(this._viewMaskGeometries);if(null!=n&&null!=this.viewFilter&&null!=s){const r=this.viewFilter.spatialRelationship,l=n[0].spatialReference||t;return(0,w.s)(e,i,Z,l)?H(s,Z,n,l,r):(Q().warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0}get parsedGeometry(){const e=(0,o.lK)(this._viewMaskGeometries),t=(0,o.lK)(this._layerMaskGeometries);return null==e||null==t?e||t:t.concat(e)}get _layerMaskGeometries(){const e=this.layerFilter;return null==e?null:null==this._geometryEngine?o.cn:"disjoint"===e.spatialRelationship?e.geometries.map((e=>({type:"polygon",rings:e.rings,spatialReference:e.spatialReference,cache:{}}))):[e.geometries.reduce(((e,t)=>(e.rings=[...e.rings,...t.rings],e)),{type:"polygon",rings:[],spatialReference:e.geometries[0].spatialReference,cache:{}})]}get _viewMaskGeometries(){if(null==this.viewFilter)return null;const{geometry:e}=this.viewFilter;if(null==e)return null;if(null==this.viewFilter||null==this._geometryEngine)return o.cn;const{distance:t,units:i}=this.viewFilter,r=this.viewFilter.spatialRelationship,s="mesh"===e.type?e.extent:e;if(null==t||0===t)return G(this._geometryEngine,s,r);const n=i||(0,d.qE)(s.spatialReference);if(s.spatialReference.isWGS84){const e=this._geometryEngine.geodesicBuffer(s,t,n);return G(this._geometryEngine,e,r)}const l=(0,O.iV)(s,b.Z.WGS84);if(null!=l){const e=(0,O.iV)(this._geometryEngine.geodesicBuffer(l,t,n),s.spatialReference);return G(this._geometryEngine,e,r)}if(!this._projectionEngineLoaded&&(this.loadAsyncModule((0,_.load)().then((()=>this._projectionEngineLoaded=!0))),!this._projectionEngineLoaded))return null;let a=null;try{a=(0,_.project)(s,b.Z.WGS84)}catch(e){}if(a)try{a=(0,_.project)(this._geometryEngine.geodesicBuffer(a,t,n),s.spatialReference)}catch(e){a=null}return a||Q().error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${s.spatialReference.wkid}) to WGS84.`),G(this._geometryEngine,a,r)}get updating(){return(0,o.j)(this._layerMaskGeometries)||(0,o.j)(this._viewMaskGeometries)}static checkSupport(e){return!(null==e||!function(e){return null!=e&&M.includes(e)}(e.spatialRelationship)&&(Q().warn(`Filters with spatialRelationship other than ${M.join(", ")} are not supported for mesh scene layers`),1))}};(0,r._)([(0,c.Cb)()],A.prototype,"layerFilter",void 0),(0,r._)([(0,c.Cb)({type:x.Z})],A.prototype,"viewFilter",void 0),(0,r._)([(0,c.Cb)()],A.prototype,"layerFieldsIndex",void 0),(0,r._)([(0,c.Cb)()],A.prototype,"loadAsyncModule",void 0),(0,r._)([(0,c.Cb)()],A.prototype,"addSqlFilter",void 0),(0,r._)([(0,c.Cb)()],A.prototype,"addTimeFilter",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],A.prototype,"sortedObjectIds",null),(0,r._)([(0,c.Cb)({readOnly:!0})],A.prototype,"parsedWhereClause",null),(0,r._)([(0,c.Cb)({readOnly:!0})],A.prototype,"parsedGeometry",null),(0,r._)([(0,c.Cb)({readOnly:!0})],A.prototype,"_layerMaskGeometries",null),(0,r._)([(0,c.Cb)({readOnly:!0})],A.prototype,"_viewMaskGeometries",null),(0,r._)([(0,c.Cb)()],A.prototype,"updating",null),(0,r._)([(0,c.Cb)()],A.prototype,"_projectionEngineLoaded",void 0),(0,r._)([(0,c.Cb)()],A.prototype,"_geometryEngine",void 0),A=(0,r._)([(0,h.j)(j)],A);const M=["contains","intersects","disjoint"];var q,D;function G(e,t,i){if(null==t)return null;if("disjoint"===i&&"polygon"===t.type){const i=t.rings.length,r=t.spatialReference,s=new Array(i);for(let e=0;e<i;++e){const i=(0,m.al)(1/0,1/0,-1/0,-1/0);(0,m.Wi)(i,t.rings[e]),s[e]={type:"polygon",rings:[t.rings[e]],spatialReference:r,cache:{},aabr:i}}s.sort(((e,t)=>e.aabr[0]-t.aabr[0]));const l=new Set,a=new n.SO;for(let t=0;t<s.length;++t){const i=s[t],r=i.aabr[0];l.forEach((t=>{if(r>=t.aabr[2])return void l.delete(t);if(i.aabr[1]>t.aabr[3]||i.aabr[3]<t.aabr[1]||!e.intersects(i,t))return;i.rings=i.rings.concat(t.rings),(0,m.jn)(i.aabr,t.aabr,i.aabr),i.cache={},l.delete(t);const o=(0,n.cq)(s,t,s.length,a);s.splice(o,1)})),l.add(i)}for(const e of s)e.aabr=void 0;return s}return[t]}function H(e,t,i,r,s){if(t[3]>=.5*(t[2]+(0,f.Iu)(r).radius))return!0;const n=k(e,t,r);return i.every((t=>N(e,t,n,s)!==q.DISCARD))}function T(e,t,i,r,s,n,l,a){const o=l[0].spatialReference||s.spatialReference;if(!(0,w.s)(i.node.serviceMbsInIndexSR,n,Z,o))return void Q().warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter");const u=k(e,Z,o),d=function(e,t,i,r,s){const n=t.renderSpatialReference,l=new Map,a={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:i};a.rings[0][3]=a.rings[0][0];const o={indices:null,data:null,stride:0,startIndex:0,endIndex:0};let u,d;switch(e){case"intersects":u=(e,t,i)=>e.intersects(t,i)?q.KEEP:q.TEST,d=V;break;case"contains":u=(e,t,i)=>e.contains(t,i)?q.TEST:q.DISCARD,d=V;break;default:u=(e,t,i)=>e.disjoint(t,i)?q.TEST:q.DISCARD,d=K}return{collection:r,object:s,type:e,maskSR:i,renderSR:n,aabbCache:l,triangle:a,positions:o,triangleTest:u,geometryTest:d}}(a,s,o,r,i.objectHandle);for(const r of l){if(0===t.length)return;switch(N(e,r,u,a)){case q.DISCARD:return void(t.length=0);case q.KEEP:continue}(0,R.hv)(t,i.featureIds,(t=>P(e,r,t,d)))}}(D=q||(q={}))[D.KEEP=0]="KEEP",D[D.DISCARD=1]="DISCARD",D[D.TEST=2]="TEST";const Z=(0,C.f)(0,0,0,0);function k(e,t,i){const r={type:"point",x:t[0],y:t[1],hasZ:!1,hasM:!1,spatialReference:i},s=!(0,S.oR)(i)&&!(0,S.sS)(i),n=Number.isNaN(t[3])?0:(0,a.uZ)(t[3],0,2*I.sv.radius),l=s?e.buffer(r,n,1):e.geodesicBuffer(r,n,1);return l.type="polygon",l}function N(e,t,i,r){switch(r){case"intersects":case"contains":return V(e,t,i);case"disjoint":return K(e,t,i)}}function V(e,t,i){return e.intersects(t,i)?e.contains(t,i)?q.KEEP:q.TEST:q.DISCARD}function K(e,t,i){return e.intersects(t,i)?e.contains(t,i)?q.DISCARD:q.TEST:q.KEEP}function P(e,t,i,r){const{collection:s,object:n,renderSR:l,maskSR:a,geometryTest:o,aabbCache:u}=r;let d=u.get(i);if(!d){const e=s.getObjectTransform(n);s.getComponentAabb(n,i,U);const t=[(0,p.al)(U[0],U[1],0),(0,p.al)(U[0],U[4],0),(0,p.al)(U[3],U[4],0),(0,p.al)(U[3],U[1],0)];for(let i=0;i<4;++i)(0,y.q)(t[i],t[i],e.rotationScale),(0,y.g)(t[i],t[i],e.position),(0,F.S)(t[i],l,t[i],a);d={type:"polygon",rings:[t],spatialReference:a,cache:{}},d.rings[0][4]=d.rings[0][0],u.set(i,d)}switch(o(e,t,d)){case q.DISCARD:return!1;case q.KEEP:return!0}const{triangle:c,triangleTest:h,positions:g}=r,f=c.rings[0][0],_=c.rings[0][1],b=c.rings[0][2],w=s.getObjectTransform(n);s.getComponentPositions(n,i,g);const{indices:v,data:m,stride:E,startIndex:I,endIndex:S}=g;for(let i=I;i<S;i+=3){const r=E*v[i],s=E*v[i+1],n=E*v[i+2];switch((0,y.i)(f,m[r],m[r+1],m[r+2]),(0,y.i)(_,m[s],m[s+1],m[s+2]),(0,y.i)(b,m[n],m[n+1],m[n+2]),(0,y.q)(f,f,w.rotationScale),(0,y.q)(_,_,w.rotationScale),(0,y.q)(b,b,w.rotationScale),(0,y.g)(f,f,w.position),(0,y.g)(_,_,w.position),(0,y.g)(b,b,w.position),(0,F.S)(f,l,f,a),(0,F.S)(_,l,_,a),(0,F.S)(b,l,b,a),h(e,t,c)){case q.DISCARD:return!1;case q.KEEP:return!0}}return"intersects"!==r.type}const U=(0,v.Ue)()},61498:(e,t,i)=>{i.d(t,{u:()=>f});var r=i(36663),s=i(74396),n=i(70375),l=i(61681),a=i(81977),o=(i(39994),i(13802),i(4157),i(40266)),u=i(91772),d=i(20375),c=i(21185),h=i(28790),y=i(51211),p=i(14626);const g=c.qq;let f=class extends s.Z{constructor(e){super(e)}initialize(){this.addHandles(this.layerView.on("visible-geometry-changed",(()=>this.spatialIndex.events.emit("changed"))))}destroy(){this._dataQueryEngineInstance=(0,l.SC)(this._dataQueryEngineInstance),this._set("layerView",null)}get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return new p.Z({outSpatialReference:this.spatialReference}).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}async executeQueryForCount(e,t){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)}async executeQueryForExtent(e,t){const{count:i,extent:r}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t);return{count:i,extent:u.Z.fromJSON(r)}}async executeQueryForIds(e,t){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)}async executeQuery(e,t){const i=this._ensureQueryJSON(e);if(i.returnGeometry)throw new n.Z("unsupported-query","returnGeometry is not supported when querying a mesh scene layer view, it is only supported when directly querying a scene layer");if(i.returnCentroid)throw new n.Z("unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");const r=await this._dataQueryEngine.executeQuery(i,t),s=y.Z.fromJSON(r);return s.features.forEach((e=>e.geometry=null)),s}_ensureQueryJSON(e){return null==e?this.defaultQueryJSON:e.toJSON()}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=this.layer.objectIdField||d.d,t=this.layer.fieldsIndex?.toJSON()||new h.Z([]),i=this.layerView.view.resourceController.scheduler,r=this.spatialReference.toJSON(),s=this.priority,n=this.spatialIndex;return this._dataQueryEngineInstance=new g({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fieldsIndex:t,timeInfo:null,spatialReference:r,objectIdField:e,featureStore:n,scheduler:i,priority:s}),this._dataQueryEngineInstance}};(0,r._)([(0,a.Cb)({constructOnly:!0})],f.prototype,"layerView",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],f.prototype,"priority",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],f.prototype,"spatialIndex",void 0),(0,r._)([(0,a.Cb)()],f.prototype,"spatialReference",null),(0,r._)([(0,a.Cb)()],f.prototype,"layer",null),(0,r._)([(0,a.Cb)()],f.prototype,"defaultQueryJSON",null),f=(0,r._)([(0,o.j)("esri.views.3d.layers.i3s.I3SQueryEngine")],f)},5002:(e,t,i)=>{i.d(t,{u:()=>a,w:()=>o});var r=i(37116),s=i(33480),n=i(15540),l=i(78565);class a{constructor(e){this._objectIdField=e.objectIdField,this._getFeatureExtent=e.getFeatureExtent}getObjectId(e){return e.id}getAttributes(e){const{meta:t,index:i}=e,r={};this._objectIdField&&(r[this._objectIdField]=e.id);const s=t.attributeInfo?.attributeData;if(null!=s)for(const e of Object.keys(s))r[e]=(0,l.Jx)(s[e],i);return r}getAttribute(e,t){if(t===this._objectIdField)return e.id;const{meta:i,index:r}=e,s=i.attributeInfo?.attributeData;return null!=s?(0,l.Jx)(s[t],r):null}getGeometry(e){if(e.geometry)return e.geometry;const[t,i,r,s,l]=this._getFeatureExtent(e,u);return new n.Z([5],[t,i,r,s,i,r,s,l,r,t,l,r,t,i,r])}getCentroid(e,t){if(e.geometry)return(0,s.Y)(new n.Z,e.geometry,t.hasZ,t.hasM);const[i,r,l,a,o,d]=this._getFeatureExtent(e,u);return new n.Z([0],[(i+a)/2,(r+o)/2,(l+d)/2])}cloneWithGeometry(e,t){const{id:i,index:r,meta:s}=e;return new o(i,r,s,t)}}class o{constructor(e,t,i,r){this.id=e,this.index=t,this.meta=i,this.geometry=r}get usedMemory(){return 32+(this.geometry?.usedMemory??0)}}const u=(0,r.Ue)()},57602:(e,t,i)=>{i.d(t,{I:()=>g});var r=i(36663),s=i(74396),n=i(27755),l=i(31355),a=i(81977),o=(i(13802),i(4157),i(40266)),u=i(20586),d=i(37116),c=i(24568),h=i(73687),y=i(78186);const p=(0,d.Ue)();let g=class extends s.Z{constructor(e){super(e),this.events=new l.Z}forEach(e){this.forAllFeatures((t=>(e(t),y.Ku.CONTINUE)))}forEachBounds(e,t){for(const i of e)t(this.getFeatureExtent(i,p))}forEachInBounds(e,t){this.forAllFeatures((i=>{const r=this.getFeatureExtent((0,n.CY)(i),_);return(0,c.kK)(e,(0,d.y8)(r,b))&&t((0,n.CY)(i)),y.Ku.CONTINUE}),(t=>{if((0,u.s)(t.node.serviceMbsInIndexSR,this.sourceSpatialReference,f,this.viewSpatialReference),f[0]>=e[0]&&f[2]<=e[2]&&f[1]>=e[1]&&f[3]<=e[3])return y.Ku.CONTINUE;const i=Math.max(e[0],Math.min(f[0],e[2])),r=Math.max(e[1],Math.min(f[1],e[3])),s=f[0]-i,n=f[1]-r;return s*s+n*n<=f[3]*f[3]?y.Ku.CONTINUE:y.Ku.SKIP}))}};(0,r._)([(0,a.Cb)({constructOnly:!0})],g.prototype,"featureAdapter",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],g.prototype,"forAllFeatures",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],g.prototype,"getFeatureExtent",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],g.prototype,"sourceSpatialReference",void 0),(0,r._)([(0,a.Cb)({constructOnly:!0})],g.prototype,"viewSpatialReference",void 0),g=(0,r._)([(0,o.j)("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],g);const f=(0,h.f)(0,0,0,0),_=(0,d.Ue)(),b=(0,c.Ue)()}}]);