"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[79013],{70598:(e,t,n)=>{n.d(t,{fE:()=>D,AX:()=>B,jR:()=>A});var i,r=n(66341),o=n(70375),s=n(86114),a=(n(12065),n(15540)),l=n(14685);class c{constructor(){this.version="",this.queryResult=new u}}class u{constructor(){this.featureResult=new d}}class d{constructor(){this.objectIdFieldName="",this.uniqueIdField=new p,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new h,this.geometryType=null,this.spatialReference=new l.Z,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new y,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}}class p{constructor(){this.name="",this.isSystemMaintained=!1}}class h{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}}class y{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new f,this.translate=new m}}class f{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}}class m{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}}class g{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}}class b{constructor(){this.attributes=[],this.compressedGeometry=new _,this.centroid=new _,this.aggregateGeometries=[]}}class _{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}}!function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"}(i||(i={}));const w=[i.ELEMENTUID,i.TYPENAME];var I,T;!function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"}(I||(I={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(T||(T={}));var M,C,E,x,v=n(65726),S=n(79458);function k(e){const t=new _;t.geometryType=S.Ks[e.geometry_type.value];const n=[],i=[];for(let t=0;t<e.lengths.length;t++)n.push(e.lengths[t]);for(let t=0;t<e.coords.length;t++)i.push(e.coords[t]);return t.lengths=n,t.coords=i,t}function N(e){const t=new g;return t.name=e.name,t.alias=e.alias,t.fieldType=S.jC[e.field_type.value],t.sqlType=E[e.sql_type.value],t.domain=e.domain,t.defaultValue=e.default_value,t}function L(e){const t=N(e);return t.geometryType=S.Ks[e.geometry_type.value],t}function R(e){const t=new y;t.quantizeOriginPosition=C[e.quantizeOriginPosition.value];const n=t.scale,i=e.scale;n.xScale=i.xScale,n.yScale=i.yScale,n.mScale=i.mScale,n.zScale=i.zScale;const r=t.translate,o=e.translate;return r.xTranslate=o.xTranslate,r.yTranslate=o.yTranslate,r.mTranslate=o.mTranslate,r.zTranslate=o.zTranslate,t}async function D(e,t){t??=!1;const n={generateAllSublayers:t,namedTypeDefinitions:new Map};return await async function(e){const t=await(0,r.Z)(e,{responseType:"array-buffer"}),n=await t.data;return async function(e){const t=new((await(0,v.$G)()).MapOfObjectIdentifierSetsDecoder),n=t.decode(new Uint8Array(e)),i=new Map;if(0!==n.error_code)throw new o.Z("knowledge-graph:layer-support-utils",n.error_message);const r=t.get_map_of_identifier_sets(),s=r.keys,a=s.size();for(let e=0;e<a;e++){const t=s.get(e),n=r.query_identifier_set(t),a=[];if(n.id_array_type.value===x.GLOBALID_ARRAY){const e=n.get_globalid_array(),t=e.count();for(let n=0;n<t;n++)a.push(e.get_globalid_at(n))}else if(n.id_array_type.value===x.IDENTIFIER_ARRAY){const e=n.get_identifier_array(),t=e.count();for(let n=0;n<t;n++)a.push(e.get_identifier_at(n).toString())}else if(n.id_array_type.value===x.STRING_ARRAY){const e=n.get_string_array(),t=e.count();for(let n=0;n<t;n++)a.push(e.get_string_at(n))}else{if(n.id_array_type.value!==x.OID_ARRAY)throw new o.Z("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const e=n.get_oid_array(),t=e.count();for(let n=0;n<t;n++)a.push(e.get_objectid_at(n).toString())}}i.set(t,a)}return t.delete(),i}(new Uint8Array(n))}(e).then((e=>{!function(e,t){for(const[n,i]of e){const e=(0,s.s1)(t.namedTypeDefinitions,n,(()=>({useAllData:!1,members:new Map})));for(const t of i)e.members.has(t)||e.members.set(t,{id:t})}}(e,n)})),n}async function A(e){const t=await(0,v.$G)(),n=new t.MapOfObjectIdentifierSets;!function(e,t,n){for(const[i,r]of n.namedTypeDefinitions){if(!r.members||r.useAllData)continue;const n=r.members.keys();let o=!1,s=!0;const a=new t.ObjectIdArray,l=new t.StringArray,c=new t.GlobalIdArray,u=new t.IdentifierArray,d=new t.ObjectIdentifierSet;for(const e of n)s&&(o=!isNaN(Number(e)),s=!1),o?a.add_objectid(Number(e)):(l.add_string(e),c.add_globalid(e)),u.add_identifier(e);d.set_oid_array(a),d.set_string_array(l),d.set_globalid_array(c),d.set_identifier_array(u),a.delete(),l.delete(),c.delete(),u.delete(),e.put_identifier_set(i,d),d.delete()}}(n,t,e);const i=new t.MapOfObjectIdentifierSetsEncoder;try{i.set_map_of_identifier_sets(n),i.encode();const e=i.get_encoding_result();if(0!==e.error.error_code)throw new o.Z("knowledge-graph:layer-support-utils",e.error.error_message);const t=structuredClone(e.get_byte_buffer());return i.delete(),t}finally{n.delete()}}async function j(e){const t=await(0,r.Z)(e,{responseType:"array-buffer"});return async function(e){const t=new((await(0,v.$G)()).FeatureCollectionDecoder),n=t.decode(new Uint8Array(e));if(0!==n.error_code)throw new o.Z("knowledge-graph:layer-support-utils",n.error_message);const i=t.get_feature_collection(),r=function(e){const t=new c;t.version=e.version;const n=e.get_query_result();if(0!==n.results_type.value)throw new Error("Got a non-feature collection type");const i=n.get_feature_result(),r=t.queryResult.featureResult;r.objectIdFieldName=i.objectid_field_name,r.exceededTransferLimit=i.exceeded_transfer_limit,r.hasM=i.has_m,r.hasZ=i.has_z,r.geometryType=S.Ks[i.geometry_type.value],r.globalIdFieldName=i.globalid_field_name,r.geohashFieldName=i.geohash_field_name;const o=r.uniqueIdField,s=i.unique_id_field;o.name=s.name,o.isSystemMaintained=s.isSystemMaintained;const a=r.geometryProperties,l=i.geometry_properties;a.shapeAreaFieldName=l.shapeAreaFieldName,a.shapeLengthFieldName=l.shapeLengthFieldName,a.units=l.units;const u=r.spatialReference,d=i.spatial_reference;u.wkid=d.wkid,u.latestWkid=d.latestWkid,u.vcsWkid=d.vcsWkid,u.latestVcsWkid=d.latestVcsWkid,u.wkt=d.wkt,r.transform=R(i.transform);const p=r.fields,h=r.fieldNameToAttributeIndexMap,y=i.fields,f=y.size();for(let e=0;e<f;e++){const t=y.get(e),n=N(t);p.push(n),h[n.name]=e,t.delete()}y.delete();const m=r.values,g=i.values_count();for(let e=0;e<g;e++)m.push(i.get_value_at(e));const _=r.features,I=i.features,T=I.size();if(T>0)for(const e of w)if(void 0===h[e])throw new Error(`Feature collection missing required attribute: ${e}`);for(let e=0;e<T;e++){const t=new b,n=I.get(e),i=t.attributes,r=n.attributes_count();for(let e=0;e<r;e++)i.push(n.get_attribute_at(e));const o=n.get_compressed_geometry();o&&(t.compressedGeometry=k(o),t.centroid=k(n.get_centroid()));const s=t.aggregateGeometries,a=n.aggregate_geometries,l=a.size();for(let e=0;e<l;e++){const t=a.get(e),n=k(t);s.push(n),t.delete()}a.delete(),_.push(t),n.delete()}I.delete();const M=r.geometryFields,C=i.geometry_fields,E=C.size();for(let e=0;e<E;e++){const t=C.get(e),n=L(t);M.push(n),t.delete()}return C.delete(),t}(i);return t.delete(),r}(await t.data)}function F(e,t){if(!e?.queryResult?.featureResult)return t;const n=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(const r of e.queryResult.featureResult.features){const e=r.attributes[n[i.TYPENAME]],o=(0,s.s1)(t.namedTypeDefinitions,e,(()=>({useAllData:!1,members:new Map}))),l=r.attributes[n[i.ELEMENTUID]];if(r.compressedGeometry?.coords?.length>0){let e=r.compressedGeometry.lengths;"esriGeometryPoint"===r.compressedGeometry.geometryType&&(e=[]),o.members.set(l,{id:l,linkChartLocation:new a.Z(e,r.compressedGeometry.coords)})}else o.members.set(l,{id:l})}return t}!function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"}(M||(M={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(C||(C={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(E||(E={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(x||(x={}));const B={fetchAndConvertSerializedLinkChart:e=>async function(e){const t=[],n={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(j(e.entitiesUrl).then((e=>{F(e,n)}))),e.relationshipsUrl&&t.push(j(e.relationshipsUrl).then((e=>{F(e,n)}))),await Promise.all(t),n}(e)}},26488:(e,t,n)=>{n.d(t,{Q:()=>a,b:()=>E});var i=n(7753),r=n(27755),o=(n(39994),n(17135)),s=n(80657);class a{constructor(e=9,t){this._compareMinX=p,this._compareMinY=h,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),I.prune(),T.prune(),M.prune(),C.prune()}all(e){l(this._data,e)}search(e,t){let n=this._data;const i=this._toBBox;if(_(e,n))for(I.clear();n;){for(let r=0,o=n.children.length;r<o;r++){const o=n.children[r],s=n.leaf?i(o):o;_(e,s)&&(n.leaf?t(o):b(e,s)?l(o,t):I.push(o))}n=I.pop()}}collides(e){let t=this._data;const n=this._toBBox;if(!_(e,t))return!1;for(I.clear();t;){for(let i=0,r=t.children.length;i<r;i++){const r=t.children[i],o=t.leaf?n(r):r;if(_(e,o)){if(t.leaf||b(e,o))return!0;I.push(r)}}t=I.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new v([]),this}remove(e){if(!e)return this;let t,n=this._data,o=null,s=0,a=!1;const l=this._toBBox(e);for(M.clear(),C.clear();n||M.length>0;){if(n||(n=M.pop(),o=M.data[M.length-1],s=C.pop()??0,a=!0),n.leaf&&(t=(0,i.cq)(n.children,(0,r.CY)(e),n.children.length,n.indexHint),-1!==t))return n.children.splice(t,1),M.push(n),this._condense(M),this;a||n.leaf||!b(n,l)?o?(s++,n=o.children[s],a=!1):n=null:(M.push(n),C.push(s),s=0,o=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,n,i){const r=n-t+1;let o=this._maxEntries;if(r<=o){const i=new v(e.slice(t,n+1));return c(i,this._toBBox),i}i||(i=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/o**(i-1)));const s=new S([]);s.height=i;const a=Math.ceil(r/o),l=a*Math.ceil(Math.sqrt(o));w(e,t,n,l,this._compareMinX);for(let r=t;r<=n;r+=l){const t=Math.min(r+l-1,n);w(e,r,t,a,this._compareMinY);for(let n=r;n<=t;n+=a){const r=Math.min(n+a-1,t);s.children.push(this._build(e,n,r,i-1))}}return c(s,this._toBBox),s}_insert(e,t,n){const i=this._toBBox,r=n?e:i(e);M.clear();const o=function(e,t,n,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==n;){let n,i=1/0,r=1/0;for(let o=0,s=t.children.length;o<s;o++){const s=t.children[o],a=y(s),l=m(e,s)-a;l<r?(r=l,i=a<i?a:i,n=s):l===r&&a<i&&(i=a,n=s)}t=n||t.children[0]}return t}(r,this._data,t,M);for(o.children.push(e),d(o,r);t>=0&&M.data[t].children.length>this._maxEntries;)this._split(M,t),t--;!function(e,t,n){for(let i=n;i>=0;i--)d(t.data[i],e)}(r,M,t)}_split(e,t){const n=e.data[t],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);const o=this._chooseSplitIndex(n,r,i);if(!o)return;const s=n.children.splice(o,n.children.length-o),a=n.leaf?new v(s):new S(s);a.height=n.height,c(n,this._toBBox),c(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(n,a)}_splitRoot(e,t){this._data=new S([e,t]),this._data.height=e.height+1,c(this._data,this._toBBox)}_chooseSplitIndex(e,t,n){let i,r,o;i=r=1/0;for(let s=t;s<=n-t;s++){const t=u(e,0,s,this._toBBox),a=u(e,s,n,this._toBBox),l=g(t,a),c=y(t)+y(a);l<i?(i=l,o=s,r=c<r?c:r):l===i&&c<r&&(r=c,o=s)}return o}_chooseSplitAxis(e,t,n){const i=e.leaf?this._compareMinX:p,r=e.leaf?this._compareMinY:h;this._allDistMargin(e,t,n,i)<this._allDistMargin(e,t,n,r)&&e.children.sort(i)}_allDistMargin(e,t,n,i){e.children.sort(i);const r=this._toBBox,o=u(e,0,t,r),s=u(e,n-t,n,r);let a=f(o)+f(s);for(let i=t;i<n-t;i++){const t=e.children[i];d(o,e.leaf?r(t):t),a+=f(o)}for(let i=n-t-1;i>=t;i--){const t=e.children[i];d(s,e.leaf?r(t):t),a+=f(s)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){const n=e.data[t];if(0===n.children.length)if(t>0){const r=e.data[t-1],o=r.children;o.splice((0,i.cq)(o,n,o.length,r.indexHint),1)}else this.clear();else c(n,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function l(e,t){let n=e;for(T.clear();n;){if(!0===n.leaf)for(const e of n.children)t((0,r.CY)(e));else T.pushArray(n.children);n=T.pop()??null}}function c(e,t){u(e,0,e.children.length,t,e)}function u(e,t,n,i,r){r||(r=new v([])),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o,s=t;s<n;s++)o=e.children[s],d(r,e.leaf?i(o):o);return r}function d(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function p(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function y(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function g(e,t){const n=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,r-n)*Math.max(0,o-i)}function b(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function w(e,t,n,i,r){const o=[t,n];for(;o.length;){const t=o.pop(),n=o.pop();if(t-n<=i)continue;const a=n+Math.ceil((t-n)/i/2)*i;(0,s.q)(e,a,n,t,r),o.push(n,a,a,t)}}const I=new o.Z,T=new o.Z,M=new o.Z,C=new o.Z({deallocator:void 0});class E{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class x extends E{constructor(){super(...arguments),this.height=1,this.indexHint=new i.SO}}class v extends x{constructor(e){super(),this.children=e,this.leaf=!0}}class S extends x{constructor(e){super(),this.children=e,this.leaf=!1}}},117:(e,t,n)=>{n.d(t,{H:()=>l});var i=n(39994),r=n(26488),o=n(24568);const s={minX:0,minY:0,maxX:0,maxY:0};function a(e,t,n){(function(e){s.minX=e[0],s.minY=e[1],s.maxX=e[2],s.maxY=e[3]})(t),e.search(s,n)}class l{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new r.Q(9,(0,i.Z)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((n,i)=>{e[t++]=i})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,o.cS)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),a(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},69400:(e,t,n)=>{n.d(t,{Z:()=>y});var i=n(7753),r=n(70375),o=n(31355),s=n(13802),a=n(37116),l=n(24568),c=n(12065),u=n(117),d=n(28098),p=n(12102);const h=(0,a.Ue)();class y{constructor(e){this.geometryInfo=e,this._boundsStore=new u.H,this._featuresById=new Map,this._usedMemory=0,this.events=new o.Z,this.featureAdapter=p.n}get usedMemory(){return this._usedMemory}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,n,i,r]=this.fullBounds;return{xmin:t,ymin:n,xmax:i,ymax:r,spatialReference:(0,d.S2)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(e){const t=e.map((e=>this._upsert(e)));return this._emitChanged(),t.filter(i.pC)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged(),this._usedMemory=0}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const n of e){const e=this._boundsStore.get(n.objectId);e&&t((0,a.JR)(h,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void s.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new r.Z("featurestore:invalid-feature","feature id is missing",{feature:e}));const n=this._featuresById.get(t);let i;if(n?(e.displayId=n.displayId,i=this._boundsStore.get(t),this._boundsStore.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(n)??0):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);i=(0,c.$)(null!=i?i:(0,l.Ue)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=i&&this._boundsStore.set(t,i),this._featuresById.set(t,e),this._usedMemory+=this.estimateFeatureUsedMemory?.(e)??0}_upsert(e){const t=e?.objectId;if(null==t)return s.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new r.Z("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const n=this._featuresById.get(t);if(!n)return this._add(e),e;this._usedMemory-=this.estimateFeatureUsedMemory?.(n)??0;const{geometry:i,attributes:o}=e;for(const e in o)n.attributes[e]=o[e];return i&&(n.geometry=i,this._boundsStore.set(t,(0,c.$)((0,l.Ue)(),i,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),this._usedMemory+=this.estimateFeatureUsedMemory?.(n)??0,n}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._boundsStore.delete(t),this._featuresById.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(e)??0,e}}},12102:(e,t,n)=>{n.d(t,{n:()=>r});var i=n(59958);const r={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new i.u_(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)}},40400:(e,t,n)=>{n.d(t,{Dm:()=>u,Hq:()=>p,MS:()=>h,bU:()=>a});var i=n(39994),r=n(67134),o=n(10287),s=n(86094);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.I4:"esriGeometryPolyline"===e?s.ET:s.lF}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let c=1;function u(e,t){if((0,i.Z)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let n=`this${d(t)} = null;`;for(const t in e)n+=`this${d(t)} = ${JSON.stringify(e[t])};`;const i=new Function(`\n      return class AttributesClass$${c++} {\n        constructor() {\n          ${n};\n        }\n      }\n    `)();return()=>new i}catch(n){return()=>({[t]:null,...e})}}function d(e){return l.test(e)?`.${e}`:`["${e}"]`}function p(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,r.d9)(e)}}]}function h(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:o.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:o.e,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},79847:(e,t,n)=>{n.d(t,{Q:()=>T});var i=n(36663),r=n(74396),o=n(70375),s=n(13802),a=n(86114),l=n(78668),c=n(84684),u=n(81977),d=(n(39994),n(4157),n(40266)),p=n(91772),h=n(89542),y=n(90472),f=n(35925),m=n(72542),g=n(32410),b=n(68188),_=n(19893),w=n(76512),I=n(14626);let T=class extends r.Z{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach((n=>{n.name&&(t.set(n.name,"entity"),this._processingCacheUpdatesLookup.set(n.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(n.name),n.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(n.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((n=>{n.name&&(t.set(n.name,"relationship"),this._processingCacheUpdatesLookup.set(n.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(n.name),n.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(n.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((n,i)=>{if("entity"===t.get(i))this.entityTypeNames.add(i);else{if("relationship"!==t.get(i))return s.Z.getLogger(this).warn(`A named type, ${i}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(i);this.relationshipTypeNames.add(i)}const r=new Map;n.members?.forEach((e=>{(0,a.s1)(this.memberIdTypeLookup,e.id,(()=>new Set)).add(i);const t=this.getById(e.id);t&&r.set(e.id,t)})),this.sublayerCaches.set(i,r)}))}addToLayer(e){e.forEach((({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new o.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){const n=this.inclusionModeDefinition.namedTypeDefinitions.get(e);n.members||(n.members=new Map),n.members.set(t,{id:t}),(0,a.s1)(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}else{const n=new Map;n.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:n}),(0,a.s1)(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}))}getById(e){return g.Z.getInstance().readFromStoreById(e)}async getData(e,t,n){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let i;if(i=e||new I.Z({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,n=this._processingCacheUpdatesLookup.get(t.objectType.name??""),r=i.outFields;r&&1===r.length&&r[0]===m.mR&&"1=1"===i.where||await Promise.all(n??[]);const o=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],s=[];return o.forEach((n=>{if(this.relationshipTypeNames.has(t.objectType.name)){n.geometry=e.relationshipLinkChartDiagramLookup.get(n.attributes[t.objectIdField]);const i=this.memberIdTypeLookup.get(n.attributes[m.TY]),r=this.memberIdTypeLookup.get(n.attributes[m.l6]),o=this._isEndEntitySpatial(i,n,m.TY),s=this._isEndEntitySpatial(r,n,m.l6);n.attributes[m._k]=Number(o&&s)}else{n.geometry=e.entityLinkChartDiagramLookup.get(n.attributes[t.objectIdField]);const i=this.geographicLookup.get(t.objectType.name);i&&n.attributes[i.name]?n.attributes[m._k]=1:n.attributes[m._k]=0}n.attributes[m.xD]=n.geometry,s.push(n)})),s}return this.retrieveDataFromService(i,t,n)}async getConnectedRecordIds(e,t,n){const i=[];let r="";const o=this._getNamedTypeIdMapFromNodeIds(e);if(t&&0!==t?.length){for(const e of t)r=r+e+"|";r=r.slice(0,-1)}const s={},a=[];for(const[e,n]of o){const i=`${e}_ids`;s[i]=n,t&&0!==t?.length?a.push(`MATCH (n:${e}) WHERE id(n) IN $${i} WITH n MATCH (n)-[r:${r}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):a.push(`MATCH (n:${e}) WHERE id(n) IN $${i} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!a.length)return i;const l=a.join(" UNION "),c=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,new w.Z({openCypherQuery:l,bindParameters:s}),{signal:n?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await c.read();if(e)break;for(let e=0;e<t.length;e++){const n=t[e];i.push({id:n[0],typeName:n[1]}),i.push({id:n[2],typeName:n[3]})}}return i}async getRelationshipsBetweenNodes(e,t,n){const i=this._getNamedTypeIdMapFromNodeIds(e);if(0===i.size)return[];const r={relationshipExclusionIds:t,possibleConnectionEntityIds:e},o=[];for(const[e,t]of i.entries()){const n=`${e}_ids`;r[n]=t,o.push(`MATCH (n:${e}) WHERE id(n) IN $${n} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const s=o.join(" UNION "),a=[],l=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,new w.Z({openCypherQuery:s,bindParameters:r}),{signal:n?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await l.read();if(e)break;for(let e=0;e<t.length;e++){const n=t[e];a.push({id:n[0],typeName:n[1]})}}return a}async getRelationshipsFromNodes(e,t,n,i){const r=this._getNamedTypeIdMapFromNodeIds(e);if(0===r.size||0===t.length)return[];const o={relationshipExclusionIds:n,possibleConnectionEntityIds:t},s=[];for(const[e,t]of r.entries()){const n=`${e}_ids`;o[n]=t,s.push(`MATCH (n:${e}) WHERE id(n) IN $${n} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const a=s.join(" UNION "),l=new Map,c=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,new w.Z({openCypherQuery:a,bindParameters:o}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await c.read();if(e)break;for(let e=0;e<t.length;e++){const n=t[e];let i=l.get(n[1]);i||(i=new Set,l.set(n[1],i)),i.add(n[0])}}const u=[];for(const[e,t]of l)for(const n of t)u.push({id:n,typeName:e});return u}async refreshCacheContent(e,t,n,i=!0,r){const s=g.Z.getInstance(),c=[],u=new Map,d=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&d.set(e.name,e)})),this.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&d.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const t of this.memberIdTypeLookup.get(e))u.has(t)?u.get(t)?.push(e):u.set(t,[e])})):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e.useAllData?u.set(t,null):e.members&&e.members.forEach((e=>{u.has(t)&&null!==u.get(t)?u.get(t)?.push(e.id):u.set(t,[e.id])}))})):(this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&u.set(e.name,null)})),this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&u.set(e.name,null)})));for(const[e,l]of u){const u=new Set(l),p=new Promise(((c,p)=>{(async()=>{const c=new Set,p=[];let h,y="",f=!1;if(t||d.get(e)?.properties?.forEach((e=>{e.name&&c.add(e.name)})),n&&this.geographicLookup.has(e)){const t=this.geographicLookup.get(e)?.name;t&&c.add(t)}if(this.entityTypeNames.has(e))y=`MATCH (n:${e}) ${l?"WHERE id(n) IN $ids ":""}return ID(n)`,c.forEach((e=>{y+=`, n.${e}`,p.push(e)}));else{if(!this.relationshipTypeNames.has(e))throw new o.Z("knowledge-graph:layer-data-manager",`The graph type of ${e} could not be determined. Was this type set in the KG data model and inclusion definition?`);f=!0,y=`MATCH ()-[n:${e}]->() ${l?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,c.forEach((e=>{y+=`, n.${e}`,p.push(e)}))}h=new w.Z(l?{openCypherQuery:y,bindParameters:{ids:l}}:{openCypherQuery:y});const g=(await(0,_.executeQueryStreaming)(this.knowledgeGraph,h,{signal:r?.signal})).resultRowsStream.getReader();for(;;){const{done:t,value:n}=await g.read();if(t)break;const r=[];for(let e=0;e<n.length;e++){const t=n[e];let i=0,o=0;const s={properties:{}};for(s.id=t[i],i++,o++,f&&(s.originId=t[i],i++,o++,s.destinationId=t[i],i++,o++,(0,a.s1)(this.nodeConnectionsLookup,s.originId,(()=>new Set)).add(s.id),(0,a.s1)(this.nodeConnectionsLookup,s.destinationId,(()=>new Set)).add(s.id),(0,a.s1)(this.relationshipConnectionsLookup,s.id,(()=>[s.originId,s.destinationId])));i<t.length;i++)s.properties[p[i-o]]=t[i];u.delete(s.id),r.push(s)}const o=s.writeToStore(r,m.mR,this.geographicLookup.get(e)?.name);this.sublayerCaches.has(e)||this.sublayerCaches.set(e,new Map),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(e)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(e,{useAllData:!1,members:new Map}),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(e).members=new Map);const l=this.sublayerCaches.get(e);o.forEach((t=>{l?.set(t.attributes[m.mR],t),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.has(t.attributes[m.mR])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.set(t.attributes[m.mR],{id:t.attributes[m.mR]}),(0,a.s1)(this.memberIdTypeLookup,t.attributes[m.mR],(()=>new Set)).add(e))}))}const b=this.inclusionModeDefinition?.namedTypeDefinitions.get(e);if(b)for(const e of u)b.members?.delete(e)})().then((()=>{c(null)})).catch((e=>{"AbortError"===e.name?c(null):p(e)}))}));c.push(p),this._processingCacheUpdatesLookup.get(e)?.push(p)}if(await Promise.all(c),r?.signal?.aborted)throw(0,l.zE)()}removeFromLayer(e){const t=new Set,n=new Set(e.map((e=>e.id)));for(const n of e)t.add(n.typeName),1===this.memberIdTypeLookup.get(n.id)?.size?this.memberIdTypeLookup.delete(n.id):this.memberIdTypeLookup.get(n.id)?.delete(n.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{t===n.typeName&&e.members?.has(n.id)&&e.members.delete(n.id)}));t.forEach((e=>{this.sublayerCaches.get(e)?.forEach(((t,i)=>{n.has(i)&&this.sublayerCaches.get(e)?.delete(i)}))}))}async retrieveDataFromService(e,t,n){const i=g.Z.getInstance(),r=new Set,s=[];let a,l="",u=[];const d="relationship"===t.graphType,I=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,T=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let M=!I&&T?Array.from(T).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(M=e.objectIds);else if(null!=e.objectIds&&M&&M.length>0){const t=e.objectIds;e.objectIds=M.filter((e=>t.includes(e)))}else if(null!=e.objectIds)M=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=M}if(null!=e.outFields){const n=e.outFields;n.includes("*")?t.fields.forEach((e=>{r.add(e.name)})):n.forEach((e=>{e!==m.mR&&e!==t.geometryFieldName&&r.add(e)}))}if(null!=e.geometry){const n=e.geometry;let i;const u=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,m=u?.spatialReference,g=u?.serviceCapabilities?.geometryCapabilities;let _=g?.geometryMaxBoundingRectangleSizeX,I=g?.geometryMaxBoundingRectangleSizeY;if("point"===n.type){let e=n;e.spatialReference?.isWGS84||(await(0,y.initializeProjection)(e.spatialReference,f.YU),e=(0,y.project)(e,f.YU)),i=new p.Z({spatialReference:f.YU,xmin:e.x-1e-4,ymin:e.y-1e-4,xmax:e.x+1e-4,ymax:e.y+1e-4})}else n?.extent?.spatialReference&&!n.spatialReference?.isWGS84?(await(0,y.initializeProjection)(n.extent.spatialReference,f.YU),i=(0,y.project)(n.extent,f.YU)):i=n.extent;if(_&&I&&m){if(4326!==m.wkid){const e=new p.Z({spatialReference:m,xmax:_,ymax:I}),t=(0,y.project)(e,f.YU);_=t.xmax,I=t.ymax}if(i.xmax-i.xmin>_)throw new o.Z("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${_}° latitude, limit exceeded`);if(i.ymax-i.ymin>I)throw new o.Z("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${I}° longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const n=await(0,c.EP)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&r.add(e.name)}))}l=d?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&r.add(t.geometryFieldName),r.forEach((e=>{l+=`, n.${e}`,s.push(e)})),a=new w.Z({openCypherQuery:l,bindParameters:{param_filter_geom:new h.Z({rings:(0,b.YD)(i)})}})}else{let n="";if(null!=e.where&&"1=1"!==e.where){const i=await(0,c.EP)(e.where,t.fieldsIndex);t.fields.forEach((e=>{i.fieldNames.includes(e.name)&&r.add(e.name)}));const o=new Set(["column-reference","string","number","binary-expression"]),s=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let a=!1;const l=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&o.has(e.left.type)&&o.has(e.right.type)&&s.has(e.operator))return`${l(e.left)} ${e.operator} ${l(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return a=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return a=!0,"";{let n=e.right.value;"%"===n.charAt(0)&&(n=n.slice(1)),"%"===n.charAt(n.length-1)&&(n=n.slice(0,-1)),t+=`'${n.toLowerCase()}')`}return t}return a=!0,""};n=l(i.parseTree),a&&(n="")}let i="";i=d?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let o=!1;M&&(o=!0,i+=" WHERE ID(n) IN $ids"),n&&(i+=o?" AND":" WHERE",i+=` ${n}`),i+=" return ID(n)",d&&(i+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&r.add(t.geometryFieldName),r.forEach((e=>{i+=`, n.${e}`,s.push(e)})),a=new w.Z(M?{openCypherQuery:i,bindParameters:{ids:M}}:{openCypherQuery:i})}const C=(await(0,_.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,a,n)).resultRowsStream.getReader();for(;;){const{done:e,value:n}=await C.read();if(e)break;const r=[];for(let e=0;e<n.length;e++){const t=n[e];let i=0,o=0;const a={properties:{}};for(a.id=t[i],i++,o++,d&&(a.originId=t[i],i++,o++,a.destinationId=t[i],i++,o++);i<t.length;i++)a.properties[s[i-o]]=t[i];r.push(a)}u=u.concat(i.writeToStore(r,m.mR,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return u}_isEndEntitySpatial(e,t,n){for(const i of e??[])if(this.entityTypeNames.has(i)){const e=this.geographicLookup.get(i),r=e&&this.sublayerCaches.get(i)?.get(t.attributes[n]);if(e&&r?.attributes[e.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){const t=new Map;return e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const n of this.memberIdTypeLookup.get(e)){if(!this.entityTypeNames.has(n))return;t.has(n)?t.get(n)?.push(e):t.set(n,[e])}})),t}};(0,i._)([(0,u.Cb)()],T.prototype,"knowledgeGraph",void 0),(0,i._)([(0,u.Cb)()],T.prototype,"inclusionModeDefinition",void 0),(0,i._)([(0,u.Cb)()],T.prototype,"entityTypeNames",void 0),(0,i._)([(0,u.Cb)()],T.prototype,"relationshipTypeNames",void 0),(0,i._)([(0,u.Cb)()],T.prototype,"geographicLookup",void 0),(0,i._)([(0,u.Cb)()],T.prototype,"sublayerCaches",void 0),(0,i._)([(0,u.Cb)()],T.prototype,"nodeConnectionsLookup",void 0),(0,i._)([(0,u.Cb)()],T.prototype,"relationshipConnectionsLookup",void 0),(0,i._)([(0,u.Cb)()],T.prototype,"memberIdTypeLookup",void 0),T=(0,i._)([(0,d.j)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],T)},45271:(e,t,n)=>{n.d(t,{Z:()=>ie});var i=n(36663),r=n(80020),o=n(67134),s=n(13802),a=n(15842),l=(n(62517),n(81977)),c=(n(39994),n(40266)),u=n(39835),d=n(65943),p=n(91772),h=n(10186),y=n(89542),f=n(90819),m=n(90472),g=n(14685),b=n(35925),_=n(59659),w=n(38481),I=n(69400),T=n(21185),M=n(40400),C=n(72542);n(4157);const E=(0,n(89076).v)(),x=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,i._)([(0,l.Cb)(E.fields)],t.prototype,"fields",void 0),(0,i._)([(0,l.Cb)(E.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,i._)([(0,c.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t};var v=n(18928),S=n(27668),k=n(45865),N=n(22368),L=n(53268),R=n(91610),D=n(12478),A=n(95874),j=n(2030),F=n(23072),B=n(93159),Z=n(12512),O=n(14845),P=n(7923),G=n(49341),Y=n(23756),q=n(50172),$=n(72506),U=n(88623),z=n(51211),X=n(14626),Q=n(10171),H=n(59672),V=n(56481);function W(e){if(!e.json)return e;e.json.write=J(e.json.write);const t=e.json.origins;if(!t)return e;let n;for(n in t){const e=t[n];e&&(e.write=J(e.write))}return e}function J(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){const{target:t,writer:n,overridePolicy:i,...r}=e;return function(e,t){const n=ee.call(this,e,t);return n.enabled?{...r,...n}:n}}(e)),e):!0===e?K():e}function K(){return{overridePolicy:ee}}function ee(e,t){const n=!!this.geometryType;let i={enabled:n};return n&&(i={...i,...te.call(this,e,t)}),i}function te(e,t){return{ignoreOrigin:this.originIdOf(t)>d.s3.DEFAULTS}}let ne=class extends(x((0,k.tM)((0,L.M)((0,N.b)((0,S.h7)((0,R.c_)((0,j.n)((0,A.M)((0,D.Q)((0,a.R)(w.Z))))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=(0,M.MS)(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=C.mR,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then((()=>{const e=new MessageChannel;return new V.Z(e.port1,{channel:e,client:{queryFeatures:(e,t={})=>{const n=X.Z.fromJSON(e);return this.queryFeaturesJSON(n,t)}}}),[e.port2]}))},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){const e=[];return this.objectType?.properties?.forEach((t=>{const n="esriFieldTypeOID"===t.fieldType?"esriFieldTypeInteger":t.fieldType;e.push(Z.Z.fromJSON({name:t.name,type:n,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))})),e.push(Z.Z.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),Z.Z.fromJSON({name:C._P,type:"esriFieldTypeInteger",alias:C._P,editable:!1}),Z.Z.fromJSON({name:C._k,type:"esriFieldTypeInteger",alias:C._k,editable:!1})),e}get geometryType(){if("link-chart"===this.parentCompositeLayer?.type)return"relationship"===this.graphType?"polyline":"point";const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&"esriGeometryNull"!==t?_.Mk.fromJSON(t):null}get geometryFieldName(){if("link-chart"===this.parentCompositeLayer?.type)return C.xD;const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name);return e?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasM??!1}get hasZ(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasZ??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");const e=this.objectType.properties?(0,v.wn)(this.objectType.properties):"ESRI__ID";return"link-chart"===this.parentCompositeLayer.type?(0,v.fC)(this.graphType,this.graphTypeName,e):(0,v.R4)(this.graphTypeName,this.geometryType,e)}set renderer(e){(0,O.YN)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");const e=this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel,t=[...e?.entityTypes??[],...e?.relationshipTypes??[]].map((e=>e.name)).indexOf(this.graphTypeName),n=(0,v.Jr)(t);if("link-chart"===this.parentCompositeLayer?.type){if("relationship"===this.graphType)return new q.Z({type:"simple",symbol:(0,v.I)(n)});const e=(0,$.i)((0,M.bU)(_.Mk.toJSON("point")).renderer);return(0,H.tb)(e.symbol,n),e}const i=(0,$.i)((0,M.bU)(_.Mk.toJSON(this.geometryType)).renderer);return(0,H.tb)(i.symbol,n),i}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??g.Z.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return(0,Q.eZ)(this,e)}createQuery(){return new X.Z({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}async queryFeatures(e,t){await this.load();const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e),r=z.Z.fromJSON(await i.executeQuery(n.toJSON(),t?.signal));return r.features.forEach((e=>{e.sourceLayer=this})),r}async queryFeaturesJSON(e,t){await this.load();const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e);return await i.executeQuery(n.toJSON(),t?.signal)}async queryFeatureCount(e,t){await this.load();const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e);return i.executeQueryForCount(n.toJSON(),t?.signal)}async queryExtent(e={},t){await this.load();const n={...e,returnGeometry:!0},{resolvedQuery:i,queryEngine:r}=await this._setupQueryObjects(n),o=await r.executeQueryForExtent(i.toJSON(),t?.signal);let s;return s=null!=o.extent?.xmin&&null!=o.extent?.xmax&&null!=o.extent?.ymin&&null!=o.extent?.ymax?new p.Z(o.extent):new p.Z,{count:o.count,extent:s}}async queryObjectIds(e,t){await this.load();const n=X.Z.from(e);let i;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)i=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(n,this,t);i=this.loadQueryEngine(e)}return await i.executeQueryForIds(n.toJSON(),t?.signal)}loadQueryEngine(e){const t=new I.Z({geometryType:_.Mk.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),n=new T.qq({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:_.Mk.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:t});return n.featureStore.addMany(e),n}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new X.Z({where:"1=1",outFields:[C.mR]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then((()=>(0,O.UF)(this.timeInfo,this.fieldsIndex)))),Promise.resolve(this)}async _setupQueryObjects(e,t){const n=X.Z.from(e),i=n.geometry;if(i&&!i.spatialReference?.isWGS84&&(await(0,m.initializeProjection)(i.spatialReference,b.YU),n.geometry=(0,m.project)(i instanceof y.Z||i instanceof f.Z||i instanceof h.Z?i:i.extent,b.YU)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)return{resolvedQuery:n,queryEngine:this._cachedQueryEngine};const r=await this.parentCompositeLayer.dataManager.getData(n,this,t);return{resolvedQuery:n,queryEngine:this.loadQueryEngine(r)}}};(0,i._)([(0,l.Cb)(W((0,o.d9)(S.nE)))],ne.prototype,"blendMode",void 0),(0,i._)([(0,l.Cb)()],ne.prototype,"capabilities",void 0),(0,i._)([(0,l.Cb)({json:{origins:{"web-scene":{write:!1}},write:K()}})],ne.prototype,"charts",void 0),(0,i._)([(0,l.Cb)({readOnly:!0})],ne.prototype,"defaultPopupTemplate",null),(0,i._)([(0,l.Cb)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],ne.prototype,"definitionExpression",void 0),(0,i._)([(0,l.Cb)()],ne.prototype,"displayField",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(k.jp)))],ne.prototype,"displayFilterEnabled",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(k.ey)))],ne.prototype,"displayFilterInfo",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(S.qu)))],ne.prototype,"effect",void 0),(0,i._)([(0,l.Cb)()],ne.prototype,"elevationInfo",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(N.d)))],ne.prototype,"featureEffect",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(B.d)))],ne.prototype,"featureReduction",null),(0,i._)([(0,l.Cb)()],ne.prototype,"fields",null),(0,i._)([(0,l.Cb)()],ne.prototype,"geometryType",null),(0,i._)([(0,l.Cb)()],ne.prototype,"geometryFieldName",null),(0,i._)([(0,l.Cb)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],ne.prototype,"graphType",void 0),(0,i._)([(0,l.Cb)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],ne.prototype,"graphTypeName",null),(0,i._)([(0,l.Cb)()],ne.prototype,"hasM",null),(0,i._)([(0,l.Cb)()],ne.prototype,"hasZ",null),(0,i._)([(0,l.Cb)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],ne.prototype,"id",void 0),(0,i._)([(0,l.Cb)({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],ne.prototype,"labelsVisible",void 0),(0,i._)([(0,l.Cb)({type:[P.Z],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:function(e,t,n){const i=[["ESRI__AGGREGATION_COUNT",C._P],["ESRI__ORIGIN_ID",C.TY],["ESRI__DESTINATION_ID",C.l6],["ESRI__LAYOUT_GEOMETRY",C.xD]];try{for(const t of e)for(const[e,n]of i)t.labelExpression=t.labelExpression?.replaceAll(e,n),t.labelExpressionInfo?.expression&&(t.labelExpressionInfo.expression=t.labelExpressionInfo.expression.replaceAll(e,n))}catch(e){s.Z.getLogger(this).warn("Error updating labelingInfo",e)}return(0,G.r)(e,t,n)},write:K()}})],ne.prototype,"labelingInfo",null),(0,i._)([(0,l.Cb)({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer?.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],ne.prototype,"layerType",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(F.rn)))],ne.prototype,"legendEnabled",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(F.u1)))],ne.prototype,"maxScale",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(F.rO)))],ne.prototype,"minScale",void 0),(0,i._)([(0,l.Cb)()],ne.prototype,"objectIdField",void 0),(0,i._)([(0,l.Cb)()],ne.prototype,"objectType",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(F.Oh)))],ne.prototype,"opacity",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(R.lD)))],ne.prototype,"orderBy",void 0),(0,i._)([(0,l.Cb)({clonable:!1})],ne.prototype,"parent",void 0),(0,i._)([(0,l.Cb)()],ne.prototype,"parentCompositeLayer",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(F.C_)))],ne.prototype,"popupEnabled",void 0),(0,i._)([(0,l.Cb)({type:r.Z,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],ne.prototype,"popupTemplate",void 0),(0,i._)([(0,l.Cb)({type:Number,json:{write:{overridePolicy:te}}})],ne.prototype,"refreshInterval",void 0),(0,i._)([(0,l.Cb)({types:U.Av,json:{name:"layerDefinition.drawingInfo.renderer",write:K()}})],ne.prototype,"renderer",null),(0,i._)([(0,l.Cb)()],ne.prototype,"source",void 0),(0,i._)([(0,l.Cb)()],ne.prototype,"spatialReference",null),(0,i._)([(0,l.Cb)({type:Y.Z,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:!0}}}})],ne.prototype,"timeInfo",null),(0,i._)([(0,l.Cb)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],ne.prototype,"title",null),(0,i._)([(0,u.c)("title")],ne.prototype,"writeTitle",null),(0,i._)([(0,l.Cb)({json:{read:!1}})],ne.prototype,"type",void 0),(0,i._)([(0,l.Cb)(W((0,o.d9)(j.I)))],ne.prototype,"useViewTime",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{name:"visibility",write:K()}})],ne.prototype,"visible",void 0),ne=(0,i._)([(0,c.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],ne);const ie=ne},32410:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(53736),r=n(12065),o=n(59958),s=n(72542);class a{constructor(){this._featureLookup=new Map}static getInstance(){return a.instance||(a.instance=new a),a.instance}static resetInstance(){a.instance&&(a.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const n=this.readFromStoreById(e);n&&t.push(n)})),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,n){const a=[];return e.forEach((e=>{if(!e?.id)return;e.properties||(e.properties=[]);let l,c=null;if(n&&e.properties[n]&&(c=(0,r.GH)(e.properties[n])),"originId"in e&&"destinationId"in e&&(e.properties[s.TY]=e.originId,e.properties[s.l6]=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const r=this._featureLookup.get(e.id),s=JSON.parse(JSON.stringify(Object.assign(r.attributes,e.properties)));n&&e.properties[n]&&(s[n]=(0,i.im)(e.properties[n])),l=new o.u_(c?JSON.parse(JSON.stringify(c)):r?.geometry?JSON.parse(JSON.stringify(r.geometry)):null,s,null,e.properties[t])}else l=new o.u_(c?JSON.parse(JSON.stringify(c)):null,e.properties,null,e.properties[t]);this._featureLookup.set(`${e.typeName?`${e.typeName}__${e.id}`:e.id}`,l),a.push(l)})),a}}},72542:(e,t,n)=>{n.d(t,{TY:()=>r,_P:()=>a,_k:()=>l,l6:()=>o,mR:()=>i,xD:()=>s});const i="ESRI__ID",r="ESRI__OriginID",o="ESRI__DestID",s="ESRI__LayoutGeometry",a="ESRI__AggregationCount",l="LC.ESRI__IsSpatial"},18928:(e,t,n)=>{n.d(t,{I:()=>y,Jr:()=>h,R4:()=>g,fC:()=>m,wn:()=>f,xk:()=>d});var i=n(30936),r=n(7923),o=n(59693),s=n(19893),a=n(62589),l=n(27624);const c=async(e,t,n)=>{if(t||(t=[...e.layers,...e.tables].map((e=>e.graphTypeName))),0===t?.length)return;const i=new Map;for(const n of t)i.set(n,u(e,n));const r=await(0,s.fetchClientDataAtKeys)(e.dataManager.knowledgeGraph,Array.from(i.values()),{requestOptions:{signal:n?.signal}});for(const t of[...e.layers,...e.tables]){const n=t.objectType.name;if(null==n)continue;const i=r.get(u(e,n));if(i){const e=JSON.parse(i);null===e||"object"!=typeof e||e.hasOwnProperty("showLabels")||(e.showLabels=!1),t.read(e,{origin:"service"})}}},u=(e,t)=>"knowledge-graph"===e.type?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;async function d(e,t,n){return c(e,t,n)}const p=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"];function h(e){return e<0||e>=p.length?new i.Z("#8f8f82"):new i.Z(p[e])}function y(e){const t=e.toArray();return new a.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function f(e){let t="ESRI__ID",n=4;for(const i of e)if(i.name){if("name"===i.name.toLowerCase()){t=i.name;break}i.name.toLowerCase().includes("name")?(t=i.name,n=2):"esriFieldTypeString"===i.fieldType&&n>3&&(t=i.name,n=3)}return t}function m(e,t,n){const i={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},s=new r.Z({labelExpressionInfo:new o.Z({expression:"ESRI__ID"===n?`${t}`:`$feature.${n}`}),labelPlacement:"above-center",symbol:new l.Z(i)}),a=new r.Z({labelExpressionInfo:new o.Z({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new l.Z({...i,yoffset:"12px"})});return"entity"===e?[s]:[a]}function g(e,t,n){const i={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},s="ESRI__ID"===n?`${e}`:`$feature.${n}`;return"point"===t?[new r.Z({labelExpressionInfo:new o.Z({expression:s}),labelPlacement:"above-center",symbol:new l.Z(i)})]:"polyline"===t?[new r.Z({labelExpressionInfo:new o.Z({expression:s}),labelPlacement:"center-along",repeatLabel:!0,symbol:new l.Z(i)})]:"polygon"===t?[new r.Z({labelExpressionInfo:new o.Z({expression:s}),labelPlacement:"always-horizontal",symbol:new l.Z(i)})]:null}},68188:(e,t,n)=>{n.d(t,{no:()=>u,bv:()=>c,YD:()=>d});n(80085);var i=n(70375),r=(n(10186),n(89542),n(90819),n(45857),n(32410),n(79343),n(25709));(0,r.w)()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"}),(0,r.w)()({absoluteValue:"absolute-value",multiplier:"multiplier"});const o=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);var s=n(19893),a=n(76512);n(62589),n(43411),n(27624);function l(e,t){const n=new Map;if(t.dataModel?.relationshipTypes)for(const e of t.dataModel.relationshipTypes)e.name&&n.set(e.name,[]);for(const t of e)n.has(t.typeName)&&n.get(t.typeName)?.push(t.id);return n}async function c(e,t,n){const i=[],r=l(e,t),o={},c=[];for(const[e,t]of r){if(t.length<1)continue;const n=`${e}_ids`;o[n]=t,c.push(`MATCH (n)-[r:${e}]->(m) WHERE id(r) in $${n} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(0===c.length)return[];const u=c.join(" UNION "),d=new a.Z({openCypherQuery:u,bindParameters:o}),p=(await(0,s.executeQueryStreaming)(t,d,n?.requestOptions)).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await p.read();if(e)break;for(const e of t)i.push({id:e[0],typeName:e[1]}),i.push({id:e[2],typeName:e[3]})}return i}const u=e=>o.get(e)??"radial-root-centric";function d(e){if(!e.spatialReference.isWGS84)throw new i.Z("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}},45865:(e,t,n)=>{n.d(t,{tM:()=>w,jp:()=>I,ey:()=>T});var i=n(36663),r=n(86745),o=n(81977),s=(n(39994),n(13802),n(4157),n(40266)),a=n(47216),l=n(41151),c=n(41831),u=n(82064),d=n(39835),p=n(68577),h=n(12173);const y={write:{overridePolicy:(e,t,n)=>({enabled:!n||"scale"===n.filterMode})}};let f=class extends(l.Z.ClonableMixin(u.Z)){constructor(e){super(e),this.id=(0,h.DO)(),this.maxScale=0,this.minScale=0,this.title="",this.where=null}};(0,i._)([(0,o.Cb)({type:String,json:{write:!0}})],f.prototype,"id",void 0),(0,i._)([(0,o.Cb)({type:Number,json:y})],f.prototype,"maxScale",void 0),(0,i._)([(0,o.Cb)({type:Number,json:y})],f.prototype,"minScale",void 0),(0,i._)([(0,o.Cb)({type:String,json:{write:!0}})],f.prototype,"title",void 0),(0,i._)([(0,o.Cb)({type:String,json:{write:!0}})],f.prototype,"where",void 0),f=(0,i._)([(0,s.j)("esri.layers.support.DisplayFilter")],f);const m=f;var g=n(19654);let b=class extends(l.Z.ClonableMixin(u.Z)){constructor(e){super(e),this.activeFilterId=null,this.filters=new(c.Z.ofType(m)),this.mode="manual"}writeFilters(e,t,n,i){const r=e.toArray();"scale"===this.mode&&r.sort(((e,t)=>{const n=(0,p.Nf)(t.minScale,e.minScale),i=e.maxScale-t.maxScale;return 0===n?i:n})),t[n]=r.map((e=>e.toJSON(i)))}write(e,t){return super.write(e,(0,g.Ee)(this,t))}};(0,i._)([(0,o.Cb)({type:String,json:{write:{overridePolicy:(e,t,n)=>({enabled:"manual"===n.filterMode,isRequired:!0})}}})],b.prototype,"activeFilterId",void 0),(0,i._)([(0,o.Cb)({type:c.Z.ofType(m),nonNullable:!0,json:{write:!0}})],b.prototype,"filters",void 0),(0,i._)([(0,d.c)("filters")],b.prototype,"writeFilters",null),(0,i._)([(0,o.Cb)({type:["manual","scale"],nonNullable:!0,json:{name:"filterMode",write:!0}})],b.prototype,"mode",void 0),b=(0,i._)([(0,s.j)("esri.layers.support.DisplayFilterInfo")],b);const _=b,w=e=>{let t=class extends e{constructor(){super(...arguments),this.displayFilterEnabled=!0,this.displayFilterInfo=null}};return(0,i._)([(0,o.Cb)(I)],t.prototype,"displayFilterEnabled",void 0),(0,i._)([(0,o.Cb)(T)],t.prototype,"displayFilterInfo",void 0),t=(0,i._)([(0,s.j)("esri.layers.mixins.DisplayFilteredLayer")],t),t},I={type:Boolean,json:{name:"layerDefinition.disableDisplayFilter",read:{reader:e=>!e},write:{layerContainerTypes:a.C,writer(e,t,n){(0,r.RB)(n,!e,t)}},origins:{"web-scene":{write:!1,read:!1}}}},T={type:_,json:{name:"layerDefinition.displayFilterInfo",write:{enabled:!0,allowNull:!0,layerContainerTypes:a.C},origins:{"web-scene":{write:!1,read:!1}}}}},91610:(e,t,n)=>{n.d(t,{Ax:()=>l,c_:()=>u,lD:()=>c});var i=n(36663),r=n(86745),o=n(81977),s=(n(39994),n(13802),n(4157),n(40266)),a=n(94451);function l(e,t,n){if(!e)return null;const i=e.find((e=>!!e.field));if(!i)return null;const r=new a.Z;return r.read(i,n),[r]}const c={type:[a.Z],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:l},write:{writer:function(e,t,n,i){const o=e.find((e=>!!e.field));o&&(0,r.RB)(n,[o.toJSON()],t)}}}},u=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return(0,i._)([(0,o.Cb)(c)],t.prototype,"orderBy",void 0),t=(0,i._)([(0,s.j)("esri.layers.mixins.OrderedLayer")],t),t}},94451:(e,t,n)=>{n.d(t,{Z:()=>d});var i,r=n(36663),o=n(25709),s=n(82064),a=n(81977),l=(n(39994),n(13802),n(4157),n(40266));const c=new o.X({asc:"ascending",desc:"descending"});let u=i=class extends s.Z{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new i({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],u.prototype,"field",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],u.prototype,"valueExpression",void 0),(0,r._)([(0,a.Cb)({type:c.apiValues,json:{type:c.jsonValues,read:c.read,write:c.write}})],u.prototype,"order",void 0),u=i=(0,r._)([(0,l.j)("esri.layers.support.OrderByInfo")],u);const d=u},19654:(e,t,n)=>{n.d(t,{Ee:()=>o,Gr:()=>a,UO:()=>s});var i=n(19431),r=n(84684);function o(e,t){return{...t,filterMode:e.mode}}function s(e,t){return l(e,t).next().value??null}function a(e,t,n){const o=function(e){if("manual"===u(e))return null;const t=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:n,maxScale:i}of e.filters)t[0]=Math.max(t[0],d(n)),t[1]=Math.min(t[1],p(i));return t}(e);if(o&&((0,i.nB)(t,o[0])||(0,i.pt)(n,o[1])))return"";const s=Array.from(l(e,t,n)),a=function(e,t,n){if(0===e.length)return!0;const r=d(e.at(0)?.minScale),o=p(e.at(-1)?.maxScale);if((0,i.pt)(r,t)||(0,i.nB)(o,n))return!0;for(let t=0;t<e.length-1;t++){const n=e[t],r=e[t+1];if((0,i.pt)(d(r.minScale),p(n.maxScale)))return!0}return!1}(s,t,n)?"1=1":s.map((e=>e.where||"1=1")).reduce(((e,t)=>(0,r.D3)(e,t)),"");return a&&"1=1"!==a?a:""}function*l(e,t,n){if("manual"===u(e)){const t=e.filters.find((t=>t.id===e.activeFilterId));t&&(yield t)}else{"object"==typeof t&&(t=t.scale);for(const i of e.filters)c(i.minScale,i.maxScale,t,n)&&(yield i)}}function c(e,t,n,r){return e=d(e),n=d(n),t=p(t),!(!(0,i.W8)(n,e)&&(r??n)>e||(0,i.aR)(t,n)||void 0!==r&&(0,i.W8)(r,e))}function u(e){return"mode"in e?e.mode:e.filterMode}function d(e){return e||Number.POSITIVE_INFINITY}function p(e){return e||0}},79343:(e,t,n)=>{n.d(t,{BI:()=>f,Bc:()=>b,Dx:()=>I,L2:()=>m,Un:()=>c,Yw:()=>w,cu:()=>g,gQ:()=>l,iz:()=>a,uc:()=>_,zD:()=>s});var i=n(36567);let r,o=null;function s(){return r||(r=n.e(25672).then(n.bind(n,25672)).then((e=>e.l)).then((({default:e})=>e({locateFile:e=>(0,i.V)(`esri/libs/linkchartlayout/${e}`)}))).then((e=>{!function(e){o=e}(e)})),r)}var a,l,c,u,d;(d=a||(a={}))[d.None=0]="None",d[d.IsMovable=1]="IsMovable",d[d.IsGeographic=2]="IsGeographic",d[d.IsRoot=4]="IsRoot",d[d.IsOld=8]="IsOld",function(e){e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.Canceled=2]="Canceled"}(l||(l={})),function(e){e[e.Regular=0]="Regular",e[e.Curved=1]="Curved",e[e.Recursive=2]="Recursive"}(c||(c={})),function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom"}(u||(u={}));const p={none:0,"start-only":1,"start-and-end":2};function h(e){const t={timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0,...e?.toJSON()??{},eventsTicksVisualization:e?.eventsTicksVisualization??"start-and-end"};return{...t,timeDirection:{value:u[t.timeDirection]??u.right},eventsTicksVisualization:{value:p[t.eventsTicksVisualization]??p["start-and-end"]}}}function y(e,t,n,i,r,s){const a=n.length,c=r.length,u=Float64Array.BYTES_PER_ELEMENT,d=Uint32Array.BYTES_PER_ELEMENT,p=Uint8Array.BYTES_PER_ELEMENT,h=16+a*(p+2*u)+c*(2*d),y=o._malloc(h);try{const p=y+16-y%16,h=p+a*u,f=h+a*u,m=f+c*d,g=m+c*d,b=()=>[o.HEAPF64.subarray(p>>3,(p>>3)+a),o.HEAPF64.subarray(h>>3,(h>>3)+a),o.HEAPU32.subarray(f>>2,(f>>2)+c),o.HEAPU32.subarray(m>>2,(m>>2)+c),o.HEAPU8.subarray(g,g+a)],[_,w,I,T,M]=b();_.set(n),w.set(i),I.set(r),T.set(s),M.set(t);const C=e(a,g,p,h,c,f,m);let E=null,x=null;if(C.value===l.Success){const e=o.getLayoutLinksTypes(),t=o.getLayoutLinksVerticesEndIndices(),n=o.getLayoutLinksVertices(),i=o.countLayoutLinksVertices();!c||e&&t?i&&!n?C.value=l.Error:(E={types:new Uint8Array(o.HEAPU8.subarray(e,e+c)),vertexEndIndex:new Uint32Array(o.HEAPU32.subarray(t>>2,(t>>2)+c)),vertices:new Float64Array(o.HEAPF64.subarray(n>>3,(n>>3)+2*i))},x=o.getAuxiliaryGraphicElements()):C.value=l.Error}const[v,S,k,N,L]=b();return n.set(v),i.set(S),r.set(k),s.set(N),t.set(L),{status:C.value,links:E,graphics:x}}finally{o._free(y),o.cleanupLayout()}}var f,m,g,b,_,w,I,T,M;!function(e){e.getMinIdealEdgeLength=function(){return o.getMinIdealEdgeLength()},e.apply=function(e,t,n,i,r,s,a=2,l=1,c=-1){return y(((t,n,i,r,s,u,d)=>o.applyForceDirectedLayout(e,t,n,i,r,s,u,d,a,l,c)),t,n,i,r,s)}}(f||(f={})),function(e){e.apply=function(e,t,n,i,r,s,a=2,l=1,c=-1){return y(((t,n,i,r,s,u,d)=>o.applyCommunityLayout(e,t,n,i,r,s,u,d,a,l,c)),t,n,i,r,s)}}(m||(m={})),function(e){e.apply=function(e,t,n,i,r,s){return y(((t,n,i,r,s,a,l)=>o.applySimpleLayout(e,t,n,i,r,s,a,l)),t,n,i,r,s)}}(g||(g={})),function(e){e.apply=function(e,t,n,i,r,s){return y(((t,n,i,r,s,a,l)=>o.applyHierarchicalLayout(e,t,n,i,r,s,a,l)),t,n,i,r,s)}}(b||(b={})),function(e){e.apply=function(e,t,n,i,r,s){return y(((t,n,i,r,s,a,l)=>o.applyRadialTreeLayout(e,t,n,i,r,s,a,l)),t,n,i,r,s)}}(_||(_={})),function(e){e.apply=function(e,t,n,i,r,s){return y(((t,n,i,r,s,a,l)=>o.applySmartTreeLayout(e,t,n,i,r,s,a,l)),t,n,i,r,s)}}(w||(w={})),function(e){e.apply=function(e,t,n,i,r,s,a,c,u,d,p,f){return y(((t,n,i,a,c,y,m)=>{if(r.length!==t)return{value:l.Error};if(s.length!==t)return{value:l.Error};if(u.length!==c)return{value:l.Error};if(d.length!==c)return{value:l.Error};const g=Float64Array.BYTES_PER_ELEMENT,b=16,_=o._malloc(b+t*g),w=o._malloc(b+t*g),I=o._malloc(b+c*g),T=o._malloc(b+c*g),M=_+b-_%b,C=w+b-w%b,E=I+b-I%b,x=T+b-T%b;try{return o.HEAPF64.subarray(M>>3,(M>>3)+t).set(r),o.HEAPF64.subarray(C>>3,(C>>3)+t).set(s),o.HEAPF64.subarray(E>>3,(E>>3)+c).set(u),o.HEAPF64.subarray(x>>3,(x>>3)+c).set(d),o.applyChronologicalLayout(e,t,n,i,a,M,C,c,y,m,E,x,p,h(f))}finally{o._free(_),o._free(w),o._free(I),o._free(T)}}),t,n,i,a,c)}}(I||(I={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(T||(T={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(M||(M={}))},99606:(e,t,n)=>{n.d(t,{Z:()=>c});var i=n(36663),r=n(81977),o=(n(39994),n(13802),n(4157),n(40266)),s=n(10186),a=n(63055);let l=class extends a.Z{constructor(e){super(e),this.layoutGeometry=null}};(0,i._)([(0,r.Cb)({type:s.Z,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,i._)([(0,o.j)("esri.rest.knowledgeGraph.Entity")],l);const c=l},63055:(e,t,n)=>{n.d(t,{Z:()=>l});var i=n(36663),r=n(81977),o=(n(39994),n(13802),n(4157),n(40266)),s=n(60915);let a=class extends s.Z{constructor(e){super(e),this.typeName=null,this.id=null}};(0,i._)([(0,r.Cb)({type:String,json:{write:!0}})],a.prototype,"typeName",void 0),(0,i._)([(0,r.Cb)({type:String,json:{write:!0}})],a.prototype,"id",void 0),a=(0,i._)([(0,o.j)("esri.rest.knowledgeGraph.GraphNamedObject")],a);const l=a},60915:(e,t,n)=>{n.d(t,{Z:()=>l});var i=n(36663),r=n(82064),o=n(81977),s=(n(39994),n(13802),n(4157),n(40266));let a=class extends r.Z{constructor(e){super(e),this.properties=null}};(0,i._)([(0,o.Cb)({json:{write:!0}})],a.prototype,"properties",void 0),a=(0,i._)([(0,s.j)("esri.rest.knowledgeGraph.GraphObject")],a);const l=a},76512:(e,t,n)=>{n.d(t,{Z:()=>d});var i=n(36663),r=n(81977),o=(n(39994),n(13802),n(4157),n(40266)),s=n(14685),a=n(74396);let l=class extends a.Z{constructor(e){super(e),this.openCypherQuery=""}};(0,i._)([(0,r.Cb)()],l.prototype,"openCypherQuery",void 0),l=(0,i._)([(0,o.j)("esri.rest.knowledgeGraph.GraphQuery")],l);const c=l;let u=class extends c{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,i._)([(0,r.Cb)()],u.prototype,"bindParameters",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"bindGeometryQuantizationParameters",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"outputQuantizationParameters",void 0),(0,i._)([(0,r.Cb)({type:s.Z})],u.prototype,"outputSpatialReference",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"provenanceBehavior",void 0),u=(0,i._)([(0,o.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],u);const d=u},29197:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(36663),r=(n(13802),n(39994),n(4157),n(70375),n(40266)),o=n(60915);let s=class extends o.Z{constructor(e){super(e)}};s=(0,i._)([(0,r.j)("esri.rest.knowledgeGraph.ObjectValue")],s);const a=s},78755:(e,t,n)=>{n.d(t,{Z:()=>c});var i=n(36663),r=n(82064),o=n(81977),s=(n(39994),n(13802),n(4157),n(40266)),a=n(60915);let l=class extends r.Z{constructor(e){super(e),this.path=[]}};(0,i._)([(0,o.Cb)({type:[a.Z],json:{write:!0}})],l.prototype,"path",void 0),l=(0,i._)([(0,s.j)("esri.rest.knowledgeGraph.Path")],l);const c=l},70206:(e,t,n)=>{n.d(t,{Z:()=>c});var i=n(36663),r=n(81977),o=(n(39994),n(13802),n(4157),n(40266)),s=n(90819),a=n(63055);let l=class extends a.Z{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,i._)([(0,r.Cb)({type:String,json:{write:!0}})],l.prototype,"originId",void 0),(0,i._)([(0,r.Cb)({type:String,json:{write:!0}})],l.prototype,"destinationId",void 0),(0,i._)([(0,r.Cb)({type:s.Z,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,i._)([(0,o.j)("esri.rest.knowledgeGraph.Relationship")],l);const c=l},97500:(e,t,n)=>{n.d(t,{YV:()=>o,ZB:()=>d,iW:()=>l});var i=n(30936),r=n(60789);function o(e,t,n,i){if(e)if("CIMTextSymbol"!==e.type){if(n&&e.effects)for(const n of e.effects)a(n,t);if(e.symbolLayers)for(const n of e.symbolLayers){switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":s(n,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!i?.preserveOutlineWidth&&n.width&&(n.width*=t);break;case"CIMPictureFill":n.height&&(n.height*=t),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t);break;case"CIMHatchFill":o(n.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t),n.separation&&(n.separation*=t)}if(n.effects)for(const e of n.effects)a(e,t)}}else null!=e.height&&(e.height*=t)}function s(e,t,n){if(e&&(e.markerPlacement&&function(e,t){switch((0,r.gJ)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const i of e.markerGraphics)e.scaleSymbolsProportionally||o(i.symbol,t,!0,n)}function a(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const n=e.dashTemplate.map((e=>e*t));e.dashTemplate=n}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function l(e){const t=[];return c((0,r.be)(e),t),t.length?new i.Z((0,r.oY)(t[0])):null}function c(e,t){if(!e)return;let n;n="CIMTextSymbol"===e.type?e.symbol:e;const i="CIMPolygonSymbol"===e.type;if(n?.symbolLayers)for(const e of n.symbolLayers)if(!(e.colorLocked||i&&((0,r.yL)(e)||(0,r.zL)(e)&&e.markerPlacement&&(0,r.gJ)(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&u(t,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{c(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":u(t,e.color);break;case"CIMHatchFill":c(e.lineSymbol,t)}}function u(e,t){for(const n of e)if(n.join(".")===t.join("."))return;e.push(t)}function d(e,t,n){t instanceof i.Z||(t=new i.Z(t));const o=(0,r.be)(e);o&&p(o,t,n)}function p(e,t,n){if(!e)return;let i;i="CIMTextSymbol"===e.type?e.symbol:e;const o="CIMPolygonSymbol"===i?.type;if(i?.symbolLayers)for(const e of i.symbolLayers){if(e.colorLocked)continue;if(o)if(n){const{layersToColor:t}=n;if(((0,r.yL)(e)||(0,r.zL)(e)&&e.markerPlacement&&(0,r.gJ)(e.markerPlacement))&&"fill"===t||(0,r.k5)(e)&&"outline"===t)continue}else if((0,r.yL)(e)||(0,r.zL)(e)&&e.markerPlacement&&(0,r.gJ)(e.markerPlacement))continue;const i=t.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=i;break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{p(e.symbol,t,n)}));break;case"CIMSolidStroke":case"CIMSolidFill":e.color=i;break;case"CIMHatchFill":p(e.lineSymbol,t,n)}}}},89298:(e,t,n)=>{n.d(t,{Ne:()=>_,Od:()=>f,Sp:()=>b,_M:()=>y,iI:()=>g,mx:()=>m});var i=n(36567),r=n(30936),o=n(66341),s=n(55854),a=n(95550),l=n(97500);const c="picture-fill",u="simple-fill",d="simple-marker",p=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),h=new s.z(1e3);function y(e){const t=e.style;let n=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(n=e.color);break;case u:t&&"solid"!==t?"none"!==t&&(n={type:"pattern",x:0,y:0,src:(0,i.V)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):n=e.color;break;case c:n={type:"pattern",src:e.url,width:(0,a.F2)(e.width)*e.xscale,height:(0,a.F2)(e.height)*e.yscale,x:(0,a.F2)(e.xoffset),y:(0,a.F2)(e.yoffset)};break;case"text":n=e.color;break;case"cim":n=(0,l.iW)(e)}return n}function f(e,t){const n=e+"-"+t;return void 0!==h.get(n)?Promise.resolve(h.get(n)):(0,o.Z)(e,{responseType:"image"}).then((e=>{const i=e.data,r=i.naturalWidth,o=i.naturalHeight,s=document.createElement("canvas");s.width=r,s.height=o;const a=s.getContext("2d");a.fillStyle=t,a.fillRect(0,0,r,o),a.globalCompositeOperation="destination-in",a.drawImage(i,0,0);const l=s.toDataURL();return h.put(n,l),l}))}function m(e){if(!e)return null;let t=null;switch(e.type){case u:case c:case d:t=m(e.outline);break;case"simple-line":{const n=(0,a.F2)(e.width);null!=e.style&&"none"!==e.style&&0!==n&&(t={color:e.color,style:b(e.style),width:n,cap:e.cap,join:"miter"===e.join?(0,a.F2)(e.miterLimit):e.join},t.dashArray=g(t).join(",")||"none");break}default:t=null}return t}function g(e){if(!e?.style)return[];const{dashArray:t,style:n,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const r=i??0,o=p.has(n)?p.get(n).map((e=>e*r)):[];if("butt"!==e.cap)for(const[e,t]of o.entries())o[e]=e%2==1?t+r:Math.max(t-r,1);return o}const b=(()=>{const e={};return t=>{if(e[t])return e[t];const n=t.replaceAll("-","");return e[t]=n,n}})(),_=new r.Z([128,128,128])},59672:(e,t,n)=>{n.d(t,{BR:()=>C,QL:()=>x,Y6:()=>h,YW:()=>y,_h:()=>m,e3:()=>M,nf:()=>f,tb:()=>b,wJ:()=>E});var i=n(30936),r=n(67979),o=(n(39994),n(95550)),s=n(81095),a=n(50913),l=n(97500),c=n(89298),u=n(57403),d=n(9539);const p=new i.Z("white");function h(e){if(!e)return 0;if((0,d.dU)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,o.Wz)((0,c.mx)(e)?.width)}function y(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function f(e){return e.resource?.href??""}function m(e,t){if(!e)return null;let n=null;return(0,d.dU)(e)?n=function(e){const t=e.symbolLayers;if(!t)return null;let n=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(n="water"===e.type?e.color:e.material?e.material.color:null)})),n?new i.Z(n):null}(e):(0,d.cT)(e)&&(n="cim"===e.type?(0,l.iW)(e):e.color?new i.Z(e.color):null),n?g(n,t):null}function g(e,t){if(null==t||null==e)return e;const n=e.toRgba();return n[3]=n[3]*t,new i.Z(n)}function b(e,t,n){e&&(t||null!=n)&&(t&&(t=new i.Z(t)),(0,d.dU)(e)?function(e,t,n){const i=e.symbolLayers;if(!i)return;const r=e=>g(t=t??e??(null!=n?p:null),n);i.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=r(e.color);else{const t=null!=e.material?e.material.color:null,i=r(t);null==e.material?e.material=new u.b({color:i}):e.material.color=i,null!=n&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=g(e.outline.color,n))}}))}(e,t,n):(0,d.cT)(e)&&function(e,t,n){(t=t??e.color)&&(e.color=g(t,n)),null!=n&&"outline"in e&&e.outline?.color&&(e.outline.color=g(e.outline.color,n))}(e,t,n))}async function _(e,t){const i=e.symbolLayers;i&&await(0,r.Ed)(i,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const n=w(t);null!=n&&(e.size=n)}(e,t);break;case"path":!function(e,t){const n=I(t,s.hq,[e.width,void 0,e.height]);e.width=T(t[0],e.width,1,n),e.height=T(t[2],e.height,1,n)}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:r}=await async function(e){const{computeObjectLayerResourceSize:t}=await n.e(62901).then(n.bind(n,62901)),i=await t(e,10),{width:r,height:o,depth:s}=e,a=[r,s,o];let l=1;for(let e=0;e<3;e++){const t=a[e];if(null!=t){l=t/i[e];break}}for(let e=0;e<3;e++)null==a[e]&&(a[e]=i[e]*l);return{resourceSize:i,symbolSize:a}}(e),o=I(t,i,r);e.width=T(t[0],r[0],i[0],o),e.depth=T(t[1],r[1],i[1],o),e.height=T(t[2],r[2],i[2],o)}(e,t)}}(e,t)))}function w(e){for(const t of e)if("number"==typeof t)return t;return null}function I(e,t,n){for(let i=0;i<3;i++){const r=e[i];switch(r){case"symbol-value":{const e=n[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(r&&t[i])return r/t[i]}}return 1}function T(e,t,n,i){switch(e){case"proportional":return n*i;case"symbol-value":return null!=t?t:n;default:return e}}async function M(e,t){if(e&&t)return(0,d.dU)(e)?_(e,t):void((0,d.cT)(e)&&function(e,t){const n=w(t);if(null!=n)switch(e.type){case"simple-marker":e.size=n;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=n,e.height=n*t):(e.width=n*t,e.height=n);break}case"simple-line":e.width=n;break;case"text":e.font.size=n}}(e,t))}function C(e,t,n){if(e&&null!=t)if((0,d.dU)(e)){const i=e.symbolLayers;i&&i.forEach((e=>{if("object"===e.type)switch(n){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)}))}else(0,d.cT)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function E(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,a.rM)(t)}function x(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}}}]);