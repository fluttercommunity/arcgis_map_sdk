"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[2784],{19654:(e,s,t)=>{t.d(s,{A:()=>d});var i=t(36663),a=t(23148),r=t(78668),l=t(76868),o=t(81977),n=(t(7283),t(7753),t(40266)),h=t(64862);const d=e=>{let s=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),(0,h.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,s=e.signal;this.handles.add((0,a.kB)((()=>e.abort()))),await(0,l.N1)((()=>this.view.defaultsFromMap?.heightModelInfoReady),s),(0,r.k_)(s);const t=(0,h.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(t)throw t}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!e||!e.minScale||!e.maxScale||e.minScale>=e.maxScale)}getSuspendInfo(){const e=super.getSuspendInfo(),s=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return s&&s.minScale&&s.maxScale&&s.minScale<s.maxScale&&(e.outsideScaleRange=!0),e}};return(0,i._)([(0,o.Cb)()],s.prototype,"view",void 0),(0,i._)([(0,o.Cb)()],s.prototype,"slicePlaneEnabled",void 0),s=(0,i._)([(0,n.j)("esri.views.3d.layers.LayerView3D")],s),s}},92784:(e,s,t)=>{t.r(s),t.d(s,{default:()=>C});var i,a,r=t(36663),l=(t(91957),t(70375)),o=t(44584),n=t(13802),h=t(61681),d=t(76868),p=t(81977),c=(t(7283),t(7753),t(40266)),u=t(6766),y=t(8909),m=t(90472),b=t(37116),v=t(35925),w=t(19654),_=t(44613),g=t(26216),f=t(36172),S=t(14685);(a=i||(i={}))[a.API=1]="API",a[a.VerboseAPI=2]="VerboseAPI",a[a.Error=3]="Error";const V=(0,y.c)(),W=(0,y.c)();let x=class extends((0,_.i)((0,w.A)(g.Z))){constructor(){super(...arguments),this._suspendedHandle=null,this._usedMemory=0,this._futureMemory=0,this.type="voxel-3d",this.slicePlaneEnabled=!1,this._wasmLayerId=-1,this._handles=new o.Z,this._dbgFlags=new Set}get baseUrl(){return this.layer.parsedUrl?.path??""}get wasmLayerId(){return this._wasmLayerId}initialize(){if(this._dbgFlags.add(i.Error),"local"!==this.view.viewingMode)throw new l.Z("voxel:unsupported-viewingMode","Voxel layers support local viewingMode only.",{});if(this.view._stage.renderView.renderingContext.type!==f.zO.WEBGL2)throw new l.Z("voxel:unsupported-context","Voxel layers are supported in WebGL2 rendering contexts only.",{});if(!this.view._stage.renderView.renderingContext.capabilities.colorBufferFloat?.textureFloat)throw new l.Z("voxel:missing-color-buffer-float","Voxel layers require the WebGL2 extension EXT_color_buffer_float",{});const e=this.layer.spatialReference;if(!(0,v.fS)(e,this.view.spatialReference))throw new l.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});const s=this.layer.currentVariableId,t=this.layer.getVolume(s),a=this.layer.getVariable(s);if((0,h.pC)(t)&&(0,h.pC)(a)){const e=t.dimensions[0],s=t.dimensions[1],i=t.zDimension;if(i>1){const r=t.dimensions[i],l=e.size*s.size*r.size;let o=1;switch(a.renderingFormat.type){case"Int16":case"UInt16":o=2;break;case"Int32":case"UInt32":case"Float32":o=4}this._futureMemory=o*l}}const r=this.view.addVoxelLayerViewToWasm(this).then((e=>{this._wasmLayerId=e,this._suspendedHandle=(0,d.YP)((()=>this.suspended),(e=>{const s=this.view.voxelWasm;(0,h.pC)(s)&&s.setEnabled(this,!e)}),d.nn),this._handles.add([(0,d.YP)((()=>this.layer.renderMode),(e=>this._pushRenderModeToWasm(e))),(0,d.YP)((()=>this.layer.currentVariableId),(e=>this._pushCurrentVariableIdToWasm(e))),(0,d.YP)((()=>this.layer.getSections()),(e=>this._pushSectionsToWasm(e))),(0,d.YP)((()=>this.layer.getVariableStyles()),(e=>this._pushVariableStylesToWasm(e))),(0,d.YP)((()=>this.layer.getVolumeStyles()),(e=>this._pushVolumeStylesToWasm(e))),(0,d.YP)((()=>this.layer.enableDynamicSections),(e=>this._pushEnableDynamicSectionsToWasm(e))),(0,d.YP)((()=>this.layer.enableIsosurfaces),(e=>this._pushEnableIsosurfacesToWasm(e))),(0,d.YP)((()=>this.layer.enableSections),(e=>this._pushEnableSectionsToWasm(e))),(0,d.YP)((()=>this.layer.enableSlices),(e=>this._pushEnableSlicesToWasm(e))),(0,d.YP)((()=>this.slicePlaneEnabled),(e=>this._pushAnalysisSliceToWasm(e,this.view.slicePlane))),(0,d.YP)((()=>this.view.slicePlane),(e=>this._pushAnalysisSliceToWasm(this.slicePlaneEnabled,e)))])})).catch((e=>{if(this.view.removeVoxelLayerViewFromWasm(this),this._wasmLayerId=-1,-1===e)throw new l.Z("voxel:addLayer-failure","The voxel layer description was invalid.",{});if(-2===e)throw new l.Z("voxel:addLayer-failure","The voxel layer web assembly module failed to download.",{})}));this.addResolvingPromise(r)}destroy(){this.view.removeVoxelLayerViewFromWasm(this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null),this._handles=(0,h.SC)(this._handles)}isUpdating(){const e=this.view.voxelWasm;return!(this._wasmLayerId<0||!(0,h.pC)(e))&&e.isUpdating(this._wasmLayerId)}updatingFlagChanged(){this.notifyChange("updating")}getUsedMemory(){return this._usedMemory}getUnloadedMemory(){return this._futureMemory}ignoresMemoryFactor(){return!0}get performanceInfo(){return{nodes:0,displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null}}whenGraphicBounds(e,s){const t=e.attributes["Voxel.WorldPosition"];if(t){const e=(0,b.cS)(),s=JSON.parse(t);if((0,m.SH)(s,this.view.renderSpatialReference,W,this.view.spatialReference||S.Z.WGS84))return(0,b.pp)(e,W),Promise.resolve({boundingBox:e,screenSpaceObjects:[]})}return Promise.reject()}setUsedMemory(e){this._usedMemory=e,this._futureMemory=0}captureFrustum(){const e=this.view.voxelWasm;(0,h.pC)(e)&&e.captureFrustum()}toggleFullVolumeExtentDraw(){const e=this.view.voxelWasm;(0,h.pC)(e)&&e.toggleFullVolumeExtentDraw(this)}getLayerTimes(){let e=[];const s=this.view.voxelWasm;return(0,h.pC)(s)&&(e=s.getLayerTimes(this)),e}getCurrentLayerTimeIndex(){let e=0;const s=this.view.voxelWasm;return(0,h.pC)(s)&&(e=s.getCurrentLayerTimeIndex(this)),e}_pushRenderModeToWasm(e){const s=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushRenderModeToWasm() called, "+((0,h.pC)(s)?"have WASM":"don't have WASM!!!")),(0,h.pC)(s)&&s.setRenderMode(this,e)||this._dbg(i.Error,"VoxelLayerView3D._pushRenderModeToWasm() failed!")}_pushSectionsToWasm(e){const s=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushSectionsToWasm() called, "+((0,h.pC)(s)?"have WASM":"don't have WASM!!!")),(0,h.pC)(s)&&s.setStaticSections(this,e)||this._dbg(i.Error,"VoxelLayerView3D._pushSectionsToWasm() failed!")}_pushCurrentVariableIdToWasm(e){const s=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushCurrentVariableIdToWasm() called!, "+((0,h.pC)(s)?"have WASM":"don't have WASM!!!")),(0,h.pC)(s)&&s.setCurrentVariable(this,e)||this._dbg(i.Error,"VoxelLayerView3D._pushCurrentVariableIdToWasm() failed!")}_pushVariableStylesToWasm(e){const s=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushVariableStylesToWasm() called, "+((0,h.pC)(s)?"have WASM":"don't have WASM!!!"));let t=!1;(0,h.pC)(s)&&(t=s.setVariableStyles(this,e),t||this._dbg(i.Error,"VoxelLayerView3D._pushVariableStylesToWasm() failed!"))}_accountForEnableSlices(e,s){const t=(0,h.pC)(s)?s:this.layer.enableSlices;for(let s=0;s<e.length;++s){const i=e[s];for(const e of i.slices)e.enabled=e.enabled&&t}}_pushVolumeStylesToWasm(e){const s=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushVolumeStylesToWasm() called, "+((0,h.pC)(s)?"have WASM":"don't have WASM!!!"));let t=!1;(0,h.pC)(s)&&(this._accountForEnableSlices(e,null),t=s.setVolumeStyles(this,e),t||this._dbg(i.Error,"VoxelLayerView3D._pushVolumeStylesToWasm() failed!"))}_pushAnalysisSliceToWasm(e,s){const t=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushAnalysisSliceToWasm() called, "+((0,h.pC)(t)?"have WASM":"don't have WASM!!!"));let a=!1;if((0,h.pC)(t)){if((0,h.pC)(s)){const i=s.origin;(0,u.f)(V,s.basis1,s.basis2),(0,u.n)(V,V),a=t.setAnalysisSlice(this,e,i,V)}else(0,u.s)(V,0,0,1),a=t.setAnalysisSlice(this,!1,V,V);a||this._dbg(i.Error,"VoxelLayerView3D._pushAnalysisSliceToWasm() failed!")}}_pushEnableDynamicSectionsToWasm(e){const s=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushEnableDynamicSectionsToWasm() called, "+((0,h.pC)(s)?"have WASM":"don't have WASM!!!"));let t=!1;(0,h.pC)(s)&&(t=s.setEnableDynamicSections(this,e),t||this._dbg(i.Error,"VoxelLayerView3D._pushEnableDynamicSectionsToWasm() failed!"))}_pushEnableSlicesToWasm(e){const s=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushEnableSlicesToWasm() called, "+((0,h.pC)(s)?"have WASM":"don't have WASM!!!"));let t=!1;if((0,h.pC)(s)){const a=this.layer.getVolumeStyles();this._accountForEnableSlices(a,e),t=s.setVolumeStyles(this,a),t||this._dbg(i.Error,"VoxelLayerView3D._pushEnableSlicesToWasm() failed!")}}_pushEnableIsosurfacesToWasm(e){const s=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushEnableIsosurfacesToWasm() called, "+((0,h.pC)(s)?"have WASM":"don't have WASM!!!"));let t=!1;(0,h.pC)(s)&&(t=s.setEnableIsosurfaces(this,e),t||this._dbg(i.Error,"VoxelLayerView3D._pushEnableIsosurfacesToWasm() failed!"))}_pushEnableSectionsToWasm(e){const s=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushEnableSectionsToWasm() called, "+((0,h.pC)(s)?"have WASM":"don't have WASM!!!"));let t=!1;(0,h.pC)(s)&&(t=s.setEnableSections(this,e),t||this._dbg(i.Error,"VoxelLayerView3D._pushEnableSectionsToWasm() failed!"))}async whenGraphicAttributes(e,s){return e}_dbg(e,s){this._dbgFlags.has(e)&&(e===i.Error?n.Z.getLogger(this.declaredClass).error(s):n.Z.getLogger(this.declaredClass).warn(s))}};(0,r._)([(0,p.Cb)()],x.prototype,"layer",void 0),(0,r._)([(0,p.Cb)()],x.prototype,"baseUrl",null),(0,r._)([(0,p.Cb)({type:Boolean})],x.prototype,"slicePlaneEnabled",void 0),x=(0,r._)([(0,c.j)("esri.views.3d.layers.VoxelLayerView3D")],x);const C=x},44613:(e,s,t)=>{t.d(s,{i:()=>h});var i=t(36663),a=t(70375),r=t(61681),l=(t(13802),t(7283),t(7753),t(39994),t(40266)),o=t(17095),n=t(59439);const h=e=>{let s=class extends e{_validateFetchPopupFeatures(e){const{layer:s}=this,{popupEnabled:t}=s;if(!t)throw new a.Z("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:s});if(!(0,n.V)(s,e))throw new a.Z("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:s})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,s){this._validateFetchPopupFeatures(s);const t=(0,r.pC)(s)?s.clientGraphics:null;if(!t||0===t.length)return[];const i="scene"===this.layer.type&&(0,r.pC)(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;let a=[];"fieldsIndex"in this.layer&&(a=(0,o.Lk)(this.layer.fieldsIndex,await(0,n.e)(i,(0,n.V)(this.layer,s)))),await this.prepareFetchPopupFeatures(a);const l=new Set,h=[],d=[];for(const e of t)(0,o.Gm)(a,e,l)?d.push(e):h.push(e);return 0===d.length?h:this.whenGraphicAttributes(d,[...l]).catch((()=>d)).then((e=>h.concat(e)))}};return s=(0,i._)([(0,l.j)("esri.views.3d.layers.support.PopupSceneLayerView")],s),s}},26216:(e,s,t)=>{t.d(s,{Z:()=>y});var i=t(36663),a=t(53443),r=t(31355),l=t(53280),o=t(86618),n=t(13802),h=t(61681),d=t(64189),p=t(81977),c=(t(7283),t(7753),t(40266));let u=class extends((0,l.p)((0,o.IG)((0,d.v)(r.Z.EventedMixin(a.Z))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const s=this.layer&&this.layer.id||"no id",t=this.layer&&this.layer.title||"no title";n.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${t}', id: '${s}')`,e)}}))}get fullOpacity(){return(0,h.Pt)(this.get("layer.opacity"),1)*(0,h.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this.updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}canResume(){return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,i._)([(0,p.Cb)()],u.prototype,"fullOpacity",null),(0,i._)([(0,p.Cb)()],u.prototype,"layer",void 0),(0,i._)([(0,p.Cb)()],u.prototype,"parent",void 0),(0,i._)([(0,p.Cb)({readOnly:!0})],u.prototype,"suspended",null),(0,i._)([(0,p.Cb)({readOnly:!0})],u.prototype,"suspendInfo",null),(0,i._)([(0,p.Cb)({readOnly:!0})],u.prototype,"legendEnabled",null),(0,i._)([(0,p.Cb)({type:Boolean,readOnly:!0})],u.prototype,"updating",null),(0,i._)([(0,p.Cb)({readOnly:!0})],u.prototype,"updatingProgress",null),(0,i._)([(0,p.Cb)()],u.prototype,"visible",null),(0,i._)([(0,p.Cb)()],u.prototype,"view",void 0),u=(0,i._)([(0,c.j)("esri.views.layers.LayerView")],u);const y=u}}]);